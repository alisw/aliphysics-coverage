<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - FMD/FMDbase/AliFMDGeometryBuilder.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">FMD/FMDbase</a> - AliFMDGeometryBuilder.cxx<span style="font-size: 80%;"> (source / <a href="AliFMDGeometryBuilder.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">809</td>
            <td class="headerCovTableEntry">835</td>
            <td class="headerCovTableEntryHi">96.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntryMed">85.7 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : /* $Id$ */
<span class="lineNum">      16 </span>            : /** @file    AliFMDGeometryBuilder.cxx
<span class="lineNum">      17 </span>            :     @author  Christian Holm Christensen &lt;cholm@nbi.dk&gt;
<span class="lineNum">      18 </span>            :     @date    Mon Mar 27 12:41:17 2006
<span class="lineNum">      19 </span>            :     @brief   Class to build the FMD geometry 
<span class="lineNum">      20 </span>            : */
<span class="lineNum">      21 </span>            : //____________________________________________________________________
<span class="lineNum">      22 </span>            : //                                                                          
<span class="lineNum">      23 </span>            : // Builder of FMD geometry. 
<span class="lineNum">      24 </span>            : //
<span class="lineNum">      25 </span>            : // This class takes care of actually building the geometry using the 
<span class="lineNum">      26 </span>            : // TGeo classes.  Various parameters are fecthed from the
<span class="lineNum">      27 </span>            : // AliFMDGeometry manager.  
<span class="lineNum">      28 </span>            : // Forward Multiplicity Detector based on Silicon wafers. This class
<span class="lineNum">      29 </span>            : // contains the base procedures for the Forward Multiplicity detector
<span class="lineNum">      30 </span>            : // Detector consists of 3 sub-detectors FMD1, FMD2, and FMD3, each of
<span class="lineNum">      31 </span>            : // which has 1 or 2 rings of silicon sensors. 
<span class="lineNum">      32 </span>            : //                                                       
<span class="lineNum">      33 </span>            : // 
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            : #include &lt;TArrayD.h&gt;              // ROOT_TArrayD
<span class="lineNum">      36 </span>            : #include &lt;TGeoManager.h&gt;  // ROOT_TGeoManager
<span class="lineNum">      37 </span>            : #include &lt;TGeoMatrix.h&gt;           // ROOT_TGeoMatrix
<span class="lineNum">      38 </span>            : #include &lt;TGeoTube.h&gt;             // ROOT_TGeoTube
<span class="lineNum">      39 </span>            : #include &lt;TGeoTrd1.h&gt;             // ROOT_TGeoTrd1
<span class="lineNum">      40 </span>            : #include &lt;TGeoCone.h&gt;             // ROOT_TGeoTrd1
<span class="lineNum">      41 </span>            : #include &lt;TGeoVolume.h&gt;           // ROOT_TGeoVolume
<span class="lineNum">      42 </span>            : #include &lt;TGeoXtru.h&gt;             // ROOT_TGeoXtru
<span class="lineNum">      43 </span>            : #include &lt;TGeoPcon.h&gt;             // ROOT_TGeoPcon
<span class="lineNum">      44 </span>            : #include &lt;TGeoTorus.h&gt;            // ROOT_TGeoTorus
<span class="lineNum">      45 </span>            : #include &lt;TGeoCompositeShape.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      47 </span>            : #include &lt;TVector2.h&gt;             // ROOT_TVector2
<span class="lineNum">      48 </span>            : #include &lt;TVector3.h&gt;             // ROOT_TVector3
<span class="lineNum">      49 </span>            : //#include &lt;TGeoMaterial.h&gt;       // ROOT_TGeoMaterial
<span class="lineNum">      50 </span>            : //#include &lt;TGeoMedium.h&gt;         // ROOT_TGeoMedium
<span class="lineNum">      51 </span>            : //#include &lt;TGeoPcon.h&gt;           // ROOT_TGeoPcon
<span class="lineNum">      52 </span>            : //#include &lt;TGeoPolygon.h&gt;        // ROOT_TGeoPolygon
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : #include &quot;AliFMDGeometryBuilder.h&quot;    // ALIFMDGEOSIMULATOR_H
<span class="lineNum">      55 </span>            : #include &quot;AliFMDGeometry.h&quot;   // ALIFMDGEOMETRY_H
<span class="lineNum">      56 </span>            : #include &quot;AliFMDDetector.h&quot;   // ALIFMDDETECTOR_H
<span class="lineNum">      57 </span>            : #include &quot;AliFMDRing.h&quot;               // ALIFMDRING_H
<span class="lineNum">      58 </span>            : #include &quot;AliFMD1.h&quot;          // ALIFMD1_H
<span class="lineNum">      59 </span>            : #include &quot;AliFMD2.h&quot;          // ALIFMD2_H
<span class="lineNum">      60 </span>            : #include &quot;AliFMD3.h&quot;          // ALIFMD3_H
<span class="lineNum">      61 </span>            : // #include &quot;AliFMD.h&quot;                // ALIFMD_H
<span class="lineNum">      62 </span>            : #include &quot;AliFMDDebug.h&quot;              // ALILOG_H
<span class="lineNum">      63 </span>            : #include &lt;iostream&gt;
<a name="64"><span class="lineNum">      64 </span>            : </a>
<span class="lineNum">      65 </span>            : //====================================================================
<span class="lineNum">      66 </span><span class="lineCov">         12 : ClassImp(AliFMDGeometryBuilder)</span>
<span class="lineNum">      67 </span>            : #if 0
<span class="lineNum">      68 </span>            :   ; // This is here to keep Emacs for indenting the next line
<span class="lineNum">      69 </span>            : #endif
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span>            : //____________________________________________________________________
<span class="lineNum">      72 </span>            : const Char_t* AliFMDGeometryBuilder::fgkActiveName      = &quot;F%cAC&quot;;
<span class="lineNum">      73 </span>            : const Char_t* AliFMDGeometryBuilder::fgkSectorName      = &quot;F%cSC&quot;;
<span class="lineNum">      74 </span>            : const Char_t* AliFMDGeometryBuilder::fgkStripName       = &quot;F%cST&quot;;
<span class="lineNum">      75 </span>            : const Char_t* AliFMDGeometryBuilder::fgkSensorName      = &quot;F%cSE&quot;;
<span class="lineNum">      76 </span>            : const Char_t* AliFMDGeometryBuilder::fgkPCBName         = &quot;F%cPB&quot;;
<span class="lineNum">      77 </span>            : const Char_t* AliFMDGeometryBuilder::fgkCuName          = &quot;F%cCU&quot;;
<span class="lineNum">      78 </span>            : const Char_t* AliFMDGeometryBuilder::fgkChipName        = &quot;F%cCH&quot;;
<span class="lineNum">      79 </span>            : const Char_t* AliFMDGeometryBuilder::fgkLongLegName     = &quot;F%cLL&quot;;
<span class="lineNum">      80 </span>            : const Char_t* AliFMDGeometryBuilder::fgkShortLegName    = &quot;F%cSL&quot;;
<span class="lineNum">      81 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFrontVName      = &quot;F%cFH&quot;;
<span class="lineNum">      82 </span>            : const Char_t* AliFMDGeometryBuilder::fgkBackVName       = &quot;F%cBH&quot;;
<span class="lineNum">      83 </span>            : const Char_t* AliFMDGeometryBuilder::fgkRingTopName     = &quot;F%cTV&quot;;
<span class="lineNum">      84 </span>            : const Char_t* AliFMDGeometryBuilder::fgkRingBotName     = &quot;F%cBV&quot;;
<span class="lineNum">      85 </span>            : const Char_t* AliFMDGeometryBuilder::fgkHCName          = &quot;F%dH%c&quot;;
<span class="lineNum">      86 </span>            : const Char_t* AliFMDGeometryBuilder::fgkIHCName         = &quot;F%dI%c&quot;;
<span class="lineNum">      87 </span>            : const Char_t* AliFMDGeometryBuilder::fgkNoseName        = &quot;F3SN&quot;;
<span class="lineNum">      88 </span>            : const Char_t* AliFMDGeometryBuilder::fgkBackName        = &quot;F%dSB&quot;;
<span class="lineNum">      89 </span>            : const Char_t* AliFMDGeometryBuilder::fgkTopName         = &quot;F%dSU&quot;;
<span class="lineNum">      90 </span>            : const Char_t* AliFMDGeometryBuilder::fgkBeamName        = &quot;F%dSL&quot;;
<span class="lineNum">      91 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFlangeName      = &quot;F%dSF&quot;;
<span class="lineNum">      92 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFMDDCuName      = &quot;F%cDC&quot;;
<span class="lineNum">      93 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFMDDPCBName     = &quot;F%cDP&quot;;
<span class="lineNum">      94 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFMDDChipName    = &quot;F%cDI&quot;;
<span class="lineNum">      95 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFMDDName        = &quot;F%cDD&quot;;
<span class="lineNum">      96 </span>            : const Char_t* AliFMDGeometryBuilder::fgkFMDName         = &quot;F%dM%c&quot;;
<a name="97"><span class="lineNum">      97 </span>            : </a>
<span class="lineNum">      98 </span>            : //____________________________________________________________________
<span class="lineNum">      99 </span>            : AliFMDGeometryBuilder::AliFMDGeometryBuilder() 
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :   : TTask(&quot;FMD&quot;, &quot;Geomtry builder&quot;),</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :     fActiveId(0),</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :     fDetailed(kTRUE),</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :     fUseAssembly(kTRUE),</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :     fSectorOff(0),</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :     fModuleOff(0),</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :     fRingOff(0),</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :     fDetectorOff(0),</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :     fSi(0),</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :     fC(0),</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :     fAl(0),</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :     fPCB(0),</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     fChip(0),</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :     fAir(0),</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :     fPlastic(0),</span>
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     fCopper(0),</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :     fSteel(0)</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     118 </span>            :   // Default constructor
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :   fActiveId.Set(2);</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 : }</span>
<a name="121"><span class="lineNum">     121 </span>            : </a>
<span class="lineNum">     122 </span>            : //____________________________________________________________________
<span class="lineNum">     123 </span>            : AliFMDGeometryBuilder::AliFMDGeometryBuilder(Bool_t detailed) 
<span class="lineNum">     124 </span><span class="lineCov">          1 :   : TTask(&quot;FMD&quot;, &quot;Geometry builder&quot;),</span>
<span class="lineNum">     125 </span><span class="lineCov">          1 :     fActiveId(0),</span>
<span class="lineNum">     126 </span><span class="lineCov">          1 :     fDetailed(detailed),</span>
<span class="lineNum">     127 </span><span class="lineCov">          1 :     fUseAssembly(kTRUE),</span>
<span class="lineNum">     128 </span><span class="lineCov">          1 :     fSectorOff(0),</span>
<span class="lineNum">     129 </span><span class="lineCov">          1 :     fModuleOff(0),</span>
<span class="lineNum">     130 </span><span class="lineCov">          1 :     fRingOff(0),</span>
<span class="lineNum">     131 </span><span class="lineCov">          1 :     fDetectorOff(0),</span>
<span class="lineNum">     132 </span><span class="lineCov">          1 :     fSi(0),</span>
<span class="lineNum">     133 </span><span class="lineCov">          1 :     fC(0),</span>
<span class="lineNum">     134 </span><span class="lineCov">          1 :     fAl(0),</span>
<span class="lineNum">     135 </span><span class="lineCov">          1 :     fPCB(0),</span>
<span class="lineNum">     136 </span><span class="lineCov">          1 :     fChip(0),</span>
<span class="lineNum">     137 </span><span class="lineCov">          1 :     fAir(0),</span>
<span class="lineNum">     138 </span><span class="lineCov">          1 :     fPlastic(0),</span>
<span class="lineNum">     139 </span><span class="lineCov">          1 :     fCopper(0),</span>
<span class="lineNum">     140 </span><span class="lineCov">          1 :     fSteel(0)</span>
<span class="lineNum">     141 </span><span class="lineCov">          3 : {</span>
<span class="lineNum">     142 </span>            :   // Normal constructor
<span class="lineNum">     143 </span>            :   // 
<span class="lineNum">     144 </span>            :   // Parameters: 
<span class="lineNum">     145 </span>            :   // 
<span class="lineNum">     146 </span>            :   //      fmd           Pointer to AliFMD object 
<span class="lineNum">     147 </span>            :   //      detailed      Whether to make a detailed simulation or not 
<span class="lineNum">     148 </span>            :   // 
<span class="lineNum">     149 </span><span class="lineCov">          1 :   fActiveId.Set(2);</span>
<span class="lineNum">     150 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     151 </span>            : 
<a name="152"><span class="lineNum">     152 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     153 </span>            : TGeoShape*
<span class="lineNum">     154 </span>            : AliFMDGeometryBuilder::MakeXTRU(const TObjArray&amp; verticies, 
<span class="lineNum">     155 </span>            :                                 Double_t thick) const
<span class="lineNum">     156 </span>            : {
<span class="lineNum">     157 </span>            :   // 
<span class="lineNum">     158 </span>            :   // Make a polygonic extrusion shape based on verticies passed in @a
<span class="lineNum">     159 </span>            :   // verticies 
<span class="lineNum">     160 </span>            :   // 
<span class="lineNum">     161 </span>            :   // Parameters:
<span class="lineNum">     162 </span>            :   //    verticies List of verticies
<span class="lineNum">     163 </span>            :   //    thick     Thickness
<span class="lineNum">     164 </span>            :   // 
<span class="lineNum">     165 </span>            :   // Return:
<span class="lineNum">     166 </span>            :   //    newly allocated polygonic extrusion shape
<span class="lineNum">     167 </span>            :   //
<span class="lineNum">     168 </span><span class="lineCov">         16 :   TArrayD xs(6);</span>
<span class="lineNum">     169 </span><span class="lineCov">          8 :   TArrayD ys(6);</span>
<span class="lineNum">     170 </span><span class="lineCov">         64 :   for (Int_t i = 0; i &lt; 3; i++) { </span>
<span class="lineNum">     171 </span><span class="lineCov">         48 :     TVector2* v = static_cast&lt;TVector2*&gt;(verticies.At(i+1));</span>
<span class="lineNum">     172 </span><span class="lineCov">         48 :     xs[i]     =  v-&gt;Y();</span>
<span class="lineNum">     173 </span><span class="lineCov">         48 :     ys[i]     = -v-&gt;X();</span>
<span class="lineNum">     174 </span><span class="lineCov">         48 :     xs[6-1-i] =  v-&gt;Y();</span>
<span class="lineNum">     175 </span><span class="lineCov">         48 :     ys[6-1-i] =  v-&gt;X();</span>
<span class="lineNum">     176 </span>            :   }
<span class="lineNum">     177 </span><span class="lineCov">         16 :   TGeoXtru* shape = new TGeoXtru(2);</span>
<span class="lineNum">     178 </span><span class="lineCov">          8 :   shape-&gt;DefinePolygon(xs.fN, xs.fArray, ys.fArray);</span>
<span class="lineNum">     179 </span><span class="lineCov">          8 :   shape-&gt;DefineSection(0, -thick/2);</span>
<span class="lineNum">     180 </span><span class="lineCov">          8 :   shape-&gt;DefineSection(1, +thick/2);</span>
<span class="lineNum">     181 </span>            :   
<span class="lineNum">     182 </span><span class="lineCov">          8 :   return shape;</span>
<span class="lineNum">     183 </span><span class="lineCov">          8 : }</span>
<span class="lineNum">     184 </span>            : 
<a name="185"><span class="lineNum">     185 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     186 </span>            : TGeoVolume*
<span class="lineNum">     187 </span>            : AliFMDGeometryBuilder::RingGeometry(const AliFMDRing* r) 
<span class="lineNum">     188 </span>            : {
<span class="lineNum">     189 </span>            :   // Setup the geometry of a ring.    The defined TGeoVolume is
<span class="lineNum">     190 </span>            :   // returned, and should be used when setting up the rest of the
<span class="lineNum">     191 </span>            :   // volumes. 
<span class="lineNum">     192 </span>            :   // 
<span class="lineNum">     193 </span>            :   // 
<span class="lineNum">     194 </span>            :   // Parameters:
<span class="lineNum">     195 </span>            :   //
<span class="lineNum">     196 </span>            :   //     r              Pointer to ring geometry object 
<span class="lineNum">     197 </span>            :   // 
<span class="lineNum">     198 </span>            :   // Returns:
<span class="lineNum">     199 </span>            :   //    pointer to ring volume 
<span class="lineNum">     200 </span>            :   //
<span class="lineNum">     201 </span><span class="lineCov">          4 :   if (!r) { </span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :     AliError(&quot;Didn't get a ring object&quot;);</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     204 </span>            :   }
<span class="lineNum">     205 </span><span class="lineCov">          2 :   Char_t        id       = r-&gt;GetId();</span>
<span class="lineNum">     206 </span><span class="lineCov">          2 :   Char_t        rng      = toupper(id);</span>
<span class="lineNum">     207 </span><span class="lineCov">          2 :   const Char_t* lName    = (rng == 'I' ? &quot;inner&quot; : &quot;outer&quot;);</span>
<span class="lineNum">     208 </span><span class="lineCov">          2 :   Double_t siThick  = r-&gt;GetSiThickness();</span>
<span class="lineNum">     209 </span><span class="lineCov">          2 :   Double_t pcbThick = r-&gt;GetPrintboardThickness();</span>
<span class="lineNum">     210 </span><span class="lineCov">          2 :   Double_t cuThick  = r-&gt;GetCopperThickness();</span>
<span class="lineNum">     211 </span><span class="lineCov">          2 :   Double_t chipThick= r-&gt;GetChipThickness();</span>
<span class="lineNum">     212 </span><span class="lineCov">          2 :   Double_t modSpace = r-&gt;GetModuleSpacing();</span>
<span class="lineNum">     213 </span><span class="lineCov">          2 :   Double_t theta    = r-&gt;GetTheta();</span>
<span class="lineNum">     214 </span>            :   
<span class="lineNum">     215 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     216 </span>            :   // Sensor
<span class="lineNum">     217 </span>            :   // Physical sensor
<span class="lineNum">     218 </span><span class="lineCov">          2 :   TGeoShape* sensorShape = MakeXTRU(r-&gt;GetSensorVerticies(), siThick);</span>
<span class="lineNum">     219 </span><span class="lineCov">          2 :   sensorShape-&gt;SetName(Form(&quot;FMD%c_physical_sensor&quot;, id));</span>
<span class="lineNum">     220 </span><span class="lineCov">          2 :   sensorShape-&gt;SetTitle(Form(&quot;FMD %s physical sensor&quot;, lName));</span>
<span class="lineNum">     221 </span><span class="lineCov">          2 :   TString sensorName = TString::Format(fgkSensorName, id);</span>
<span class="lineNum">     222 </span><span class="lineCov">          6 :   TGeoVolume* sensorVolume = new TGeoVolume(sensorName, sensorShape, fSi);</span>
<span class="lineNum">     223 </span><span class="lineCov">          4 :   sensorVolume-&gt;SetTitle(Form(&quot;FMD %s Sensor&quot;, lName));</span>
<span class="lineNum">     224 </span><span class="lineCov">          2 :   sensorVolume-&gt;VisibleDaughters(kFALSE);</span>
<span class="lineNum">     225 </span><span class="lineCov">          2 :   Int_t sid = sensorVolume-&gt;GetNumber();</span>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineCov">          2 :   fSectorOff   = -1;</span>
<span class="lineNum">     228 </span><span class="lineCov">          2 :   fModuleOff   = 1;</span>
<span class="lineNum">     229 </span><span class="lineCov">          2 :   fRingOff     = 2;</span>
<span class="lineNum">     230 </span><span class="lineCov">          2 :   fDetectorOff = 3;</span>
<span class="lineNum">     231 </span><span class="lineCov">          2 :   if (fDetailed) {</span>
<span class="lineNum">     232 </span><span class="lineCov">          2 :     fSectorOff   = 1;</span>
<span class="lineNum">     233 </span><span class="lineCov">          2 :     fModuleOff   = 4;</span>
<span class="lineNum">     234 </span><span class="lineCov">          2 :     fRingOff     = 5;</span>
<span class="lineNum">     235 </span><span class="lineCov">          2 :     fDetectorOff = 6;</span>
<span class="lineNum">     236 </span>            :     // Virtual volume shape to divide - This volume is only defined if
<span class="lineNum">     237 </span>            :     // the geometry is set to be detailed. 
<span class="lineNum">     238 </span><span class="lineCov">          6 :     TGeoTubeSeg* activeShape = new TGeoTubeSeg(r-&gt;GetLowR(),</span>
<span class="lineNum">     239 </span><span class="lineCov">          2 :                                                r-&gt;GetHighR(), </span>
<span class="lineNum">     240 </span><span class="lineCov">          2 :                                                siThick / 2, </span>
<span class="lineNum">     241 </span><span class="lineCov">          2 :                                                - theta, </span>
<span class="lineNum">     242 </span>            :                                                + theta);
<span class="lineNum">     243 </span><span class="lineCov">          4 :     activeShape-&gt;SetName(Form(fgkActiveName, id));</span>
<span class="lineNum">     244 </span><span class="lineCov">          4 :     activeShape-&gt;SetTitle(Form(&quot;FMD %s active area&quot;, lName));</span>
<span class="lineNum">     245 </span><span class="lineCov">          2 :     TString activeName = TString::Format(fgkActiveName, id);</span>
<span class="lineNum">     246 </span><span class="lineCov">          6 :     TGeoVolume* activeVolume = new TGeoVolume(activeName,activeShape,fSi);</span>
<span class="lineNum">     247 </span><span class="lineCov">          4 :     activeVolume-&gt;SetTitle(Form(&quot;FMD %s active area&quot;, lName));</span>
<span class="lineNum">     248 </span><span class="lineCov">          2 :     TString sectorName = TString::Format(fgkSectorName,id);</span>
<span class="lineNum">     249 </span><span class="lineCov">          4 :     TGeoVolume* sectorVolume = activeVolume-&gt;Divide(sectorName, 2, 2, -theta,</span>
<span class="lineNum">     250 </span>            :                                                     0,0,&quot;N&quot;);
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span><span class="lineCov">          2 :     Int_t    ns       = r-&gt;GetNStrips();</span>
<span class="lineNum">     253 </span><span class="lineCov">          2 :     Double_t stripoff = r-&gt;GetLowR(); // 0; // a-&gt;Mod();</span>
<span class="lineNum">     254 </span><span class="lineCov">          2 :     Double_t dstrip   = (r-&gt;GetHighR() - stripoff) / ns;</span>
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span><span class="lineCov">          4 :     sectorVolume-&gt;SetTitle(Form(&quot;FMD %s sector&quot;, lName));</span>
<span class="lineNum">     257 </span><span class="lineCov">          2 :     TString stripName = TString::Format(fgkStripName, id);</span>
<span class="lineNum">     258 </span><span class="lineCov">          4 :     TGeoVolume* stripVolume  = sectorVolume-&gt;Divide(stripName, </span>
<span class="lineNum">     259 </span>            :                                                     1, ns, stripoff, dstrip, 
<span class="lineNum">     260 </span>            :                                                     0, &quot;SX&quot;);
<span class="lineNum">     261 </span><span class="lineCov">          4 :     stripVolume-&gt;SetTitle(Form(&quot;FMD %s strip&quot;, lName));</span>
<span class="lineNum">     262 </span><span class="lineCov">          2 :     sid = stripVolume-&gt;GetNumber();</span>
<span class="lineNum">     263 </span><span class="lineCov">          2 :     sensorVolume-&gt;AddNodeOverlap(activeVolume, 0);</span>
<span class="lineNum">     264 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">     265 </span>            :   
<span class="lineNum">     266 </span><span class="lineCov">          2 :   switch (rng) {</span>
<span class="lineNum">     267 </span><span class="lineCov">          2 :   case 'I': fActiveId[0] = sid; break;</span>
<span class="lineNum">     268 </span><span class="lineCov">          2 :   case 'O': fActiveId[1] = sid; break;</span>
<span class="lineNum">     269 </span>            :   }
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     272 </span>            :   // Hybrid
<span class="lineNum">     273 </span>            :   // PCB layer of hybrid 
<span class="lineNum">     274 </span><span class="lineCov">          2 :   TGeoShape* pcbShape = MakeXTRU(r-&gt;GetHybridVerticies(), pcbThick);</span>
<span class="lineNum">     275 </span><span class="lineCov">          4 :   pcbShape-&gt;SetName(Form(&quot;FMD%c_hybrid_pcb&quot;, id));</span>
<span class="lineNum">     276 </span><span class="lineCov">          4 :   pcbShape-&gt;SetTitle(Form(&quot;FMD %s hybrid PCB&quot;, lName));</span>
<span class="lineNum">     277 </span><span class="lineCov">          2 :   TString pcbName = TString::Format(fgkPCBName, id);</span>
<span class="lineNum">     278 </span><span class="lineCov">          6 :   TGeoVolume* pcbVolume = new TGeoVolume(pcbName, pcbShape, fPCB);</span>
<span class="lineNum">     279 </span><span class="lineCov">          4 :   pcbVolume-&gt;SetTitle(Form(&quot;FMD %s hybrid PCB&quot;, lName));</span>
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span>            :   // Copper layer
<span class="lineNum">     282 </span><span class="lineCov">          2 :   TGeoShape* cuShape = MakeXTRU(r-&gt;GetHybridVerticies(), cuThick);</span>
<span class="lineNum">     283 </span><span class="lineCov">          4 :   cuShape-&gt;SetName(Form(&quot;FMD%c_hybrid_copper&quot;, id));</span>
<span class="lineNum">     284 </span><span class="lineCov">          4 :   cuShape-&gt;SetTitle(Form(&quot;FMD %s hybrid copper&quot;, lName));</span>
<span class="lineNum">     285 </span><span class="lineCov">          2 :   TString cuName = TString::Format(fgkCuName,id);</span>
<span class="lineNum">     286 </span><span class="lineCov">          6 :   TGeoVolume* cuVolume = new TGeoVolume(cuName,cuShape,fCopper);</span>
<span class="lineNum">     287 </span><span class="lineCov">          4 :   cuVolume-&gt;SetTitle(Form(&quot;FMD %s hybrid copper&quot;, lName));</span>
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span>            :   // Chip layer
<span class="lineNum">     290 </span><span class="lineCov">          2 :   TGeoShape* chipShape = MakeXTRU(r-&gt;GetHybridVerticies(), chipThick);</span>
<span class="lineNum">     291 </span><span class="lineCov">          4 :   chipShape-&gt;SetName(Form(&quot;FMD%c_hybrid_chip&quot;, id));</span>
<span class="lineNum">     292 </span><span class="lineCov">          4 :   chipShape-&gt;SetTitle(Form(&quot;FMD %s hybrid chip&quot;, lName));</span>
<span class="lineNum">     293 </span><span class="lineCov">          2 :   TString chipName = TString::Format(fgkChipName,id);</span>
<span class="lineNum">     294 </span><span class="lineCov">          6 :   TGeoVolume* chipVolume = new TGeoVolume(chipName,chipShape,fChip);</span>
<span class="lineNum">     295 </span><span class="lineCov">          4 :   chipVolume-&gt;SetTitle(Form(&quot;FMD %s hybrid chip&quot;, lName));</span>
<span class="lineNum">     296 </span>            : 
<span class="lineNum">     297 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     298 </span>            :   // Legs
<span class="lineNum">     299 </span><span class="lineCov">          2 :   Double_t      legr     = r-&gt;GetLegRadius();</span>
<span class="lineNum">     300 </span><span class="lineCov">          2 :   Double_t      legl     = r-&gt;GetLegLength();</span>
<span class="lineNum">     301 </span>            :   Double_t      lege     = .05;
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span>            :   // Short leg shape 
<span class="lineNum">     304 </span><span class="lineCov">          4 :   TGeoTube*   shortLegShape  = new TGeoTube(0, legr, (legl-lege) / 2);</span>
<span class="lineNum">     305 </span><span class="lineCov">          4 :   shortLegShape-&gt;SetName(Form(fgkShortLegName, id));</span>
<span class="lineNum">     306 </span><span class="lineCov">          4 :   shortLegShape-&gt;SetTitle(Form(&quot;FMD %s short support foot&quot;, lName));</span>
<span class="lineNum">     307 </span><span class="lineCov">          2 :   TString shortLegName = TString::Format(fgkShortLegName, id);</span>
<span class="lineNum">     308 </span><span class="lineCov">          6 :   TGeoVolume* shortLegVolume = new TGeoVolume(shortLegName, </span>
<span class="lineNum">     309 </span><span class="lineCov">          2 :                                               shortLegShape, fCopper);</span>
<span class="lineNum">     310 </span><span class="lineCov">          4 :   shortLegVolume-&gt;SetTitle(Form(&quot;FMD %s short support foot&quot;, lName));</span>
<span class="lineNum">     311 </span>            :   // Long leg shape
<span class="lineNum">     312 </span><span class="lineCov">          6 :   TGeoTube*   longLegShape   = new TGeoTube(0, legr, </span>
<span class="lineNum">     313 </span><span class="lineCov">          2 :                                             (legl - lege + modSpace) / 2);</span>
<span class="lineNum">     314 </span><span class="lineCov">          4 :   longLegShape-&gt;SetName(Form(fgkLongLegName, id));</span>
<span class="lineNum">     315 </span><span class="lineCov">          4 :   longLegShape-&gt;SetTitle(Form(&quot;FMD %s long support foot&quot;, lName));</span>
<span class="lineNum">     316 </span><span class="lineCov">          2 :   TString longLegName = TString::Format(fgkLongLegName, id);</span>
<span class="lineNum">     317 </span><span class="lineCov">          6 :   TGeoVolume* longLegVolume = new TGeoVolume(longLegName, </span>
<span class="lineNum">     318 </span><span class="lineCov">          2 :                                               longLegShape, fCopper);</span>
<span class="lineNum">     319 </span><span class="lineCov">          4 :   longLegVolume-&gt;SetTitle(Form(&quot;FMD %s long support foot&quot;, lName));</span>
<span class="lineNum">     320 </span>            :   
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     324 </span>            :   // Placement of module volumes in assemblies 
<span class="lineNum">     325 </span><span class="lineCov">          2 :   TArrayD xfs(3);</span>
<span class="lineNum">     326 </span><span class="lineCov">          2 :   TArrayD yfs(3);</span>
<span class="lineNum">     327 </span><span class="lineCov">         16 :   for (Int_t i = 0; i &lt; 3; i++) { </span>
<span class="lineNum">     328 </span><span class="lineCov">          6 :     TVector2* vv = r-&gt;GetFootPosition(i);</span>
<span class="lineNum">     329 </span>            :     // TVector2  uu = vv-&gt;Rotate(TMath::Pi()/2);
<span class="lineNum">     330 </span><span class="lineCov">         12 :     xfs[i]       = vv-&gt;Y();</span>
<span class="lineNum">     331 </span><span class="lineCov">         12 :     yfs[i]       = vv-&gt;X();</span>
<span class="lineNum">     332 </span>            :   }
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span>            :   // Back container volume 
<span class="lineNum">     335 </span><span class="lineCov">          8 :   TGeoVolume* backVolume     = new TGeoVolumeAssembly(Form(fgkBackVName, id));</span>
<span class="lineNum">     336 </span><span class="lineCov">          4 :   backVolume-&gt;SetTitle(Form(&quot;FMD %s back module&quot;, lName));</span>
<span class="lineNum">     337 </span><span class="lineCov">          8 :   TGeoVolume* frontVolume    = new TGeoVolumeAssembly(Form(fgkFrontVName, id));</span>
<span class="lineNum">     338 </span><span class="lineCov">          4 :   frontVolume-&gt;SetTitle(Form(&quot;FMD %s front module&quot;, lName));</span>
<span class="lineNum">     339 </span>            : 
<span class="lineNum">     340 </span><span class="lineCov">          2 :   Double_t space    = r-&gt;GetSpacing();</span>
<span class="lineNum">     341 </span>            :   Double_t x        = 0;
<span class="lineNum">     342 </span>            :   Double_t y        = 0;
<span class="lineNum">     343 </span><span class="lineCov">          2 :   Double_t zb       = siThick / 2;</span>
<span class="lineNum">     344 </span>            :   Double_t zf       = siThick / 2;
<span class="lineNum">     345 </span><span class="lineCov">          6 :   backVolume-&gt;AddNode(sensorVolume, 0, new TGeoTranslation(x, y, zb));</span>
<span class="lineNum">     346 </span><span class="lineCov">          6 :   frontVolume-&gt;AddNode(sensorVolume, 0, new TGeoTranslation(x, y, zf));</span>
<span class="lineNum">     347 </span><span class="lineCov">          2 :   zb         += siThick / 2 + space + pcbThick / 2;</span>
<span class="lineNum">     348 </span>            :   zf         += siThick / 2 + space + pcbThick / 2;
<span class="lineNum">     349 </span><span class="lineCov">          6 :   backVolume-&gt;AddNode(pcbVolume, 0, new TGeoTranslation(x, y, zb));</span>
<span class="lineNum">     350 </span><span class="lineCov">          6 :   frontVolume-&gt;AddNode(pcbVolume, 0, new TGeoTranslation(x, y, zf));</span>
<span class="lineNum">     351 </span><span class="lineCov">          2 :   zb         += (pcbThick + cuThick) / 2;</span>
<span class="lineNum">     352 </span>            :   zf         += (pcbThick + cuThick) / 2;
<span class="lineNum">     353 </span><span class="lineCov">          6 :   backVolume-&gt;AddNode(cuVolume, 0, new TGeoTranslation(0, 0, zf));</span>
<span class="lineNum">     354 </span><span class="lineCov">          6 :   frontVolume-&gt;AddNode(cuVolume, 0, new TGeoTranslation(0, 0, zb));</span>
<span class="lineNum">     355 </span><span class="lineCov">          2 :   zb         += (cuThick + chipThick) / 2;</span>
<span class="lineNum">     356 </span>            :   zf         += (cuThick + chipThick) / 2;
<span class="lineNum">     357 </span><span class="lineCov">          6 :   backVolume-&gt;AddNode(chipVolume, 0, new TGeoTranslation(0, 0, zb));</span>
<span class="lineNum">     358 </span><span class="lineCov">          6 :   frontVolume-&gt;AddNode(chipVolume, 0, new TGeoTranslation(0, 0, zf));</span>
<span class="lineNum">     359 </span><span class="lineCov">          2 :   zb         += pcbThick / 2 + (legl)/ 2  - lege;</span>
<span class="lineNum">     360 </span><span class="lineCov">          2 :   zf         += pcbThick / 2 + (legl + modSpace)/ 2 - lege;</span>
<span class="lineNum">     361 </span><span class="lineCov">         16 :   for (Int_t i = 0; i &lt; 3; i++) { </span>
<span class="lineNum">     362 </span><span class="lineCov">         12 :     x          =  xfs[i]; // a-&gt;X() + legoff + legr;</span>
<span class="lineNum">     363 </span><span class="lineCov">         12 :     y          =  yfs[i]; // 0;</span>
<span class="lineNum">     364 </span><span class="lineCov">         18 :     backVolume-&gt;AddNode(shortLegVolume, i, new TGeoTranslation(x,y,zb));</span>
<span class="lineNum">     365 </span><span class="lineCov">         18 :     frontVolume-&gt;AddNode(longLegVolume, i, new TGeoTranslation(x,y,zf));</span>
<span class="lineNum">     366 </span>            :   }
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     369 </span>            :   // FMDD 
<span class="lineNum">     370 </span><span class="lineCov">          2 :   Double_t ddlr = r-&gt;GetFMDDLowR();</span>
<span class="lineNum">     371 </span><span class="lineCov">          2 :   Double_t ddhr = r-&gt;GetFMDDHighR();</span>
<span class="lineNum">     372 </span><span class="lineCov">          2 :   Double_t ddpt = r-&gt;GetFMDDPrintboardThickness();</span>
<span class="lineNum">     373 </span><span class="lineCov">          2 :   Double_t ddct = r-&gt;GetFMDDCopperThickness();</span>
<span class="lineNum">     374 </span><span class="lineCov">          2 :   Double_t ddit = r-&gt;GetFMDDChipThickness();</span>
<span class="lineNum">     375 </span><span class="lineCov">          2 :   Double_t ddt  = ddpt + ddct + ddit;</span>
<span class="lineNum">     376 </span>            :   
<span class="lineNum">     377 </span><span class="lineCov">          4 :   TString    pcbdName(Form(fgkFMDDPCBName, id));</span>
<span class="lineNum">     378 </span><span class="lineCov">          4 :   TString    cudName(Form(fgkFMDDCuName, id));</span>
<span class="lineNum">     379 </span><span class="lineCov">          4 :   TString    chipdName(Form(fgkFMDDChipName, id));</span>
<span class="lineNum">     380 </span><span class="lineCov">          8 :   new TGeoTubeSeg(Form(&quot;%s_inner&quot;, pcbdName.Data()),  ddlr, ddhr, ddpt/2,0,180);</span>
<span class="lineNum">     381 </span><span class="lineCov">          8 :   new TGeoTubeSeg(Form(&quot;%s_inner&quot;, cudName.Data()),   ddlr, ddhr, ddct/2,0,180);</span>
<span class="lineNum">     382 </span><span class="lineCov">          8 :   new TGeoTubeSeg(Form(&quot;%s_inner&quot;, chipdName.Data()), ddlr, ddhr, ddit/2,0,180);</span>
<span class="lineNum">     383 </span>            :   
<span class="lineNum">     384 </span>            :   Double_t clipWX = 0;
<span class="lineNum">     385 </span>            :   Double_t clipWY = 0;
<span class="lineNum">     386 </span>            :   Double_t clipY  = 1;
<span class="lineNum">     387 </span>            :   
<span class="lineNum">     388 </span><span class="lineCov">          2 :   if (rng == 'I') { </span>
<span class="lineNum">     389 </span>            :     clipWX = ddhr;
<span class="lineNum">     390 </span><span class="lineCov">          1 :     clipWY = ddhr/2;</span>
<span class="lineNum">     391 </span><span class="lineCov">          1 :   }</span>
<span class="lineNum">     392 </span>            :   else { 
<span class="lineNum">     393 </span><span class="lineCov">          1 :     clipWX = ddlr+3;</span>
<span class="lineNum">     394 </span><span class="lineCov">          1 :     clipWY = ddhr/2;</span>
<span class="lineNum">     395 </span>            :   }
<span class="lineNum">     396 </span>            :   
<span class="lineNum">     397 </span><span class="lineCov">          8 :   new TGeoBBox(Form(&quot;%s_clip&quot;,  pcbdName.Data()), clipWX, clipWY, ddpt);</span>
<span class="lineNum">     398 </span><span class="lineCov">          8 :   new TGeoBBox(Form(&quot;%s_clip&quot;,  cudName.Data()),  clipWX, clipWY, ddct);</span>
<span class="lineNum">     399 </span><span class="lineCov">          8 :   new TGeoBBox(Form(&quot;%s_clip&quot;,  chipdName.Data()),clipWX, clipWY, ddit);</span>
<span class="lineNum">     400 </span><span class="lineCov">          8 :   TGeoTranslation* trans = new TGeoTranslation(Form(&quot;%s_trans&quot;,</span>
<span class="lineNum">     401 </span><span class="lineCov">          2 :                                                     pcbdName.Data()), </span>
<span class="lineNum">     402 </span><span class="lineCov">          2 :                                                0, clipWY+clipY, 0);</span>
<span class="lineNum">     403 </span><span class="lineCov">          2 :   trans-&gt;RegisterYourself();</span>
<span class="lineNum">     404 </span>            :   TGeoShape* fmddPcbShape = 
<span class="lineNum">     405 </span><span class="lineCov">          8 :     new TGeoCompositeShape(pcbdName.Data(), </span>
<span class="lineNum">     406 </span><span class="lineCov">          2 :                            Form(&quot;%s_inner*%s_clip:%s_trans&quot;,</span>
<span class="lineNum">     407 </span><span class="lineCov">          2 :                                 pcbdName.Data(), </span>
<span class="lineNum">     408 </span><span class="lineCov">          2 :                                 pcbdName.Data(), </span>
<span class="lineNum">     409 </span><span class="lineCov">          2 :                                 pcbdName.Data())); </span>
<span class="lineNum">     410 </span>            :   TGeoShape* fmddCuShape = 
<span class="lineNum">     411 </span><span class="lineCov">          8 :     new TGeoCompositeShape(cudName.Data(), </span>
<span class="lineNum">     412 </span><span class="lineCov">          2 :                            Form(&quot;%s_inner*%s_clip:%s_trans&quot;,</span>
<span class="lineNum">     413 </span><span class="lineCov">          2 :                                 cudName.Data(), </span>
<span class="lineNum">     414 </span><span class="lineCov">          2 :                                 cudName.Data(), </span>
<span class="lineNum">     415 </span><span class="lineCov">          2 :                                 pcbdName.Data()));</span>
<span class="lineNum">     416 </span>            :   TGeoShape* fmddChipShape = 
<span class="lineNum">     417 </span><span class="lineCov">          8 :     new TGeoCompositeShape(chipdName.Data(), </span>
<span class="lineNum">     418 </span><span class="lineCov">          2 :                            Form(&quot;%s_inner*%s_clip:%s_trans&quot;,</span>
<span class="lineNum">     419 </span><span class="lineCov">          2 :                                 chipdName.Data(), </span>
<span class="lineNum">     420 </span><span class="lineCov">          2 :                                 chipdName.Data(), </span>
<span class="lineNum">     421 </span><span class="lineCov">          2 :                                 pcbdName.Data()));</span>
<span class="lineNum">     422 </span><span class="lineCov">          4 :   fmddPcbShape-&gt;SetTitle(Form(&quot;FMD %s digitiser PCB&quot;, lName));</span>
<span class="lineNum">     423 </span><span class="lineCov">          4 :   fmddCuShape-&gt;SetTitle(Form(&quot;FMD %s digitiser copper&quot;, lName));</span>
<span class="lineNum">     424 </span><span class="lineCov">          4 :   fmddChipShape-&gt;SetTitle(Form(&quot;FMD %s digitiser chip&quot;, lName));</span>
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span><span class="lineCov">          2 :   TString fmddPcbName = TString::Format(fgkFMDDPCBName, id);</span>
<span class="lineNum">     427 </span><span class="lineCov">          6 :   TGeoVolume* fmddPcbVolume = new TGeoVolume(fmddPcbName,</span>
<span class="lineNum">     428 </span><span class="lineCov">          2 :                                               fmddPcbShape, fPCB);</span>
<span class="lineNum">     429 </span><span class="lineCov">          2 :   TString fmddCuName = TString::Format(fgkFMDDCuName, id);</span>
<span class="lineNum">     430 </span><span class="lineCov">          6 :   TGeoVolume* fmddCuVolume = new TGeoVolume(fmddCuName,</span>
<span class="lineNum">     431 </span><span class="lineCov">          2 :                                               fmddCuShape, fCopper);</span>
<span class="lineNum">     432 </span><span class="lineCov">          2 :   TString fmddChipName = TString::Format(fgkFMDDChipName, id);</span>
<span class="lineNum">     433 </span><span class="lineCov">          6 :   TGeoVolume* fmddChipVolume = new TGeoVolume(fmddChipName,</span>
<span class="lineNum">     434 </span><span class="lineCov">          2 :                                               fmddChipShape, fChip);</span>
<span class="lineNum">     435 </span><span class="lineCov">          4 :   fmddPcbVolume-&gt;SetTitle(Form(&quot;FMD %s digitiser PCB&quot;, lName));</span>
<span class="lineNum">     436 </span><span class="lineCov">          4 :   fmddCuVolume-&gt;SetTitle(Form(&quot;FMD %s digitiser copper&quot;, lName));</span>
<span class="lineNum">     437 </span><span class="lineCov">          4 :   fmddChipVolume-&gt;SetTitle(Form(&quot;FMD %s digitiser chip&quot;, lName));</span>
<span class="lineNum">     438 </span>            : 
<span class="lineNum">     439 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     440 </span>            :   // Half ring mother volumes. 
<span class="lineNum">     441 </span><span class="lineCov">          8 :   TGeoVolume* ringTopVolume = new TGeoVolumeAssembly(Form(fgkRingTopName,id));</span>
<span class="lineNum">     442 </span><span class="lineCov">          8 :   TGeoVolume* ringBotVolume = new TGeoVolumeAssembly(Form(fgkRingBotName,id));</span>
<span class="lineNum">     443 </span>            :   TGeoVolume* halfRing      = ringTopVolume;
<span class="lineNum">     444 </span><span class="lineCov">          4 :   ringTopVolume-&gt;SetTitle(Form(&quot;FMD %s top half-ring&quot;, lName));</span>
<span class="lineNum">     445 </span><span class="lineCov">          4 :   ringBotVolume-&gt;SetTitle(Form(&quot;FMD %s bottom half-ring&quot;, lName));</span>
<span class="lineNum">     446 </span>            :   
<span class="lineNum">     447 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     448 </span>            :   // Adding modules to half-rings
<span class="lineNum">     449 </span><span class="lineCov">          2 :   Int_t    nmod =  r-&gt;GetNModules();</span>
<span class="lineNum">     450 </span><span class="lineCov">          8 :   AliFMDDebug(10, (&quot;making %d modules in ring %c&quot;, nmod, id));</span>
<span class="lineNum">     451 </span><span class="lineCov">         64 :   for (Int_t i = 0; i &lt; nmod; i++) {</span>
<span class="lineNum">     452 </span><span class="lineCov">         32 :     if (i == nmod / 2) halfRing = ringBotVolume;</span>
<span class="lineNum">     453 </span><span class="lineCov">         30 :     Bool_t      front =  (i % 2 == (rng == 'I' ? 1 : 0));</span>
<span class="lineNum">     454 </span><span class="lineCov">         30 :     TGeoVolume* vol   =  (front ? frontVolume : backVolume);</span>
<span class="lineNum">     455 </span>            :     // vol-&gt;AddNode(sensorVolume, i, new TGeoTranslation(0,0,siThick/2));
<span class="lineNum">     456 </span><span class="lineCov">         30 :     Double_t    z1    =  (front ? -1 : 1) * modSpace / 2;</span>
<span class="lineNum">     457 </span>            :     // Double_t z1    =  (front ? 0 : modSpace);
<span class="lineNum">     458 </span><span class="lineCov">         30 :     Double_t    th    =  (2 * i + 1) * theta;</span>
<span class="lineNum">     459 </span><span class="lineCov">         90 :     TGeoMatrix* mat1  =  new TGeoCombiTrans(0,0,z1,0); </span>
<span class="lineNum">     460 </span><span class="lineCov">         30 :     mat1-&gt;RotateZ(th);</span>
<span class="lineNum">     461 </span><span class="lineCov">         60 :     mat1-&gt;SetName(Form(&quot;FMD%c_module_%02d&quot;, id, i));</span>
<span class="lineNum">     462 </span><span class="lineCov">         60 :     mat1-&gt;SetTitle(Form(&quot;FMD %s module %2d matrix&quot;, lName, i));</span>
<span class="lineNum">     463 </span><span class="lineCov">         30 :     halfRing-&gt;AddNode(vol, i, mat1);</span>
<span class="lineNum">     464 </span>            :   }
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span>            :   //------------------------------------------------------------------
<span class="lineNum">     467 </span>            :   // Add the FMDD 
<span class="lineNum">     468 </span><span class="lineCov">          4 :   Double_t zi = r-&gt;GetFullDepth() - ddt;</span>
<span class="lineNum">     469 </span>            :   Int_t    n  = 2;
<span class="lineNum">     470 </span><span class="lineCov">         12 :   for (Int_t i = 0; i  &lt; n; i++) {</span>
<span class="lineNum">     471 </span><span class="lineCov">          4 :     halfRing             = (i == 0 ? ringTopVolume : ringBotVolume);</span>
<span class="lineNum">     472 </span><span class="lineCov">          4 :     Double_t      phi    = 360. / n * i;</span>
<span class="lineNum">     473 </span><span class="lineCov">         12 :     TGeoRotation* rot    = new TGeoRotation(Form(&quot;FMDD%c rotation %d&quot;, id, i));</span>
<span class="lineNum">     474 </span><span class="lineCov">          4 :     rot-&gt;RotateZ(phi);</span>
<span class="lineNum">     475 </span><span class="lineCov">          8 :     rot-&gt;SetTitle(Form(&quot;FMD %s digitiser rotation %2d&quot;, lName, i));</span>
<span class="lineNum">     476 </span><span class="lineCov">          4 :     Double_t z =  zi + ddpt / 2;</span>
<span class="lineNum">     477 </span><span class="lineCov">         12 :     halfRing-&gt;AddNode(fmddPcbVolume, i, new TGeoCombiTrans(0,0,z,rot));</span>
<span class="lineNum">     478 </span><span class="lineCov">          4 :     z          += (ddpt + ddct) / 2;</span>
<span class="lineNum">     479 </span><span class="lineCov">         12 :     halfRing-&gt;AddNode(fmddCuVolume, i, new TGeoCombiTrans(0,0,z,rot));</span>
<span class="lineNum">     480 </span><span class="lineCov">          4 :     z          += (ddct + ddit) / 2;</span>
<span class="lineNum">     481 </span><span class="lineCov">         12 :     halfRing-&gt;AddNode(fmddChipVolume, i, new TGeoCombiTrans(0,0,z,rot));</span>
<span class="lineNum">     482 </span>            :   }
<span class="lineNum">     483 </span>            :   
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span>            :   return 0;
<span class="lineNum">     486 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     487 </span>            : 
<span class="lineNum">     488 </span>            : 
<a name="489"><span class="lineNum">     489 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     490 </span>            : TGeoShape*
<span class="lineNum">     491 </span>            : AliFMDGeometryBuilder::HoneycombShape(Int_t id, Char_t ring,
<span class="lineNum">     492 </span>            :                                       double r1, double r2, 
<span class="lineNum">     493 </span>            :                                       double w, double t, double c)
<span class="lineNum">     494 </span>            : {
<span class="lineNum">     495 </span>            :   // Make a honey comb shape from passed parameters.
<span class="lineNum">     496 </span>            :   // Parameters: 
<span class="lineNum">     497 </span>            :   //   id       Detector identifier (1,2, or 3)
<span class="lineNum">     498 </span>            :   //   ring     Ring identifier ('I' or 'O')
<span class="lineNum">     499 </span>            :   //   r1       Inner radius
<span class="lineNum">     500 </span>            :   //   r2       Outer radius
<span class="lineNum">     501 </span>            :   //   w        width 
<span class="lineNum">     502 </span>            :   //   t        Thickness of material 
<span class="lineNum">     503 </span>            :   //   c        Clearing from horizontal. 
<span class="lineNum">     504 </span>            :   // Return 
<span class="lineNum">     505 </span>            :   //   Pointer to newly allocated composite shape. 
<span class="lineNum">     506 </span><span class="lineCov">         10 :   TString      form  = Form(&quot;FMD%d%c_%%c_%%c&quot;, id, ring);</span>
<span class="lineNum">     507 </span><span class="lineCov">         10 :   double       a1    = TMath::ATan2(c, r1) * 180  / TMath::Pi();</span>
<span class="lineNum">     508 </span>            : 
<span class="lineNum">     509 </span><span class="lineCov">         15 :   TString      fn    = Form(form.Data(),'F','1');</span>
<span class="lineNum">     510 </span><span class="lineCov">         15 :   TString      bn    = Form(form.Data(),'B','1');</span>
<span class="lineNum">     511 </span><span class="lineCov">         15 :   TString      cn    = Form(form.Data(),'C','O');</span>
<span class="lineNum">     512 </span><span class="lineCov">         15 :   TString      in    = Form(form.Data(),'R','I');</span>
<span class="lineNum">     513 </span><span class="lineCov">         15 :   TString      on    = Form(form.Data(),'R','O');</span>
<span class="lineNum">     514 </span><span class="lineCov">         15 :   TString      en    = Form(form.Data(),'E','X');</span>
<span class="lineNum">     515 </span>            :   double       y     = c;
<span class="lineNum">     516 </span><span class="lineCov">          5 :   double       x     = r1 * TMath::Cos(TMath::Pi()*a1/180);</span>
<span class="lineNum">     517 </span><span class="lineCov">         15 :   new TGeoTubeSeg(fn.Data(),r1,r2,t/2,0,180);</span>
<span class="lineNum">     518 </span><span class="lineCov">         15 :   new TGeoTubeSeg(bn.Data(),r1,r2,t/2,0,180);</span>
<span class="lineNum">     519 </span><span class="lineCov">         15 :   new TGeoBBox(cn.Data(),(r2-r1)/2,t/2,w/2);</span>
<span class="lineNum">     520 </span><span class="lineCov">         15 :   new TGeoTubeSeg(in.Data(),r1,r1+t,w/2,0,180);</span>
<span class="lineNum">     521 </span><span class="lineCov">         15 :   new TGeoTubeSeg(on.Data(),r2-t,r2,w/2,0,180);</span>
<span class="lineNum">     522 </span><span class="lineCov">         15 :   new TGeoBBox(en.Data(),r2+.005,c/2+.005,w/2+.005);</span>
<span class="lineNum">     523 </span>            :     
<span class="lineNum">     524 </span><span class="lineCov">         15 :   TString          ftn = Form(form.Data(),'F','T');</span>
<span class="lineNum">     525 </span><span class="lineCov">         15 :   TString          btn = Form(form.Data(),'F','B');</span>
<span class="lineNum">     526 </span><span class="lineCov">         15 :   TString          ltn = Form(form.Data(),'C','L');</span>
<span class="lineNum">     527 </span><span class="lineCov">         15 :   TString          rtn = Form(form.Data(),'C','R');</span>
<span class="lineNum">     528 </span><span class="lineCov">         15 :   TString          etn = Form(form.Data(),'E','X');</span>
<span class="lineNum">     529 </span><span class="lineCov">         20 :   (new TGeoTranslation(ftn.Data(),0,0,+w/2-t/2))-&gt;RegisterYourself();</span>
<span class="lineNum">     530 </span><span class="lineCov">         20 :   (new TGeoTranslation(btn.Data(),0,0,-w/2+t/2))-&gt;RegisterYourself();</span>
<span class="lineNum">     531 </span><span class="lineCov">         20 :   (new TGeoTranslation(ltn.Data(),-(x+(r2-r1)/2), y+t/2,0))-&gt;RegisterYourself();</span>
<span class="lineNum">     532 </span><span class="lineCov">         20 :   (new TGeoTranslation(rtn.Data(),(x+(r2-r1)/2), y+t/2,0))-&gt;RegisterYourself();</span>
<span class="lineNum">     533 </span><span class="lineCov">         20 :   (new TGeoTranslation(etn.Data(),0, c/2,0))-&gt;RegisterYourself();</span>
<span class="lineNum">     534 </span>            :   
<span class="lineNum">     535 </span><span class="lineCov">         15 :   TString comp(Form(&quot;(%s:%s+%s:%s+%s+%s+%s:%s+%s:%s)-%s:%s&quot;, </span>
<span class="lineNum">     536 </span><span class="lineCov">         10 :                     fn.Data(),ftn.Data(),</span>
<span class="lineNum">     537 </span><span class="lineCov">         10 :                     bn.Data(),btn.Data(),</span>
<span class="lineNum">     538 </span><span class="lineCov">         10 :                     in.Data(),on.Data(),</span>
<span class="lineNum">     539 </span><span class="lineCov">         10 :                     cn.Data(),ltn.Data(),</span>
<span class="lineNum">     540 </span><span class="lineCov">         10 :                     cn.Data(),rtn.Data(),</span>
<span class="lineNum">     541 </span><span class="lineCov">         10 :                     en.Data(),etn.Data()));</span>
<span class="lineNum">     542 </span><span class="lineCov">         15 :   TGeoCompositeShape* shape = new TGeoCompositeShape(comp.Data());</span>
<span class="lineNum">     543 </span><span class="lineCov">         10 :   shape-&gt;SetName(Form(fgkHCName,id,ring));</span>
<span class="lineNum">     544 </span><span class="lineCov">         10 :   shape-&gt;SetTitle(Form(&quot;FMD%d%c Honeycomb shape&quot;, id, ring));</span>
<span class="lineNum">     545 </span><span class="lineCov">          5 :   return shape;</span>
<span class="lineNum">     546 </span><span class="lineCov">          5 : }</span>
<span class="lineNum">     547 </span>            : 
<a name="548"><span class="lineNum">     548 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     549 </span>            : TGeoVolume* 
<span class="lineNum">     550 </span>            : AliFMDGeometryBuilder::TensionBox()
<span class="lineNum">     551 </span>            : {
<span class="lineNum">     552 </span>            :   // 
<span class="lineNum">     553 </span>            :   // Get the tension box volume
<span class="lineNum">     554 </span>            :   // 
<span class="lineNum">     555 </span>            :   // 
<span class="lineNum">     556 </span>            :   // Return:
<span class="lineNum">     557 </span>            :   //    
<span class="lineNum">     558 </span>            :   //
<span class="lineNum">     559 </span>            :   static TGeoVolumeAssembly* tensionBox = 0;
<span class="lineNum">     560 </span><span class="lineCov">          5 :   if (tensionBox) return tensionBox;</span>
<span class="lineNum">     561 </span>            :   
<span class="lineNum">     562 </span><span class="lineCov">          1 :   TGeoBBox* tensionEndS = new TGeoBBox(&quot;FMD_tension_end&quot;, .6, 3,  .25);</span>
<span class="lineNum">     563 </span><span class="lineCov">          1 :   TGeoBBox* tensionTopS = new TGeoBBox(&quot;FMD_tension_top&quot;, .1, .5, 3.5);</span>
<span class="lineNum">     564 </span><span class="lineCov">          1 :   TGeoVolume* tensionEndV = new TGeoVolume(&quot;FMD_tension_end&quot;, tensionEndS,fAl);</span>
<span class="lineNum">     565 </span><span class="lineCov">          1 :   TGeoVolume* tensionTopV = new TGeoVolume(&quot;FMD_tension_top&quot;, tensionTopS,fAl);</span>
<span class="lineNum">     566 </span><span class="lineCov">          2 :   tensionBox = new TGeoVolumeAssembly(&quot;FMD_tension_box&quot;);</span>
<span class="lineNum">     567 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionEndV, 1, new TGeoTranslation(.6, 0,   -3.75));</span>
<span class="lineNum">     568 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionEndV, 2, new TGeoTranslation(.6, 0,   +3.75));</span>
<span class="lineNum">     569 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionTopV, 1, new TGeoTranslation(0.1, +2.5, 0));</span>
<span class="lineNum">     570 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionTopV, 2, new TGeoTranslation(0.1, -2.5, 0));</span>
<span class="lineNum">     571 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionTopV, 3, new TGeoTranslation(1.1, +2.5, 0));</span>
<span class="lineNum">     572 </span><span class="lineCov">          2 :   tensionBox-&gt;AddNode(tensionTopV, 4, new TGeoTranslation(1.1, -2.5, 0));</span>
<span class="lineNum">     573 </span><span class="lineCov">          1 :   return tensionBox;</span>
<span class="lineNum">     574 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     575 </span>            : 
<span class="lineNum">     576 </span>            : 
<a name="577"><span class="lineNum">     577 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     578 </span>            : TGeoVolume*
<span class="lineNum">     579 </span>            : AliFMDGeometryBuilder::DetectorGeometry(const AliFMDDetector* d, 
<span class="lineNum">     580 </span>            :                                         TGeoVolume* topMother, 
<span class="lineNum">     581 </span>            :                                         TGeoVolume* botMother, 
<span class="lineNum">     582 </span>            :                                         Double_t    zMother, 
<span class="lineNum">     583 </span>            :                                         TGeoVolume* innerTop, 
<span class="lineNum">     584 </span>            :                                         TGeoVolume* innerBot, 
<span class="lineNum">     585 </span>            :                                         TGeoVolume* outerTop, 
<span class="lineNum">     586 </span>            :                                         TGeoVolume* outerBot) 
<span class="lineNum">     587 </span>            : {
<span class="lineNum">     588 </span>            :   // Common stuff for setting up the FMD1, FMD2, and FMD3 geometries.
<span class="lineNum">     589 </span>            :   // This includes putting the Honeycomb support plates and the rings
<span class="lineNum">     590 </span>            :   // into the mother volumes.   
<span class="lineNum">     591 </span>            :   // 
<span class="lineNum">     592 </span>            :   // Parameeters:
<span class="lineNum">     593 </span>            :   //    d         The detector geometry to use 
<span class="lineNum">     594 </span>            :   //    mother    The mother volume of the detector 
<span class="lineNum">     595 </span>            :   //    zmother   The midpoint in global coordinates of detector vol.
<span class="lineNum">     596 </span>            :   //    inner     Pointer to inner ring volume 
<span class="lineNum">     597 </span>            :   //    outer     Pointer to outer ring volume
<span class="lineNum">     598 </span>            :   //
<span class="lineNum">     599 </span>            :   // Returns:
<span class="lineNum">     600 </span>            :   //    Pointer to mother (detector volume) 
<span class="lineNum">     601 </span>            :   // 
<span class="lineNum">     602 </span><span class="lineCov">          6 :   if (!d) return 0;</span>
<span class="lineNum">     603 </span>            :   // Loop over the defined rings 
<span class="lineNum">     604 </span><span class="lineCov">         18 :   for (int i = 0; i &lt; 2; i++) {</span>
<span class="lineNum">     605 </span>            :     AliFMDRing* r     = 0;
<span class="lineNum">     606 </span>            :     Double_t    lowr  = 0;
<span class="lineNum">     607 </span>            :     Double_t    highr = 0;
<span class="lineNum">     608 </span>            :     Double_t    rz    = 0;
<span class="lineNum">     609 </span>            :     TGeoVolume* tvol  = 0;
<span class="lineNum">     610 </span>            :     TGeoVolume* bvol  = 0;
<span class="lineNum">     611 </span><span class="lineCov">         12 :     switch (i) {</span>
<span class="lineNum">     612 </span>            :     case 0: 
<span class="lineNum">     613 </span><span class="lineCov">          3 :       r      = d-&gt;GetInner();</span>
<span class="lineNum">     614 </span><span class="lineCov">          3 :       lowr   = d-&gt;GetInnerHoneyLowR();</span>
<span class="lineNum">     615 </span><span class="lineCov">          3 :       highr  = d-&gt;GetInnerHoneyHighR();</span>
<span class="lineNum">     616 </span><span class="lineCov">          3 :       rz     = d-&gt;GetInnerZ();</span>
<span class="lineNum">     617 </span>            :       tvol   = innerTop;
<span class="lineNum">     618 </span>            :       bvol   = innerBot;
<span class="lineNum">     619 </span><span class="lineCov">          3 :       break;</span>
<span class="lineNum">     620 </span>            :     case 1: 
<span class="lineNum">     621 </span><span class="lineCov">          3 :       r      = d-&gt;GetOuter();</span>
<span class="lineNum">     622 </span><span class="lineCov">          3 :       lowr   = d-&gt;GetOuterHoneyLowR();</span>
<span class="lineNum">     623 </span><span class="lineCov">          3 :       highr  = d-&gt;GetOuterHoneyHighR();</span>
<span class="lineNum">     624 </span><span class="lineCov">          3 :       rz     = d-&gt;GetOuterZ();</span>
<span class="lineNum">     625 </span>            :       tvol   = outerTop;
<span class="lineNum">     626 </span>            :       bvol   = outerBot;
<span class="lineNum">     627 </span><span class="lineCov">          3 :       break;</span>
<span class="lineNum">     628 </span>            :     }
<span class="lineNum">     629 </span><span class="lineCov">          7 :     if (!r) continue;</span>
<span class="lineNum">     630 </span><span class="lineCov">          5 :     Char_t   c       = r-&gt;GetId();</span>
<span class="lineNum">     631 </span><span class="lineCov">          5 :     Int_t    id      = d-&gt;GetId();</span>
<span class="lineNum">     632 </span><span class="lineCov">          5 :     Double_t hcThick = r-&gt;GetHoneycombThickness();</span>
<span class="lineNum">     633 </span><span class="lineCov">          5 :     Double_t alThick = r-&gt;GetAlThickness();</span>
<span class="lineNum">     634 </span><span class="lineCov">          5 :     Double_t z       = TMath::Abs(rz - zMother);</span>
<span class="lineNum">     635 </span>            : 
<span class="lineNum">     636 </span>            :     // Place ring in mother volume
<span class="lineNum">     637 </span>            :     // TGeoMatrix*matrix=new TGeoTranslation(Form(&quot;FMD%d%c trans&quot;,id,c),0,0,0);
<span class="lineNum">     638 </span><span class="lineCov">         10 :     AliFMDDebug(2, (&quot;Placing volumes %s and %s in %s and %s at z=%f&quot;, </span>
<span class="lineNum">     639 </span>            :                      tvol-&gt;GetName(), bvol-&gt;GetName(), 
<span class="lineNum">     640 </span>            :                      topMother-&gt;GetName(), botMother-&gt;GetName(), z));
<span class="lineNum">     641 </span><span class="lineCov">         10 :     topMother-&gt;AddNode(tvol, Int_t(c), new TGeoTranslation(0,0,z));</span>
<span class="lineNum">     642 </span><span class="lineCov">         10 :     botMother-&gt;AddNode(bvol, Int_t(c), new TGeoTranslation(0,0,z));</span>
<span class="lineNum">     643 </span>            : 
<span class="lineNum">     644 </span>            :     // Honeycomp 
<span class="lineNum">     645 </span><span class="lineCov">          5 :     TGeoShape*   hcSha = HoneycombShape(id, c, lowr, highr, hcThick, alThick);</span>
<span class="lineNum">     646 </span><span class="lineCov">         10 :     TGeoVolume*  hcVol = new TGeoVolume(Form(fgkHCName,id,c),hcSha,fAl);</span>
<span class="lineNum">     647 </span><span class="lineCov">          5 :     hcVol-&gt;SetTitle(Form(&quot;FMD%d%c honeycomb shell&quot;, id, c));</span>
<span class="lineNum">     648 </span>            :     
<span class="lineNum">     649 </span><span class="lineCov">         10 :     z += (r-&gt;GetModuleDepth() </span>
<span class="lineNum">     650 </span><span class="lineCov">          5 :           + r-&gt;GetModuleSpacing() / 2</span>
<span class="lineNum">     651 </span><span class="lineCov">          5 :           + r-&gt;GetHoneycombThickness() / 2);</span>
<span class="lineNum">     652 </span>            : 
<span class="lineNum">     653 </span><span class="lineCov">         10 :     AliFMDDebug(15, (&quot;Placing a copy of %s in %s and %s at z=%f&quot;, </span>
<span class="lineNum">     654 </span>            :                       hcVol-&gt;GetName(), topMother-&gt;GetName(), 
<span class="lineNum">     655 </span>            :                       botMother-&gt;GetName(), z));
<span class="lineNum">     656 </span>            :     // Add to top 
<span class="lineNum">     657 </span><span class="lineCov">         10 :     topMother-&gt;AddNode(hcVol, 0, new TGeoTranslation(0, 0, z));</span>
<span class="lineNum">     658 </span>            : 
<span class="lineNum">     659 </span>            :     // Add to bottom
<span class="lineNum">     660 </span><span class="lineCov">         10 :     TGeoMatrix*   bhcMatrix = new TGeoCombiTrans(0,0,z,0);</span>
<span class="lineNum">     661 </span><span class="lineCov">          5 :     bhcMatrix-&gt;SetName(Form(&quot;FMD%d%c_honeycomp&quot;, id, c));</span>
<span class="lineNum">     662 </span><span class="lineCov">          5 :     bhcMatrix-&gt;SetTitle(Form(&quot;FMD%d%c honeycomp&quot;, id, c));</span>
<span class="lineNum">     663 </span><span class="lineCov">          5 :     bhcMatrix-&gt;RotateZ(180);</span>
<span class="lineNum">     664 </span><span class="lineCov">          5 :     botMother-&gt;AddNode(hcVol, 1, bhcMatrix);</span>
<span class="lineNum">     665 </span><span class="lineCov">          5 :   }</span>
<span class="lineNum">     666 </span><span class="lineCov">          3 :   return 0;</span>
<span class="lineNum">     667 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     668 </span>            : 
<a name="669"><span class="lineNum">     669 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     670 </span>            : TGeoVolume*
<span class="lineNum">     671 </span>            : AliFMDGeometryBuilder::FMD1Geometry(const AliFMD1* fmd1, 
<span class="lineNum">     672 </span>            :                                     TGeoVolume* innerTop, 
<span class="lineNum">     673 </span>            :                                     TGeoVolume* innerBot) 
<span class="lineNum">     674 </span>            : {
<span class="lineNum">     675 </span>            :   // Setup the FMD1 geometry.  The FMD1 only has one ring, and no
<span class="lineNum">     676 </span>            :   // special support as it is at the momement. 
<span class="lineNum">     677 </span>            :   // 
<span class="lineNum">     678 </span>            :   // See also AliFMDGeometryBuilder::DetectorGeometry 
<span class="lineNum">     679 </span>            :   // 
<span class="lineNum">     680 </span><span class="lineCov">          2 :   if (!fmd1 || !innerTop || !innerBot) return 0;</span>
<span class="lineNum">     681 </span><span class="lineCov">          1 :   AliFMDRing* r             = fmd1-&gt;GetInner();</span>
<span class="lineNum">     682 </span><span class="lineCov">          1 :   Double_t    z             = fmd1-&gt;GetInnerZ();  </span>
<span class="lineNum">     683 </span>            :   
<span class="lineNum">     684 </span>            :   // `Top' or `Outside' master volume
<span class="lineNum">     685 </span><span class="lineCov">          1 :   TString fmd1TopName = TString::Format(fgkFMDName, fmd1-&gt;GetId(), 'T');</span>
<span class="lineNum">     686 </span><span class="lineCov">          4 :   TGeoVolume* fmd1TopVolume = new TGeoVolumeAssembly(fmd1TopName);</span>
<span class="lineNum">     687 </span><span class="lineCov">          1 :   fmd1TopVolume-&gt;SetTitle(&quot;FMD1 top half&quot;);</span>
<span class="lineNum">     688 </span>            : 
<span class="lineNum">     689 </span>            :   // `Bottom' or `Inside' master volume
<span class="lineNum">     690 </span><span class="lineCov">          1 :   TString fmd1BotName = TString::Format(fgkFMDName, fmd1-&gt;GetId(), 'B');</span>
<span class="lineNum">     691 </span><span class="lineCov">          4 :   TGeoVolume* fmd1BotVolume = new TGeoVolumeAssembly(fmd1BotName);</span>
<span class="lineNum">     692 </span><span class="lineCov">          1 :   fmd1BotVolume-&gt;SetTitle(&quot;FMD1 bottom half&quot;);</span>
<span class="lineNum">     693 </span>            :   
<span class="lineNum">     694 </span>            :   // Basic detector geometry 
<span class="lineNum">     695 </span><span class="lineCov">          1 :   DetectorGeometry(fmd1, fmd1TopVolume, fmd1BotVolume, z, </span>
<span class="lineNum">     696 </span>            :                    innerTop, innerBot, 0, 0);
<span class="lineNum">     697 </span>            : 
<span class="lineNum">     698 </span><span class="lineCov">          1 :   Double_t lidP[][3] = { {  0.00,  4.20, 20.95 }, </span>
<span class="lineNum">     699 </span>            :                          {  0.15,  4.20, 20.95 }, 
<span class="lineNum">     700 </span>            :                          {  0.15, 20.80, 20.95 }, 
<span class="lineNum">     701 </span>            :                          {  3.00, 20.80, 20.95 }, 
<span class="lineNum">     702 </span>            :                          {  3.00, 20.80, 22.30 }, 
<span class="lineNum">     703 </span>            :                          {  3.15, 20.80, 22.30 }, 
<span class="lineNum">     704 </span>            :                          {  3.15, 20.95, 24.65 },
<span class="lineNum">     705 </span>            :                          {  3.30, 20.95, 24.65 }, 
<span class="lineNum">     706 </span>            :                          {  3.30, 24.50, 24.65 }, 
<span class="lineNum">     707 </span>            :                          {  6.80, 24.50, 24.65 },
<span class="lineNum">     708 </span>            :                          {  6.80, 24.50, 26.00 },
<span class="lineNum">     709 </span>            :                          {  6.95, 24.50, 26.00 } };
<span class="lineNum">     710 </span><span class="lineCov">          1 :   Double_t  lidZStart = lidP[11][0];</span>
<span class="lineNum">     711 </span><span class="lineCov">          2 :   TGeoPcon* lidBaseS  = new TGeoPcon(&quot;FMD1_lid_base&quot;, 0, 180, 12);</span>
<span class="lineNum">     712 </span><span class="lineCov">         26 :   for (size_t i = 0; i &lt; 12; i++) </span>
<span class="lineNum">     713 </span><span class="lineCov">         12 :     lidBaseS-&gt;DefineSection(i, lidP[i][0] - lidZStart, lidP[i][1], lidP[i][2]);</span>
<span class="lineNum">     714 </span>            :   
<span class="lineNum">     715 </span>            :   
<span class="lineNum">     716 </span><span class="lineCov">          1 :   Double_t lidH[][2] = { {  7.84903, 24.15680  }, </span>
<span class="lineNum">     717 </span>            :                          { 20.54900, 14.92970  },
<span class="lineNum">     718 </span>            :                          { 21.99700, 12.70000  },
<span class="lineNum">     719 </span>            :                          { 25.26090,  2.65502  } };
<span class="lineNum">     720 </span>            :   Double_t lidHR = .53 / 2;
<span class="lineNum">     721 </span>            :   Double_t lidHL = 0.16;
<span class="lineNum">     722 </span>            :   
<span class="lineNum">     723 </span><span class="lineCov">          2 :   new TGeoTube(&quot;FMD1_lid_hole&quot;, 0, lidHR, lidHL/2);</span>
<span class="lineNum">     724 </span><span class="lineCov">          1 :   TString lidComp(&quot;FMD1_lid_base-(&quot;);</span>
<span class="lineNum">     725 </span>            :   TGeoTranslation* trans = 0;
<span class="lineNum">     726 </span><span class="lineCov">         10 :   for (size_t i = 0; i &lt; 4; i++) { </span>
<span class="lineNum">     727 </span><span class="lineCov">          8 :     trans = new TGeoTranslation(-lidH[i][0], lidH[i][1], /*6.95*/-lidHL/2);</span>
<span class="lineNum">     728 </span><span class="lineCov">          8 :     trans-&gt;SetName(Form(&quot;FMD1_lid_hole_mat%d&quot;, int(2*i+0)));</span>
<span class="lineNum">     729 </span><span class="lineCov">          4 :     trans-&gt;RegisterYourself();</span>
<span class="lineNum">     730 </span><span class="lineCov">          8 :     trans = new TGeoTranslation(+lidH[i][0], lidH[i][1], /*6.95*/-lidHL/2);</span>
<span class="lineNum">     731 </span><span class="lineCov">          8 :     trans-&gt;SetName(Form(&quot;FMD1_lid_hole_mat%d&quot;, int(2*i+1)));</span>
<span class="lineNum">     732 </span><span class="lineCov">          4 :     trans-&gt;RegisterYourself();</span>
<span class="lineNum">     733 </span><span class="lineCov">          8 :     lidComp.Append(Form(&quot;FMD1_lid_hole:FMD1_lid_hole_mat%d+&quot; </span>
<span class="lineNum">     734 </span>            :                         &quot;FMD1_lid_hole:FMD1_lid_hole_mat%d%c&quot;, 
<span class="lineNum">     735 </span><span class="lineCov">          4 :                         int(2 * i), int(2 * i + 1), int(i == 3 ? ')' : '+')));</span>
<span class="lineNum">     736 </span>            :   }
<span class="lineNum">     737 </span><span class="lineCov">          3 :   TGeoCompositeShape* lidS = new TGeoCompositeShape(lidComp.Data());</span>
<span class="lineNum">     738 </span><span class="lineCov">          1 :   lidS-&gt;SetName(&quot;FMD1_lid&quot;);</span>
<span class="lineNum">     739 </span><span class="lineCov">          2 :   TGeoVolume* lidV = new TGeoVolume(&quot;FMD1_lid&quot;, lidS, fC);</span>
<span class="lineNum">     740 </span><span class="lineCov">          1 :   lidV-&gt;SetTransparency(63);</span>
<span class="lineNum">     741 </span>            :   
<span class="lineNum">     742 </span>            :   // Place top cover
<span class="lineNum">     743 </span><span class="lineCov">          1 :   Double_t lidZ = (lidZStart - </span>
<span class="lineNum">     744 </span><span class="lineCov">          2 :                    (3.3 - r-&gt;GetModuleDepth() - r-&gt;GetModuleSpacing() / 2));</span>
<span class="lineNum">     745 </span><span class="lineCov">          4 :   AliFMDDebug(1, (&quot;FMD1 lid offset in Z=%f&quot;, lidZ));</span>
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span><span class="lineCov">          6 :   for (Int_t i = 0; i  &lt; 2; i++) {</span>
<span class="lineNum">     748 </span><span class="lineCov">          2 :     TGeoVolume*   mother = (i == 0 ? fmd1TopVolume : fmd1BotVolume);</span>
<span class="lineNum">     749 </span><span class="lineCov">          2 :     Double_t      phi    = 360. / 2 * i;</span>
<span class="lineNum">     750 </span><span class="lineCov">          6 :     TGeoRotation* rot    = new TGeoRotation(Form(&quot;FMD1_lid_rot%d&quot;,i));</span>
<span class="lineNum">     751 </span><span class="lineCov">          2 :     rot-&gt;RotateZ(phi);</span>
<span class="lineNum">     752 </span><span class="lineCov">          8 :     TGeoMatrix* matrix   = new TGeoCombiTrans(Form(&quot;FMD1_lid_mat%d&quot;, i),</span>
<span class="lineNum">     753 </span>            :                                               0, 0, lidZ, rot);
<span class="lineNum">     754 </span><span class="lineCov">          2 :     mother-&gt;AddNode(lidV, i, matrix);    </span>
<span class="lineNum">     755 </span>            :   }
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span>            :   // Must add this after filling the assembly.
<span class="lineNum">     758 </span><span class="lineCov">          1 :   TGeoVolume* top    = gGeoManager-&gt;GetVolume(&quot;ALIC&quot;);</span>
<span class="lineNum">     759 </span>            :   // TGeoMatrix* matrix = new TGeoTranslation(&quot;FMD1 trans&quot;, 0, 0, z);
<span class="lineNum">     760 </span><span class="lineCov">          2 :   TGeoRotation* rot = new TGeoRotation(&quot;FMD1 rotatation&quot;);</span>
<span class="lineNum">     761 </span><span class="lineCov">          1 :   rot-&gt;RotateZ(90);</span>
<span class="lineNum">     762 </span><span class="lineCov">          3 :   TGeoMatrix* matrix = new TGeoCombiTrans(&quot;FMD1 trans&quot;, 0, 0, z, rot);</span>
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span><span class="lineCov">          4 :   AliFMDDebug(5, (&quot;Placing volumes %s and %s in ALIC at z=%f&quot;, </span>
<span class="lineNum">     765 </span>            :                    fmd1TopVolume-&gt;GetName(), fmd1BotVolume-&gt;GetName(), z));
<span class="lineNum">     766 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd1TopVolume, fmd1-&gt;GetId(), matrix);</span>
<span class="lineNum">     767 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd1BotVolume, fmd1-&gt;GetId(), matrix);</span>
<span class="lineNum">     768 </span>            : 
<span class="lineNum">     769 </span>            : 
<span class="lineNum">     770 </span>            :   // Survey points on V0A (screw holes for the FMD) 
<span class="lineNum">     771 </span>            :   const Double_t icb[] = { +12.700, -21.997, 324.670 };
<span class="lineNum">     772 </span>            :   const Double_t ict[] = { +12.700, +21.997, 324.670 };
<span class="lineNum">     773 </span>            :   const Double_t ocb[] = { -12.700, -21.997, 324.670 };
<span class="lineNum">     774 </span>            :   const Double_t oct[] = { -12.700, +21.997, 324.670 };
<span class="lineNum">     775 </span>            : 
<span class="lineNum">     776 </span><span class="lineCov">          2 :   TGeoTube* surveyShape = new TGeoTube(&quot;FMD1_survey_marker&quot;, </span>
<span class="lineNum">     777 </span>            :                                         0, .2, .001);
<span class="lineNum">     778 </span>            : 
<span class="lineNum">     779 </span>            :   TGeoMatrix* outMat = matrix;
<span class="lineNum">     780 </span>            : #if 0
<span class="lineNum">     781 </span>            :   if (gGeoManager-&gt;cd(&quot;/ALIC_1/F1MT_1&quot;)) 
<span class="lineNum">     782 </span>            :     outMat = gGeoManager-&gt;GetCurrentMatrix();
<span class="lineNum">     783 </span>            :   else 
<span class="lineNum">     784 </span>            :     AliWarning(&quot;Couldn't cd to /ALIC_1/F1MT_1&quot;);
<span class="lineNum">     785 </span>            : #endif
<span class="lineNum">     786 </span>            : 
<span class="lineNum">     787 </span><span class="lineCov">          1 :   Double_t loct[3], locb[3];</span>
<span class="lineNum">     788 </span><span class="lineCov">          1 :   outMat-&gt;MasterToLocal(oct, loct);</span>
<span class="lineNum">     789 </span><span class="lineCov">          1 :   outMat-&gt;MasterToLocal(ocb, locb);</span>
<span class="lineNum">     790 </span><span class="lineCov">          2 :   TGeoVolume* vOct = new TGeoVolume(&quot;V0L_OCT&quot;, surveyShape, fPlastic);</span>
<span class="lineNum">     791 </span><span class="lineCov">          2 :   TGeoVolume* vOcb = new TGeoVolume(&quot;V0L_OCB&quot;, surveyShape, fPlastic);</span>
<span class="lineNum">     792 </span>            :   
<span class="lineNum">     793 </span><span class="lineCov">          3 :   fmd1TopVolume-&gt;AddNode(vOct, 1, new TGeoTranslation(loct[0],loct[1],loct[2]));</span>
<span class="lineNum">     794 </span><span class="lineCov">          3 :   fmd1TopVolume-&gt;AddNode(vOcb, 1, new TGeoTranslation(locb[0],locb[1],locb[2]));</span>
<span class="lineNum">     795 </span>            :     
<span class="lineNum">     796 </span>            :   
<span class="lineNum">     797 </span>            :   TGeoMatrix* inMat = matrix;
<span class="lineNum">     798 </span>            : #if 0
<span class="lineNum">     799 </span>            :   if (gGeoManager-&gt;cd(&quot;/ALIC_1/F1MT_1&quot;)) 
<span class="lineNum">     800 </span>            :     inMat = gGeoManager-&gt;GetCurrentMatrix();
<span class="lineNum">     801 </span>            :   else 
<span class="lineNum">     802 </span>            :     AliWarning(&quot;Couldn't cd to /ALIC_1/F1MT_1&quot;);
<span class="lineNum">     803 </span>            : #endif
<span class="lineNum">     804 </span>            : 
<span class="lineNum">     805 </span><span class="lineCov">          1 :   Double_t lict[3], licb[3];</span>
<span class="lineNum">     806 </span><span class="lineCov">          1 :   inMat-&gt;MasterToLocal(ict, lict);</span>
<span class="lineNum">     807 </span><span class="lineCov">          1 :   inMat-&gt;MasterToLocal(icb, licb);</span>
<span class="lineNum">     808 </span><span class="lineCov">          2 :   TGeoVolume* vIct = new TGeoVolume(&quot;V0L_ICT&quot;, surveyShape, fPlastic);</span>
<span class="lineNum">     809 </span><span class="lineCov">          2 :   TGeoVolume* vIcb = new TGeoVolume(&quot;V0L_ICB&quot;, surveyShape, fPlastic);</span>
<span class="lineNum">     810 </span>            :   
<span class="lineNum">     811 </span><span class="lineCov">          3 :   fmd1BotVolume-&gt;AddNode(vIct, 1, new TGeoTranslation(lict[0],lict[1],lict[2]));</span>
<span class="lineNum">     812 </span><span class="lineCov">          3 :   fmd1BotVolume-&gt;AddNode(vIcb, 1, new TGeoTranslation(licb[0],licb[1],licb[2]));</span>
<span class="lineNum">     813 </span>            : 
<span class="lineNum">     814 </span>            :   return 0;
<span class="lineNum">     815 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     816 </span>            : 
<a name="817"><span class="lineNum">     817 </span>            : //____________________________________________________________________</a>
<span class="lineNum">     818 </span>            : TGeoVolume*
<span class="lineNum">     819 </span>            : AliFMDGeometryBuilder::FMD2Geometry(const AliFMD2* fmd2, 
<span class="lineNum">     820 </span>            :                                     TGeoVolume* innerTop, 
<span class="lineNum">     821 </span>            :                                     TGeoVolume* innerBot, 
<span class="lineNum">     822 </span>            :                                     TGeoVolume* outerTop,
<span class="lineNum">     823 </span>            :                                     TGeoVolume* outerBot) 
<span class="lineNum">     824 </span>            : {
<span class="lineNum">     825 </span>            :   // Setup the FMD2 geometry.  The FMD2 has no
<span class="lineNum">     826 </span>            :   // special support as it is at the momement. 
<span class="lineNum">     827 </span>            :   // 
<span class="lineNum">     828 </span>            :   // See also AliFMDGeometryBuilder::DetectorGeometry 
<span class="lineNum">     829 </span>            :   // 
<span class="lineNum">     830 </span><span class="lineCov">          2 :   if (!fmd2 || !innerTop || !innerBot || !outerTop || !outerBot) return 0;</span>
<span class="lineNum">     831 </span><span class="lineCov">          1 :   AliFMDRing* ring          = fmd2-&gt;GetOuter();</span>
<span class="lineNum">     832 </span><span class="lineCov">          1 :   Double_t    z             = fmd2-&gt;GetOuterZ();  </span>
<span class="lineNum">     833 </span>            :   Double_t    framelr       = 32.01;  // fmd2-&gt;GetOuterHoneyHighR()+0.5;
<span class="lineNum">     834 </span>            :   Double_t    framehr       = 33.611; // fmd2-&gt;GetOuterHoneyHighR()+1.8;
<span class="lineNum">     835 </span>            :   Double_t    framel        = 14.8; // framehz - framelz;
<span class="lineNum">     836 </span>            :   // Double_t    backth        = 0.3;
<span class="lineNum">     837 </span>            :   Double_t    backth        = 0.03;
<span class="lineNum">     838 </span><span class="lineCov">          1 :   Double_t    framelz       = -(2.38 </span>
<span class="lineNum">     839 </span><span class="lineCov">          1 :                                 - ring-&gt;GetModuleDepth() </span>
<span class="lineNum">     840 </span><span class="lineCov">          1 :                                 - ring-&gt;GetModuleSpacing() / 2);</span>
<span class="lineNum">     841 </span>            :   // Double_t    framelz       = -0.8;
<span class="lineNum">     842 </span>            :   // Double_t    framehz       = framelz + backth + framel;
<span class="lineNum">     843 </span>            :   Double_t    coverlr       = 4.3; // fmd2-&gt;GetInner()-&gt;GetLowR()+1;
<span class="lineNum">     844 </span>            :   Double_t    coverhr       = framehr; //  - 1;
<span class="lineNum">     845 </span>            :   
<span class="lineNum">     846 </span><span class="lineCov">          1 :   TString fmd2TopName = TString::Format(fgkFMDName, fmd2-&gt;GetId(), 'T');</span>
<span class="lineNum">     847 </span><span class="lineCov">          4 :   TGeoVolume* fmd2TopVolume = new TGeoVolumeAssembly(fmd2TopName);</span>
<span class="lineNum">     848 </span><span class="lineCov">          1 :   TString fmd2BotName = TString::Format(fgkFMDName, fmd2-&gt;GetId(), 'B');</span>
<span class="lineNum">     849 </span><span class="lineCov">          4 :   TGeoVolume* fmd2BotVolume = new TGeoVolumeAssembly(fmd2BotName);</span>
<span class="lineNum">     850 </span><span class="lineCov">          1 :   fmd2TopVolume-&gt;SetTitle(&quot;FMD2 top half&quot;);</span>
<span class="lineNum">     851 </span><span class="lineCov">          1 :   fmd2BotVolume-&gt;SetTitle(&quot;FMD2 bottom half&quot;);</span>
<span class="lineNum">     852 </span>            :   
<span class="lineNum">     853 </span><span class="lineCov">          1 :   DetectorGeometry(fmd2, fmd2TopVolume, fmd2BotVolume, z, </span>
<span class="lineNum">     854 </span>            :                    innerTop, innerBot, outerTop, outerBot);
<span class="lineNum">     855 </span>            : 
<span class="lineNum">     856 </span><span class="lineCov">          2 :   TGeoVolumeAssembly* support = new TGeoVolumeAssembly(&quot;FMD2_support&quot;);</span>
<span class="lineNum">     857 </span><span class="lineCov">          3 :   TGeoShape*  cylinderShape   = new TGeoTubeSeg(framelr,framehr,framel/2,0,180);</span>
<span class="lineNum">     858 </span><span class="lineCov">          3 :   TGeoVolume* cylinderVolume  = new TGeoVolume(Form(fgkBackName, fmd2-&gt;GetId()),</span>
<span class="lineNum">     859 </span><span class="lineCov">          1 :                                                cylinderShape, fC);</span>
<span class="lineNum">     860 </span><span class="lineCov">          3 :   TGeoShape*  coverShape      = new TGeoTubeSeg(coverlr,coverhr,backth/2,0,180);</span>
<span class="lineNum">     861 </span><span class="lineCov">          3 :   TGeoVolume* coverVolume     = new TGeoVolume(Form(fgkTopName, fmd2-&gt;GetId()), </span>
<span class="lineNum">     862 </span><span class="lineCov">          1 :                                                coverShape, fC);</span>
<span class="lineNum">     863 </span><span class="lineCov">          2 :   cylinderShape-&gt;SetName(Form(fgkBackName, fmd2-&gt;GetId()));</span>
<span class="lineNum">     864 </span><span class="lineCov">          1 :   cylinderShape-&gt;SetTitle(&quot;FMD2 cylinder&quot;);</span>
<span class="lineNum">     865 </span><span class="lineCov">          1 :   cylinderVolume-&gt;SetTitle(&quot;FMD2 cylinder&quot;);</span>
<span class="lineNum">     866 </span><span class="lineCov">          1 :   cylinderVolume-&gt;SetTransparency(63);</span>
<span class="lineNum">     867 </span><span class="lineCov">          2 :   coverShape-&gt;SetName(Form(fgkTopName, fmd2-&gt;GetId()));</span>
<span class="lineNum">     868 </span><span class="lineCov">          1 :   coverShape-&gt;SetTitle(&quot;FMD2 cover&quot;);</span>
<span class="lineNum">     869 </span><span class="lineCov">          1 :   coverVolume-&gt;SetTitle(&quot;FMD2 cover&quot;);</span>
<span class="lineNum">     870 </span><span class="lineCov">          1 :   coverVolume-&gt;SetTransparency(63);</span>
<span class="lineNum">     871 </span>            :   
<span class="lineNum">     872 </span>            :   TGeoTranslation* trans = 0;
<span class="lineNum">     873 </span><span class="lineCov">          3 :   support-&gt;AddNode(coverVolume,1, new TGeoTranslation(0,0,backth/2));</span>
<span class="lineNum">     874 </span><span class="lineCov">          3 :   support-&gt;AddNode(cylinderVolume, 1, new TGeoTranslation(0,0,backth+framel/2));</span>
<span class="lineNum">     875 </span>            :   
<span class="lineNum">     876 </span>            : 
<span class="lineNum">     877 </span>            :   Double_t    f1l            = 15.6085;
<span class="lineNum">     878 </span>            :   Double_t    f1w            = 6;
<span class="lineNum">     879 </span>            :   Double_t    f1d            = 1;
<span class="lineNum">     880 </span>            :   Int_t       nFiducialHoles = 4;
<span class="lineNum">     881 </span><span class="lineCov">          1 :   Double_t    precHoles[][2] = { { 32.4948, 29.6663 },</span>
<span class="lineNum">     882 </span>            :                                  { 33.9104, 31.0819 },
<span class="lineNum">     883 </span>            :                                  { 34.8177, 33.4035 }, 
<span class="lineNum">     884 </span>            :                                  { 35.5028, 32.6744 } };
<span class="lineNum">     885 </span>            :   Double_t    precRadius     = .25;
<span class="lineNum">     886 </span><span class="lineCov">          1 :   Double_t    flangeA        = TMath::Pi()/4;</span>
<span class="lineNum">     887 </span>            :   
<span class="lineNum">     888 </span><span class="lineCov">          2 :   new TGeoBBox(&quot;FMD2_flange_base&quot;, f1l/2, f1w/2, f1d/2);</span>
<span class="lineNum">     889 </span><span class="lineCov">          2 :   new TGeoTube(&quot;FMD2_fiducial_hole&quot;, 0, precRadius, f1d/2+.1);</span>
<span class="lineNum">     890 </span><span class="lineCov">          1 :   Double_t         flangeX        = framehr + f1l/2;</span>
<span class="lineNum">     891 </span><span class="lineCov">          2 :   TVector2         flangeC(flangeX * TMath::Cos(flangeA), </span>
<span class="lineNum">     892 </span><span class="lineCov">          1 :                            flangeX * TMath::Sin(flangeA));</span>
<span class="lineNum">     893 </span><span class="lineCov">          1 :   TString          flangeComb(&quot;FMD2_flange_base-(&quot;);  </span>
<span class="lineNum">     894 </span><span class="lineCov">          2 :   new TGeoBBox(&quot;FMD2_flange_slit&quot;, 7./2, 1.5/2, f1d/2+.1);</span>
<span class="lineNum">     895 </span><span class="lineCov">          2 :   trans = new TGeoTranslation(-f1l/2+1+7./2, +.5+1.5/2, 0);</span>
<span class="lineNum">     896 </span><span class="lineCov">          1 :   trans-&gt;SetName(&quot;FMD2_flange_slit_mat1&quot;);</span>
<span class="lineNum">     897 </span><span class="lineCov">          1 :   trans-&gt;RegisterYourself();</span>
<span class="lineNum">     898 </span><span class="lineCov">          2 :   trans = new TGeoTranslation(-f1l/2+1+7./2, -.5-1.5/2, 0);</span>
<span class="lineNum">     899 </span><span class="lineCov">          1 :   trans-&gt;SetName(&quot;FMD2_flange_slit_mat2&quot;);</span>
<span class="lineNum">     900 </span><span class="lineCov">          1 :   trans-&gt;RegisterYourself();</span>
<span class="lineNum">     901 </span><span class="lineCov">          1 :   flangeComb.Append(&quot;FMD2_flange_slit:FMD2_flange_slit_mat1+&quot;</span>
<span class="lineNum">     902 </span>            :                     &quot;FMD2_flange_slit:FMD2_flange_slit_mat2+&quot;);
<span class="lineNum">     903 </span><span class="lineCov">         10 :   for (Int_t i = 0; i &lt; nFiducialHoles; i++) { </span>
<span class="lineNum">     904 </span><span class="lineCov">          4 :     TVector2         v(precHoles[i][0], precHoles[i][1]);</span>
<span class="lineNum">     905 </span><span class="lineCov">          4 :     v                   -= flangeC;</span>
<span class="lineNum">     906 </span><span class="lineCov">          4 :     TVector2         r  =  v.Rotate(-flangeA);</span>
<span class="lineNum">     907 </span><span class="lineCov">          8 :     TGeoTranslation* t1 =  new TGeoTranslation(r.X(),  r.Y(), 0);</span>
<span class="lineNum">     908 </span><span class="lineCov">          8 :     TGeoTranslation* t2 =  new TGeoTranslation(r.X(), -r.Y(), 0);</span>
<span class="lineNum">     909 </span><span class="lineCov">          8 :     t1-&gt;SetName(Form(&quot;FMD2_fiducial_hole_rot%d&quot;, 2*i+0));</span>
<span class="lineNum">     910 </span><span class="lineCov">          8 :     t2-&gt;SetName(Form(&quot;FMD2_fiducial_hole_rot%d&quot;, 2*i+1));</span>
<span class="lineNum">     911 </span><span class="lineCov">          4 :     t1-&gt;RegisterYourself();</span>
<span class="lineNum">     912 </span><span class="lineCov">          4 :     t2-&gt;RegisterYourself();</span>
<span class="lineNum">     913 </span><span class="lineCov">          8 :     flangeComb.Append(Form(&quot;FMD2_fiducial_hole:FMD2_fiducial_hole_rot%d+&quot;</span>
<span class="lineNum">     914 </span>            :                            &quot;FMD2_fiducial_hole:FMD2_fiducial_hole_rot%d%c&quot;,
<span class="lineNum">     915 </span><span class="lineCov">          4 :                            2*i+0, 2*i+1, (i == nFiducialHoles-1 ? ')' : '+')));</span>
<span class="lineNum">     916 </span><span class="lineCov">          4 :   }</span>
<span class="lineNum">     917 </span>            :   // Final flange shape, and at to full shape 
<span class="lineNum">     918 </span><span class="lineCov">          3 :   TGeoCompositeShape* flangeS = new TGeoCompositeShape(flangeComb.Data());</span>
<span class="lineNum">     919 </span><span class="lineCov">          1 :   flangeS-&gt;SetName(&quot;FMD2_flange&quot;);</span>
<span class="lineNum">     920 </span><span class="lineCov">          2 :   TGeoVolume* flangeV = new TGeoVolume(&quot;FMD2_flange&quot;, flangeS, fAl);</span>
<span class="lineNum">     921 </span>            :   
<span class="lineNum">     922 </span>            :   Double_t f2l = 7;
<span class="lineNum">     923 </span>            :   Double_t f2d = 12.5;
<span class="lineNum">     924 </span>            :   Double_t f2w = 1;
<span class="lineNum">     925 </span>            : 
<span class="lineNum">     926 </span><span class="lineCov">          2 :   new TGeoBBox(&quot;FMD2_flange_spacer_base&quot;, f2l/2, f2w/2, f2d/2);</span>
<span class="lineNum">     927 </span><span class="lineCov">          2 :   new TGeoTube(&quot;FMD2_flange_spacer_hole&quot;, 0, 2.5, f2w/2+.1);</span>
<span class="lineNum">     928 </span><span class="lineCov">          2 :   TGeoRotation* holeRot = new TGeoRotation();</span>
<span class="lineNum">     929 </span><span class="lineCov">          1 :   holeRot-&gt;RotateY(90);</span>
<span class="lineNum">     930 </span><span class="lineCov">          1 :   holeRot-&gt;RotateZ(90);</span>
<span class="lineNum">     931 </span>            :   TGeoCombiTrans* combo = 0;
<span class="lineNum">     932 </span><span class="lineCov">          2 :   combo = new TGeoCombiTrans(0, 0, f2d/2-.5-2.5, holeRot);</span>
<span class="lineNum">     933 </span><span class="lineCov">          1 :   combo-&gt;SetName(&quot;FMD2_flange_spacer_hole_mat1&quot;);</span>
<span class="lineNum">     934 </span><span class="lineCov">          1 :   combo-&gt;RegisterYourself();</span>
<span class="lineNum">     935 </span><span class="lineCov">          2 :   combo = new TGeoCombiTrans(0, 0, -f2d/2+.5+2.5, holeRot);</span>
<span class="lineNum">     936 </span><span class="lineCov">          1 :   combo-&gt;SetName(&quot;FMD2_flange_spacer_hole_mat2&quot;);</span>
<span class="lineNum">     937 </span><span class="lineCov">          1 :   combo-&gt;RegisterYourself();</span>
<span class="lineNum">     938 </span><span class="lineCov">          1 :   TString spacerComp(&quot;FMD2_flange_spacer_base-(&quot;</span>
<span class="lineNum">     939 </span>            :                      &quot;FMD2_flange_spacer_hole:FMD2_flange_spacer_hole_mat1+&quot;
<span class="lineNum">     940 </span>            :                      &quot;FMD2_flange_spacer_hole:FMD2_flange_spacer_hole_mat2)&quot;);
<span class="lineNum">     941 </span><span class="lineCov">          3 :   TGeoCompositeShape* spacerS = new TGeoCompositeShape(spacerComp.Data());</span>
<span class="lineNum">     942 </span><span class="lineCov">          3 :   TGeoVolume*         spacerV = new TGeoVolume(&quot;FMD2_flange_spacer&quot;,</span>
<span class="lineNum">     943 </span><span class="lineCov">          1 :                                                spacerS, fAl);</span>
<span class="lineNum">     944 </span>            : 
<span class="lineNum">     945 </span>            :   Double_t            extraL  = framehr-framelr;
<span class="lineNum">     946 </span><span class="lineCov">          3 :   TGeoBBox*           extraS  = new TGeoBBox(&quot;FMD2_flange_extra&quot;, </span>
<span class="lineNum">     947 </span><span class="lineCov">          1 :                                              extraL/2, f1w/2, f1d/2);</span>
<span class="lineNum">     948 </span><span class="lineCov">          2 :   TGeoVolume*         extraV  = new TGeoVolume(&quot;FMD2_flange_extra&quot;, extraS,fAl);</span>
<span class="lineNum">     949 </span><span class="lineCov">          2 :   TGeoVolumeAssembly* wingV   = new TGeoVolumeAssembly(&quot;FMD2_wing&quot;);</span>
<span class="lineNum">     950 </span><span class="lineCov">          1 :   TGeoVolume*         tension = TensionBox();</span>
<span class="lineNum">     951 </span><span class="lineCov">          2 :   TGeoTube*           wireS   = new TGeoTube(0, .05, (framehr-coverlr)/2);</span>
<span class="lineNum">     952 </span><span class="lineCov">          3 :   TGeoVolume*         wireV   = new TGeoVolume(&quot;FMD2_tension_wire&quot;, </span>
<span class="lineNum">     953 </span><span class="lineCov">          1 :                                                wireS, fSteel);</span>
<span class="lineNum">     954 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(flangeV, 1, new TGeoTranslation(f1l/2,    0, f1d/2));</span>
<span class="lineNum">     955 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(flangeV, 2, new TGeoTranslation(f1l/2,    0, -f2d-f1d/2));</span>
<span class="lineNum">     956 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(extraV, 1, new TGeoCombiTrans(-extraL/2, 0, f1d/2, 0));</span>
<span class="lineNum">     957 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(spacerV, 1, new TGeoTranslation(1+f2l/2,-f2w/2+f1w/2,</span>
<span class="lineNum">     958 </span>            :                                                  -f2d/2));
<span class="lineNum">     959 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(spacerV, 2, new TGeoTranslation(1+f2l/2,+f2w/2-f1w/2,</span>
<span class="lineNum">     960 </span>            :                                                  -f2d/2));
<span class="lineNum">     961 </span><span class="lineCov">          2 :   TGeoRotation* tensionR = new TGeoRotation;</span>
<span class="lineNum">     962 </span><span class="lineCov">          1 :   tensionR-&gt;RotateY(90);</span>
<span class="lineNum">     963 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(tension, 1, new TGeoCombiTrans(4, 0, f1d+1.2, tensionR));</span>
<span class="lineNum">     964 </span><span class="lineCov">          2 :   TGeoRotation* wireR = new TGeoRotation;</span>
<span class="lineNum">     965 </span><span class="lineCov">          1 :   wireR-&gt;RotateY(90);</span>
<span class="lineNum">     966 </span><span class="lineCov">          3 :   wingV-&gt;AddNode(wireV, 1, new TGeoCombiTrans(-(framehr-coverlr)/2, 0, f1d+1,</span>
<span class="lineNum">     967 </span>            :                                               wireR));
<span class="lineNum">     968 </span>            :   
<span class="lineNum">     969 </span><span class="lineCov">          2 :   TGeoCombiTrans* extraM1 = new TGeoCombiTrans(coverhr-extraL/2,0,0,0);</span>
<span class="lineNum">     970 </span><span class="lineCov">          1 :   extraM1-&gt;RotateZ(45);</span>
<span class="lineNum">     971 </span><span class="lineCov">          1 :   extraM1-&gt;RegisterYourself();</span>
<span class="lineNum">     972 </span><span class="lineCov">          1 :   extraM1-&gt;SetName(&quot;FMD2_back_cover_slit1&quot;);</span>
<span class="lineNum">     973 </span><span class="lineCov">          2 :   TGeoCombiTrans* extraM2 = new TGeoCombiTrans(coverhr-extraL/2,0,0,0);</span>
<span class="lineNum">     974 </span><span class="lineCov">          1 :   extraM2-&gt;RotateZ(135);</span>
<span class="lineNum">     975 </span><span class="lineCov">          1 :   extraM2-&gt;RegisterYourself();</span>
<span class="lineNum">     976 </span><span class="lineCov">          1 :   extraM2-&gt;SetName(&quot;FMD2_back_cover_slit2&quot;);</span>
<span class="lineNum">     977 </span><span class="lineCov">          2 :   TString coverComp(Form(fgkTopName, fmd2-&gt;GetId()));</span>
<span class="lineNum">     978 </span><span class="lineCov">          1 :   coverComp.Append(&quot;-(FMD2_flange_extra:FMD2_back_cover_slit1&quot;</span>
<span class="lineNum">     979 </span>            :                    &quot;+FMD2_flange_extra:FMD2_back_cover_slit2)&quot;);
<span class="lineNum">     980 </span><span class="lineCov">          3 :   TGeoCompositeShape* cover2Shape = new TGeoCompositeShape(coverComp.Data());</span>
<span class="lineNum">     981 </span><span class="lineCov">          1 :   cover2Shape-&gt;SetName(&quot;FMD2_back_cover&quot;);</span>
<span class="lineNum">     982 </span><span class="lineCov">          2 :   TGeoVolume* cover2Volume = new TGeoVolume(&quot;FMD2_back_cover&quot;, cover2Shape,fC);</span>
<span class="lineNum">     983 </span><span class="lineCov">          2 :   support-&gt;AddNode(cover2Volume,2, </span>
<span class="lineNum">     984 </span><span class="lineCov">          3 :                    new TGeoTranslation(0,0,backth+framel+backth/2));</span>
<span class="lineNum">     985 </span>            : 
<span class="lineNum">     986 </span><span class="lineCov">          2 :   TGeoCombiTrans* trans1 = new TGeoCombiTrans(framehr, 0, backth+framel, 0);</span>
<span class="lineNum">     987 </span><span class="lineCov">          2 :   TGeoCombiTrans* trans2 = new TGeoCombiTrans(framehr, 0, backth+framel, 0);</span>
<span class="lineNum">     988 </span><span class="lineCov">          1 :   trans1-&gt;RotateZ(45);</span>
<span class="lineNum">     989 </span><span class="lineCov">          1 :   trans2-&gt;RotateZ(135);</span>
<span class="lineNum">     990 </span><span class="lineCov">          1 :   support-&gt;AddNode(wingV, 1, trans1);</span>
<span class="lineNum">     991 </span><span class="lineCov">          1 :   support-&gt;AddNode(wingV, 2, trans2);</span>
<span class="lineNum">     992 </span><span class="lineCov">          4 :   AliFMDDebug(1, (&quot;FMD2 support offset is %f&quot;, framelz));</span>
<span class="lineNum">     993 </span>            :   
<span class="lineNum">     994 </span><span class="lineCov">          6 :   for (Int_t i = 0; i  &lt; 2; i++) {</span>
<span class="lineNum">     995 </span><span class="lineCov">          2 :     TGeoVolume*   mother = (i &lt; 1 ? fmd2TopVolume : fmd2BotVolume);</span>
<span class="lineNum">     996 </span>            :     
<span class="lineNum">     997 </span><span class="lineCov">          2 :     Double_t      phi    = 360. / 2 * i;</span>
<span class="lineNum">     998 </span><span class="lineCov">          6 :     TGeoRotation* rot    = new TGeoRotation(Form(&quot;FMD2 support rot %d&quot;,i)); </span>
<span class="lineNum">     999 </span><span class="lineCov">          2 :     rot-&gt;RotateZ(phi);</span>
<span class="lineNum">    1000 </span><span class="lineCov">          6 :     TGeoMatrix*   matrix = new TGeoCombiTrans(0, 0, framelz, rot);</span>
<span class="lineNum">    1001 </span><span class="lineCov">          2 :     mother-&gt;AddNode(support, i, matrix);    </span>
<span class="lineNum">    1002 </span>            :   }
<span class="lineNum">    1003 </span>            :   
<span class="lineNum">    1004 </span>            :   // Must be done after filling the assemblies 
<span class="lineNum">    1005 </span><span class="lineCov">          1 :   TGeoVolume* top = gGeoManager-&gt;GetVolume(&quot;ALIC&quot;);</span>
<span class="lineNum">    1006 </span><span class="lineCov">          3 :   TGeoMatrix* matrix = new TGeoTranslation(&quot;FMD2 trans&quot;, 0, 0, z);</span>
<span class="lineNum">    1007 </span><span class="lineCov">          4 :   AliFMDDebug(5, (&quot;Placing volumes %s and %s in ALIC at z=%f&quot;, </span>
<span class="lineNum">    1008 </span>            :                    fmd2TopVolume-&gt;GetName(), fmd2BotVolume-&gt;GetName(), z));
<span class="lineNum">    1009 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd2TopVolume, fmd2-&gt;GetId(), matrix);</span>
<span class="lineNum">    1010 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd2BotVolume, fmd2-&gt;GetId(), matrix);</span>
<span class="lineNum">    1011 </span>            : 
<span class="lineNum">    1012 </span>            : 
<span class="lineNum">    1013 </span>            :   return 0;
<span class="lineNum">    1014 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">    1015 </span>            :   
<a name="1016"><span class="lineNum">    1016 </span>            : //____________________________________________________________________</a>
<span class="lineNum">    1017 </span>            : TGeoVolume*
<span class="lineNum">    1018 </span>            : AliFMDGeometryBuilder::FMD3Geometry(const AliFMD3* fmd3, 
<span class="lineNum">    1019 </span>            :                                     TGeoVolume* innerTop, 
<span class="lineNum">    1020 </span>            :                                     TGeoVolume* innerBot, 
<span class="lineNum">    1021 </span>            :                                     TGeoVolume* outerTop,
<span class="lineNum">    1022 </span>            :                                     TGeoVolume* outerBot) 
<span class="lineNum">    1023 </span>            : {
<span class="lineNum">    1024 </span>            :   // Setup the FMD3 geometry.  The FMD2 has a rather elaborate support
<span class="lineNum">    1025 </span>            :   // structure, as the support will also support the vacuum
<span class="lineNum">    1026 </span>            :   // beam-pipe. 
<span class="lineNum">    1027 </span>            :   // 
<span class="lineNum">    1028 </span>            :   // See also AliFMDGeometryBuilder::DetectorGeometry 
<span class="lineNum">    1029 </span>            :   // 
<span class="lineNum">    1030 </span><span class="lineCov">          2 :   if (!fmd3 || !innerTop || !innerBot || !outerTop || !outerBot) return 0;</span>
<span class="lineNum">    1031 </span>            : 
<span class="lineNum">    1032 </span>            :   //__________________________________________________________________
<span class="lineNum">    1033 </span>            :   // Basic detector set-up.
<span class="lineNum">    1034 </span><span class="lineCov">          1 :   TString fmd3TopName = TString::Format(fgkFMDName, fmd3-&gt;GetId(), 'T');</span>
<span class="lineNum">    1035 </span><span class="lineCov">          4 :   TGeoVolume* fmd3TopVolume = new TGeoVolumeAssembly(fmd3TopName);</span>
<span class="lineNum">    1036 </span><span class="lineCov">          1 :   TString fmd3BotName = TString::Format(fgkFMDName, fmd3-&gt;GetId(), 'B');</span>
<span class="lineNum">    1037 </span><span class="lineCov">          4 :   TGeoVolume* fmd3BotVolume = new TGeoVolumeAssembly(fmd3BotName);</span>
<span class="lineNum">    1038 </span><span class="lineCov">          1 :   fmd3TopVolume-&gt;SetTitle(&quot;FMD3 top half&quot;);</span>
<span class="lineNum">    1039 </span><span class="lineCov">          1 :   fmd3BotVolume-&gt;SetTitle(&quot;FMD3 bottom half&quot;);</span>
<span class="lineNum">    1040 </span><span class="lineCov">          1 :   DetectorGeometry(fmd3, fmd3TopVolume, fmd3BotVolume, fmd3-&gt;GetInnerZ(), </span>
<span class="lineNum">    1041 </span>            :                    innerTop, innerBot, outerTop, outerBot);
<span class="lineNum">    1042 </span>            : 
<span class="lineNum">    1043 </span>            :   //__________________________________________________________________
<span class="lineNum">    1044 </span>            :   // Mother for all support material
<span class="lineNum">    1045 </span><span class="lineCov">          2 :   TGeoVolumeAssembly* support = new TGeoVolumeAssembly(&quot;F3SU&quot;);</span>
<span class="lineNum">    1046 </span><span class="lineCov">          1 :   support-&gt;SetTitle(&quot;FMD3 support&quot;);</span>
<span class="lineNum">    1047 </span>            : 
<span class="lineNum">    1048 </span>            :   //__________________________________________________________________
<span class="lineNum">    1049 </span>            :   // Base of cone
<span class="lineNum">    1050 </span><span class="lineCov">          1 :   const TObjArray&amp; radii    = fmd3-&gt;ConeRadii();</span>
<span class="lineNum">    1051 </span><span class="lineCov">          1 :   Int_t            nRadii   = radii.GetEntriesFast();</span>
<span class="lineNum">    1052 </span><span class="lineCov">          2 :   TGeoPcon*        coneBase = new TGeoPcon(&quot;FMD3_cone_base&quot;, 0., 180., nRadii);</span>
<span class="lineNum">    1053 </span>            :   TVector3*        r5       = 0;
<span class="lineNum">    1054 </span>            :   TVector3*        r4       = 0;
<span class="lineNum">    1055 </span><span class="lineCov">         14 :   for (Int_t i = 0; i &lt; nRadii; i++) { </span>
<span class="lineNum">    1056 </span><span class="lineCov">         12 :     TVector3* v = static_cast&lt;TVector3*&gt;(radii.At(i));</span>
<span class="lineNum">    1057 </span><span class="lineCov">          6 :     coneBase-&gt;DefineSection(i, v-&gt;X(), v-&gt;Y(), v-&gt;Z());</span>
<span class="lineNum">    1058 </span><span class="lineCov">          7 :     if      (i == 5) r5 = v;</span>
<span class="lineNum">    1059 </span><span class="lineCov">          6 :     else if (i == 4) r4 = v;</span>
<span class="lineNum">    1060 </span>            :   }
<span class="lineNum">    1061 </span><span class="lineCov">          1 :   TString          coneComb(&quot;(FMD3_cone_base&quot;);</span>
<span class="lineNum">    1062 </span>            : 
<span class="lineNum">    1063 </span>            :   //__________________________________________________________________
<span class="lineNum">    1064 </span>            :   // Flanges 
<span class="lineNum">    1065 </span><span class="lineCov">          1 :   double    flangeDepth    = fmd3-&gt;GetFlangeDepth() / 2;</span>
<span class="lineNum">    1066 </span><span class="lineCov">          1 :   double    flangeLength   = fmd3-&gt;GetFlangeLength() / 2;</span>
<span class="lineNum">    1067 </span><span class="lineCov">          1 :   double    flangeWidth    = fmd3-&gt;GetFlangeWidth() / 2;</span>
<span class="lineNum">    1068 </span><span class="lineCov">          2 :   new TGeoBBox(&quot;FMD3_flange_base&quot;, flangeLength, flangeWidth, flangeDepth);</span>
<span class="lineNum">    1069 </span>            : 
<span class="lineNum">    1070 </span>            :   // Fiducial holes 
<span class="lineNum">    1071 </span><span class="lineCov">          1 :   const TObjArray&amp; fiducialHoles  = fmd3-&gt;FiducialHoles();</span>
<span class="lineNum">    1072 </span><span class="lineCov">          1 :   double           fiducialRadius = fmd3-&gt;GetFiducialRadius();</span>
<span class="lineNum">    1073 </span>            : #if 0
<span class="lineNum">    1074 </span>            :   TGeoTube*        fiducialShape  = 
<span class="lineNum">    1075 </span>            : #endif
<span class="lineNum">    1076 </span><span class="lineCov">          2 :     new TGeoTube(&quot;FMD3_fiducial_hole&quot;, 0, fiducialRadius, flangeDepth+.1);</span>
<span class="lineNum">    1077 </span><span class="lineCov">          1 :   Int_t            nFiducialHoles = fiducialHoles.GetEntriesFast();</span>
<span class="lineNum">    1078 </span><span class="lineCov">          1 :   double           flangeAngle    = TMath::Pi() / 4;</span>
<span class="lineNum">    1079 </span><span class="lineCov">          1 :   double           flangeX        = r5-&gt;Y()+flangeLength;</span>
<span class="lineNum">    1080 </span><span class="lineCov">          2 :   TVector2         flangeC(flangeX * TMath::Cos(flangeAngle), </span>
<span class="lineNum">    1081 </span><span class="lineCov">          1 :                            flangeX * TMath::Sin(flangeAngle));</span>
<span class="lineNum">    1082 </span><span class="lineCov">          1 :   TString          flangeComb(&quot;FMD3_flange_base-(&quot;);</span>
<span class="lineNum">    1083 </span>            : #if 0// For debugging geometry 
<span class="lineNum">    1084 </span>            :   TGeoVolume* fiducialVolume = new TGeoVolume(&quot;FMD3_fiducial&quot;, fiducialShape);
<span class="lineNum">    1085 </span>            :   fiducialVolume-&gt;SetLineColor(kGreen);
<span class="lineNum">    1086 </span>            : #endif
<span class="lineNum">    1087 </span><span class="lineCov">         10 :   for (Int_t i = 0; i &lt; nFiducialHoles; i++) { </span>
<span class="lineNum">    1088 </span><span class="lineCov">          8 :     TVector2&amp;        v  =  *(static_cast&lt;TVector2*&gt;(fiducialHoles.At(i)));</span>
<span class="lineNum">    1089 </span><span class="lineCov">          4 :     v                   -= flangeC;</span>
<span class="lineNum">    1090 </span><span class="lineCov">          4 :     TVector2         r  =  v.Rotate(-flangeAngle);</span>
<span class="lineNum">    1091 </span><span class="lineCov">          8 :     TGeoTranslation* t1 =  new TGeoTranslation(r.X(),  r.Y(), 0);</span>
<span class="lineNum">    1092 </span><span class="lineCov">          8 :     TGeoTranslation* t2 =  new TGeoTranslation(r.X(), -r.Y(), 0);</span>
<span class="lineNum">    1093 </span><span class="lineCov">          8 :     t1-&gt;SetName(Form(&quot;FMD3_fiducial_hole_rot%d&quot;, 2*i+0));</span>
<span class="lineNum">    1094 </span><span class="lineCov">          8 :     t2-&gt;SetName(Form(&quot;FMD3_fiducial_hole_rot%d&quot;, 2*i+1));</span>
<span class="lineNum">    1095 </span><span class="lineCov">          4 :     t1-&gt;RegisterYourself();</span>
<span class="lineNum">    1096 </span><span class="lineCov">          4 :     t2-&gt;RegisterYourself();</span>
<span class="lineNum">    1097 </span><span class="lineCov">          8 :     flangeComb.Append(Form(&quot;FMD3_fiducial_hole:FMD3_fiducial_hole_rot%d+&quot;</span>
<span class="lineNum">    1098 </span>            :                            &quot;FMD3_fiducial_hole:FMD3_fiducial_hole_rot%d%c&quot;,
<span class="lineNum">    1099 </span><span class="lineCov">          4 :                            2*i+0, 2*i+1, (i == nFiducialHoles-1 ? ')' : '+')));</span>
<span class="lineNum">    1100 </span>            : #if 0 // For debugging geometry 
<span class="lineNum">    1101 </span>            :     support-&gt;AddNode(fiducialVolume, 2*i+0, t1);
<span class="lineNum">    1102 </span>            :     support-&gt;AddNode(fiducialVolume, 2*i+1, t2);
<span class="lineNum">    1103 </span>            : #endif
<span class="lineNum">    1104 </span><span class="lineCov">          4 :   }</span>
<span class="lineNum">    1105 </span>            :   
<span class="lineNum">    1106 </span>            :   // Final flange shape, and at to full shape 
<span class="lineNum">    1107 </span><span class="lineCov">          3 :   TGeoCompositeShape* flangeShape = new TGeoCompositeShape(flangeComb.Data());</span>
<span class="lineNum">    1108 </span><span class="lineCov">          1 :   flangeShape-&gt;SetName(&quot;FMD3_flange&quot;);</span>
<span class="lineNum">    1109 </span><span class="lineCov">          6 :   for (Int_t i = 0; i &lt; 2; i++) { </span>
<span class="lineNum">    1110 </span><span class="lineCov">          4 :     TGeoRotation* rot = new TGeoRotation();</span>
<span class="lineNum">    1111 </span><span class="lineCov">          2 :     rot-&gt;RotateZ((i+.5)*90);</span>
<span class="lineNum">    1112 </span><span class="lineCov">          2 :     TVector2 v(flangeX, 0);</span>
<span class="lineNum">    1113 </span><span class="lineCov">          2 :     TVector2 w = v.Rotate((i+.5) * 2 * flangeAngle);</span>
<span class="lineNum">    1114 </span><span class="lineCov">          6 :     TGeoCombiTrans* trans = new TGeoCombiTrans(w.X(),w.Y(),</span>
<span class="lineNum">    1115 </span><span class="lineCov">          2 :                                                r4-&gt;X()+flangeDepth, rot);</span>
<span class="lineNum">    1116 </span><span class="lineCov">          4 :     trans-&gt;SetName(Form(&quot;FMD3_flange_matrix%d&quot;, i));</span>
<span class="lineNum">    1117 </span><span class="lineCov">          2 :     trans-&gt;RegisterYourself();</span>
<span class="lineNum">    1118 </span><span class="lineCov">          4 :     coneComb.Append(Form(&quot;+FMD3_flange:FMD3_flange_matrix%d&quot;, i));</span>
<span class="lineNum">    1119 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">    1120 </span><span class="lineCov">          1 :   coneComb.Append(&quot;)-(&quot;);</span>
<span class="lineNum">    1121 </span>            :   
<span class="lineNum">    1122 </span>            :   //__________________________________________________________________
<span class="lineNum">    1123 </span>            :   // Holes 
<span class="lineNum">    1124 </span><span class="lineCov">          1 :   Double_t holeL  = fmd3-&gt;GetHoleLength()/2;</span>
<span class="lineNum">    1125 </span><span class="lineCov">          1 :   Double_t holeD  = fmd3-&gt;GetHoleDepth()/2;</span>
<span class="lineNum">    1126 </span><span class="lineCov">          1 :   Double_t holeLW = fmd3-&gt;GetHoleLowWidth()/2;</span>
<span class="lineNum">    1127 </span><span class="lineCov">          1 :   Double_t holeHW = fmd3-&gt;GetHoleHighWidth()/2;</span>
<span class="lineNum">    1128 </span><span class="lineCov">          1 :   Double_t holeA  = fmd3-&gt;GetConeOuterAngle();</span>
<span class="lineNum">    1129 </span><span class="lineCov">          1 :   Double_t holeA2 = TMath::Pi() - fmd3-&gt;GetConeOuterAngle();</span>
<span class="lineNum">    1130 </span><span class="lineCov">          1 :   Double_t holeO  = fmd3-&gt;GetHoleOffset();</span>
<span class="lineNum">    1131 </span>            :   Double_t holeZ  = (holeO
<span class="lineNum">    1132 </span><span class="lineCov">          1 :                      + holeL * TMath::Cos(holeA)</span>
<span class="lineNum">    1133 </span><span class="lineCov">          1 :                      - holeD * TMath::Sin(holeA2));</span>
<span class="lineNum">    1134 </span><span class="lineCov">          1 :   Double_t holeX  = (fmd3-&gt;ConeR(-holeZ + fmd3-&gt;GetInnerZ() + fmd3-&gt;GetNoseZ())</span>
<span class="lineNum">    1135 </span><span class="lineCov">          1 :                      - holeD * TMath::Sin(holeA2));</span>
<span class="lineNum">    1136 </span><span class="lineCov">          2 :   new TGeoTrd1(&quot;FMD3_cone_hole&quot;, holeLW, holeHW, holeD, holeL);</span>
<span class="lineNum">    1137 </span><span class="lineCov">          2 :   TGeoTrd1* plateShape = new TGeoTrd1(&quot;FMD3_cooling_plate&quot;, </span>
<span class="lineNum">    1138 </span>            :                                       holeLW, holeHW, .033, holeL);
<span class="lineNum">    1139 </span><span class="lineCov">          2 :   TGeoRotation* holeRot = new TGeoRotation();</span>
<span class="lineNum">    1140 </span><span class="lineCov">          1 :   holeRot-&gt;SetName(&quot;FMD3_cone_hole_rotation&quot;);</span>
<span class="lineNum">    1141 </span><span class="lineCov">          1 :   holeRot-&gt;RotateZ(90);</span>
<span class="lineNum">    1142 </span><span class="lineCov">          1 :   holeRot-&gt;RotateY(holeA*180/TMath::Pi());</span>
<span class="lineNum">    1143 </span><span class="lineCov">          2 :   TGeoCombiTrans* holeBaseTrans = new TGeoCombiTrans(holeX, 0, holeZ, holeRot);</span>
<span class="lineNum">    1144 </span><span class="lineCov">          1 :   holeBaseTrans-&gt;SetName(&quot;FMD3_cone_hole_base_matrix&quot;);</span>
<span class="lineNum">    1145 </span>            :   // TGeoRotation* plateRot = new TGeoRotation();
<span class="lineNum">    1146 </span>            :   // plateRot-&gt;SetName(&quot;FMD3_cone_plate_rotation&quot;);
<span class="lineNum">    1147 </span>            :   // plateRot-&gt;RotateZ(90);
<span class="lineNum">    1148 </span>            :   // plateRot-&gt;RotateY(plateA*180/TMath::Pi());
<span class="lineNum">    1149 </span>            :   // TGeoCombiTrans* plateBaseTrans = new 
<span class="lineNum">    1150 </span>            :   //                  TGeoCombiTrans(plateX,0,plateZ,plateRot);
<span class="lineNum">    1151 </span><span class="lineCov">          3 :   TGeoVolume* plateVolume = new TGeoVolume(&quot;FMD3_cooling_plate&quot;, </span>
<span class="lineNum">    1152 </span><span class="lineCov">          1 :                                            plateShape, fAl);</span>
<span class="lineNum">    1153 </span><span class="lineCov">          1 :   plateShape-&gt;SetTitle(&quot;FMD3 cooling plate&quot;);</span>
<span class="lineNum">    1154 </span><span class="lineCov">          1 :   plateVolume-&gt;SetTitle(&quot;FMD3 cooling plate&quot;);</span>
<span class="lineNum">    1155 </span><span class="lineCov">         10 :   for (Int_t i = 0; i &lt; 4; i++) { </span>
<span class="lineNum">    1156 </span><span class="lineCov">          4 :     Double_t        ang   = 360. / 8 * (i + .5);</span>
<span class="lineNum">    1157 </span><span class="lineCov">          8 :     TGeoCombiTrans* trans = new TGeoCombiTrans(*holeBaseTrans);</span>
<span class="lineNum">    1158 </span><span class="lineCov">          4 :     trans-&gt;RotateZ(ang);</span>
<span class="lineNum">    1159 </span><span class="lineCov">          8 :     trans-&gt;SetName(Form(&quot;FMD3_cone_hole_matrix%d&quot;, i));</span>
<span class="lineNum">    1160 </span><span class="lineCov">          4 :     trans-&gt;RegisterYourself();</span>
<span class="lineNum">    1161 </span><span class="lineCov">          8 :     trans = new TGeoCombiTrans(*holeBaseTrans);</span>
<span class="lineNum">    1162 </span><span class="lineCov">          4 :     trans-&gt;RotateZ(ang);</span>
<span class="lineNum">    1163 </span><span class="lineCov">          8 :     trans-&gt;SetName(Form(&quot;FMD3_cooling_plate_matrix%d&quot;, i));</span>
<span class="lineNum">    1164 </span><span class="lineCov">          8 :     coneComb.Append(Form(&quot;FMD3_cone_hole:FMD3_cone_hole_matrix%d+&quot;, i));</span>
<span class="lineNum">    1165 </span><span class="lineCov">          4 :     support-&gt;AddNode(plateVolume, i, trans);</span>
<span class="lineNum">    1166 </span>            :   }
<span class="lineNum">    1167 </span>            :   
<span class="lineNum">    1168 </span>            :   //__________________________________________________________________
<span class="lineNum">    1169 </span>            :   // Bolts
<span class="lineNum">    1170 </span><span class="lineCov">          1 :   Double_t boltRadius = fmd3-&gt;GetBoltRadius();</span>
<span class="lineNum">    1171 </span><span class="lineCov">          1 :   Double_t boltLength = fmd3-&gt;GetBoltLength() / 2;</span>
<span class="lineNum">    1172 </span><span class="lineCov">          1 :   Double_t boltZ1     = fmd3-&gt;GetInnerZ()+fmd3-&gt;GetNoseZ()-10;</span>
<span class="lineNum">    1173 </span><span class="lineCov">          1 :   Double_t boltZ2     = fmd3-&gt;GetInnerZ()+fmd3-&gt;GetNoseZ()-20;</span>
<span class="lineNum">    1174 </span><span class="lineCov">          1 :   Double_t boltXE     = 2*boltLength*TMath::Cos(fmd3-&gt;GetConeOuterAngle());</span>
<span class="lineNum">    1175 </span><span class="lineCov">          2 :   Double_t boltX1     = (fmd3-&gt;ConeR(boltZ1) - boltXE);</span>
<span class="lineNum">    1176 </span><span class="lineCov">          2 :   Double_t boltX2     = (fmd3-&gt;ConeR(boltZ2) - boltXE);</span>
<span class="lineNum">    1177 </span>            :   
<span class="lineNum">    1178 </span><span class="lineCov">          2 :   new TGeoTube(&quot;FMD3_bolt_hole&quot;, 0, boltRadius, boltLength+.2);</span>
<span class="lineNum">    1179 </span><span class="lineCov">          2 :   TGeoTube* boltShape = new TGeoTube(&quot;FMD3_bolt&quot;, 0, boltRadius, boltLength);</span>
<span class="lineNum">    1180 </span><span class="lineCov">          2 :   TGeoRotation* boltRot = new TGeoRotation();</span>
<span class="lineNum">    1181 </span><span class="lineCov">          1 :   boltRot-&gt;RotateY(-fmd3-&gt;GetConeOuterAngle()*180/TMath::Pi());</span>
<span class="lineNum">    1182 </span><span class="lineCov">          2 :   TGeoCombiTrans* boltTrans1 = new TGeoCombiTrans(boltX1, 0, 10, boltRot);</span>
<span class="lineNum">    1183 </span><span class="lineCov">          2 :   TGeoCombiTrans* boltTrans2 = new TGeoCombiTrans(boltX2, 0, 20, boltRot);</span>
<span class="lineNum">    1184 </span><span class="lineCov">          2 :   TGeoCombiTrans* boltTrans3 = new TGeoCombiTrans(*boltTrans1);</span>
<span class="lineNum">    1185 </span><span class="lineCov">          2 :   TGeoCombiTrans* boltTrans4 = new TGeoCombiTrans(*boltTrans2);</span>
<span class="lineNum">    1186 </span><span class="lineCov">          1 :   boltTrans3-&gt;RotateZ(180);</span>
<span class="lineNum">    1187 </span><span class="lineCov">          1 :   boltTrans4-&gt;RotateZ(180);</span>
<span class="lineNum">    1188 </span><span class="lineCov">          1 :   boltTrans1-&gt;SetName(&quot;FMD3_bolt_matrix1&quot;);</span>
<span class="lineNum">    1189 </span><span class="lineCov">          1 :   boltTrans2-&gt;SetName(&quot;FMD3_bolt_matrix2&quot;);</span>
<span class="lineNum">    1190 </span><span class="lineCov">          1 :   boltTrans3-&gt;SetName(&quot;FMD3_bolt_matrix3&quot;);</span>
<span class="lineNum">    1191 </span><span class="lineCov">          1 :   boltTrans4-&gt;SetName(&quot;FMD3_bolt_matrix4&quot;);</span>
<span class="lineNum">    1192 </span><span class="lineCov">          1 :   boltTrans1-&gt;RegisterYourself();</span>
<span class="lineNum">    1193 </span><span class="lineCov">          1 :   boltTrans2-&gt;RegisterYourself();</span>
<span class="lineNum">    1194 </span><span class="lineCov">          1 :   boltTrans3-&gt;RegisterYourself();</span>
<span class="lineNum">    1195 </span><span class="lineCov">          1 :   boltTrans4-&gt;RegisterYourself();</span>
<span class="lineNum">    1196 </span><span class="lineCov">          1 :   coneComb.Append(&quot;FMD3_bolt_hole:FMD3_bolt_matrix1&quot;</span>
<span class="lineNum">    1197 </span>            :                   &quot;+FMD3_bolt_hole:FMD3_bolt_matrix2&quot;
<span class="lineNum">    1198 </span>            :                   &quot;+FMD3_bolt_hole:FMD3_bolt_matrix3&quot;
<span class="lineNum">    1199 </span>            :                   &quot;+FMD3_bolt_hole:FMD3_bolt_matrix4&quot;);
<span class="lineNum">    1200 </span><span class="lineCov">          2 :   TGeoVolume*     boltVolume = new TGeoVolume(&quot;FMD3_bolt&quot;, boltShape, fSteel);</span>
<span class="lineNum">    1201 </span><span class="lineCov">          1 :   support-&gt;AddNode(boltVolume, 1, boltTrans1);</span>
<span class="lineNum">    1202 </span><span class="lineCov">          1 :   support-&gt;AddNode(boltVolume, 2, boltTrans2);</span>
<span class="lineNum">    1203 </span><span class="lineCov">          1 :   boltShape-&gt;SetTitle(&quot;FMD3 steering bolt&quot;);</span>
<span class="lineNum">    1204 </span><span class="lineCov">          1 :   boltVolume-&gt;SetTitle(&quot;FMD3 steering bolt&quot;);</span>
<span class="lineNum">    1205 </span>            :   
<span class="lineNum">    1206 </span>            :   //__________________________________________________________________
<span class="lineNum">    1207 </span>            :   // Cut-outs for tension wheel sheeve 
<span class="lineNum">    1208 </span><span class="lineCov">          2 :   new TGeoBBox(&quot;FMD3_sheeve_hole&quot;, .55, .75, 1.16);</span>
<span class="lineNum">    1209 </span><span class="lineCov">          1 :   Double_t        sheeveHoleZ = fmd3-&gt;GetInnerZ() + fmd3-&gt;GetNoseZ() - .75;</span>
<span class="lineNum">    1210 </span><span class="lineCov">          2 :   Double_t        sheeveHoleR = fmd3-&gt;ConeR(sheeveHoleZ) - .55 + .2572222;</span>
<span class="lineNum">    1211 </span><span class="lineCov">          2 :   TGeoCombiTrans* sheeveMat1  = new TGeoCombiTrans(sheeveHoleR,0,1.15,0);</span>
<span class="lineNum">    1212 </span><span class="lineCov">          2 :   TGeoCombiTrans* sheeveMat2  = new TGeoCombiTrans(sheeveHoleR,0,1.15,0);</span>
<span class="lineNum">    1213 </span><span class="lineCov">          1 :   sheeveMat1-&gt;RotateZ(45);</span>
<span class="lineNum">    1214 </span><span class="lineCov">          1 :   sheeveMat2-&gt;RotateZ(135);</span>
<span class="lineNum">    1215 </span><span class="lineCov">          1 :   sheeveMat1-&gt;SetName(&quot;FMD3_sheeve_hole_matrix1&quot;);</span>
<span class="lineNum">    1216 </span><span class="lineCov">          1 :   sheeveMat2-&gt;SetName(&quot;FMD3_sheeve_hole_matrix2&quot;);</span>
<span class="lineNum">    1217 </span><span class="lineCov">          1 :   sheeveMat1-&gt;RegisterYourself();</span>
<span class="lineNum">    1218 </span><span class="lineCov">          1 :   sheeveMat2-&gt;RegisterYourself();</span>
<span class="lineNum">    1219 </span><span class="lineCov">          1 :   coneComb.Append(&quot;+FMD3_sheeve_hole:FMD3_sheeve_hole_matrix1&quot;</span>
<span class="lineNum">    1220 </span>            :                   &quot;+FMD3_sheeve_hole:FMD3_sheeve_hole_matrix2)&quot;);
<span class="lineNum">    1221 </span>            :   
<span class="lineNum">    1222 </span>            :   //__________________________________________________________________
<span class="lineNum">    1223 </span>            :   // Sheeve boxes 
<span class="lineNum">    1224 </span>            :   Double_t       sheeveL     = 1.15;
<span class="lineNum">    1225 </span><span class="lineCov">          2 :   TGeoBBox*      sheeveSideS = new TGeoBBox(&quot;FMD3_sheeve_side&quot;,</span>
<span class="lineNum">    1226 </span>            :                                            .55, .25, 1.15);
<span class="lineNum">    1227 </span><span class="lineCov">          2 :   TGeoBBox*      sheeveBackS = new TGeoBBox(&quot;FMD3_sheeve_back&quot;, </span>
<span class="lineNum">    1228 </span>            :                                             .55, .25, .15);
<span class="lineNum">    1229 </span><span class="lineCov">          2 :   TGeoBBox*      sheeveWingS = new TGeoBBox(&quot;FMD3_sheeve_wing&quot;, </span>
<span class="lineNum">    1230 </span>            :                                             .15, .15, 1.15);
<span class="lineNum">    1231 </span><span class="lineCov">          2 :   TGeoPcon*      sheeveWheelS = new TGeoPcon(&quot;FMD3_sheeve_wheel&quot;, 0, 360, 9);</span>
<span class="lineNum">    1232 </span>            :   Double_t       sheeveInnerR = 0; // .2;
<span class="lineNum">    1233 </span>            :   Double_t       sheeveR      = .875;
<span class="lineNum">    1234 </span>            :   Double_t       sheeveWheelZ = .95;
<span class="lineNum">    1235 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(0, -.25,   sheeveInnerR, 1);</span>
<span class="lineNum">    1236 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(1, -.125,  sheeveInnerR, 1);</span>
<span class="lineNum">    1237 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(2, -.125,  sheeveInnerR, sheeveWheelZ);</span>
<span class="lineNum">    1238 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(3, -.0625, sheeveInnerR, sheeveR+.02);</span>
<span class="lineNum">    1239 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(4, 0.000,  sheeveInnerR, sheeveR);</span>
<span class="lineNum">    1240 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(5, +.0625, sheeveInnerR, sheeveR+.02);</span>
<span class="lineNum">    1241 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(6, +.125,  sheeveInnerR, sheeveWheelZ);</span>
<span class="lineNum">    1242 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(7, +.125,  sheeveInnerR, 1);</span>
<span class="lineNum">    1243 </span><span class="lineCov">          1 :   sheeveWheelS-&gt;DefineSection(8, +.25,   sheeveInnerR, 1);</span>
<span class="lineNum">    1244 </span><span class="lineCov">          3 :   TGeoVolume*    sheeveSideV = new TGeoVolume(&quot;FMD3_sheeve_side&quot;, </span>
<span class="lineNum">    1245 </span><span class="lineCov">          1 :                                               sheeveSideS, fPlastic);</span>
<span class="lineNum">    1246 </span><span class="lineCov">          3 :   TGeoVolume*    sheeveBackV = new TGeoVolume(&quot;FMD3_sheeve_back&quot;, </span>
<span class="lineNum">    1247 </span><span class="lineCov">          1 :                                               sheeveBackS, fPlastic);</span>
<span class="lineNum">    1248 </span><span class="lineCov">          3 :   TGeoVolume*    sheeveWingV = new TGeoVolume(&quot;FMD3_sheeve_wing&quot;, </span>
<span class="lineNum">    1249 </span><span class="lineCov">          1 :                                               sheeveWingS, fPlastic);</span>
<span class="lineNum">    1250 </span><span class="lineCov">          3 :   TGeoVolume*    sheeveWheelV= new TGeoVolume(&quot;FMD3_sheeve_wheel&quot;, </span>
<span class="lineNum">    1251 </span><span class="lineCov">          1 :                                               sheeveWheelS, fPlastic);</span>
<span class="lineNum">    1252 </span><span class="lineCov">          2 :   TGeoVolumeAssembly* sheeveBox = new TGeoVolumeAssembly(&quot;FMD3_sheeve_box&quot;);</span>
<span class="lineNum">    1253 </span><span class="lineCov">          3 :   sheeveBox-&gt;AddNode(sheeveSideV, 1, new TGeoTranslation(0, -.5, 0));</span>
<span class="lineNum">    1254 </span><span class="lineCov">          3 :   sheeveBox-&gt;AddNode(sheeveSideV, 2, new TGeoTranslation(0, +.5, 0));</span>
<span class="lineNum">    1255 </span><span class="lineCov">          3 :   sheeveBox-&gt;AddNode(sheeveBackV, 1, new TGeoTranslation(0, 0, 2.0+.15-1.15));</span>
<span class="lineNum">    1256 </span><span class="lineCov">          3 :   sheeveBox-&gt;AddNode(sheeveWingV, 1, new TGeoTranslation(.55-.15, -.90, 0));</span>
<span class="lineNum">    1257 </span><span class="lineCov">          3 :   sheeveBox-&gt;AddNode(sheeveWingV, 2, new TGeoTranslation(.55-.15, +.90, 0));</span>
<span class="lineNum">    1258 </span><span class="lineCov">          2 :   TGeoRotation*   sheeveWheelR = new TGeoRotation;</span>
<span class="lineNum">    1259 </span><span class="lineCov">          1 :   sheeveWheelR-&gt;RotateX(90);</span>
<span class="lineNum">    1260 </span><span class="lineCov">          2 :   TGeoCombiTrans* sheeveWheelM = new TGeoCombiTrans(0, 0, sheeveWheelZ-sheeveL,</span>
<span class="lineNum">    1261 </span>            :                                                     sheeveWheelR);
<span class="lineNum">    1262 </span><span class="lineCov">          1 :   sheeveBox-&gt;AddNode(sheeveWheelV, 1, sheeveWheelM);</span>
<span class="lineNum">    1263 </span><span class="lineCov">          1 :   support-&gt;AddNode(sheeveBox, 1, sheeveMat1);</span>
<span class="lineNum">    1264 </span><span class="lineCov">          1 :   support-&gt;AddNode(sheeveBox, 2, sheeveMat2);</span>
<span class="lineNum">    1265 </span>            :   
<span class="lineNum">    1266 </span>            :   
<span class="lineNum">    1267 </span>            : 
<span class="lineNum">    1268 </span>            :   //__________________________________________________________________
<span class="lineNum">    1269 </span>            :   // Final cone
<span class="lineNum">    1270 </span><span class="lineCov">          3 :   TGeoCompositeShape* coneShape = new TGeoCompositeShape(coneComb.Data());</span>
<span class="lineNum">    1271 </span><span class="lineCov">          1 :   coneShape-&gt;SetName(&quot;FMD3_cone&quot;);</span>
<span class="lineNum">    1272 </span><span class="lineCov">          1 :   coneShape-&gt;SetTitle(&quot;FMD3 cone&quot;);</span>
<span class="lineNum">    1273 </span><span class="lineCov">          2 :   TGeoVolume*  coneVolume = new TGeoVolume(&quot;FMD3_Cone&quot;, coneShape, fC);</span>
<span class="lineNum">    1274 </span><span class="lineCov">          1 :   coneVolume-&gt;SetLineColor(kRed);</span>
<span class="lineNum">    1275 </span><span class="lineCov">          3 :   support-&gt;AddNode(coneVolume, 0, new TGeoTranslation(0, 0, 0));</span>
<span class="lineNum">    1276 </span>            : 
<span class="lineNum">    1277 </span>            :   //__________________________________________________________________
<span class="lineNum">    1278 </span>            :   // Tension boxes. 
<span class="lineNum">    1279 </span><span class="lineCov">          1 :   TGeoVolume*     tensionBox = TensionBox();</span>
<span class="lineNum">    1280 </span>            :   Double_t        tensionH  = .6;
<span class="lineNum">    1281 </span>            :   Double_t        tensionL  = 4;
<span class="lineNum">    1282 </span>            :   Double_t        tensionZ  = 23.654;
<span class="lineNum">    1283 </span><span class="lineCov">          2 :   Double_t        tensionR  = fmd3-&gt;ConeR(fmd3-&gt;GetInnerZ() + fmd3-&gt;GetNoseZ() </span>
<span class="lineNum">    1284 </span><span class="lineCov">          1 :                                           -  tensionZ);</span>
<span class="lineNum">    1285 </span><span class="lineCov">          1 :   Double_t        tensionAr = fmd3-&gt;GetConeOuterAngle();</span>
<span class="lineNum">    1286 </span><span class="lineCov">          1 :   Double_t        tensionA  = tensionAr * 180 / TMath::Pi();</span>
<span class="lineNum">    1287 </span><span class="lineCov">          2 :   TGeoRotation*   tensionQ  = new TGeoRotation;</span>
<span class="lineNum">    1288 </span><span class="lineCov">          1 :   tensionQ-&gt;RotateY(tensionA);</span>
<span class="lineNum">    1289 </span><span class="lineCov">          2 :   TGeoCombiTrans* tensionM1 = new TGeoCombiTrans(tensionR,0,tensionZ, tensionQ);</span>
<span class="lineNum">    1290 </span><span class="lineCov">          2 :   TGeoCombiTrans* tensionM2 = new TGeoCombiTrans(tensionR,0,tensionZ, tensionQ);</span>
<span class="lineNum">    1291 </span><span class="lineCov">          1 :   tensionM1-&gt;RotateZ(45);</span>
<span class="lineNum">    1292 </span><span class="lineCov">          1 :   tensionM2-&gt;RotateZ(135);</span>
<span class="lineNum">    1293 </span><span class="lineCov">          1 :   support-&gt;AddNode(tensionBox, 1, tensionM1);</span>
<span class="lineNum">    1294 </span><span class="lineCov">          1 :   support-&gt;AddNode(tensionBox, 2, tensionM2);</span>
<span class="lineNum">    1295 </span>            :   
<span class="lineNum">    1296 </span>            :   // Double_t         tensionHR    = 0.15;
<span class="lineNum">    1297 </span>            :   Double_t         wireT        = .1/2;
<span class="lineNum">    1298 </span>            :   Double_t         wireZ1       = (tensionZ
<span class="lineNum">    1299 </span><span class="lineCov">          1 :                                    - tensionL * TMath::Cos(tensionAr) </span>
<span class="lineNum">    1300 </span><span class="lineCov">          1 :                                    - tensionH * TMath::Sin(tensionAr));</span>
<span class="lineNum">    1301 </span>            :   Double_t         wireR1       = (tensionR 
<span class="lineNum">    1302 </span><span class="lineCov">          1 :                                    - tensionL * TMath::Sin(tensionAr) </span>
<span class="lineNum">    1303 </span><span class="lineCov">          1 :                                    + tensionH * TMath::Cos(tensionAr));</span>
<span class="lineNum">    1304 </span><span class="lineCov">          4 :   AliFMDDebug(10, (&quot;Wire Z1: %f=%f-%f*cos(%f)-%f*sin(%f)&quot;, </span>
<span class="lineNum">    1305 </span>            :                   wireZ1, tensionZ, tensionL, tensionAr, tensionH, tensionAr));
<span class="lineNum">    1306 </span><span class="lineCov">          4 :   AliFMDDebug(10, (&quot;Wire R1: %f=%f-%f*sin(%f)-%f*cos(%f)&quot;, </span>
<span class="lineNum">    1307 </span>            :                   wireR1, tensionR, tensionL, tensionAr, tensionH, tensionAr));
<span class="lineNum">    1308 </span>            :   
<span class="lineNum">    1309 </span><span class="lineCov">          1 :   Double_t         wireStartA   = 42.3 * TMath::Pi() / 180;</span>
<span class="lineNum">    1310 </span><span class="lineCov">          1 :   Double_t         wireZ2       = (sheeveWheelZ * (1 - TMath::Sin(wireStartA))</span>
<span class="lineNum">    1311 </span>            :                                    // - sheeveL - 
<span class="lineNum">    1312 </span><span class="lineCov">          1 :                                    - wireT * TMath::Sin(wireStartA));</span>
<span class="lineNum">    1313 </span>            :   /* (sheeveWheelZ * (1 - TMath::Sin(wireStartA))
<span class="lineNum">    1314 </span>            :                                    - wireT * TMath::Sin(wireStartA) 
<span class="lineNum">    1315 </span>            :                                    - sheeveL); */
<span class="lineNum">    1316 </span><span class="lineCov">          4 :   AliFMDDebug(10, (&quot;wireZ2=%f=%f*(1-%f)&quot;, wireZ2, sheeveWheelZ, </span>
<span class="lineNum">    1317 </span>            :                   TMath::Sin(wireStartA)));
<span class="lineNum">    1318 </span><span class="lineCov">          1 :   Double_t         wireR2       = (sheeveHoleR + </span>
<span class="lineNum">    1319 </span><span class="lineCov">          2 :                                    sheeveWheelZ * TMath::Cos(wireStartA) + </span>
<span class="lineNum">    1320 </span><span class="lineCov">          1 :                                    wireT * TMath::Cos(wireStartA));</span>
<span class="lineNum">    1321 </span><span class="lineCov">          1 :   Double_t         wireDR       = wireR1-wireR2;</span>
<span class="lineNum">    1322 </span><span class="lineCov">          1 :   Double_t         wireDZ       = wireZ1-wireZ2;</span>
<span class="lineNum">    1323 </span><span class="lineCov">          1 :   Double_t         wireL        = TMath::Sqrt(wireDR*wireDR+wireDZ*wireDZ)-.01;</span>
<span class="lineNum">    1324 </span><span class="lineCov">          1 :   Double_t         wireAngle    = TMath::ATan2(wireDR,wireDZ);</span>
<span class="lineNum">    1325 </span><span class="lineCov">          2 :   TGeoTube*        wireShape    = new TGeoTube(&quot;FMD3_wire&quot;, 0, wireT, wireL/2);</span>
<span class="lineNum">    1326 </span><span class="lineCov">          2 :   TGeoVolume*      wireVolume   = new TGeoVolume(&quot;FMD3_wire&quot;, wireShape,fSteel);</span>
<span class="lineNum">    1327 </span><span class="lineCov">          2 :   TGeoRotation*    wireRot      = new TGeoRotation();</span>
<span class="lineNum">    1328 </span><span class="lineCov">          1 :   wireRot-&gt;RotateY(180/TMath::Pi()*wireAngle);</span>
<span class="lineNum">    1329 </span><span class="lineCov">          1 :   Double_t         wireR        = wireR2 + wireDR / 2;</span>
<span class="lineNum">    1330 </span><span class="lineCov">          1 :   Double_t         wireZ        = wireZ2 + wireDZ / 2;</span>
<span class="lineNum">    1331 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireM1       = new TGeoCombiTrans(wireR, 0,wireZ, wireRot);</span>
<span class="lineNum">    1332 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireM2       = new TGeoCombiTrans(wireR, 0,wireZ, wireRot);</span>
<span class="lineNum">    1333 </span><span class="lineCov">          1 :   wireM1-&gt;RotateZ(45);</span>
<span class="lineNum">    1334 </span><span class="lineCov">          1 :   wireM2-&gt;RotateZ(135);</span>
<span class="lineNum">    1335 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireVolume, 1, wireM1);</span>
<span class="lineNum">    1336 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireVolume, 2, wireM2);</span>
<span class="lineNum">    1337 </span>            : 
<span class="lineNum">    1338 </span>            : 
<span class="lineNum">    1339 </span><span class="lineCov">          3 :   TGeoTorus*       wireTS  = new TGeoTorus(sheeveWheelZ+wireT, 0, wireT, 0, </span>
<span class="lineNum">    1340 </span><span class="lineCov">          1 :                                            90-wireStartA*180/TMath::Pi());</span>
<span class="lineNum">    1341 </span><span class="lineCov">          2 :   TGeoVolume*      wireTV  = new TGeoVolume(&quot;FMD3_bend_wire&quot;,wireTS,fSteel);</span>
<span class="lineNum">    1342 </span><span class="lineCov">          2 :   TGeoRotation*    wireTR  = new TGeoRotation;</span>
<span class="lineNum">    1343 </span><span class="lineCov">          1 :   wireTR-&gt;RotateY(90);</span>
<span class="lineNum">    1344 </span><span class="lineCov">          1 :   wireTR-&gt;RotateZ(-90);</span>
<span class="lineNum">    1345 </span>            :   Double_t         wireTZ  = sheeveWheelZ;
<span class="lineNum">    1346 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireTM1 = new TGeoCombiTrans(sheeveHoleR,0,wireTZ,wireTR);</span>
<span class="lineNum">    1347 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireTM2 = new TGeoCombiTrans(sheeveHoleR,0,wireTZ,wireTR);</span>
<span class="lineNum">    1348 </span><span class="lineCov">          1 :   wireTM1-&gt;RotateZ(45);</span>
<span class="lineNum">    1349 </span><span class="lineCov">          1 :   wireTM2-&gt;RotateZ(135);</span>
<span class="lineNum">    1350 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireTV, 1, wireTM1);</span>
<span class="lineNum">    1351 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireTV, 2, wireTM2);</span>
<span class="lineNum">    1352 </span>            : 
<span class="lineNum">    1353 </span>            :   Double_t         colarR = 4.05;
<span class="lineNum">    1354 </span><span class="lineCov">          1 :   Double_t         wireEL = sheeveHoleR - colarR;</span>
<span class="lineNum">    1355 </span><span class="lineCov">          2 :   TGeoTube*        wireES = new TGeoTube(&quot;FMD3_end_wire&quot;, 0, wireT, wireEL/2);</span>
<span class="lineNum">    1356 </span><span class="lineCov">          2 :   TGeoVolume*      wireEV = new TGeoVolume(&quot;FMD3_end_wire&quot;, wireES, fSteel);</span>
<span class="lineNum">    1357 </span><span class="lineCov">          2 :   TGeoRotation*    wireER = new TGeoRotation;</span>
<span class="lineNum">    1358 </span><span class="lineCov">          1 :   wireER-&gt;RotateY(90);</span>
<span class="lineNum">    1359 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireEM1 = new TGeoCombiTrans(colarR+wireEL/2,0,</span>
<span class="lineNum">    1360 </span>            :                                                 -wireT,wireER);
<span class="lineNum">    1361 </span><span class="lineCov">          2 :   TGeoCombiTrans*  wireEM2 = new TGeoCombiTrans(colarR+wireEL/2,0,</span>
<span class="lineNum">    1362 </span>            :                                                 -wireT,wireER);
<span class="lineNum">    1363 </span><span class="lineCov">          1 :   wireEM1-&gt;RotateZ(45);</span>
<span class="lineNum">    1364 </span><span class="lineCov">          1 :   wireEM2-&gt;RotateZ(135);</span>
<span class="lineNum">    1365 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireEV, 1, wireEM1);</span>
<span class="lineNum">    1366 </span><span class="lineCov">          1 :   support-&gt;AddNode(wireEV, 2, wireEM2);</span>
<span class="lineNum">    1367 </span>            :   
<span class="lineNum">    1368 </span>            :   
<span class="lineNum">    1369 </span>            : 
<span class="lineNum">    1370 </span>            :   
<span class="lineNum">    1371 </span>            :   //__________________________________________________________________
<span class="lineNum">    1372 </span>            :   // Place support volumes in half-detector volumes 
<span class="lineNum">    1373 </span><span class="lineCov">          1 :   Double_t         z  = fmd3-&gt;GetInnerZ();</span>
<span class="lineNum">    1374 </span><span class="lineCov">          4 :   AliFMDDebug(1, (&quot;FMD3 support at z=%f&quot;, -fmd3-&gt;GetNoseZ()));</span>
<span class="lineNum">    1375 </span><span class="lineCov">          2 :   TGeoTranslation* t1 = new TGeoTranslation(0, 0, -fmd3-&gt;GetNoseZ());</span>
<span class="lineNum">    1376 </span><span class="lineCov">          1 :   fmd3TopVolume-&gt;AddNode(support, 1, t1);</span>
<span class="lineNum">    1377 </span><span class="lineCov">          2 :   TGeoCombiTrans*  t2 = new TGeoCombiTrans(*t1);</span>
<span class="lineNum">    1378 </span><span class="lineCov">          1 :   t2-&gt;RotateZ(180);</span>
<span class="lineNum">    1379 </span><span class="lineCov">          1 :   fmd3BotVolume-&gt;AddNode(support, 2, t2);</span>
<span class="lineNum">    1380 </span>            : 
<span class="lineNum">    1381 </span><span class="lineCov">          2 :   TGeoRotation*   rot        = new TGeoRotation(&quot;FMD3 rotatation&quot;);</span>
<span class="lineNum">    1382 </span><span class="lineCov">          1 :   rot-&gt;RotateY(180);</span>
<span class="lineNum">    1383 </span><span class="lineCov">          1 :   TGeoVolume*     top        = gGeoManager-&gt;GetVolume(&quot;ALIC&quot;);</span>
<span class="lineNum">    1384 </span><span class="lineCov">          3 :   TGeoMatrix* mmatrix        = new TGeoCombiTrans(&quot;FMD3 trans&quot;, 0, 0, z, rot);</span>
<span class="lineNum">    1385 </span><span class="lineCov">          4 :   AliFMDDebug(5, (&quot;Placing volumes %s and %s in ALIC at z=%f&quot;, </span>
<span class="lineNum">    1386 </span>            :                    fmd3TopVolume-&gt;GetName(), fmd3BotVolume-&gt;GetName(), z));
<span class="lineNum">    1387 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd3TopVolume, fmd3-&gt;GetId(), mmatrix);</span>
<span class="lineNum">    1388 </span><span class="lineCov">          1 :   top-&gt;AddNode(fmd3BotVolume, fmd3-&gt;GetId(), mmatrix);</span>
<span class="lineNum">    1389 </span>            : 
<span class="lineNum">    1390 </span>            :   return 0;
<span class="lineNum">    1391 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">    1392 </span>            : 
<span class="lineNum">    1393 </span>            : 
<a name="1394"><span class="lineNum">    1394 </span>            : //____________________________________________________________________</a>
<span class="lineNum">    1395 </span>            : void
<span class="lineNum">    1396 </span>            : AliFMDGeometryBuilder::Exec(Option_t*) 
<span class="lineNum">    1397 </span>            : {
<span class="lineNum">    1398 </span>            :   // Setup up the FMD geometry. 
<span class="lineNum">    1399 </span><span class="lineCov">          3 :   AliFMDDebug(1, (&quot;\tGeometry options: %s&quot;,</span>
<span class="lineNum">    1400 </span>            :                     (fDetailed  ? &quot;divided into strips&quot; : &quot;one volume&quot;)));
<span class="lineNum">    1401 </span><span class="lineCov">          1 :   if (!gGeoManager) {</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :     AliFatal(&quot;No TGeoManager defined&quot;);</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1404 </span>            :   }
<span class="lineNum">    1405 </span>            : 
<span class="lineNum">    1406 </span><span class="lineCov">          1 :   fSi      = gGeoManager-&gt;GetMedium(&quot;FMD_Si$&quot;);</span>
<span class="lineNum">    1407 </span><span class="lineCov">          1 :   fC       = gGeoManager-&gt;GetMedium(&quot;FMD_Carbon$&quot;);</span>
<span class="lineNum">    1408 </span><span class="lineCov">          1 :   fAl      = gGeoManager-&gt;GetMedium(&quot;FMD_Aluminum$&quot;);</span>
<span class="lineNum">    1409 </span><span class="lineCov">          1 :   fChip    = gGeoManager-&gt;GetMedium(&quot;FMD_Si Chip$&quot;);</span>
<span class="lineNum">    1410 </span><span class="lineCov">          1 :   fAir     = gGeoManager-&gt;GetMedium(&quot;FMD_Air$&quot;);</span>
<span class="lineNum">    1411 </span><span class="lineCov">          1 :   fPCB     = gGeoManager-&gt;GetMedium(&quot;FMD_PCB$&quot;);</span>
<span class="lineNum">    1412 </span><span class="lineCov">          1 :   fPlastic = gGeoManager-&gt;GetMedium(&quot;FMD_Plastic$&quot;);</span>
<span class="lineNum">    1413 </span><span class="lineCov">          1 :   fCopper  = gGeoManager-&gt;GetMedium(&quot;FMD_Copper$&quot;);</span>
<span class="lineNum">    1414 </span><span class="lineCov">          1 :   fSteel   = gGeoManager-&gt;GetMedium(&quot;FMD_Steel$&quot;);</span>
<span class="lineNum">    1415 </span>            : 
<span class="lineNum">    1416 </span><span class="lineCov">          9 :   if (!fSi||!fC||!fAl||!fChip||!fAir||!fPCB||!fPlastic||!fCopper||!fSteel) {</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :     AliError(&quot;Failed to get some or all tracking mediums&quot;);</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1419 </span>            :   }    
<span class="lineNum">    1420 </span><span class="lineCov">          1 :   AliFMDGeometry* fmd = AliFMDGeometry::Instance();</span>
<span class="lineNum">    1421 </span><span class="lineCov">          1 :   AliFMDRing* inner = fmd-&gt;GetInner();</span>
<span class="lineNum">    1422 </span><span class="lineCov">          1 :   AliFMDRing* outer = fmd-&gt;GetOuter();</span>
<span class="lineNum">    1423 </span><span class="lineCov">          1 :   RingGeometry(inner);</span>
<span class="lineNum">    1424 </span><span class="lineCov">          1 :   RingGeometry(outer);</span>
<span class="lineNum">    1425 </span><span class="lineCov">          2 :   TGeoVolume* innerTop = gGeoManager-&gt;GetVolume(Form(fgkRingTopName, </span>
<span class="lineNum">    1426 </span><span class="lineCov">          1 :                                                      inner-&gt;GetId()));</span>
<span class="lineNum">    1427 </span><span class="lineCov">          2 :   TGeoVolume* innerBot = gGeoManager-&gt;GetVolume(Form(fgkRingBotName, </span>
<span class="lineNum">    1428 </span><span class="lineCov">          1 :                                                      inner-&gt;GetId()));</span>
<span class="lineNum">    1429 </span><span class="lineCov">          2 :   TGeoVolume* outerTop = gGeoManager-&gt;GetVolume(Form(fgkRingTopName, </span>
<span class="lineNum">    1430 </span><span class="lineCov">          1 :                                                      outer-&gt;GetId()));</span>
<span class="lineNum">    1431 </span><span class="lineCov">          2 :   TGeoVolume* outerBot = gGeoManager-&gt;GetVolume(Form(fgkRingBotName, </span>
<span class="lineNum">    1432 </span><span class="lineCov">          1 :                                                      outer-&gt;GetId()));</span>
<span class="lineNum">    1433 </span>            :   
<span class="lineNum">    1434 </span><span class="lineCov">          1 :   FMD1Geometry(fmd-&gt;GetFMD1(), innerTop, innerBot);</span>
<span class="lineNum">    1435 </span><span class="lineCov">          1 :   FMD2Geometry(fmd-&gt;GetFMD2(), innerTop, innerBot, outerTop, outerBot);</span>
<span class="lineNum">    1436 </span><span class="lineCov">          1 :   FMD3Geometry(fmd-&gt;GetFMD3(), innerTop, innerBot, outerTop, outerBot);</span>
<span class="lineNum">    1437 </span>            : #ifndef USE_PRE_MOVE
<span class="lineNum">    1438 </span><span class="lineCov">          1 :   fmd-&gt;SetSectorOff(fSectorOff);</span>
<span class="lineNum">    1439 </span><span class="lineCov">          1 :   fmd-&gt;SetModuleOff(fModuleOff);</span>
<span class="lineNum">    1440 </span><span class="lineCov">          1 :   fmd-&gt;SetRingOff(fRingOff);</span>
<span class="lineNum">    1441 </span><span class="lineCov">          1 :   fmd-&gt;SetDetectorOff(fDetectorOff);</span>
<span class="lineNum">    1442 </span><span class="lineCov">          1 :   fmd-&gt;SetActive(fActiveId.fArray, fActiveId.fN);</span>
<span class="lineNum">    1443 </span>            : #endif
<span class="lineNum">    1444 </span>            :   // fmd-&gt;ExtractGeomInfo();
<span class="lineNum">    1445 </span>            :   
<span class="lineNum">    1446 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">    1447 </span>            : 
<span class="lineNum">    1448 </span>            : 
<span class="lineNum">    1449 </span>            : //____________________________________________________________________
<span class="lineNum">    1450 </span>            : //
<span class="lineNum">    1451 </span>            : // EOF
<span class="lineNum">    1452 </span>            : //
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
