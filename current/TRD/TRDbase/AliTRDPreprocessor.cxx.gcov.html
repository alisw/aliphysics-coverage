<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TRD/TRDbase/AliTRDPreprocessor.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">TRD/TRDbase</a> - AliTRDPreprocessor.cxx<span style="font-size: 80%;"> (source / <a href="AliTRDPreprocessor.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">546</td>
            <td class="headerCovTableEntryLo">0.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">23</td>
            <td class="headerCovTableEntryLo">4.3 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : ////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      19 </span>            : //                                                                        //
<span class="lineNum">      20 </span>            : // This class is a first implementation for the TRD.                      //
<span class="lineNum">      21 </span>            : // It takes data from HLT and computes the parameters                     //
<span class="lineNum">      22 </span>            : // and stores both reference data and online calibration                  //
<span class="lineNum">      23 </span>            : // parameters in the CDB                                                  //
<span class="lineNum">      24 </span>            : // It alsotakes DCS data, does spline fits                                //
<span class="lineNum">      25 </span>            : // and stores both reference data and spline fits results                 //
<span class="lineNum">      26 </span>            : // in the CDB                                                             //
<span class="lineNum">      27 </span>            : //                                                                        //
<span class="lineNum">      28 </span>            : // Authors:                                                               //
<span class="lineNum">      29 </span>            : //   R. Bailhache (R.Bailhache@gsi.de)                                    //
<span class="lineNum">      30 </span>            : //   J. Book (jbook@ikf.uni-frankfurt.de)                                 //
<span class="lineNum">      31 </span>            : //   W. Monange   (w.monange@gsi.de)                                      //
<span class="lineNum">      32 </span>            : //   F. Kramer    (kramer@ikf.uni-frankfurt.de)                           //
<span class="lineNum">      33 </span>            : // Maintainers:                                                           //
<span class="lineNum">      34 </span>            : //   Hans.Beck@cern.ch                                                    //
<span class="lineNum">      35 </span>            : //   R. Bailhache (R.Bailhache@gsi.de)                                    //
<span class="lineNum">      36 </span>            : //                                                                        //
<span class="lineNum">      37 </span>            : //                                                                        //
<span class="lineNum">      38 </span>            : ////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #include &lt;fstream&gt;
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            : #include &lt;TFile.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;TProfile2D.h&gt;
<span class="lineNum">      44 </span>            : #include &lt;TObjString.h&gt;
<span class="lineNum">      45 </span>            : #include &lt;TString.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;TList.h&gt;
<span class="lineNum">      47 </span>            : #include &lt;TSAXParser.h&gt;
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : #include &quot;AliCDBMetaData.h&quot;
<span class="lineNum">      50 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : #include &quot;AliTRDPreprocessor.h&quot;
<span class="lineNum">      53 </span>            : #include &quot;AliTRDSensorArray.h&quot;
<span class="lineNum">      54 </span>            : #include &quot;AliTRDCalibraFit.h&quot;
<span class="lineNum">      55 </span>            : #include &quot;AliTRDCalibraMode.h&quot;
<span class="lineNum">      56 </span>            : #include &quot;AliTRDCalibPadStatus.h&quot;
<span class="lineNum">      57 </span>            : #include &quot;AliTRDSaxHandler.h&quot;
<span class="lineNum">      58 </span>            : #include &quot;AliTRDgeometry.h&quot;
<span class="lineNum">      59 </span>            : #include &quot;AliTRDCalibChamberStatus.h&quot;
<span class="lineNum">      60 </span>            : #include &quot;AliTRDCalPad.h&quot;
<span class="lineNum">      61 </span>            : #include &quot;AliTRDCalPadStatus.h&quot;
<span class="lineNum">      62 </span>            : #include &quot;AliTRDCalDCSv2.h&quot;
<span class="lineNum">      63 </span>            : #include &quot;AliTRDCalSingleChamberStatus.h&quot;
<span class="lineNum">      64 </span>            : #include &quot;AliTRDCalChamberStatus.h&quot;
<a name="65"><span class="lineNum">      65 </span>            : #include &quot;AliTRDCalROC.h&quot;</a>
<span class="lineNum">      66 </span>            : 
<span class="lineNum">      67 </span><span class="lineCov">         48 : ClassImp(AliTRDPreprocessor)</span>
<a name="68"><span class="lineNum">      68 </span>            : </a>
<span class="lineNum">      69 </span>            : //______________________________________________________________________________________________
<span class="lineNum">      70 </span>            : AliTRDPreprocessor::AliTRDPreprocessor(AliShuttleInterface *shuttle)
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :   :AliPreprocessor(&quot;TRD&quot;, shuttle)</span>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   ,fCalDCSObjSOR(0)</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   ,fCalDCSObjEOR(0)</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :   ,fVdriftHLT(0)</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      76 </span>            :   //
<span class="lineNum">      77 </span>            :   // Constructor
<span class="lineNum">      78 </span>            :   //
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   AddRunType(&quot;PHYSICS&quot;);</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   AddRunType(&quot;STANDALONE&quot;);</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :   AddRunType(&quot;PEDESTAL&quot;);</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :   AddRunType(&quot;DAQ&quot;);</span>
<span class="lineNum">      85 </span>            :   
<span class="lineNum">      86 </span>            :   
<a name="87"><span class="lineNum">      87 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      88 </span>            : //______________________________________________________________________________________________
<span class="lineNum">      89 </span>            :  AliTRDPreprocessor::AliTRDPreprocessor(const AliTRDPreprocessor&amp;  ) :
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :    AliPreprocessor(&quot;TRD&quot;,0),</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :    fCalDCSObjSOR(0),</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :    fCalDCSObjEOR(0),</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :    fVdriftHLT(0)</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      95 </span>            :   
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   Fatal(&quot;AliTRDPreprocessor&quot;, &quot;copy constructor not implemented&quot;);</span>
<span class="lineNum">      97 </span>            :   
<a name="98"><span class="lineNum">      98 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      99 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     100 </span>            : AliTRDPreprocessor::~AliTRDPreprocessor()
<span class="lineNum">     101 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     102 </span>            :   //
<span class="lineNum">     103 </span>            :   // Destructor
<span class="lineNum">     104 </span>            :   //
<span class="lineNum">     105 </span>            : 
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   if (fCalDCSObjSOR ) delete fCalDCSObjSOR;</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   if (fCalDCSObjEOR ) delete fCalDCSObjEOR;</span>
<span class="lineNum">     108 </span>            : 
<a name="109"><span class="lineNum">     109 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     110 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     111 </span>            : AliTRDPreprocessor&amp; AliTRDPreprocessor::operator = (const AliTRDPreprocessor&amp; )
<span class="lineNum">     112 </span>            : {
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :   Fatal(&quot;operator =&quot;, &quot;assignment operator not implemented&quot;);</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :   return *this;</span>
<a name="115"><span class="lineNum">     115 </span>            : }</a>
<span class="lineNum">     116 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     117 </span>            : void AliTRDPreprocessor::Initialize(Int_t run, UInt_t startTime, UInt_t endTime)
<span class="lineNum">     118 </span>            : {
<span class="lineNum">     119 </span>            :   //
<span class="lineNum">     120 </span>            :   // Initialization routine for the TRD preprocessor
<span class="lineNum">     121 </span>            :   //
<span class="lineNum">     122 </span>            : 
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :   AliPreprocessor::Initialize(run,startTime,endTime);</span>
<span class="lineNum">     124 </span>            :   
<span class="lineNum">     125 </span><span class="lineNoCov">          0 : }</span>
<a name="126"><span class="lineNum">     126 </span>            : </a>
<span class="lineNum">     127 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     128 </span>            : UInt_t AliTRDPreprocessor::Process(TMap* dcsAliasMap)
<span class="lineNum">     129 </span>            : {
<span class="lineNum">     130 </span>            :   //
<span class="lineNum">     131 </span>            :   // Process DCS and calibration part for HLT
<span class="lineNum">     132 </span>            :   //
<span class="lineNum">     133 </span>            : 
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :   const TString runType = GetRunType();</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :   Log(Form(&quot;runtype %s\n&quot;,runType.Data()));</span>
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :   // We initialize the return values of all 
<span class="lineNum">     138 </span>            :   // subfunctions to zero, ie 'good'
<span class="lineNum">     139 </span>            :   Int_t DCSConfigReturn = 0;
<span class="lineNum">     140 </span>            :   Int_t pedastalReturn  = 0;
<span class="lineNum">     141 </span>            :   Int_t DCSReturn       = 0;
<span class="lineNum">     142 </span>            :   Int_t HLTReturn       = 0;
<span class="lineNum">     143 </span>            :   Int_t DAQReturn       = 0;
<span class="lineNum">     144 </span>            :   
<span class="lineNum">     145 </span>            :   // Always process the configuration data
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :   DCSConfigReturn = ProcessDCSConfigData();</span>
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span>            :   // Extract pedastals in pedastal runs
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   if (runType==&quot;PEDESTAL&quot;){</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     pedastalReturn = ExtractPedestals();</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            :   // Process the DCS sensors
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :   if ((runType==&quot;PHYSICS&quot;) || (runType==&quot;STANDALONE&quot;) || (runType==&quot;DAQ&quot;)){</span>
<span class="lineNum">     155 </span>            :     // DCS
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :     DCSReturn = ProcessDCS(dcsAliasMap);</span>
<span class="lineNum">     157 </span>            : 
<span class="lineNum">     158 </span>            :     /*
<span class="lineNum">     159 </span>            :     if(runType==&quot;PHYSICS&quot;){
<span class="lineNum">     160 </span>            :       // HLT if On
<span class="lineNum">     161 </span>            :       //TString runPar = GetRunParameter(&quot;HLTStatus&quot;);
<span class="lineNum">     162 </span>            :       //if(runPar==&quot;1&quot;) {
<span class="lineNum">     163 </span>            :       if(GetHLTStatus()) {
<span class="lineNum">     164 </span>            :         HLTReturn = ExtractHLT();
<span class="lineNum">     165 </span>            :       } 
<span class="lineNum">     166 </span>            :       // DAQ if HLT failed
<span class="lineNum">     167 </span>            :       if(!fVdriftHLT) {
<span class="lineNum">     168 </span>            :         DAQReturn = ExtractDriftVelocityDAQ();
<span class="lineNum">     169 </span>            :       }
<span class="lineNum">     170 </span>            :     }
<span class="lineNum">     171 </span>            :     */
<span class="lineNum">     172 </span>            :    
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span>            :   // Check for any errors
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   if(DCSConfigReturn || pedastalReturn || DCSReturn</span>
<span class="lineNum">     177 </span>            :      || HLTReturn || DAQReturn){
<span class="lineNum">     178 </span>            :     // Error
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     Log(Form(&quot;ERROR - Listing return values for subfunctions (0=good)&quot;));</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     Log(Form(&quot;DCSConfig %d, pedastal %d, DCS %d, HLT %d, DAQ %d&quot;</span>
<span class="lineNum">     181 </span>            :              ,DCSConfigReturn,pedastalReturn,DCSReturn
<span class="lineNum">     182 </span>            :              ,HLTReturn,DAQReturn));
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :     return 1;</span>
<span class="lineNum">     184 </span>            :   }
<span class="lineNum">     185 </span>            :   else{
<span class="lineNum">     186 </span>            :     // Good
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :     Log(Form(&quot;SUCCESS All subfuntions returned without error&quot;));</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     189 </span>            :   }
<a name="190"><span class="lineNum">     190 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     191 </span>            : //______________________________________________________________________________
<span class="lineNum">     192 </span>            : Bool_t AliTRDPreprocessor::ProcessDCS()
<span class="lineNum">     193 </span>            : {
<span class="lineNum">     194 </span>            :   //
<span class="lineNum">     195 </span>            :   // Default process DCS method
<span class="lineNum">     196 </span>            :   //
<span class="lineNum">     197 </span>            : 
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :   TString runType = GetRunType();</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   if ((runType == &quot;PHYSICS&quot;) || (runType == &quot;STANDALONE&quot;)) {</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     201 </span>            :   }
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :   return kFALSE;</span>
<span class="lineNum">     203 </span>            : 
<span class="lineNum">     204 </span><span class="lineNoCov">          0 : }</span>
<a name="205"><span class="lineNum">     205 </span>            : </a>
<span class="lineNum">     206 </span>            : //______________________________________________________________________________
<span class="lineNum">     207 </span>            : Bool_t AliTRDPreprocessor::ProcessDCS(TMap *dcsAliasMap)
<span class="lineNum">     208 </span>            : {
<span class="lineNum">     209 </span>            :   //
<span class="lineNum">     210 </span>            :   // Process DCS method
<span class="lineNum">     211 </span>            :   //
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            :   Bool_t error = kFALSE;
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData;</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :   metaData.SetResponsible(&quot;Wilfried Monange/Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :   metaData.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   Log(&quot;****** DCS ******\n&quot;);</span>
<span class="lineNum">     221 </span>            :         
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :   TObjArray * list=AliTRDSensorArray::GetList();</span>
<span class="lineNum">     223 </span>            :         
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :   if (list == 0x0) {</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     Log (&quot;Error during AliTRDSensorArray::GetList&quot;);</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :     Log (&quot;DCS will not be processing&quot;);</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     228 </span>            :   }
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :   const Int_t nEntries = list-&gt;GetEntries ();</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   Log (Form (&quot;%d alias loaded&quot;, nEntries));</span>
<span class="lineNum">     232 </span>            :                 
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   Bool_t results[nEntries];</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :   Int_t  nGraph[nEntries];</span>
<span class="lineNum">     235 </span>            :                 
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :   for (Int_t iAlias = 0; iAlias &lt; nEntries; iAlias++) {</span>
<span class="lineNum">     237 </span>            :                         
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :     AliTRDSensorArray * oneTRDDCS = (AliTRDSensorArray *)list-&gt;At (iAlias);</span>
<span class="lineNum">     239 </span>            :                         
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :     oneTRDDCS-&gt;SetStartTime (TTimeStamp (fStartTime));</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :     oneTRDDCS-&gt;SetEndTime (TTimeStamp (fEndTime));</span>
<span class="lineNum">     242 </span>            :                         
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     Log(Form(&quot;Processing DCS : \&quot;%s\&quot;&quot;, oneTRDDCS-&gt;GetStoreName ().Data ()));</span>
<span class="lineNum">     244 </span>            :                         
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :     TMap *map=oneTRDDCS-&gt;ExtractDCS (dcsAliasMap);</span>
<span class="lineNum">     246 </span>            :                 
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     nGraph [iAlias] = map-&gt;GetEntries ();</span>
<span class="lineNum">     248 </span>            :                 
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :     if (nGraph [iAlias] == 0) {</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       Log(&quot;No TGraph for this dcsDatapointAlias : not stored&quot;);</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :       results [iAlias] = kFALSE;</span>
<span class="lineNum">     252 </span>            :       //error  = kTRUE;
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       delete map;</span>
<span class="lineNum">     254 </span>            :       map=0;
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     256 </span>            :     }
<span class="lineNum">     257 </span>            :                 
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :     oneTRDDCS-&gt;SetGraph(map);</span>
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span>            :     // Remove duplicate entries where the value did not change
<span class="lineNum">     261 </span>            :     // more than a relative precision. We take a std precision 
<span class="lineNum">     262 </span>            :     // of 1e-4 and apply a higher precision for special cases
<span class="lineNum">     263 </span>            :     Double_t precision=1e-4;
<span class="lineNum">     264 </span>            :     // precision 1e-5 for HV
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :     if( oneTRDDCS-&gt;GetStoreName().Contains(&quot;trd_hvAnodeUmon&quot;) ||</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         oneTRDDCS-&gt;GetStoreName().Contains(&quot;trd_hvDriftUmon&quot;) ){</span>
<span class="lineNum">     267 </span>            :       precision=1e-5;
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     oneTRDDCS-&gt;RemoveGraphDuplicates(precision);</span>
<span class="lineNum">     270 </span>            :     // Remove HV anode current points below a threshold (in uA)
<span class="lineNum">     271 </span>            :     // when both neighbors are also below threshold
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :     if(oneTRDDCS-&gt;GetStoreName().Contains(&quot;trd_hvAnodeImon&quot;)){</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :       oneTRDDCS-&gt;RemoveAbsBelowThreshold(0.010);</span>
<span class="lineNum">     274 </span>            :     }
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :     if(oneTRDDCS-&gt;GetStoreName().Contains(&quot;trd_hvDriftImon&quot;)){</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :       oneTRDDCS-&gt;RemoveAbsBelowThreshold(0.10);</span>
<span class="lineNum">     277 </span>            :     }
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            :     // Store the data point
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :     results[iAlias]=Store(&quot;Calib&quot;, oneTRDDCS-&gt;GetStoreName().Data(), oneTRDDCS, &amp;metaData, 0, kFALSE); </span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :     delete map;</span>
<span class="lineNum">     282 </span>            :     map=0;
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :     oneTRDDCS-&gt;ClearGraph();</span>
<span class="lineNum">     284 </span>            :     //results [iAlias] = StoreReferenceData(&quot;Calib&quot;, oneTRDDCS-&gt;GetStoreName ().Data (), oneTRDDCS, &amp;metaData); 
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :     if (!results[iAlias]) {</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :       AliError(&quot;Problem during StoreRef DCS&quot;);</span>
<span class="lineNum">     288 </span>            :       //error=kTRUE;
<span class="lineNum">     289 </span>            :     }
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span>            :     //BEGIN TEST (should not be removed ...)
<span class="lineNum">     292 </span>            :     /*
<span class="lineNum">     293 </span>            :     oneTRDDCS-&gt;ClearGraph();
<span class="lineNum">     294 </span>            :     oneTRDDCS-&gt;ClearFit();
<span class="lineNum">     295 </span>            :     oneTRDDCS-&gt;SetDiffCut2 (0.1);
<span class="lineNum">     296 </span>            :     map=oneTRDDCS-&gt;ExtractDCS (dcsAliasMap);
<span class="lineNum">     297 </span>            :     oneTRDDCS-&gt;SetGraph (map);
<span class="lineNum">     298 </span>            :     Store(&quot;Calib&quot;, (&quot;cut_&quot;+oneTRDDCS-&gt;GetStoreName()).Data(), oneTRDDCS, &amp;metaData, 0, kTRUE); 
<span class="lineNum">     299 </span>            :     delete map;
<span class="lineNum">     300 </span>            : 
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span>            :     if(iAlias==1 || iAlias==19) continue;
<span class="lineNum">     303 </span>            :     
<span class="lineNum">     304 </span>            :     oneTRDDCS-&gt;ClearGraph();
<span class="lineNum">     305 </span>            :     oneTRDDCS-&gt;ClearFit();
<span class="lineNum">     306 </span>            :     oneTRDDCS-&gt;SetDiffCut2(0);
<span class="lineNum">     307 </span>            :     map=oneTRDDCS-&gt;ExtractDCS(dcsAliasMap);
<span class="lineNum">     308 </span>            :     oneTRDDCS-&gt;MakeSplineFit(map);
<span class="lineNum">     309 </span>            :     Store(&quot;Calib&quot;, (&quot;fit_&quot;+oneTRDDCS-&gt;GetStoreName()).Data() , oneTRDDCS, &amp;metaData, 0, kTRUE); 
<span class="lineNum">     310 </span>            :     delete map;
<span class="lineNum">     311 </span>            : 
<span class="lineNum">     312 </span>            :      
<span class="lineNum">     313 </span>            :     oneTRDDCS-&gt;ClearGraph(); 
<span class="lineNum">     314 </span>            :     oneTRDDCS-&gt;ClearFit();
<span class="lineNum">     315 </span>            :     oneTRDDCS-&gt;SetDiffCut2 (0.1);
<span class="lineNum">     316 </span>            :     map=oneTRDDCS-&gt;ExtractDCS (dcsAliasMap);
<span class="lineNum">     317 </span>            :     oneTRDDCS-&gt;MakeSplineFit(map);
<span class="lineNum">     318 </span>            :     Store(&quot;Calib&quot;, (&quot;cutfit_&quot;+oneTRDDCS-&gt;GetStoreName()).Data() , oneTRDDCS, &amp;metaData, 0, kTRUE); 
<span class="lineNum">     319 </span>            :     delete map;
<span class="lineNum">     320 </span>            :     */    
<span class="lineNum">     321 </span>            :     //END TEST
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span>            :   // Check errors
<span class="lineNum">     326 </span>            :   Int_t nbCount = 0;
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   for (Int_t iAlias = 0; iAlias &lt; nEntries; iAlias++) {</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :     if (results[iAlias]) {</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :       nbCount++;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     331 </span>            :   }
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   if(nbCount == 0) error = kTRUE;</span>
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span>            :                 
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   Log (&quot;         Summury of DCS :\n&quot;);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   Log (Form(&quot;%30s %10s %10s&quot;, &quot;dcsDatapointAlias&quot;, &quot;Stored ?&quot;, &quot;# graph&quot;));</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :   for (Int_t iAlias = 0; iAlias &lt; nEntries; iAlias++) {</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :     AliTRDSensorArray * oneTRDDCS = (AliTRDSensorArray *)list-&gt;At (iAlias);</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :     Log (Form (&quot;%30s %10s %4d&quot;, </span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :                oneTRDDCS-&gt;GetStoreName ().Data (),</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :                results[iAlias] ? &quot;ok&quot; : &quot;X&quot;,</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :                nGraph [iAlias]));</span>
<span class="lineNum">     343 </span>            :   }
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :   Log (&quot;*********** End of DCS **********&quot;);</span>
<span class="lineNum">     345 </span>            :   
<span class="lineNum">     346 </span>            :   // Clean up
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   delete list;</span>
<span class="lineNum">     348 </span>            :   list=0;
<span class="lineNum">     349 </span>            :   
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :   return error;</span>
<span class="lineNum">     351 </span>            : 
<a name="352"><span class="lineNum">     352 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     353 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     354 </span>            : Bool_t AliTRDPreprocessor::ExtractHalfChamberStatusDAQ()
<span class="lineNum">     355 </span>            : {
<span class="lineNum">     356 </span>            :   //
<span class="lineNum">     357 </span>            :   // Half chamber status algorithm running on DAQ
<span class="lineNum">     358 </span>            :   //
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span>            :   Bool_t error = kFALSE;
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData;</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   metaData.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   metaData.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     366 </span>            :   
<span class="lineNum">     367 </span>            :   // Take the output of the DA on DAQ
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :   TList * listpad = GetFileSources(kDAQ,&quot;HALFCHAMBERSTATUS&quot;);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :   if (!listpad) {</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :     Log(&quot;No list found for the HalfChamberStatus&quot;);</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     372 </span>            :   }
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   AliTRDCalibChamberStatus *calPed = 0x0;</span>
<span class="lineNum">     375 </span>            :     
<span class="lineNum">     376 </span>            :   // loop through all files (only one normally)
<span class="lineNum">     377 </span>            :   UInt_t index = 0;
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   while (listpad-&gt;At(index)!=NULL) {</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :     TObjString* fileNameEntry = (TObjString*) listpad-&gt;At(index);</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :     if (fileNameEntry != NULL)</span>
<span class="lineNum">     381 </span>            :       {
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :         TString fileName = GetFile(kDAQ, &quot;HALFCHAMBERSTATUS&quot;,</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :                                    fileNameEntry-&gt;GetString().Data());</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :         if(fileName.Length() ==0){</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Error by retrieving the file %d for the halfchamberstatus&quot;,(Int_t)index));</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :           delete listpad;</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :           return kTRUE;</span>
<span class="lineNum">     388 </span>            :         }
<span class="lineNum">     389 </span>            :         
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :         TFile *f = TFile::Open(fileName);</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :         f-&gt;GetObject(&quot;calibchamberstatus&quot;,calPed);</span>
<span class="lineNum">     392 </span>            :         
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :         if(calPed) {</span>
<span class="lineNum">     394 </span>            :           
<span class="lineNum">     395 </span>            :           // store as reference data
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :           TString name(&quot;HalfChamberStatus&quot;);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :           if(!StoreReferenceData(&quot;DAQData&quot;,(const char *)name,(TObject *) calPed,&amp;metaData)){</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :             Log(Form(&quot;Error storing AliTRDCalibPadStatus object %d as reference data&quot;,(Int_t)index));</span>
<span class="lineNum">     399 </span>            :             error = kTRUE;
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :         } // calPed</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :         else Log(Form(&quot;Error getting AliTRDCalibChamberStatus onject from file&quot;));</span>
<span class="lineNum">     403 </span>            :                  
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :       } // fileNameEntry</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     ++index;</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :   }// while (list)</span>
<span class="lineNum">     407 </span>            : 
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   Log(Form(&quot;%d elements found in the list for the halfchamberstatus&quot;,(Int_t)index));</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   if(index!=1){</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     412 </span>            :   }
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span>            :   //
<span class="lineNum">     415 </span>            :   // Produce the AliTRDCalChamberStatus  name calHalfChamberStatus
<span class="lineNum">     416 </span>            :   //
<span class="lineNum">     417 </span>            :   AliTRDCalChamberStatus *calHalfChamberStatus = 0x0;
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :   if(calPed) {</span>
<span class="lineNum">     419 </span>            :     //calPed-&gt;AnalyseHisto();   // check number of events, create calHalfChamberStatus (done on DAQ)
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :     if(fCalDCSObjEOR) {</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :       calPed-&gt;CheckEORStatus((AliTRDCalDCSv2 *)fCalDCSObjEOR);</span>
<span class="lineNum">     422 </span>            :     }
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :     calHalfChamberStatus=(AliTRDCalChamberStatus *)calPed-&gt;GetCalChamberStatus();</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span>            :   //
<span class="lineNum">     427 </span>            :   // Store  
<span class="lineNum">     428 </span>            :   //  
<span class="lineNum">     429 </span>            : 
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   AliCDBMetaData md3; </span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   md3.SetObjectClassName(&quot;AliTRDCalChamberStatus&quot;);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :   md3.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :   md3.SetBeamPeriod(1);</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :   md3.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   if(!Store(&quot;Calib&quot;,&quot;ChamberStatus&quot;    ,(TObject *)calHalfChamberStatus, &amp;md3, 0, kTRUE)){</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :     Log(&quot;Error storing the pedestal&quot;);</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     439 </span>            :   }
<span class="lineNum">     440 </span>            :   
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   delete listpad;</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   return error; </span>
<span class="lineNum">     443 </span>            :   
<a name="444"><span class="lineNum">     444 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     445 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     446 </span>            : Bool_t AliTRDPreprocessor::ExtractPedestals()
<span class="lineNum">     447 </span>            : {
<span class="lineNum">     448 </span>            :   //
<span class="lineNum">     449 </span>            :   // Pedestal running on LDCs at the DAQ
<span class="lineNum">     450 </span>            :   //
<span class="lineNum">     451 </span>            : 
<span class="lineNum">     452 </span>            :   //
<span class="lineNum">     453 </span>            :   // The reference data are stored in:
<span class="lineNum">     454 </span>            :   // PadStatus1 for sm-00-01-02-09-10-11
<span class="lineNum">     455 </span>            :   // PadStatus2 for sm-03-04-05-12-13-14
<span class="lineNum">     456 </span>            :   // PadStatus3 for sm-06-07-08-15-16-17
<span class="lineNum">     457 </span>            :   // PadStatus0 if nothing found..means problems
<span class="lineNum">     458 </span>            :   //
<span class="lineNum">     459 </span>            : 
<span class="lineNum">     460 </span>            :   Bool_t error = kFALSE;
<span class="lineNum">     461 </span>            : 
<span class="lineNum">     462 </span>            :   // Init a AliTRDCalibPadStatus
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :   AliTRDCalibPadStatus calPedSum = AliTRDCalibPadStatus();</span>
<span class="lineNum">     464 </span>            : 
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData;</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :   metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :   metaData.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :   metaData.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     469 </span>            :   
<span class="lineNum">     470 </span>            :   // Sum the contributions of the LDCs
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :   TList * listpad = GetFileSources(kDAQ,&quot;PADSTATUS&quot;);</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :   if (!listpad) {</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :     Log(&quot;No list found for the PEDESTRAL Run&quot;);</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     475 </span>            :   }
<span class="lineNum">     476 </span>            :   
<span class="lineNum">     477 </span>            :   // loop through all files from LDCs  
<span class="lineNum">     478 </span>            :   UInt_t index = 0;
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :   while (listpad-&gt;At(index)!=NULL) {</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :     TObjString* fileNameEntry = (TObjString*) listpad-&gt;At(index);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :     if (fileNameEntry != NULL)</span>
<span class="lineNum">     482 </span>            :       {
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :         TString fileName = GetFile(kDAQ, &quot;PADSTATUS&quot;,</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :                                    fileNameEntry-&gt;GetString().Data());</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :         if(fileName.Length() ==0){</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Error by retrieving the file %d for the pedestal&quot;,(Int_t)index));</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :           delete listpad;</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :           return kTRUE;</span>
<span class="lineNum">     489 </span>            :         }
<span class="lineNum">     490 </span>            :         
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :         TFile *f = TFile::Open(fileName);</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :         AliTRDCalibPadStatus *calPed;</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :         f-&gt;GetObject(&quot;calibpadstatus&quot;,calPed);</span>
<span class="lineNum">     494 </span>            :         
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :         if(calPed){</span>
<span class="lineNum">     496 </span>            :           
<span class="lineNum">     497 </span>            :           // analyse
<span class="lineNum">     498 </span>            :           //calPed-&gt;AnalyseHisto();
<span class="lineNum">     499 </span>            :                   
<span class="lineNum">     500 </span>            :           // Add to the calPedSum
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :           for (Int_t idet=0; idet&lt;540; idet++) {</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :             AliTRDCalROC *rocMean  = calPed-&gt;GetCalRocMean(idet, kFALSE);</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :             if ( rocMean )  {</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :               calPedSum.SetCalRocMean(rocMean,idet);</span>
<span class="lineNum">     505 </span>            :             }
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :             AliTRDCalROC *rocRMS = calPed-&gt;GetCalRocRMS(idet, kFALSE);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :             if ( rocRMS )  {</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :               calPedSum.SetCalRocRMS(rocRMS,idet);</span>
<span class="lineNum">     509 </span>            :             }
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :             AliTRDCalROC *rocMeand  = calPed-&gt;GetCalRocMeand(idet, kFALSE);</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :             if ( rocMeand )  {</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :               calPedSum.SetCalRocMeand(rocMeand,idet);</span>
<span class="lineNum">     513 </span>            :             }
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :             AliTRDCalROC *rocRMSd = calPed-&gt;GetCalRocRMSd(idet, kFALSE);</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :             if ( rocRMSd )  {</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :               calPedSum.SetCalRocRMSd(rocRMSd,idet);</span>
<span class="lineNum">     517 </span>            :             }
<span class="lineNum">     518 </span>            :           }// det loop
<span class="lineNum">     519 </span>            : 
<span class="lineNum">     520 </span>            :           // store as reference data
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :           TString name(&quot;PadStatus&quot;);</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :           name += index;</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :           if(!StoreReferenceData(&quot;DAQData&quot;,(const char *)name,(TObject *) calPed,&amp;metaData)){</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :             Log(Form(&quot;Error storing AliTRDCalibPadStatus object %d as reference data&quot;,(Int_t)index));</span>
<span class="lineNum">     525 </span>            :             error = kTRUE;
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :         } // calPed</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :       } // fileNameEntry</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     ++index;</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :   }// while (list)</span>
<span class="lineNum">     532 </span>            : 
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :   Log(Form(&quot;%d elements found in the list for the pedestal&quot;,(Int_t)index));</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :   if(index==0){</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     537 </span>            :   }
<span class="lineNum">     538 </span>            : 
<span class="lineNum">     539 </span>            :   //
<span class="lineNum">     540 </span>            :   // Create pedestal 
<span class="lineNum">     541 </span>            :   //
<span class="lineNum">     542 </span>            :     
<span class="lineNum">     543 </span>            :   // Create Pad Status
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :   AliTRDCalPadStatus *calPadStatus = calPedSum.CreateCalPadStatus();</span>
<span class="lineNum">     545 </span>            :   // Create Noise 
<span class="lineNum">     546 </span>            :   //Make the AliTRDCalPad
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   AliTRDCalPad *calPad2 = calPedSum.CreateCalPad();</span>
<span class="lineNum">     548 </span>            :   //Make the AliTRDCalDet correspondant
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :   AliTRDCalDet *calDet = calPedSum.CreateCalDet();</span>
<span class="lineNum">     550 </span>            :  
<span class="lineNum">     551 </span>            :   //
<span class="lineNum">     552 </span>            :   // Take the noise and Pad status from the previous OCDB
<span class="lineNum">     553 </span>            :   //
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span>            :   AliTRDCalPad *calPadPrevious=0;
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :   AliCDBEntry* entry = GetFromOCDB(&quot;Calib&quot;, &quot;PadNoise&quot;);</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :   if (entry) calPadPrevious = (AliTRDCalPad*)entry-&gt;GetObject();</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :   if ( calPadPrevious==NULL ) {</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :      Log(&quot;AliTRDPreprocsessor: No previous TRD pad noise entry available.\n&quot;);</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :      calPadPrevious = new AliTRDCalPad(&quot;PadNoise&quot;, &quot;PadNoise&quot;);</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     562 </span>            : 
<span class="lineNum">     563 </span>            :   AliTRDCalPadStatus *calPadStatusPrevious=0;
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :   entry = GetFromOCDB(&quot;Calib&quot;, &quot;PadStatus&quot;);</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :   if (entry) calPadStatusPrevious = (AliTRDCalPadStatus*)entry-&gt;GetObject();</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :   if ( calPadStatusPrevious==NULL ) {</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :     Log(&quot;AliTRDPreprocsessor: No previous TRD pad status entry available.\n&quot;);</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :     calPadStatusPrevious = new AliTRDCalPadStatus(&quot;padstatus&quot;, &quot;padstatus&quot;);</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     for (Int_t idet=0; idet&lt;540; ++idet)</span>
<span class="lineNum">     570 </span>            :       {
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :         AliTRDCalSingleChamberStatus *calROC = calPadStatusPrevious-&gt;GetCalROC(idet);</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :         for(Int_t k = 0; k &lt; calROC-&gt;GetNchannels(); k++){</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :           calROC-&gt;SetStatus(k,AliTRDCalPadStatus::kMasked);</span>
<span class="lineNum">     574 </span>            :         }
<span class="lineNum">     575 </span>            :       }
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     577 </span>            : 
<span class="lineNum">     578 </span>            :   
<span class="lineNum">     579 </span>            :   // Loop over detectors for check
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :   for (Int_t det=0; det&lt;AliTRDgeometry::kNdet; ++det)  {</span>
<span class="lineNum">     581 </span>            :     
<span class="lineNum">     582 </span>            :     // noise
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :     AliTRDCalROC *calROCPreviousNoise = calPadPrevious-&gt;GetCalROC(det);</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     AliTRDCalROC *calROCNoise         = calPad2-&gt;GetCalROC(det);</span>
<span class="lineNum">     585 </span>            : 
<span class="lineNum">     586 </span>            :     // padstatus
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :     AliTRDCalSingleChamberStatus *calROCPreviousStatus = calPadStatusPrevious-&gt;GetCalROC(det);</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :     AliTRDCalSingleChamberStatus *calROCStatus         = calPadStatus-&gt;GetCalROC(det);</span>
<span class="lineNum">     589 </span>            :     
<span class="lineNum">     590 </span>            :     
<span class="lineNum">     591 </span>            :     // loop over first half and second half chamber
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     for(Int_t half = 0; half &lt; 2; half++){</span>
<span class="lineNum">     593 </span>            : 
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :       Bool_t data         = AreThereDataPedestal(calROCStatus,(Bool_t)half);</span>
<span class="lineNum">     595 </span>            :       //printf(&quot;There are data for the detector %d the half %d: %d\n&quot;,det,half,data);
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :       if(!data){</span>
<span class="lineNum">     597 </span>            :         // look if data in the OCDB
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :         Bool_t dataPrevious = AreThereDataPedestal(calROCPreviousStatus,(Bool_t)half);</span>
<span class="lineNum">     599 </span>            :         // if no data at all, set to default value
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :         if(!dataPrevious){</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :           SetDefaultStatus(*calROCStatus,(Bool_t)half);</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :           SetDefaultNoise(*calROCNoise,(Bool_t)half);</span>
<span class="lineNum">     603 </span>            :         }
<span class="lineNum">     604 </span>            :         else{
<span class="lineNum">     605 </span>            :           // if data, set to previous value
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :           SetStatus(*calROCStatus,calROCPreviousStatus,(Bool_t)half);</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :           SetNoise(*calROCNoise,calROCPreviousNoise,(Bool_t)half);</span>
<span class="lineNum">     608 </span>            :         }
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     610 </span>            :     }
<span class="lineNum">     611 </span>            :   }
<span class="lineNum">     612 </span>            :   
<span class="lineNum">     613 </span>            :   //
<span class="lineNum">     614 </span>            :   // Store  
<span class="lineNum">     615 </span>            :   //  
<span class="lineNum">     616 </span>            : 
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :   AliCDBMetaData md3; </span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :   md3.SetObjectClassName(&quot;AliTRDCalPadStatus&quot;);</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :   md3.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :   md3.SetBeamPeriod(1);</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :   md3.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :   if(!Store(&quot;Calib&quot;,&quot;PadStatus&quot;    ,(TObject *)calPadStatus, &amp;md3, 0, kTRUE)){</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :     Log(&quot;Error storing the pedestal&quot;);</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     626 </span>            :   }
<span class="lineNum">     627 </span>            : 
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :   AliCDBMetaData md4; </span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :   md4.SetObjectClassName(&quot;AliTRDCalPad&quot;);</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :   md4.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :   md4.SetBeamPeriod(1);</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :   md4.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :   if(!Store(&quot;Calib&quot;,&quot;PadNoise&quot;    ,(TObject *)calPad2, &amp;md4, 0, kTRUE)){</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     Log(&quot;Error storing the pedestal&quot;);</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     637 </span>            :   }
<span class="lineNum">     638 </span>            :   
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :   AliCDBMetaData md5; </span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :   md5.SetObjectClassName(&quot;AliTRDCalDet&quot;);</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :   md5.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :   md5.SetBeamPeriod(1);</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :   md5.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :   if(!Store(&quot;Calib&quot;,&quot;DetNoise&quot;    ,(TObject *)calDet, &amp;md5, 0, kTRUE)){</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     Log(&quot;Error storing the pedestal&quot;);</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :     delete listpad;</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     648 </span>            :   }  
<span class="lineNum">     649 </span>            : 
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :   delete listpad;</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :   return error; </span>
<span class="lineNum">     652 </span>            :   
<span class="lineNum">     653 </span><span class="lineNoCov">          0 : }</span>
<a name="654"><span class="lineNum">     654 </span>            : </a>
<span class="lineNum">     655 </span>            : //__________________________________________________________________
<span class="lineNum">     656 </span>            : Bool_t AliTRDPreprocessor::AreThereDataPedestal(const AliTRDCalSingleChamberStatus * const calROCStatus
<span class="lineNum">     657 </span>            :                                               , Bool_t second)
<span class="lineNum">     658 </span>            : {
<span class="lineNum">     659 </span>            : 
<span class="lineNum">     660 </span>            :   //
<span class="lineNum">     661 </span>            :   // Data for this half chamber
<span class="lineNum">     662 </span>            :   //
<span class="lineNum">     663 </span>            : 
<span class="lineNum">     664 </span>            :   Bool_t data         = kFALSE;
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :   Int_t nCols         = calROCStatus-&gt;GetNcols();</span>
<span class="lineNum">     666 </span>            :   Int_t nCol0         = 0;
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :   Int_t nColE         = (Int_t) nCols/2 - 2;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :   if(second) {</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :     nCol0 = nColE + 4;</span>
<span class="lineNum">     670 </span>            :     nColE = nCols;
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     672 </span>            : 
<span class="lineNum">     673 </span>            :   Int_t totalnumberofpads = 0;
<span class="lineNum">     674 </span>            :   Int_t totalnumberofdata = 0; 
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :   for(Int_t col = nCol0; col &lt; nColE; col++){</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     for(Int_t row = 0; row &lt; calROCStatus-&gt;GetNrows(); row++){</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :       totalnumberofpads++;</span>
<span class="lineNum">     679 </span>            :       //printf(&quot;ismasked %d\n&quot;,(Int_t)calROCStatus-&gt;IsMasked(col,row));
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :       if(!calROCStatus-&gt;GetStatus(col,row)) {</span>
<span class="lineNum">     681 </span>            :         data = kTRUE;
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :         totalnumberofdata++;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     684 </span>            :     }
<span class="lineNum">     685 </span>            :   }
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :   if(totalnumberofdata &lt; (Int_t)(totalnumberofpads/2)) data = kFALSE;</span>
<span class="lineNum">     687 </span>            : 
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :   return data;</span>
<span class="lineNum">     689 </span>            :   
<a name="690"><span class="lineNum">     690 </span>            : }</a>
<span class="lineNum">     691 </span>            : //__________________________________________________________________
<span class="lineNum">     692 </span>            : void AliTRDPreprocessor::SetDefaultStatus(AliTRDCalSingleChamberStatus &amp;calROCStatus, Bool_t second){
<span class="lineNum">     693 </span>            : 
<span class="lineNum">     694 </span>            :   //
<span class="lineNum">     695 </span>            :   // default status for this half chamber
<span class="lineNum">     696 </span>            :   //
<span class="lineNum">     697 </span>            : 
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :   Int_t nCols         = calROCStatus.GetNcols();</span>
<span class="lineNum">     699 </span>            :   Int_t nCol0         = 0;
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   Int_t nColE         = (Int_t) nCols/2;</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :   if(second) {</span>
<span class="lineNum">     702 </span>            :     nCol0 = nColE;
<span class="lineNum">     703 </span>            :     nColE = nCols;
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :   for(Int_t col = nCol0; col &lt; nColE; col++){</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :     for(Int_t row = 0; row &lt; calROCStatus.GetNrows(); row++){</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :       calROCStatus.SetStatus(col,row,0);</span>
<span class="lineNum">     708 </span>            :     }
<span class="lineNum">     709 </span>            :   }
<a name="710"><span class="lineNum">     710 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     711 </span>            : //__________________________________________________________________
<span class="lineNum">     712 </span>            : void AliTRDPreprocessor::SetStatus(AliTRDCalSingleChamberStatus &amp;calROCStatus, AliTRDCalSingleChamberStatus *calROCStatusPrevious,Bool_t second){
<span class="lineNum">     713 </span>            : 
<span class="lineNum">     714 </span>            :   //
<span class="lineNum">     715 </span>            :   // previous status for this half chamber
<span class="lineNum">     716 </span>            :   //
<span class="lineNum">     717 </span>            : 
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :   Int_t nCols         = calROCStatus.GetNcols();</span>
<span class="lineNum">     719 </span>            :   Int_t nCol0         = 0;
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :   Int_t nColE         = (Int_t) nCols/2;</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :   if(second) {</span>
<span class="lineNum">     722 </span>            :     nCol0 = nColE;
<span class="lineNum">     723 </span>            :     nColE = nCols;
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :   for(Int_t col = nCol0; col &lt; nColE; col++){</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     for(Int_t row = 0; row &lt; calROCStatus.GetNrows(); row++){</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :       calROCStatus.SetStatus(col,row,calROCStatusPrevious-&gt;GetStatus(col,row));</span>
<span class="lineNum">     728 </span>            :     }
<span class="lineNum">     729 </span>            :   }
<a name="730"><span class="lineNum">     730 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     731 </span>            : //__________________________________________________________________
<span class="lineNum">     732 </span>            : void AliTRDPreprocessor::SetDefaultNoise(AliTRDCalROC &amp;calROCNoise, Bool_t second){
<span class="lineNum">     733 </span>            : 
<span class="lineNum">     734 </span>            :   //
<span class="lineNum">     735 </span>            :   // default noise for this half chamber
<span class="lineNum">     736 </span>            :   //
<span class="lineNum">     737 </span>            : 
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :   Int_t nCols         = calROCNoise.GetNcols();</span>
<span class="lineNum">     739 </span>            :   Int_t nCol0         = 0;
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :   Int_t nColE         = (Int_t) nCols/2;</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :   if(second) {</span>
<span class="lineNum">     742 </span>            :     nCol0 = nColE;
<span class="lineNum">     743 </span>            :     nColE = nCols;
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :   for(Int_t col = nCol0; col &lt; nColE; col++){</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :     for(Int_t row = 0; row &lt; calROCNoise.GetNrows(); row++){</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :       calROCNoise.SetValue(col,row,0.12);</span>
<span class="lineNum">     748 </span>            :     }
<span class="lineNum">     749 </span>            :   }
<a name="750"><span class="lineNum">     750 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     751 </span>            : //__________________________________________________________________
<span class="lineNum">     752 </span>            : void AliTRDPreprocessor::SetNoise(AliTRDCalROC &amp;calROCNoise, AliTRDCalROC *calROCNoisePrevious, Bool_t second){
<span class="lineNum">     753 </span>            : 
<span class="lineNum">     754 </span>            :   //
<span class="lineNum">     755 </span>            :   // previous noise for this half chamber
<span class="lineNum">     756 </span>            :   //
<span class="lineNum">     757 </span>            : 
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :   Int_t nCols         = calROCNoise.GetNcols();</span>
<span class="lineNum">     759 </span>            :   Int_t nCol0         = 0;
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :   Int_t nColE         = (Int_t) nCols/2;</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :   if(second) {</span>
<span class="lineNum">     762 </span>            :     nCol0 = nColE;
<span class="lineNum">     763 </span>            :     nColE = nCols;
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :   for(Int_t col = nCol0; col &lt; nColE; col++){</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     for(Int_t row = 0; row &lt; calROCNoise.GetNrows(); row++){</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :       calROCNoise.SetValue(col,row,calROCNoisePrevious-&gt;GetValue(col,row));</span>
<span class="lineNum">     768 </span>            :     }
<span class="lineNum">     769 </span>            :   }
<a name="770"><span class="lineNum">     770 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     771 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     772 </span>            : Bool_t AliTRDPreprocessor::ExtractDriftVelocityDAQ()
<span class="lineNum">     773 </span>            : {
<span class="lineNum">     774 </span>            :   //
<span class="lineNum">     775 </span>            :   // Drift velocity DA running on monitoring servers at the DAQ
<span class="lineNum">     776 </span>            :   //
<span class="lineNum">     777 </span>            : 
<span class="lineNum">     778 </span>            :   Bool_t error = kFALSE; 
<span class="lineNum">     779 </span>            : 
<span class="lineNum">     780 </span>            :   // Objects for HLT and DAQ zusammen
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :   AliTRDCalibraFit *calibra = AliTRDCalibraFit::Instance();</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData;</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :   metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :   metaData.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :   metaData.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     786 </span>            :   // Store the infos for the detector
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :   AliCDBMetaData md1; </span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :   md1.SetObjectClassName(&quot;AliTRDCalDet&quot;);</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :   md1.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :   md1.SetBeamPeriod(0);</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :   md1.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     792 </span>            :   // Store the infos for the pads
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :   AliCDBMetaData md2; </span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :   md2.SetObjectClassName(&quot;AliTRDCalPad&quot;);</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :   md2.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :   md2.SetBeamPeriod(0);</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :   md2.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     798 </span>            : 
<span class="lineNum">     799 </span>            :   // Take the file from the DAQ file exchange server
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :   TList *listdaq = GetFileSources(kDAQ,&quot;VDRIFT&quot;);</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :   if (!listdaq) {</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :     Log(&quot;No list found for vdrift (DAQ)&quot;);</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     804 </span>            :   }
<span class="lineNum">     805 </span>            :   
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :   if(listdaq-&gt;GetSize() !=1){</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :     Log(Form(&quot;Problem on the size of the list: %d (DAQ)&quot;,listdaq-&gt;GetSize()));</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :     delete listdaq;</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     810 </span>            :   }
<span class="lineNum">     811 </span>            :   
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :   TObjString* fileNameEntry = (TObjString*) listdaq-&gt;At(0);</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :   if(fileNameEntry != NULL){</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :     TString fileName = GetFile(kDAQ, &quot;VDRIFT&quot;,</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :                                fileNameEntry-&gt;GetString().Data());</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :     if(fileName.Length() ==0){</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :       Log(&quot;Error retrieving the file vdrift (DAQ)&quot;);</span>
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :       delete listdaq;</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :       return kTRUE;</span>
<span class="lineNum">     820 </span>            :     }
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     TFile *filedaq = TFile::Open(fileName);</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :     TProfile2D *histodriftvelocity = (TProfile2D *) filedaq-&gt;Get(&quot;PH2d&quot;);</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :     if (histodriftvelocity) {</span>
<span class="lineNum">     824 </span>            :       
<span class="lineNum">     825 </span>            :       // store as reference data
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :       if(!StoreReferenceData(&quot;DAQData&quot;,&quot;VdriftT0&quot;,(TObject *) histodriftvelocity,&amp;metaData)){</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :         Log(&quot;Error storing 2D Profile for vdrift from the DAQ&quot;);</span>
<span class="lineNum">     828 </span>            :         error = kTRUE;
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     830 </span>            :       
<span class="lineNum">     831 </span>            :       // analyse
<span class="lineNum">     832 </span>            :       
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :       Log(&quot;Take the PH reference data. Now we will try to fit\n&quot;);</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :       calibra-&gt;SetMinEntries(2000); // If there is less than 2000</span>
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :       calibra-&gt;AnalysePH(histodriftvelocity);</span>
<span class="lineNum">     836 </span>            :       
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :       Int_t nbtg = 6*4*18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb0(1))</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :         + 6*  18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb2(1));</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :       Int_t nbfit        = calibra-&gt;GetNumberFit();</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :       Int_t nbfitSuccess = calibra-&gt;GetNumberFitSuccess();</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :       Int_t nbE        = calibra-&gt;GetNumberEnt();</span>
<span class="lineNum">     842 </span>            :       
<span class="lineNum">     843 </span>            :       // if enough statistics store the results
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :       if ((nbtg &gt;                  0) &amp;&amp; </span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :           (nbfit        &gt;= 0.5*nbE) &amp;&amp; (nbE &gt; 30) &amp;&amp; (nbfitSuccess &gt; 30)) {</span>
<span class="lineNum">     846 </span>            :         // create the cal objects
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :         calibra-&gt;RemoveOutliers(1,kTRUE);</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :         calibra-&gt;PutMeanValueOtherVectorFit(1,kTRUE);</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :         calibra-&gt;RemoveOutliers2(kTRUE);</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :         calibra-&gt;PutMeanValueOtherVectorFit2(1,kTRUE);</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :         TObjArray object      = calibra-&gt;GetVectorFit();</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :         AliTRDCalDet *objdriftvelocitydet = calibra-&gt;CreateDetObjectVdrift(&amp;object,kTRUE);</span>
<span class="lineNum">     853 </span>            :         //      TObject *objdriftvelocitypad = calibra-&gt;CreatePadObjectVdrift();
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :         object              = calibra-&gt;GetVectorFit2();</span>
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :         AliTRDCalDet *objtime0det         = calibra-&gt;CreateDetObjectT0(&amp;object,kTRUE);</span>
<span class="lineNum">     856 </span>            :         //      TObject *objtime0pad         = calibra-&gt;CreatePadObjectT0();
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :         calibra-&gt;ResetVectorFit();</span>
<span class="lineNum">     858 </span>            :         // store
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :          if(!Store(&quot;Calib&quot;,&quot;ChamberVdrift&quot;    ,(TObject *) objdriftvelocitydet,&amp;md1,0,kTRUE)){</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :                   Log(&quot;Error storing the calibration object for the chamber vdrift (DAQ)&quot;);</span>
<span class="lineNum">     861 </span>            :                   error = kTRUE;
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                 if(!Store(&quot;Calib&quot;,&quot;ChamberT0&quot;        ,(TObject *) objtime0det        ,&amp;md1,0,kTRUE)){</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :                   Log(&quot;Error storing the calibration object for the chamber t0 (DAQ)&quot;);</span>
<span class="lineNum">     865 </span>            :                   error = kTRUE;
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     867 </span>            :         //      if(!Store(&quot;Calib&quot;,&quot;LocalVdrift&quot;      ,(TObject *) objdriftvelocitypad,&amp;md2,0,kTRUE)){
<span class="lineNum">     868 </span>            :         //        Log(&quot;Error storing the calibration object for the local drift velocity (DAQ)&quot;);
<span class="lineNum">     869 </span>            :         //        error = kTRUE;
<span class="lineNum">     870 </span>            :         //      }
<span class="lineNum">     871 </span>            :         //      if(!Store(&quot;Calib&quot;,&quot;LocalT0&quot;          ,(TObject *) objtime0pad        ,&amp;md2,0,kTRUE)){
<span class="lineNum">     872 </span>            :         //        Log(&quot;Error storing the calibration object for the local time0 (DAQ)&quot;);
<span class="lineNum">     873 </span>            :         //        error = kTRUE;
<span class="lineNum">     874 </span>            :         //      }
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     876 </span>            :       else{
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :         Log(&quot;Not enough statistics for the average pulse height (DAQ)&quot;);</span>
<span class="lineNum">     878 </span>            :       }
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     } // histo here</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :   }// if fileNameEntry</span>
<span class="lineNum">     881 </span>            :   
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :   delete listdaq; </span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :   return error; </span>
<span class="lineNum">     884 </span>            :   
<span class="lineNum">     885 </span><span class="lineNoCov">          0 : }</span>
<a name="886"><span class="lineNum">     886 </span>            : </a>
<span class="lineNum">     887 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     888 </span>            : Bool_t AliTRDPreprocessor::ExtractHLT()
<span class="lineNum">     889 </span>            : {
<span class="lineNum">     890 </span>            :   //
<span class="lineNum">     891 </span>            :   // Gain, vdrift and PRF calibration running on HLT
<span class="lineNum">     892 </span>            :   // return kTRUE if NULL pointer to the list
<span class="lineNum">     893 </span>            :   //
<span class="lineNum">     894 </span>            : 
<span class="lineNum">     895 </span>            :   Bool_t error = kFALSE;
<span class="lineNum">     896 </span>            : 
<span class="lineNum">     897 </span>            :   // Objects for HLT and DAQ zusammen
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :   AliTRDCalibraFit *calibra = AliTRDCalibraFit::Instance();</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData;</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :   metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :   metaData.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :   metaData.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     903 </span>            :   // Store the infos for the detector
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :   AliCDBMetaData md1; </span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :   md1.SetObjectClassName(&quot;AliTRDCalDet&quot;);</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :   md1.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :   md1.SetBeamPeriod(0);</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :   md1.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     909 </span>            :   // Store the infos for the pads
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :   AliCDBMetaData md2; </span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :   md2.SetObjectClassName(&quot;AliTRDCalPad&quot;);</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :   md2.SetResponsible(&quot;Raphaelle Bailhache&quot;);</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :   md2.SetBeamPeriod(0);</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :   md2.SetComment(&quot;TRD calib test&quot;);</span>
<span class="lineNum">     915 </span>            :   
<span class="lineNum">     916 </span>            :   // Take the file from the HLT file exchange server
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :   TList *listhlt = GetFileSources(kHLT,&quot;GAINDRIFTPRF&quot;);</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :   if (!listhlt) {</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :     Log(&quot;No list found for the HLT&quot;);</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     921 </span>            :   }
<span class="lineNum">     922 </span>            : 
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :   if(listhlt-&gt;GetSize() != 1) {</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :     Log(Form(&quot;Problem on the size of the list: %d (HLT)&quot;,listhlt-&gt;GetSize()));</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :     delete listhlt;</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     927 </span>            :   }
<span class="lineNum">     928 </span>            :   
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :   TObjString* fileNameEntry = (TObjString*) listhlt-&gt;At(0);</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :   if(fileNameEntry != NULL){</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :     TString fileName = GetFile(kHLT, &quot;GAINDRIFTPRF&quot;,</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :                                fileNameEntry-&gt;GetString().Data());</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :     if(fileName.Length() ==0){</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :       Log(&quot;Error retrieving the file (HLT)&quot;);</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :       delete listhlt;</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :       return kTRUE;</span>
<span class="lineNum">     937 </span>            :     }
<span class="lineNum">     938 </span>            :     // Take the file
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :     TFile *filehlt = TFile::Open(fileName);</span>
<span class="lineNum">     940 </span>            :     
<span class="lineNum">     941 </span>            :     // gain
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :     TH2I *histogain = (TH2I *) filehlt-&gt;Get(&quot;CH2d&quot;);</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :     if (histogain) {</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :       histogain-&gt;SetDirectory(0);</span>
<span class="lineNum">     945 </span>            :       // store the reference data
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :       if(!StoreReferenceData(&quot;HLTData&quot;,&quot;Gain&quot;,(TObject *) histogain,&amp;metaData)){</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :         Log(&quot;Error storing 2D histos for gain&quot;);</span>
<span class="lineNum">     948 </span>            :         error = kTRUE;
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     950 </span>            :       // analyse
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :       Log(&quot;Take the CH reference data. Now we will try to fit\n&quot;);</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :       calibra-&gt;SetMinEntries(800); // If there is less than 1000 entries in the histo: no fit</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :       calibra-&gt;AnalyseCH(histogain);</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :       Int_t nbtg = 6*4*18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb0(0))</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :         + 6*  18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb2(0));</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :       Int_t nbfit       = calibra-&gt;GetNumberFit();</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :       Int_t nbE         = calibra-&gt;GetNumberEnt();</span>
<span class="lineNum">     958 </span>            :       // enough statistics
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :       if ((nbtg &gt;                  0) &amp;&amp; </span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :           (nbfit        &gt;= 0.5*nbE) &amp;&amp; (nbE &gt; 30)) {</span>
<span class="lineNum">     961 </span>            :         // create the cal objects
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :         calibra-&gt;PutMeanValueOtherVectorFit(1,kTRUE);</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :         TObjArray object           = calibra-&gt;GetVectorFit();</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :         AliTRDCalDet *objgaindet   = calibra-&gt;CreateDetObjectGain(&amp;object);</span>
<span class="lineNum">     965 </span>            :         //      TObject *objgainpad        = calibra-&gt;CreatePadObjectGain();
<span class="lineNum">     966 </span>            :         // store them
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :         if(!Store(&quot;Calib&quot;,&quot;ChamberGainFactor&quot;,(TObject *) objgaindet         ,&amp;md1,0,kTRUE)){</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :           Log(&quot;Error storing the calibration object for the chamber gain&quot;);</span>
<span class="lineNum">     969 </span>            :           error = kTRUE;
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     971 </span>            :         //      if(!Store(&quot;Calib&quot;,&quot;LocalGainFactor&quot;  ,(TObject *) objgainpad         ,&amp;md2,0,kTRUE)){
<span class="lineNum">     972 </span>            :         //        Log(&quot;Error storing the calibration object for the local gain factor&quot;);
<span class="lineNum">     973 </span>            :         //        error = kTRUE;
<span class="lineNum">     974 </span>            :         //      }
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :       calibra-&gt;ResetVectorFit();</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :     }// if histogain</span>
<span class="lineNum">     978 </span>            :     
<span class="lineNum">     979 </span>            :     // vdrift
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :     fVdriftHLT = kFALSE;</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :     TProfile2D *histodriftvelocity = (TProfile2D *) filehlt-&gt;Get(&quot;PH2d&quot;);</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :     if (histodriftvelocity) {</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :       histodriftvelocity-&gt;SetDirectory(0);</span>
<span class="lineNum">     984 </span>            :       // store the reference data
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :       if(!StoreReferenceData(&quot;HLTData&quot;,&quot;VdriftT0&quot;,(TObject *) histodriftvelocity,&amp;metaData)){</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :         Log(&quot;Error storing 2D Profile for average pulse height (HLT)&quot;);</span>
<span class="lineNum">     987 </span>            :         error = kTRUE;
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     989 </span>            :       // analyse
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :       Log(&quot;Take the PH reference data. Now we will try to fit\n&quot;);</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :       calibra-&gt;SetMinEntries(800*20); // If there is less than 20000</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :       calibra-&gt;AnalysePH(histodriftvelocity);</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :       Int_t nbtg = 6*4*18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb0(1))</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :         + 6*  18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb2(1));</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :       Int_t nbfit        = calibra-&gt;GetNumberFit();</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :       Int_t nbfitSuccess = calibra-&gt;GetNumberFitSuccess();</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :       Int_t nbE          = calibra-&gt;GetNumberEnt();</span>
<span class="lineNum">     998 </span>            :       // enough statistics
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :       if ((nbtg &gt;                  0) &amp;&amp; </span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :           (nbfit        &gt;= 0.5*nbE) &amp;&amp; (nbE &gt; 30) &amp;&amp; (nbfitSuccess &gt; 30)) {</span>
<span class="lineNum">    1001 </span>            :         // create the cal objects
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :         calibra-&gt;RemoveOutliers(1,kTRUE);</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :         calibra-&gt;PutMeanValueOtherVectorFit(1,kTRUE);</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :         calibra-&gt;RemoveOutliers2(kTRUE);</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :         calibra-&gt;PutMeanValueOtherVectorFit2(1,kTRUE);</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :         TObjArray object  = calibra-&gt;GetVectorFit();</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :         AliTRDCalDet *objdriftvelocitydet = calibra-&gt;CreateDetObjectVdrift(&amp;object,kTRUE);</span>
<span class="lineNum">    1008 </span>            :         //      TObject *objdriftvelocitypad      = calibra-&gt;CreatePadObjectVdrift();
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :         object              = calibra-&gt;GetVectorFit2();</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :         AliTRDCalDet *objtime0det  = calibra-&gt;CreateDetObjectT0(&amp;object,kTRUE);</span>
<span class="lineNum">    1011 </span>            :         //TObject *objtime0pad       = calibra-&gt;CreatePadObjectT0();
<span class="lineNum">    1012 </span>            :         // store them
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :         if(!Store(&quot;Calib&quot;,&quot;ChamberVdrift&quot;    ,(TObject *) objdriftvelocitydet,&amp;md1,0,kTRUE)){</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :           Log(&quot;Error storing the calibration object for the chamber vdrift (HLT)&quot;);</span>
<span class="lineNum">    1015 </span>            :           error = kTRUE;                
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :         if(!Store(&quot;Calib&quot;,&quot;ChamberT0&quot;        ,(TObject *) objtime0det        ,&amp;md1,0,kTRUE)){</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :           Log(&quot;Error storing the calibration object for the chamber t0 (HLT)&quot;);</span>
<span class="lineNum">    1019 </span>            :           error = kTRUE;
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1021 </span>            :         // if(!Store(&quot;Calib&quot;,&quot;LocalVdrift&quot;      ,(TObject *) objdriftvelocitypad,&amp;md2,0,kTRUE)){
<span class="lineNum">    1022 </span>            :         //        Log(&quot;Error storing the calibration object for the local drift velocity (HLT)&quot;);
<span class="lineNum">    1023 </span>            :         //        error = kTRUE;
<span class="lineNum">    1024 </span>            :         //      }
<span class="lineNum">    1025 </span>            :         //      if(!Store(&quot;Calib&quot;,&quot;LocalT0&quot;          ,(TObject *) objtime0pad        ,&amp;md2,0,kTRUE)){
<span class="lineNum">    1026 </span>            :         //        Log(&quot;Error storing the calibration object for the local time0 (HLT)&quot;);
<span class="lineNum">    1027 </span>            :         //        error = kTRUE;
<span class="lineNum">    1028 </span>            :         //      }
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :         fVdriftHLT = kTRUE;</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :       calibra-&gt;ResetVectorFit();</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :     }// if TProfile2D</span>
<span class="lineNum">    1033 </span>            :     
<span class="lineNum">    1034 </span>            :     // prf
<span class="lineNum">    1035 </span>            :     /*
<span class="lineNum">    1036 </span>            :     TProfile2D *histoprf = (TProfile2D *) filehlt-&gt;Get(&quot;PRF2d&quot;);
<span class="lineNum">    1037 </span>            :     if (histoprf) {
<span class="lineNum">    1038 </span>            :       histoprf-&gt;SetDirectory(0);    
<span class="lineNum">    1039 </span>            :       // store reference data
<span class="lineNum">    1040 </span>            :       if(!StoreReferenceData(&quot;HLTData&quot;,&quot;PRF&quot;,(TObject *) histoprf,&amp;metaData)){
<span class="lineNum">    1041 </span>            :         Log(&quot;Error storing the 2D Profile for Pad Response Function&quot;);
<span class="lineNum">    1042 </span>            :         error = kTRUE;
<span class="lineNum">    1043 </span>            :       }
<span class="lineNum">    1044 </span>            :       // analyse
<span class="lineNum">    1045 </span>            :       Log(&quot;Take the PRF reference data. Now we will try to fit\n&quot;);
<span class="lineNum">    1046 </span>            :       calibra-&gt;SetMinEntries(600); // If there is less than 20000
<span class="lineNum">    1047 </span>            :       calibra-&gt;AnalysePRFMarianFit(histoprf);
<span class="lineNum">    1048 </span>            :       Int_t nbtg = 6*4*18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb0(2))
<span class="lineNum">    1049 </span>            :         + 6*  18*((Int_t) ((AliTRDCalibraMode *)calibra-&gt;GetCalibraMode())-&gt;GetDetChamb2(2));
<span class="lineNum">    1050 </span>            :       Int_t nbfit        = calibra-&gt;GetNumberFit();
<span class="lineNum">    1051 </span>            :       Int_t nbE          = calibra-&gt;GetNumberEnt();
<span class="lineNum">    1052 </span>            :       // enough statistics
<span class="lineNum">    1053 </span>            :       if ((nbtg &gt;                  0) &amp;&amp; 
<span class="lineNum">    1054 </span>            :           (nbfit        &gt;= 0.95*nbE) &amp;&amp; (nbE &gt; 30)) {
<span class="lineNum">    1055 </span>            :         // create cal pad objects 
<span class="lineNum">    1056 </span>            :         TObjArray object            = calibra-&gt;GetVectorFit();
<span class="lineNum">    1057 </span>            :         TObject *objPRFpad          = calibra-&gt;CreatePadObjectPRF(&amp;object);
<span class="lineNum">    1058 </span>            :         // store them
<span class="lineNum">    1059 </span>            :         if(!Store(&quot;Calib&quot;,&quot;PRFWidth&quot;         ,(TObject *) objPRFpad          ,&amp;md2,0,kTRUE)){
<span class="lineNum">    1060 </span>            :           Log(&quot;Error storing the calibration object for the Pad Response Function&quot;);
<span class="lineNum">    1061 </span>            :           error = kTRUE;
<span class="lineNum">    1062 </span>            :         }
<span class="lineNum">    1063 </span>            :       }
<span class="lineNum">    1064 </span>            :       calibra-&gt;ResetVectorFit();
<span class="lineNum">    1065 </span>            :     }// if PRF
<span class="lineNum">    1066 </span>            :     */
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :   }// if fileNameEntry</span>
<span class="lineNum">    1068 </span>            :   
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :   delete listhlt;</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :   return error;</span>
<span class="lineNum">    1071 </span>            :   
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 : }</span>
<a name="1073"><span class="lineNum">    1073 </span>            : </a>
<span class="lineNum">    1074 </span>            : //_____________________________________________________________________________
<span class="lineNum">    1075 </span>            : UInt_t AliTRDPreprocessor::ProcessDCSConfigData()
<span class="lineNum">    1076 </span>            : {
<span class="lineNum">    1077 </span>            :   // process the configuration of FEE, PTR and GTU
<span class="lineNum">    1078 </span>            :   // reteive XML filei(s) from the DCS FXS
<span class="lineNum">    1079 </span>            :   // parse it/them and store TObjArrays in the CDB
<span class="lineNum">    1080 </span>            : 
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :   Log(&quot;Processing the DCS config summary files.&quot;);</span>
<span class="lineNum">    1082 </span>            : 
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :   if(fCalDCSObjSOR) delete fCalDCSObjSOR; fCalDCSObjSOR=0;</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :   if(fCalDCSObjEOR) delete fCalDCSObjEOR; fCalDCSObjEOR=0;</span>
<span class="lineNum">    1085 </span>            : 
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :   TString xmlFile[2];</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :   TString esor[2] = {&quot;SOR&quot;, &quot;EOR&quot;};</span>
<span class="lineNum">    1088 </span>            :   // get the XML files
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :   xmlFile[0] = GetFile(kDCS,&quot;CONFIGSUMMARYSOR&quot;,&quot;&quot;);</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :   xmlFile[1] = GetFile(kDCS,&quot;CONFIGSUMMARYEOR&quot;,&quot;&quot;);</span>
<span class="lineNum">    1091 </span>            : 
<span class="lineNum">    1092 </span>            :   // check both files
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :   for (Int_t iFile=0; iFile&lt;2; iFile++) {</span>
<span class="lineNum">    1094 </span>            : 
<span class="lineNum">    1095 </span>            :     // check if the file are there
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :     if (xmlFile[iFile].IsNull()) {</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: %s file not found!&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1098 </span>            :       continue;
<span class="lineNum">    1099 </span>            :     }
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :     Log(Form(&quot;%s file found: %s&quot;, esor[iFile].Data(), xmlFile[iFile].Data()));</span>
<span class="lineNum">    1101 </span>            : 
<span class="lineNum">    1102 </span>            :     // test the file
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :     std::ifstream fileTest;</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :     fileTest.open(xmlFile[iFile].Data(), std::ios_base::binary | std::ios_base::in);</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :     if (!fileTest.good() || fileTest.eof() || !fileTest.is_open()) {</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: %s file not valid!&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">    1108 </span>            :     } 
<span class="lineNum">    1109 </span>            :     // check if the file is empty
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :     fileTest.seekg(0, std::ios_base::end);</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :     if (static_cast&lt;int&gt;(fileTest.tellg()) &lt; 2) {</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: %s file empty!&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">    1114 </span>            :     }
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :     Log(Form(&quot;%s file is valid.&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1116 </span>            :     // Close the file descriptor
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :     fileTest.close();</span>
<span class="lineNum">    1118 </span>            :     
<span class="lineNum">    1119 </span>            :     // make a robust XML validation
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :     TSAXParser testParser;</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :     if (testParser.ParseFile(xmlFile[iFile].Data()) &lt; 0 ) {</span>
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: %s XML content is not well-formed!&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">    1124 </span>            :     }
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :     Log(Form(&quot;%s XML content is well-formed.&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1126 </span>            : 
<span class="lineNum">    1127 </span>            :     // create parser and parse
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :     TSAXParser saxParser;</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :     AliTRDSaxHandler saxHandler;</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :     saxParser.ConnectToHandler(&quot;AliTRDSaxHandler&quot;, &amp;saxHandler);</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :     saxParser.ParseFile(xmlFile[iFile].Data());</span>
<span class="lineNum">    1132 </span>            : 
<span class="lineNum">    1133 </span>            :     // report errors of the parser if present
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :     if (saxParser.GetParseCode() != 0) {</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: %s XML file validation failed! Parse code: %d&quot;, esor[iFile].Data(), saxParser.GetParseCode()));</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">    1137 </span>            :     }
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :     Log(Form(&quot;%s XML validation OK.&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1139 </span>            : 
<span class="lineNum">    1140 </span>            :     // report errors of the handler if present
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :     if (saxHandler.GetHandlerStatus() != 0) {</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :       Log(Form(&quot;Warning: Creating %s calibration object failed! Error code: %d&quot;, esor[iFile].Data(), saxHandler.GetHandlerStatus()));</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">    1144 </span>            :     }
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :     Log(Form(&quot;%s SAX handler reports no errors.&quot;, esor[iFile].Data()));</span>
<span class="lineNum">    1146 </span>            : 
<span class="lineNum">    1147 </span>            :     // get the calibration object storing the data from the handler
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :     AliTRDCalDCSv2 *calDCSObj = (AliTRDCalDCSv2*)saxHandler.GetCalDCSObj()-&gt;Clone();</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :     calDCSObj-&gt;EvaluateGlobalParameters();</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :     calDCSObj-&gt;SetRunType(GetRunType());</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :     calDCSObj-&gt;SetStartTime(GetStartTimeDCSQuery());</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :     calDCSObj-&gt;SetEndTime(GetEndTimeDCSQuery());</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :     if (iFile == 0) fCalDCSObjSOR = calDCSObj;</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :     if (iFile == 1) fCalDCSObjEOR = calDCSObj;</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1156 </span>            : 
<span class="lineNum">    1157 </span>            :   // If none of the two objects exists we don't even store a CDB entry
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :   if (!fCalDCSObjSOR &amp;&amp; !fCalDCSObjEOR) {</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :     Log(&quot;ERROR: Failed reading both files!&quot;);</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :     return 1;</span>
<span class="lineNum">    1161 </span>            :   }
<span class="lineNum">    1162 </span>            : 
<span class="lineNum">    1163 </span>            :   // put both objects in one TObjArray to store them
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :   TObjArray calObjArray(2);</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :   calObjArray.SetOwner();</span>
<span class="lineNum">    1166 </span>            : 
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :   if (fCalDCSObjSOR) {</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :     calObjArray.AddAt(fCalDCSObjSOR,0);</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :     Log(&quot;TRDCalDCS object for SOR created.&quot;);</span>
<span class="lineNum">    1170 </span>            :   }
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :   if (fCalDCSObjEOR) {</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :     calObjArray.AddAt(fCalDCSObjEOR,1);</span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :     Log(&quot;TRDCalDCS object for EOR created.&quot;);</span>
<span class="lineNum">    1174 </span>            :   }
<span class="lineNum">    1175 </span>            : 
<span class="lineNum">    1176 </span>            :   // store the DCS calib data in the CDB
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :   AliCDBMetaData metaData1;</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :   metaData1.SetBeamPeriod(0);</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :   metaData1.SetResponsible(&quot;Frederick Kramer&quot;);</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :   metaData1.SetComment(&quot;DCS configuration data in two AliTRDCalDCSv2 objects in one TObjArray (0:SOR, 1:EOR).&quot;);</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :   if (!Store(&quot;Calib&quot;, &quot;DCS&quot;, &amp;calObjArray, &amp;metaData1, 0, kTRUE)) { Log(&quot;ERROR: Storing DCS config data object failed!&quot;); return 1; }</span>
<span class="lineNum">    1182 </span>            : 
<span class="lineNum">    1183 </span>            :   // ALICE policy is to always have an SOR object
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :   if(!fCalDCSObjSOR){</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :     Log(&quot;ERROR: Could not build an SOR object.&quot;);  </span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :     return 1;</span>
<span class="lineNum">    1187 </span>            :   }
<span class="lineNum">    1188 </span>            :   
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :   Log(&quot;SUCCESS: Processing of the DCS config summary file DONE.&quot;);  </span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :   return 0;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1192 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
