<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HLT/BASE/AliHLTTask.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">HLT/BASE</a> - AliHLTTask.cxx<span style="font-size: 80%;"> (source / <a href="AliHLTTask.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">467</td>
            <td class="headerCovTableEntryLo">0.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">39</td>
            <td class="headerCovTableEntryLo">2.6 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // $Id$</a>
<span class="lineNum">       2 </span>            : //**************************************************************************
<span class="lineNum">       3 </span>            : //* This file is property of and copyright by the                          * 
<span class="lineNum">       4 </span>            : //* ALICE Experiment at CERN, All rights reserved.                         *
<span class="lineNum">       5 </span>            : //*                                                                        *
<span class="lineNum">       6 </span>            : //* Primary Authors: Matthias Richter &lt;Matthias.Richter@ift.uib.no&gt;        *
<span class="lineNum">       7 </span>            : //*                  for The ALICE HLT Project.                            *
<span class="lineNum">       8 </span>            : //*                                                                        *
<span class="lineNum">       9 </span>            : //* Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">      10 </span>            : //* documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">      11 </span>            : //* without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      12 </span>            : //* copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      13 </span>            : //* appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      14 </span>            : //* about the suitability of this software for any purpose. It is          *
<span class="lineNum">      15 </span>            : //* provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      16 </span>            : //**************************************************************************
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : /// @file   AliHLTTask.cxx
<span class="lineNum">      19 </span>            : /// @author Matthias Richter
<span class="lineNum">      20 </span>            : /// @date   
<span class="lineNum">      21 </span>            : /// @brief  Implementation of HLT tasks.
<span class="lineNum">      22 </span>            : ///
<span class="lineNum">      23 </span>            : 
<span class="lineNum">      24 </span>            : #include &lt;cerrno&gt;
<span class="lineNum">      25 </span>            : #include &lt;cassert&gt;
<span class="lineNum">      26 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      27 </span>            : #include &lt;string&gt;
<span class="lineNum">      28 </span>            : #include &lt;ctime&gt;
<span class="lineNum">      29 </span>            : #include &quot;AliHLTTask.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;AliHLTConfiguration.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;AliHLTConfigurationHandler.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;AliHLTComponent.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;AliHLTComponentHandler.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;TList.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;AliHLTErrorGuard.h&quot;
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span>            : using std::cout;
<a name="38"><span class="lineNum">      38 </span>            : </a>
<span class="lineNum">      39 </span>            : /** ROOT macro for the implementation of ROOT specific class methods */
<a name="40"><span class="lineNum">      40 </span><span class="lineCov">        126 : ClassImp(AliHLTTask)</span></a>
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span><span class="lineNoCov">          0 : AliHLTTask::AliHLTTask()</span>
<span class="lineNum">      43 </span>            :   :
<span class="lineNum">      44 </span><span class="lineNoCov">          0 :   fpConfiguration(NULL),</span>
<span class="lineNum">      45 </span><span class="lineNoCov">          0 :   fpComponent(NULL),</span>
<span class="lineNum">      46 </span><span class="lineNoCov">          0 :   fpDataBuffer(NULL),</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :   fListTargets(),</span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 :   fListDependencies(),</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :   fBlockDataArray()</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      51 </span>            :   // see header file for class documentation
<span class="lineNum">      52 </span>            :   // or
<span class="lineNum">      53 </span>            :   // refer to README to build package
<span class="lineNum">      54 </span>            :   // or
<span class="lineNum">      55 </span>            :   // visit http://web.ift.uib.no/~kjeks/doc/alice-hlt
<a name="56"><span class="lineNum">      56 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span><span class="lineNoCov">          0 : AliHLTTask::AliHLTTask(AliHLTConfiguration* pConf)</span>
<span class="lineNum">      59 </span>            :   :
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :   fpConfiguration(pConf),</span>
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :   fpComponent(NULL),</span>
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :   fpDataBuffer(NULL),</span>
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   fListTargets(),</span>
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   fListDependencies(),</span>
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   fBlockDataArray()</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      67 </span>            :   // see header file for function documentation
<a name="68"><span class="lineNum">      68 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span><span class="lineNoCov">          0 : AliHLTTask::~AliHLTTask()</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      72 </span>            :   // see header file for function documentation
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   TObjLink* lnk=fListDependencies.FirstLink();</span>
<span class="lineNum">      74 </span>            : 
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   while (lnk!=NULL) {</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :     AliHLTTask* pTask=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :     pTask-&gt;UnsetTarget(this);</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :     lnk=lnk-&gt;Next();</span>
<span class="lineNum">      79 </span>            :   }
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :   lnk=fListTargets.FirstLink();</span>
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   while (lnk!=NULL) {</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     AliHLTTask* pTask=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :     pTask-&gt;UnsetDependency(this);</span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     lnk=lnk-&gt;Next();</span>
<span class="lineNum">      86 </span>            :   }
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :   if (fpComponent) delete fpComponent;</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :   fpComponent=NULL;</span>
<a name="90"><span class="lineNum">      90 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span>            : int AliHLTTask::Init(AliHLTConfiguration* pConf, AliHLTComponentHandler* pCH)
<span class="lineNum">      93 </span>            : {
<span class="lineNum">      94 </span>            :   // see header file for function documentation
<span class="lineNum">      95 </span>            :   int iResult=0;
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   if (fpConfiguration!=NULL &amp;&amp; pConf!=NULL &amp;&amp; fpConfiguration!=pConf) {</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :     HLTWarning(&quot;overriding existing reference to configuration object %p by %p&quot;,</span>
<span class="lineNum">      98 </span>            :                fpConfiguration, pConf);
<span class="lineNum">      99 </span>            :   }
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :   if (pConf!=NULL) fpConfiguration=pConf;</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :   iResult=CreateComponent(fpConfiguration, pCH, fpComponent);</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :   if (iResult&gt;=0) {</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :     iResult=CustomInit(pCH);</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="106"><span class="lineNum">     106 </span>            : }</a>
<span class="lineNum">     107 </span>            : 
<span class="lineNum">     108 </span>            : int AliHLTTask::CreateComponent(AliHLTConfiguration* pConfiguration, AliHLTComponentHandler* pCH, AliHLTComponent*&amp; pComponent) const
<span class="lineNum">     109 </span>            : {
<span class="lineNum">     110 </span>            :   // see header file for class documentation
<span class="lineNum">     111 </span>            :   int iResult=0;
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :   if (!pConfiguration) return -EINVAL;</span>
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :   const AliHLTConfiguration* pConf=AliHLTConfigurationHandler::FindSubstitution(*pConfiguration);</span>
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :   if (!pConf) pConf=pConfiguration;</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :   if (pConf) {</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :     if (pCH) {</span>
<span class="lineNum">     118 </span>            :       int argc=0;
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :       const char** argv=NULL;</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :       if ((iResult=pConf-&gt;GetArguments(&amp;argv))&gt;=0) {</span>
<span class="lineNum">     121 </span>            :         argc=iResult; // just to make it clear
<span class="lineNum">     122 </span>            :         // TODO: we have to think about the optional environment parameter,
<span class="lineNum">     123 </span>            :         // currently just set to NULL.
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :         iResult=pCH-&gt;CreateComponent(pConf-&gt;GetComponentID(), pComponent);</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :         if (pComponent &amp;&amp; iResult&gt;=0) {</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :           TString description;</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :           description.Form(&quot;chainid=%s&quot;, GetName());</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :           pComponent-&gt;SetComponentDescription(description.Data());</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :           const AliHLTAnalysisEnvironment* pEnv=pCH-&gt;GetEnvironment();</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :           if ((iResult=pComponent-&gt;Init(pEnv, NULL, argc, argv))&gt;=0) {</span>
<span class="lineNum">     131 </span>            :             //HLTDebug(&quot;component %s (%p) created&quot;, pComponent-&gt;GetComponentID(), pComponent); 
<span class="lineNum">     132 </span>            :           } else {
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :             HLTError(&quot;Initialization of component \&quot;%s\&quot; failed with error %d&quot;, pComponent-&gt;GetComponentID(), iResult);</span>
<span class="lineNum">     134 </span>            :           }
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     136 </span>            :           //HLTError(&quot;can not find component \&quot;%s\&quot; (%d)&quot;, pConf-&gt;GetComponentID(), iResult);
<span class="lineNum">     137 </span>            :         }
<span class="lineNum">     138 </span>            :       } else {
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :         HLTError(&quot;can not get argument list for configuration %s (%s)&quot;, pConf-&gt;GetName(), pConf-&gt;GetComponentID());</span>
<span class="lineNum">     140 </span>            :         iResult=-EINVAL;
<span class="lineNum">     141 </span>            :       }
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :       HLTError(&quot;component handler instance needed for task initialization&quot;);</span>
<span class="lineNum">     144 </span>            :       iResult=-EINVAL;
<span class="lineNum">     145 </span>            :     }
<span class="lineNum">     146 </span>            :   } else {
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     HLTError(&quot;configuration object instance needed for task initialization&quot;);</span>
<span class="lineNum">     148 </span>            :     iResult=-EINVAL;
<span class="lineNum">     149 </span>            :   }
<span class="lineNum">     150 </span>            :   return iResult;
<a name="151"><span class="lineNum">     151 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            : int AliHLTTask::Deinit()
<span class="lineNum">     154 </span>            : {
<span class="lineNum">     155 </span>            :   // see header file for function documentation
<span class="lineNum">     156 </span>            :   int iResult=0;
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   CustomCleanup();</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   AliHLTComponent* pComponent=GetComponent();</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :   fpComponent=NULL;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :   if (pComponent) {</span>
<span class="lineNum">     161 </span>            :     //HLTDebug(&quot;delete component %s (%p)&quot;, pComponent-&gt;GetComponentID(), pComponent); 
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :     pComponent-&gt;Deinit();</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :     delete pComponent;</span>
<span class="lineNum">     164 </span>            :   } else {
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :     HLTWarning(&quot;task doesn't seem to be in initialized&quot;);</span>
<span class="lineNum">     166 </span>            :   }
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="168"><span class="lineNum">     168 </span>            : }</a>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span>            : const char *AliHLTTask::GetName() const
<span class="lineNum">     171 </span>            : {
<span class="lineNum">     172 </span>            :   // see header file for function documentation
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   if (fpConfiguration)</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     return fpConfiguration-&gt;GetName();</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :   return TObject::GetName();</span>
<a name="176"><span class="lineNum">     176 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span>            : AliHLTConfiguration* AliHLTTask::GetConf() const
<span class="lineNum">     179 </span>            : {
<span class="lineNum">     180 </span>            :   // see header file for function documentation
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :   return fpConfiguration;</span>
<a name="182"><span class="lineNum">     182 </span>            : }</a>
<span class="lineNum">     183 </span>            : 
<span class="lineNum">     184 </span>            : AliHLTComponent* AliHLTTask::GetComponent() const
<span class="lineNum">     185 </span>            : {
<span class="lineNum">     186 </span>            :   // see header file for function documentation
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   return fpComponent;</span>
<a name="188"><span class="lineNum">     188 </span>            : }</a>
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span>            : AliHLTTask* AliHLTTask::FindDependency(const char* id)
<span class="lineNum">     191 </span>            : {
<span class="lineNum">     192 </span>            :   // see header file for function documentation
<span class="lineNum">     193 </span>            :   AliHLTTask* pTask=NULL;
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :   if (id) {</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :     pTask=(AliHLTTask*)fListDependencies.FindObject(id);</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :   return pTask;</span>
<a name="198"><span class="lineNum">     198 </span>            : }</a>
<span class="lineNum">     199 </span>            : 
<span class="lineNum">     200 </span>            : int AliHLTTask::FollowDependency(const char* id, TList* pTgtList)
<span class="lineNum">     201 </span>            : {
<span class="lineNum">     202 </span>            :   // see header file for function documentation
<span class="lineNum">     203 </span>            :   int iResult=0;
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :   if (id) {</span>
<span class="lineNum">     205 </span>            :     AliHLTTask* pDep=NULL;
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :     if ((pDep=(AliHLTTask*)fListDependencies.FindObject(id))!=NULL) {</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :       if (pTgtList) pTgtList-&gt;Add(pDep);</span>
<span class="lineNum">     208 </span>            :       iResult++;
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :       TObjLink* lnk=fListDependencies.FirstLink();</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :       while (lnk &amp;&amp; iResult==0) {</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         pDep=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :         if (pDep) {</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :           if ((iResult=pDep-&gt;FollowDependency(id, pTgtList))&gt;0) {</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :             if (pTgtList) pTgtList-&gt;AddFirst(pDep);</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :             iResult++;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     218 </span>            :         } else {
<span class="lineNum">     219 </span>            :           iResult=-EFAULT;
<span class="lineNum">     220 </span>            :         }
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :         lnk=lnk-&gt;Next();</span>
<span class="lineNum">     222 </span>            :       }
<span class="lineNum">     223 </span>            :     }
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     225 </span>            :     iResult=-EINVAL;
<span class="lineNum">     226 </span>            :   }
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="228"><span class="lineNum">     228 </span>            : }</a>
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span>            : void AliHLTTask::PrintDependencyTree(const char* id, int bFromConfiguration)
<span class="lineNum">     231 </span>            : {
<span class="lineNum">     232 </span>            :   // see header file for function documentation
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   HLTLogKeyword(&quot;task dependencies&quot;);</span>
<span class="lineNum">     234 </span>            :   int iResult=0;
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :   TList tgtList;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :   if (bFromConfiguration) {</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :     if (fpConfiguration)</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :       iResult=fpConfiguration-&gt;FollowDependency(id, &amp;tgtList);</span>
<span class="lineNum">     239 </span>            :     else
<span class="lineNum">     240 </span>            :       iResult=-EFAULT;
<span class="lineNum">     241 </span>            :   } else
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     iResult=FollowDependency(id, &amp;tgtList);</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :   if (iResult&gt;0) {</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;     dependency level %d &quot;, iResult);</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :     TObjLink* lnk=tgtList.FirstLink();</span>
<span class="lineNum">     246 </span>            :     int i=iResult;
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     char* pSpace = new char[iResult+1];</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     if (pSpace) {</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :       memset(pSpace, 32, iResult);</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       pSpace[i]=0;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :       while (lnk) {</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         TObject* obj=lnk-&gt;GetObject();</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :         HLTMessage(&quot;     %s^-- %s &quot;, &amp;pSpace[i--], obj-&gt;GetName());</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         lnk=lnk-&gt;Next();</span>
<span class="lineNum">     255 </span>            :       }
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :       delete [] pSpace;</span>
<span class="lineNum">     257 </span>            :     } else {
<span class="lineNum">     258 </span>            :       iResult=-ENOMEM;
<span class="lineNum">     259 </span>            :     }
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :   }</span>
<a name="261"><span class="lineNum">     261 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span>            : int AliHLTTask::SetDependency(AliHLTTask* pDep)
<span class="lineNum">     264 </span>            : {
<span class="lineNum">     265 </span>            :   // see header file for function documentation
<span class="lineNum">     266 </span>            :   int iResult=0;
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :   if (pDep) {</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :     if (FindDependency(pDep-&gt;GetName())==NULL) {</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :       fListDependencies.Add(pDep);</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     271 </span>            :       iResult=-EEXIST;
<span class="lineNum">     272 </span>            :     }
<span class="lineNum">     273 </span>            :   } else {
<span class="lineNum">     274 </span>            :     iResult=-EINVAL;
<span class="lineNum">     275 </span>            :   }
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="277"><span class="lineNum">     277 </span>            : }</a>
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            : int AliHLTTask::UnsetDependency(AliHLTTask* pDep)
<span class="lineNum">     280 </span>            : {
<span class="lineNum">     281 </span>            :   // see header file for function documentation
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :   fListDependencies.Remove(pDep);</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   if (fpConfiguration) {</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :     fpConfiguration-&gt;InvalidateSources();</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="287"><span class="lineNum">     287 </span>            : }</a>
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span>            : int AliHLTTask::CheckDependencies()
<span class="lineNum">     290 </span>            : {
<span class="lineNum">     291 </span>            :   // see header file for function documentation
<span class="lineNum">     292 </span>            :   int iResult=0;
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :   AliHLTConfiguration* pSrc=fpConfiguration-&gt;GetFirstSource();</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :   while (pSrc) {</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :     if (FindDependency(pSrc-&gt;GetName())==NULL) {</span>
<span class="lineNum">     296 </span>            :       //HLTDebug(&quot;dependency \&quot;%s\&quot; unresolved&quot;, pSrc-&gt;GetName());
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :       iResult++;</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :     pSrc=fpConfiguration-&gt;GetNextSource();</span>
<span class="lineNum">     300 </span>            :   }
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :   return iResult;</span>
<span class="lineNum">     302 </span>            : }
<a name="303"><span class="lineNum">     303 </span>            : </a>
<span class="lineNum">     304 </span>            : 
<span class="lineNum">     305 </span>            : int AliHLTTask::Depends(AliHLTTask* pTask)
<span class="lineNum">     306 </span>            : {
<span class="lineNum">     307 </span>            :   // see header file for function documentation
<span class="lineNum">     308 </span>            :   int iResult=0;
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   if (pTask) {</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :     if (fpConfiguration) {</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       iResult=fpConfiguration-&gt;GetSource(pTask-&gt;GetName())!=NULL;</span>
<span class="lineNum">     312 </span>            :       if (iResult&gt;0) {
<span class="lineNum">     313 </span>            :         //HLTDebug(&quot;task  \&quot;%s\&quot; depends on \&quot;%s\&quot;&quot;, GetName(), pTask-&gt;GetName());
<span class="lineNum">     314 </span>            :       } else {
<span class="lineNum">     315 </span>            :         //HLTDebug(&quot;task  \&quot;%s\&quot; independend of \&quot;%s\&quot;&quot;, GetName(), pTask-&gt;GetName());
<span class="lineNum">     316 </span>            :       }
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     318 </span>            :       iResult=-EFAULT;
<span class="lineNum">     319 </span>            :     }
<span class="lineNum">     320 </span>            :   } else {
<span class="lineNum">     321 </span>            :     iResult=-EINVAL;
<span class="lineNum">     322 </span>            :   }
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="324"><span class="lineNum">     324 </span>            : }</a>
<span class="lineNum">     325 </span>            : 
<span class="lineNum">     326 </span>            : AliHLTTask* AliHLTTask::FindTarget(const char* id)
<span class="lineNum">     327 </span>            : {
<span class="lineNum">     328 </span>            :   // see header file for function documentation
<span class="lineNum">     329 </span>            :   AliHLTTask* pTask=NULL;
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   if (id) {</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     pTask=(AliHLTTask*)fListTargets.FindObject(id);</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   return pTask;</span>
<a name="334"><span class="lineNum">     334 </span>            : }</a>
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span>            : int AliHLTTask::SetTarget(AliHLTTask* pTgt)
<span class="lineNum">     337 </span>            : {
<span class="lineNum">     338 </span>            :   // see header file for function documentation
<span class="lineNum">     339 </span>            :   int iResult=0;
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :   if (pTgt) {</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :     if (FindTarget(pTgt-&gt;GetName())==NULL) {</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :       fListTargets.Add(pTgt);</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     344 </span>            :       iResult=-EEXIST;
<span class="lineNum">     345 </span>            :     }
<span class="lineNum">     346 </span>            :   } else {
<span class="lineNum">     347 </span>            :     iResult=-EINVAL;
<span class="lineNum">     348 </span>            :   }
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="350"><span class="lineNum">     350 </span>            : }</a>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span>            : int AliHLTTask::UnsetTarget(AliHLTTask* pTarget)
<span class="lineNum">     353 </span>            : {
<span class="lineNum">     354 </span>            :   // see header file for function documentation
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :   fListTargets.Remove(pTarget);</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="357"><span class="lineNum">     357 </span>            : }</a>
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            : int AliHLTTask::StartRun()
<span class="lineNum">     360 </span>            : {
<span class="lineNum">     361 </span>            :   // see header file for function documentation
<span class="lineNum">     362 </span>            :   int iResult=0;
<span class="lineNum">     363 </span>            :   int iNofInputDataBlocks=0;
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   AliHLTComponent* pComponent=GetComponent();</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   if (pComponent) {</span>
<span class="lineNum">     366 </span>            :     // determine the number of input data blocks provided from the source tasks
<span class="lineNum">     367 </span>            :     { // set scope for lnk as a local variable
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :     TObjLink* lnk=fListDependencies.FirstLink();</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :     while (lnk &amp;&amp; iResult&gt;=0) {</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :       AliHLTTask* pSrcTask=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :       if (pSrcTask) {</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :         if ((iResult=pSrcTask-&gt;GetNofMatchingDataTypes(this))&gt;0) {</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :           iNofInputDataBlocks+=iResult;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         } else if (iResult==0) {</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :           HLTWarning(&quot;source task %s (%p) does not provide any matching data type for task %s (%p)&quot;, pSrcTask-&gt;GetName(), pSrcTask, GetName(), this);</span>
<span class="lineNum">     376 </span>            :         } else {
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :           HLTError(&quot;task %s (%p): error getting matching data types for source task %s (%p)&quot;, GetName(), this, pSrcTask-&gt;GetName(), pSrcTask);</span>
<span class="lineNum">     378 </span>            :           iResult=-EFAULT;
<span class="lineNum">     379 </span>            :         }
<span class="lineNum">     380 </span>            :       }
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :       lnk=lnk-&gt;Next();</span>
<span class="lineNum">     382 </span>            :     }
<span class="lineNum">     383 </span>            :     }
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     if (iResult&gt;=0) {</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :       if (fBlockDataArray.size()&gt;0) {</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :         HLTWarning(&quot;block data array for task %s (%p) was not cleaned&quot;, GetName(), this);</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :         fBlockDataArray.clear();</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     389 </span>            : 
<span class="lineNum">     390 </span>            :       // component init
<span class="lineNum">     391 </span>            :       // the initialization of the component is done by the ComponentHandler after creation
<span class="lineNum">     392 </span>            :       // of the component.
<span class="lineNum">     393 </span>            :       //iResult=Init( AliHLTAnalysisEnvironment* environ, void* environ_param, int argc, const char** argv );
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span>            :       // allocate the data buffer, which controls the output buffer and subscriptions
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :       if (iResult&gt;=0) {</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :         fpDataBuffer=new AliHLTDataBuffer;</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :         if (fpDataBuffer!=NULL) {</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :           fpDataBuffer-&gt;SetLocalLoggingLevel(GetLocalLoggingLevel());</span>
<span class="lineNum">     400 </span>            :           HLTDebug(&quot;created data buffer %p for task %s (%p)&quot;, fpDataBuffer, GetName(), this);
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :           TObjLink* lnk=fListTargets.FirstLink();</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :           while (lnk &amp;&amp; iResult&gt;=0) {</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :             AliHLTTask* pTgtTask=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :             if (pTgtTask) {</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :               if ((iResult=fpDataBuffer-&gt;SetConsumer(pTgtTask-&gt;GetComponent()))&gt;=0) {</span>
<span class="lineNum">     406 </span>            :               }
<span class="lineNum">     407 </span>            :             } else {
<span class="lineNum">     408 </span>            :               iResult=-EFAULT;
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     410 </span>            :             }
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :             lnk=lnk-&gt;Next();</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :           HLTFatal(&quot;can not create data buffer object, memory allocation failed&quot;);</span>
<span class="lineNum">     415 </span>            :           iResult=-ENOMEM;
<span class="lineNum">     416 </span>            :         }
<span class="lineNum">     417 </span>            :       }
<span class="lineNum">     418 </span>            :     }
<span class="lineNum">     419 </span>            :     if (iResult&gt;=0) {
<span class="lineNum">     420 </span>            :       // send the SOR event
<span class="lineNum">     421 </span>            :       
<span class="lineNum">     422 </span>            :     }
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :     HLTError(&quot;task %s (%p) does not have a component&quot;, GetName(), this);</span>
<span class="lineNum">     425 </span>            :     iResult=-EFAULT;
<span class="lineNum">     426 </span>            :   }
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="428"><span class="lineNum">     428 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     429 </span>            : 
<span class="lineNum">     430 </span>            : int AliHLTTask::EndRun()
<span class="lineNum">     431 </span>            : {
<span class="lineNum">     432 </span>            :   // see header file for function documentation
<span class="lineNum">     433 </span>            :   int iResult=0;
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :   if (fBlockDataArray.size()&gt;0) {</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :     fBlockDataArray.clear();</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   if (fpDataBuffer) {</span>
<span class="lineNum">     438 </span>            :     AliHLTDataBuffer* pBuffer=fpDataBuffer;
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :     fpDataBuffer=NULL;</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :     delete pBuffer;</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="443"><span class="lineNum">     443 </span>            : }</a>
<span class="lineNum">     444 </span>            : 
<span class="lineNum">     445 </span>            : int AliHLTTask::ProcessTask(Int_t eventNo, AliHLTUInt32_t eventType, AliHLTTriggerMask_t trgMask,
<span class="lineNum">     446 </span>            :                             AliHLTUInt32_t timestamp, AliHLTUInt32_t participatingDetectors)
<span class="lineNum">     447 </span>            : {
<span class="lineNum">     448 </span>            :   // see header file for function documentation
<span class="lineNum">     449 </span>            :   int iResult=0;
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :   AliHLTComponent* pComponent=GetComponent();</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :   if (pComponent &amp;&amp; fpDataBuffer) {</span>
<span class="lineNum">     452 </span>            :     HLTDebug(&quot;Processing task %s (%p) fpDataBuffer %p&quot;, GetName(), this, fpDataBuffer);
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :     fpDataBuffer-&gt;Reset();</span>
<span class="lineNum">     454 </span>            :     int iSourceDataBlock=0;
<span class="lineNum">     455 </span>            :     int iInputDataVolume=0;
<span class="lineNum">     456 </span>            : 
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     AliHLTTask* pSrcTask=NULL;</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :     AliHLTTaskPList subscribedTaskList;</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     TObjLink* lnk=fListDependencies.FirstLink();</span>
<span class="lineNum">     460 </span>            : 
<span class="lineNum">     461 </span>            :     // instances of SOR and EOR events to be kept
<span class="lineNum">     462 </span>            :     int iSOR=-1;
<span class="lineNum">     463 </span>            :     int iEOR=-1;
<span class="lineNum">     464 </span>            :     // TODO 2009-09-30
<span class="lineNum">     465 </span>            :     // generalize handling of the special blocks to be forwarded on SOR and EOR
<span class="lineNum">     466 </span>            :     // just adding a new specific handling for the ECS parameter block as a quick
<span class="lineNum">     467 </span>            :     // solution
<span class="lineNum">     468 </span>            :     int iECS=-1;
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span>            :     // subscribe to all source tasks
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     fBlockDataArray.clear();</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :     while (lnk &amp;&amp; iResult&gt;=0) {</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :       pSrcTask=(AliHLTTask*)lnk-&gt;GetObject();</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :       if (pSrcTask) {</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :         int iMatchingDB=pSrcTask-&gt;GetNofMatchingDataBlocks(this);</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :         if (iMatchingDB&lt;0) {</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :           HLTError(&quot;task %s (%p): error getting no of matching data blocks from task %s (%p), error %d&quot;, GetName(), this, pSrcTask-&gt;GetName(), pSrcTask, iMatchingDB);</span>
<span class="lineNum">     478 </span>            :           iResult=iMatchingDB;
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">     480 </span>            :         } else if (iMatchingDB==0) {
<span class="lineNum">     481 </span>            :           HLTDebug(&quot;source task %s (%p) does not provide any matching data type for task %s (%p)&quot;, pSrcTask-&gt;GetName(), pSrcTask, GetName(), this);
<span class="lineNum">     482 </span>            :         }
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :         if ((iResult=pSrcTask-&gt;Subscribe(this, fBlockDataArray))&gt;=0) {</span>
<span class="lineNum">     484 </span>            :           iSOR=iEOR=iECS=-1;
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :           AliHLTComponentBlockDataList::iterator block=fBlockDataArray.begin();</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :           for (int i=0; block!=fBlockDataArray.end(); i++) {</span>
<span class="lineNum">     487 </span>            :             bool bRemove=0;
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :             bRemove|=(*block).fDataType==kAliHLTDataTypeSOR &amp;&amp; !(iSOR&lt;0 &amp;&amp; (iSOR=i)&gt;=0);</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :             bRemove|=(*block).fDataType==kAliHLTDataTypeEOR &amp;&amp; !(iEOR&lt;0 &amp;&amp; (iEOR=i)&gt;=0);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :             bRemove|=(*block).fDataType==kAliHLTDataTypeECSParam &amp;&amp; !(iECS&lt;0 &amp;&amp; (iECS=i)&gt;=0);</span>
<span class="lineNum">     491 </span>            :             //HLTInfo(&quot;block %d, iSOR=%d iEOR=%d remove=%d&quot;, i, iSOR, iEOR, bRemove);
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :             if (i&lt;iSourceDataBlock) {</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :               assert(!bRemove);</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :             } else if (bRemove) {</span>
<span class="lineNum">     495 </span>            :               HLTDebug(&quot;remove duplicated event %s (%d)&quot;, AliHLTComponent::DataType2Text((*block).fDataType).c_str(), i);
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :               pSrcTask-&gt;Release(&amp;(*block), this);</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :               block=fBlockDataArray.erase(block);</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :               continue;</span>
<span class="lineNum">     499 </span>            :             } else {
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :             iInputDataVolume+=(*block).fSize;</span>
<span class="lineNum">     501 </span>            :             // put the source task as many times into the list as it provides data blocks
<span class="lineNum">     502 </span>            :             // makes the bookkeeping for the data release easier
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :             subscribedTaskList.push_back(pSrcTask);</span>
<span class="lineNum">     504 </span>            :             }
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :             block++;</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     507 </span>            :           HLTDebug(&quot;Task %s (%p) successfully subscribed to %d data block(s) of task %s (%p)&quot;, GetName(), this, iResult, pSrcTask-&gt;GetName(), pSrcTask);
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :           iSourceDataBlock=fBlockDataArray.size();        </span>
<span class="lineNum">     509 </span>            :           iResult=0;
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :           HLTError(&quot;Task %s (%p): subscription to task %s (%p) failed with error %d&quot;, GetName(), this, pSrcTask-&gt;GetName(), pSrcTask, iResult);</span>
<span class="lineNum">     512 </span>            :           iResult=-EFAULT;
<span class="lineNum">     513 </span>            :         }
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :         HLTFatal(&quot;fatal internal error in ROOT list handling&quot;);</span>
<span class="lineNum">     516 </span>            :         iResult=-EFAULT;
<span class="lineNum">     517 </span>            :       }
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :       lnk=lnk-&gt;Next();</span>
<span class="lineNum">     519 </span>            :     }    
<span class="lineNum">     520 </span>            : 
<span class="lineNum">     521 </span>            :     // process the event
<span class="lineNum">     522 </span>            :     int iNofTrial=0; // repeat processing if component returns -ENOSPC
<span class="lineNum">     523 </span>            :     AliHLTUInt32_t iLastOutputDataSize=0;
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     if (iResult&gt;=0) {</span>
<span class="lineNum">     525 </span>            :     do {
<span class="lineNum">     526 </span>            :       long unsigned int iOutputDataSize=0;
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :       AliHLTConfiguration* pConf=GetConf();</span>
<span class="lineNum">     528 </span>            :       // check if there was a buffer size specified, query output size
<span class="lineNum">     529 </span>            :       // estimator from component otherwize
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :       if (pConf &amp;&amp; pConf-&gt;GetOutputBufferSize()&gt;=0) {</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :         iOutputDataSize=pConf-&gt;GetOutputBufferSize();</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :       long unsigned int iConstBase=0;</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :       double fInputMultiplier=0;</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :       if (pComponent-&gt;GetComponentType()!=AliHLTComponent::kSink) {</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :         pComponent-&gt;GetOutputDataSize(iConstBase, fInputMultiplier);</span>
<span class="lineNum">     537 </span>            :         // add a small margin to the buffer to allow optional component
<span class="lineNum">     538 </span>            :         // statistics
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :         iConstBase+=100;</span>
<span class="lineNum">     540 </span>            : #if defined(__DEBUG) || defined(HLT_COMPONENT_STATISTICS)
<span class="lineNum">     541 </span>            :         for (AliHLTComponentBlockDataList::iterator element=fBlockDataArray.begin();
<span class="lineNum">     542 </span>            :              element!=fBlockDataArray.end(); element++) {
<span class="lineNum">     543 </span>            :           if (element-&gt;fDataType==kAliHLTDataTypeComponentStatistics) {
<span class="lineNum">     544 </span>            :             iConstBase+=element-&gt;fSize;
<span class="lineNum">     545 </span>            :           }
<span class="lineNum">     546 </span>            :         }
<span class="lineNum">     547 </span>            : #endif
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :       if (fInputMultiplier&lt;0) {</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :         HLTWarning(&quot;ignoring negative input multiplier&quot;);</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :         fInputMultiplier=0;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :       iOutputDataSize=(long unsigned int)(fInputMultiplier*iInputDataVolume) + iConstBase;</span>
<span class="lineNum">     554 </span>            :       //HLTDebug(&quot;task %s: reqired output size %d&quot;, GetName(), iOutputDataSize);
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :       if (iNofTrial == 0 &amp;&amp; fpDataBuffer-&gt;GetMaxBufferSize() &lt; iOutputDataSize) {</span>
<span class="lineNum">     557 </span>            :         //If the estimated buffer size exceeds the maximum buffer size of AliHLTRawBuffer, decrease the buffer size.
<span class="lineNum">     558 </span>            :         //The estimation is often quite high, and GetMaxBufferSize should usually return a size that is sufficient.
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :         HLTImportant(&quot;Reducing estimated output buffer size of %lu to maximum output buffer size\n&quot;, iOutputDataSize);</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :         iOutputDataSize = fpDataBuffer-&gt;GetMaxBufferSize();</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :       if (iNofTrial&gt;0) {</span>
<span class="lineNum">     563 </span>            :         // dont process again if the buffer size is the same
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :         if (iLastOutputDataSize&gt;=iOutputDataSize) break;</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :         HLTImportant(&quot;processing event %d again with buffer size %d&quot;, eventNo, iOutputDataSize);</span>
<span class="lineNum">     566 </span>            :       }
<span class="lineNum">     567 </span>            :       AliHLTUInt8_t* pTgtBuffer=NULL;
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :       if (iOutputDataSize&gt;0) pTgtBuffer=fpDataBuffer-&gt;GetTargetBuffer(iOutputDataSize);</span>
<span class="lineNum">     569 </span>            :       //HLTDebug(&quot;provided raw buffer %p&quot;, pTgtBuffer);
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :       AliHLTComponentEventData evtData;</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :       AliHLTComponent::FillEventData(evtData);</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :       if (eventNo&gt;=0)</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         evtData.fEventID=(AliHLTEventID_t)eventNo;</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :       if (timestamp &lt; kMaxUInt) evtData.fEventCreation_s=timestamp;</span>
<span class="lineNum">     575 </span>            :       else
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :       evtData.fEventCreation_s=static_cast&lt;AliHLTUInt32_t&gt;(time(NULL));</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :       AliHLTComponentTriggerData trigData;</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :       AliHLTEventTriggerData evtTrigData;</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :       trigData.fStructSize=sizeof(trigData);</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :       trigData.fDataSize=sizeof(AliHLTEventTriggerData);</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :       memset(&amp;evtTrigData, 0, trigData.fDataSize);</span>
<span class="lineNum">     582 </span>            :       // Setup the CDH in the trigger data, based on the event type, CTP trigger
<span class="lineNum">     583 </span>            :       // mask and participating detectors.
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeaderWordCnt=gkAliHLTCommonHeaderCount;</span>
<span class="lineNum">     585 </span>            :       AliHLTUInt8_t l1msg = 0x0;
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :       switch (eventType)</span>
<span class="lineNum">     587 </span>            :       {
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :       case gkAliEventTypeData:        l1msg = 0x00; break;</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :       case gkAliEventTypeDataReplay:  l1msg = 0x00; break;</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :       case gkAliEventTypeStartOfRun:  l1msg = (0xE &lt;&lt; 2) | 0x01; break;</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :       case gkAliEventTypeEndOfRun:    l1msg = (0xF &lt;&lt; 2) | 0x01; break;</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :       case gkAliEventTypeCalibration: l1msg = (0x1 &lt;&lt; 6) | 0x01; break;</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :       case gkAliEventTypeSoftware:    l1msg = 0x01; break;</span>
<span class="lineNum">     594 </span>            :       }
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[1] = (AliHLTUInt32_t(l1msg) &lt;&lt; 14) | (0x03000000); //We have to set a CDH version, use 3 because we support 100 trigger classes below (0x03000000)</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[3] = ((l1msg &amp; 0x1) == 0x1) ? (participatingDetectors &amp; 0xFFFFFF) : 0x0;</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[5] = (trgMask &amp; AliHLTTriggerMask_t(0xffffffff)).to_ulong();</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[6] = ((trgMask&gt;&gt;32) &amp; AliHLTTriggerMask_t(0x3ffff)).to_ulong();</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[7] = ((trgMask&gt;&gt;50) &amp; AliHLTTriggerMask_t(0xffffffff)).to_ulong();</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :       evtTrigData.fCommonHeader[8] = ((trgMask&gt;&gt;72) &amp; AliHLTTriggerMask_t(0x3ffff)).to_ulong();</span>
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :       trigData.fData=&amp;evtTrigData;</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :       iLastOutputDataSize=iOutputDataSize;</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :       AliHLTUInt32_t size=iOutputDataSize;</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :       AliHLTUInt32_t outputBlockCnt=0;</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :       AliHLTComponentBlockData* outputBlocks=NULL;</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :       AliHLTComponentEventDoneData* edd=NULL;</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :       if (pTgtBuffer!=NULL || iOutputDataSize==0) {</span>
<span class="lineNum">     609 </span>            :         // add event type data block
<span class="lineNum">     610 </span>            :         // the block is removed immediately after processing from the list
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :         AliHLTComponentBlockData eventTypeBlock;</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :         AliHLTComponent::FillBlockData(eventTypeBlock);</span>
<span class="lineNum">     613 </span>            :         // Note: no payload!
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :         eventTypeBlock.fDataType=kAliHLTDataTypeEvent;</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :         eventTypeBlock.fSpecification=eventType;</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         fBlockDataArray.push_back(eventTypeBlock);</span>
<span class="lineNum">     617 </span>            : 
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :         if (CheckFilter(kHLTLogDebug)) Print(&quot;proc&quot;);</span>
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span>            :         AliHLTUInt32_t iblock=0;
<span class="lineNum">     621 </span>            :         // check input and output buffers for consistency
<span class="lineNum">     622 </span>            :         // to be enabled after fixing bug with DataBuffer and forwarded SOR/EOR
<span class="lineNum">     623 </span>            :         //for (iblock=0; iblock&lt;fBlockDataArray.size(); iblock++) {
<span class="lineNum">     624 </span>            :         //  if ((AliHLTUInt8_t*)fBlockDataArray[iblock].fPtr &gt;= pTgtBuffer+size) continue;
<span class="lineNum">     625 </span>            :         //  if (pTgtBuffer &gt;= (AliHLTUInt8_t*)fBlockDataArray[iblock].fPtr+fBlockDataArray[iblock].fSize) continue;
<span class="lineNum">     626 </span>            :         //  HLTFatal(&quot;input and output buffer overlap for block descriptor %d (ptr %p size %d): output buffer %p %d&quot;,
<span class="lineNum">     627 </span>            :         //         iblock, fBlockDataArray[iblock].fPtr, fBlockDataArray[iblock].fSize,
<span class="lineNum">     628 </span>            :         //         pTgtBuffer, size);
<span class="lineNum">     629 </span>            :         //}     
<span class="lineNum">     630 </span>            : 
<span class="lineNum">     631 </span>            :         // process
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :         evtData.fBlockCnt=fBlockDataArray.size();</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :         iResult=pComponent-&gt;ProcessEvent(evtData, &amp;fBlockDataArray[0], trigData, pTgtBuffer, size, outputBlockCnt, outputBlocks, edd);</span>
<span class="lineNum">     634 </span>            :         HLTDebug(&quot;component %s ProcessEvent finnished (%d): size=%d blocks=%d&quot;, pComponent-&gt;GetComponentID(), iResult, size, outputBlockCnt);
<span class="lineNum">     635 </span>            : 
<span class="lineNum">     636 </span>            :         // EventDoneData is for the moment ignored in AliHLTSystem
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :         if (edd) {</span>
<span class="lineNum">     638 </span>            :           HLTDebug(&quot;got EventDoneData size %d&quot;, edd-&gt;fDataSize);
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :           delete [] reinterpret_cast&lt;char*&gt;(edd);</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :           edd=NULL;</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span>            :         // remove event data block
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :         fBlockDataArray.pop_back();</span>
<span class="lineNum">     645 </span>            : 
<span class="lineNum">     646 </span>            :         // check for forwarded blocks.
<span class="lineNum">     647 </span>            :         // loop over all output blocks and check
<span class="lineNum">     648 </span>            :         // 1. for duplicate blocks (pointing to same location in output buffer
<span class="lineNum">     649 </span>            :         //    or to the same buffer)
<span class="lineNum">     650 </span>            :         // 2. for blocks forwarded from the input.
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :         if (iResult&gt;=0 &amp;&amp; outputBlocks) {</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :           if (fListTargets.First()!=NULL) {</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :             AliHLTComponentBlockDataList segments;</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :             for (AliHLTUInt32_t oblock=0; oblock&lt;outputBlockCnt; oblock++) {</span>
<span class="lineNum">     655 </span>            :               // consistency check for data reference
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :               if (outputBlocks[oblock].fPtr!=NULL &amp;&amp; outputBlocks[oblock].fPtr!=pTgtBuffer &amp;&amp;</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :                   outputBlocks[oblock].fOffset!=0) {</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :                 HLTWarning(&quot;output block %s 0x%08x has inconsistent data reference ptr=%p offset=0x%08x: &quot;</span>
<span class="lineNum">     659 </span>            :                            &quot;for new blocks use offset only, forwarded blocks have fPtr set only&quot;,
<span class="lineNum">     660 </span>            :                            AliHLTComponent::DataType2Text(outputBlocks[oblock].fDataType).c_str(),
<span class="lineNum">     661 </span>            :                            outputBlocks[oblock].fSpecification,
<span class="lineNum">     662 </span>            :                            outputBlocks[oblock].fPtr, outputBlocks[oblock].fOffset);
<span class="lineNum">     663 </span>            :               }
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span>            :               // check for duplicates in the output
<span class="lineNum">     666 </span>            :               // this check applies for forwarded data blocks where
<span class="lineNum">     667 </span>            :               // the ptr is not inside the target buffer
<span class="lineNum">     668 </span>            :               AliHLTUInt32_t checkblock=0;
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :               for (; checkblock&lt;oblock; checkblock++) {</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :                 if (outputBlocks[oblock].fPtr!=NULL &amp;&amp; outputBlocks[oblock].fPtr!=pTgtBuffer &amp;&amp;</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :                     outputBlocks[checkblock].fPtr==outputBlocks[oblock].fPtr) {</span>
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :                   if (outputBlocks[checkblock].fSize!=outputBlocks[oblock].fSize ||</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :                       outputBlocks[checkblock].fDataType!=outputBlocks[oblock].fDataType) {</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :                     HLTWarning(&quot;output blocks %d (%s 0x%08x) and %d (%s 0x%08x) have identical data references ptr=%p &quot;</span>
<span class="lineNum">     675 </span>            :                                &quot;but differ in data type and/or size: %d vs. %d, ignoring block %d&quot;,
<span class="lineNum">     676 </span>            :                                oblock,
<span class="lineNum">     677 </span>            :                                AliHLTComponent::DataType2Text(outputBlocks[oblock].fDataType).c_str(),
<span class="lineNum">     678 </span>            :                                outputBlocks[oblock].fSpecification,
<span class="lineNum">     679 </span>            :                                checkblock,
<span class="lineNum">     680 </span>            :                                AliHLTComponent::DataType2Text(outputBlocks[checkblock].fDataType).c_str(),
<span class="lineNum">     681 </span>            :                                outputBlocks[checkblock].fSpecification,
<span class="lineNum">     682 </span>            :                                outputBlocks[oblock].fPtr,
<span class="lineNum">     683 </span>            :                                outputBlocks[oblock].fSize,
<span class="lineNum">     684 </span>            :                                outputBlocks[checkblock].fSize,
<span class="lineNum">     685 </span>            :                                checkblock);
<span class="lineNum">     686 </span>            :                   }
<span class="lineNum">     687 </span>            :                   // ignore from the second copy
<span class="lineNum">     688 </span>            :                   break;
<span class="lineNum">     689 </span>            :                 }
<span class="lineNum">     690 </span>            :               }
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :               if (checkblock&lt;oblock) continue;</span>
<span class="lineNum">     692 </span>            : 
<span class="lineNum">     693 </span>            :               // search for the forwarded data blocks
<span class="lineNum">     694 </span>            :               // new data blocks are announced to the data buffer, forwarded data blocks
<span class="lineNum">     695 </span>            :               // to the publisher task. The publisher task of a forwarded data block is
<span class="lineNum">     696 </span>            :               // removed from the list in order to keep the buffer open. It will be releases
<span class="lineNum">     697 </span>            :               // when the subscribing task releases it
<span class="lineNum">     698 </span>            :               iblock=0;
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :               for (; iblock&lt;fBlockDataArray.size(); iblock++) {</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :                 if (outputBlocks[oblock].fDataType==kAliHLTDataTypeEvent) {</span>
<span class="lineNum">     701 </span>            :                   // the event type data block is an artificial data block
<span class="lineNum">     702 </span>            :                   // ignore if it was forwarded
<span class="lineNum">     703 </span>            :                   break;
<span class="lineNum">     704 </span>            :                 }
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :                 if (fBlockDataArray[iblock].fPtr==outputBlocks[oblock].fPtr) {</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :                   assert(subscribedTaskList[iblock]!=NULL);</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :                   if (subscribedTaskList[iblock]==NULL) {</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :                     ALIHLTERRORGUARD(1, &quot;missing parent task for forwarded data block %s 0x%08x, original data block %s 0x%08x, subsequent errors are suppressed&quot;,</span>
<span class="lineNum">     709 </span>            :                                      AliHLTComponent::DataType2Text(outputBlocks[oblock].fDataType).c_str(),
<span class="lineNum">     710 </span>            :                                      outputBlocks[oblock].fSpecification,
<span class="lineNum">     711 </span>            :                                      AliHLTComponent::DataType2Text(outputBlocks[iblock].fDataType).c_str(),
<span class="lineNum">     712 </span>            :                                      outputBlocks[iblock].fSpecification);
<span class="lineNum">     713 </span>            :                     continue;
<span class="lineNum">     714 </span>            :                   }
<span class="lineNum">     715 </span>            :                   HLTDebug(&quot;forward segment %d (source task %s %p) to data buffer %p&quot;, iblock, pSrcTask-&gt;GetName(), pSrcTask, fpDataBuffer);
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :                   fpDataBuffer-&gt;Forward(subscribedTaskList[iblock], &amp;fBlockDataArray[iblock]);</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :                   subscribedTaskList[iblock]=NULL; // not to be released in the loop further down</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :                   break;</span>
<span class="lineNum">     719 </span>            :                 }
<span class="lineNum">     720 </span>            :               }
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :               if (iblock==fBlockDataArray.size()) segments.push_back(outputBlocks[oblock]);</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :             if (pTgtBuffer &amp;&amp; segments.size()&gt;0) {</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :               iResult=fpDataBuffer-&gt;SetSegments(pTgtBuffer, &amp;segments[0], segments.size());</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :           } else {</span>
<span class="lineNum">     727 </span>            :             // no forwarding, actually we dont even need to keep the data, this is a
<span class="lineNum">     728 </span>            :             // dead end (fListTargets empty)
<span class="lineNum">     729 </span>            :             //iResult=fpDataBuffer-&gt;SetSegments(pTgtBuffer, outputBlocks, outputBlockCnt);
<span class="lineNum">     730 </span>            :           }
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :           delete [] outputBlocks; outputBlocks=NULL; outputBlockCnt=0;</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :           fpDataBuffer-&gt;Reset();</span>
<span class="lineNum">     734 </span>            :         }
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :         if (fListTargets.First()!=NULL) {</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :           if (iSOR&gt;=0 &amp;&amp; subscribedTaskList[iSOR]!=NULL) {</span>
<span class="lineNum">     737 </span>            :             HLTDebug(&quot;forward SOR event segment %d (source task %s %p) to data buffer %p&quot;, iSOR, pSrcTask-&gt;GetName(), pSrcTask, fpDataBuffer);
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :             fpDataBuffer-&gt;Forward(subscribedTaskList[iSOR], &amp;fBlockDataArray[iSOR]);</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :             subscribedTaskList[iSOR]=NULL; // not to be released in the loop further down</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :           if (iEOR&gt;=0 &amp;&amp; subscribedTaskList[iEOR]!=NULL) {</span>
<span class="lineNum">     742 </span>            :             HLTDebug(&quot;forward EOR event (%s) segment %d (source task %s %p) to data buffer %p&quot;, AliHLTComponent::DataType2Text(fBlockDataArray[iEOR].fDataType).c_str(), iEOR, pSrcTask-&gt;GetName(), pSrcTask, fpDataBuffer);
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :             fpDataBuffer-&gt;Forward(subscribedTaskList[iEOR], &amp;fBlockDataArray[iEOR]);</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :             subscribedTaskList[iEOR]=NULL; // not to be released in the loop further down</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :           if (iECS&gt;=0 &amp;&amp; subscribedTaskList[iECS]!=NULL) {</span>
<span class="lineNum">     747 </span>            :             HLTDebug(&quot;forward ECS event (%s) segment %d (source task %s %p) to data buffer %p&quot;, AliHLTComponent::DataType2Text(fBlockDataArray[iECS].fDataType).c_str(), iECS, pSrcTask-&gt;GetName(), pSrcTask, fpDataBuffer);
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :             fpDataBuffer-&gt;Forward(subscribedTaskList[iECS], &amp;fBlockDataArray[iECS]);</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :             subscribedTaskList[iECS]=NULL; // not to be released in the loop further down</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">     751 </span>            :         }
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :         HLTError(&quot;no target buffer available&quot;);</span>
<span class="lineNum">     754 </span>            :         iResult=-EFAULT;
<span class="lineNum">     755 </span>            :       }
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :     } while (iResult==-ENOSPC &amp;&amp; iNofTrial++&lt;1);</span>
<span class="lineNum">     757 </span>            :     }
<span class="lineNum">     758 </span>            : 
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :     fBlockDataArray.clear();</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :     if (CheckFilter(kHLTLogDebug)) Print(&quot;proc&quot;);</span>
<span class="lineNum">     761 </span>            : 
<span class="lineNum">     762 </span>            :     // now release all buffers which we have subscribed to
<span class="lineNum">     763 </span>            :     iSourceDataBlock=0;
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :     AliHLTTaskPList::iterator element;</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :     while ((element=subscribedTaskList.begin())!=subscribedTaskList.end()) {</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :       pSrcTask=*element;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :       if (pSrcTask) {</span>
<span class="lineNum">     768 </span>            :         int iTempRes=0;
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :         if ((iTempRes=pSrcTask-&gt;Release(&amp;fBlockDataArray[iSourceDataBlock], this))&gt;=0) {</span>
<span class="lineNum">     770 </span>            :           HLTDebug(&quot;successfully released segment of task %s (%p)&quot;, pSrcTask-&gt;GetName(), pSrcTask);
<span class="lineNum">     771 </span>            :         } else {
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :           HLTError(&quot;realease of task %s (%p) failed with error %d&quot;, pSrcTask-&gt;GetName(), pSrcTask, iTempRes);</span>
<span class="lineNum">     773 </span>            :         }
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :       subscribedTaskList.erase(element);</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :       iSourceDataBlock++;</span>
<span class="lineNum">     777 </span>            :     }
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :     if (subscribedTaskList.size()&gt;0) {</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :       HLTError(&quot;could not release all data buffers&quot;);</span>
<span class="lineNum">     780 </span>            :     }
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :     HLTError(&quot;internal failure (not initialized component %p, data buffer %p)&quot;, fpComponent, fpDataBuffer);</span>
<span class="lineNum">     783 </span>            :     iResult=-EFAULT;
<span class="lineNum">     784 </span>            :   }
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="786"><span class="lineNum">     786 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     787 </span>            : 
<span class="lineNum">     788 </span>            : int AliHLTTask::SubscribeSourcesAndSkip()
<span class="lineNum">     789 </span>            : {
<span class="lineNum">     790 </span>            :   // function carries out the proper cleanup of the source components
<span class="lineNum">     791 </span>            :   // by subscribing and releasing
<span class="lineNum">     792 </span>            :   int iResult=0;  
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :   AliHLTTask* pSrcTask=NULL;</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :   AliHLTTaskPList subscribedTaskList;</span>
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span>            :   // cleanup the data buffer
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :   if (fpDataBuffer) fpDataBuffer-&gt;Reset();</span>
<span class="lineNum">     798 </span>            : 
<span class="lineNum">     799 </span>            :   // subscribe to all source tasks
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :   fBlockDataArray.clear();</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :   for (TObjLink* lnk=fListDependencies.FirstLink(); lnk!=NULL; lnk=lnk-&gt;Next()) {</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :     if (!lnk-&gt;GetObject()) continue;</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :     pSrcTask=dynamic_cast&lt;AliHLTTask*&gt;(lnk-&gt;GetObject());</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :     if (!pSrcTask) continue;</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :     unsigned iPosition=fBlockDataArray.size();</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :     if ((iResult=pSrcTask-&gt;Subscribe(this, fBlockDataArray))&gt;0) {</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :       for (unsigned i=iPosition; i&lt;fBlockDataArray.size(); i++) {</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :         subscribedTaskList.push_back(pSrcTask);</span>
<span class="lineNum">     809 </span>            :       }
<span class="lineNum">     810 </span>            :       HLTDebug(&quot;subscribed to %d blocks of task %s (%p)&quot;, iResult, pSrcTask-&gt;GetName(), pSrcTask, iResult);
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :     } else if (iResult&lt;0) {</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :       HLTError(&quot;failed to subscribe to task %s (%p) with error %d&quot;, pSrcTask-&gt;GetName(), pSrcTask, iResult);</span>
<span class="lineNum">     813 </span>            :     }
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     815 </span>            : 
<span class="lineNum">     816 </span>            :   unsigned iSourceDataBlock=0;
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :   AliHLTTaskPList::iterator element;</span>
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :   while ((element=subscribedTaskList.begin())!=subscribedTaskList.end()) {</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :     assert(iSourceDataBlock&lt;fBlockDataArray.size());</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :     pSrcTask=*element;</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     if (pSrcTask &amp;&amp; iSourceDataBlock&lt;fBlockDataArray.size()) {</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :       if ((iResult=pSrcTask-&gt;Release(&amp;fBlockDataArray[iSourceDataBlock], this))&gt;=0) {</span>
<span class="lineNum">     823 </span>            :         HLTDebug(&quot;successfully released segment of task %s (%p)&quot;, pSrcTask-&gt;GetName(), pSrcTask);
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :       } else if (iSourceDataBlock&gt;=fBlockDataArray.size()) {</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :         HLTError(&quot;mismatch between list of subscribed tasks and block list in task %s (%p), can not release task %s (%p)&quot;, GetName(), this, pSrcTask-&gt;GetName(), pSrcTask);</span>
<span class="lineNum">     826 </span>            :       } else {
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :         HLTError(&quot;realease of task %s (%p) failed with error %d&quot;, pSrcTask-&gt;GetName(), pSrcTask, iResult);</span>
<span class="lineNum">     828 </span>            :       }
<span class="lineNum">     829 </span>            :     }
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :     subscribedTaskList.erase(element);</span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :     iSourceDataBlock++;</span>
<span class="lineNum">     832 </span>            :   }
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :   if (iSourceDataBlock&lt;fBlockDataArray.size()) {</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :     HLTWarning(&quot;not all subscriptions released for task %s (%p)&quot;, GetName(), this);</span>
<span class="lineNum">     835 </span>            :   }
<span class="lineNum">     836 </span>            : 
<span class="lineNum">     837 </span>            :   return 0;
<a name="838"><span class="lineNum">     838 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     839 </span>            : 
<span class="lineNum">     840 </span>            : int AliHLTTask::GetNofMatchingDataBlocks(const AliHLTTask* pConsumerTask) const
<span class="lineNum">     841 </span>            : {
<span class="lineNum">     842 </span>            :   // see header file for function documentation
<span class="lineNum">     843 </span>            :   int iResult=0;
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :   if (pConsumerTask) {</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :     if (fpDataBuffer) {</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :       iResult=fpDataBuffer-&gt;FindMatchingDataBlocks(pConsumerTask-&gt;GetComponent(), NULL);</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :       HLTFatal(&quot;internal data buffer missing&quot;);</span>
<span class="lineNum">     849 </span>            :       iResult=-EFAULT;
<span class="lineNum">     850 </span>            :     }
<span class="lineNum">     851 </span>            :   } else {
<span class="lineNum">     852 </span>            :     iResult=-EINVAL;
<span class="lineNum">     853 </span>            :   }
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="855"><span class="lineNum">     855 </span>            : }</a>
<span class="lineNum">     856 </span>            : 
<span class="lineNum">     857 </span>            : int AliHLTTask::GetNofMatchingDataTypes(const AliHLTTask* pConsumerTask) const
<span class="lineNum">     858 </span>            : {
<span class="lineNum">     859 </span>            :   // see header file for function documentation
<span class="lineNum">     860 </span>            :   int iResult=0;
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :   if (pConsumerTask) {</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :     AliHLTComponent* pComponent=GetComponent();</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :     if (!pComponent) {</span>
<span class="lineNum">     864 </span>            :       // init ?
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :       HLTError(&quot;component not initialized&quot;);</span>
<span class="lineNum">     866 </span>            :       iResult=-EFAULT;
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     if (pComponent) {</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :       iResult=pComponent-&gt;FindMatchingDataTypes(pConsumerTask-&gt;GetComponent(), NULL);</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :       HLTFatal(&quot;task initialization failed&quot;);</span>
<span class="lineNum">     872 </span>            :       iResult=-EFAULT;
<span class="lineNum">     873 </span>            :     }
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     875 </span>            :     iResult=-EINVAL;
<span class="lineNum">     876 </span>            :   }
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="878"><span class="lineNum">     878 </span>            : }</a>
<span class="lineNum">     879 </span>            : 
<span class="lineNum">     880 </span>            : int AliHLTTask::Subscribe(const AliHLTTask* pConsumerTask, AliHLTComponentBlockDataList&amp; blockDescList)
<span class="lineNum">     881 </span>            : {
<span class="lineNum">     882 </span>            :   // see header file for function documentation
<span class="lineNum">     883 </span>            :   int iResult=0;
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :   if (pConsumerTask) {</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :     if (fpDataBuffer) {</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :       iResult=fpDataBuffer-&gt;Subscribe(pConsumerTask-&gt;GetComponent(), blockDescList);</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :       HLTFatal(&quot;internal data buffer missing&quot;);</span>
<span class="lineNum">     889 </span>            :       iResult=-EFAULT;
<span class="lineNum">     890 </span>            :     }
<span class="lineNum">     891 </span>            :   } else {
<span class="lineNum">     892 </span>            :     iResult=-EINVAL;
<span class="lineNum">     893 </span>            :   }
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="895"><span class="lineNum">     895 </span>            : }</a>
<span class="lineNum">     896 </span>            : 
<span class="lineNum">     897 </span>            : int AliHLTTask::Release(AliHLTComponentBlockData* pBlockDesc, const AliHLTTask* pConsumerTask)
<span class="lineNum">     898 </span>            : {
<span class="lineNum">     899 </span>            :   // see header file for function documentation
<span class="lineNum">     900 </span>            :   int iResult=0;
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :   if (pConsumerTask &amp;&amp; pBlockDesc) {</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :     if (fpDataBuffer) {</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :       iResult=fpDataBuffer-&gt;Release(pBlockDesc, pConsumerTask-&gt;GetComponent(), this);</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :       HLTFatal(&quot;internal data buffer missing&quot;);</span>
<span class="lineNum">     906 </span>            :       iResult=-EFAULT;
<span class="lineNum">     907 </span>            :     }
<span class="lineNum">     908 </span>            :   } else {
<span class="lineNum">     909 </span>            :     iResult=-EINVAL;
<span class="lineNum">     910 </span>            :   }
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="912"><span class="lineNum">     912 </span>            : }</a>
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span>            : void AliHLTTask::PrintStatus()
<span class="lineNum">     915 </span>            : {
<span class="lineNum">     916 </span>            :   // see header file for function documentation
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :   HLTLogKeyword(&quot;task properties&quot;);</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :   AliHLTComponent* pComponent=GetComponent();</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :   if (pComponent) {</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;     component: %s (%p)&quot;, pComponent-&gt;GetComponentID(), pComponent);</span>
<span class="lineNum">     921 </span>            :   } else {
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;     no component set!&quot;);</span>
<span class="lineNum">     923 </span>            :   }
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :   if (fpConfiguration) {</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :     AliHLTConfiguration* pSrc=fpConfiguration-&gt;GetFirstSource();</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     while (pSrc) {</span>
<span class="lineNum">     927 </span>            :       const char* pQualifier=&quot;unresolved&quot;;
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :       if (FindDependency(pSrc-&gt;GetName()))</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :         pQualifier=&quot;resolved&quot;;</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :       HLTMessage(&quot;     source: %s (%s)&quot;, pSrc-&gt;GetName(), pQualifier);</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :       pSrc=fpConfiguration-&gt;GetNextSource();</span>
<span class="lineNum">     932 </span>            :     }
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :     TObjLink* lnk = fListTargets.FirstLink();</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :     while (lnk) {</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :       TObject *obj = lnk-&gt;GetObject();</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :       HLTMessage(&quot;     target: %s&quot;, obj-&gt;GetName());</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :       lnk = lnk-&gt;Next();</span>
<span class="lineNum">     938 </span>            :     }
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;     task not initialized&quot;);</span>
<span class="lineNum">     941 </span>            :   }
<a name="942"><span class="lineNum">     942 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     943 </span>            : 
<span class="lineNum">     944 </span>            : void AliHLTTask::Print(const char* options) const
<span class="lineNum">     945 </span>            : {
<span class="lineNum">     946 </span>            :   // Overloaded from TObject
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :   if (strcmp(options, &quot;proc&quot;)==0) {</span>
<span class="lineNum">     948 </span>            :     // print processing info
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;**********************************************&quot;);</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;******* AliHLTTask Processing info ***********&quot;);</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :     HLTMessage(&quot; component: %p %s&quot;, fpComponent, (fpComponent?fpComponent-&gt;GetComponentID():&quot;&quot;));</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :     HLTMessage(&quot; data buffer: %p&quot;, fpDataBuffer);</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :     if (fpDataBuffer) fpDataBuffer-&gt;Print(&quot;&quot;);</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :     HLTMessage(&quot; input block descriptors: %d&quot;, fBlockDataArray.size());</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :     for (unsigned i=0; i&lt;fBlockDataArray.size(); i++) {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :       HLTMessage(&quot;  %d: %s 0x%08x %p %d&quot;, i,</span>
<span class="lineNum">     957 </span>            :                  AliHLTComponent::DataType2Text(fBlockDataArray[i].fDataType).c_str(),
<span class="lineNum">     958 </span>            :                  fBlockDataArray[i].fSpecification,
<span class="lineNum">     959 </span>            :                  fBlockDataArray[i].fPtr,
<span class="lineNum">     960 </span>            :                  fBlockDataArray[i].fSize
<span class="lineNum">     961 </span>            :                  );
<span class="lineNum">     962 </span>            :     }
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;**** end of AliHLTTask Processing info *******&quot;);</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     HLTMessage(&quot;**********************************************&quot;);</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     966 </span>            :   }
<span class="lineNum">     967 </span>            : 
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;AliHLTTask &quot; &lt;&lt; GetName() &lt;&lt; &quot; &quot; &lt;&lt; this</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; component &quot; &lt;&lt; fpComponent &lt;&lt; &quot; &quot;</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :        &lt;&lt; (fpComponent?fpComponent-&gt;GetComponentID():&quot;&quot;)</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :        &lt;&lt; endl;</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 : }</span>
<a name="973"><span class="lineNum">     973 </span>            : </a>
<span class="lineNum">     974 </span>            : 
<span class="lineNum">     975 </span>            : int AliHLTTask::CustomInit(AliHLTComponentHandler* /*pCH*/)
<span class="lineNum">     976 </span>            : {
<span class="lineNum">     977 </span>            :   // default implementation nothing to do
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="979"><span class="lineNum">     979 </span>            : }</a>
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span>            : int AliHLTTask::CustomCleanup()
<span class="lineNum">     982 </span>            : {
<span class="lineNum">     983 </span>            :   // default implementation nothing to do
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="985"><span class="lineNum">     985 </span>            : }</a>
<span class="lineNum">     986 </span>            : 
<span class="lineNum">     987 </span>            : int AliHLTTask::LoggingVarargs(AliHLTComponentLogSeverity severity, 
<span class="lineNum">     988 </span>            :                                     const char* originClass, const char* originFunc,
<span class="lineNum">     989 </span>            :                                     const char* file, int line, ... ) const
<span class="lineNum">     990 </span>            : {
<span class="lineNum">     991 </span>            :   // see header file for function documentation
<span class="lineNum">     992 </span>            :   int iResult=0;
<span class="lineNum">     993 </span>            : 
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :   va_list args;</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :   va_start(args, line);</span>
<span class="lineNum">     996 </span>            : 
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :   AliHLTLogging::SetLogString(this, &quot; (%p)&quot;, &quot;%s_pfmt_: &quot;, GetName());</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :   iResult=SendMessage(severity, originClass, originFunc, file, line, AliHLTLogging::BuildLogString(NULL, args, true /*append*/));</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :   va_end(args);</span>
<span class="lineNum">    1000 </span>            : 
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :   return iResult;</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
