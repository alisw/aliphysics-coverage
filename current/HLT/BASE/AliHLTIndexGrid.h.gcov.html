<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HLT/BASE/AliHLTIndexGrid.h</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">HLT/BASE</a> - AliHLTIndexGrid.h<span style="font-size: 80%;"> (source / <a href="AliHLTIndexGrid.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">193</td>
            <td class="headerCovTableEntryLo">0.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">3</td>
            <td class="headerCovTableEntry">141</td>
            <td class="headerCovTableEntryLo">2.1 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : //-*- Mode: C++ -*-</a>
<span class="lineNum">       2 </span>            : // $Id$
<span class="lineNum">       3 </span>            : #ifndef ALIHLTINDEXGRID_H
<span class="lineNum">       4 </span>            : #define ALIHLTINDEXGRID_H
<span class="lineNum">       5 </span>            : //* This file is property of and copyright by the ALICE HLT Project        * 
<span class="lineNum">       6 </span>            : //* ALICE Experiment at CERN, All rights reserved.                         *
<span class="lineNum">       7 </span>            : //* See cxx source for full Copyright notice                               *
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : /// @file   AliHLTIndexGrid.h
<span class="lineNum">      10 </span>            : /// @author Matthias Richter
<span class="lineNum">      11 </span>            : /// @date   2011-08-14
<span class="lineNum">      12 </span>            : /// @brief  Index grid for 3 dimensional coordinates
<span class="lineNum">      13 </span>            : ///
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : #include &quot;AliHLTDataTypes.h&quot;
<span class="lineNum">      16 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      17 </span>            : #include &lt;iomanip&gt;
<span class="lineNum">      18 </span>            : #include &lt;memory&gt;
<span class="lineNum">      19 </span>            : #include &lt;cerrno&gt;
<span class="lineNum">      20 </span>            : #include &lt;cmath&gt;
<span class="lineNum">      21 </span>            : 
<span class="lineNum">      22 </span>            : template &lt;typename T, typename V&gt;
<a name="23"><span class="lineNum">      23 </span>            : class AliHLTIndexGrid {</a>
<span class="lineNum">      24 </span>            :  public:
<span class="lineNum">      25 </span>            :   AliHLTIndexGrid(T maxX, T stepX,
<span class="lineNum">      26 </span>            :                   T maxY, T stepY,
<span class="lineNum">      27 </span>            :                   T maxZ, T stepZ,
<span class="lineNum">      28 </span>            :                   int initialDataSize=-1)
<span class="lineNum">      29 </span><span class="lineNoCov">          0 :     : fMaxX(maxX)</span>
<span class="lineNum">      30 </span><span class="lineNoCov">          0 :     , fStepX(stepX)</span>
<span class="lineNum">      31 </span><span class="lineNoCov">          0 :     , fMaxY(maxY)</span>
<span class="lineNum">      32 </span><span class="lineNoCov">          0 :     , fStepY(stepY)</span>
<span class="lineNum">      33 </span><span class="lineNoCov">          0 :     , fMaxZ(maxZ)</span>
<span class="lineNum">      34 </span><span class="lineNoCov">          0 :     , fStepZ(stepZ)</span>
<span class="lineNum">      35 </span><span class="lineNoCov">          0 :     , fDimX(0)</span>
<span class="lineNum">      36 </span><span class="lineNoCov">          0 :     , fDimY(0)</span>
<span class="lineNum">      37 </span><span class="lineNoCov">          0 :     , fDimZ(0)</span>
<span class="lineNum">      38 </span><span class="lineNoCov">          0 :     , fCells(NULL)</span>
<span class="lineNum">      39 </span><span class="lineNoCov">          0 :     , fCellDimension(0)</span>
<span class="lineNum">      40 </span><span class="lineNoCov">          0 :     , fData(NULL)</span>
<span class="lineNum">      41 </span><span class="lineNoCov">          0 :     , fDataDimension(initialDataSize)</span>
<span class="lineNum">      42 </span><span class="lineNoCov">          0 :     , fCount(0)</span>
<span class="lineNum">      43 </span><span class="lineNoCov">          0 :     , fIterator()</span>
<span class="lineNum">      44 </span><span class="lineNoCov">          0 :     , fIteratorEnd()</span>
<span class="lineNum">      45 </span><span class="lineNoCov">          0 :   {</span>
<span class="lineNum">      46 </span>            :     // constructor
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :     if (fMaxX&gt;0. &amp;&amp; fMaxY&gt;0. &amp;&amp; fMaxZ&gt;0 &amp;&amp;</span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 :         fStepX&gt;0. &amp;&amp; fStepY&gt;0. &amp;&amp; fStepZ&gt;0) {</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :       fDimX=(int)ceil(fMaxX/fStepX);</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 :       fDimY=(int)ceil(fMaxY/fStepY);</span>
<span class="lineNum">      51 </span><span class="lineNoCov">          0 :       fDimZ=(int)ceil(fMaxZ/fStepZ);</span>
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :       fCellDimension=fDimX*fDimY*fDimZ;</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :       fCells=new AliHLTIndexGridCell[fCellDimension];</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :       if (fDataDimension&lt;0) fDataDimension=fgkDefaultDataSize;</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :       fData=new V[fDataDimension];</span>
<span class="lineNum">      57 </span><span class="lineNoCov">          0 :       Clear();</span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :     }</span>
<a name="59"><span class="lineNum">      59 </span><span class="lineNoCov">          0 :   }</span></a>
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :   virtual ~AliHLTIndexGrid() {</span>
<span class="lineNum">      62 </span>            :     // destructor
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :     if (fData) delete [] fData;</span>
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :     if (fCells) delete [] fCells;</span>
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      66 </span>            : 
<span class="lineNum">      67 </span>            :   // for now array of spacepoint ids
<a name="68"><span class="lineNum">      68 </span>            :   typedef V ValueType;</a>
<a name="69"><span class="lineNum">      69 </span>            : </a>
<a name="70"><span class="lineNum">      70 </span><span class="lineNoCov">          0 :   int GetDimensionX() const {return fDimX;}</span></a>
<a name="71"><span class="lineNum">      71 </span><span class="lineNoCov">          0 :   int GetDimensionY() const {return fDimY;}</span></a>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   int GetDimensionZ() const {return fDimZ;}</span>
<span class="lineNum">      73 </span>            :   int GetXIndex(T x) const {
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :     if (x&gt;fMaxX) return fDimX-1;</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :     if (x&lt;0) return 0;</span>
<a name="76"><span class="lineNum">      76 </span><span class="lineNoCov">          0 :     return (int)(x/fStepX);</span></a>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      78 </span>            :   int GetYIndex(T y) const {
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     if (y&gt;fMaxY) return fDimY-1;</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :     if (y&lt;0) return 0;</span>
<a name="81"><span class="lineNum">      81 </span><span class="lineNoCov">          0 :     return (int)(y/fStepY);</span></a>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      83 </span>            :   int GetZIndex(T z) const {
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :     if (z&gt;fMaxZ) return fDimZ-1;</span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     if (z&lt;0) return 0;</span>
<a name="86"><span class="lineNum">      86 </span><span class="lineNoCov">          0 :     return (int)(z/fStepZ);</span></a>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      88 </span>            :   int Index(int xindex, int yindex, int zindex) {
<a name="89"><span class="lineNum">      89 </span><span class="lineNoCov">          0 :     return xindex*fDimY*fDimZ + yindex*fDimZ + zindex;</span></a>
<span class="lineNum">      90 </span>            :   }
<span class="lineNum">      91 </span>            :   T GetLowerBoundX(int cell) const {
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :     int index=cell/(fDimY*fDimZ);</span>
<a name="94"><span class="lineNum">      94 </span><span class="lineNoCov">          0 :     return index*fStepX;</span></a>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      96 </span>            :   T GetCenterX(int cell) const {
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<a name="98"><span class="lineNum">      98 </span><span class="lineNoCov">          0 :     return GetLowerBoundX(cell)+fStepX/2;</span></a>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     100 </span>            :   T GetLowerBoundY(int cell) const {
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :     int index=cell%(fDimY*fDimZ); index/=fDimZ;</span>
<a name="103"><span class="lineNum">     103 </span><span class="lineNoCov">          0 :     return index*fStepY;</span></a>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     105 </span>            :   T GetCenterY(int cell) const {
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<a name="107"><span class="lineNum">     107 </span><span class="lineNoCov">          0 :     return GetLowerBoundY(cell)+fStepY/2;</span></a>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     109 </span>            :   T GetLowerBoundZ(int cell) const {
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :     int index=cell%(fDimY*fDimZ); index%=fDimZ;</span>
<a name="112"><span class="lineNum">     112 </span><span class="lineNoCov">          0 :     return index*fStepZ;</span></a>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     114 </span>            :   T GetCenterZ(int cell) const {
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     if (fDimX==0 || fDimY==0 ||fDimZ==0) return (T)0;</span>
<a name="116"><span class="lineNum">     116 </span><span class="lineNoCov">          0 :     return GetLowerBoundZ(cell)+fStepZ/2;</span></a>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     118 </span>            :   int GetCellIndex(T x, T y, T z) const {
<a name="119"><span class="lineNum">     119 </span><span class="lineNoCov">          0 :     return GetXIndex(x)*fDimY*fDimZ + (y&lt;0?0:GetYIndex(y))*fDimZ + (z&lt;0?0:GetZIndex(z));</span></a>
<span class="lineNum">     120 </span>            :   }
<span class="lineNum">     121 </span>            :   int GetNumberOfSpacePoints(int index=0, int endIndex=-1) const {
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     if (!fCells) return 0;</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :     if (endIndex&lt;0) endIndex=fCellDimension;</span>
<span class="lineNum">     124 </span>            :     int count=0;
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :     for (int cell=index; cell&lt;endIndex &amp;&amp; cell&lt;fCellDimension &amp;&amp; count&lt;fCount; cell++) if (fCells[cell].fCount&gt;0) count+=fCells[cell].fCount;</span>
<span class="lineNum">     126 </span>            :     return count;
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   }</span>
<a name="128"><span class="lineNum">     128 </span>            : </a>
<span class="lineNum">     129 </span>            :   // increment counter of the cell where the spacepoint is
<span class="lineNum">     130 </span>            :   int CountSpacePoint(T x, T y, T z) {
<span class="lineNum">     131 </span>            :     // increment counter of the cell where the spacepoint is
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :     int cell=GetCellIndex(x, y, z);</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     if (cell&lt;0 || !fCells || cell&gt;=fCellDimension) return -EFAULT;</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     if (fCells[cell].fCount&lt;0) fCells[cell].fCount=1;</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :     else fCells[cell].fCount++;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     138 </span>            : 
<a name="139"><span class="lineNum">     139 </span>            : </a>
<span class="lineNum">     140 </span>            :   // add spacepoint, all spacepoints must have been counted before
<span class="lineNum">     141 </span>            :   int AddSpacePoint(ValueType t, T x, T y, T z) {
<span class="lineNum">     142 </span>            :     // add spacepoint, all spacepoints must have been counted before
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     int cell=GetCellIndex(x, y, z);</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :     if (cell&lt;0 || !fCells || cell&gt;=fCellDimension) return -EFAULT;</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :     if (fCells[cell].fFilled==fCells[cell].fCount) return -ENOSPC;</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     if (fCells[cell].fStartIndex&lt;0 &amp;&amp; IndexCells()&lt;0) return -EACCES;</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     int offset=fCells[cell].fStartIndex+fCells[cell].fFilled;</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     fData[offset]=t;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :     fCells[cell].fFilled++;</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     fCount++;</span>
<span class="lineNum">     151 </span>            :     return 0;
<a name="152"><span class="lineNum">     152 </span><span class="lineNoCov">          0 :   }</span></a>
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span>            :   void Clear(const char* /*option*/=&quot;&quot;) {
<span class="lineNum">     155 </span>            :     // clear internal data
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :     if (fCells) memset(fCells, 0xff, fCellDimension*sizeof(AliHLTIndexGridCell));</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :     if (fData) memset(fData, 0, fDataDimension*sizeof(V));</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :     fCount=0;</span>
<a name="159"><span class="lineNum">     159 </span><span class="lineNoCov">          0 :   }</span></a>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            :   void Print(const char* /*option*/=&quot;&quot;) {
<span class="lineNum">     162 </span>            :   // print info
<span class="lineNum">     163 </span>            :   bool bPrintEmpty=false;
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   ios::fmtflags coutflags=cout.flags(); // backup cout status flags</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;AliHLTIndexGrid: &quot; &lt;&lt; (fCells?fCellDimension:0) &lt;&lt; &quot; cells&quot; &lt;&lt; endl;</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;   x: &quot; &lt;&lt; fDimX &lt;&lt; &quot; [0,&quot; &lt;&lt; fMaxX &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;   y: &quot; &lt;&lt; fDimY &lt;&lt; &quot; [0,&quot; &lt;&lt; fMaxY &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;   z: &quot; &lt;&lt; fDimZ &lt;&lt; &quot; [0,&quot; &lt;&lt; fMaxZ &lt;&lt; &quot;]&quot; &lt;&lt; endl;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;   &quot; &lt;&lt; GetNumberOfSpacePoints(0, fCellDimension) &lt;&lt; &quot; point(s)&quot; &lt;&lt; endl;</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :   if (fCells) {</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :     for (int i=0; i&lt;fCellDimension; i++) {</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :       if (!bPrintEmpty &amp;&amp; fCells[i].fCount&lt;=0) continue;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;     &quot; &lt;&lt; setfill(' ') &lt;&lt; setw(7) &lt;&lt; fixed &lt;&lt; setprecision(0) &lt;&lt; i &lt;&lt; &quot; (&quot; </span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :           &lt;&lt; &quot; &quot; &lt;&lt; setw(3) &lt;&lt; GetLowerBoundX(i)</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :           &lt;&lt; &quot; &quot; &lt;&lt; setw(3) &lt;&lt; GetLowerBoundY(i)</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :           &lt;&lt; &quot; &quot; &lt;&lt; setw(4) &lt;&lt; GetLowerBoundZ(i)</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :           &lt;&lt; &quot;): &quot;;</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :       cout &lt;&lt; setw(3) &lt;&lt; fCells[i].fCount &lt;&lt; &quot; entries, &quot; &lt;&lt; setw(3) &lt;&lt; fCells[i].fFilled &lt;&lt; &quot; filled&quot;;</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;  start index &quot; &lt;&lt; setw(5) &lt;&lt; fCells[i].fStartIndex;</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :       cout &lt;&lt; endl;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :       if (fCells[i].fCount&gt;0) {</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :         cout &lt;&lt; &quot;          &quot;;</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :         for (iterator id=begin(GetLowerBoundX(i), GetLowerBoundY(i), GetLowerBoundZ(i));</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :              id!=end(); id++) {</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :           cout &lt;&lt; &quot; 0x&quot; &lt;&lt; hex &lt;&lt; setw(8) &lt;&lt; setfill('0') &lt;&lt; id.Data();</span>
<span class="lineNum">     186 </span>            :         }
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :         cout  &lt;&lt; endl;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     189 </span>            :     }
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   cout.flags(coutflags); // restore the original flags</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            : 
<a name="195"><span class="lineNum">     195 </span>            :   class iterator {</a>
<span class="lineNum">     196 </span>            :   public:
<a name="197"><span class="lineNum">     197 </span>            :   iterator()</a>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :     : fData(NULL) {}</span>
<a name="199"><span class="lineNum">     199 </span>            :   iterator(ValueType* pData)</a>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :     : fData(pData) {}</span>
<a name="201"><span class="lineNum">     201 </span>            :   iterator(const iterator&amp; i)</a>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :     : fData(i.fData) {}</span>
<a name="203"><span class="lineNum">     203 </span>            :     iterator&amp; operator=(const iterator&amp; i)</a>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :       { if (this!=&amp;i) {fData=i.fData;} return *this;}</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :     ~iterator() {fData=NULL;}</span>
<a name="206"><span class="lineNum">     206 </span>            : </a>
<span class="lineNum">     207 </span>            :     bool operator==(const iterator&amp; i) const  {return (fData!=NULL) &amp;&amp; (fData==i.fData);}
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :     bool operator!=(const iterator&amp; i) const  {return (fData!=NULL) &amp;&amp; (fData!=i.fData);}</span>
<span class="lineNum">     209 </span>            :     // prefix operators
<span class="lineNum">     210 </span>            :     iterator&amp; operator++() {fData++; return *this;}
<a name="211"><span class="lineNum">     211 </span>            :     iterator&amp; operator--() {fData--; return *this;}</a>
<span class="lineNum">     212 </span>            :     // postfix operators
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :     iterator operator++(int) {iterator i(*this); fData++; return i;}</span>
<a name="214"><span class="lineNum">     214 </span>            :     iterator operator--(int) {iterator i(*this); fData--; return i;}</a>
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :     iterator&amp; operator+=(int step) {fData+=step; return *this;}</span>
<a name="217"><span class="lineNum">     217 </span>            : </a>
<span class="lineNum">     218 </span>            :     const ValueType&amp; Data() const {return *fData;}
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :     ValueType&amp; Data() {return *fData;}</span>
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span>            :     ValueType operator*() {return *fData;}
<span class="lineNum">     222 </span>            : 
<span class="lineNum">     223 </span>            :   protected:
<span class="lineNum">     224 </span>            :   private:
<span class="lineNum">     225 </span>            :     ValueType* fData; //! data
<span class="lineNum">     226 </span>            :   };
<a name="227"><span class="lineNum">     227 </span>            : </a>
<span class="lineNum">     228 </span>            :   // prepare iterator and end marker
<span class="lineNum">     229 </span>            :   iterator&amp; begin(T x=(T)-1, T y=(T)-1, T z=(T)-1) {
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :     fIterator.~iterator();</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :     fIteratorEnd.~iterator();</span>
<span class="lineNum">     232 </span>            : 
<span class="lineNum">     233 </span>            :     int startIndex=0;
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     if (x&lt;0) {</span>
<span class="lineNum">     235 </span>            :       // get all data
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :       if (fData) {</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :         new (&amp;fIterator) iterator(fData);</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :         fIteratorEnd=fIterator;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :         fIteratorEnd+=fCount;</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :       return fIterator;</span>
<span class="lineNum">     242 </span>            :     }
<span class="lineNum">     243 </span>            : 
<span class="lineNum">     244 </span>            :     // only search for the start index if specific x selected
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :     int cell=GetCellIndex(x, y, z);</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :     if (cell&lt;0 || !fCells || cell&gt;=fCellDimension) return fIterator;</span>
<span class="lineNum">     247 </span>            :     // get the index of the cell
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     startIndex=fCells[cell].fStartIndex;</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :     if (!fData || startIndex&gt;=fDataDimension) return fIterator;</span>
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span>            :     // get the range end position
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :     int endCell=cell+1;</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :     if (x&lt;0) endCell=fCellDimension;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :     else if (y&lt;0) endCell=GetCellIndex(x+fStepX, (T)-1, (T)-1); // all entries for fixed x</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :     else if (z&lt;0) endCell=GetCellIndex(x, y+fStepY, (T)-1); // all entries for fixed x and y</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :     if (endCell&lt;=cell) {</span>
<span class="lineNum">     257 </span>            :       // cell index returned is never outside the array
<span class="lineNum">     258 </span>            :       // so this is a special case where we get to the bounds of the array
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :       endCell=fCellDimension;</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span>            :     // find the first cell with content in the range 
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :     for (; startIndex&lt;0 &amp;&amp; cell&lt;endCell;) {</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :       startIndex=fCells[++cell].fStartIndex;</span>
<span class="lineNum">     265 </span>            :     }
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :     if (startIndex&lt;0) return fIterator;</span>
<span class="lineNum">     267 </span>            : 
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :     new (&amp;fIterator) iterator(fData+startIndex);</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     fIteratorEnd=fIterator;</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :     fIteratorEnd+=GetNumberOfSpacePoints(cell, endCell);</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :     return fIterator;</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   }</span>
<a name="273"><span class="lineNum">     273 </span>            : </a>
<span class="lineNum">     274 </span>            :   // get loop end marker
<span class="lineNum">     275 </span>            :   iterator&amp; end() {
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     return fIteratorEnd;</span>
<a name="277"><span class="lineNum">     277 </span>            :   }</a>
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            :   iterator&amp; find(ValueType v) {
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :     for (iterator i=begin(); i!=end(); i++) {</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :       if (i.Data()==v) {</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :         fIterator=i;</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         return fIterator;</span>
<span class="lineNum">     284 </span>            :       }
<span class="lineNum">     285 </span>            :     }
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :     return end();</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   }</span>
<a name="288"><span class="lineNum">     288 </span>            : </a>
<span class="lineNum">     289 </span>            :   // find cell of entry
<span class="lineNum">     290 </span>            :   int FindCell(ValueType v) const {
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     if (!fCells) return -1;</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     for (int cell=0; cell&lt;fCellDimension; cell++)</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :       for (int count=0; count&lt;fCells[cell].fCount; count++)</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :         if (fData[fCells[cell].fStartIndex+count]==v)</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :           return cell;</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     return -1;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     298 </span>            : 
<span class="lineNum">     299 </span>            :   struct AliHLTIndexGridCell {
<span class="lineNum">     300 </span>            :     int fCount;
<span class="lineNum">     301 </span>            :     int fFilled;
<span class="lineNum">     302 </span>            :     int fStartIndex;
<span class="lineNum">     303 </span>            :   };
<span class="lineNum">     304 </span>            : 
<span class="lineNum">     305 </span>            :  protected:
<span class="lineNum">     306 </span>            :  private:
<span class="lineNum">     307 </span>            :   // standard constructor prohibited
<span class="lineNum">     308 </span>            :   AliHLTIndexGrid();
<span class="lineNum">     309 </span>            :   // copy constructor prohibited
<span class="lineNum">     310 </span>            :   AliHLTIndexGrid(const AliHLTIndexGrid&amp;);
<span class="lineNum">     311 </span>            :   // assignment operator prohibited
<a name="312"><span class="lineNum">     312 </span>            :   AliHLTIndexGrid&amp; operator=(const AliHLTIndexGrid&amp;);</a>
<span class="lineNum">     313 </span>            : 
<span class="lineNum">     314 </span>            :   int IndexCells() {
<span class="lineNum">     315 </span>            :     // set the start index for data of every cell based on the counts
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :     if (!fCells || fCellDimension&lt;=0) return -ENOBUFS;</span>
<span class="lineNum">     317 </span>            :     int offset=0;
<span class="lineNum">     318 </span>            :     int cell=0;
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :     for (; cell&lt;fCellDimension; cell++) {</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :       if (fCells[cell].fCount&lt;0) continue;</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :       fCells[cell].fStartIndex=offset;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :       offset+=fCells[cell].fCount;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :       fCells[cell].fFilled=0;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     325 </span>            : 
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     if (offset&gt;fDataDimension) {</span>
<span class="lineNum">     327 </span>            :       // grow the data array
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :       auto_ptr&lt;V&gt; newArray(new V[offset]);</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :       if (newArray.get()) {</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :         memcpy(newArray.get(), fData, fDataDimension);</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :         memset(newArray.get()+fDataDimension, 0, (offset-fDataDimension)*sizeof(V));</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :         delete fData;</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         fData=newArray.release();</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :         fDataDimension=offset;</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         for (cell=0; cell&lt;fCellDimension; cell++) {</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :           fCells[cell].fStartIndex=-1;</span>
<span class="lineNum">     338 </span>            :         }
<span class="lineNum">     339 </span>            :       }
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     341 </span>            :     return 0;
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span>            :   T fMaxX;
<span class="lineNum">     346 </span>            :   T fStepX;
<span class="lineNum">     347 </span>            :   T fMaxY;
<span class="lineNum">     348 </span>            :   T fStepY;
<span class="lineNum">     349 </span>            :   T fMaxZ;
<span class="lineNum">     350 </span>            :   T fStepZ;
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span>            :   int fDimX;
<span class="lineNum">     353 </span>            :   int fDimY;
<span class="lineNum">     354 </span>            :   int fDimZ;
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span>            :   AliHLTIndexGridCell* fCells; //! cell array
<span class="lineNum">     357 </span>            :   int fCellDimension; //! size of cell array
<span class="lineNum">     358 </span>            :   ValueType* fData; //! spacepoint data
<span class="lineNum">     359 </span>            :   int fDataDimension; //! size of spacepoint data
<span class="lineNum">     360 </span>            :   int fCount;
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            :   iterator fIterator; //! iterator
<span class="lineNum">     363 </span>            :   iterator fIteratorEnd; //! end marker iterator
<span class="lineNum">     364 </span>            : 
<a name="365"><span class="lineNum">     365 </span>            :   static const int fgkDefaultDataSize=10000; //! the default data size</a>
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span><span class="lineCov">        378 :   ClassDef(AliHLTIndexGrid, 0)</span>
<span class="lineNum">     368 </span>            : };
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span>            : #endif
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
