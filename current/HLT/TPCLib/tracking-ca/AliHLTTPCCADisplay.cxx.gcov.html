<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HLT/TPCLib/tracking-ca/AliHLTTPCCADisplay.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">HLT/TPCLib/tracking-ca</a> - AliHLTTPCCADisplay.cxx<span style="font-size: 80%;"> (source / <a href="AliHLTTPCCADisplay.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">258</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">35</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // $Id$</a>
<span class="lineNum">       2 </span>            : // **************************************************************************
<span class="lineNum">       3 </span>            : // This file is property of and copyright by the ALICE HLT Project          *
<span class="lineNum">       4 </span>            : // ALICE Experiment at CERN, All rights reserved.                           *
<span class="lineNum">       5 </span>            : //                                                                          *
<span class="lineNum">       6 </span>            : // Primary Authors: Sergey Gorbunov &lt;sergey.gorbunov@kip.uni-heidelberg.de&gt; *
<span class="lineNum">       7 </span>            : //                  Ivan Kisel &lt;kisel@kip.uni-heidelberg.de&gt;                *
<span class="lineNum">       8 </span>            : //                  for The ALICE HLT Project.                              *
<span class="lineNum">       9 </span>            : //                                                                          *
<span class="lineNum">      10 </span>            : // Permission to use, copy, modify and distribute this software and its     *
<span class="lineNum">      11 </span>            : // documentation strictly for non-commercial purposes is hereby granted     *
<span class="lineNum">      12 </span>            : // without fee, provided that the above copyright notice appears in all     *
<span class="lineNum">      13 </span>            : // copies and that both the copyright notice and this permission notice     *
<span class="lineNum">      14 </span>            : // appear in the supporting documentation. The authors make no claims       *
<span class="lineNum">      15 </span>            : // about the suitability of this software for any purpose. It is            *
<span class="lineNum">      16 </span>            : // provided &quot;as is&quot; without express or implied warranty.                    *
<span class="lineNum">      17 </span>            : //                                                                          *
<span class="lineNum">      18 </span>            : //***************************************************************************
<span class="lineNum">      19 </span>            : 
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : #include &quot;AliHLTTPCCADisplay.h&quot;
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            : 
<span class="lineNum">      24 </span>            : #include &quot;AliHLTTPCCATracker.h&quot;
<span class="lineNum">      25 </span>            : #include &quot;AliHLTTPCCAStandaloneFramework.h&quot;
<span class="lineNum">      26 </span>            : #include &quot;AliHLTTPCCARow.h&quot;
<span class="lineNum">      27 </span>            : #include &quot;AliHLTTPCCATrack.h&quot;
<span class="lineNum">      28 </span>            : #include &quot;AliHLTTPCCAPerformance.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;AliHLTTPCCAMCTrack.h&quot;
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : #include &quot;TString.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;Riostream.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;TMath.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;TStyle.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;TCanvas.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;TApplication.h&quot;
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : 
<span class="lineNum">      39 </span>            : class AliHLTTPCCADisplay::AliHLTTPCCADisplayTmpHit
<span class="lineNum">      40 </span>            : {
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            :   public:
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            :     int ID() const { return fHitID; }
<span class="lineNum">      45 </span>            :     double S() const { return fS; }
<span class="lineNum">      46 </span>            :     double Z() const { return fZ; }
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span>            :     void SetID( int v ) { fHitID = v; }
<span class="lineNum">      49 </span>            :     void SetS( double v ) { fS = v; }
<span class="lineNum">      50 </span>            :     void SetZ( double v ) { fZ = v; }
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            :     static bool CompareHitDS( const AliHLTTPCCADisplayTmpHit &amp;a,
<span class="lineNum">      53 </span>            :                               const AliHLTTPCCADisplayTmpHit  &amp;b ) {
<span class="lineNum">      54 </span>            :       return ( a.fS &lt; b.fS );
<span class="lineNum">      55 </span>            :     }
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            :     static bool CompareHitZ( const AliHLTTPCCADisplayTmpHit &amp;a,
<span class="lineNum">      58 </span>            :                              const AliHLTTPCCADisplayTmpHit  &amp;b ) {
<span class="lineNum">      59 </span>            :       return ( a.fZ &lt; b.fZ );
<span class="lineNum">      60 </span>            :     }
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span>            :   private:
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            :     int fHitID; // hit ID
<span class="lineNum">      65 </span>            :     double fS;  // hit position on the XY track curve
<span class="lineNum">      66 </span>            :     double fZ;  // hit Z position
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : };
<span class="lineNum">      69 </span>            : 
<a name="70"><span class="lineNum">      70 </span>            : </a>
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span>            : AliHLTTPCCADisplay &amp;AliHLTTPCCADisplay::Instance()
<span class="lineNum">      73 </span>            : {
<span class="lineNum">      74 </span>            :   // reference to static object
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   static AliHLTTPCCADisplay gAliHLTTPCCADisplay;</span>
<span class="lineNum">      76 </span>            :   static bool firstCall = 1;
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   if ( firstCall ) {</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :     if ( !gApplication ) new TApplication( &quot;myapp&quot;, 0, 0 );</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     gAliHLTTPCCADisplay.Init();</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :     firstCall = 0;</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   return gAliHLTTPCCADisplay;</span>
<a name="83"><span class="lineNum">      83 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span><span class="lineNoCov">          0 : AliHLTTPCCADisplay::AliHLTTPCCADisplay() : fYX( 0 ), fZX( 0 ), fAsk( 1 ), fSliceView( 1 ), fSlice( 0 ), fPerf( 0 ),</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :     fCos( 1 ), fSin( 0 ), fZMin( -250 ), fZMax( 250 ), fYMin( -250 ), fYMax( 250 ), fSliceCos( 1 ), fSliceSin( 0 ),</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :     fRInnerMin( 83.65 ), fRInnerMax( 133.3 ), fROuterMin( 133.5 ), fROuterMax( 247.7 ),</span>
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :     fTPCZMin( -250. ), fTPCZMax( 250 ), fArc(), fLine(), fPLine(), fMarker(), fBox(), fCrown(), fLatex(), fDrawOnlyRef( 0 )</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :   fPerf = &amp;( AliHLTTPCCAPerformance::Instance() );</span>
<span class="lineNum">      91 </span>            :   // constructor
<a name="92"><span class="lineNum">      92 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      93 </span>            : 
<span class="lineNum">      94 </span>            : AliHLTTPCCADisplay::~AliHLTTPCCADisplay()
<span class="lineNum">      95 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      96 </span>            :   // destructor
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   delete fYX;</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :   delete fZX;</span>
<a name="99"><span class="lineNum">      99 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span>            : void AliHLTTPCCADisplay::Init()
<span class="lineNum">     102 </span>            : {
<span class="lineNum">     103 </span>            :   // initialization
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   gStyle-&gt;SetCanvasBorderMode( 0 );</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :   gStyle-&gt;SetCanvasBorderSize( 1 );</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   gStyle-&gt;SetCanvasColor( 0 );</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   fYX = new TCanvas ( &quot;YX&quot;, &quot;YX window&quot;, -1, 0, 600, 600 );</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :   fZX = new TCanvas ( &quot;ZX&quot;, &quot;ZX window&quot;, -610, 0, 590, 600 );</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   fMarker = TMarker( 0.0, 0.0, 20 );//6);</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :   fDrawOnlyRef = 0;</span>
<a name="111"><span class="lineNum">     111 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     112 </span>            : 
<span class="lineNum">     113 </span>            : void AliHLTTPCCADisplay::Update()
<span class="lineNum">     114 </span>            : {
<span class="lineNum">     115 </span>            :   // update windows
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :   if ( !fAsk ) return;</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :   fYX-&gt;Update();</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :   fZX-&gt;Update();</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :   fYX-&gt;Print( &quot;YX.pdf&quot; );</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :   fZX-&gt;Print( &quot;ZX.pdf&quot; );</span>
<span class="lineNum">     121 </span>            : 
<a name="122"><span class="lineNum">     122 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span>            : void AliHLTTPCCADisplay::ClearView()
<span class="lineNum">     125 </span>            : {
<span class="lineNum">     126 </span>            :   // clear windows
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   fYX-&gt;Clear();</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   fZX-&gt;Clear();</span>
<a name="129"><span class="lineNum">     129 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span>            : void AliHLTTPCCADisplay::Ask()
<span class="lineNum">     132 </span>            : {
<span class="lineNum">     133 </span>            :   // wait for the pressed key, when &quot;r&quot; pressed, don't ask anymore
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :   char symbol;</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :   if ( fAsk ) {</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     Update();</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; &quot;ask&gt; &quot; &lt;&lt; std::endl;</span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :     do {</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :       std::cin.get( symbol );</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :       if ( symbol == 'r' )</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :         fAsk = false;</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     } while ( symbol != '\n' );</span>
<span class="lineNum">     143 </span>            :   }
<span class="lineNum">     144 </span><span class="lineNoCov">          0 : }</span>
<a name="145"><span class="lineNum">     145 </span>            : </a>
<span class="lineNum">     146 </span>            : 
<span class="lineNum">     147 </span>            : void AliHLTTPCCADisplay::SetSliceView()
<span class="lineNum">     148 </span>            : {
<span class="lineNum">     149 </span>            :   // switch to slice view
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   fSliceView = 1;</span>
<a name="151"><span class="lineNum">     151 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            : void AliHLTTPCCADisplay::SetTPCView()
<span class="lineNum">     154 </span>            : {
<span class="lineNum">     155 </span>            :   // switch to full TPC view
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   fSliceView = 0;</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   fCos = 1;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   fSin = 0;</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :   fZMin = fTPCZMin;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :   fZMax = fTPCZMax;</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :   fYMin = -fROuterMax;</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :   fYMax = fROuterMax;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 : }</span>
<a name="164"><span class="lineNum">     164 </span>            : </a>
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : void AliHLTTPCCADisplay::SetCurrentSlice( AliHLTTPCCATracker *slice )
<span class="lineNum">     167 </span>            : {
<span class="lineNum">     168 </span>            :   // set reference to the current CA tracker, and read the current slice geometry
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   fSlice = slice;</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :   SetSliceTransform( slice );</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   if ( fSliceView ) {</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :     fCos = slice-&gt;Param().SinAlpha();</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :     fSin = slice-&gt;Param().CosAlpha();</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     fZMin = slice-&gt;Param().ZMin();</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :     fZMax = slice-&gt;Param().ZMax();</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :     ClearView();</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :     double r0 = .5 * ( slice-&gt;Param().RMax() + slice-&gt;Param().RMin() );</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     double dr = .5 * ( slice-&gt;Param().RMax() - slice-&gt;Param().RMin() );</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     fYMin = -dr;</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     fYMax = dr;</span>
<span class="lineNum">     181 </span>            :     double cx = 0;
<span class="lineNum">     182 </span>            :     double cy = r0;
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :     double cz = .5 * ( slice-&gt;Param().ZMax() + slice-&gt;Param().ZMin() );</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :     double dz = .5 * ( slice-&gt;Param().ZMax() - slice-&gt;Param().ZMin() ) * 1.2;</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :     fYX-&gt;Range( cx - dr, cy - dr*1.05, cx + dr, cy + dr );</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :     fZX-&gt;Range( cz - dz, cy - dr*1.05, cz + dz, cy + dr );</span>
<span class="lineNum">     187 </span>            : 
<span class="lineNum">     188 </span>            :     //fYX-&gt;Range(cx-dr*.3, cy-dr*1.05, cx+dr*.3, cy-dr*.35);
<span class="lineNum">     189 </span>            :     //fZX-&gt;Range(cz-dz, cy-dr*1.05, cz+dz, cy-dr*.3);
<span class="lineNum">     190 </span>            : 
<span class="lineNum">     191 </span>            :     //fYX-&gt;Range(cx-dr*.3, cy-dr*.8, cx-dr*.1, cy-dr*.75);
<span class="lineNum">     192 </span>            :     //fZX-&gt;Range(cz-dz*0, cy-dr*.8, cz+dz, cy-dr*.75);
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            :     //fYX-&gt;Range(cx-dr*.08, cy-dr*1., cx-dr*.02, cy-dr*0.7);
<span class="lineNum">     195 </span>            :     //fZX-&gt;Range(cz-dz*.2, cy-dr*1., cz-dz*.05, cy-dr*0.7);
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :     //double x0 = cx-dr*.1, x1 = cx-dr*.05;
<span class="lineNum">     198 </span>            :     //double y0 = cy-dr*1.05, y1 = cy-dr*0.7;
<span class="lineNum">     199 </span>            :     //double z0 = cz-dz*.3, z1 = cz;
<span class="lineNum">     200 </span>            :     //double xc = (x0+x1)/2, yc= (y0+y1)/2, zc=(z0+z1)/2;
<span class="lineNum">     201 </span>            :     //double d = TMath::Max((x1-x0)/2,TMath::Max((y1-y0)/2,(z1-z0)/2));
<span class="lineNum">     202 </span>            :     //fYX-&gt;Range(xc-d, yc-d, xc+d, yc+d);
<span class="lineNum">     203 </span>            :     //fZX-&gt;Range(zc-d, yc-d, zc+d, yc+d);
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   }</span>
<a name="206"><span class="lineNum">     206 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span>            : void AliHLTTPCCADisplay::SetSliceTransform( double alpha )
<span class="lineNum">     209 </span>            : {
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :   fSliceCos = TMath::Cos( alpha );</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :   fSliceSin = TMath::Sin( alpha );</span>
<a name="212"><span class="lineNum">     212 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     213 </span>            : 
<span class="lineNum">     214 </span>            : void AliHLTTPCCADisplay::SetSliceTransform( AliHLTTPCCATracker *slice )
<span class="lineNum">     215 </span>            : {
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   SetSliceTransform( slice-&gt;Param().Alpha() );</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 : }</span>
<a name="218"><span class="lineNum">     218 </span>            : </a>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span>            : void AliHLTTPCCADisplay::DrawTPC()
<span class="lineNum">     221 </span>            : {
<span class="lineNum">     222 </span>            :   // schematically draw TPC detector
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :   fYX-&gt;Range( -fROuterMax, -fROuterMax, fROuterMax, fROuterMax );</span>
<span class="lineNum">     224 </span>            :   //fYX-&gt;Range( -fROuterMax*.7, -fROuterMax, fROuterMax*0., -fROuterMax*.5);
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :   fYX-&gt;Clear();</span>
<span class="lineNum">     226 </span>            :   {
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :     fArc.SetLineColor( kBlack );</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :     fArc.SetFillStyle( 0 );</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :     fYX-&gt;cd();</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :     for ( int iSlice = 0; iSlice &lt; 18; iSlice++ ) {</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :       fCrown.SetLineColor( kBlack );</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :       fCrown.SetFillStyle( 0 );</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :       fCrown.DrawCrown( 0, 0, fRInnerMin, fRInnerMax, 360. / 18.*iSlice, 360. / 18.*( iSlice + 1 ) );</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :       fCrown.DrawCrown( 0, 0, fROuterMin, fROuterMax, 360. / 18.*iSlice, 360. / 18.*( iSlice + 1 ) );</span>
<span class="lineNum">     235 </span>            :     }
<span class="lineNum">     236 </span>            :   }
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :   fZX-&gt;cd();</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :   fZX-&gt;Range( fTPCZMin, -fROuterMax, fTPCZMax*1.1, fROuterMax );</span>
<span class="lineNum">     239 </span>            :   //fZX-&gt;Range( fTPCZMax*.1, -fROuterMax, fTPCZMax*.3, -fROuterMax*0.5 );
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :   fZX-&gt;Clear();</span>
<a name="241"><span class="lineNum">     241 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     242 </span>            : 
<span class="lineNum">     243 </span>            : void AliHLTTPCCADisplay::DrawSlice( AliHLTTPCCATracker *slice, bool DrawRows )
<span class="lineNum">     244 </span>            : {
<span class="lineNum">     245 </span>            :   // draw current the TPC slice
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   fYX-&gt;cd();</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :   double r0 = .5 * ( slice-&gt;Param().RMax() + slice-&gt;Param().RMin() );</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :   double dr = .5 * ( slice-&gt;Param().RMax() - slice-&gt;Param().RMin() );</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :   double cx = r0 * slice-&gt;Param().CosAlpha();</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :   double cy = r0 * slice-&gt;Param().SinAlpha();</span>
<span class="lineNum">     251 </span>            :   double raddeg = 180. / 3.1415;
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   double a0 = raddeg * .5 * ( slice-&gt;Param().AngleMax() + slice-&gt;Param().AngleMin() );</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :   double da = raddeg * .5 * ( slice-&gt;Param().AngleMax() - slice-&gt;Param().AngleMin() );</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :   if ( fSliceView ) {</span>
<span class="lineNum">     255 </span>            :     cx = 0; cy = r0;
<span class="lineNum">     256 </span>            :     a0 = 90.;
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :     fLatex.DrawLatex( cx - dr + dr*.05, cy - dr + dr*.05, Form( &quot;YX, Slice %2i&quot;, slice-&gt;Param().ISlice() ) );</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :     a0 += raddeg * TMath::ATan2( fSin, fCos );</span>
<span class="lineNum">     260 </span>            :   }
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :   fArc.SetLineColor( kBlack );</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :   fArc.SetFillStyle( 0 );</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   fCrown.SetLineColor( kBlack );</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   fCrown.SetFillStyle( 0 );</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :   fCrown.DrawCrown( 0, 0, fRInnerMin, fRInnerMax, a0 - da, a0 + da );</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :   fCrown.DrawCrown( 0, 0, fROuterMin, fROuterMax, a0 - da, a0 + da );</span>
<span class="lineNum">     267 </span>            :   //fCrown.DrawCrown(0,0, slice-&gt;Param().RMin(),slice-&gt;Param().RMax(), a0-da, a0+da );
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :   fLine.SetLineColor( kBlack );</span>
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   fZX-&gt;cd();</span>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   double cz = .5 * ( slice-&gt;Param().ZMax() + slice-&gt;Param().ZMin() );</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :   double dz = .5 * ( slice-&gt;Param().ZMax() - slice-&gt;Param().ZMin() ) * 1.2;</span>
<span class="lineNum">     275 </span>            :   //fLine.DrawLine(cz+dz, cy-dr, cz+dz, cy+dr );
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   if ( fSliceView ) fLatex.DrawLatex( cz - dz + dz*.05, cy - dr + dr*.05, Form( &quot;ZX, Slice %2i&quot;, slice-&gt;Param().ISlice() ) );</span>
<span class="lineNum">     277 </span>            : 
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   if ( DrawRows ) {</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     fLine.SetLineWidth( 1 );</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :     fLine.SetLineColor( kBlack );</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :     SetSliceTransform( fSlice );</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :     for ( int iRow = 0; iRow &lt; fSlice-&gt;Param().NRows(); iRow++ ) {</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :       double x = fSlice-&gt;Row( iRow ).X();</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :       double y = fSlice-&gt;Row( iRow ).MaxY();</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :       double vx0, vy0, vx1, vy1;</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :       Slice2View( x, y, &amp;vx0, &amp;vy0 );</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :       Slice2View( x, -y, &amp;vx1, &amp;vy1 );</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :       fYX-&gt;cd();</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :       fLine.DrawLine( vx0, vy0, vx1, vy1 );</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :       fZX-&gt;cd();</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :       fLine.DrawLine( fTPCZMin, vy0, fTPCZMax, vy1 );</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span><span class="lineNoCov">          0 : }</span>
<a name="296"><span class="lineNum">     296 </span>            : </a>
<span class="lineNum">     297 </span>            : 
<span class="lineNum">     298 </span>            : void AliHLTTPCCADisplay::Set2Slices( AliHLTTPCCATracker * const slice )
<span class="lineNum">     299 </span>            : {
<span class="lineNum">     300 </span>            :   //* Set view for two neighbouring slices
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   fSlice = slice;</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :   fSliceView = 0;</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :   fCos = TMath::Cos( TMath::Pi() / 2 - ( slice-&gt;Param().Alpha() + 10. / 180.*TMath::Pi() ) );</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :   fSin = TMath::Sin( TMath::Pi() / 2 - ( slice-&gt;Param().Alpha() + 10. / 180.*TMath::Pi() ) );</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :   fZMin = slice-&gt;Param().ZMin();</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :   fZMax = slice-&gt;Param().ZMax();</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   ClearView();</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   double r0 = .5 * ( slice-&gt;Param().RMax() + slice-&gt;Param().RMin() );</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :   double dr = .5 * ( slice-&gt;Param().RMax() - slice-&gt;Param().RMin() );</span>
<span class="lineNum">     311 </span>            :   double cx = 0;
<span class="lineNum">     312 </span>            :   double cy = r0;
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :   fYX-&gt;Range( cx - 1.3*dr, cy - 1.1*dr, cx + 1.3*dr, cy + 1.1*dr );</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :   fYX-&gt;cd();</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :   int islice = slice-&gt;Param().ISlice();</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :   int jslice = slice-&gt;Param().ISlice() + 1;</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   if ( islice == 17 ) jslice = 0;</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :   else if ( islice == 35 ) jslice = 18;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :   fLatex.DrawLatex( cx - 1.3*dr + 1.3*dr*.05, cy - dr + dr*.05, Form( &quot;YX, Slices %2i/%2i&quot;, islice, jslice ) );</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :   double cz = .5 * ( slice-&gt;Param().ZMax() + slice-&gt;Param().ZMin() );</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :   double dz = .5 * ( slice-&gt;Param().ZMax() - slice-&gt;Param().ZMin() ) * 1.2;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   fZX-&gt;Range( cz - dz, cy - 1.1*dr, cz + dz, cy + 1.1*dr );//+dr);</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   fZX-&gt;cd();</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :   fLatex.DrawLatex( cz - dz + dz*.05, cy - dr + dr*.05, Form( &quot;ZX, Slices %2i/%2i&quot;, islice, jslice ) );</span>
<a name="325"><span class="lineNum">     325 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     326 </span>            : 
<span class="lineNum">     327 </span>            : int AliHLTTPCCADisplay::GetColor( int i ) const
<span class="lineNum">     328 </span>            : {
<span class="lineNum">     329 </span>            :   // Get color with respect to Z coordinate
<span class="lineNum">     330 </span>            :   const Color_t kMyColor[9] = { kGreen, kBlue, kYellow, kCyan, kOrange,
<span class="lineNum">     331 </span>            :                                 kSpring, kTeal, kAzure, kViolet
<span class="lineNum">     332 </span>            :                               };
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   if ( i &lt; 0 ) i = 0;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   if ( i == 0 ) return kBlack;</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   return kMyColor[( i-1 )%9];</span>
<a name="336"><span class="lineNum">     336 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     337 </span>            : 
<span class="lineNum">     338 </span>            : int AliHLTTPCCADisplay::GetColorZ( double z ) const
<span class="lineNum">     339 </span>            : {
<span class="lineNum">     340 </span>            :   // Get color with respect to Z coordinate
<span class="lineNum">     341 </span>            :   const Color_t kMyColor[11] = { kGreen, kBlue, kYellow, kMagenta, kCyan,
<span class="lineNum">     342 </span>            :                                  kOrange, kSpring, kTeal, kAzure, kViolet, kPink
<span class="lineNum">     343 </span>            :                                };
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :   double zz = ( z - fZMin ) / ( fZMax - fZMin );</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :   int iz = ( int ) ( zz * 11 );</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   if ( iz &lt; 0 ) iz = 0;</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   if ( iz &gt; 10 ) iz = 10;</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   return kMyColor[iz];</span>
<a name="350"><span class="lineNum">     350 </span>            : }</a>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span>            : int AliHLTTPCCADisplay::GetColorY( double y ) const
<span class="lineNum">     353 </span>            : {
<span class="lineNum">     354 </span>            :   // Get color with respect to Z coordinate
<span class="lineNum">     355 </span>            :   const Color_t kMyColor[11] = { kGreen, kBlue, kYellow, kMagenta, kCyan,
<span class="lineNum">     356 </span>            :                                  kOrange, kSpring, kTeal, kAzure, kViolet, kPink
<span class="lineNum">     357 </span>            :                                };
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :   double yy = ( y - fYMin ) / ( fYMax - fYMin );</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :   int iy = ( int ) ( yy * 11 );</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :   if ( iy &lt; 0 ) iy = 0;</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :   if ( iy &gt; 10 ) iy = 10;</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   return kMyColor[iy];</span>
<a name="364"><span class="lineNum">     364 </span>            : }</a>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span>            : int AliHLTTPCCADisplay::GetColorK( double k ) const
<span class="lineNum">     367 </span>            : {
<span class="lineNum">     368 </span>            :   // Get color with respect to Z coordinate
<span class="lineNum">     369 </span>            :   const Color_t kMyColor[11] = { kRed, kBlue, kYellow, kMagenta, kCyan,
<span class="lineNum">     370 </span>            :                                  kOrange, kSpring, kTeal, kAzure, kViolet, kPink
<span class="lineNum">     371 </span>            :                                };
<span class="lineNum">     372 </span>            :   const double kCLight = 0.000299792458;
<span class="lineNum">     373 </span>            :   const double kBz = 5;
<span class="lineNum">     374 </span>            :   double k2QPt = 100;
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   if ( TMath::Abs( kBz ) &gt; 1.e-4 ) k2QPt = 1. / ( kBz * kCLight );</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   double qPt = k * k2QPt;</span>
<span class="lineNum">     377 </span>            :   double pt = 100;
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   if ( TMath::Abs( qPt ) &gt; 1.e-4 ) pt = 1. / TMath::Abs( qPt );</span>
<span class="lineNum">     379 </span>            : 
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :   double yy = ( pt - 0.1 ) / ( 1. - 0.1 );</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :   int iy = ( int ) ( yy * 11 );</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :   if ( iy &lt; 0 ) iy = 0;</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   if ( iy &gt; 10 ) iy = 10;</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :   return kMyColor[iy];</span>
<a name="385"><span class="lineNum">     385 </span>            : }</a>
<span class="lineNum">     386 </span>            : 
<span class="lineNum">     387 </span>            : void AliHLTTPCCADisplay::Global2View( double x, double y, double *xv, double *yv ) const
<span class="lineNum">     388 </span>            : {
<span class="lineNum">     389 </span>            :   // convert coordinates global-&gt;view
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :   *xv = x * fCos + y * fSin;</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   *yv = y * fCos - x * fSin;</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 : }</span>
<a name="393"><span class="lineNum">     393 </span>            : </a>
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span>            : void AliHLTTPCCADisplay::Slice2View( double x, double y, double *xv, double *yv ) const
<span class="lineNum">     396 </span>            : {
<span class="lineNum">     397 </span>            :   // convert coordinates slice-&gt;view
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   double xg = x * fSliceCos - y * fSliceSin;</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   double yg = y * fSliceCos + x * fSliceSin;</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   *xv = xg * fCos - yg * fSin;</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   *yv = yg * fCos + xg * fSin;</span>
<a name="402"><span class="lineNum">     402 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     403 </span>            : 
<span class="lineNum">     404 </span>            : void AliHLTTPCCADisplay::SliceHitXYZ(int iRow, int iHit, double &amp;x, double &amp;y, double &amp;z )
<span class="lineNum">     405 </span>            : {
<span class="lineNum">     406 </span>            :   // get xyz of the hit
<span class="lineNum">     407 </span>            : 
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   if ( !fSlice ) return;</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   const AliHLTTPCCARow &amp;row = fSlice-&gt;Row( iRow );</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :   float y0 = row.Grid().YMin();</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :   float z0 = row.Grid().ZMin();</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   float stepY = row.HstepY();</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :   float stepZ = row.HstepZ();</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :   x = row.X();</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   y = y0 + fSlice-&gt;HitDataY( row, iHit ) * stepY;</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   z = z0 + fSlice-&gt;HitDataZ( row, iHit ) * stepZ;</span>
<a name="417"><span class="lineNum">     417 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span>            : void AliHLTTPCCADisplay::DrawSliceHit( int iRow, int iHit, int color, Size_t width )
<span class="lineNum">     420 </span>            : {
<span class="lineNum">     421 </span>            :   // draw hit
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   if ( !fSlice ) return;</span>
<span class="lineNum">     423 </span>            : 
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   double x,y,z;</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :   SliceHitXYZ( iRow, iHit, x, y, z );</span>
<span class="lineNum">     426 </span>            : 
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   SetSliceTransform( fSlice );</span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :   if ( color &lt; 0 ) {</span>
<span class="lineNum">     430 </span>            :     //if ( 0 &amp;&amp; fPerf ) {
<span class="lineNum">     431 </span>            :       //AliHLTTPCCAPerformance::AliHLTTPCCAHitLabel lab
<span class="lineNum">     432 </span>            :       //= fPerf-&gt;GetClusterLabel( fSlice-&gt;Param().ISlice(), fSlice-&gt;HitInputID( row, iHit ) );
<span class="lineNum">     433 </span>            :       //color = GetColor( lab[0] + 1 );
<span class="lineNum">     434 </span>            :       //if ( lab[0] &gt;= 0 ) {
<span class="lineNum">     435 </span>            :       //AliHLTTPCCAMCTrack &amp;mc = fPerf-&gt;MCTracks()[lab];
<span class="lineNum">     436 </span>            :       //if ( mc.P() &gt;= 1. ) color = kRed;
<span class="lineNum">     437 </span>            :       //else if ( fDrawOnlyRef ) return;
<span class="lineNum">     438 </span>            :       //}
<span class="lineNum">     439 </span>            :     //}  else
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :     color = GetColorZ( z );</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   if ( width &gt; 0 )fMarker.SetMarkerSize( width );</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :   else fMarker.SetMarkerSize( .3 );</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :   fMarker.SetMarkerColor( color );</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   double vx, vy;</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :   Slice2View( x, y, &amp;vx, &amp;vy );</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :   fYX-&gt;cd();</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :   fMarker.DrawMarker( vx, vy );</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :   fZX-&gt;cd();</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :   fMarker.DrawMarker( z, vy );</span>
<a name="451"><span class="lineNum">     451 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     452 </span>            : 
<span class="lineNum">     453 </span>            : void AliHLTTPCCADisplay::DrawSliceHits( int color, Size_t width )
<span class="lineNum">     454 </span>            : {
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span>            :   // draw hits
<span class="lineNum">     457 </span>            : 
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :   for ( int iRow = 0; iRow &lt; fSlice-&gt;Param().NRows(); iRow++ ) {</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     const AliHLTTPCCARow &amp;row = fSlice-&gt;Row( iRow );</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :     for ( int ih = 0; ih &lt; row.NHits(); ih++ ) {</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :       DrawSliceHit( iRow, ih, color, width );</span>
<span class="lineNum">     462 </span>            :     }
<span class="lineNum">     463 </span>            :   }
<span class="lineNum">     464 </span><span class="lineNoCov">          0 : }</span>
<a name="465"><span class="lineNum">     465 </span>            : </a>
<span class="lineNum">     466 </span>            : 
<span class="lineNum">     467 </span>            : void AliHLTTPCCADisplay::DrawSliceLink( int iRow, int iHit, int colorUp, int colorDn, int width )
<span class="lineNum">     468 </span>            : {
<span class="lineNum">     469 </span>            :   // draw link between clusters
<span class="lineNum">     470 </span>            : 
<span class="lineNum">     471 </span>            :   //if ( !fPerf ) return;
<span class="lineNum">     472 </span>            :   //AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :   if ( width &lt; 0 ) width = 1;</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :   fLine.SetLineWidth( width );</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :   int colUp = colorUp &gt;= 0 ? colorUp : kMagenta;</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :   int colDn = colorDn &gt;= 0 ? colorDn : kBlack;</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :   if ( iRow &lt; 2 || iRow &gt;= fSlice-&gt;Param().NRows() - 2 ) return;</span>
<span class="lineNum">     478 </span>            : 
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :   const AliHLTTPCCARow&amp; row = fSlice-&gt;Data().Row( iRow );</span>
<span class="lineNum">     480 </span>            : 
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :   short iUp = fSlice-&gt;HitLinkUpData( row, iHit );</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :   short iDn = fSlice-&gt;HitLinkDownData( row, iHit );</span>
<span class="lineNum">     483 </span>            : 
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :   double p1[3], p2[3], p3[3];</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :   SliceHitXYZ( iRow,  iHit, p1[0],p1[1],p1[2]);</span>
<span class="lineNum">     487 </span>            : 
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :   double vx, vy, vx1, vy1;</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :   Slice2View( p1[0], p1[1], &amp;vx, &amp;vy );</span>
<span class="lineNum">     490 </span>            : 
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :   if ( iUp &gt;= 0 ) {</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :     SliceHitXYZ( iRow+2, iUp, p2[0],p2[1],p2[2]);</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :     Slice2View( p2[0], p2[1], &amp;vx1, &amp;vy1 );</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :     fLine.SetLineColor( colUp );</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     fYX-&gt;cd();</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     fLine.DrawLine( vx - .1, vy, vx1 - .1, vy1 );</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :     fZX-&gt;cd();</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :     fLine.DrawLine( p1[2] - 1., vy, p2[2] - 1., vy1 );</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :   if ( iDn &gt;= 0 ) {   </span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :     SliceHitXYZ( iRow-2, iDn, p3[0],p3[1],p3[2]);</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :     Slice2View( p3[0], p3[1], &amp;vx1, &amp;vy1 );</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :     fLine.SetLineColor( colDn );</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :     fYX-&gt;cd();</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :     fLine.DrawLine( vx + .1, vy, vx1 + .1, vy1 );</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :     fZX-&gt;cd();</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :     fLine.DrawLine( p1[2] + 1., vy, p3[2] + 1., vy1 );</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     509 </span>            : 
<span class="lineNum">     510 </span><span class="lineNoCov">          0 : }</span>
<a name="511"><span class="lineNum">     511 </span>            : </a>
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span>            : void AliHLTTPCCADisplay::DrawSliceLinks( int colorUp, int colorDn, int width )
<span class="lineNum">     514 </span>            : {
<span class="lineNum">     515 </span>            :   // draw links between clusters
<span class="lineNum">     516 </span>            : 
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :   for ( int iRow = 1; iRow &lt; fSlice-&gt;Param().NRows() - 1; iRow++ ) {</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :     const AliHLTTPCCARow&amp; row = fSlice-&gt;Row( iRow );</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     for ( int ih = 0; ih &lt; row.NHits(); ih++ ) {</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :       DrawSliceLink( iRow, ih, colorUp, colorDn, width );</span>
<span class="lineNum">     521 </span>            :     }
<span class="lineNum">     522 </span>            :   }
<span class="lineNum">     523 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     524 </span>            : 
<a name="525"><span class="lineNum">     525 </span>            : </a>
<span class="lineNum">     526 </span>            : 
<span class="lineNum">     527 </span>            : int AliHLTTPCCADisplay::GetTrackMC( const AliHLTTPCCADisplayTmpHit */*vHits*/, int /*NHits*/ )
<span class="lineNum">     528 </span>            : {
<span class="lineNum">     529 </span>            :   // get MC label for the track
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :   return 0;</span>
<span class="lineNum">     531 </span>            : #ifdef XXX
<span class="lineNum">     532 </span>            :   AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     533 </span>            : 
<span class="lineNum">     534 </span>            :   int label = -1;
<span class="lineNum">     535 </span>            :   double purity = 0;
<span class="lineNum">     536 </span>            :   int *lb = new int[NHits*3];
<span class="lineNum">     537 </span>            :   int nla = 0;
<span class="lineNum">     538 </span>            :   //std::cout&lt;&lt;&quot;\n\nTrack hits mc: &quot;&lt;&lt;std::endl;
<span class="lineNum">     539 </span>            :   for ( int ihit = 0; ihit &lt; NHits; ihit++ ) {
<span class="lineNum">     540 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[vHits[ihit].ID()];
<span class="lineNum">     541 </span>            :     AliHLTTPCCAPerformance::AliHLTTPCCAHitLabel &amp;l = fPerf-&gt;HitLabels()[h.ID()];
<span class="lineNum">     542 </span>            :     if ( l.fLab[0] &gt;= 0 ) lb[nla++] = l.fLab[0];
<span class="lineNum">     543 </span>            :     if ( l.fLab[1] &gt;= 0 ) lb[nla++] = l.fLab[1];
<span class="lineNum">     544 </span>            :     if ( l.fLab[2] &gt;= 0 ) lb[nla++] = l.fLab[2];
<span class="lineNum">     545 </span>            :     //std::cout&lt;&lt;ihit&lt;&lt;&quot;:  &quot;&lt;&lt;l.fLab[0]&lt;&lt;&quot; &quot;&lt;&lt;l.fLab[1]&lt;&lt;&quot; &quot;&lt;&lt;l.fLab[2]&lt;&lt;std::endl;
<span class="lineNum">     546 </span>            :   }
<span class="lineNum">     547 </span>            :   sort( lb, lb + nla );
<span class="lineNum">     548 </span>            :   int labmax = -1, labcur = -1, lmax = 0, lcurr = 0, nh = 0;
<span class="lineNum">     549 </span>            :   //std::cout&lt;&lt;&quot;MC track IDs :&quot;&lt;&lt;std::endl;
<span class="lineNum">     550 </span>            :   for ( int i = 0; i &lt; nla; i++ ) {
<span class="lineNum">     551 </span>            :     if ( lb[i] != labcur ) {
<span class="lineNum">     552 </span>            :       if ( 0 &amp;&amp; i &gt; 0 &amp;&amp; lb[i-1] &gt;= 0 ) {
<span class="lineNum">     553 </span>            :         AliHLTTPCCAMCTrack &amp;mc = fPerf-&gt;MCTracks()[lb[i-1]];
<span class="lineNum">     554 </span>            :         std::cout &lt;&lt; lb[i-1] &lt;&lt; &quot;: nhits=&quot; &lt;&lt; nh &lt;&lt; &quot;, pdg=&quot; &lt;&lt; mc.PDG() &lt;&lt; &quot;, Pt=&quot; &lt;&lt; mc.Pt() &lt;&lt; &quot;, P=&quot; &lt;&lt; mc.P()
<span class="lineNum">     555 </span>            :                   &lt;&lt; &quot;, par=&quot; &lt;&lt; mc.Par()[0] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[1] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[2]
<span class="lineNum">     556 </span>            :                   &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[3] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[4] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[5] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[6] &lt;&lt; std::endl;
<span class="lineNum">     557 </span>            : 
<span class="lineNum">     558 </span>            :       }
<span class="lineNum">     559 </span>            :       nh = 0;
<span class="lineNum">     560 </span>            :       if ( labcur &gt;= 0 &amp;&amp; lmax &lt; lcurr ) {
<span class="lineNum">     561 </span>            :         lmax = lcurr;
<span class="lineNum">     562 </span>            :         labmax = labcur;
<span class="lineNum">     563 </span>            :       }
<span class="lineNum">     564 </span>            :       labcur = lb[i];
<span class="lineNum">     565 </span>            :       lcurr = 0;
<span class="lineNum">     566 </span>            :     }
<span class="lineNum">     567 </span>            :     lcurr++;
<span class="lineNum">     568 </span>            :     nh++;
<span class="lineNum">     569 </span>            :   }
<span class="lineNum">     570 </span>            :   if ( 0 &amp;&amp; nla - 1 &gt; 0 &amp;&amp; lb[nla-1] &gt;= 0 ) {
<span class="lineNum">     571 </span>            :     AliHLTTPCCAMCTrack &amp;mc = fPerf-&gt;MCTracks()[lb[nla-1]];
<span class="lineNum">     572 </span>            :     std::cout &lt;&lt; lb[nla-1] &lt;&lt; &quot;: nhits=&quot; &lt;&lt; nh &lt;&lt; &quot;, pdg=&quot; &lt;&lt; mc.PDG() &lt;&lt; &quot;, Pt=&quot; &lt;&lt; mc.Pt() &lt;&lt; &quot;, P=&quot; &lt;&lt; mc.P()
<span class="lineNum">     573 </span>            :               &lt;&lt; &quot;, par=&quot; &lt;&lt; mc.Par()[0] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[1] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[2]
<span class="lineNum">     574 </span>            :               &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[3] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[4] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[5] &lt;&lt; &quot; &quot; &lt;&lt; mc.Par()[6] &lt;&lt; std::endl;
<span class="lineNum">     575 </span>            : 
<span class="lineNum">     576 </span>            :   }
<span class="lineNum">     577 </span>            :   if ( labcur &gt;= 0 &amp;&amp; lmax &lt; lcurr ) {
<span class="lineNum">     578 </span>            :     lmax = lcurr;
<span class="lineNum">     579 </span>            :     labmax = labcur;
<span class="lineNum">     580 </span>            :   }
<span class="lineNum">     581 </span>            :   lmax = 0;
<span class="lineNum">     582 </span>            :   for ( int ihit = 0; ihit &lt; NHits; ihit++ ) {
<span class="lineNum">     583 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[vHits[ihit].ID()];
<span class="lineNum">     584 </span>            :     AliHLTTPCCAPerformance::AliHLTTPCCAHitLabel &amp;l = fPerf-&gt;HitLabels()[h.ID()];
<span class="lineNum">     585 </span>            :     if ( l.fLab[0] == labmax || l.fLab[1] == labmax || l.fLab[2] == labmax
<span class="lineNum">     586 </span>            :        ) lmax++;
<span class="lineNum">     587 </span>            :   }
<span class="lineNum">     588 </span>            :   label = labmax;
<span class="lineNum">     589 </span>            :   purity = ( ( NHits &gt; 0 ) ? double( lmax ) / double( NHits ) : 0 );
<span class="lineNum">     590 </span>            :   if ( lb ) delete[] lb;
<span class="lineNum">     591 </span>            :   if ( purity &lt; .9 ) label = -1;
<span class="lineNum">     592 </span>            :   return label;
<span class="lineNum">     593 </span>            : #endif
<a name="594"><span class="lineNum">     594 </span>            : }</a>
<span class="lineNum">     595 </span>            : 
<span class="lineNum">     596 </span>            : bool AliHLTTPCCADisplay::DrawTrack( AliHLTTPCCATrackParam /*t*/, double /*Alpha*/, const AliHLTTPCCADisplayTmpHit */*vHits*/,
<span class="lineNum">     597 </span>            :                                     int /*NHits*/, int /*color*/, int /*width*/, bool /*pPoint*/ )
<span class="lineNum">     598 </span>            : {
<span class="lineNum">     599 </span>            :   // draw track
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :   return 1;</span>
<span class="lineNum">     601 </span>            : #ifdef XXX
<span class="lineNum">     602 </span>            :   if ( NHits &lt; 2 ) return 0;
<span class="lineNum">     603 </span>            : 
<span class="lineNum">     604 </span>            :   //AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     605 </span>            :   if ( width &lt; 0 ) width = 2;
<span class="lineNum">     606 </span>            : 
<span class="lineNum">     607 </span>            :   if ( fDrawOnlyRef ) {
<span class="lineNum">     608 </span>            :     int lab = GetTrackMC( vHits, NHits );
<span class="lineNum">     609 </span>            :     if ( lab &lt; 0 ) return 0;
<span class="lineNum">     610 </span>            :     AliHLTTPCCAMCTrack &amp;mc = fPerf-&gt;MCTracks()[lab];
<span class="lineNum">     611 </span>            :     if ( mc.P() &lt; 1 ) return 0;
<span class="lineNum">     612 </span>            :   }
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span>            :   if ( color &lt; 0 ) {
<span class="lineNum">     615 </span>            :     //color = GetColorZ( (vz[0]+vz[mHits-1])/2. );
<span class="lineNum">     616 </span>            :     //color = GetColorK(t.GetKappa());
<span class="lineNum">     617 </span>            :     int lab = GetTrackMC( vHits, NHits );
<span class="lineNum">     618 </span>            :     color = GetColor( lab + 1 );
<span class="lineNum">     619 </span>            :     if ( lab &gt;= 0 ) {
<span class="lineNum">     620 </span>            :       AliHLTTPCCAMCTrack &amp;mc = fPerf-&gt;MCTracks()[lab];
<span class="lineNum">     621 </span>            :       if ( mc.P() &gt;= 1. ) color = kRed;
<span class="lineNum">     622 </span>            :     }
<span class="lineNum">     623 </span>            :   }
<span class="lineNum">     624 </span>            : 
<span class="lineNum">     625 </span>            :   if ( t.SinPhi() &gt; .999 )  t.SetSinPhi( .999 );
<span class="lineNum">     626 </span>            :   else if ( t.SinPhi() &lt; -.999 )  t.SetSinPhi( -.999 );
<span class="lineNum">     627 </span>            : 
<span class="lineNum">     628 </span>            :   //  int iSlice = fSlice-&gt;Param().ISlice();
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span>            :   //sort(vHits, vHits + NHits, AliHLTTPCCADisplayTmpHit::CompareHitZ );
<span class="lineNum">     631 </span>            : 
<span class="lineNum">     632 </span>            :   double vx[2000], vy[2000], vz[2000];
<span class="lineNum">     633 </span>            :   int mHits = 0;
<span class="lineNum">     634 </span>            : 
<span class="lineNum">     635 </span>            :   //int oldSlice = -1;
<span class="lineNum">     636 </span>            :   double alpha = ( TMath::Abs( Alpha + 1 ) &lt; 1.e-4 ) ? fSlice-&gt;Param().Alpha() : Alpha;
<span class="lineNum">     637 </span>            :   AliHLTTPCCATrackParam tt = t;
<span class="lineNum">     638 </span>            : 
<span class="lineNum">     639 </span>            :   for ( int iHit = 0; iHit &lt; NHits; iHit++ ) {
<span class="lineNum">     640 </span>            : 
<span class="lineNum">     641 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[vHits[iHit].ID()];
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span>            :     double hCos = TMath::Cos( alpha - tracker.Slices()[h.ISlice()].Param().Alpha() );
<span class="lineNum">     644 </span>            :     double hSin = TMath::Sin( alpha - tracker.Slices()[h.ISlice()].Param().Alpha() );
<span class="lineNum">     645 </span>            :     double x0 = h.X(), y0 = h.Y(), z1 = h.Z();
<span class="lineNum">     646 </span>            :     double x1 = x0 * hCos + y0 * hSin;
<span class="lineNum">     647 </span>            :     double y1 = y0 * hCos - x0 * hSin;
<span class="lineNum">     648 </span>            : 
<span class="lineNum">     649 </span>            :     {
<span class="lineNum">     650 </span>            :       double dx = x1 - tt.X();
<span class="lineNum">     651 </span>            :       double dy = y1 - tt.Y();
<span class="lineNum">     652 </span>            :       if ( dx*dx + dy*dy &gt; 1. ) {
<span class="lineNum">     653 </span>            :         double dalpha = TMath::ATan2( dy, dx );
<span class="lineNum">     654 </span>            :         if ( tt.Rotate( dalpha ) ) {
<span class="lineNum">     655 </span>            :           alpha += dalpha;
<span class="lineNum">     656 </span>            :           hCos = TMath::Cos( alpha - tracker.Slices()[h.ISlice()].Param().Alpha() );
<span class="lineNum">     657 </span>            :           hSin = TMath::Sin( alpha - tracker.Slices()[h.ISlice()].Param().Alpha() );
<span class="lineNum">     658 </span>            :           x1 = x0 * hCos + y0 * hSin;
<span class="lineNum">     659 </span>            :           y1 = y0 * hCos - x0 * hSin;
<span class="lineNum">     660 </span>            :         }
<span class="lineNum">     661 </span>            :       }
<span class="lineNum">     662 </span>            :     }
<span class="lineNum">     663 </span>            :     SetSliceTransform( alpha );
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span>            :     //t.GetDCAPoint( x1, y1, z1, x1, y1, z1 );
<span class="lineNum">     666 </span>            :     std::cout &lt;&lt; &quot;mark 3&quot; &lt;&lt; std::endl;
<span class="lineNum">     667 </span>            :     bool ok = tt.TransportToX( x1, .999 );
<span class="lineNum">     668 </span>            :     std::cout &lt;&lt; &quot;mark 4&quot; &lt;&lt; std::endl;
<span class="lineNum">     669 </span>            :     if ( 1 || ok ) {
<span class="lineNum">     670 </span>            :       x1 = tt.X();
<span class="lineNum">     671 </span>            :       y1 = tt.Y();
<span class="lineNum">     672 </span>            :       z1 = tt.Z();
<span class="lineNum">     673 </span>            :     }
<span class="lineNum">     674 </span>            : 
<span class="lineNum">     675 </span>            :     Slice2View( x1, y1, &amp;x1, &amp;y1 );
<span class="lineNum">     676 </span>            :     vx[mHits] = x1;
<span class="lineNum">     677 </span>            :     vy[mHits] = y1;
<span class="lineNum">     678 </span>            :     vz[mHits] = z1;
<span class="lineNum">     679 </span>            :     mHits++;
<span class="lineNum">     680 </span>            :     for ( int j = 0; j &lt; 0; j++ ) {
<span class="lineNum">     681 </span>            :       x0 = h.X() + j; y0 = h.Y(); z1 = h.Z();
<span class="lineNum">     682 </span>            :       x1 = x0 * hCos + y0 * hSin;
<span class="lineNum">     683 </span>            :       y1 = y0 * hCos - x0 * hSin;
<span class="lineNum">     684 </span>            :       ok = tt.TransportToX( x1, .999 );
<span class="lineNum">     685 </span>            :       if ( ok ) {
<span class="lineNum">     686 </span>            :         x1 = tt.X();
<span class="lineNum">     687 </span>            :         y1 = tt.Y();
<span class="lineNum">     688 </span>            :         z1 = tt.Z();
<span class="lineNum">     689 </span>            :       }
<span class="lineNum">     690 </span>            : 
<span class="lineNum">     691 </span>            :       Slice2View( x1, y1, &amp;x1, &amp;y1 );
<span class="lineNum">     692 </span>            :       vx[mHits] = x1;
<span class="lineNum">     693 </span>            :       vy[mHits] = y1;
<span class="lineNum">     694 </span>            :       vz[mHits] = z1;
<span class="lineNum">     695 </span>            :       mHits++;
<span class="lineNum">     696 </span>            :     }
<span class="lineNum">     697 </span>            :   }
<span class="lineNum">     698 </span>            :   if ( pPoint ) {
<span class="lineNum">     699 </span>            :     double x1 = t.X(), y1 = t.Y(), z1 = t.Z();
<span class="lineNum">     700 </span>            :     double a = ( TMath::Abs( Alpha + 1 ) &lt; 1.e-4 ) ? fSlice-&gt;Param().Alpha() : Alpha;
<span class="lineNum">     701 </span>            :     SetSliceTransform( a );
<span class="lineNum">     702 </span>            : 
<span class="lineNum">     703 </span>            :     Slice2View( x1, y1, &amp;x1, &amp;y1 );
<span class="lineNum">     704 </span>            :     double dx = x1 - vx[0];
<span class="lineNum">     705 </span>            :     double dy = y1 - vy[0];
<span class="lineNum">     706 </span>            :     //std::cout&lt;&lt;x1&lt;&lt;&quot; &quot;&lt;&lt;y1&lt;&lt;&quot; &quot;&lt;&lt;vx[0]&lt;&lt;&quot; &quot;&lt;&lt;vy[0]&lt;&lt;&quot; &quot;&lt;&lt;dx&lt;&lt;&quot; &quot;&lt;&lt;dy&lt;&lt;std::endl;
<span class="lineNum">     707 </span>            :     double d0 = dx * dx + dy * dy;
<span class="lineNum">     708 </span>            :     dx = x1 - vx[mHits-1];
<span class="lineNum">     709 </span>            :     dy = y1 - vy[mHits-1];
<span class="lineNum">     710 </span>            :     //std::cout&lt;&lt;x1&lt;&lt;&quot; &quot;&lt;&lt;y1&lt;&lt;&quot; &quot;&lt;&lt;vx[mHits-1]&lt;&lt;&quot; &quot;&lt;&lt;vy[mHits-1]&lt;&lt;&quot; &quot;&lt;&lt;dx&lt;&lt;&quot; &quot;&lt;&lt;dy&lt;&lt;std::endl;
<span class="lineNum">     711 </span>            :     double d1 = dx * dx + dy * dy;
<span class="lineNum">     712 </span>            :     //std::cout&lt;&lt;&quot;d0, d1=&quot;&lt;&lt;d0&lt;&lt;&quot; &quot;&lt;&lt;d1&lt;&lt;std::endl;
<span class="lineNum">     713 </span>            :     if ( d1 &lt; d0 ) {
<span class="lineNum">     714 </span>            :       vx[mHits] = x1;
<span class="lineNum">     715 </span>            :       vy[mHits] = y1;
<span class="lineNum">     716 </span>            :       vz[mHits] = z1;
<span class="lineNum">     717 </span>            :       mHits++;
<span class="lineNum">     718 </span>            :     } else {
<span class="lineNum">     719 </span>            :       for ( int i = mHits; i &gt; 0; i-- ) {
<span class="lineNum">     720 </span>            :         vx[i] = vx[i-1];
<span class="lineNum">     721 </span>            :         vy[i] = vy[i-1];
<span class="lineNum">     722 </span>            :         vz[i] = vz[i-1];
<span class="lineNum">     723 </span>            :       }
<span class="lineNum">     724 </span>            :       vx[0] = x1;
<span class="lineNum">     725 </span>            :       vy[0] = y1;
<span class="lineNum">     726 </span>            :       vz[0] = z1;
<span class="lineNum">     727 </span>            :       mHits++;
<span class="lineNum">     728 </span>            :     }
<span class="lineNum">     729 </span>            :   }
<span class="lineNum">     730 </span>            : 
<span class="lineNum">     731 </span>            : 
<span class="lineNum">     732 </span>            :   fLine.SetLineColor( color );
<span class="lineNum">     733 </span>            :   fLine.SetLineWidth( width );
<span class="lineNum">     734 </span>            :   fArc.SetFillStyle( 0 );
<span class="lineNum">     735 </span>            :   fArc.SetLineColor( color );
<span class="lineNum">     736 </span>            :   fArc.SetLineWidth( width );
<span class="lineNum">     737 </span>            :   TPolyLine pl;
<span class="lineNum">     738 </span>            :   pl.SetLineColor( color );
<span class="lineNum">     739 </span>            :   pl.SetLineWidth( width );
<span class="lineNum">     740 </span>            :   TPolyLine plZ;
<span class="lineNum">     741 </span>            :   plZ.SetLineColor( color );
<span class="lineNum">     742 </span>            :   plZ.SetLineWidth( width );
<span class="lineNum">     743 </span>            : 
<span class="lineNum">     744 </span>            :   fMarker.SetMarkerSize( width / 2. );
<span class="lineNum">     745 </span>            :   fMarker.SetMarkerColor( color );
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span>            :   fYX-&gt;cd();
<span class="lineNum">     748 </span>            :   pl.DrawPolyLine( mHits, vx, vy );
<span class="lineNum">     749 </span>            :   {
<span class="lineNum">     750 </span>            :     fMarker.DrawMarker( vx[0], vy[0] );
<span class="lineNum">     751 </span>            :     fMarker.DrawMarker( vx[mHits-1], vy[mHits-1] );
<span class="lineNum">     752 </span>            :   }
<span class="lineNum">     753 </span>            :   fZX-&gt;cd();
<span class="lineNum">     754 </span>            :   plZ.DrawPolyLine( mHits, vz, vy );
<span class="lineNum">     755 </span>            :   fMarker.DrawMarker( vz[0], vy[0] );
<span class="lineNum">     756 </span>            :   fMarker.DrawMarker( vz[mHits-1], vy[mHits-1] );
<span class="lineNum">     757 </span>            : 
<span class="lineNum">     758 </span>            :   fLine.SetLineWidth( 1 );
<span class="lineNum">     759 </span>            :   return 1;
<span class="lineNum">     760 </span>            : #endif
<span class="lineNum">     761 </span>            : }
<a name="762"><span class="lineNum">     762 </span>            : </a>
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span>            : bool AliHLTTPCCADisplay::DrawTracklet( AliHLTTPCCATrackParam &amp;/*track*/, const int */*hitstore*/, int /*color*/, int /*width*/, bool /*pPoint*/ )
<span class="lineNum">     765 </span>            : {
<span class="lineNum">     766 </span>            :   // draw tracklet
<span class="lineNum">     767 </span>            : #ifdef XXX
<span class="lineNum">     768 </span>            :   AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     769 </span>            :   AliHLTTPCCADisplayTmpHit vHits[200];
<span class="lineNum">     770 </span>            :   int nHits = 0;
<span class="lineNum">     771 </span>            :   for ( int iRow = 0; iRow &lt; fSlice-&gt;Param().NRows(); iRow++ ) {
<span class="lineNum">     772 </span>            :     int iHit = hitstore[iRow];
<span class="lineNum">     773 </span>            :     if ( iHit &lt; 0 ) continue;
<span class="lineNum">     774 </span>            :     const AliHLTTPCCARow &amp;row = fSlice-&gt;Row( iRow );
<span class="lineNum">     775 </span>            :     int id = fSlice-&gt;HitInputID( row, iHit );
<span class="lineNum">     776 </span>            :     int iGBHit = tracker.FirstSliceHit()[fSlice-&gt;Param().ISlice()] + id;
<span class="lineNum">     777 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[iGBHit];
<span class="lineNum">     778 </span>            :     vHits[nHits].SetID( iGBHit );
<span class="lineNum">     779 </span>            :     vHits[nHits].SetS( 0 );
<span class="lineNum">     780 </span>            :     vHits[nHits].SetZ( h.Z() );
<span class="lineNum">     781 </span>            :     nHits++;
<span class="lineNum">     782 </span>            :   }
<span class="lineNum">     783 </span>            :   return DrawTrack( track, -1, vHits, nHits, color, width, pPoint );
<span class="lineNum">     784 </span>            : #endif
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :   return 1;</span>
<span class="lineNum">     786 </span>            : }
<a name="787"><span class="lineNum">     787 </span>            : </a>
<span class="lineNum">     788 </span>            : 
<span class="lineNum">     789 </span>            : void AliHLTTPCCADisplay::DrawSliceOutTrack( AliHLTTPCCATrackParam &amp;/*t*/, double /*alpha*/, int /*itr*/, int /*color*/, int /*width*/ )
<span class="lineNum">     790 </span>            : {
<span class="lineNum">     791 </span>            :   // draw slice track
<span class="lineNum">     792 </span>            : #ifdef XXX
<span class="lineNum">     793 </span>            :   AliHLTTPCCAOutTrack &amp;track = fSlice-&gt;OutTracks()[itr];
<span class="lineNum">     794 </span>            :   if ( track.NHits() &lt; 2 ) return;
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span>            :   AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     797 </span>            :   AliHLTTPCCADisplayTmpHit vHits[200];
<span class="lineNum">     798 </span>            : 
<span class="lineNum">     799 </span>            :   for ( int ih = 0; ih &lt; track.NHits(); ih++ ) {
<span class="lineNum">     800 </span>            :     int id = tracker.FirstSliceHit()[fSlice-&gt;Param().ISlice()] + fSlice-&gt;OutTrackHit(track.FirstHitRef()+ih);
<span class="lineNum">     801 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[id];
<span class="lineNum">     802 </span>            :     vHits[ih].SetID( id );
<span class="lineNum">     803 </span>            :     vHits[ih].SetS( 0 );
<span class="lineNum">     804 </span>            :     vHits[ih].SetZ( h.Z() );
<span class="lineNum">     805 </span>            :   }
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span>            :   DrawTrack( t, alpha, vHits, track.NHits(), color, width, 1 );
<span class="lineNum">     808 </span>            : #endif
<a name="809"><span class="lineNum">     809 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     810 </span>            : 
<span class="lineNum">     811 </span>            : void AliHLTTPCCADisplay::DrawSliceOutTrack( int /*itr*/, int /*color*/, int /*width*/ )
<span class="lineNum">     812 </span>            : {
<span class="lineNum">     813 </span>            :   // draw slice track
<span class="lineNum">     814 </span>            : #ifdef XXX
<span class="lineNum">     815 </span>            :   AliHLTTPCCAOutTrack &amp;track = fSlice-&gt;OutTracks()[itr];
<span class="lineNum">     816 </span>            :   if ( track.NHits() &lt; 2 ) return;
<span class="lineNum">     817 </span>            : 
<span class="lineNum">     818 </span>            :   AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     819 </span>            :   AliHLTTPCCADisplayTmpHit vHits[200];
<span class="lineNum">     820 </span>            : 
<span class="lineNum">     821 </span>            :   for ( int ih = 0; ih &lt; track.NHits(); ih++ ) {
<span class="lineNum">     822 </span>            :     int id = tracker.FirstSliceHit()[fSlice-&gt;Param().ISlice()] + fSlice-&gt;OutTrackHit(track.FirstHitRef()+ih);
<span class="lineNum">     823 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[id];
<span class="lineNum">     824 </span>            :     vHits[ih].SetID( id );
<span class="lineNum">     825 </span>            :     vHits[ih].SetS( 0 );
<span class="lineNum">     826 </span>            :     vHits[ih].SetZ( h.Z() );
<span class="lineNum">     827 </span>            :   }
<span class="lineNum">     828 </span>            : 
<span class="lineNum">     829 </span>            :   DrawTrack( track.StartPoint(), -1, vHits, track.NHits(), color, width );
<span class="lineNum">     830 </span>            : #endif
<span class="lineNum">     831 </span><span class="lineNoCov">          0 : }</span>
<a name="832"><span class="lineNum">     832 </span>            : </a>
<span class="lineNum">     833 </span>            : 
<span class="lineNum">     834 </span>            : void AliHLTTPCCADisplay::DrawSliceTrack( int /*itr*/, int /*color*/ )
<span class="lineNum">     835 </span>            : {
<span class="lineNum">     836 </span>            :   // draw slice track
<span class="lineNum">     837 </span>            : #ifdef XXX
<span class="lineNum">     838 </span>            :   const AliHLTTPCCATrack &amp;track = fSlice-&gt;Tracks()[itr];
<span class="lineNum">     839 </span>            :   if ( track.NHits() &lt; 2 ) return;
<span class="lineNum">     840 </span>            : 
<span class="lineNum">     841 </span>            :   AliHLTTPCCAGBTracker &amp;tracker = *fGB;
<span class="lineNum">     842 </span>            :   AliHLTTPCCADisplayTmpHit vHits[200];
<span class="lineNum">     843 </span>            :   for ( int ith = 0; ith &lt; track.NHits(); ith++ ) {
<span class="lineNum">     844 </span>            :     AliHLTTPCCAHitId ic = ( fSlice-&gt;TrackHits()[track.FirstHitID()+ith] );
<span class="lineNum">     845 </span>            :     const AliHLTTPCCARow &amp;row = fSlice-&gt;Row( ic );
<span class="lineNum">     846 </span>            :     int ih = ic.HitIndex();
<span class="lineNum">     847 </span>            :     int id = fSlice-&gt;HitInputID( row, ih );
<span class="lineNum">     848 </span>            :     int gbID = tracker.FirstSliceHit()[fSlice-&gt;Param().ISlice()] + id;
<span class="lineNum">     849 </span>            :     const AliHLTTPCCAGBHit &amp;h = tracker.Hits()[gbID];
<span class="lineNum">     850 </span>            :     vHits[ith].SetID( gbID );
<span class="lineNum">     851 </span>            :     vHits[ith].SetS( 0 );
<span class="lineNum">     852 </span>            :     vHits[ith].SetZ( h.Z() );
<span class="lineNum">     853 </span>            :   }
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span>            :   DrawTrack( track.Param(), -1, vHits, track.NHits(), color, -1 );
<span class="lineNum">     856 </span>            :   //track.Param().Print();
<span class="lineNum">     857 </span>            : #endif
<span class="lineNum">     858 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
