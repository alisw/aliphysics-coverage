<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - MUON/MUONcalib/AliMUONCalibrationData.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">MUON/MUONcalib</a> - AliMUONCalibrationData.cxx<span style="font-size: 80%;"> (source / <a href="AliMUONCalibrationData.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">200</td>
            <td class="headerCovTableEntry">473</td>
            <td class="headerCovTableEntryLo">42.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">33</td>
            <td class="headerCovTableEntry">43</td>
            <td class="headerCovTableEntryMed">76.7 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            : * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            : *                                                                        *
<span class="lineNum">       4 </span>            : * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            : * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            : *                                                                        *
<span class="lineNum">       7 </span>            : * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            : * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            : * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            : * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            : * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            : * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            : * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            : **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : // $Id: AliMUONCalibrationData.cxx 59486 2012-11-07 22:06:24Z laphecet $
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : #include &quot;AliMUONCalibrationData.h&quot;
<span class="lineNum">      19 </span>            : 
<span class="lineNum">      20 </span>            : #include &quot;AliCDBEntry.h&quot;
<span class="lineNum">      21 </span>            : #include &quot;AliCDBManager.h&quot;
<span class="lineNum">      22 </span>            : #include &quot;AliCodeTimer.h&quot;
<span class="lineNum">      23 </span>            : #include &quot;AliDCSValue.h&quot;
<span class="lineNum">      24 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      25 </span>            : #include &quot;AliMpDCSNamer.h&quot;
<span class="lineNum">      26 </span>            : #include &quot;AliMpIntPair.h&quot;
<span class="lineNum">      27 </span>            : #include &quot;AliMUONGlobalCrateConfig.h&quot;
<span class="lineNum">      28 </span>            : #include &quot;AliMUONRegionalTriggerConfig.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;AliMUONRejectList.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;AliMUONTriggerEfficiencyCells.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;AliMUONTriggerLut.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;AliMUONVCalibParam.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;AliMUONVStore.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;AliMUONVStore.h&quot;
<span class="lineNum">      35 </span>            : 
<span class="lineNum">      36 </span>            : #include &lt;Riostream.h&gt;
<span class="lineNum">      37 </span>            : #include &lt;TClass.h&gt;
<span class="lineNum">      38 </span>            : #include &lt;TMap.h&gt;
<span class="lineNum">      39 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            : //-----------------------------------------------------------------------------
<span class="lineNum">      42 </span>            : /// \class AliMUONCalibrationData
<span class="lineNum">      43 </span>            : ///
<span class="lineNum">      44 </span>            : /// For the moment, this class stores pedestals, hv (for tracker)
<span class="lineNum">      45 </span>            : /// and lut, masks and efficiencies (for trigger) that are fetched from the CDB.
<span class="lineNum">      46 </span>            : ///
<span class="lineNum">      47 </span>            : /// This class is to be considered as a convenience class.
<span class="lineNum">      48 </span>            : /// Its aim is to ease retrieval of calibration data from the
<span class="lineNum">      49 </span>            : /// condition database.
<span class="lineNum">      50 </span>            : ///
<span class="lineNum">      51 </span>            : /// It acts as a &quot;facade&quot; to a bunch of underlying
<span class="lineNum">      52 </span>            : /// containers/calibration classes.
<span class="lineNum">      53 </span>            : ///
<span class="lineNum">      54 </span>            : /// \author Laurent Aphecetche
<span class="lineNum">      55 </span>            : //-----------------------------------------------------------------------------
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : using std::cout;
<a name="58"><span class="lineNum">      58 </span>            : using std::endl;</a>
<span class="lineNum">      59 </span>            : /// \cond CLASSIMP
<span class="lineNum">      60 </span><span class="lineCov">         18 : ClassImp(AliMUONCalibrationData)</span>
<span class="lineNum">      61 </span>            : /// \endcond
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            : AliMUONVStore* AliMUONCalibrationData::fgBypassPedestals(0x0);
<span class="lineNum">      64 </span>            : 
<span class="lineNum">      65 </span>            : UInt_t AliMUONCalibrationData::fgkPatchHVDCSAliasesSt1WasAppliedMask = static_cast&lt;UInt_t&gt;( 1 &lt;&lt; 4 );
<span class="lineNum">      66 </span>            : UInt_t AliMUONCalibrationData::fgkPatchHVAllWasAppliedMask = static_cast&lt;UInt_t&gt;( 1 &lt;&lt; 8 );
<span class="lineNum">      67 </span>            : 
<a name="68"><span class="lineNum">      68 </span>            : namespace</a>
<span class="lineNum">      69 </span>            : {
<span class="lineNum">      70 </span>            :   void MarkForDeletion(Int_t* indices, Int_t first, Int_t last)
<span class="lineNum">      71 </span>            :   {
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :     for ( Int_t i = first; i &lt;= last; ++i )</span>
<span class="lineNum">      73 </span>            :     {
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :       indices[i] = 1;</span>
<span class="lineNum">      75 </span>            :     }
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      77 </span>            : }
<a name="78"><span class="lineNum">      78 </span>            : </a>
<span class="lineNum">      79 </span>            : //_____________________________________________________________________________
<span class="lineNum">      80 </span>            : AliMUONCalibrationData::AliMUONCalibrationData(Int_t runNumber,
<span class="lineNum">      81 </span>            :                                                Bool_t deferredInitialization)
<span class="lineNum">      82 </span><span class="lineCov">         17 : : TObject(),</span>
<span class="lineNum">      83 </span><span class="lineCov">         17 : fIsValid(kTRUE),</span>
<span class="lineNum">      84 </span><span class="lineCov">         17 : fRunNumber(runNumber),</span>
<span class="lineNum">      85 </span><span class="lineCov">         17 : fPedestals(0x0),</span>
<span class="lineNum">      86 </span><span class="lineCov">         17 : fHV(0x0),</span>
<span class="lineNum">      87 </span><span class="lineCov">         17 : fTriggerDCS(0x0),</span>
<span class="lineNum">      88 </span><span class="lineCov">         17 : fLocalTriggerBoardMasks(0x0),</span>
<span class="lineNum">      89 </span><span class="lineCov">         17 : fRegionalTriggerConfig(0x0),</span>
<span class="lineNum">      90 </span><span class="lineCov">         17 : fGlobalTriggerCrateConfig(0x0),</span>
<span class="lineNum">      91 </span><span class="lineCov">         17 : fTriggerLut(0x0),</span>
<span class="lineNum">      92 </span><span class="lineCov">         17 : fTriggerEfficiency(0x0),</span>
<span class="lineNum">      93 </span><span class="lineCov">         17 : fNeighbours(0x0),</span>
<span class="lineNum">      94 </span><span class="lineCov">         17 : fOccupancyMap(0x0),</span>
<span class="lineNum">      95 </span><span class="lineCov">         17 : fRejectList(0x0),</span>
<span class="lineNum">      96 </span><span class="lineCov">         17 : fConfig(0x0),</span>
<span class="lineNum">      97 </span><span class="lineCov">         17 : fLV(0x0)</span>
<span class="lineNum">      98 </span><span class="lineCov">         51 : {</span>
<span class="lineNum">      99 </span>            : /// Default ctor.
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span>            :   // If deferredInitialization is false, we read *all* calibrations
<span class="lineNum">     102 </span>            :   // at once.
<span class="lineNum">     103 </span>            :   // So when using this class to access only one kind of calibrations (e.g.
<span class="lineNum">     104 </span>            :   // only pedestals), you should put deferredInitialization to kTRUE, which
<span class="lineNum">     105 </span>            :   // will instruct this object to fetch the data only when neeeded.
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span><span class="lineCov">         34 :   AliCodeTimerAuto(&quot;&quot;,0);</span>
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span><span class="lineCov">         17 :   if ( deferredInitialization == kFALSE )</span>
<span class="lineNum">     110 </span>            :   {
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     AliWarning(&quot;Using immediate initialization, which might cause some issue with old OCDBs...&quot;);</span>
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :     Pedestals();</span>
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     OccupancyMap();</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :     RejectList();</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :     HV();</span>
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :     TriggerDCS();</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :     LocalTriggerBoardMasks(0);</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :     RegionalTriggerConfig();</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     GlobalTriggerCrateConfig();</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :     TriggerLut();</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :     TriggerEfficiency();</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :     Neighbours();</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :     Config();</span>
<span class="lineNum">     127 </span>            :   }
<span class="lineNum">     128 </span><span class="lineCov">         34 : }</span>
<a name="129"><span class="lineNum">     129 </span>            : </a>
<span class="lineNum">     130 </span>            : //_____________________________________________________________________________
<span class="lineNum">     131 </span>            : AliMUONCalibrationData::~AliMUONCalibrationData()
<span class="lineNum">     132 </span><span class="lineCov">         90 : {</span>
<span class="lineNum">     133 </span>            :   /// Destructor. Note that we're the owner of our pointers if the OCDB cache
<span class="lineNum">     134 </span>            :   /// is not set. Otherwise the cache is supposed to take care of them...
<span class="lineNum">     135 </span><span class="lineCov">         30 :   if (!(AliCDBManager::Instance()-&gt;GetCacheFlag())) Reset();</span>
<span class="lineNum">     136 </span><span class="lineCov">         45 : }</span>
<span class="lineNum">     137 </span>            : 
<a name="138"><span class="lineNum">     138 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     139 </span>            : AliMUONGlobalCrateConfig*
<span class="lineNum">     140 </span>            : AliMUONCalibrationData::CreateGlobalTriggerCrateConfig(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     141 </span>            : {
<span class="lineNum">     142 </span>            :   /// Create the internal store for GlobalTriggerCrateConfig from OCDB
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span><span class="lineCov">         12 :   return dynamic_cast&lt;AliMUONGlobalCrateConfig*&gt;(CreateObject(runNumber,&quot;MUON/Calib/GlobalTriggerCrateConfig&quot;,startOfValidity));</span>
<span class="lineNum">     145 </span>            : }
<span class="lineNum">     146 </span>            : 
<a name="147"><span class="lineNum">     147 </span>            : </a>
<span class="lineNum">     148 </span>            : //______________________________________________________________________________
<span class="lineNum">     149 </span>            : Bool_t AliMUONCalibrationData::CheckHVGroup(TObjArray&amp; values, Int_t first, Int_t last, Double_t&amp; value, Int_t&amp; slope, TString* msg)
<span class="lineNum">     150 </span>            : {
<span class="lineNum">     151 </span>            :   // Get the HV of the values between first and last indices
<span class="lineNum">     152 </span>            :   // return the HV slope  (in Volt per second) and a message
<span class="lineNum">     153 </span>            :   // Return kFALSE if we must discard the group
<span class="lineNum">     154 </span>            :   //
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   if (msg) *msg=&quot;&quot;;</span>
<span class="lineNum">     157 </span>            : 
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   if ( last &lt; first ) return kFALSE;</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :   if ( last - first &lt; 2 ) return kFALSE;</span>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            :   Double_t a(0.0);
<span class="lineNum">     162 </span>            :   Double_t b(0.0);
<span class="lineNum">     163 </span>            : 
<span class="lineNum">     164 </span>            :   Float_t HVSAME(1); // 1 volts
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   AliDCSValue* vfirst = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(first));</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   AliDCSValue* vlast = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(last));</span>
<span class="lineNum">     168 </span>            : 
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   Int_t deltaHV = TMath::Nint(TMath::Abs(vfirst-&gt;GetFloat()-vlast-&gt;GetFloat()));</span>
<span class="lineNum">     170 </span>            : 
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   if ( deltaHV &lt; HVSAME ) return kFALSE;</span>
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   for ( Int_t i = first; i &lt;= last; ++i )</span>
<span class="lineNum">     174 </span>            :   {
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :     AliDCSValue* v = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(i));</span>
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :     Double_t y = v-&gt;GetFloat() - vfirst-&gt;GetFloat();</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     Double_t x = v-&gt;GetTimeStamp() - vfirst-&gt;GetTimeStamp();</span>
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     a += x*y;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :     b += x*x;</span>
<span class="lineNum">     182 </span>            :   }
<span class="lineNum">     183 </span>            : 
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   value = a/b;</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   slope = value &gt; 0 ? 1 : -1;</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :   value = TMath::Abs(value);</span>
<span class="lineNum">     187 </span>            : 
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :   UInt_t deltaTime = vlast-&gt;GetTimeStamp() - vfirst-&gt;GetTimeStamp();</span>
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   if (msg)</span>
<span class="lineNum">     191 </span>            :   {
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :     if (slope&gt;0) (*msg) = Form(&quot;RU%d[%d:%d](%d)&quot;,TMath::Nint(value),first,last,deltaTime);</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :     if (slope&lt;0) (*msg) = Form(&quot;RD%d[%d:%d](%d)&quot;,TMath::Nint(value),first,last,deltaTime);</span>
<span class="lineNum">     194 </span>            : 
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :     if ( TMath::Nint(value) == 0 )</span>
<span class="lineNum">     196 </span>            :     {
<span class="lineNum">     197 </span>            :       // this is to protect for the few cases
<span class="lineNum">     198 </span>            :       // (see e.g. MchHvLvLeft/Chamber00Left/Quad2Sect0.actual.vMon in run 134497)
<span class="lineNum">     199 </span>            :       // where we can have *lots* of values (2483 in this example) but that
<span class="lineNum">     200 </span>            :       // are more or less constant...
<span class="lineNum">     201 </span>            :       //
<span class="lineNum">     202 </span>            :       // or simply to remove small ramps
<span class="lineNum">     203 </span>            :       //
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :       slope = 0;</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :       value = (vfirst-&gt;GetFloat()+vlast-&gt;GetFloat())/2.0;</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :       *msg = Form(&quot;FLUCT%d[%d:%d]&quot;,TMath::Nint(value),first,last);</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     208 </span>            :   }
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            :   return kTRUE;
<span class="lineNum">     211 </span><span class="lineNoCov">          0 : }</span>
<a name="212"><span class="lineNum">     212 </span>            : </a>
<span class="lineNum">     213 </span>            : //______________________________________________________________________________
<span class="lineNum">     214 </span>            : Bool_t AliMUONCalibrationData::PatchHVValues(TObjArray&amp; values,
<span class="lineNum">     215 </span>            :                                              TString* msg,
<span class="lineNum">     216 </span>            :                                              Bool_t dryRun)
<span class="lineNum">     217 </span>            : {
<span class="lineNum">     218 </span>            :   /// We do here a little bit of massaging of the HV values, if needed.
<span class="lineNum">     219 </span>            :   ///
<span class="lineNum">     220 </span>            :   /// The main point is to &quot;gather&quot; values that are within a given small amount
<span class="lineNum">     221 </span>            :   /// of time (typically 60 seconds) and infer a slope from those values
<span class="lineNum">     222 </span>            :   /// slope &gt; 0 means it is a ramp-up, slope &lt; 0 that's a ramp-down
<span class="lineNum">     223 </span>            :   ///
<span class="lineNum">     224 </span>            :   /// This is to avoid both the &quot;ramp-down-before-end-of-run&quot; and the
<span class="lineNum">     225 </span>            :   /// &quot;ramp-up-after-start-of-run&quot; syndroms...
<span class="lineNum">     226 </span>            :   ///
<span class="lineNum">     227 </span>            :   /// Use dryRun = kTRUE to fill the messages *without* altering the values
<span class="lineNum">     228 </span>            :   ///
<span class="lineNum">     229 </span>            :   /// Return kFALSE if the kind of HV (trouble) case we have here
<span class="lineNum">     230 </span>            :   /// has not been identified...
<span class="lineNum">     231 </span>            :   ///
<span class="lineNum">     232 </span>            : 
<span class="lineNum">     233 </span>            :   UInt_t DELTATIME(60); // in seconds
<span class="lineNum">     234 </span>            :   Int_t IENDRU(60); // in seconds
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span>            :   // Start by finding groups of values which are not separated (each) by more than
<span class="lineNum">     237 </span>            :   // deltaTime
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span>            :   Bool_t gather(kFALSE);
<span class="lineNum">     240 </span>            :   Int_t ifirst(0);
<span class="lineNum">     241 </span>            :   Int_t ilast(0);
<span class="lineNum">     242 </span><span class="lineCov">        376 :   TObjArray groups;</span>
<span class="lineNum">     243 </span><span class="lineCov">        376 :   groups.SetOwner(kTRUE);</span>
<span class="lineNum">     244 </span>            : 
<span class="lineNum">     245 </span><span class="lineCov">       6392 :   for ( Int_t i = values.GetLast(); i &gt; 0; --i )</span>
<span class="lineNum">     246 </span>            :   {
<span class="lineNum">     247 </span><span class="lineCov">       2632 :     AliDCSValue* vi = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(i));</span>
<span class="lineNum">     248 </span><span class="lineCov">       2632 :     AliDCSValue* vj = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(i-1));</span>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineCov">       5264 :     if ( vi-&gt;GetTimeStamp() - vj-&gt;GetTimeStamp() &lt; DELTATIME )</span>
<span class="lineNum">     251 </span>            :     {
<span class="lineNum">     252 </span><span class="lineCov">       2632 :       if ( !gather )</span>
<span class="lineNum">     253 </span>            :       {
<span class="lineNum">     254 </span>            :         gather = kTRUE;
<span class="lineNum">     255 </span>            :         ifirst = i;
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     257 </span>            :       ilast=i;
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     259 </span>            :     else
<span class="lineNum">     260 </span>            :     {
<span class="lineNum">     261 </span><span class="lineCov">       2632 :       if ( gather )</span>
<span class="lineNum">     262 </span>            :       {
<span class="lineNum">     263 </span>            :         ilast=i;
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         groups.Add(new AliMpIntPair(ilast,ifirst));</span>
<span class="lineNum">     266 </span>            :       }
<span class="lineNum">     267 </span>            :       gather = kFALSE;
<span class="lineNum">     268 </span>            :     }
<span class="lineNum">     269 </span>            :   }
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span><span class="lineCov">        376 :   if (gather)</span>
<span class="lineNum">     272 </span>            :   {
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :     groups.Add(new AliMpIntPair(0,ifirst));</span>
<span class="lineNum">     274 </span>            :   }
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span><span class="lineCov">        376 :   TIter nextGroup(&amp;groups,kIterBackward);</span>
<span class="lineNum">     277 </span>            :   AliMpIntPair* p;
<span class="lineNum">     278 </span><span class="lineCov">        376 :   TString internalMsg;</span>
<span class="lineNum">     279 </span>            :   Int_t ngroups(0);
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span>            :   Int_t nRU(0);
<span class="lineNum">     282 </span>            :   Int_t nRD(0);
<span class="lineNum">     283 </span>            :   Int_t nStartRU(0);
<span class="lineNum">     284 </span>            :   Int_t nEndAndShortRU(0);
<span class="lineNum">     285 </span>            :   Int_t nEndRD(0);
<span class="lineNum">     286 </span>            :   Int_t nTripRD(0);
<span class="lineNum">     287 </span>            :   Int_t nFluct(0);
<span class="lineNum">     288 </span><span class="lineCov">        376 :   TObjArray trips;</span>
<span class="lineNum">     289 </span><span class="lineCov">        376 :   trips.SetOwner(kTRUE);</span>
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span><span class="lineCov">        752 :   while ( ( p = static_cast&lt;AliMpIntPair*&gt;(nextGroup()) ) )</span>
<span class="lineNum">     292 </span>            :   {
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :     Double_t value;</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :     Int_t slope;</span>
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     TString groupMsg;</span>
<span class="lineNum">     297 </span>            : 
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :     AliDebugClass(1,Form(&quot;group %d:%d&quot;,p-&gt;GetFirst(),p-&gt;GetSecond()));</span>
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :     Bool_t ok = CheckHVGroup(values,p-&gt;GetFirst(),p-&gt;GetSecond(),value,slope,&amp;groupMsg);</span>
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :     if (!ok) continue;</span>
<span class="lineNum">     303 </span>            : 
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :     ++ngroups;</span>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :     if ( slope &gt; 0 )</span>
<span class="lineNum">     307 </span>            :     {
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :       if ( p-&gt;GetFirst() == 0 )</span>
<span class="lineNum">     309 </span>            :       {
<span class="lineNum">     310 </span>            :         // start with a ramp-up
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :         ++nStartRU;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :       else if ( p-&gt;GetSecond() == values.GetLast() &amp;&amp; TMath::Nint(value) &lt; IENDRU )</span>
<span class="lineNum">     314 </span>            :       {
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :         ++nEndAndShortRU;</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     317 </span>            :       else
<span class="lineNum">     318 </span>            :       {
<span class="lineNum">     319 </span>            :         // ramp-up in the middle of nowhere...
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :         ++nRU;</span>
<span class="lineNum">     321 </span>            :       }
<span class="lineNum">     322 </span>            :     }
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :     else if ( slope &lt; 0 )</span>
<span class="lineNum">     324 </span>            :     {
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :       if ( p-&gt;GetSecond() == values.GetLast() )</span>
<span class="lineNum">     326 </span>            :       {
<span class="lineNum">     327 </span>            :         // end with a ramp-down
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :         ++nEndRD;</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     330 </span>            :       else
<span class="lineNum">     331 </span>            :       {
<span class="lineNum">     332 </span>            :         // ramp-down in the middle of nowhere
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         ++nRD;</span>
<span class="lineNum">     334 </span>            :       }
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :       AliDCSValue* d = static_cast&lt;AliDCSValue*&gt;(values.At(p-&gt;GetSecond()));</span>
<span class="lineNum">     337 </span>            : 
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :       if ( d-&gt;GetFloat() &lt; AliMpDCSNamer::TrackerHVOFF() )</span>
<span class="lineNum">     339 </span>            :       {
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :         ++nTripRD;</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :         AliDCSValue* tripStart = static_cast&lt;AliDCSValue*&gt;(values.At(p-&gt;GetFirst()));</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :         trips.Add(new AliMpIntPair(tripStart-&gt;GetTimeStamp(),TMath::Nint(tripStart-&gt;GetFloat())));</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     345 </span>            :     else
<span class="lineNum">     346 </span>            :     {
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :       ++nFluct;</span>
<span class="lineNum">     348 </span>            :     }
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     internalMsg += groupMsg;</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :     internalMsg += &quot; &quot;;</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     353 </span>            : 
<span class="lineNum">     354 </span>            :   /*
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span>            :    Once we have &quot;decoded&quot; the groups we try to find out which of
<span class="lineNum">     357 </span>            :    the following cases we're facing :
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            :    case A = -------- = OK(1)
<span class="lineNum">     360 </span>            : 
<span class="lineNum">     361 </span>            :    case B = ----
<span class="lineNum">     362 </span>            :                 \
<span class="lineNum">     363 </span>            :                 \   = OK, once we have removed the ramp-down (2)
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span>            :    case C =    -----
<span class="lineNum">     366 </span>            :               /
<span class="lineNum">     367 </span>            :              /       = OK, once we have removed the ramp-up (3)
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span>            :    case D =    -----
<span class="lineNum">     370 </span>            :               /     \
<span class="lineNum">     371 </span>            :              /       \ = OK, once we have removed the ramp-down (2) and the ramp-up (3)
<span class="lineNum">     372 </span>            : 
<span class="lineNum">     373 </span>            :    case E = ----
<span class="lineNum">     374 </span>            :                 \
<span class="lineNum">     375 </span>            :                  \____ = TRIP = BAD (here the ramp-down slope should be bigger than in case C)
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span>            :    case F = ----
<span class="lineNum">     378 </span>            :                 \      ----- = BAD (trip + ramp-up at end of run)
<span class="lineNum">     379 </span>            :                  \____/
<span class="lineNum">     380 </span>            : 
<span class="lineNum">     381 </span>            :    case G = fluctuations (within a range defined in CheckHVGroup...)
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span>            :    case H =
<span class="lineNum">     384 </span>            :                    /
<span class="lineNum">     385 </span>            :                   /   = ramp-up right at the end-of-run = OK (4)
<span class="lineNum">     386 </span>            :             ------
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span>            :    (1) OK means the group is identified correctly, still the value can be below ready...
<span class="lineNum">     389 </span>            :    (2) ramp-down values will be removed if the ramp is indeed the last values in the serie
<span class="lineNum">     390 </span>            :        i.e. it's really an end-of-run problem (otherwise it's not case B)
<span class="lineNum">     391 </span>            :    (3) ramp-up values will be removed if the ramp is indeed the first values in the serie
<span class="lineNum">     392 </span>            :        i.e. it's really a start-of-run problem (otherwise it's not case C)
<span class="lineNum">     393 </span>            :    (4) OK if short enough...
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span>            :    Any other case is unknown and we'll :
<span class="lineNum">     396 </span>            :    a) return kFALSE
<span class="lineNum">     397 </span>            :    b) assume the channel is OFF.
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span>            :   */
<span class="lineNum">     401 </span>            : 
<span class="lineNum">     402 </span><span class="lineCov">       2256 :   AliDebugClass(1,Form(&quot;msg=%s ngroupds=%d&quot;,internalMsg.Data(),ngroups));</span>
<span class="lineNum">     403 </span><span class="lineCov">       2256 :   AliDebugClass(1,Form(&quot;nRU %d nRD %d nStartRU %d nEndRD %d nTripRD %d nFluct %d&quot;,</span>
<span class="lineNum">     404 </span>            :                        nRU,nRD,nStartRU,nEndRD,nTripRD,nFluct));
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span><span class="lineCov">        376 :   TString hvCase(&quot;OTHER&quot;);</span>
<span class="lineNum">     407 </span><span class="lineCov">        376 :   int dummy(0),a(-1),b(-1);</span>
<span class="lineNum">     408 </span><span class="lineCov">        376 :   char r[81];</span>
<span class="lineNum">     409 </span><span class="lineCov">        376 :   Int_t nvalues = values.GetSize();</span>
<span class="lineNum">     410 </span><span class="lineCov">        752 :   Int_t* indices = new Int_t[nvalues];</span>
<span class="lineNum">     411 </span><span class="lineCov">        376 :   memset(indices,0,nvalues*sizeof(Int_t));</span>
<span class="lineNum">     412 </span>            : 
<span class="lineNum">     413 </span><span class="lineCov">        376 :   AliDCSValue* vfirst = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(0));</span>
<span class="lineNum">     414 </span><span class="lineCov">        752 :   AliDCSValue* vlast = static_cast&lt;AliDCSValue*&gt;(values.UncheckedAt(values.GetLast()));</span>
<span class="lineNum">     415 </span>            : 
<span class="lineNum">     416 </span><span class="lineCov">        376 :   UInt_t meanTimeStamp = ( vfirst-&gt;GetTimeStamp() + vlast-&gt;GetTimeStamp() ) / 2;</span>
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span><span class="lineCov">        376 :   if ( ngroups == 0 )</span>
<span class="lineNum">     419 </span>            :   {
<span class="lineNum">     420 </span><span class="lineCov">        376 :     hvCase = &quot;A&quot;;</span>
<span class="lineNum">     421 </span>            :   }
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   else if ( nTripRD &gt; 0 )</span>
<span class="lineNum">     423 </span>            :   {
<span class="lineNum">     424 </span>            :     const Double_t HVLOWTRIP(600); // a trip below this value is considered a &quot;low trip&quot;
<span class="lineNum">     425 </span>            :     // i.e. one starting for a non-operational voltage
<span class="lineNum">     426 </span>            : 
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     internalMsg += Form(&quot;NT:%d &quot;,nTripRD);</span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :     if ( nRU &gt; 0 &amp;&amp; nRD &gt; 0 )</span>
<span class="lineNum">     430 </span>            :     {
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :       hvCase = &quot;F&quot;;</span>
<span class="lineNum">     432 </span>            :     }
<span class="lineNum">     433 </span>            :     else
<span class="lineNum">     434 </span>            :     {
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :       hvCase = &quot;E&quot;;</span>
<span class="lineNum">     436 </span>            :     }
<span class="lineNum">     437 </span>            : 
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :     for ( Int_t iTrip = 0; iTrip &lt;= trips.GetLast(); ++iTrip )</span>
<span class="lineNum">     439 </span>            :     {
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :       AliMpIntPair* tripPair = static_cast&lt;AliMpIntPair*&gt;(trips.At(iTrip));</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :       TString tripType(&quot;TRIP&quot;);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :       if ( tripPair-&gt;GetSecond() &lt; HVLOWTRIP)</span>
<span class="lineNum">     443 </span>            :       {
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :         tripType = &quot;LOWTRIP&quot;;</span>
<span class="lineNum">     445 </span>            :       }
<span class="lineNum">     446 </span>            : 
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :       internalMsg += Form(&quot;%s SV:%d TS:%d &quot;,tripType.Data(),tripPair-&gt;GetSecond(),tripPair-&gt;GetFirst());</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     449 </span>            : 
<span class="lineNum">     450 </span>            :     // we put here the TRIP value as SV:value
<span class="lineNum">     451 </span>            :     // for cases where there's a drop in voltage but the starting point was
<span class="lineNum">     452 </span>            :     // below operational voltage, so strictly speaking it's *not* a trip, but
<span class="lineNum">     453 </span>            :     // more a big fluctuation
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     if ( !dryRun )</span>
<span class="lineNum">     455 </span>            :     {
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,0,values.GetLast());</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :       values.Add(new AliDCSValue(static_cast&lt;Float_t&gt;(0),meanTimeStamp));</span>
<span class="lineNum">     458 </span>            :     }
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :   else if ( nStartRU &gt; 0 &amp;&amp; nRU == 0 &amp;&amp; nRD == 0 &amp;&amp; nEndRD == 0 )</span>
<span class="lineNum">     461 </span>            :   {
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :     hvCase = &quot;C&quot;;</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :     if (!dryRun)</span>
<span class="lineNum">     464 </span>            :     {
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :       sscanf(internalMsg.Data(),&quot;RU%10d[%10d:%10d]%80s&quot;,&amp;dummy,&amp;a,&amp;b,r);</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,a,b);</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     468 </span>            :   }
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :   else if ( nStartRU &gt; 0 &amp;&amp; nEndRD &gt; 0 &amp;&amp; nRD == 0 &amp;&amp; nRU == 0 )</span>
<span class="lineNum">     470 </span>            :   {
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     hvCase = &quot;D&quot;;</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :     if (!dryRun)</span>
<span class="lineNum">     473 </span>            :     {
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :       sscanf(internalMsg.Data(),&quot;RU%10d[%10d:%10d]%80s&quot;,&amp;dummy,&amp;a,&amp;b,r);</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,a,b-1);</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :       Int_t i = internalMsg.Index(&quot;RD&quot;,strlen(&quot;RD&quot;),0,TString::kExact);</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :       sscanf(internalMsg(i,internalMsg.Length()-i).Data(),</span>
<span class="lineNum">     478 </span>            :              &quot;RD%10d[%10d:%10d]%80s&quot;,&amp;dummy,&amp;a,&amp;b,r);
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,a+1,b);</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     481 </span>            :   }
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :   else if ( nEndRD &gt; 0 &amp;&amp; nStartRU == 0 &amp;&amp; nRU == 0 &amp;&amp; nRD == 0 )</span>
<span class="lineNum">     483 </span>            :   {
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :     hvCase = &quot;B&quot;;</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :     if  (!dryRun)</span>
<span class="lineNum">     486 </span>            :     {
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :       Int_t i = internalMsg.Index(&quot;RD&quot;,strlen(&quot;RD&quot;),0,TString::kExact);</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :       sscanf(internalMsg(i,internalMsg.Length()-i).Data(),</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :              &quot;RD%10d[%10d:%10d]%80s&quot;,&amp;dummy,&amp;a,&amp;b,r);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,a,b);</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     492 </span>            :   }
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :   else if ( nFluct &gt; 0 )</span>
<span class="lineNum">     494 </span>            :   {
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     hvCase = &quot;G&quot;;</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     if (!dryRun)</span>
<span class="lineNum">     497 </span>            :     {
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :       TObjArray* af = internalMsg.Tokenize(&quot; &quot;);</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :       TIter next(af);</span>
<span class="lineNum">     500 </span>            :       TObjString* str;
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :       while ( ( str = static_cast&lt;TObjString*&gt;(next()) ) )</span>
<span class="lineNum">     502 </span>            :       {
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :         TString s(str-&gt;String());</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :         if ( s.BeginsWith(&quot;FLUCT&quot;) )</span>
<span class="lineNum">     505 </span>            :         {
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :           sscanf(s.Data(),&quot;FLUCT%d[%d:%d]&quot;,&amp;dummy,&amp;a,&amp;b);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :           MarkForDeletion(indices,a,b);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :       delete af;</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     512 </span>            :   }
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :   else if ( nEndAndShortRU &gt; 0 &amp;&amp; nStartRU == 0 &amp;&amp; nRU == 0 &amp;&amp; nRD == 0 &amp;&amp; nEndRD == 0 )</span>
<span class="lineNum">     514 </span>            :   {
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :     hvCase = &quot;H&quot;;</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     if (!dryRun)</span>
<span class="lineNum">     517 </span>            :     {
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :       sscanf(internalMsg.Data(),&quot;RU%10d[%10d:%10d]%80s&quot;,&amp;dummy,&amp;a,&amp;b,r);</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,a,b);</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     521 </span>            :   }
<span class="lineNum">     522 </span>            :   else
<span class="lineNum">     523 </span>            :   {
<span class="lineNum">     524 </span>            :     // last chance...
<span class="lineNum">     525 </span>            :     // here we know it's not a trip, so let's assume everything is OK
<span class="lineNum">     526 </span>            :     // if first and last value are in the same ballpark
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span>            :     const Double_t HVFLUCT(20); // volts
<span class="lineNum">     529 </span>            : 
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     if ( TMath::Abs(vfirst-&gt;GetFloat() - vlast-&gt;GetFloat()) &lt; HVFLUCT )</span>
<span class="lineNum">     531 </span>            :     {
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :       hvCase = &quot;Z&quot;;</span>
<span class="lineNum">     533 </span>            :     }
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :     if (!dryRun)</span>
<span class="lineNum">     535 </span>            :     {
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :       MarkForDeletion(indices,1,nvalues-1);</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     538 </span>            :   }
<span class="lineNum">     539 </span>            : 
<span class="lineNum">     540 </span><span class="lineCov">        376 :   if (!dryRun)</span>
<span class="lineNum">     541 </span>            :   {
<span class="lineNum">     542 </span><span class="lineCov">      12784 :     for ( Int_t i = 0; i &lt; nvalues; ++i )</span>
<span class="lineNum">     543 </span>            :     {
<span class="lineNum">     544 </span><span class="lineCov">       6016 :       if ( indices[i] )</span>
<span class="lineNum">     545 </span>            :       {
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :         values.RemoveAt(i);</span>
<span class="lineNum">     547 </span>            :       }
<span class="lineNum">     548 </span>            :     }
<span class="lineNum">     549 </span>            : 
<span class="lineNum">     550 </span><span class="lineCov">        376 :     values.Compress();</span>
<span class="lineNum">     551 </span>            :   }
<span class="lineNum">     552 </span>            : 
<span class="lineNum">     553 </span><span class="lineCov">        752 :   delete[] indices;</span>
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span><span class="lineCov">        752 :   if ( !values.GetEntries() )</span>
<span class="lineNum">     556 </span>            :   {
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :     AliErrorClass(Form(&quot;No value left after patch... Check that !!! initial # of values=%d msg=%s&quot;,</span>
<span class="lineNum">     558 </span>            :                        nvalues,internalMsg.Data()));
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :     hvCase = &quot;OTHER&quot;;</span>
<span class="lineNum">     560 </span>            :   }
<span class="lineNum">     561 </span>            : 
<span class="lineNum">     562 </span><span class="lineCov">        376 :   if (!dryRun)</span>
<span class="lineNum">     563 </span>            :   {
<span class="lineNum">     564 </span>            :     // take the max of the remaining values
<span class="lineNum">     565 </span><span class="lineCov">        376 :     TIter nextA(&amp;values);</span>
<span class="lineNum">     566 </span>            :     AliDCSValue* val;
<span class="lineNum">     567 </span>            :     Float_t maxval(-9999);
<span class="lineNum">     568 </span>            : 
<span class="lineNum">     569 </span><span class="lineCov">       7144 :     while ( ( val = static_cast&lt;AliDCSValue*&gt;(nextA()) ) )</span>
<span class="lineNum">     570 </span>            :     {
<span class="lineNum">     571 </span><span class="lineCov">       6016 :       if ( val-&gt;GetFloat() &gt; maxval )</span>
<span class="lineNum">     572 </span>            :       {
<span class="lineNum">     573 </span><span class="lineCov">        376 :         maxval = val-&gt;GetFloat();</span>
<span class="lineNum">     574 </span><span class="lineCov">        376 :       }</span>
<span class="lineNum">     575 </span>            :     }
<span class="lineNum">     576 </span>            : 
<span class="lineNum">     577 </span><span class="lineCov">        376 :     values.Clear();</span>
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span><span class="lineCov">       1128 :     values.Add(new AliDCSValue(maxval,meanTimeStamp));</span>
<span class="lineNum">     580 </span><span class="lineCov">        376 :   }</span>
<span class="lineNum">     581 </span>            : 
<span class="lineNum">     582 </span>            :   // once the case is inferred, add a &quot;CASE:%10d&quot;,hvCase.Data()
<span class="lineNum">     583 </span>            :   // to the msg
<span class="lineNum">     584 </span>            :   // so we can them sum up for all channels and get a summary per run...
<span class="lineNum">     585 </span>            : 
<span class="lineNum">     586 </span><span class="lineCov">       1128 :   internalMsg += Form(&quot;CASE:%s&quot;,hvCase.Data());</span>
<span class="lineNum">     587 </span>            : 
<span class="lineNum">     588 </span><span class="lineCov">       1128 :   if (msg) *msg = internalMsg.Data();</span>
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span><span class="lineCov">        752 :   return hvCase==&quot;OTHER&quot; ? kFALSE : kTRUE;</span>
<span class="lineNum">     591 </span><span class="lineCov">        376 : }</span>
<a name="592"><span class="lineNum">     592 </span>            : </a>
<span class="lineNum">     593 </span>            : //_____________________________________________________________________________
<span class="lineNum">     594 </span>            : void AliMUONCalibrationData::AddToMap(const TMap&amp; sourceMap,
<span class="lineNum">     595 </span>            :                                       TMap&amp; destMap,
<span class="lineNum">     596 </span>            :                                       const TString&amp; key,
<span class="lineNum">     597 </span>            :                                       const char* source,
<span class="lineNum">     598 </span>            :                                       const char* dest)
<span class="lineNum">     599 </span>            : {
<span class="lineNum">     600 </span>            :   /// Remap
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span><span class="lineCov">       3136 :   TString newkey(key);</span>
<span class="lineNum">     603 </span>            : 
<span class="lineNum">     604 </span><span class="lineCov">       1568 :   newkey.ReplaceAll(source,dest);</span>
<span class="lineNum">     605 </span>            : 
<span class="lineNum">     606 </span><span class="lineCov">       4704 :   TPair* pair = static_cast&lt;TPair*&gt;(sourceMap.FindObject(key.Data()));</span>
<span class="lineNum">     607 </span>            : 
<span class="lineNum">     608 </span><span class="lineCov">       6272 :   destMap.Add(new TObjString(newkey.Data()),pair-&gt;Value());</span>
<span class="lineNum">     609 </span><span class="lineCov">       1568 : }</span>
<a name="610"><span class="lineNum">     610 </span>            : </a>
<span class="lineNum">     611 </span>            : //_____________________________________________________________________________
<span class="lineNum">     612 </span>            : void AliMUONCalibrationData::PatchSt1DCSAliases(TMap&amp; hvMap)
<span class="lineNum">     613 </span>            : {
<span class="lineNum">     614 </span>            :   /// It was discovered (in sept. 2013) that the DCS aliases for St1 was
<span class="lineNum">     615 </span>            :   /// wrongly assigned (in the hardware), so the correspondence between DCS channels
<span class="lineNum">     616 </span>            :   /// and actual HV channels is wrong for St1 in the DCS (and thus in the DCS archive,
<span class="lineNum">     617 </span>            :   /// and so in the OCDB HV object).
<span class="lineNum">     618 </span>            :   ///
<span class="lineNum">     619 </span>            :   /// It affects all the OCDB object written in 2010-2013.
<span class="lineNum">     620 </span>            :   ///
<span class="lineNum">     621 </span>            :   /// This method fixes that.
<span class="lineNum">     622 </span>            : 
<span class="lineNum">     623 </span><span class="lineCov">          6 :   if ( ( hvMap.GetUniqueID() &amp; PatchHVDCSAliasesSt1WasAppliedMask() ) == PatchHVDCSAliasesSt1WasAppliedMask() || ( hvMap.GetUniqueID() == 42 ) )</span>
<span class="lineNum">     624 </span>            :   {
<span class="lineNum">     625 </span>            :     // already clean object. Do nothing
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :     AliWarningClass(&quot;Patching already done for St1 DCS aliases on this map. Not doing it again.&quot;);</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     628 </span>            :   }
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span><span class="lineCov">          2 :   AliCodeTimerAutoClass(Form(&quot;hvMap=%p&quot;,&amp;hvMap),0);</span>
<span class="lineNum">     631 </span>            : 
<span class="lineNum">     632 </span><span class="lineCov">          2 :   TIter next(&amp;hvMap);</span>
<span class="lineNum">     633 </span>            :   TObjString* hvChannelName;
<span class="lineNum">     634 </span>            : 
<span class="lineNum">     635 </span><span class="lineCov">          2 :   TMap newmap;</span>
<span class="lineNum">     636 </span><span class="lineCov">          2 :   newmap.SetOwnerKeyValue(kTRUE,kFALSE);</span>
<span class="lineNum">     637 </span>            : 
<span class="lineNum">     638 </span><span class="lineCov">       4732 :   while ( ( hvChannelName = static_cast&lt;TObjString*&gt;(next()) ) )</span>
<span class="lineNum">     639 </span>            :   {
<span class="lineNum">     640 </span><span class="lineCov">       1576 :     TString name(hvChannelName-&gt;String());</span>
<span class="lineNum">     641 </span><span class="lineCov">       1576 :     TString newname(name);</span>
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span>            :     // the problem is limited to St1 = ch1+ch2 (or, in DCS parlance, ch0+ch1)
<span class="lineNum">     644 </span>            :     // do it &quot;by hand&quot; as we &quot;only&quot; have 8 names to change
<span class="lineNum">     645 </span>            : 
<span class="lineNum">     646 </span><span class="lineCov">       3152 :     if ( name.Contains(&quot;Chamber00Left&quot;) )</span>
<span class="lineNum">     647 </span>            :     {
<span class="lineNum">     648 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad1Sect0&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad1Sect0&quot;,&quot;Quad2Sect0&quot;); // channel 0 of Board00 (alidcscae020)</span>
<span class="lineNum">     649 </span>            : 
<span class="lineNum">     650 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad1Sect1&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad1Sect1&quot;,&quot;Quad2Sect1&quot;); // channel 1</span>
<span class="lineNum">     651 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad1Sect2&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad1Sect2&quot;,&quot;Quad2Sect2&quot;); // channel 2</span>
<span class="lineNum">     652 </span>            : 
<span class="lineNum">     653 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad2Sect2&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad2Sect2&quot;,&quot;Quad1Sect0&quot;); // channel 3</span>
<span class="lineNum">     654 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad2Sect1&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad2Sect1&quot;,&quot;Quad1Sect1&quot;); // channel 4</span>
<span class="lineNum">     655 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad2Sect0&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad2Sect0&quot;,&quot;Quad1Sect2&quot;); // channel 5</span>
<span class="lineNum">     656 </span>            :     }
<span class="lineNum">     657 </span><span class="lineCov">       3128 :     else if ( name.Contains(&quot;Chamber01Left&quot;))</span>
<span class="lineNum">     658 </span>            :     {
<span class="lineNum">     659 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad2Sect2&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad2Sect2&quot;,&quot;Quad2Sect0&quot;); // channel 9 of Board00 (alidcscae020)</span>
<span class="lineNum">     660 </span><span class="lineCov">         26 :       if (name.Contains(&quot;Quad2Sect0&quot;)) AddToMap(hvMap,newmap,name,&quot;Quad2Sect0&quot;,&quot;Quad2Sect2&quot;); // channel 11</span>
<span class="lineNum">     661 </span>            :     }
<span class="lineNum">     662 </span>            :     else
<span class="lineNum">     663 </span>            :     {
<span class="lineNum">     664 </span><span class="lineCov">       4656 :       AddToMap(hvMap,newmap,name,name,name);</span>
<span class="lineNum">     665 </span>            :     }
<span class="lineNum">     666 </span><span class="lineCov">       1576 :   }</span>
<span class="lineNum">     667 </span>            : 
<span class="lineNum">     668 </span>            :   // copy newmap to hvMap
<span class="lineNum">     669 </span>            : 
<span class="lineNum">     670 </span><span class="lineCov">          2 :   TIter nextNewMap(&amp;newmap);</span>
<span class="lineNum">     671 </span><span class="lineCov">       4708 :   while ( ( hvChannelName = static_cast&lt;TObjString*&gt;(nextNewMap()) ) )</span>
<span class="lineNum">     672 </span>            :   {
<span class="lineNum">     673 </span><span class="lineCov">       4704 :     TPair* oldPair = static_cast&lt;TPair*&gt;(hvMap.FindObject(hvChannelName-&gt;String().Data()));</span>
<span class="lineNum">     674 </span><span class="lineCov">       4704 :     TPair* newPair = static_cast&lt;TPair*&gt;(newmap.FindObject(hvChannelName-&gt;String().Data()));</span>
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span><span class="lineCov">       1568 :     TObjArray* newValues = static_cast&lt;TObjArray*&gt;(newPair-&gt;Value());</span>
<span class="lineNum">     677 </span>            : 
<span class="lineNum">     678 </span><span class="lineCov">       1568 :     oldPair-&gt;SetValue(newValues);</span>
<span class="lineNum">     679 </span>            :   }
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span>            :   // Flag the object as being clean as of now, so
<span class="lineNum">     682 </span>            :   // it won't be patched a second time in that method
<span class="lineNum">     683 </span>            :   // is called again...
<span class="lineNum">     684 </span><span class="lineCov">          4 :   hvMap.SetUniqueID( hvMap.GetUniqueID() | PatchHVDCSAliasesSt1WasAppliedMask() );</span>
<span class="lineNum">     685 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     686 </span>            : 
<a name="687"><span class="lineNum">     687 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     688 </span>            : TMap*
<span class="lineNum">     689 </span>            : AliMUONCalibrationData::CreateHV(Int_t runNumber,
<span class="lineNum">     690 </span>            :                                  Int_t* startOfValidity,
<span class="lineNum">     691 </span>            :                                  Bool_t patched,
<span class="lineNum">     692 </span>            :                                  TList* messages,
<span class="lineNum">     693 </span>            :                                  Bool_t dryRun)
<span class="lineNum">     694 </span>            : {
<span class="lineNum">     695 </span>            :   /// Create a new HV map from the OCDB for a given run
<span class="lineNum">     696 </span>            :   ///
<span class="lineNum">     697 </span>            :   /// dryRun is only usefull with patched=kTRUE and non-empty messages) :
<span class="lineNum">     698 </span>            :   /// it allow to get the list of messages without altering the values at all
<span class="lineNum">     699 </span>            :   /// (A patch without a patch, so to speak...)
<span class="lineNum">     700 </span>            :   ///
<span class="lineNum">     701 </span>            : 
<span class="lineNum">     702 </span><span class="lineCov">          6 :   TMap* hvMap = dynamic_cast&lt;TMap*&gt;(CreateObject(runNumber,&quot;MUON/Calib/HV&quot;,startOfValidity));</span>
<span class="lineNum">     703 </span>            : 
<span class="lineNum">     704 </span><span class="lineCov">          2 :   if (!hvMap) return 0x0;</span>
<span class="lineNum">     705 </span>            : 
<span class="lineNum">     706 </span><span class="lineCov">          2 :   AliCodeTimerAutoClass(Form(&quot;hvMap=%p&quot;,hvMap),0);</span>
<span class="lineNum">     707 </span>            : 
<span class="lineNum">     708 </span><span class="lineCov">          2 :   PatchSt1DCSAliases(*hvMap);</span>
<span class="lineNum">     709 </span>            : 
<span class="lineNum">     710 </span><span class="lineCov">          2 :   if (patched)</span>
<span class="lineNum">     711 </span>            :   {
<span class="lineNum">     712 </span><span class="lineCov">          4 :     if ( ( hvMap-&gt;GetUniqueID() &amp; PatchHVAllWasAppliedMask() ) == PatchHVAllWasAppliedMask() )</span>
<span class="lineNum">     713 </span>            :     {
<span class="lineNum">     714 </span>            :       // patch already applied on this object, don't do it again
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :       AliWarningClass(&quot;Patching already done for HV channels on this map. Not doing it again.&quot;);</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :       return hvMap;</span>
<span class="lineNum">     717 </span>            :     }
<span class="lineNum">     718 </span>            : 
<span class="lineNum">     719 </span><span class="lineCov">          2 :     TIter next(hvMap);</span>
<span class="lineNum">     720 </span>            :     TObjString* hvChannelName;
<span class="lineNum">     721 </span>            : 
<span class="lineNum">     722 </span><span class="lineCov">       3158 :     while ( ( hvChannelName = static_cast&lt;TObjString*&gt;(next()) ) )</span>
<span class="lineNum">     723 </span>            :     {
<span class="lineNum">     724 </span><span class="lineCov">       1576 :       TString name(hvChannelName-&gt;String());</span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span><span class="lineCov">       4352 :       if ( name.Contains(&quot;sw&quot;) ) continue; // skip switches</span>
<span class="lineNum">     727 </span>            : 
<span class="lineNum">     728 </span><span class="lineCov">        752 :       if ( name.Contains(&quot;iMon&quot;) ) continue; // skip HV currents</span>
<span class="lineNum">     729 </span>            : 
<span class="lineNum">     730 </span><span class="lineCov">       1128 :       TPair* hvPair = static_cast&lt;TPair*&gt;(hvMap-&gt;FindObject(name.Data()));</span>
<span class="lineNum">     731 </span><span class="lineCov">        376 :       TObjArray* values = static_cast&lt;TObjArray*&gt;(hvPair-&gt;Value());</span>
<span class="lineNum">     732 </span><span class="lineCov">        376 :       if (!values)</span>
<span class="lineNum">     733 </span>            :       {
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :         AliErrorClass(Form(&quot;Could not get values for alias %s&quot;,name.Data()));</span>
<span class="lineNum">     735 </span>            :       }
<span class="lineNum">     736 </span>            :       else
<span class="lineNum">     737 </span>            :       {
<span class="lineNum">     738 </span><span class="lineCov">        376 :         TString msg;</span>
<span class="lineNum">     739 </span>            : 
<span class="lineNum">     740 </span><span class="lineCov">       2256 :         AliDebugClass(1,Form(&quot;channel %s&quot;,name.Data()));</span>
<span class="lineNum">     741 </span><span class="lineCov">        752 :         Bool_t ok = PatchHVValues(*values,&amp;msg,dryRun);</span>
<span class="lineNum">     742 </span>            : 
<span class="lineNum">     743 </span><span class="lineCov">        376 :         if ( messages )</span>
<span class="lineNum">     744 </span>            :         {
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :           messages-&gt;Add(new TObjString(Form(&quot;%s %s&quot;,hvChannelName-&gt;String().Data(),msg.Data())));</span>
<span class="lineNum">     746 </span>            :         }
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span><span class="lineCov">        376 :         if (!ok)</span>
<span class="lineNum">     749 </span>            :         {
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :           AliErrorClass(Form(&quot;PatchHVValue was not successfull ! This is serious ! &quot;</span>
<span class="lineNum">     751 </span>            :                              &quot;You'll have to check the logic for channel %s in run %09d&quot;,
<span class="lineNum">     752 </span>            :                              name.Data(),runNumber));
<span class="lineNum">     753 </span>            :         }
<span class="lineNum">     754 </span><span class="lineCov">        376 :       }</span>
<span class="lineNum">     755 </span><span class="lineCov">       1952 :     }</span>
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span><span class="lineCov">          4 :     hvMap-&gt;SetUniqueID(hvMap-&gt;GetUniqueID() | PatchHVAllWasAppliedMask());</span>
<span class="lineNum">     758 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">     759 </span>            : 
<span class="lineNum">     760 </span><span class="lineCov">          2 :   if ( messages )</span>
<span class="lineNum">     761 </span>            :   {
<span class="lineNum">     762 </span>            :     Int_t a(0),b(0),c(0),d(0),e(0),f(0),g(0),h(0),u(0),z(0);
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :     TIter next(messages);</span>
<span class="lineNum">     764 </span>            :     TObjString* msg;
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :     char hvCase('u');</span>
<span class="lineNum">     766 </span>            : 
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :     while ( ( msg = static_cast&lt;TObjString*&gt;(next()) ) )</span>
<span class="lineNum">     768 </span>            :     {
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :       Int_t i = msg-&gt;String().Index(&quot;CASE&quot;,strlen(&quot;CASE&quot;),0,TString::kExact);</span>
<span class="lineNum">     770 </span>            : 
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :       if ( i &gt;= 0 )</span>
<span class="lineNum">     772 </span>            :       {
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :         sscanf(msg-&gt;String()(i,msg-&gt;String().Length()-i).Data(),&quot;CASE:%10c&quot;,&amp;hvCase);</span>
<span class="lineNum">     774 </span>            :       }
<span class="lineNum">     775 </span>            : 
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :       switch (hvCase)</span>
<span class="lineNum">     777 </span>            :       {
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :         case 'A': ++a; break;</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :         case 'B': ++b; break;</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :         case 'C': ++c; break;</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :         case 'D': ++d; break;</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :         case 'E': ++e; break;</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :         case 'F': ++f; break;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :         case 'G': ++g; break;</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :         case 'H': ++h; break;</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :         case 'Z': ++z; break;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :         default: ++u; break;</span>
<span class="lineNum">     788 </span>            :       }
<span class="lineNum">     789 </span>            :     }
<span class="lineNum">     790 </span>            : 
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :     messages-&gt;Add(new TObjString(Form(&quot;SUMMARY : # of cases A(%3d) B(%3d) C(%3d) D(%3d) E(%3d) F(%3d) G(%3d) H(%3d) Z(%3d) OTHER(%3d)&quot;,</span>
<span class="lineNum">     792 </span>            :                                       a,b,c,d,e,f,g,h,z,u)));
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     794 </span>            : 
<span class="lineNum">     795 </span><span class="lineCov">          2 :   return hvMap;</span>
<span class="lineNum">     796 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     797 </span>            : 
<a name="798"><span class="lineNum">     798 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     799 </span>            : TMap*
<span class="lineNum">     800 </span>            : AliMUONCalibrationData::CreateLV(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     801 </span>            : {
<span class="lineNum">     802 </span>            :   /// Create a new MCH LV map from the OCDB for a given run
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :   return dynamic_cast&lt;TMap*&gt;(CreateObject(runNumber,&quot;MUON/Calib/LV&quot;,startOfValidity));</span>
<span class="lineNum">     804 </span>            : }
<span class="lineNum">     805 </span>            : 
<a name="806"><span class="lineNum">     806 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     807 </span>            : TMap*
<span class="lineNum">     808 </span>            : AliMUONCalibrationData::CreateTriggerDCS(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     809 </span>            : {
<span class="lineNum">     810 </span>            :   /// Create a new Trigger HV and curent map from the OCDB for a given run
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :   return dynamic_cast&lt;TMap*&gt;(CreateObject(runNumber,&quot;MUON/Calib/TriggerDCS&quot;,startOfValidity));</span>
<span class="lineNum">     812 </span>            : }
<span class="lineNum">     813 </span>            : 
<a name="814"><span class="lineNum">     814 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     815 </span>            : AliMUONVStore*
<span class="lineNum">     816 </span>            : AliMUONCalibrationData::CreateLocalTriggerBoardMasks(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     817 </span>            : {
<span class="lineNum">     818 </span>            :   /// Get the internal store for LocalTriggerBoardMasks from OCDB
<span class="lineNum">     819 </span>            : 
<span class="lineNum">     820 </span><span class="lineCov">         12 :   return dynamic_cast&lt;AliMUONVStore*&gt;(CreateObject(runNumber,&quot;MUON/Calib/LocalTriggerBoardMasks&quot;,startOfValidity));</span>
<span class="lineNum">     821 </span>            : }
<span class="lineNum">     822 </span>            : 
<a name="823"><span class="lineNum">     823 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     824 </span>            : AliMUONVStore*
<span class="lineNum">     825 </span>            : AliMUONCalibrationData::CreateNeighbours(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     826 </span>            : {
<span class="lineNum">     827 </span>            :   /// Create a neighbour store from the OCDB for a given run
<span class="lineNum">     828 </span><span class="lineCov">          8 :   return dynamic_cast&lt;AliMUONVStore*&gt;(CreateObject(runNumber,&quot;MUON/Calib/Neighbours&quot;,startOfValidity));</span>
<span class="lineNum">     829 </span>            : }
<span class="lineNum">     830 </span>            : 
<a name="831"><span class="lineNum">     831 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     832 </span>            : TObject*
<span class="lineNum">     833 </span>            : AliMUONCalibrationData::CreateObject(Int_t runNumber, const char* path, Int_t* startOfValidity)
<span class="lineNum">     834 </span>            : {
<span class="lineNum">     835 </span>            :   /// Access the CDB for a given path (e.g. MUON/Calib/Pedestals),
<span class="lineNum">     836 </span>            :   /// and return the corresponding TObject.
<span class="lineNum">     837 </span>            : 
<span class="lineNum">     838 </span><span class="lineCov">         52 :   AliCodeTimerAutoClass(Form(&quot;%09d : %s&quot;,runNumber,path),0);</span>
<span class="lineNum">     839 </span>            : 
<span class="lineNum">     840 </span><span class="lineCov">         26 :   AliCDBManager* man = AliCDBManager::Instance();</span>
<span class="lineNum">     841 </span>            : 
<span class="lineNum">     842 </span><span class="lineCov">         78 :   AliCDBEntry* entry =  man-&gt;Get(path,runNumber);</span>
<span class="lineNum">     843 </span>            : 
<span class="lineNum">     844 </span><span class="lineCov">         52 :   if (entry)</span>
<span class="lineNum">     845 </span>            :   {
<span class="lineNum">     846 </span><span class="lineCov">         52 :                 if ( startOfValidity ) *startOfValidity = entry-&gt;GetId().GetFirstRun();</span>
<span class="lineNum">     847 </span>            : 
<span class="lineNum">     848 </span><span class="lineCov">         26 :     TObject* object = entry-&gt;GetObject();</span>
<span class="lineNum">     849 </span><span class="lineCov">         26 :     if (!(man-&gt;GetCacheFlag()))</span>
<span class="lineNum">     850 </span>            :     {
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :       entry-&gt;SetOwner(kFALSE);</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :       delete entry;</span>
<span class="lineNum">     853 </span>            :     }
<span class="lineNum">     854 </span>            : //    else
<span class="lineNum">     855 </span>            : //    {
<span class="lineNum">     856 </span>            : //      entry-&gt;SetOwner(kTRUE); //FIXME : this should be done but is causing problems with RecoParams at the end of the reco : investigate why...
<span class="lineNum">     857 </span>            : //    }
<span class="lineNum">     858 </span>            :     return object;
<span class="lineNum">     859 </span>            :   }
<span class="lineNum">     860 </span>            :         else
<span class="lineNum">     861 </span>            :         {
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                 if ( startOfValidity )  *startOfValidity = AliCDBRunRange::Infinity();</span>
<span class="lineNum">     863 </span>            :   }
<span class="lineNum">     864 </span>            : 
<span class="lineNum">     865 </span>            :   {
<span class="lineNum">     866 </span>            : 
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :     AliCodeTimerAutoClass(Form(&quot;Failed to get %s for run %09d&quot;,path,runNumber),1);</span>
<span class="lineNum">     868 </span>            : 
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     870 </span>            : 
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :   return 0x0;</span>
<span class="lineNum">     872 </span><span class="lineCov">         26 : }</span>
<span class="lineNum">     873 </span>            : 
<a name="874"><span class="lineNum">     874 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     875 </span>            : AliMUONVStore*
<span class="lineNum">     876 </span>            : AliMUONCalibrationData::CreateOccupancyMap(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     877 </span>            : {
<span class="lineNum">     878 </span>            :   /// Create a new occupancy map store from the OCDB for a given run
<span class="lineNum">     879 </span><span class="lineCov">          8 :   return dynamic_cast&lt;AliMUONVStore*&gt;(CreateObject(runNumber,&quot;MUON/Calib/OccupancyMap&quot;,startOfValidity));</span>
<span class="lineNum">     880 </span>            : }
<span class="lineNum">     881 </span>            : 
<a name="882"><span class="lineNum">     882 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     883 </span>            : AliMUONRejectList*
<span class="lineNum">     884 </span>            : AliMUONCalibrationData::CreateRejectList(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     885 </span>            : {
<span class="lineNum">     886 </span>            :   /// Create a new rejectlist store from the OCDB for a given run
<span class="lineNum">     887 </span><span class="lineCov">          8 :   return dynamic_cast&lt;AliMUONRejectList*&gt;(CreateObject(runNumber,&quot;MUON/Calib/RejectList&quot;,startOfValidity));</span>
<span class="lineNum">     888 </span>            : }
<span class="lineNum">     889 </span>            : 
<a name="890"><span class="lineNum">     890 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     891 </span>            : AliMUONVStore*
<span class="lineNum">     892 </span>            : AliMUONCalibrationData::CreatePedestals(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     893 </span>            : {
<span class="lineNum">     894 </span>            :   /// Create a new pedestal store from the OCDB for a given run
<span class="lineNum">     895 </span><span class="lineCov">         12 :   return dynamic_cast&lt;AliMUONVStore*&gt;(CreateObject(runNumber,&quot;MUON/Calib/Pedestals&quot;,startOfValidity));</span>
<span class="lineNum">     896 </span>            : }
<span class="lineNum">     897 </span>            : 
<a name="898"><span class="lineNum">     898 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     899 </span>            : AliMUONVStore*
<span class="lineNum">     900 </span>            : AliMUONCalibrationData::CreateConfig(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     901 </span>            : {
<span class="lineNum">     902 </span>            :   /// Create a new config store from the OCDB for a given run
<span class="lineNum">     903 </span><span class="lineCov">          8 :   return dynamic_cast&lt;AliMUONVStore*&gt;(CreateObject(runNumber,&quot;MUON/Calib/Config&quot;,startOfValidity));</span>
<span class="lineNum">     904 </span>            : }
<span class="lineNum">     905 </span>            : 
<span class="lineNum">     906 </span>            : 
<a name="907"><span class="lineNum">     907 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     908 </span>            : AliMUONRegionalTriggerConfig*
<span class="lineNum">     909 </span>            : AliMUONCalibrationData::CreateRegionalTriggerConfig(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     910 </span>            : {
<span class="lineNum">     911 </span>            :   /// Create the internal store for RegionalTriggerConfig from OCDB
<span class="lineNum">     912 </span>            : 
<span class="lineNum">     913 </span><span class="lineCov">         12 :   return dynamic_cast&lt;AliMUONRegionalTriggerConfig*&gt;(CreateObject(runNumber,&quot;MUON/Calib/RegionalTriggerConfig&quot;,startOfValidity));</span>
<span class="lineNum">     914 </span>            : }
<span class="lineNum">     915 </span>            : 
<a name="916"><span class="lineNum">     916 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     917 </span>            : AliMUONTriggerEfficiencyCells*
<span class="lineNum">     918 </span>            : AliMUONCalibrationData::CreateTriggerEfficiency(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     919 </span>            : {
<span class="lineNum">     920 </span>            :   /// Create trigger efficiency object from OCBD
<span class="lineNum">     921 </span>            : 
<span class="lineNum">     922 </span><span class="lineCov">          4 :   return dynamic_cast&lt;AliMUONTriggerEfficiencyCells*&gt;(CreateObject(runNumber,&quot;MUON/Calib/TriggerEfficiency&quot;,startOfValidity));</span>
<span class="lineNum">     923 </span>            : }
<span class="lineNum">     924 </span>            : 
<a name="925"><span class="lineNum">     925 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     926 </span>            : AliMUONTriggerLut*
<span class="lineNum">     927 </span>            : AliMUONCalibrationData::CreateTriggerLut(Int_t runNumber, Int_t* startOfValidity)
<span class="lineNum">     928 </span>            : {
<span class="lineNum">     929 </span>            :   /// Create trigger LUT from OCDB
<span class="lineNum">     930 </span>            : 
<span class="lineNum">     931 </span><span class="lineCov">         12 :   return dynamic_cast&lt;AliMUONTriggerLut*&gt;(CreateObject(runNumber,&quot;MUON/Calib/TriggerLut&quot;,startOfValidity));</span>
<span class="lineNum">     932 </span>            : }
<a name="933"><span class="lineNum">     933 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     934 </span>            : AliMUONGlobalCrateConfig*
<span class="lineNum">     935 </span>            : AliMUONCalibrationData::GlobalTriggerCrateConfig() const
<span class="lineNum">     936 </span>            : {
<span class="lineNum">     937 </span>            :   /// Return the config for the global trigger board.
<span class="lineNum">     938 </span>            : 
<span class="lineNum">     939 </span><span class="lineCov">         12 :   if (!fGlobalTriggerCrateConfig)</span>
<span class="lineNum">     940 </span>            :   {
<span class="lineNum">     941 </span><span class="lineCov">          3 :     fGlobalTriggerCrateConfig = CreateGlobalTriggerCrateConfig(fRunNumber);</span>
<span class="lineNum">     942 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">     943 </span><span class="lineCov">          6 :   return fGlobalTriggerCrateConfig;</span>
<span class="lineNum">     944 </span>            : }
<span class="lineNum">     945 </span>            : 
<span class="lineNum">     946 </span>            : 
<a name="947"><span class="lineNum">     947 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     948 </span>            : TMap*
<span class="lineNum">     949 </span>            : AliMUONCalibrationData::HV(Bool_t patched) const
<span class="lineNum">     950 </span>            : {
<span class="lineNum">     951 </span>            :   /// Return the calibration for a given (detElemId, manuId) pair
<span class="lineNum">     952 </span>            : 
<span class="lineNum">     953 </span><span class="lineCov">       1302 :   if (!fHV)</span>
<span class="lineNum">     954 </span>            :   {
<span class="lineNum">     955 </span><span class="lineCov">          2 :     fHV = CreateHV(fRunNumber,0,patched);</span>
<span class="lineNum">     956 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">     957 </span><span class="lineCov">       1302 :   return fHV;</span>
<span class="lineNum">     958 </span>            : }
<span class="lineNum">     959 </span>            : 
<a name="960"><span class="lineNum">     960 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     961 </span>            : TMap*
<span class="lineNum">     962 </span>            : AliMUONCalibrationData::LV() const
<span class="lineNum">     963 </span>            : {
<span class="lineNum">     964 </span>            :   /// Return the LV map for a given (detElemId, manuId) pair
<span class="lineNum">     965 </span>            : 
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :   if (!fLV &amp;&amp; RunNumber() &gt; 250127)</span>
<span class="lineNum">     967 </span>            :   {
<span class="lineNum">     968 </span>            :     /// LV object was only introduced at the beginning of 2016 (march ...), so we
<span class="lineNum">     969 </span>            :     /// can not require it for runs before that...
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :     fLV = CreateLV(fRunNumber);</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :   return fLV;</span>
<span class="lineNum">     973 </span>            : }
<span class="lineNum">     974 </span>            : 
<a name="975"><span class="lineNum">     975 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     976 </span>            : TMap*
<span class="lineNum">     977 </span>            : AliMUONCalibrationData::TriggerDCS() const
<span class="lineNum">     978 </span>            : {
<span class="lineNum">     979 </span>            :   /// Return the calibration for a given (detElemId, manuId) pair
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :   if (!fTriggerDCS)</span>
<span class="lineNum">     982 </span>            :   {
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :     fTriggerDCS = CreateTriggerDCS(fRunNumber);</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :   return fTriggerDCS;</span>
<span class="lineNum">     986 </span>            : }
<span class="lineNum">     987 </span>            : 
<a name="988"><span class="lineNum">     988 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">     989 </span>            : AliMUONVStore*
<span class="lineNum">     990 </span>            : AliMUONCalibrationData::Neighbours() const
<span class="lineNum">     991 </span>            : {
<span class="lineNum">     992 </span>            :   /// Create (if needed) and return the internal store for neighbours.
<span class="lineNum">     993 </span><span class="lineCov">        848 :   if (!fNeighbours)</span>
<span class="lineNum">     994 </span>            :   {
<span class="lineNum">     995 </span><span class="lineCov">          2 :     fNeighbours = CreateNeighbours(fRunNumber);</span>
<span class="lineNum">     996 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">     997 </span><span class="lineCov">        424 :   return fNeighbours;</span>
<span class="lineNum">     998 </span>            : }
<span class="lineNum">     999 </span>            : 
<a name="1000"><span class="lineNum">    1000 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1001 </span>            : AliMUONVCalibParam*
<span class="lineNum">    1002 </span>            : AliMUONCalibrationData::LocalTriggerBoardMasks(Int_t localBoardNumber) const
<span class="lineNum">    1003 </span>            : {
<span class="lineNum">    1004 </span>            : /// Return the masks for a given trigger local board.
<span class="lineNum">    1005 </span>            : 
<span class="lineNum">    1006 </span><span class="lineCov">       2904 :   if (!fLocalTriggerBoardMasks)</span>
<span class="lineNum">    1007 </span>            :   {
<span class="lineNum">    1008 </span><span class="lineCov">          3 :     fLocalTriggerBoardMasks = CreateLocalTriggerBoardMasks(fRunNumber);</span>
<span class="lineNum">    1009 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">    1010 </span>            : 
<span class="lineNum">    1011 </span><span class="lineCov">       1452 :   if ( fLocalTriggerBoardMasks )</span>
<span class="lineNum">    1012 </span>            :   {
<span class="lineNum">    1013 </span>            :     AliMUONVCalibParam* ltbm =
<span class="lineNum">    1014 </span><span class="lineCov">       1452 :       static_cast&lt;AliMUONVCalibParam*&gt;(fLocalTriggerBoardMasks-&gt;FindObject(localBoardNumber));</span>
<span class="lineNum">    1015 </span><span class="lineCov">       1452 :     if (!ltbm)</span>
<span class="lineNum">    1016 </span>            :     {
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :       AliError(Form(&quot;Could not get mask for localBoardNumber=%d&quot;,localBoardNumber));</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1019 </span>            :     return ltbm;
<span class="lineNum">    1020 </span>            :   }
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :   return 0x0;</span>
<span class="lineNum">    1022 </span><span class="lineCov">       1452 : }</span>
<span class="lineNum">    1023 </span>            : 
<a name="1024"><span class="lineNum">    1024 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1025 </span>            : AliMUONVStore*
<span class="lineNum">    1026 </span>            : AliMUONCalibrationData::OccupancyMap() const
<span class="lineNum">    1027 </span>            : {
<span class="lineNum">    1028 </span>            :   /// Get occupancy map
<span class="lineNum">    1029 </span><span class="lineCov">          8 :   if (!fOccupancyMap)</span>
<span class="lineNum">    1030 </span>            :   {
<span class="lineNum">    1031 </span><span class="lineCov">          2 :     fOccupancyMap = CreateOccupancyMap(fRunNumber);</span>
<span class="lineNum">    1032 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">    1033 </span><span class="lineCov">          4 :   return fOccupancyMap;</span>
<span class="lineNum">    1034 </span>            : }
<span class="lineNum">    1035 </span>            : 
<a name="1036"><span class="lineNum">    1036 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1037 </span>            : AliMUONRejectList*
<span class="lineNum">    1038 </span>            : AliMUONCalibrationData::RejectList() const
<span class="lineNum">    1039 </span>            : {
<span class="lineNum">    1040 </span>            :   /// Get reject list
<span class="lineNum">    1041 </span><span class="lineCov">          4 :   if (!fRejectList)</span>
<span class="lineNum">    1042 </span>            :   {
<span class="lineNum">    1043 </span><span class="lineCov">          2 :     fRejectList = CreateRejectList(fRunNumber);</span>
<span class="lineNum">    1044 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">    1045 </span><span class="lineCov">          2 :   return fRejectList;</span>
<span class="lineNum">    1046 </span>            : }
<span class="lineNum">    1047 </span>            : 
<a name="1048"><span class="lineNum">    1048 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1049 </span>            : void
<span class="lineNum">    1050 </span>            : AliMUONCalibrationData::BypassStores(AliMUONVStore* ped)
<span class="lineNum">    1051 </span>            : {
<span class="lineNum">    1052 </span>            :   /// Force the use of those pedestals
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :   fgBypassPedestals = ped;</span>
<span class="lineNum">    1054 </span>            : 
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1056 </span>            : 
<a name="1057"><span class="lineNum">    1057 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1058 </span>            : AliMUONVStore*
<span class="lineNum">    1059 </span>            : AliMUONCalibrationData::Pedestals() const
<span class="lineNum">    1060 </span>            : {
<span class="lineNum">    1061 </span>            :   /// Return pedestals
<span class="lineNum">    1062 </span>            : 
<span class="lineNum">    1063 </span><span class="lineCov">       1728 :   if (fgBypassPedestals) return fgBypassPedestals;</span>
<span class="lineNum">    1064 </span>            : 
<span class="lineNum">    1065 </span><span class="lineCov">        864 :   if (!fPedestals)</span>
<span class="lineNum">    1066 </span>            :   {
<span class="lineNum">    1067 </span><span class="lineCov">          3 :     fPedestals = CreatePedestals(fRunNumber);</span>
<span class="lineNum">    1068 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">    1069 </span><span class="lineCov">        864 :   return fPedestals;</span>
<span class="lineNum">    1070 </span><span class="lineCov">        864 : }</span>
<span class="lineNum">    1071 </span>            : 
<a name="1072"><span class="lineNum">    1072 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1073 </span>            : AliMUONVStore*
<span class="lineNum">    1074 </span>            : AliMUONCalibrationData::Config() const
<span class="lineNum">    1075 </span>            : {
<span class="lineNum">    1076 </span>            :   /// Return config
<span class="lineNum">    1077 </span>            : 
<span class="lineNum">    1078 </span><span class="lineCov">          4 :   if (!fConfig)</span>
<span class="lineNum">    1079 </span>            :   {
<span class="lineNum">    1080 </span><span class="lineCov">          2 :     fConfig = CreateConfig(fRunNumber);</span>
<span class="lineNum">    1081 </span><span class="lineCov">          2 :   }</span>
<span class="lineNum">    1082 </span><span class="lineCov">          2 :   return fConfig;</span>
<span class="lineNum">    1083 </span>            : }
<span class="lineNum">    1084 </span>            : 
<a name="1085"><span class="lineNum">    1085 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1086 </span>            : AliMUONVCalibParam*
<span class="lineNum">    1087 </span>            : AliMUONCalibrationData::Pedestals(Int_t detElemId, Int_t manuId) const
<span class="lineNum">    1088 </span>            : {
<span class="lineNum">    1089 </span>            :   /// Return the pedestals for a given (detElemId, manuId) pair.
<span class="lineNum">    1090 </span>            :   /// A return value of 0x0 is considered an error, meaning we should get
<span class="lineNum">    1091 </span>            :   /// pedestals for all channels.
<span class="lineNum">    1092 </span>            : 
<span class="lineNum">    1093 </span><span class="lineCov">       1714 :   AliMUONVStore* pedestals = Pedestals();</span>
<span class="lineNum">    1094 </span><span class="lineCov">        857 :   if (!pedestals)</span>
<span class="lineNum">    1095 </span>            :   {
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :     return 0x0;</span>
<span class="lineNum">    1097 </span>            :   }
<span class="lineNum">    1098 </span>            : 
<span class="lineNum">    1099 </span><span class="lineCov">        857 :   return static_cast&lt;AliMUONVCalibParam*&gt;(pedestals-&gt;FindObject(detElemId,manuId));</span>
<span class="lineNum">    1100 </span><span class="lineCov">        857 : }</span>
<span class="lineNum">    1101 </span>            : 
<a name="1102"><span class="lineNum">    1102 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1103 </span>            : void
<span class="lineNum">    1104 </span>            : AliMUONCalibrationData::Print(Option_t*) const
<span class="lineNum">    1105 </span>            : {
<span class="lineNum">    1106 </span>            :   /// A very basic dump of our guts.
<span class="lineNum">    1107 </span>            : 
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;RunNumber &quot; &lt;&lt; RunNumber()</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fPedestals=&quot; &lt;&lt; fPedestals</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fConfig=&quot; &lt;&lt; fConfig</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fHV=&quot; &lt;&lt; fHV</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fLV=&quot; &lt;&lt; fLV</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fTriggerDCS=&quot; &lt;&lt; fTriggerDCS</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fLocalTriggerBoardMasks=&quot; &lt;&lt; fLocalTriggerBoardMasks</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fRegionalTriggerConfig=&quot; &lt;&lt; fRegionalTriggerConfig</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fGlobalTriggerCrateConfig=&quot; &lt;&lt; fGlobalTriggerCrateConfig</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :   &lt;&lt; &quot; fTriggerLut=&quot; &lt;&lt; fTriggerLut</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :   &lt;&lt; endl;</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1120 </span>            : 
<span class="lineNum">    1121 </span>            : 
<a name="1122"><span class="lineNum">    1122 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1123 </span>            : AliMUONRegionalTriggerConfig*
<span class="lineNum">    1124 </span>            : AliMUONCalibrationData::RegionalTriggerConfig() const
<span class="lineNum">    1125 </span>            : {
<span class="lineNum">    1126 </span>            :   /// Return the config for the regional trigger board.
<span class="lineNum">    1127 </span>            : 
<span class="lineNum">    1128 </span><span class="lineCov">         24 :   if (!fRegionalTriggerConfig)</span>
<span class="lineNum">    1129 </span>            :   {
<span class="lineNum">    1130 </span><span class="lineCov">          3 :     fRegionalTriggerConfig = CreateRegionalTriggerConfig(fRunNumber);</span>
<span class="lineNum">    1131 </span><span class="lineCov">          3 :     }</span>
<span class="lineNum">    1132 </span><span class="lineCov">         12 :   return fRegionalTriggerConfig;</span>
<span class="lineNum">    1133 </span>            : }
<span class="lineNum">    1134 </span>            : 
<span class="lineNum">    1135 </span>            : 
<a name="1136"><span class="lineNum">    1136 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1137 </span>            : AliMUONTriggerEfficiencyCells*
<span class="lineNum">    1138 </span>            : AliMUONCalibrationData::TriggerEfficiency() const
<span class="lineNum">    1139 </span>            : {
<span class="lineNum">    1140 </span>            : /// Return the trigger efficiency.
<span class="lineNum">    1141 </span>            : 
<span class="lineNum">    1142 </span><span class="lineCov">          2 :   if (!fTriggerEfficiency)</span>
<span class="lineNum">    1143 </span>            :   {
<span class="lineNum">    1144 </span><span class="lineCov">          1 :     fTriggerEfficiency = CreateTriggerEfficiency(fRunNumber);</span>
<span class="lineNum">    1145 </span><span class="lineCov">          1 :   }</span>
<span class="lineNum">    1146 </span><span class="lineCov">          1 :   return fTriggerEfficiency;</span>
<span class="lineNum">    1147 </span>            : }
<span class="lineNum">    1148 </span>            : 
<span class="lineNum">    1149 </span>            : 
<a name="1150"><span class="lineNum">    1150 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1151 </span>            : AliMUONTriggerLut*
<span class="lineNum">    1152 </span>            : AliMUONCalibrationData::TriggerLut() const
<span class="lineNum">    1153 </span>            : {
<span class="lineNum">    1154 </span>            : /// Return the trigger look up table.
<span class="lineNum">    1155 </span>            : 
<span class="lineNum">    1156 </span><span class="lineCov">         12 :   if (!fTriggerLut)</span>
<span class="lineNum">    1157 </span>            :   {
<span class="lineNum">    1158 </span><span class="lineCov">          3 :     fTriggerLut = CreateTriggerLut(fRunNumber);</span>
<span class="lineNum">    1159 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">    1160 </span><span class="lineCov">          6 :   return fTriggerLut;</span>
<span class="lineNum">    1161 </span>            : }
<span class="lineNum">    1162 </span>            : 
<a name="1163"><span class="lineNum">    1163 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1164 </span>            : void
<span class="lineNum">    1165 </span>            : AliMUONCalibrationData::Reset()
<span class="lineNum">    1166 </span>            : {
<span class="lineNum">    1167 </span>            : /// Reset all data
<span class="lineNum">    1168 </span>            : 
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :   AliCodeTimerAuto(&quot;&quot;,0);</span>
<span class="lineNum">    1170 </span>            : 
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :   delete fConfig;</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :   fConfig = 0x0;</span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :   delete fPedestals;</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :   fPedestals = 0x0;</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :   delete fHV;</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :   fHV = 0x0;</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :   delete fLV;</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :   fLV = 0x0;</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :   delete fTriggerDCS;</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :   fTriggerDCS = 0x0;</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :   delete fLocalTriggerBoardMasks;</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :   fLocalTriggerBoardMasks = 0x0;</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :   delete fRegionalTriggerConfig;</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :   fRegionalTriggerConfig = 0x0;</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :   delete fGlobalTriggerCrateConfig;</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :   fGlobalTriggerCrateConfig = 0x0;</span>
<span class="lineNum">    1187 </span>            : 
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :   delete fTriggerLut;</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :   fTriggerLut = 0x0;</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :   delete fTriggerEfficiency;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :   fTriggerEfficiency = 0x0;</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :   delete fNeighbours;</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :   fNeighbours = 0x0;</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1195 </span>            : 
<a name="1196"><span class="lineNum">    1196 </span>            : //_____________________________________________________________________________</a>
<span class="lineNum">    1197 </span>            : void
<span class="lineNum">    1198 </span>            : AliMUONCalibrationData::Check(Int_t runNumber)
<span class="lineNum">    1199 </span>            : {
<span class="lineNum">    1200 </span>            :   /// Self-check to see if we can read all data for a given run
<span class="lineNum">    1201 </span>            :   /// from the current OCDB...
<span class="lineNum">    1202 </span>            : 
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :   if ( ! CreateGlobalTriggerCrateConfig(runNumber) )</span>
<span class="lineNum">    1204 </span>            :   {
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read Trigger Crate Config&quot;);</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1207 </span>            :   else
<span class="lineNum">    1208 </span>            :   {
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;TriggerBoardMasks read OK&quot;);</span>
<span class="lineNum">    1210 </span>            :   }
<span class="lineNum">    1211 </span>            : 
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :   if ( !  CreateHV(runNumber) )</span>
<span class="lineNum">    1213 </span>            :   {
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read HV&quot;);</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1216 </span>            :   else
<span class="lineNum">    1217 </span>            :   {
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;HV read OK&quot;);</span>
<span class="lineNum">    1219 </span>            :   }
<span class="lineNum">    1220 </span>            : 
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :   if ( !  CreateLV(runNumber) )</span>
<span class="lineNum">    1222 </span>            :   {
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read LV&quot;);</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1225 </span>            :   else
<span class="lineNum">    1226 </span>            :   {
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;LV read OK&quot;);</span>
<span class="lineNum">    1228 </span>            :   }
<span class="lineNum">    1229 </span>            : 
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :   if ( !  CreateTriggerDCS(runNumber) )</span>
<span class="lineNum">    1231 </span>            :   {
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read Trigger HV and Currents&quot;);</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1234 </span>            :   else
<span class="lineNum">    1235 </span>            :   {
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;Trigger HV and Currents read OK&quot;);</span>
<span class="lineNum">    1237 </span>            :   }
<span class="lineNum">    1238 </span>            : 
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :   if ( ! CreateNeighbours(runNumber) )</span>
<span class="lineNum">    1240 </span>            :   {
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read Neighbours&quot;);</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1243 </span>            :   else
<span class="lineNum">    1244 </span>            :   {
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;Neighbours read OK&quot;);</span>
<span class="lineNum">    1246 </span>            :   }
<span class="lineNum">    1247 </span>            : 
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :   if ( !  CreateLocalTriggerBoardMasks(runNumber) )</span>
<span class="lineNum">    1249 </span>            :   {
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read LocalTriggerBoardMasks&quot;);</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1252 </span>            :   else
<span class="lineNum">    1253 </span>            :   {
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;LocalTriggerBoardMasks read OK&quot;);</span>
<span class="lineNum">    1255 </span>            :   }
<span class="lineNum">    1256 </span>            : 
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :   if ( ! CreatePedestals(runNumber) )</span>
<span class="lineNum">    1258 </span>            :   {
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read pedestals&quot;);</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1261 </span>            :   else
<span class="lineNum">    1262 </span>            :   {
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;Pedestals read OK&quot;);</span>
<span class="lineNum">    1264 </span>            :   }
<span class="lineNum">    1265 </span>            : 
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :   if ( ! CreateConfig(runNumber) )</span>
<span class="lineNum">    1267 </span>            :   {
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read config&quot;);</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1270 </span>            :   else
<span class="lineNum">    1271 </span>            :   {
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;Config read OK&quot;);</span>
<span class="lineNum">    1273 </span>            :   }
<span class="lineNum">    1274 </span>            : 
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :   if ( ! CreateRegionalTriggerConfig(runNumber) )</span>
<span class="lineNum">    1276 </span>            :   {
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read RegionalTriggerConfig&quot;);</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1279 </span>            :   else
<span class="lineNum">    1280 </span>            :   {
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;RegionalTriggerBoardMasks read OK&quot;);</span>
<span class="lineNum">    1282 </span>            :   }
<span class="lineNum">    1283 </span>            : 
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :   if ( ! CreateTriggerLut(runNumber) )</span>
<span class="lineNum">    1285 </span>            :   {
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read TriggerLut&quot;);</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1288 </span>            :   else
<span class="lineNum">    1289 </span>            :   {
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;TriggerLut read OK&quot;);</span>
<span class="lineNum">    1291 </span>            :   }
<span class="lineNum">    1292 </span>            : 
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :   if ( ! CreateTriggerEfficiency(runNumber) )</span>
<span class="lineNum">    1294 </span>            :   {
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     AliErrorClass(&quot;Could not read TriggerEfficiency&quot;);</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1297 </span>            :   else
<span class="lineNum">    1298 </span>            :   {
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :     AliInfoClass(&quot;TriggerEfficiency read OK&quot;);</span>
<span class="lineNum">    1300 </span>            :   }
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
