<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HMPID/HMPIDbase/AliHMPIDCalib.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">HMPID/HMPIDbase</a> - AliHMPIDCalib.cxx<span style="font-size: 80%;"> (source / <a href="AliHMPIDCalib.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">264</td>
            <td class="headerCovTableEntryLo">0.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">15</td>
            <td class="headerCovTableEntryLo">6.7 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : //  **************************************************************************</a>
<span class="lineNum">       2 </span>            : //  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            : //  *                                                                        *
<span class="lineNum">       4 </span>            : //  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            : //  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            : //  *                                                                        *
<span class="lineNum">       7 </span>            : //  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            : //  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            : //  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            : //  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            : //  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            : //  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            : //  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            : //  **************************************************************************
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : #include &quot;AliHMPIDCalib.h&quot; //class header
<span class="lineNum">      17 </span>            : #include &quot;AliHMPIDParam.h&quot; //class header
<span class="lineNum">      18 </span>            : #include &quot;AliHMPIDRawStream.h&quot; //class header
<span class="lineNum">      19 </span>            : #include &quot;AliHMPIDDigit.h&quot; //class header
<span class="lineNum">      20 </span>            : #include &lt;fstream&gt;
<span class="lineNum">      21 </span>            : #include &lt;TTree.h&gt;
<span class="lineNum">      22 </span>            : #include &lt;TSystem.h&gt;
<span class="lineNum">      23 </span>            : #include &lt;TTimeStamp.h&gt;
<span class="lineNum">      24 </span>            : 
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : 
<a name="27"><span class="lineNum">      27 </span>            : using std::ifstream;</a>
<span class="lineNum">      28 </span>            : using std::ofstream;
<span class="lineNum">      29 </span><span class="lineCov">         16 : ClassImp(AliHMPIDCalib) </span>
<span class="lineNum">      30 </span>            : 
<a name="31"><span class="lineNum">      31 </span>            : </a>
<span class="lineNum">      32 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">      33 </span><span class="lineNoCov">          0 : AliHMPIDCalib::AliHMPIDCalib():</span>
<span class="lineNum">      34 </span><span class="lineNoCov">          0 : faddl(0x0),</span>
<span class="lineNum">      35 </span><span class="lineNoCov">          0 : fsq(0x0),</span>
<span class="lineNum">      36 </span><span class="lineNoCov">          0 : fsq2(0x0),</span>
<span class="lineNum">      37 </span><span class="lineNoCov">          0 : fnpc(0x0),</span>
<span class="lineNum">      38 </span><span class="lineNoCov">          0 : fpedQ0(0x0),</span>
<span class="lineNum">      39 </span><span class="lineNoCov">          0 : fErr(0x0),</span>
<span class="lineNum">      40 </span><span class="lineNoCov">          0 : fPadAdc(0x0),</span>
<span class="lineNum">      41 </span><span class="lineNoCov">          0 : fIsPad(0x0),</span>
<span class="lineNum">      42 </span><span class="lineNoCov">          0 : fFile(0x0),</span>
<span class="lineNum">      43 </span><span class="lineNoCov">          0 : fLdcId(0),</span>
<span class="lineNum">      44 </span><span class="lineNoCov">          0 : fTimeStamp(0),</span>
<span class="lineNum">      45 </span><span class="lineNoCov">          0 : fRunNum(0),</span>
<span class="lineNum">      46 </span><span class="lineNoCov">          0 : fSigCut(0),</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 : fnDDLInStream(0x0),</span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 : fnDDLOutStream(0x0),</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 : fLargeHisto(kFALSE),</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 : fSelectDDL(0),</span>
<span class="lineNum">      51 </span><span class="lineNoCov">          0 : fDeadMap(0x0),</span>
<span class="lineNum">      52 </span><span class="lineNoCov">          0 : fPedMeanMap(0x0),</span>
<span class="lineNum">      53 </span><span class="lineNoCov">          0 : fPedSigMap(0x0),</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 : f1DPedMean(0x0),</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 : f1DPedSigma(0x0),</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 : fNumMaskedPads(0),</span>
<span class="lineNum">      57 </span><span class="lineNoCov">          0 : fNumDeadPads(0)</span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      59 </span>            :   //
<span class="lineNum">      60 </span>            :   //constructor
<span class="lineNum">      61 </span>            :   //
<span class="lineNum">      62 </span>            :   
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   faddl = new Bool_t[AliHMPIDRawStream::kNDDL];</span>
<span class="lineNum">      64 </span>            :   Int_t nPads =  (AliHMPIDParam::kMaxCh+1)*(AliHMPIDParam::kMaxPcx+1)*(AliHMPIDParam::kMaxPcy+1);
<span class="lineNum">      65 </span>            :  
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :   fpedQ0 = new Int_t***[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   fsq2   = new Float_t ***[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   fsq    = new Float_t ***[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   fnpc   = new Int_t ***[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :     fErr = new Int_t*[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      71 </span>            :    
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   fnDDLInStream  = new Int_t[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   fnDDLOutStream = new Int_t[AliHMPIDRawStream::kNDDL+1];</span>
<span class="lineNum">      74 </span>            : 
<span class="lineNum">      75 </span>            :   
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   for(Int_t iDDL=0;iDDL&lt;AliHMPIDRawStream::kNDDL+1;iDDL++) {</span>
<span class="lineNum">      77 </span>            :     
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :       fErr[iDDL] = new Int_t[AliHMPIDRawStream::kSumErr+1];</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     fpedQ0[iDDL] = new Int_t**[AliHMPIDRawStream::kNRows+1];</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :        fsq[iDDL] = new Float_t**[AliHMPIDRawStream::kNRows+1];</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :       fsq2[iDDL] = new Float_t**[AliHMPIDRawStream::kNRows+1];</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :       fnpc[iDDL] = new Int_t**[AliHMPIDRawStream::kNRows+1];</span>
<span class="lineNum">      83 </span>            :       
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :       for(Int_t iRow=0;iRow&lt;AliHMPIDRawStream::kNRows+1;iRow++)  {</span>
<span class="lineNum">      85 </span>            :       
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :        fpedQ0[iDDL][iRow] = new Int_t*[AliHMPIDRawStream::kNDILOGICAdd+1];</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :           fsq[iDDL][iRow] = new Float_t*[AliHMPIDRawStream::kNDILOGICAdd+1];</span>
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :          fsq2[iDDL][iRow] = new Float_t*[AliHMPIDRawStream::kNDILOGICAdd+1];</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :          fnpc[iDDL][iRow] = new Int_t*[AliHMPIDRawStream::kNDILOGICAdd+1];</span>
<span class="lineNum">      90 </span>            :       
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :         for(Int_t iDil=1;iDil&lt;AliHMPIDRawStream::kNDILOGICAdd+1;iDil++){</span>
<span class="lineNum">      92 </span>            :       
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :          fpedQ0[iDDL][iRow][iDil] = new Int_t[AliHMPIDRawStream::kNPadAdd+1];</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :            fsq2[iDDL][iRow][iDil] = new Float_t[AliHMPIDRawStream::kNPadAdd+1];</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :             fsq[iDDL][iRow][iDil] = new Float_t[AliHMPIDRawStream::kNPadAdd+1];</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :            fnpc[iDDL][iRow][iDil] = new Int_t[AliHMPIDRawStream::kNPadAdd+1];</span>
<span class="lineNum">      97 </span>            :           }//iDil
<span class="lineNum">      98 </span>            :       }//iRow
<span class="lineNum">      99 </span>            :    }//iDDL
<span class="lineNum">     100 </span>            :     
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :    for(Int_t iDDL=0;iDDL&lt;AliHMPIDRawStream::kNDDL+1;iDDL++) {</span>
<span class="lineNum">     102 </span>            :         
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :      fnDDLInStream[iDDL]=-1;</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :      fnDDLOutStream[iDDL]=-1;</span>
<span class="lineNum">     105 </span>            :       
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :      for(Int_t iErr=0;iErr&lt;AliHMPIDRawStream::kSumErr+1;iErr++)  {fErr[iDDL][iErr]=0;}</span>
<span class="lineNum">     107 </span>            :          
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :      for(Int_t iRow=0;iRow&lt;AliHMPIDRawStream::kNRows+1;iRow++) {</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :         for(Int_t iDil=1;iDil&lt;AliHMPIDRawStream::kNDILOGICAdd+1;iDil++) {</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :           for(Int_t iPad=1;iPad&lt;AliHMPIDRawStream::kNPadAdd+1;iPad++) {</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :             fpedQ0[iDDL][iRow][iDil][iPad]=0;</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :                fsq[iDDL][iRow][iDil][iPad]=0;</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :               fsq2[iDDL][iRow][iDil][iPad]=0;</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :               fnpc[iDDL][iRow][iDil][iPad]=0;</span>
<span class="lineNum">     115 </span>            :         }//iPad
<span class="lineNum">     116 </span>            :       }//iDil
<span class="lineNum">     117 </span>            :      }//iRow
<span class="lineNum">     118 </span>            :    }//iDDL
<span class="lineNum">     119 </span>            :     
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :   fPadAdc=new TH1I*[nPads];  </span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :   fIsPad=new Bool_t[nPads];  </span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :   for(Int_t np=0;np&lt;nPads;np++) {fPadAdc[np]=0x0;   fIsPad[np]=kFALSE;}</span>
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :   Init();</span>
<a name="125"><span class="lineNum">     125 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     126 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     127 </span>            : AliHMPIDCalib::~AliHMPIDCalib()
<span class="lineNum">     128 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     129 </span>            :   //
<span class="lineNum">     130 </span>            :   //destructor
<span class="lineNum">     131 </span>            :   //
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   if (faddl)     { delete [] faddl;   faddl = 0x0;  } </span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :   if (fPadAdc)   { delete [] fPadAdc; fPadAdc=0x0;  }  </span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :   if (fIsPad)    { delete [] fIsPad;  fIsPad=0x0;   }  </span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :   if (fFile)     { delete    fFile;   fFile=0x0;    }  </span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :   if (fDeadMap)  { delete    fDeadMap;fDeadMap=0x0; } </span>
<span class="lineNum">     137 </span>            :   
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :   for(Int_t iErr=0;iErr&lt;AliHMPIDRawStream::kSumErr+1;iErr++) { delete [] fErr[iErr];}  delete [] fErr;</span>
<span class="lineNum">     139 </span>            :   
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :   for(Int_t iDDL=0; iDDL&lt; AliHMPIDRawStream::kNDDL; iDDL++) </span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :    for(Int_t iRow=0;iRow&lt;AliHMPIDRawStream::kNRows+1;iRow++)         </span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :      for(Int_t iDil=1;iDil&lt;AliHMPIDRawStream::kNDILOGICAdd+1;iDil++)</span>
<span class="lineNum">     143 </span>            :       {
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :          delete [] fpedQ0[iDDL][iRow][iDil]; //del iPad</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :          delete []    fsq[iDDL][iRow][iDil]; //del iPad</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :          delete []   fsq2[iDDL][iRow][iDil]; //del iPad</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :          delete []   fnpc[iDDL][iRow][iDil]; //del iPad</span>
<span class="lineNum">     148 </span>            :        }
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :    for(Int_t iDDL=0; iDDL&lt; AliHMPIDRawStream::kNDDL; iDDL++) </span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :      for(Int_t iRow=0;iRow&lt;AliHMPIDRawStream::kNRows+1;iRow++)         </span>
<span class="lineNum">     151 </span>            :       {
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :         delete [] fpedQ0[iDDL][iRow];  //del iRow</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :           delete []  fsq[iDDL][iRow];  //del iRow</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :           delete [] fsq2[iDDL][iRow];  //del iRow</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :           delete [] fnpc[iDDL][iRow];  //del iRow</span>
<span class="lineNum">     156 </span>            :         }
<span class="lineNum">     157 </span>            :        
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :    for(Int_t iDDL=0; iDDL&lt; AliHMPIDRawStream::kNDDL; iDDL++) </span>
<span class="lineNum">     159 </span>            :    {   
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :        delete [] fpedQ0[iDDL];        //del iRow</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :          delete [] fsq2[iDDL];        //del iRow</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :          delete []  fsq[iDDL];        //del iRow</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :          delete [] fnpc[iDDL];        //del iRow</span>
<span class="lineNum">     164 </span>            :      }
<span class="lineNum">     165 </span>            :        
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :    delete [] fpedQ0;</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :    delete [] fsq2;</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :    delete [] fsq;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :    delete [] fnpc;</span>
<span class="lineNum">     170 </span>            :     
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   fpedQ0=0;    </span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :     fsq2=0;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :      fsq=0;</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     fnpc=0;</span>
<span class="lineNum">     175 </span>            :     
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   fLdcId=0;</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :   fTimeStamp=0;</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :   fRunNum=0;</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :   fSigCut=0;</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :   fLargeHisto=kFALSE;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :   fSelectDDL=0;</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :   fNumMaskedPads=0;</span>
<span class="lineNum">     183 </span>            :   
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   if (fPedMeanMap)   { delete [] fPedMeanMap; fPedMeanMap=0x0;  }  </span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   if (fPedSigMap)    { delete [] fPedSigMap;  fPedSigMap=0x0;   }  </span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :   if (f1DPedMean)    { delete [] f1DPedMean;  f1DPedMean=0x0;   }</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   if (f1DPedSigma)   { delete [] f1DPedSigma; f1DPedSigma=0x0;  }</span>
<span class="lineNum">     188 </span>            :   
<a name="189"><span class="lineNum">     189 </span><span class="lineNoCov">          0 : }//dtor</span></a>
<span class="lineNum">     190 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     191 </span>            : void AliHMPIDCalib::Init()
<span class="lineNum">     192 </span>            : {
<span class="lineNum">     193 </span>            :   //
<span class="lineNum">     194 </span>            :   //Init the q calc.
<span class="lineNum">     195 </span>            :   //Arguments: none
<span class="lineNum">     196 </span>            :   //Return: none
<span class="lineNum">     197 </span>            :   //
<span class="lineNum">     198 </span>            :     
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   fSigCut=3;  //the standard cut</span>
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            :  
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :   for(Int_t iDDL=0; iDDL&lt; AliHMPIDRawStream::kNDDL; iDDL++) </span>
<span class="lineNum">     203 </span>            :       {
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :          for(Int_t ierr=0; ierr &lt;AliHMPIDRawStream::kSumErr ; ierr++) {</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :             fErr[iDDL][ierr]=0;</span>
<span class="lineNum">     206 </span>            :             }
<span class="lineNum">     207 </span>            :         
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :         faddl[iDDL]=kFALSE;</span>
<span class="lineNum">     209 </span>            :       }//DDL
<span class="lineNum">     210 </span>            :       
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :      Int_t      nbins[4]={14, 24, 10, 48};</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :      Double_t  binmin[4]={ 0,  1,  1,  0};</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :      Double_t  binmax[4]={14, 25, 11, 48};</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :      fDeadMap = new THnSparseD(&quot;fDeadMap&quot;,&quot;Dead Channel Map&quot;,4,nbins,binmin,binmax); </span>
<span class="lineNum">     215 </span>            :      
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :    fPedMeanMap = new TH2F*[AliHMPIDParam::kMaxCh+1];</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :    fPedSigMap  = new TH2F*[AliHMPIDParam::kMaxCh+1];</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :    f1DPedMean  = new TH1F*[(AliHMPIDParam::kMaxCh+1)*(AliHMPIDParam::kMaxPc+1)];</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :    f1DPedSigma = new TH1F*[(AliHMPIDParam::kMaxCh+1)*(AliHMPIDParam::kMaxPc+1)];</span>
<span class="lineNum">     220 </span>            :    
<span class="lineNum">     221 </span>            : //   Int_t mapmin,mapmax;
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :    for(Int_t iCh=0;iCh&lt;AliHMPIDParam::kMaxCh+1;iCh++)  </span>
<span class="lineNum">     223 </span>            :    {
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :     fPedMeanMap[iCh]=new TH2F(Form(&quot;fPedMeanMap%d&quot;,iCh),Form(&quot;fPedMeanMap%d;pad x;pad y;Mean pedestal (ADC)&quot;,iCh),160, 0,160,144,0,144);fPedMeanMap[iCh]-&gt;SetStats(kFALSE);</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     fPedSigMap[iCh] =new TH2F(Form(&quot;fPedSigMap%d&quot;,iCh), Form(&quot;fPedSigMap%d;pad x;pad y;Sigma pedestal (ADC)&quot;,iCh), 160, 0,160,144,0,144);fPedSigMap[iCh]-&gt;SetStats(kFALSE);</span>
<span class="lineNum">     226 </span>            :    }
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :    for(Int_t iCh=0;iCh&lt;=AliHMPIDParam::kMaxCh;iCh++)</span>
<span class="lineNum">     228 </span>            :    {
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :     for(Int_t iFee=0;iFee&lt;6;iFee++)</span>
<span class="lineNum">     230 </span>            :      {
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :       f1DPedMean[6*iCh+iFee]  = new TH1F(Form(&quot;f1DPedMean_Ch%d_FEE_%d&quot; , iCh,iFee),Form(&quot;Mean Pedestals, RICH %d, FEE %d;Channels;Mean pedestal (ADC)&quot; ,iCh,iFee),3840,0,3840);f1DPedMean[6*iCh+iFee]-&gt;SetStats(kFALSE);</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :       f1DPedSigma[6*iCh+iFee] = new TH1F(Form(&quot;f1DPedSigma_Ch%d_FEE_%d&quot; ,iCh,iFee),Form(&quot;Sigma Pedestal, RICH %d, FEE %d;Channels;Sigma pedestal (ADC)&quot; ,iCh,iFee),3840,0,3840);f1DPedSigma[6*iCh+iFee]-&gt;SetStats(kFALSE);</span>
<span class="lineNum">     233 </span>            :      } 
<span class="lineNum">     234 </span>            :    }
<span class="lineNum">     235 </span>            :      
<a name="236"><span class="lineNum">     236 </span><span class="lineNoCov">          0 : }//Init()</span></a>
<span class="lineNum">     237 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     238 </span>            : void AliHMPIDCalib::SetRunParams(ULong_t runNum,Int_t timeStamp, Int_t ldcId)
<span class="lineNum">     239 </span>            : {
<span class="lineNum">     240 </span>            :   //  
<span class="lineNum">     241 </span>            :   //Set run parameters for the Pedestal and Error Files
<span class="lineNum">     242 </span>            :   //Arguments: run number, time stamp and LDC Id
<span class="lineNum">     243 </span>            :   //Returns: none
<span class="lineNum">     244 </span>            :   //
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :   fRunNum=(Int_t)runNum;</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   fTimeStamp=timeStamp;</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :   fLdcId=ldcId;</span>
<a name="248"><span class="lineNum">     248 </span><span class="lineNoCov">          0 : }//SetRunParams()</span></a>
<span class="lineNum">     249 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     250 </span>            : void AliHMPIDCalib::SetSigCutFromFile(TString hmpInFile)
<span class="lineNum">     251 </span>            : {
<span class="lineNum">     252 </span>            :   //
<span class="lineNum">     253 </span>            :   //Set Sigma Cut from the file on the LDC, if the input file is not present default value is set!
<span class="lineNum">     254 </span>            :   //Arguments: the name of the SigmaCut file on the LDC
<span class="lineNum">     255 </span>            :   //Returns: none
<span class="lineNum">     256 </span>            :   //
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :   Int_t nSigCut=0;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :   ifstream infile(hmpInFile.Data());</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :   if(!infile.is_open()) {fSigCut=3; return;}</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :   while(!infile.eof())</span>
<span class="lineNum">     261 </span>            :     {
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :     infile&gt;&gt;nSigCut;</span>
<span class="lineNum">     263 </span>            :   }
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   infile.close();</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :   if(nSigCut&lt; 0 || nSigCut &gt; 15 ) {Printf(&quot;WARNING: DAQ Sigma Cut from DAQ DB is out of bounds: %d, resetting it to 3!!!&quot;,nSigCut);nSigCut=3;}</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :   Printf(&quot;DAQ Sigma Cut from DAQ DB is: %d&quot;,nSigCut);</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :   fSigCut=nSigCut; </span>
<a name="268"><span class="lineNum">     268 </span><span class="lineNoCov">          0 : }//SetSigCutFromFile()    </span></a>
<span class="lineNum">     269 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     270 </span>            : void AliHMPIDCalib::SetDeadChannelMapFromFile(TString hmpInFile)
<span class="lineNum">     271 </span>            : {
<span class="lineNum">     272 </span>            :   //
<span class="lineNum">     273 </span>            :   //Set Dead Channel Map Cut from the file on the LDC, if the input file is not present default value is set!
<span class="lineNum">     274 </span>            :   //Arguments: the name of the Dead Channel Map file on the LDC
<span class="lineNum">     275 </span>            :   //Returns: none
<span class="lineNum">     276 </span>            :   //
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :   Char_t header[256];</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   Int_t ddl=0,row=0,dil=0,pad=0,ch=0,pc=0,chpadx=0,chpady=0,px=0,py=0,isitmasked=0;</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :   UInt_t dw=0;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :   Double_t bin[4];</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :   ifstream infile(hmpInFile.Data());</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :   if(!infile.is_open()) {Printf(&quot;HMPID Dead Channel Map file cannot be opened!!!! No mask is applied!!!&quot;);return;}</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   infile.getline(header,256);</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   AliHMPIDDigit dig;</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   while(!infile.eof())</span>
<span class="lineNum">     286 </span>            :     {
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     infile&gt;&gt;ch&gt;&gt;chpadx&gt;&gt;chpady&gt;&gt;isitmasked;                     //read in masked coordinates; coordinates are in the module coordinate system</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :     pc=(chpadx/80)+2*(chpady/48);                               //get PC number</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :     px=chpadx-80*(chpadx/80);                                   //get pad X in PC coordinates</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     py=chpady-48*(chpady/48);                                   //get pad Y in PC coordinates --- can we do it better??? -- just with one conversion???? clm</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     if(!dig.Set(ch,pc,px,py,0) &amp;&amp; isitmasked) {                 //in the AliHMPIDDigit:Set there is already a check if the coordinates makes sense</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :        dig.Raw(dw,ddl,row,dil,pad);</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :        bin[0]=ddl; bin[1]=row; bin[2]=dil; bin[3]=pad;</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :        fDeadMap-&gt;Fill(bin,1);</span>
<span class="lineNum">     295 </span>            :       }
<span class="lineNum">     296 </span>            :     }
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :    infile.close();</span>
<span class="lineNum">     298 </span>            :   
<a name="299"><span class="lineNum">     299 </span><span class="lineNoCov">          0 : }//SetDeadChannelMapFromFile()</span></a>
<span class="lineNum">     300 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     301 </span>            : void AliHMPIDCalib::FillPedestal(Int_t abspad,Int_t q)
<span class="lineNum">     302 </span>            : {
<span class="lineNum">     303 </span>            :   //
<span class="lineNum">     304 </span>            :   //Called from the HMPIDda and fills the pedestal values
<span class="lineNum">     305 </span>            :   //Arguments: absolute pad number as from AliHMPIDParam and q-charge
<span class="lineNum">     306 </span>            :   //Returns: none
<span class="lineNum">     307 </span>            :   //
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   if(q&lt;0) {</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :    AliError(&quot;Negative charge is read!!!!!!&quot;);</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :    return;</span>
<span class="lineNum">     311 </span>            :   }
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :   UInt_t w32;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :   Int_t nDDL=0, row=0, dil=0, adr=0;</span>
<span class="lineNum">     314 </span>            :   //The decoding (abs. pad -&gt; ddl,dil,...) is the same as in AliHMPIDDigit::Raw
<span class="lineNum">     315 </span>            :   
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :   AliHMPIDDigit dig(abspad,q);</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   dig.Raw(w32,nDDL,row,dil,adr);</span>
<span class="lineNum">     318 </span>            :   
<span class="lineNum">     319 </span>            :   //........... decoding done      
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :      if(q&gt;0) { </span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :         fsq[nDDL][row][dil][adr]+=q;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :       fsq2[nDDL][row][dil][adr]+=q*q;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :       fnpc[nDDL][row][dil][adr]++;                                                     //Count how many times the pad is good (can be different from the good DDL  count)</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :                        faddl[nDDL]=kTRUE; </span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :                      }</span>
<span class="lineNum">     327 </span>            :       else
<span class="lineNum">     328 </span>            :       {
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :         fpedQ0[nDDL][row][dil][adr]++;                                                 //Count how many times a pad charge is zero</span>
<span class="lineNum">     330 </span>            :       }
<span class="lineNum">     331 </span>            :       
<span class="lineNum">     332 </span>            :     // Int_t histocnt=0;   histocnt=(nDDL)*11520+(row-1)*480+(dil-1)*48+adr;             //Histo counter for a single DDL  
<span class="lineNum">     333 </span>            :     
<a name="334"><span class="lineNum">     334 </span><span class="lineNoCov">          0 : }//FillPedestal()</span></a>
<span class="lineNum">     335 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     336 </span>            : void AliHMPIDCalib::FillErrors(Int_t nDDL,Int_t eType, Int_t nErr)
<span class="lineNum">     337 </span>            : {
<span class="lineNum">     338 </span>            :   //
<span class="lineNum">     339 </span>            :   //Fill decoding errors from AliHMPIDRawStream
<span class="lineNum">     340 </span>            :   //Arguments: nDDL-DDL number, eType- error type as in AliHMPIDRawStream.h and the # of occurence for eType
<span class="lineNum">     341 </span>            :   //Retutns: none
<span class="lineNum">     342 </span>            :   //
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     if(nErr&lt;=0) return;</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :     if(eType &lt; 0 || eType&gt; AliHMPIDRawStream::kSumErr ) return;</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :     fErr[nDDL][eType]=fErr[nDDL][eType]+nErr;</span>
<span class="lineNum">     346 </span>            :     
<span class="lineNum">     347 </span>            :   
<a name="348"><span class="lineNum">     348 </span><span class="lineNoCov">          0 : }//FillErrors()</span></a>
<span class="lineNum">     349 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     350 </span>            : void AliHMPIDCalib::FillDDLCnt(Int_t iddl,Int_t inDDL, Int_t outDDL)
<span class="lineNum">     351 </span>            : {
<span class="lineNum">     352 </span>            :   //
<span class="lineNum">     353 </span>            :   //Fill decoding DDL check from RawStream
<span class="lineNum">     354 </span>            :   //Arguments: iddl - DDL under setting, inDDL- How many times the DDL is present in the raw stream, outDDL - How many time sthe DDL is succesfylly decoded
<span class="lineNum">     355 </span>            :   //Retutns: none
<span class="lineNum">     356 </span>            :   //
<span class="lineNum">     357 </span>            :  
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :   if(inDDL==-1) return;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :   if(fnDDLInStream[iddl]==-1) {fnDDLInStream[iddl]=0; fnDDLOutStream[iddl]=0;}</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :   fnDDLInStream[iddl]+=inDDL;</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :   fnDDLOutStream[iddl]+=outDDL;</span>
<span class="lineNum">     362 </span>            :  
<span class="lineNum">     363 </span>            :   
<a name="364"><span class="lineNum">     364 </span><span class="lineNoCov">          0 : }//FillDDLCnt()</span></a>
<span class="lineNum">     365 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     366 </span>            : Bool_t AliHMPIDCalib::WriteErrors(Int_t nDDL, Char_t* name, Int_t nEv)
<span class="lineNum">     367 </span>            : {
<span class="lineNum">     368 </span>            :   //
<span class="lineNum">     369 </span>            :   //Write decoding errors to a txt file
<span class="lineNum">     370 </span>            :   //Arguments: nDDL-DDL number, name of the error file and number of the read events
<span class="lineNum">     371 </span>            :   //Retutns: kTRUE/kFALSE
<span class="lineNum">     372 </span>            :   //  
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :   if(faddl[nDDL]==kFALSE) return kFALSE;                                                                 //if ddl is missing no error file is created</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   ofstream outerr;  outerr.open(name);                                                                   //open error file</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;RunNumber&quot;,(Int_t)fRunNum);                                                //read run number</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;LdcId&quot; ,          fLdcId);                                                 //read LDC Id</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TimeStamp&quot;,       fTimeStamp);                                             //read time stamp</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TotNumEvt&quot;,       nEv);                                                    //read number of total events processed</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TotDDLEvt&quot;,       fnDDLInStream[nDDL]);                                    //read number of bad events for DDL # nDDL processed</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;NumBadEvt&quot;,       fnDDLInStream[nDDL]-fnDDLOutStream[nDDL]);               //read number of bad events for DDL # nDDL processed</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :   outerr &lt;&lt; Form(&quot;%8s %2.2f\n&quot;,&quot;NBadE(%)&quot;,      (fnDDLInStream[nDDL]-fnDDLOutStream[nDDL])*100.0/nEv);   //read number of bad events (in %) for DDL # nDDL processed</span>
<span class="lineNum">     382 </span>            :   
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   for(Int_t  ierr=0; ierr &lt;AliHMPIDRawStream::kSumErr; ierr++) outerr &lt;&lt; Form(&quot;%2d\t&quot;,fErr[nDDL][ierr]); //write errors</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :                                                                outerr &lt;&lt; Form(&quot;\n&quot;);                     //last break</span>
<span class="lineNum">     385 </span>            :   /* write out pads with 0 charge read */
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :   for(Int_t row = 1; row &lt;= AliHMPIDRawStream::kNRows; row++){</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :     for(Int_t dil = 1; dil &lt;= AliHMPIDRawStream::kNDILOGICAdd; dil++){</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :       for(Int_t pad = 0; pad &lt; AliHMPIDRawStream::kNPadAdd; pad++){</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :         if(fpedQ0[nDDL][row][dil][pad]&gt;0) outerr&lt;&lt; Form(&quot;%2d %2d %2d %3d\n&quot;,row,dil,pad,fpedQ0[nDDL][row][dil][pad]);</span>
<span class="lineNum">     390 </span>            :       }
<span class="lineNum">     391 </span>            :     }
<span class="lineNum">     392 </span>            :   } 
<span class="lineNum">     393 </span>            :                                                                                                                                                                                        
<span class="lineNum">     394 </span>            :                                                                
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :   outerr.close();                                                                                        //write error file</span>
<span class="lineNum">     396 </span>            :   
<span class="lineNum">     397 </span>            :   return kTRUE;
<span class="lineNum">     398 </span>            :     
<a name="399"><span class="lineNum">     399 </span><span class="lineNoCov">          0 : }//FillErrors()</span></a>
<span class="lineNum">     400 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     401 </span>            : Bool_t AliHMPIDCalib::CalcPedestal(Int_t nDDL, Char_t* name, Char_t *name2,Int_t nEv)    
<span class="lineNum">     402 </span>            : {
<span class="lineNum">     403 </span>            :   //
<span class="lineNum">     404 </span>            :   //Calculate pedestal for each pad  
<span class="lineNum">     405 </span>            :   //Arguments: nDDL-DDL number, name of the pedestal file and number of the read events
<span class="lineNum">     406 </span>            :   //Retutns: kTRUE/kFALSE
<span class="lineNum">     407 </span>            :   //
<span class="lineNum">     408 </span>            :   
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   if(faddl[nDDL]==kFALSE) return kFALSE;                   //if ddl is missing no ped file is created (and also for LDC selection). Check with Paolo what he checks for?!  </span>
<span class="lineNum">     410 </span>            : 
<span class="lineNum">     411 </span>            :   Int_t feeOffset=196657;
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   ofstream feeInput; feeInput.open(Form(&quot;%s&quot;,name2));      //write thr file for Fe2C</span>
<span class="lineNum">     413 </span>            :   
<span class="lineNum">     414 </span>            :   Double_t mean=0,sigma=0, threshold=0;
<span class="lineNum">     415 </span>            :   Double_t qs2m=0,qsm2=0;
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   ofstream out;                                            //to write the pedestal text files</span>
<span class="lineNum">     417 </span>            :   Int_t inhard;
<span class="lineNum">     418 </span>            :   Int_t nEvPerPad=0;
<span class="lineNum">     419 </span>            :   Int_t pedbin=0;
<span class="lineNum">     420 </span>            :   
<span class="lineNum">     421 </span>            :   Int_t abspad,ch,pc,pcx,pcy,chX,chY,fee;
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   Int_t binSp[4]={0};</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   out.open(name);</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;RunNumber&quot;,(Int_t)fRunNum);                                                //read run number</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;LdcId&quot; ,         fLdcId);                                                  //read LDC Id</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TimeStamp&quot;,      fTimeStamp);                                              //read time stamp</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TotNumEvt&quot;,      nEv);                                                     //read number of total events processed</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;TotDDLEvt&quot;,      fnDDLInStream[nDDL]);                                     //read number of bad events for DDL # nDDL processed</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2d\n&quot;,&quot;NumBadEvt&quot;,      fnDDLInStream[nDDL]-fnDDLOutStream[nDDL]);                //read number of bad events for DDL # nDDL processed</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %2f\n&quot;,&quot;NBadE(%)&quot;,       (fnDDLInStream[nDDL]-fnDDLOutStream[nDDL])*100.0/nEv);    //read number of bad events (in %) for DDL # nDDL processed</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   out &lt;&lt; Form(&quot;%8s %d\n&quot;,&quot;#SigCut&quot;,      fSigCut);                                                    //# of sigma cuts</span>
<span class="lineNum">     432 </span>            :       
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :   for(Int_t row = 1; row &lt;= AliHMPIDRawStream::kNRows; row++){</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :     feeInput &lt;&lt; Form(&quot;0xabcdabcd \n&quot;);                                                                    //before each row we write a marker to separate the rows within a DDL                       </span>
<span class="lineNum">     435 </span>            :     
<span class="lineNum">     436 </span>            :    
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :     for(Int_t dil = 1; dil &lt;= AliHMPIDRawStream::kNDILOGICAdd; dil++){</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :       for(Int_t pad = 0; pad &lt; AliHMPIDRawStream::kNPadAdd; pad++){</span>
<span class="lineNum">     439 </span>            :         mean  = 50;sigma = 100;                                                   //init maen and sigma to a low value
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :         nEvPerPad=fnpc[nDDL][row][dil][pad];                                      //check how many times the pad was read out</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         abspad=AliHMPIDRawStream::GetPad(nDDL,row,dil,pad);                       //get the absolute oad coordinate</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :         ch=AliHMPIDParam::A2C(abspad);                                            //get chamber number</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :         pc=AliHMPIDParam::A2P(abspad);                                            //get PC number</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :         pcx=AliHMPIDParam::A2X(abspad);                                           //get pad x in PC</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :         pcy=AliHMPIDParam::A2Y(abspad);                                           //get pad y in PC</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :         chX = (pc%2)*AliHMPIDParam::kPadPcX+pcx;                                  //get pad x in Ch   </span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         chY = (pc/2)*AliHMPIDParam::kPadPcY+pcy;                                  //get pad y in Ch</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :         binSp[0]=nDDL+1;binSp[1]=row;binSp[2]=dil;binSp[3]=pad+1;                 //set dead map coordinates for check</span>
<span class="lineNum">     449 </span>            :         
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :        if(nEvPerPad &lt; 1 ) {                                                      //if the pad is bad then we assign 100  for the sigma and 50 for the mean</span>
<span class="lineNum">     451 </span>            :           mean  = AliHMPIDParam::kPadMeanZeroCharge;
<span class="lineNum">     452 </span>            :           sigma = AliHMPIDParam::kPadSigmaZeroCharge;
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :           fNumDeadPads++;</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :         else if(fDeadMap-&gt;GetBinContent(binSp)&gt;0)                                 //check if channel is masked, if yes set maksed values</span>
<span class="lineNum">     456 </span>            :         {
<span class="lineNum">     457 </span>            :           mean  = AliHMPIDParam::kPadMeanMasked;
<span class="lineNum">     458 </span>            :           sigma = AliHMPIDParam::kPadSigmaMasked;
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :           fNumMaskedPads++;</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     461 </span>            :        else{            
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :          mean = fsq[nDDL][row][dil][pad]*1.0/nEvPerPad;</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :          qs2m = fsq2[nDDL][row][dil][pad]*1.0/nEvPerPad;</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :          qsm2 = TMath::Power(fsq[nDDL][row][dil][pad]*1.0/nEvPerPad,2); </span>
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :         sigma = TMath::Sqrt(TMath::Abs(qs2m-qsm2));</span>
<span class="lineNum">     466 </span>            :         }
<span class="lineNum">     467 </span>            :         
<span class="lineNum">     468 </span>            :         //The electronics takes the 32bit int as: first 9 bits for the pedestal and the second 9 bits for threshold
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :         threshold = mean+fSigCut*sigma;                                                                    </span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :         if(mean &gt; 511.0 || threshold &gt; 511.0) {mean = AliHMPIDParam::kPadMeanMasked; threshold = AliHMPIDParam::kPadMeanMasked + 5.0 * AliHMPIDParam::kPadSigmaMasked; }</span>
<span class="lineNum">     471 </span>            :         //inhard=((Int_t(mean+fSigCut*sigma))&lt;&lt;9)+Int_t(mean);                                                 //right calculation, xchecked with Paolo 8/4/2008
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :         inhard=((Int_t(threshold))&lt;&lt;9)+Int_t(mean);                                                            //right calculation, xchecked with Paolo 8/4/2008</span>
<span class="lineNum">     473 </span>            :         
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :         out &lt;&lt; Form(&quot;%2i %2i %2i %5.3f %5.3f %4.4x \n&quot;,row,dil,pad,mean,sigma,inhard);</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :         feeInput &lt;&lt; Form(&quot;0x%4.4x\n&quot;,inhard);</span>
<span class="lineNum">     476 </span>            :         
<span class="lineNum">     477 </span>            :         // fill histograms to be exported to AMORE    
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :         fPedMeanMap[ch]-&gt;SetTitle(Form(&quot;PedMeanMap%d RunNum: %d&quot;,ch,fRunNum));</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :         fPedSigMap[ch]-&gt;SetTitle(Form(&quot;PedSigmaMap%d RunNum: %d&quot;,ch,fRunNum));</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :         fPedMeanMap[ch]-&gt;Fill(chX,chY,mean);         </span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :         fPedSigMap[ch]-&gt;Fill(chX,chY,sigma);         </span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :         if(nDDL%2==0) pedbin = (24-row)*2*480+(10-dil)*48+pad;</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :         if(nDDL%2!=0) pedbin = (row*2-1)*480+(10-dil)*48+pad;</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :         pedbin = pedbin - 3840*(pedbin/3840);</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :         fee=AliHMPIDRawStream::GetFee(nDDL,row);</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :         f1DPedMean[6*(nDDL/2)+fee]-&gt;SetTitle(Form(&quot;PedMean_Ch%d_FEE_%d RunNum: %d&quot;,ch,fee,fRunNum));</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :         f1DPedSigma[6*(nDDL/2)+fee]-&gt;SetTitle(Form(&quot;PedSigma_Ch%d_FEE_%d RunNum: %d&quot;,ch,fee,fRunNum));</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :         f1DPedMean[6*(nDDL/2)+fee]-&gt;Fill(pedbin,mean);</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :         f1DPedSigma[6*(nDDL/2)+fee]-&gt;Fill(pedbin,sigma);</span>
<span class="lineNum">     490 </span>            : 
<span class="lineNum">     491 </span>            :         }//adr==pad
<span class="lineNum">     492 </span>            :         //we have to write up to 64 not 48 in the DILOGIC since they are daisy chained!
<span class="lineNum">     493 </span>            :         //offset and format is defined for the Fe2C code
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :         for(Int_t idd=0;idd&lt;16;idd++) feeInput &lt;&lt; Form(&quot;0x%4.4x\n&quot;,idd+feeOffset);                 </span>
<span class="lineNum">     495 </span>            :       }//dil
<span class="lineNum">     496 </span>            :       
<span class="lineNum">     497 </span>            :       
<span class="lineNum">     498 </span>            :     }//row
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :     out.close();                                          //write pedestal file</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :     feeInput.close();</span>
<span class="lineNum">     501 </span>            :  
<span class="lineNum">     502 </span>            :   return kTRUE;
<span class="lineNum">     503 </span><span class="lineNoCov">          0 : }//CaclPedestal()</span>
<span class="lineNum">     504 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
