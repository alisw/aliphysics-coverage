<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - T0/T0base/AliT0QAChecker.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">T0/T0base</a> - AliT0QAChecker.cxx<span style="font-size: 80%;"> (source / <a href="AliT0QAChecker.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">27</td>
            <td class="headerCovTableEntry">503</td>
            <td class="headerCovTableEntryLo">5.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntry">16</td>
            <td class="headerCovTableEntryLo">25.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Coyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : //...
<span class="lineNum">      16 </span>            : //  Checks the quality assurance. 
<span class="lineNum">      17 </span>            : //  By comparing with reference data
<span class="lineNum">      18 </span>            : //  Skeleton for T0
<span class="lineNum">      19 </span>            : //---------------------------------------------
<span class="lineNum">      20 </span>            : //checkig without reference data:
<span class="lineNum">      21 </span>            : //for RAW QA all histograms should have approximatly the same 
<span class="lineNum">      22 </span>            : //number of entries as RefPoint
<span class="lineNum">      23 </span>            : //for Rec Points checks 
<span class="lineNum">      24 </span>            : //  - amplitude measured by 2 methos
<span class="lineNum">      25 </span>            : //  - online and offline T0 measurements
<span class="lineNum">      26 </span>            : // for ESD quality of reconstruction ( and measurements):
<span class="lineNum">      27 </span>            : // RMS of vertex and T0 less than 75ps
<span class="lineNum">      28 </span>            : //
<span class="lineNum">      29 </span>            : // Alla.Maevskaya@cern.ch   
<span class="lineNum">      30 </span>            : //...
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : // --- ROOT system ---
<span class="lineNum">      33 </span>            : #include &lt;Riostream.h&gt;
<span class="lineNum">      34 </span>            : #include &lt;TClass.h&gt;
<span class="lineNum">      35 </span>            : #include &lt;TH1F.h&gt; 
<span class="lineNum">      36 </span>            : #include &lt;TF1.h&gt; 
<span class="lineNum">      37 </span>            : #include &lt;TFitResultPtr.h&gt;
<span class="lineNum">      38 </span>            : #include &lt;TH2.h&gt; 
<span class="lineNum">      39 </span>            : #include &lt;TIterator.h&gt; 
<span class="lineNum">      40 </span>            : #include &lt;TKey.h&gt; 
<span class="lineNum">      41 </span>            : #include &lt;TFile.h&gt; 
<span class="lineNum">      42 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      43 </span>            : #include &lt;TString.h&gt;
<span class="lineNum">      44 </span>            : #include &lt;TPaveText.h&gt;
<span class="lineNum">      45 </span>            : #include &lt;TLegend.h&gt;
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : // --- Standard library ---
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : // --- AliRoot header files ---
<span class="lineNum">      50 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      51 </span>            : #include &quot;AliQAv1.h&quot;
<span class="lineNum">      52 </span>            : #include &quot;AliQAChecker.h&quot;
<span class="lineNum">      53 </span>            : #include &quot;AliCDBEntry.h&quot;
<span class="lineNum">      54 </span>            : #include &quot;AliQAManager.h&quot;
<span class="lineNum">      55 </span>            : #include &quot;AliT0QAChecker.h&quot;
<span class="lineNum">      56 </span>            : #include &quot;AliQAThresholds.h&quot;
<a name="57"><span class="lineNum">      57 </span>            : #include &quot;AliDAQ.h&quot;</a>
<span class="lineNum">      58 </span>            : 
<a name="59"><span class="lineNum">      59 </span><span class="lineCov">         20 : ClassImp(AliT0QAChecker)</span></a>
<span class="lineNum">      60 </span>            : //____________________________________________________________________________
<span class="lineNum">      61 </span>            : AliT0QAChecker::AliT0QAChecker() :
<span class="lineNum">      62 </span><span class="lineCov">          3 :   AliQACheckerBase(&quot;T0&quot;,&quot;T0 Quality Assurance Checker&quot;),</span>
<span class="lineNum">      63 </span><span class="lineCov">          3 :   fCFDErrorThreshold(0),</span>
<span class="lineNum">      64 </span><span class="lineCov">          3 :   fLEDErrorThreshold(0),</span>
<span class="lineNum">      65 </span><span class="lineCov">          3 :   fQTCErrorThreshold(0),</span>
<span class="lineNum">      66 </span><span class="lineCov">          3 :   fRatioCFDEffLEDEffErrorThreshold(1),</span>
<span class="lineNum">      67 </span><span class="lineCov">          3 :   fQTCEfficiencyErrorThreshold(0),</span>
<span class="lineNum">      68 </span><span class="lineCov">          3 :   fBCIDPeriodParam(3564),</span>
<span class="lineNum">      69 </span><span class="lineCov">          3 :   fBCIDOffsetParam(37),</span>
<span class="lineNum">      70 </span><span class="lineCov">          3 :   fBCIDBandWidthParam(10),</span>
<span class="lineNum">      71 </span><span class="lineCov">          3 :   fTZeroAPlusCErrorThreshold(2000.0),</span>
<span class="lineNum">      72 </span><span class="lineCov">          3 :   fTZeroAMinusCErrorThreshold(2000.0)</span>
<span class="lineNum">      73 </span><span class="lineCov">         15 : {</span>
<span class="lineNum">      74 </span>            :   // Standard constructor
<span class="lineNum">      75 </span><span class="lineCov">        150 :   for(Int_t i=0; i&lt;24; i++){ </span>
<span class="lineNum">      76 </span><span class="lineCov">         72 :     fMeanCFDFromGoodRunParam[i]=0; </span>
<span class="lineNum">      77 </span><span class="lineCov">         72 :     fMeanLEDFromGoodRunParam[i]=0; </span>
<span class="lineNum">      78 </span><span class="lineCov">         72 :     fMeanQTCFromGoodRunParam[i]=0; </span>
<span class="lineNum">      79 </span>            :   }
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span><span class="lineCov">          6 : }</span>
<a name="82"><span class="lineNum">      82 </span>            : </a>
<span class="lineNum">      83 </span>            : //____________________________________________________________________________
<span class="lineNum">      84 </span>            : AliT0QAChecker::AliT0QAChecker(const AliT0QAChecker&amp; qac):
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :   AliQACheckerBase(qac.GetName(), qac.GetTitle()),</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :   fCFDErrorThreshold(qac.fCFDErrorThreshold),</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :   fLEDErrorThreshold(qac.fLEDErrorThreshold),</span>
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :   fQTCErrorThreshold(qac.fQTCErrorThreshold),</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :   fRatioCFDEffLEDEffErrorThreshold(qac.fRatioCFDEffLEDEffErrorThreshold),</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :   fQTCEfficiencyErrorThreshold(qac.fQTCEfficiencyErrorThreshold),</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :   fBCIDPeriodParam(qac.fBCIDPeriodParam),</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :   fBCIDOffsetParam(qac.fBCIDOffsetParam),</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :   fBCIDBandWidthParam(qac.fBCIDBandWidthParam),</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :   fTZeroAPlusCErrorThreshold(qac.fTZeroAPlusCErrorThreshold),</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   fTZeroAMinusCErrorThreshold(qac.fTZeroAMinusCErrorThreshold)</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      97 </span>            :   // copy constructor
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :   AliError(&quot;Copy should not be used with this class\n&quot;);</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   for(Int_t i=0; i&lt;24; i++){ </span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :     fMeanCFDFromGoodRunParam[i]=qac.fMeanCFDFromGoodRunParam[i]; </span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :     fMeanLEDFromGoodRunParam[i]=qac.fMeanLEDFromGoodRunParam[i]; </span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :     fMeanQTCFromGoodRunParam[i]=qac.fMeanQTCFromGoodRunParam[i]; </span>
<span class="lineNum">     103 </span>            :   }
<span class="lineNum">     104 </span>            : 
<a name="105"><span class="lineNum">     105 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     106 </span>            : //____________________________________________________________________________
<span class="lineNum">     107 </span>            : AliT0QAChecker&amp; AliT0QAChecker::operator=(const AliT0QAChecker&amp; qac){
<span class="lineNum">     108 </span>            :   // assignment operator
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   this-&gt;~AliT0QAChecker();</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :   new(this)AliT0QAChecker(qac);</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :   return *this;</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     113 </span>            : 
<a name="114"><span class="lineNum">     114 </span>            : </a>
<span class="lineNum">     115 </span>            : //____________________________________________________________________________
<span class="lineNum">     116 </span><span class="lineNoCov">          0 : AliT0QAChecker::~AliT0QAChecker(){</span>
<span class="lineNum">     117 </span>            :   // destructor
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span><span class="lineNoCov">          0 : }</span>
<a name="120"><span class="lineNum">     120 </span>            : </a>
<span class="lineNum">     121 </span>            : //__________________________________________________________________
<span class="lineNum">     122 </span>            : void AliT0QAChecker::Check(Double_t *  test, AliQAv1::ALITASK_t index, TObjArray ** list, const AliDetectorRecoParam * /*recoParam*/)
<span class="lineNum">     123 </span>            : {
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span><span class="lineCov">         18 :   AliCDBManager* man = AliCDBManager::Instance();</span>
<span class="lineNum">     126 </span>            :   //man-&gt;SetDefaultStorage(gSystem-&gt;Getenv(&quot;AMORE_CDB_URI&quot;));
<span class="lineNum">     127 </span><span class="lineCov">          9 :   if(!man) return; </span>
<span class="lineNum">     128 </span><span class="lineCov">         18 :   AliCDBEntry* entry = man-&gt;Get(&quot;GRP/Calib/QAThresholds&quot;);</span>
<span class="lineNum">     129 </span><span class="lineCov">          9 :   if(!entry) return; </span>
<span class="lineNum">     130 </span><span class="lineCov">          9 :   TObjArray* t0branch = (TObjArray*) entry-&gt;GetObject();</span>
<span class="lineNum">     131 </span><span class="lineCov">          9 :   if(!list) return;</span>
<span class="lineNum">     132 </span><span class="lineCov">          9 :   AliQAThresholds*  thresholds = (AliQAThresholds*) t0branch-&gt;FindObject(&quot;T00&quot;);</span>
<span class="lineNum">     133 </span>            :   // here you should test that you got a non-null pointer
<span class="lineNum">     134 </span>            : 
<span class="lineNum">     135 </span><span class="lineCov">         18 :   if(!thresholds) return;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :   if(AliDAQ::DetectorID(&quot;T0&quot;)!= thresholds-&gt;GetDetectorId()){</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     AliInfo(Form(&quot;DETECTOR ID %d DOES NOT MATCH TO TZERO&quot;,thresholds-&gt;GetDetectorId()));</span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     139 </span>            :   }
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span>            :   int iparam; 
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :   for(int ipmt=0; ipmt&lt;24;ipmt++){ </span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     iparam = ipmt + 1; //current consecutive number of parameter</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :     if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ // mean CFD from a good run </span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :       fMeanCFDFromGoodRunParam[ipmt] = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     iparam = ipmt + 25;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :     if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ // mean LED from a good run </span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :       fMeanLEDFromGoodRunParam[ipmt] = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :     } </span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :     iparam = ipmt + 49;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :     if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ // mean QTC from a good run </span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :       fMeanQTCFromGoodRunParam[ipmt] = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :     } </span>
<span class="lineNum">     156 </span>            :   }
<span class="lineNum">     157 </span>            :   iparam = 73; //CFD threshold
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :     fCFDErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     161 </span>            :   iparam = 74; //LED threshold
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :     fLEDErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     165 </span>            :   iparam = 75; //QTC threshold
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :     fQTCErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     169 </span>            :  
<span class="lineNum">     170 </span>            :   iparam = 82; //Error level threshold on CFD efficiency/LED efficiency ratio
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :     fRatioCFDEffLEDEffErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     174 </span>            :   // Super-basic check on the QA histograms on the input list:
<span class="lineNum">     175 </span>            :   // look whether they are empty!
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span>            :   iparam = 83; //Error level threshold on QTC efficiency 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     fQTCEfficiencyErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     181 </span>            : 
<span class="lineNum">     182 </span>            :   iparam = 84; 
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :   if((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :     fBCIDPeriodParam = ((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span>            :   iparam = 85; 
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :   if((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :     fBCIDOffsetParam = ((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            :   iparam = 86; 
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :   if((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :     fBCIDBandWidthParam = ((TParameter&lt;int&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :   iparam = 87; 
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :     fTZeroAPlusCErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span>            :   iparam = 88; 
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   if((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam)){ </span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :     fTZeroAMinusCErrorThreshold = ((TParameter&lt;float&gt;*) thresholds-&gt;GetThreshold(iparam))-&gt;GetVal();</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :   char * detOCDBDir = Form(&quot;T0/%s/%s&quot;, AliQAv1::GetRefOCDBDirName(), AliQAv1::GetRefDataDirName()) ; </span>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :   AliCDBEntry *QARefRec = AliQAManager::QAManager()-&gt;Get(detOCDBDir);</span>
<span class="lineNum">     211 </span>            :   //  QARefRec-&gt;Dump();
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :   if( !QARefRec){</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :     AliInfo(&quot;QA reference data NOT retrieved for Reconstruction check. No T0 reference distribution&quot;);</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span>            :     
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :   for(Int_t specie = 0 ; specie &lt; AliRecoParam::kNSpecies ; specie++){ </span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :     test[specie]    = 1.0; //FK//  initiate qa flag for the whole set of histograms as good </span>
<span class="lineNum">     219 </span>            :   }
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :   for(Int_t specie = 0 ; specie &lt; AliRecoParam::kNSpecies ; specie++) {</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     if(!(AliQAv1::Instance()-&gt;IsEventSpecieSet(specie) &amp;&amp; list[specie]) || list[specie]-&gt;GetEntries() == 0) {</span>
<span class="lineNum">     224 </span>            :       continue;
<span class="lineNum">     225 </span>            :     }
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :     if(index == AliQAv1::kRAW){</span>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span>            :       //if(AliRecoParam::ConvertIndex(specie) == AliRecoParam::kCalib){//      if (index == AliQAv1::kRAW )
<span class="lineNum">     230 </span>            :         //check laser data efficiencies   
<span class="lineNum">     231 </span>            :       //  Double_t qaFlag = CheckLaser(list[specie]);
<span class="lineNum">     232 </span>            :       //  if(qaFlag &lt; test[specie]) test[specie] = qaFlag;
<span class="lineNum">     233 </span>            :       //}
<span class="lineNum">     234 </span>            : 
<span class="lineNum">     235 </span>            :       //if(//AliRecoParam::ConvertIndex(specie) == AliRecoParam::kCalib   ||
<span class="lineNum">     236 </span>            :        //  AliRecoParam::ConvertIndex(specie) == AliRecoParam::kHighMult ||
<span class="lineNum">     237 </span>            :       //   AliRecoParam::ConvertIndex(specie) == AliRecoParam::kLowMult){ 
<span class="lineNum">     238 </span>            :          //AliRecoParam::ConvertIndex(specie) == AliRecoParam::kDefault ||
<span class="lineNum">     239 </span>            :          
<span class="lineNum">     240 </span>            :         //check BCID   
<span class="lineNum">     241 </span>            :       //  Double_t qaFlag = CheckBCID(list[specie]);
<span class="lineNum">     242 </span>            :       //  if(qaFlag &lt; test[specie]) test[specie] = qaFlag;
<span class="lineNum">     243 </span>            :       //}
<span class="lineNum">     244 </span>            : 
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :       if(AliRecoParam::ConvertIndex(specie) == AliRecoParam::kHighMult ||</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         AliRecoParam::ConvertIndex(specie) == AliRecoParam::kLowMult){ </span>
<span class="lineNum">     247 </span>            :         //AliRecoParam::ConvertIndex(specie) == AliRecoParam::kDefault ||
<span class="lineNum">     248 </span>            :         //check physics 
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         Double_t qaFlag = CheckRaw(list[specie]);</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         if(qaFlag &lt; test[specie]) test[specie] = qaFlag;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     252 </span>            :     }
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :     if(index == AliQAv1::kESD &amp;&amp; AliRecoParam::Convert(specie) != AliRecoParam::kCalib){</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :       test[specie] = CheckESD(list[specie]);</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :     } </span>
<span class="lineNum">     257 </span>            :   }
<span class="lineNum">     258 </span><span class="lineCov">          9 : }</span>
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     261 </span>            : //Double_t AliT0QAChecker::CheckLaser(TObjArray *listrec) const {
<span class="lineNum">     262 </span>            : //   
<span class="lineNum">     263 </span>            : //  return 1.0; 
<span class="lineNum">     264 </span>            : //}
<a name="265"><span class="lineNum">     265 </span>            : </a>
<span class="lineNum">     266 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     267 </span>            : Double_t AliT0QAChecker::CheckRaw(TObjArray *listrec) const {
<span class="lineNum">     268 </span>            :    
<span class="lineNum">     269 </span>            :   //Fk Set drawing options for LED and CFD efficiencies from the raw data
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   TH1F *hCFDEffData = (TH1F*) listrec-&gt;UncheckedAt(207);//hRawTrigger </span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   TH1F *hLEDEffData = (TH1F*) listrec-&gt;UncheckedAt(208);//hRawTrigger </span>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span>            :   //clean objects added at previous checks
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hCFDEffData); </span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :   hCFDEffData-&gt;GetListOfFunctions()-&gt;Add((TH1D*) hLEDEffData-&gt;Clone());              </span>
<span class="lineNum">     276 </span>            : 
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :   TLegend leg(0.12,0.76,0.9,0.92,&quot; &quot;,&quot;brNDC&quot;);</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   leg.SetFillStyle(0); leg.SetBorderSize(0); leg.SetTextSize(0.04); leg.SetNColumns(2);</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :   leg.AddEntry((TH1D*) hCFDEffData,&quot;CFD&quot;,&quot;p&quot;);</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :   leg.AddEntry((TH1D*) hLEDEffData,&quot;LED&quot;,&quot;p&quot;);</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :   hCFDEffData-&gt;GetListOfFunctions()-&gt;Add((TLegend*) leg.Clone());       </span>
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span>            :   //Fk Draw CFD-mean for each PMT
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   TH2F* fhCFD = (TH2F*) listrec-&gt;UncheckedAt(210);</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   TH1F* fhCFDSubtrMean = (TH1F*) listrec-&gt;UncheckedAt(231);</span>
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) fhCFDSubtrMean); </span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :   for(int ipmt=0; ipmt&lt;24;ipmt++){ </span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     TH1F*  hProjDummy = (TH1F*) fhCFD-&gt;ProjectionY(&quot;dummy&quot;,ipmt+1,ipmt+1);</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     Float_t mean=0.0, rms=0.0;</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     GetMeanAndRmsAroundMainMaximum(mean, rms,  hProjDummy,0);</span>
<span class="lineNum">     293 </span>            : 
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :     Float_t deviation = mean - fMeanCFDFromGoodRunParam[ipmt]; </span>
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     fhCFDSubtrMean-&gt;SetBinContent(ipmt+1,deviation);</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :     fhCFDSubtrMean-&gt;SetBinError(ipmt+1,rms);</span>
<span class="lineNum">     298 </span>            :       
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :     delete hProjDummy;</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :   TLine linelowredCFD(0, fCFDErrorThreshold, 24, fCFDErrorThreshold);    </span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   linelowredCFD.SetLineColor(2);</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :   linelowredCFD.SetLineStyle(3);</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :   linelowredCFD.SetLineWidth(4);</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :   TLine linehighredCFD(0, -fCFDErrorThreshold, 24, -fCFDErrorThreshold);    </span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :   linehighredCFD.SetLineColor(2);</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :   linehighredCFD.SetLineStyle(3);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   linehighredCFD.SetLineWidth(4);</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   fhCFDSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linelowredCFD.Clone());            </span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :   fhCFDSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linehighredCFD.Clone());           </span>
<span class="lineNum">     311 </span>            : 
<span class="lineNum">     312 </span>            :  
<span class="lineNum">     313 </span>            :  
<span class="lineNum">     314 </span>            :   //Fk Draw LED-mean for each PMT
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :   TH2F* fhLED = (TH2F*) listrec-&gt;UncheckedAt(211);</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :   TH1F* fhLEDSubtrMean = (TH1F*) listrec-&gt;UncheckedAt(232);</span>
<span class="lineNum">     317 </span>            :  
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) fhLEDSubtrMean); </span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :   for(int ipmt=0; ipmt&lt;24;ipmt++){ </span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :     TH1F*  hProjDummy = (TH1F*) fhLED-&gt;ProjectionY(&quot;dummy&quot;,ipmt+1,ipmt+1);</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :     Float_t mean=0.0, rms=0.0;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :     GetMeanAndRmsAroundMainMaximum(mean, rms,  hProjDummy,1);</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :     Float_t deviation = mean - fMeanLEDFromGoodRunParam[ipmt]; </span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :     fhLEDSubtrMean-&gt;SetBinContent(ipmt+1,deviation);</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     fhLEDSubtrMean-&gt;SetBinError(ipmt+1,rms);</span>
<span class="lineNum">     327 </span>            :       
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :     delete hProjDummy;</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   TLine linelowredLED(0, fLEDErrorThreshold, 24, fLEDErrorThreshold);    </span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :   linelowredLED.SetLineColor(2);</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   linelowredLED.SetLineStyle(3);</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   linelowredLED.SetLineWidth(4);</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   TLine linehighredLED(0, -fLEDErrorThreshold, 24, -fLEDErrorThreshold);    </span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   linehighredLED.SetLineColor(2);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   linehighredLED.SetLineStyle(3);</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :   linehighredLED.SetLineWidth(4);</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :   fhLEDSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linelowredLED.Clone());            </span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :   fhLEDSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linehighredLED.Clone());           </span>
<span class="lineNum">     340 </span>            : 
<span class="lineNum">     341 </span>            :      
<span class="lineNum">     342 </span>            :   //Fk Draw QTC-mean for each PMT
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :   TH2F* fhQTC = (TH2F*) listrec-&gt;UncheckedAt(212);</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :   TH1F* fhQTCSubtrMean = (TH1F*) listrec-&gt;UncheckedAt(233);</span>
<span class="lineNum">     345 </span>            :    
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) fhQTCSubtrMean); </span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   for(int ipmt=0; ipmt&lt;24;ipmt++){ </span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :     TH1F*  hProjDummy = (TH1F*) fhQTC-&gt;ProjectionY(&quot;dummy&quot;,ipmt+1,ipmt+1);</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :     Float_t mean=0.0, rms=0.0;</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     GetMeanAndRmsAroundMainMaximum(mean, rms,  hProjDummy,2);</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :     Float_t deviation = mean - fMeanQTCFromGoodRunParam[ipmt]; </span>
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :     fhQTCSubtrMean-&gt;SetBinContent(ipmt+1,deviation);</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :     fhQTCSubtrMean-&gt;SetBinError(ipmt+1,rms);</span>
<span class="lineNum">     355 </span>            :       
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     delete hProjDummy;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :   TLine linelowredQTC(0, fQTCErrorThreshold, 24, fQTCErrorThreshold);    </span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :   linelowredQTC.SetLineColor(2);</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :   linelowredQTC.SetLineStyle(3);</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :   linelowredQTC.SetLineWidth(4);</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :   TLine linehighredQTC(0, -fQTCErrorThreshold, 24, -fQTCErrorThreshold);    </span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   linehighredQTC.SetLineColor(2);</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   linehighredQTC.SetLineStyle(3);</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   linehighredQTC.SetLineWidth(4);</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :   fhQTCSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linelowredQTC.Clone());            </span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   fhQTCSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TLine*) linehighredQTC.Clone());           </span>
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span>            :   //CFD and LED efficiency in range ~2000- ~3000 
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :   TH1F* hCFDeffSubRange = (TH1F*) listrec-&gt;UncheckedAt(237);</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   TH1F* hEffLEDSubRange = (TH1F*) listrec-&gt;UncheckedAt(238);</span>
<span class="lineNum">     372 </span>            :   // ratio CDF eff /LEF eff in subragne 
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :   TH1F* hRatioCFDLEDeff = (TH1F*) listrec-&gt;UncheckedAt(239);//FK   </span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hRatioCFDLEDeff); </span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   int npmt = hRatioCFDLEDeff-&gt;GetNbinsX();</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   for(int ipmt=1;ipmt&lt;=npmt;ipmt++){</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :     Float_t c0 = hCFDeffSubRange-&gt;GetBinContent(ipmt); </span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :     Float_t c1 = hEffLEDSubRange-&gt;GetBinContent(ipmt);</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :     if(c1){</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :       hRatioCFDLEDeff-&gt;SetBinContent(ipmt,c0/c1);  </span>
<span class="lineNum">     381 </span>            :     }else{
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :       hRatioCFDLEDeff-&gt;SetBinContent(ipmt,0);  </span>
<span class="lineNum">     383 </span>            :     }  
<span class="lineNum">     384 </span>            :   }
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :   TLine linelowredRatioCFDLEDeff(0, 1+fRatioCFDEffLEDEffErrorThreshold, 24, 1+fRatioCFDEffLEDEffErrorThreshold);    </span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :   linelowredRatioCFDLEDeff.SetLineColor(2);</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :   linelowredRatioCFDLEDeff.SetLineStyle(3);</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   linelowredRatioCFDLEDeff.SetLineWidth(4);</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :   TLine linehighredRatioCFDLEDeff(0, 1-fRatioCFDEffLEDEffErrorThreshold, 24, 1-fRatioCFDEffLEDEffErrorThreshold);    </span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   linehighredRatioCFDLEDeff.SetLineColor(2);</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :   linehighredRatioCFDLEDeff.SetLineStyle(3);</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   linehighredRatioCFDLEDeff.SetLineWidth(4);</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   hRatioCFDLEDeff-&gt;GetListOfFunctions()-&gt;Add((TLine*) linelowredRatioCFDLEDeff.Clone());        </span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :   hRatioCFDLEDeff-&gt;GetListOfFunctions()-&gt;Add((TLine*) linehighredRatioCFDLEDeff.Clone());       </span>
<span class="lineNum">     396 </span>            : 
<span class="lineNum">     397 </span>            :   //        PERFROM CHECKS on HISTOGRAMS
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span>            :   //-------- triggers -----------
<span class="lineNum">     400 </span>            :   Int_t qualityFlagTrigger = kT0Info; //init quality flag for a given histogram; 
<span class="lineNum">     401 </span>            : 
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   TH1F *hTrigger = (TH1F*) listrec-&gt;UncheckedAt(169);//hRawTrigger </span>
<span class="lineNum">     403 </span>            : 
<span class="lineNum">     404 </span>            :   // clean objects added at previous checks
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hTrigger); </span>
<span class="lineNum">     406 </span>            : 
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :   if(hTrigger-&gt;Integral()&gt;0){</span>
<span class="lineNum">     408 </span>            :     //trigger plot does have some counts in it
<span class="lineNum">     409 </span>            :     //are Mean, ORA and ORC not empty?  
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     if(/* hTrigger-&gt;GetBinContent(1)&lt;0.001 ||*/ hTrigger-&gt;GetBinContent(3)&lt;0.001 || hTrigger-&gt;GetBinContent(4)&lt;0.001){</span>
<span class="lineNum">     411 </span>            :       qualityFlagTrigger = kT0Error; //no entries on diagonal
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :       AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0: too little ORA and ORC in  %s&quot;, hTrigger-&gt;GetName() ));</span>
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :       TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;Check ORA and ORC&quot;)); </span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;Report problem to the T0 on-call expert&quot;)); </span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :       text.SetBorderSize(0);</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :       text.SetFillStyle(0);</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :       hTrigger-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());            </span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span>            :   }else{ //Trigger histo empty
<span class="lineNum">     423 </span>            : 
<span class="lineNum">     424 </span>            :     qualityFlagTrigger = kT0Error;
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hTrigger-&gt;GetName() ));</span>
<span class="lineNum">     426 </span>            : 
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;NO ENTRIES!!!&quot;)); </span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY report&quot;)); </span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;readout problem to the T0 on-call expert&quot;)); </span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :     hTrigger-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());              </span>
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     436 </span>            :   //---------- CFD eff/LED eff within subrange  -----------
<span class="lineNum">     437 </span>            :   Int_t qualityFlagRatioCFDeffLEDeff = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :   int nPMTs = hRatioCFDLEDeff-&gt;GetNbinsX(); </span>
<span class="lineNum">     439 </span>            : 
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :   for(int ipmt=1; ipmt&lt;=nPMTs; ipmt++){</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :     if(TMath::Abs( hRatioCFDLEDeff-&gt;GetBinContent(ipmt) -1) &gt; fRatioCFDEffLEDEffErrorThreshold){ //mean is expected to be around 1</span>
<span class="lineNum">     442 </span>            :       qualityFlagRatioCFDeffLEDeff = kT0Error;
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     444 </span>            :   }
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   if(qualityFlagRatioCFDeffLEDeff == kT0Error){</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;Problem with efficiency ratio CFD/LED !!!&quot;)); </span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :     hRatioCFDLEDeff-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());       </span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     454 </span>            :   
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span>            :   //---------- CFD -  mean CFD  -----------
<span class="lineNum">     457 </span>            :   Int_t qualityFlagCFDSubtr = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :   nPMTs = fhCFDSubtrMean-&gt;GetNbinsX(); </span>
<span class="lineNum">     459 </span>            : 
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :   for(int ipmt=1; ipmt&lt;=nPMTs; ipmt++){</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :     if(TMath::Abs( fhCFDSubtrMean-&gt;GetBinContent(ipmt)) &gt; fCFDErrorThreshold){</span>
<span class="lineNum">     462 </span>            :       qualityFlagCFDSubtr = kT0Error;
<span class="lineNum">     463 </span>            : 
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     465 </span>            :   }
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :   if(qualityFlagCFDSubtr == kT0Error){</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;Problem with CFD timing  !!!&quot;)); </span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :     fhCFDSubtrMean-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());        </span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     475 </span>            :   //--------- QTC efficiency ---------------
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span>            :   Int_t qualityFlagEffQTC = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :   TH1F *hEffQTC = (TH1F*) listrec-&gt;UncheckedAt(209);//hRawTrigger </span>
<span class="lineNum">     479 </span>            :   
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hEffQTC); // clean objects added at previous checks</span>
<span class="lineNum">     481 </span>            : 
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :   nPMTs = hEffQTC-&gt;GetNbinsX(); </span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :   for(int ipmt=1; ipmt&lt;=nPMTs; ipmt++){</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :     if(TMath::Abs( hEffQTC-&gt;GetBinContent(ipmt)) &lt; fQTCEfficiencyErrorThreshold){</span>
<span class="lineNum">     485 </span>            :       qualityFlagEffQTC = kT0Error;
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     487 </span>            :   }
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :   if( qualityFlagEffQTC == kT0Error){</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;Problem with QTC efficiency !!!&quot;)); </span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     hEffQTC-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());       </span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :   TLine linehighredQTCeff(0, fQTCEfficiencyErrorThreshold, 24, fQTCEfficiencyErrorThreshold);    </span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :   linehighredQTCeff.SetLineColor(2);</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :   linehighredQTCeff.SetLineStyle(3);</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :   linehighredQTCeff.SetLineWidth(4);</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :   hEffQTC-&gt;GetListOfFunctions()-&gt;Add((TLine*) linehighredQTCeff.Clone());       </span>
<span class="lineNum">     502 </span>            :  
<span class="lineNum">     503 </span>            :   //---------- BCID --------------------
<span class="lineNum">     504 </span>            :   Int_t qualityFlagBCID = kT0Info; //init quality flag for a given histogram; 
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :   TH2F *hBCID = (TH2F*) listrec-&gt;UncheckedAt(236); //BCID versus TRM  BCID</span>
<span class="lineNum">     506 </span>            :      
<span class="lineNum">     507 </span>            :   // clean objects added at previous checks
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*)hBCID);</span>
<span class="lineNum">     509 </span>            : 
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :   if(hBCID-&gt;Integral()&gt;0){</span>
<span class="lineNum">     511 </span>            :     //BCID does have some counts in it
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     Int_t nbinsX = hBCID-&gt;GetNbinsX();</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :     Int_t startX = hBCID-&gt;GetXaxis()-&gt;FindBin(100); //skip region close to orbit period</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :     Int_t nbinsY = hBCID-&gt;GetNbinsY();</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     Int_t binWidthX = (Int_t) hBCID-&gt;GetXaxis()-&gt;GetBinWidth(1);</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     Int_t binWidthY = (Int_t) hBCID-&gt;GetYaxis()-&gt;GetBinWidth(1);</span>
<span class="lineNum">     518 </span>            :     double entriesOnDiagonal  = 0; //count diagonal and off diagonal entries
<span class="lineNum">     519 </span>            :     double entriesOffDiagonal = 0;
<span class="lineNum">     520 </span>            : 
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     for(Int_t itrm=startX; itrm&lt;=nbinsX; itrm++){ //BCID TRM</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :       for(Int_t ibcid=1; ibcid&lt;=nbinsY; ibcid++){ //BCID</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :         if(TMath::Abs( (itrm*binWidthX - fBCIDOffsetParam) % fBCIDPeriodParam - binWidthY*ibcid) &lt; fBCIDBandWidthParam ){ </span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :           entriesOnDiagonal  += hBCID-&gt;GetBinContent(itrm,ibcid); //On  Diagonal</span>
<span class="lineNum">     525 </span>            :           //hBCID-&gt;Fill(itrm*binWidthX,ibcid*binWidthY,0.001); // visualize the diagonal belt
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :         }else{</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :           entriesOffDiagonal += hBCID-&gt;GetBinContent(itrm,ibcid); //Off Diagonal</span>
<span class="lineNum">     528 </span>            :         }
<span class="lineNum">     529 </span>            :       }
<span class="lineNum">     530 </span>            :     }
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :     if(entriesOnDiagonal&lt;1 || entriesOffDiagonal&gt;20){</span>
<span class="lineNum">     532 </span>            :       qualityFlagBCID = kT0Error; //no entries on diagonal
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :       AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0   %s is not diagonal&quot;, hBCID-&gt;GetName() ));</span>
<span class="lineNum">     534 </span>            : 
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :       TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;Check if entries are on diagonal&quot;)); </span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;If NOT - report readout problem to the T0 on-call expert&quot;)); </span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :       text.SetBorderSize(0);</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :       text.SetFillStyle(0);</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :       hBCID-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());       </span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :   }else{ //BCID empty</span>
<span class="lineNum">     543 </span>            : 
<span class="lineNum">     544 </span>            :     qualityFlagBCID = kT0Error;
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 :  %s has NO entries&quot;, hBCID-&gt;GetName() ));</span>
<span class="lineNum">     546 </span>            : 
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;NO ENTRIES!!!&quot;)); </span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY report&quot;)); </span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;readout problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :     hBCID-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());         </span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     555 </span>            : 
<span class="lineNum">     556 </span>            :   //--------- mean versus vertex 1st ---------
<span class="lineNum">     557 </span>            :   Int_t qualityFlagMeanVersusVertex1st = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :   TH2F *hMeanVersusVertex1st  = (TH2F*) listrec-&gt;UncheckedAt(220);  //fhMeanBest  time</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hMeanVersusVertex1st); </span>
<span class="lineNum">     560 </span>            :  
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :   if(hMeanVersusVertex1st-&gt;Integral()&lt;1){</span>
<span class="lineNum">     562 </span>            :     qualityFlagMeanVersusVertex1st = kT0Error;
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hMeanVersusVertex1st-&gt;GetName() ));</span>
<span class="lineNum">     564 </span>            : 
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;NO ENTRIES!!!&quot;)); </span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :     hMeanVersusVertex1st-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());          </span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     573 </span>            : 
<span class="lineNum">     574 </span>            : 
<span class="lineNum">     575 </span>            :   //--------- vertex TVDC on ---------
<span class="lineNum">     576 </span>            :   Int_t qualityFlagVertex1stTVDCon = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :   TH1F *hVertex1stTVDCon  = (TH1F*) listrec-&gt;UncheckedAt(223);  //fhMeanBest  time</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hVertex1stTVDCon); </span>
<span class="lineNum">     579 </span>            :  
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :   if(hVertex1stTVDCon-&gt;Integral()&lt;1){</span>
<span class="lineNum">     581 </span>            :     qualityFlagVertex1stTVDCon = kT0Error;
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hVertex1stTVDCon-&gt;GetName() ));</span>
<span class="lineNum">     583 </span>            : 
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;NO ENTRIES!!!&quot;)); </span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :     hVertex1stTVDCon-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());              </span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :   }else{</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     if(TMath::Abs(hVertex1stTVDCon-&gt;GetMean()) &gt; fTZeroAMinusCErrorThreshold){ </span>
<span class="lineNum">     593 </span>            :       qualityFlagVertex1stTVDCon = kT0Error;
<span class="lineNum">     594 </span>            : 
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :       TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;Displaced vertex&quot;)); </span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :       text.SetBorderSize(0);</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :       text.SetFillStyle(0);</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :       hVertex1stTVDCon-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());            </span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     603 </span>            :   }
<span class="lineNum">     604 </span>            : 
<span class="lineNum">     605 </span>            :   //--------- vertex TVDC off ---------
<span class="lineNum">     606 </span>            :   Int_t qualityFlagVertex1stTVDCoff = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :   TH1F *hVertex1stTVDCoff  = (TH1F*) listrec-&gt;UncheckedAt(225);  //fhMeanBest  time</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hVertex1stTVDCoff); </span>
<span class="lineNum">     609 </span>            :  
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :   if(hVertex1stTVDCoff-&gt;Integral()&lt;1){</span>
<span class="lineNum">     611 </span>            :     qualityFlagVertex1stTVDCoff = kT0Warning;
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hVertex1stTVDCoff-&gt;GetName() ));</span>
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;Warning: NO ENTRIES&quot;)); </span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :     hVertex1stTVDCoff-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());             </span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     620 </span>            : 
<span class="lineNum">     621 </span>            : 
<span class="lineNum">     622 </span>            : 
<span class="lineNum">     623 </span>            :   //----------- time TVDC on ---------
<span class="lineNum">     624 </span>            :     
<span class="lineNum">     625 </span>            :   Int_t qualityFlagMean1stTVDCon = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :   TH1F *hMean1stTVDCon  = (TH1F*) listrec-&gt;UncheckedAt(226);  //fhMeanBest  time</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hMean1stTVDCon); </span>
<span class="lineNum">     628 </span>            :  
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :   if(hMean1stTVDCon-&gt;Integral()&lt;1){</span>
<span class="lineNum">     630 </span>            :     qualityFlagMean1stTVDCon = kT0Error;
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hMean1stTVDCon-&gt;GetName() ));</span>
<span class="lineNum">     632 </span>            : 
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;NO ENTRIES!!!&quot;)); </span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     hMean1stTVDCon-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());        </span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :   }else{</span>
<span class="lineNum">     641 </span>            :     //cout&lt;&lt;&quot;Mean: &quot;&lt;&lt;TMath::Abs(hMean1stTVDCon-&gt;GetMean())&lt;&lt;&quot; threshold &quot;&lt;&lt;fTZeroAPlusCErrorThreshold&lt;&lt;endl;
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     if(TMath::Abs(hMean1stTVDCon-&gt;GetMean()) &gt; fTZeroAPlusCErrorThreshold){ </span>
<span class="lineNum">     643 </span>            :       qualityFlagMean1stTVDCon = kT0Error;
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :       TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;Shift of mean time&quot;)); </span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;If T0 is READY and beam is on report&quot;)); </span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot;the problem to the T0 on-call expert&quot;));</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :       text.SetBorderSize(0);</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :       text.SetFillStyle(0);</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :       hMean1stTVDCon-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());              </span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     653 </span>            :   }
<span class="lineNum">     654 </span>            : 
<span class="lineNum">     655 </span>            :   //----------- time TVDC off ---------
<span class="lineNum">     656 </span>            :     
<span class="lineNum">     657 </span>            :   Int_t qualityFlagMean1stTVDCoff = kT0Info; //init quality flag for a given histogram;
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :   TH1F *hMean1stTVDCoff  = (TH1F*) listrec-&gt;UncheckedAt(227);  //fhMeanBest  time</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :   EraseOldMessages((TH1*) hMean1stTVDCoff); </span>
<span class="lineNum">     660 </span>            :  
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :   if(hMean1stTVDCoff-&gt;Integral()&lt;1){</span>
<span class="lineNum">     662 </span>            :     qualityFlagMean1stTVDCoff = kT0Warning;
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;T0 histogram  %s has NO entries&quot;, hMean1stTVDCoff-&gt;GetName() ));</span>
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :     TPaveText text(0.20,0.50,0.99,0.99,&quot;NDC&quot;);   </span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;Warning: NO ENTRIES&quot;)); </span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :     text.SetBorderSize(0);</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :     text.SetFillStyle(0);</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :     hMean1stTVDCoff-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone());       </span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     671 </span>            :  
<span class="lineNum">     672 </span>            : 
<span class="lineNum">     673 </span>            : 
<span class="lineNum">     674 </span>            :   //----------------------- executive summary ---------------------
<span class="lineNum">     675 </span>            :   int lowestQualityFlag = (int) qualityFlagTrigger;
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :   if(qualityFlagRatioCFDeffLEDeff   &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagRatioCFDeffLEDeff;</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :   if(qualityFlagCFDSubtr            &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagCFDSubtr;</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :   if(qualityFlagEffQTC              &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagEffQTC;</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   if(qualityFlagMeanVersusVertex1st &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagMeanVersusVertex1st;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   if(qualityFlagBCID                &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagBCID;</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :   if(qualityFlagVertex1stTVDCon     &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagVertex1stTVDCon;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :   if(qualityFlagVertex1stTVDCoff    &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagVertex1stTVDCoff;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :   if(qualityFlagMean1stTVDCon       &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagMean1stTVDCon;</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :   if(qualityFlagMean1stTVDCoff      &lt; lowestQualityFlag)  lowestQualityFlag = qualityFlagMean1stTVDCoff;</span>
<span class="lineNum">     685 </span>            :   
<span class="lineNum">     686 </span>            : 
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :   return ConvertQualityFlagToDouble(lowestQualityFlag); </span>
<span class="lineNum">     688 </span>            :   
<span class="lineNum">     689 </span><span class="lineNoCov">          0 : }</span>
<a name="690"><span class="lineNum">     690 </span>            : </a>
<span class="lineNum">     691 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     692 </span>            : Double_t AliT0QAChecker::CheckESD(TObjArray *listrec ) const
<span class="lineNum">     693 </span>            : {
<span class="lineNum">     694 </span>            :   Float_t checkr = 0;
<span class="lineNum">     695 </span>            :   TH1 *fhESD;
<span class="lineNum">     696 </span>            :  
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :   fhESD  = (TH1*) listrec-&gt;UncheckedAt(2);</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :   if(fhESD){</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;count %s &quot;, fhESD-&gt;GetName()) );</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :      TF1 *f1 = new TF1(&quot;f1&quot;,&quot;gaus&quot;,-1,1);</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :     fhESD-&gt;Fit(&quot;f1&quot;,&quot;R&quot;,&quot;Q&quot;, -1,1);</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :     Double_t par[3];</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     f1-&gt;GetParameters(&amp;par[0]);</span>
<span class="lineNum">     704 </span>            :     
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :     TPaveText text(0.30,0.50,0.99,0.99,&quot;NDC&quot;);</span>
<span class="lineNum">     706 </span>            :     
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :     text.AddText(Form(&quot;T0 RUN %d &quot;,AliCDBManager::Instance()-&gt;GetRun()));</span>
<span class="lineNum">     708 </span>            :     
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :     AliDebug(AliQAv1::GetQADebugLevel(), Form(&quot;numentries %d mean %f  #sigma %f&quot;, (int)fhESD-&gt;GetEntries(),par[1], par[2]));</span>
<span class="lineNum">     710 </span>            :     
<span class="lineNum">     711 </span>            :     
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :     if (par[2] &gt; 0.07 &amp;&amp; par[2] &lt; 1.) {</span>
<span class="lineNum">     713 </span>            :       checkr=0.5;
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :        text.AddText(Form(&quot;not good resolution :\n %f ns\n&quot;, par[2] ));</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :        text.SetFillColor(5);</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :        printf(&quot;T0 detector resolution is not good enouph: %f ns\n&quot;,par[2] );</span>
<span class="lineNum">     717 </span>            :     }
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     if(TMath::Abs(par[1])&gt;0.05) {</span>
<span class="lineNum">     719 </span>            :       checkr = 0.5;
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot; Check clock shift on %f ns&quot;, par[1]));</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :       text.SetFillColor(5);</span>
<span class="lineNum">     722 </span>            :     }
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     if (par[2] &gt;  1. || TMath::Abs(par[1])&gt;0.1) {</span>
<span class="lineNum">     724 </span>            :       checkr = 0.25;
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :       text.AddText(Form(&quot; Bad resolution:\n mean %f ns sigma %f ns&quot;, par[1], par[2]));</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :       text.SetFillColor(2);</span>
<span class="lineNum">     727 </span>            :       { // RS Clean previous additions
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :         TList* lstF = fhESD-&gt;GetListOfFunctions();</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :         if (lstF) {</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :           TObject *stats = lstF-&gt;FindObject(&quot;stats&quot;);</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :           lstF-&gt;Remove(stats);</span>
<span class="lineNum">     732 </span>            :           TObject *obj;
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :           while ((obj = lstF-&gt;First())) {</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :             while(lstF-&gt;Remove(obj)) { }</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :             delete obj;</span>
<span class="lineNum">     736 </span>            :           }
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :           if (stats) lstF-&gt;Add(stats);</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">     739 </span>            :       }
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :       fhESD-&gt;GetListOfFunctions()-&gt;Add((TPaveText*)text.Clone()); </span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :       AliDebug(AliQAv1::GetQADebugLevel(),</span>
<span class="lineNum">     742 </span>            :                Form(&quot;Please, check calibration: shift= %f resolution %f test=%f\n&quot;,
<span class="lineNum">     743 </span>            :                     par[1], par[2], checkr) ) ; 
<span class="lineNum">     744 </span>            :     }
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     746 </span>            :   else
<span class="lineNum">     747 </span>            :     {
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :       AliDebug(AliQAv1::GetQADebugLevel(),</span>
<span class="lineNum">     749 </span>            :                Form(&quot;No ESD QA histogram found, nothing to check&quot;));
<span class="lineNum">     750 </span>            :         checkr=0;
<span class="lineNum">     751 </span>            :     }
<span class="lineNum">     752 </span>            :   
<span class="lineNum">     753 </span>            :   
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :   return checkr;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     756 </span>            : 
<a name="757"><span class="lineNum">     757 </span>            : </a>
<span class="lineNum">     758 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     759 </span>            : void AliT0QAChecker::EraseOldMessages(TH1* h) const 
<span class="lineNum">     760 </span>            : {
<span class="lineNum">     761 </span>            :   //erase the old captions 
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :   TList* lstF = h-&gt;GetListOfFunctions();</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :   if(lstF){  </span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :      TObject *stats = lstF-&gt;FindObject(&quot;stats&quot;);</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :      lstF-&gt;Remove(stats);</span>
<span class="lineNum">     766 </span>            :      TObject *obj;
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :      while ((obj = lstF-&gt;First())) {</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :        while(lstF-&gt;Remove(obj)) { }</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :          delete obj;</span>
<span class="lineNum">     770 </span>            :     }
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :     if (stats) lstF-&gt;Add(stats);</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :   }</span>
<a name="773"><span class="lineNum">     773 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     774 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     775 </span>            : Double_t AliT0QAChecker::ConvertQualityFlagToDouble(int qualityFlag) const 
<span class="lineNum">     776 </span>            : {
<span class="lineNum">     777 </span>            :   //covert quality flag to double
<span class="lineNum">     778 </span>            :   Double_t checkr=1.0;
<span class="lineNum">     779 </span>            : 
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :   switch ( qualityFlag ){</span>
<span class="lineNum">     781 </span>            :     case kT0Info:
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :         checkr = 1.0; break;</span>
<span class="lineNum">     783 </span>            :     case kT0Warning:
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :         checkr = 0.75; break;</span>
<span class="lineNum">     785 </span>            :     case kT0Error:
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :           checkr = 0.25; break;</span>
<span class="lineNum">     787 </span>            :     case kT0Fatal:
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :         checkr = -1.0; break;</span>
<span class="lineNum">     789 </span>            :     default:
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :          AliError(&quot;Invalid ecc value. FIXME !&quot;);</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :          checkr = 0.25; break;</span>
<span class="lineNum">     792 </span>            :   };
<span class="lineNum">     793 </span>            : 
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :   return checkr; </span>
<span class="lineNum">     795 </span>            : }
<a name="796"><span class="lineNum">     796 </span>            :  </a>
<span class="lineNum">     797 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     798 </span>            : Float_t AliT0QAChecker::GetMeanAboveThreshold(TH1F* hV, Float_t thr) const{
<span class="lineNum">     799 </span>            :   //caculate mean value of histo bins above threshold
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :   Int_t nBins = hV-&gt;GetNbinsX();</span>
<span class="lineNum">     801 </span>            :   Int_t nBinsAboveThr = 0; 
<span class="lineNum">     802 </span>            :   Float_t sum = 0;
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :   for(Int_t ib=1;ib&lt;=nBins;ib++){</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :     Float_t val = hV-&gt;GetBinContent(ib);</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :     if(val&lt;thr){</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :       sum+=val;</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :       nBinsAboveThr++; </span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     810 </span>            :   }
<span class="lineNum">     811 </span>            : 
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :   if(nBinsAboveThr&gt;0) return sum/nBinsAboveThr;</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :   else return hV-&gt;GetMean();</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 : }</span>
<a name="815"><span class="lineNum">     815 </span>            :     </a>
<span class="lineNum">     816 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     817 </span>            : void AliT0QAChecker::GetMeanAndRmsAroundMainMaximum(Float_t &amp;meanHisto,Float_t &amp;rmsHisto, TH1F *histo, int type) const{
<span class="lineNum">     818 </span>            : 
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :   if(!histo){</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :     meanHisto=0.0;</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     rmsHisto=0.0;</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     823 </span>            :   }
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :   if(histo-&gt;Integral()&lt;0.00001){</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :     meanHisto=0.0;</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :     rmsHisto=0.0;</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     828 </span>            :   }
<span class="lineNum">     829 </span>            : 
<span class="lineNum">     830 </span>            :   double nSigma      = 3.0; //n sigma window around mean and main maximum 
<span class="lineNum">     831 </span>            :   double expectedRMS = 13.0; // expected rms of the main peak in case of CFD
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :   if(type == 1) expectedRMS = 34.0; //LED</span>
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :   if(type == 2) expectedRMS = 34.0; //QTC</span>
<span class="lineNum">     834 </span>            : 
<span class="lineNum">     835 </span>            :   //0) approx of mean is global maximum
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :   Int_t   nb     =  histo-&gt;GetNbinsX();</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :   Int_t   bmax   =  histo-&gt;GetMaximumBin();</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :   Float_t xmax   =  histo-&gt;GetBinCenter(bmax);</span>
<span class="lineNum">     839 </span>            : 
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :   double window = expectedRMS * nSigma;</span>
<span class="lineNum">     841 </span>            :   //1) estimate a mean in the nSigma window around main max
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :   int nlow = histo-&gt;FindBin( xmax - window);</span>
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :   int nhigh = histo-&gt;FindBin( xmax + window);</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :   if(nlow&lt;1)   nlow = 1; </span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :   if(nhigh&gt;nb) nhigh = nb;</span>
<span class="lineNum">     846 </span>            : 
<span class="lineNum">     847 </span>            :   Float_t sum=0.0, sumWeight=0.0, sumWeightSqr=0.0;
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :   for(int ii=nlow;ii&lt;=nhigh;ii++){</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :     sum          += histo-&gt;GetBinContent(ii);  </span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :     sumWeight    += histo-&gt;GetBinContent(ii)*histo-&gt;GetBinCenter(ii);</span>
<span class="lineNum">     851 </span>            :   }  
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :   if(sum&gt;0.0){</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :     meanHisto = sumWeight/sum; //mean in 1st itteration</span>
<span class="lineNum">     854 </span>            :   }else{
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :     meanHisto = 0.0;</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :     rmsHisto=0.0;</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     858 </span>            :   }
<span class="lineNum">     859 </span>            :   
<span class="lineNum">     860 </span>            :   //2) recalculte mean and rms in the nSigma window around mean 1)
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :   nlow  = histo-&gt;FindBin( meanHisto - window);</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :   nhigh = histo-&gt;FindBin( meanHisto + window);</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :   if(nlow&lt;1)   nlow = 1; </span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :   if(nhigh&gt;nb) nhigh = nb;</span>
<span class="lineNum">     865 </span>            : 
<span class="lineNum">     866 </span>            :   sum=0.0; sumWeight=0.0; sumWeightSqr=0.0;
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :   for(int ii=nlow;ii&lt;=nhigh;ii++){</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     sum          += histo-&gt;GetBinContent(ii);  </span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :     sumWeight    += histo-&gt;GetBinContent(ii)*histo-&gt;GetBinCenter(ii);</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :     sumWeightSqr += histo-&gt;GetBinContent(ii)*histo-&gt;GetBinCenter(ii)*histo-&gt;GetBinCenter(ii);</span>
<span class="lineNum">     871 </span>            :   }
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :   if(sum&gt;0.0){</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :     meanHisto = sumWeight/sum; //mean in 2nd itteration</span>
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :     rmsHisto  = sumWeightSqr/sum - meanHisto*meanHisto;//rms square</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :     if(rmsHisto &gt; 0.0) rmsHisto = sqrt(rmsHisto); //rms</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :     else  rmsHisto = 0.0;</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     878 </span>            :   }else{
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     meanHisto = 0.0;</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :     rmsHisto  = 0.0;</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     882 </span>            :   }
<span class="lineNum">     883 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
