<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - EVGEN/AliGenGeVSim.cxx</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">EVGEN</a> - AliGenGeVSim.cxx<span style="font-size: 80%;"> (source / <a href="AliGenGeVSim.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">284</td>
            <td class="headerCovTableEntryLo">0.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">29</td>
            <td class="headerCovTableEntryLo">3.4 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : //
<span class="lineNum">      19 </span>            : // AliGenGeVSim is a class implementing GeVSim event generator.
<span class="lineNum">      20 </span>            : // 
<span class="lineNum">      21 </span>            : // GeVSim is a simple Monte-Carlo event generator for testing detector and 
<span class="lineNum">      22 </span>            : // algorythm performance especialy concerning flow and event-by-event studies
<span class="lineNum">      23 </span>            : //
<span class="lineNum">      24 </span>            : // In this event generator particles are generated from thermal distributions 
<span class="lineNum">      25 </span>            : // without any dynamics and addicional constrains. Distribution parameters like
<span class="lineNum">      26 </span>            : // multiplicity, particle type yields, inverse slope parameters, flow coeficients 
<span class="lineNum">      27 </span>            : // and expansion velocities are expleicite defined by the user.
<span class="lineNum">      28 </span>            : //
<span class="lineNum">      29 </span>            : // GeVSim contains four thermal distributions the same as
<span class="lineNum">      30 </span>            : // MevSim event generator developed for STAR experiment.
<span class="lineNum">      31 </span>            : //
<span class="lineNum">      32 </span>            : // In addition custom distributions can be used be the mean 
<span class="lineNum">      33 </span>            : // either two dimensional formula (TF2), a two dimensional histogram or
<span class="lineNum">      34 </span>            : // two one dimensional histograms.
<span class="lineNum">      35 </span>            : //  
<span class="lineNum">      36 </span>            : // Azimuthal distribution is deconvoluted from (Pt,Y) distribution
<span class="lineNum">      37 </span>            : // and is described by two Fourier coefficients representing 
<span class="lineNum">      38 </span>            : // Directed and Elliptic flow. 
<span class="lineNum">      39 </span>            : // 
<span class="lineNum">      40 </span>            : ////////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      41 </span>            : //
<span class="lineNum">      42 </span>            : // To apply flow to event ganerated by an arbitraly event generator
<span class="lineNum">      43 </span>            : // refer to AliGenAfterBurnerFlow class.
<span class="lineNum">      44 </span>            : //
<span class="lineNum">      45 </span>            : ////////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      46 </span>            : //
<span class="lineNum">      47 </span>            : // For examples, parameters and testing macros refer to:
<span class="lineNum">      48 </span>            : // http:/home.cern.ch/radomski
<span class="lineNum">      49 </span>            : // 
<span class="lineNum">      50 </span>            : // for more detailed description refer to ALICE NOTE
<span class="lineNum">      51 </span>            : // &quot;GeVSim Monte-Carlo Event Generator&quot;
<span class="lineNum">      52 </span>            : // S.Radosmki, P. Foka.
<span class="lineNum">      53 </span>            : //  
<span class="lineNum">      54 </span>            : // Author:
<span class="lineNum">      55 </span>            : // Sylwester Radomski,
<span class="lineNum">      56 </span>            : // GSI, March 2002
<span class="lineNum">      57 </span>            : //  
<span class="lineNum">      58 </span>            : // S.Radomski@gsi.de
<span class="lineNum">      59 </span>            : //
<span class="lineNum">      60 </span>            : ////////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      61 </span>            : //
<span class="lineNum">      62 </span>            : // Updated and revised: September 2002, S. Radomski, GSI
<span class="lineNum">      63 </span>            : //
<span class="lineNum">      64 </span>            : ////////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : #include &lt;RVersion.h&gt;
<span class="lineNum">      67 </span>            : #include &lt;Riostream.h&gt;
<span class="lineNum">      68 </span>            : #include &lt;TCanvas.h&gt;
<span class="lineNum">      69 </span>            : #include &lt;TF1.h&gt;
<span class="lineNum">      70 </span>            : #include &lt;TF2.h&gt;
<span class="lineNum">      71 </span>            : #include &lt;TH1.h&gt;
<span class="lineNum">      72 </span>            : #include &lt;TH2.h&gt;
<span class="lineNum">      73 </span>            : #include &lt;TObjArray.h&gt;
<span class="lineNum">      74 </span>            : #include &lt;TPDGCode.h&gt;
<span class="lineNum">      75 </span>            : #include &lt;TParticle.h&gt;
<span class="lineNum">      76 </span>            : #include &lt;TDatabasePDG.h&gt;
<span class="lineNum">      77 </span>            : #include &lt;TROOT.h&gt;
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : #include &quot;AliGeVSimParticle.h&quot;
<span class="lineNum">      81 </span>            : #include &quot;AliGenGeVSim.h&quot;
<span class="lineNum">      82 </span>            : #include &quot;AliGenGeVSimEventHeader.h&quot;
<span class="lineNum">      83 </span>            : #include &quot;AliGenerator.h&quot;
<span class="lineNum">      84 </span>            : #include &quot;AliRun.h&quot;
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span>            : 
<a name="87"><span class="lineNum">      87 </span>            : using std::cout;</a>
<span class="lineNum">      88 </span>            : using std::endl;
<span class="lineNum">      89 </span><span class="lineCov">          6 : ClassImp(AliGenGeVSim)</span>
<span class="lineNum">      90 </span>            : 
<a name="91"><span class="lineNum">      91 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">      92 </span>            : 
<span class="lineNum">      93 </span>            : AliGenGeVSim::AliGenGeVSim() : 
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :   AliGenerator(-1),</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   fModel(0),</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   fPsi(0),</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   fIsMultTotal(kTRUE),</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :   fPtFormula(0),</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   fYFormula(0),</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :   fPhiFormula(0),</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :   fCurrentForm(0),</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :   fPtYHist(0),</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :   fPartTypes(0) </span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     105 </span>            :   //
<span class="lineNum">     106 </span>            :   //  Default constructor
<span class="lineNum">     107 </span>            :   // 
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;4; i++)  </span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :     fPtYFormula[i] = 0;</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;2; i++)</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     fHist[i] = 0;</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     114 </span>            : 
<a name="115"><span class="lineNum">     115 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     116 </span>            : 
<span class="lineNum">     117 </span>            : AliGenGeVSim::AliGenGeVSim(Float_t psi, Bool_t isMultTotal) 
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :     : AliGenerator(-1),</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :       fModel(0),</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :       fPsi(psi),</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :       fIsMultTotal(isMultTotal),</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :       fPtFormula(0),</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :       fYFormula(0),</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :       fPhiFormula(0),</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :       fCurrentForm(0),</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :       fPtYHist(0),</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :       fPartTypes(0) </span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :  {</span>
<span class="lineNum">     129 </span>            :   //
<span class="lineNum">     130 </span>            :   //  Standard Constructor.
<span class="lineNum">     131 </span>            :   //  
<span class="lineNum">     132 </span>            :   //  models - thermal model to be used:
<span class="lineNum">     133 </span>            :   //          1    - deconvoluted pt and Y source
<span class="lineNum">     134 </span>            :   //          2,3  - thermalized sphericaly symetric sources  
<span class="lineNum">     135 </span>            :   //          4    - thermalized source with expansion
<span class="lineNum">     136 </span>            :   //          5    - custom model defined in TF2 object named &quot;gevsimPtY&quot; 
<span class="lineNum">     137 </span>            :   //          6    - custom model defined by two 1D histograms 
<span class="lineNum">     138 </span>            :   //          7    - custom model defined by 2D histogram
<span class="lineNum">     139 </span>            :   //
<span class="lineNum">     140 </span>            :   //  psi   - reaction plane in degrees
<span class="lineNum">     141 </span>            :   //  isMultTotal - multiplicity mode
<span class="lineNum">     142 </span>            :   //                kTRUE - total multiplicity (default)
<span class="lineNum">     143 </span>            :   //                kFALSE - dN/dY at midrapidity
<span class="lineNum">     144 </span>            :   // 
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span>            :   // checking consistancy
<span class="lineNum">     147 </span>            :   
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :   if (psi &lt; 0 || psi &gt; 360 ) </span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :     Error (&quot;AliGenGeVSim&quot;, &quot;Reaction plane angle ( %13.3f )out of range [0..360]&quot;, psi);</span>
<span class="lineNum">     150 </span>            : 
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   fPsi = psi * TMath::Pi() / 180. ;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   fIsMultTotal = isMultTotal;</span>
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span>            :   // Initialization 
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   fPartTypes = new TObjArray();</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   InitFormula();</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     159 </span>            : 
<a name="160"><span class="lineNum">     160 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span><span class="lineNoCov">          0 : AliGenGeVSim::~AliGenGeVSim() {</span>
<span class="lineNum">     163 </span>            :   //
<span class="lineNum">     164 </span>            :   //  Default Destructor
<span class="lineNum">     165 </span>            :   //  
<span class="lineNum">     166 </span>            :   //  Removes TObjArray keeping list of registered particle types
<span class="lineNum">     167 </span>            :   //
<span class="lineNum">     168 </span>            : 
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   if (fPartTypes != NULL) delete fPartTypes;</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     171 </span>            : 
<span class="lineNum">     172 </span>            : 
<a name="173"><span class="lineNum">     173 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span>            : Bool_t AliGenGeVSim::CheckPtYPhi(Float_t pt, Float_t y, Float_t phi) const {
<span class="lineNum">     176 </span>            :   //
<span class="lineNum">     177 </span>            :   // private function used by Generate()
<span class="lineNum">     178 </span>            :   //
<span class="lineNum">     179 </span>            :   // Check bounds of Pt, Rapidity and Azimuthal Angle of a track
<span class="lineNum">     180 </span>            :   // Used only when generating particles from a histogram
<span class="lineNum">     181 </span>            :   //
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :   if ( TestBit(kPtRange) &amp;&amp; ( pt &lt; fPtMin || pt &gt; fPtMax )) return kFALSE;</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   if ( TestBit(kPhiRange) &amp;&amp; ( phi &lt; fPhiMin || phi &gt; fPhiMax )) return kFALSE;</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   if ( TestBit(kYRange) &amp;&amp; ( y &lt; fYMin || y &gt; fYMax )) return kFALSE;</span>
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   return kTRUE;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     189 </span>            : 
<a name="190"><span class="lineNum">     190 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            : Bool_t AliGenGeVSim::CheckAcceptance(Float_t p[3]) {
<span class="lineNum">     193 </span>            :   //
<span class="lineNum">     194 </span>            :   // private function used by Generate()
<span class="lineNum">     195 </span>            :   //
<span class="lineNum">     196 </span>            :   // Check bounds of a total momentum and theta of a track
<span class="lineNum">     197 </span>            :   //
<span class="lineNum">     198 </span>            : 
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   if ( TestBit(kThetaRange) ) {</span>
<span class="lineNum">     200 </span>            :     
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :     Double_t theta = TMath::ATan2( TMath::Sqrt(p[0]*p[0]+p[1]*p[1]), p[2]);</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :     if ( theta &lt; fThetaMin || theta &gt; fThetaMax ) return kFALSE;</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span>            : 
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :   if ( TestBit(kMomentumRange) ) {</span>
<span class="lineNum">     207 </span>            :     
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :     Double_t momentum = TMath::Sqrt(p[0]*p[0] + p[1]*p[1] + p[2]*p[2]);</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :     if ( momentum &lt; fPMin || momentum &gt; fPMax) return kFALSE;</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     211 </span>            : 
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :   return kTRUE;</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span>            : //////////////////////////////////////////////////////////////////////////////////
<span class="lineNum">     216 </span>            : 
<a name="217"><span class="lineNum">     217 </span>            : // Deconvoluted Pt Y formula</a>
<span class="lineNum">     218 </span>            : 
<span class="lineNum">     219 </span>            : static Double_t aPtForm(Double_t * x, Double_t * par) {
<span class="lineNum">     220 </span>            :   // ptForm: pt -&gt; x[0] ,  mass -&gt; [0] , temperature -&gt; [1]
<span class="lineNum">     221 </span>            :   // Description as string: &quot; x * exp( -sqrt([0]*[0] + x*x) / [1] )&quot;
<span class="lineNum">     222 </span>            : 
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     return x[0] * TMath::Exp( -sqrt(par[0]*par[0] + x[0]*x[0]) / par[1]);</span>
<a name="224"><span class="lineNum">     224 </span>            :   }</a>
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span>            : static  Double_t aYForm(Double_t * x, Double_t * par) {
<span class="lineNum">     227 </span>            :   // y Form: y -&gt; x[0] , sigmaY -&gt; [0]
<span class="lineNum">     228 </span>            :   // Description as string: &quot; exp ( - x*x / (2 * [0]*[0] ) )&quot;
<span class="lineNum">     229 </span>            : 
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :     return TMath::Exp ( - x[0]*x[0] / (2 * par[0]*par[0] ) );</span>
<span class="lineNum">     231 </span>            :   }
<span class="lineNum">     232 </span>            : 
<span class="lineNum">     233 </span>            : // Models 1-3
<span class="lineNum">     234 </span>            : // Description as strings:
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span>            : //  const char *kFormE = &quot; ( sqrt([0]*[0] + x*x) * cosh(y) ) &quot;;
<span class="lineNum">     237 </span>            : //  const char *kFormG = &quot; ( 1 / sqrt( 1 - [2]*[2] ) ) &quot;;
<span class="lineNum">     238 </span>            : //  const char *kFormYp = &quot;( [2]*sqrt(([0]*[0]+x*x)*cosh(y)*cosh(y)-[0]*[0])/([1]*sqrt(1-[2]*[2]))) &quot;;
<span class="lineNum">     239 </span>            : 
<span class="lineNum">     240 </span>            : //  const char* kFormula[3] = {
<span class="lineNum">     241 </span>            : //    &quot; x * %s * exp( -%s / [1]) &quot;, 
<span class="lineNum">     242 </span>            : //    &quot; (x * %s) / ( exp( %s / [1]) - 1 ) &quot;,
<span class="lineNum">     243 </span>            : //    &quot; x*%s*exp(-%s*%s/[1])*((sinh(%s)/%s)+([1]/(%s*%s))*(sinh(%s)/%s-cosh(%s)))&quot;
<span class="lineNum">     244 </span>            : //  };
<span class="lineNum">     245 </span>            : //   printf(kFormula[0], kFormE, kFormE);
<span class="lineNum">     246 </span>            : //   printf(kFormula[1], kFormE, kFormE);
<span class="lineNum">     247 </span>            : //   printf(kFormula[2], kFormE, kFormG, kFormE, kFormYp, kFormYp, kFormG, kFormE, kFormYp, kFormYp, kFormYp);
<a name="248"><span class="lineNum">     248 </span>            : </a>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span>            : static Double_t aPtYFormula0(Double_t *x, Double_t * par) {
<span class="lineNum">     251 </span>            :   // pt -&gt; x , Y -&gt; y
<span class="lineNum">     252 </span>            :   // mass -&gt; [0] , temperature -&gt; [1] , expansion velocity -&gt; [2]
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :   Double_t aFormE = TMath::Sqrt(par[0]*par[0] + x[0]*x[0]) * TMath::CosH(x[1]);</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :   return x[0] * aFormE * TMath::Exp(-aFormE/par[1]);</span>
<a name="256"><span class="lineNum">     256 </span>            : }</a>
<span class="lineNum">     257 </span>            : 
<span class="lineNum">     258 </span>            : static Double_t aPtYFormula1(Double_t *x, Double_t * par) {
<span class="lineNum">     259 </span>            :   // pt -&gt; x , Y -&gt; y
<span class="lineNum">     260 </span>            :   // mass -&gt; [0] , temperature -&gt; [1] , expansion velocity -&gt; [2]
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :   Double_t aFormE = TMath::Sqrt(par[0]*par[0] + x[0]*x[0]) * TMath::CosH(x[1]);</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   return x[0] * aFormE / ( TMath::Exp( aFormE / par[1]) - 1 );</span>
<a name="264"><span class="lineNum">     264 </span>            : }</a>
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span>            : static Double_t aPtYFormula2(Double_t *x, Double_t * par) {
<span class="lineNum">     267 </span>            :   // pt -&gt; x , Y -&gt; y
<span class="lineNum">     268 </span>            :   // mass -&gt; [0] , temperature -&gt; [1] , expansion velocity -&gt; [2]
<span class="lineNum">     269 </span>            : 
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   Double_t aFormE = TMath::Sqrt(par[0]*par[0] + x[0]*x[0]) * TMath::CosH(x[1]);</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   Double_t aFormG = 1 / TMath::Sqrt((1.-par[2])*(1.+par[2]));</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   Double_t aFormYp = par[2]*TMath::Sqrt( (par[0]*par[0] + x[0]*x[0]) </span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :                                          * (TMath::CosH(x[1])-par[0])*(TMath::CosH(x[1])+par[0]))</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :     /( par[1]*TMath::Sqrt((1.-par[2])*(1.+par[2])));</span>
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   return x[0] * aFormE * TMath::Exp( - aFormG * aFormE / par[1])</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     *( TMath::SinH(aFormYp)/aFormYp </span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :        + par[1]/(aFormG*aFormE) </span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :        * ( TMath::SinH(aFormYp)/aFormYp-TMath::CosH(aFormYp) ) );</span>
<span class="lineNum">     280 </span>            : }
<span class="lineNum">     281 </span>            : 
<a name="282"><span class="lineNum">     282 </span>            : // Phi Flow Formula</a>
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span>            : static Double_t aPhiForm(Double_t * x, Double_t * par) {
<span class="lineNum">     285 </span>            :   // phi -&gt; x
<span class="lineNum">     286 </span>            :   // Psi -&gt; [0] , Direct Flow -&gt; [1] , Elliptical Flow -&gt; [2]
<span class="lineNum">     287 </span>            :   // Description as string: &quot; 1 + 2*[1]*cos(x-[0]) + 2*[2]*cos(2*(x-[0])) &quot;
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :   return 1 + 2*par[1]*TMath::Cos(x[0]-par[0]) </span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     + 2*par[2]*TMath::Cos(2*(x[0]-par[0]));</span>
<a name="291"><span class="lineNum">     291 </span>            : }</a>
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span>            : void AliGenGeVSim::InitFormula() {
<span class="lineNum">     294 </span>            :   //
<span class="lineNum">     295 </span>            :   // private function
<span class="lineNum">     296 </span>            :   //
<span class="lineNum">     297 </span>            :   // Initalizes formulas used in GeVSim.
<span class="lineNum">     298 </span>            : 
<span class="lineNum">     299 </span>            :   // Deconvoluted Pt Y formula
<span class="lineNum">     300 </span>            : 
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :   fPtFormula  = new TF1(&quot;gevsimPt&quot;, &amp;aPtForm, 0, 3, 2);</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   fYFormula   = new TF1(&quot;gevsimRapidity&quot;, &amp;aYForm, -3, 3,1);</span>
<span class="lineNum">     303 </span>            : 
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :   fPtFormula-&gt;SetParNames(&quot;mass&quot;, &quot;temperature&quot;);</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :   fPtFormula-&gt;SetParameters(1., 1.);</span>
<span class="lineNum">     306 </span>            :   
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :   fYFormula-&gt;SetParName(0, &quot;sigmaY&quot;);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   fYFormula-&gt;SetParameter(0, 1.);</span>
<span class="lineNum">     309 </span>            : 
<span class="lineNum">     310 </span>            :   // Grid for Pt and Y
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :   fPtFormula-&gt;SetNpx(100);</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :   fYFormula-&gt;SetNpx(100);</span>
<span class="lineNum">     313 </span>            :   
<span class="lineNum">     314 </span>            : 
<span class="lineNum">     315 </span>            :   // Models 1-3
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   fPtYFormula[0] = new TF2(&quot;gevsimPtY_2&quot;, &amp;aPtYFormula0, 0, 3, -2, 2, 2);</span>
<span class="lineNum">     318 </span>            : 
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :   fPtYFormula[1] = new TF2(&quot;gevsimPtY_3&quot;, &amp;aPtYFormula1, 0, 3, -2, 2, 2);</span>
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :   fPtYFormula[2] = new TF2(&quot;gevsimPtY_4&quot;, &amp;aPtYFormula2, 0, 3, -2, 2, 3);</span>
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   fPtYFormula[3] = 0;</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span>            : 
<span class="lineNum">     326 </span>            :   // setting names &amp; initialisation
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :   const char* kParamNames[3] = {&quot;mass&quot;, &quot;temperature&quot;, &quot;expVel&quot;};</span>
<span class="lineNum">     329 </span>            : 
<span class="lineNum">     330 </span>            :   Int_t i, j;
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :   for (i=0; i&lt;3; i++) {    </span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :     fPtYFormula[i]-&gt;SetNpx(100);        // step 30 MeV  </span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :     fPtYFormula[i]-&gt;SetNpy(100);        //</span>
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :     for (j=0; j&lt;3; j++) {</span>
<span class="lineNum">     337 </span>            : 
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :       if ( i != 2 &amp;&amp; j == 2 ) continue; // ExpVel</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :       fPtYFormula[i]-&gt;SetParName(j, kParamNames[j]);</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :       fPtYFormula[i]-&gt;SetParameter(j, 0.5);</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     342 </span>            :   }
<span class="lineNum">     343 </span>            :   
<span class="lineNum">     344 </span>            :   // Phi Flow Formula
<span class="lineNum">     345 </span>            : 
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :   fPhiFormula = new TF1(&quot;gevsimPhi&quot;, &amp;aPhiForm, 0, 2*TMath::Pi(), 3);</span>
<span class="lineNum">     347 </span>            : 
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   fPhiFormula-&gt;SetParNames(&quot;psi&quot;, &quot;directed&quot;, &quot;elliptic&quot;);</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   fPhiFormula-&gt;SetParameters(0., 0., 0.);</span>
<span class="lineNum">     350 </span>            : 
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :   fPhiFormula-&gt;SetNpx(180);</span>
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     354 </span>            : 
<a name="355"><span class="lineNum">     355 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span>            : void AliGenGeVSim::AddParticleType(AliGeVSimParticle *part) {
<span class="lineNum">     358 </span>            :   //
<span class="lineNum">     359 </span>            :   // Adds new type of particles.
<span class="lineNum">     360 </span>            :   // 
<span class="lineNum">     361 </span>            :   // Parameters are defeined in AliGeVSimParticle object
<span class="lineNum">     362 </span>            :   // This method has to be called for every particle type
<span class="lineNum">     363 </span>            :   //
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   if (fPartTypes == NULL) </span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :      fPartTypes = new TObjArray();</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :   fPartTypes-&gt;Add(part);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     370 </span>            : 
<a name="371"><span class="lineNum">     371 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     372 </span>            : 
<span class="lineNum">     373 </span>            : void AliGenGeVSim::SetMultTotal(Bool_t isTotal) {
<span class="lineNum">     374 </span>            :   //
<span class="lineNum">     375 </span>            :   //
<span class="lineNum">     376 </span>            :   //
<span class="lineNum">     377 </span>            :   
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   fIsMultTotal = isTotal;</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     380 </span>            : 
<a name="381"><span class="lineNum">     381 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span>            : Float_t AliGenGeVSim::FindScaler(Int_t paramId, Int_t pdg) {
<span class="lineNum">     384 </span>            :   //
<span class="lineNum">     385 </span>            :   // private function
<span class="lineNum">     386 </span>            :   // Finds Scallar for a given parameter.
<span class="lineNum">     387 </span>            :   // Function used in event-by-event mode.
<span class="lineNum">     388 </span>            :   //
<span class="lineNum">     389 </span>            :   // There are two types of scallars: deterministic and random
<span class="lineNum">     390 </span>            :   // and they can work on either global or particle type level.
<span class="lineNum">     391 </span>            :   // For every variable there are four scallars defined.  
<span class="lineNum">     392 </span>            :   //  
<span class="lineNum">     393 </span>            :   // Scallars are named as folowa
<span class="lineNum">     394 </span>            :   // deterministic global level : &quot;gevsimParam&quot;        (eg. &quot;gevsimTemp&quot;)
<span class="lineNum">     395 </span>            :   // deterinistig type level    : &quot;gevsimPdgParam&quot;     (eg. &quot;gevsim211Mult&quot;)
<span class="lineNum">     396 </span>            :   // random global level        : &quot;gevsimParamRndm&quot;    (eg. &quot;gevsimMultRndm&quot;)
<span class="lineNum">     397 </span>            :   // random type level          : &quot;gevsimPdgParamRndm&quot; (eg. &quot;gevsim-211V2Rndm&quot;);
<span class="lineNum">     398 </span>            :   //
<span class="lineNum">     399 </span>            :   // Pdg - code of a particle type in PDG standard (see: http://pdg.lbl.gov)
<span class="lineNum">     400 </span>            :   // Param - parameter name. Allowed parameters:
<span class="lineNum">     401 </span>            :   //
<span class="lineNum">     402 </span>            :   // &quot;Temp&quot;   - inverse slope parameter
<span class="lineNum">     403 </span>            :   // &quot;SigmaY&quot; - rapidity width - for model (1) only
<span class="lineNum">     404 </span>            :   // &quot;ExpVel&quot; - expansion velocity - for model (4) only
<span class="lineNum">     405 </span>            :   // &quot;V1&quot;     - directed flow
<span class="lineNum">     406 </span>            :   // &quot;V2&quot;     - elliptic flow
<span class="lineNum">     407 </span>            :   // &quot;Mult&quot;   - multiplicity
<span class="lineNum">     408 </span>            :   //
<span class="lineNum">     409 </span>            :   
<span class="lineNum">     410 </span>            :   
<span class="lineNum">     411 </span>            :   static const char* params[] = {&quot;Temp&quot;, &quot;SigmaY&quot;, &quot;ExpVel&quot;, &quot;V1&quot;, &quot;V2&quot;, &quot;Mult&quot;};
<span class="lineNum">     412 </span>            :   static const char* ending[] = {&quot;&quot;, &quot;Rndm&quot;};
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span>            :   static const char* patt1 = &quot;gevsim%s%s&quot;;
<span class="lineNum">     415 </span>            :   static const char* patt2 = &quot;gevsim%d%s%s&quot;;
<span class="lineNum">     416 </span>            : 
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :   char buffer[80];</span>
<span class="lineNum">     418 </span>            :   TF1 *form;
<span class="lineNum">     419 </span>            :   
<span class="lineNum">     420 </span>            :   Float_t scaler = 1.;
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span>            :   // Scaler evoluation: i - global/local, j - determ/random
<span class="lineNum">     423 </span>            : 
<span class="lineNum">     424 </span>            :   Int_t i, j;
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   for (i=0; i&lt;2; i++) {</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     for (j=0; j&lt;2; j++) {</span>
<span class="lineNum">     428 </span>            :       
<span class="lineNum">     429 </span>            :       form = 0;
<span class="lineNum">     430 </span>            :       
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :       if (i == 0) snprintf(buffer, 80, patt1, params[paramId], ending[j]);      </span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :       else snprintf(buffer, 80, patt2, pdg, params[paramId], ending[j]);</span>
<span class="lineNum">     433 </span>            :       
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :       form = (TF1 *)gROOT-&gt;GetFunction(buffer);</span>
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :       if (form != 0) {</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :         if (j == 0) scaler *= form-&gt;Eval(gAlice-&gt;GetEvNumber()); </span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         if (j == 1) {</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :           form-&gt;SetParameter(0, gAlice-&gt;GetEvNumber());</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :           scaler *= form-&gt;GetRandom();</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     442 </span>            :       }
<span class="lineNum">     443 </span>            :     }
<span class="lineNum">     444 </span>            :   }
<span class="lineNum">     445 </span>            :   
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :   return scaler;</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     448 </span>            : 
<a name="449"><span class="lineNum">     449 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span>            : void AliGenGeVSim::DetermineReactionPlane() {
<span class="lineNum">     452 </span>            :   //
<span class="lineNum">     453 </span>            :   // private function used by Generate()
<span class="lineNum">     454 </span>            :   //
<span class="lineNum">     455 </span>            :   // Retermines Reaction Plane angle and set this value 
<span class="lineNum">     456 </span>            :   // as a parameter [0] in fPhiFormula
<span class="lineNum">     457 </span>            :   //
<span class="lineNum">     458 </span>            :   // Note: if &quot;gevsimPsiRndm&quot; function is found it override both 
<span class="lineNum">     459 </span>            :   //       &quot;gevsimPhi&quot; function and initial fPsi value
<span class="lineNum">     460 </span>            :   //
<span class="lineNum">     461 </span>            :   
<span class="lineNum">     462 </span>            :   TF1 *form;
<span class="lineNum">     463 </span>            :   
<span class="lineNum">     464 </span>            :   form = 0;
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :   form = (TF1 *)gROOT-&gt;GetFunction(&quot;gevsimPsi&quot;);</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :   if (form) fPsi = form-&gt;Eval(gAlice-&gt;GetEvNumber()) * TMath::Pi() / 180;</span>
<span class="lineNum">     467 </span>            :   
<span class="lineNum">     468 </span>            :   form = 0;
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :   form = (TF1 *)gROOT-&gt;GetFunction(&quot;gevsimPsiRndm&quot;);</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :   if (form) fPsi = form-&gt;GetRandom() * TMath::Pi() / 180;</span>
<span class="lineNum">     471 </span>            : 
<span class="lineNum">     472 </span>            :   
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Psi = &quot; &lt;&lt; fPsi &lt;&lt; &quot;\t&quot; &lt;&lt; (Int_t)(fPsi*180./TMath::Pi()) &lt;&lt; endl;</span>
<span class="lineNum">     474 </span>            :   
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :   fPhiFormula-&gt;SetParameter(0, fPsi);</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     477 </span>            : 
<a name="478"><span class="lineNum">     478 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     479 </span>            : 
<span class="lineNum">     480 </span>            : Float_t AliGenGeVSim::GetdNdYToTotal() {
<span class="lineNum">     481 </span>            :   //
<span class="lineNum">     482 </span>            :   // Private, helper function used by Generate()
<span class="lineNum">     483 </span>            :   //
<span class="lineNum">     484 </span>            :   // Returns total multiplicity to dN/dY ration using current distribution.
<span class="lineNum">     485 </span>            :   // The function have to be called after setting distribution and its 
<span class="lineNum">     486 </span>            :   // parameters (like temperature).
<span class="lineNum">     487 </span>            :   //
<span class="lineNum">     488 </span>            : 
<span class="lineNum">     489 </span>            :   Float_t integ, mag;
<span class="lineNum">     490 </span>            :   const Double_t kMaxPt = 3.0, kMaxY = 2.; 
<span class="lineNum">     491 </span>            : 
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :   if (fModel == 1) {</span>
<span class="lineNum">     493 </span>            :     
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :     integ = fYFormula-&gt;Integral(-kMaxY, kMaxY);</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     mag = fYFormula-&gt;Eval(0);</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     return integ/mag;</span>
<span class="lineNum">     497 </span>            :   }
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span>            :   // 2D formula standard or custom
<span class="lineNum">     500 </span>            : 
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :   if (fModel &gt; 1 &amp;&amp; fModel &lt; 6) {</span>
<span class="lineNum">     502 </span>            :     
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :     integ =  ((TF2*)fCurrentForm)-&gt;Integral(0,kMaxPt, -kMaxY, kMaxY);</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :     mag = ((TF2*)fCurrentForm)-&gt;Integral(0, kMaxPt, -0.1, 0.1) / 0.2;</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :     return integ/mag;</span>
<span class="lineNum">     506 </span>            :   }
<span class="lineNum">     507 </span>            : 
<span class="lineNum">     508 </span>            :   // 2 1D histograms
<span class="lineNum">     509 </span>            : 
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :   if (fModel == 6) {</span>
<span class="lineNum">     511 </span>            : 
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :     integ = fHist[1]-&gt;Integral(); </span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     mag = fHist[0]-&gt;GetBinContent(fHist[0]-&gt;FindBin(0.));</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :     mag /= fHist[0]-&gt;GetBinWidth(fHist[0]-&gt;FindBin(0.));</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :     return integ/mag;</span>
<span class="lineNum">     516 </span>            :   }
<span class="lineNum">     517 </span>            : 
<span class="lineNum">     518 </span>            :   // 2D histogram
<span class="lineNum">     519 </span>            :   
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :   if (fModel == 7) {</span>
<span class="lineNum">     521 </span>            : 
<span class="lineNum">     522 </span>            :     // Not tested ...
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     Int_t yBins = fPtYHist-&gt;GetNbinsY();</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     Int_t ptBins = fPtYHist-&gt;GetNbinsX();</span>
<span class="lineNum">     525 </span>            : 
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :     integ = fPtYHist-&gt;Integral(0, ptBins, 0, yBins);</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :     mag = fPtYHist-&gt;Integral(0, ptBins, (yBins/2)-1, (yBins/2)+1 ) / 2;</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     return integ/mag;</span>
<span class="lineNum">     529 </span>            :   }
<span class="lineNum">     530 </span>            : 
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :   return 1;</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     533 </span>            : 
<a name="534"><span class="lineNum">     534 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     535 </span>            : 
<span class="lineNum">     536 </span>            : void AliGenGeVSim::SetFormula(Int_t pdg) {
<span class="lineNum">     537 </span>            :   //
<span class="lineNum">     538 </span>            :   // Private function used by Generate() 
<span class="lineNum">     539 </span>            :   //
<span class="lineNum">     540 </span>            :   // Configure a formula for a given particle type and model Id (in fModel).
<span class="lineNum">     541 </span>            :   // If custom formula or histogram was selected the function tries
<span class="lineNum">     542 </span>            :   // to find it.
<span class="lineNum">     543 </span>            :   //  
<span class="lineNum">     544 </span>            :   // The function implements naming conventions for custom distributions names 
<span class="lineNum">     545 </span>            :   // 
<span class="lineNum">     546 </span>            : 
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   char buff[40];</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :   const char* msg[4] = {</span>
<span class="lineNum">     549 </span>            :     &quot;Custom Formula for Pt Y distribution not found [pdg = %d]&quot;,
<span class="lineNum">     550 </span>            :     &quot;Histogram for Pt distribution not found [pdg = %d]&quot;, 
<span class="lineNum">     551 </span>            :     &quot;Histogram for Y distribution not found [pdg = %d]&quot;,
<span class="lineNum">     552 </span>            :     &quot;HIstogram for Pt Y dostribution not found [pdg = %d]&quot;
<span class="lineNum">     553 </span>            :   };
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :   const char* pattern[8] = {</span>
<span class="lineNum">     556 </span>            :     &quot;gevsimDistPtY&quot;, &quot;gevsimDist%dPtY&quot;,
<span class="lineNum">     557 </span>            :     &quot;gevsimHistPt&quot;, &quot;gevsimHist%dPt&quot;,
<span class="lineNum">     558 </span>            :     &quot;gevsimHistY&quot;, &quot;gevsimHist%dY&quot;,
<span class="lineNum">     559 </span>            :     &quot;gevsimHistPtY&quot;, &quot;gevsimHist%dPtY&quot;
<span class="lineNum">     560 </span>            :   };
<span class="lineNum">     561 </span>            : 
<span class="lineNum">     562 </span>            :   const char *where = &quot;SetFormula&quot;;
<span class="lineNum">     563 </span>            : 
<span class="lineNum">     564 </span>            :   
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :   if (fModel &lt; 1 || fModel &gt; 7)</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :     Error(&quot;SetFormula&quot;, &quot;Model Id (%d) out of range [1-7]&quot;, fModel);</span>
<span class="lineNum">     567 </span>            : 
<span class="lineNum">     568 </span>            : 
<span class="lineNum">     569 </span>            :   // standard models
<span class="lineNum">     570 </span>            : 
<span class="lineNum">     571 </span>            : #if ROOT_VERSION_CODE &gt;= ROOT_VERSION(6,3,3)
<span class="lineNum">     572 </span>            :   if (fModel == 1) fCurrentForm = fPtFormula-&gt;GetFormula();
<span class="lineNum">     573 </span>            :   if (fModel &gt; 1 &amp;&amp; fModel &lt; 5) fCurrentForm = fPtYFormula[fModel-2]-&gt;GetFormula();
<span class="lineNum">     574 </span>            : #else
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :   if (fModel == 1) fCurrentForm = fPtFormula;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :   if (fModel &gt; 1 &amp;&amp; fModel &lt; 5) fCurrentForm = fPtYFormula[fModel-2];</span>
<span class="lineNum">     577 </span>            : #endif
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span>            : 
<span class="lineNum">     580 </span>            :   // custom model defined by a formula 
<span class="lineNum">     581 </span>            : 
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :   if (fModel == 5) {</span>
<span class="lineNum">     583 </span>            :     
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     fCurrentForm = 0;</span>
<span class="lineNum">     585 </span>            : #if ROOT_VERSION_CODE &gt;= ROOT_VERSION(6,3,3)
<span class="lineNum">     586 </span>            :     TF2* tmpTF2 = (TF2*)gROOT-&gt;GetFunction(pattern[0]);
<span class="lineNum">     587 </span>            :     if (tmpTF2) fCurrentForm = tmpTF2-&gt;GetFormula();
<span class="lineNum">     588 </span>            : #else
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     fCurrentForm = (TF2*)gROOT-&gt;GetFunction(pattern[0]);</span>
<span class="lineNum">     590 </span>            : #endif
<span class="lineNum">     591 </span>            :     
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     if (!fCurrentForm) {</span>
<span class="lineNum">     593 </span>            : 
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :       snprintf(buff, 40, pattern[1], pdg);</span>
<span class="lineNum">     595 </span>            : #if ROOT_VERSION_CODE &gt;= ROOT_VERSION(6,3,3)
<span class="lineNum">     596 </span>            :       tmpTF2 = (TF2*)gROOT-&gt;GetFunction(buff);
<span class="lineNum">     597 </span>            :       if (tmpTF2) fCurrentForm = tmpTF2-&gt;GetFormula();
<span class="lineNum">     598 </span>            : #else
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :       fCurrentForm = (TF2*)gROOT-&gt;GetFunction(buff);</span>
<span class="lineNum">     600 </span>            : #endif
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :       if (!fCurrentForm) Error(where, msg[0], pdg);</span>
<span class="lineNum">     603 </span>            :     }
<span class="lineNum">     604 </span>            :   }
<span class="lineNum">     605 </span>            : 
<span class="lineNum">     606 </span>            :   // 2 1D histograms
<span class="lineNum">     607 </span>            : 
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :   if (fModel == 6) {</span>
<span class="lineNum">     609 </span>            :     
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :     for (Int_t i=0; i&lt;2; i++) {</span>
<span class="lineNum">     611 </span>            : 
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :       fHist[i] = 0;</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :       fHist[i] = (TH1D*)gROOT-&gt;FindObject(pattern[2+2*i]);</span>
<span class="lineNum">     614 </span>            :       
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :       if (!fHist[i]) {</span>
<span class="lineNum">     616 </span>            :         
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :         snprintf(buff, 40, pattern[3+2*i], pdg);</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :         fHist[i] = (TH1D*)gROOT-&gt;FindObject(buff);</span>
<span class="lineNum">     619 </span>            :         
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :         if (!fHist[i]) Error(where, msg[1+i], pdg);</span>
<span class="lineNum">     621 </span>            :       }
<span class="lineNum">     622 </span>            :     }
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     624 </span>            :  
<span class="lineNum">     625 </span>            :   // 2d histogram
<span class="lineNum">     626 </span>            : 
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :   if (fModel == 7) {</span>
<span class="lineNum">     628 </span>            : 
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     fPtYHist = 0;</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :     fPtYHist = (TH2D*)gROOT-&gt;FindObject(pattern[6]);</span>
<span class="lineNum">     631 </span>            :     
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :     if (!fPtYHist) {</span>
<span class="lineNum">     633 </span>            :       
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :       snprintf(buff, 40, pattern[7], pdg);</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :       fPtYHist = (TH2D*)gROOT-&gt;FindObject(buff);</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     637 </span>            : 
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     if (!fPtYHist) Error(where, msg[3], pdg);</span>
<span class="lineNum">     639 </span>            :   }
<span class="lineNum">     640 </span>            : 
<span class="lineNum">     641 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     642 </span>            : 
<a name="643"><span class="lineNum">     643 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span>            : void AliGenGeVSim:: AdjustFormula() {
<span class="lineNum">     646 </span>            :   //
<span class="lineNum">     647 </span>            :   // Private Function
<span class="lineNum">     648 </span>            :   // Adjust fomula bounds according to acceptance cuts.
<span class="lineNum">     649 </span>            :   //
<span class="lineNum">     650 </span>            :   // Since GeVSim is producing &quot;thermal&quot; particles Pt
<span class="lineNum">     651 </span>            :   // is cut at 3 GeV even when acceptance extends to grater momenta.
<span class="lineNum">     652 </span>            :   //
<span class="lineNum">     653 </span>            :   // WARNING !
<span class="lineNum">     654 </span>            :   // If custom formula was provided function preserves
<span class="lineNum">     655 </span>            :   // original cuts.
<span class="lineNum">     656 </span>            :   //
<span class="lineNum">     657 </span>            : 
<span class="lineNum">     658 </span>            :   const Double_t kMaxPt = 3.0;
<span class="lineNum">     659 </span>            :   const Double_t kMaxY = 2.0;
<span class="lineNum">     660 </span>            :   Double_t minPt, maxPt, minY, maxY;
<span class="lineNum">     661 </span>            : 
<span class="lineNum">     662 </span>            :   
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :   if (fModel &gt; 4) return;</span>
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span>            :   // max Pt 
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :   if (TestBit(kPtRange) &amp;&amp; fPtMax &lt; kMaxPt ) maxPt = fPtMax;</span>
<span class="lineNum">     667 </span>            :   else maxPt = kMaxPt;
<span class="lineNum">     668 </span>            : 
<span class="lineNum">     669 </span>            :   // min Pt
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :   if (TestBit(kPtRange)) minPt = fPtMin;</span>
<span class="lineNum">     671 </span>            :   else minPt = 0;
<span class="lineNum">     672 </span>            : 
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :   if (TestBit(kPtRange) &amp;&amp; fPtMin &gt; kMaxPt ) </span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :     Warning(&quot;Acceptance&quot;, &quot;Minimum Pt (%3.2f GeV) greater that 3.0 GeV &quot;, fPtMin);</span>
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span>            :   // Max Pt &lt; Max P
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :   if (TestBit(kMomentumRange) &amp;&amp; fPtMax &lt; maxPt) maxPt = fPtMax;</span>
<span class="lineNum">     678 </span>            :  
<span class="lineNum">     679 </span>            :   // max and min rapidity
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   if (TestBit(kYRange)) {</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     minY = fYMin;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :     maxY = fYMax;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     684 </span>            :     minY = -kMaxY;
<span class="lineNum">     685 </span>            :     maxY = kMaxY;
<span class="lineNum">     686 </span>            :   }
<span class="lineNum">     687 </span>            :   
<span class="lineNum">     688 </span>            :   // adjust formula
<span class="lineNum">     689 </span>            : 
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :   if (fModel == 1) {</span>
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :     fPtFormula-&gt;SetRange(fPtMin, maxPt);</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     fYFormula-&gt;SetRange(fYMin, fYMax);</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     694 </span>            :   
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :   if (fModel &gt; 1)</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     ((TF2*)fCurrentForm)-&gt;SetRange(minPt, minY, maxPt, maxY);</span>
<span class="lineNum">     697 </span>            : 
<span class="lineNum">     698 </span>            :   // azimuthal cut
<span class="lineNum">     699 </span>            : 
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   if (TestBit(kPhiRange)) </span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :     fPhiFormula-&gt;SetRange(fPhiMin, fPhiMax);</span>
<span class="lineNum">     702 </span>            : 
<span class="lineNum">     703 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     704 </span>            : 
<a name="705"><span class="lineNum">     705 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     706 </span>            : 
<span class="lineNum">     707 </span>            : void AliGenGeVSim::GetRandomPtY(Double_t &amp;pt, Double_t &amp;y) {
<span class="lineNum">     708 </span>            :   //
<span class="lineNum">     709 </span>            :   // Private function used by Generate()
<span class="lineNum">     710 </span>            :   //
<span class="lineNum">     711 </span>            :   // Returns random values of Pt and Y corresponding to selected
<span class="lineNum">     712 </span>            :   // distribution.
<span class="lineNum">     713 </span>            :   //
<span class="lineNum">     714 </span>            :   
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :   if (fModel == 1) {</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :     pt = fPtFormula-&gt;GetRandom();</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     y = fYFormula-&gt;GetRandom();</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     719 </span>            :   }
<span class="lineNum">     720 </span>            : 
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :   if (fModel &gt; 1 &amp;&amp; fModel &lt; 6) {</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :     ((TF2*)fCurrentForm)-&gt;GetRandom2(pt, y);</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     724 </span>            :   }
<span class="lineNum">     725 </span>            :   
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :   if (fModel == 6) {</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     pt = fHist[0]-&gt;GetRandom();</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :     y = fHist[1]-&gt;GetRandom();</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     730 </span>            :   
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :   if (fModel == 7) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :     fPtYHist-&gt;GetRandom2(pt, y);</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     734 </span>            :   }
<span class="lineNum">     735 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     736 </span>            : 
<a name="737"><span class="lineNum">     737 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     738 </span>            : 
<span class="lineNum">     739 </span>            : void AliGenGeVSim::Init() {
<span class="lineNum">     740 </span>            :   //
<span class="lineNum">     741 </span>            :   // Standard AliGenerator initializer.
<span class="lineNum">     742 </span>            :   // does nothing
<span class="lineNum">     743 </span>            :   //
<span class="lineNum">     744 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     745 </span>            : 
<a name="746"><span class="lineNum">     746 </span>            : //////////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span>            : void AliGenGeVSim::Generate() {
<span class="lineNum">     749 </span>            :   //
<span class="lineNum">     750 </span>            :   // Standard AliGenerator function
<span class="lineNum">     751 </span>            :   // This function do actual job and puts particles on stack.
<span class="lineNum">     752 </span>            :   //
<span class="lineNum">     753 </span>            : 
<span class="lineNum">     754 </span>            :   PDG_t pdg;                    // particle type
<span class="lineNum">     755 </span>            :   Float_t mass;                 // particle mass
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :   Float_t orgin[3] = {0,0,0};   // particle orgin [cm]</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :   Float_t polar[3] = {0,0,0};   // polarisation</span>
<span class="lineNum">     758 </span>            :   Float_t time = 0;             // time of creation
<span class="lineNum">     759 </span>            : 
<span class="lineNum">     760 </span>            :   Float_t multiplicity = 0;           
<span class="lineNum">     761 </span>            :   Bool_t isMultTotal = kTRUE;
<span class="lineNum">     762 </span>            : 
<span class="lineNum">     763 </span>            :   Float_t paramScaler;
<span class="lineNum">     764 </span>            :   Float_t directedScaller = 1., ellipticScaller = 1.;
<span class="lineNum">     765 </span>            : 
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :   TLorentzVector *v = new TLorentzVector(0,0,0,0);</span>
<span class="lineNum">     767 </span>            : 
<span class="lineNum">     768 </span>            :   const Int_t kParent = -1;
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :   Int_t id;  </span>
<span class="lineNum">     770 </span>            : 
<span class="lineNum">     771 </span>            :   // vertexing 
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :   VertexInternal();</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :   orgin[0] = fVertex[0];</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :   orgin[1] = fVertex[1];</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   orgin[2] = fVertex[2];</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :   time = fTime;</span>
<span class="lineNum">     777 </span>            : 
<span class="lineNum">     778 </span>            :   // Particle params database
<span class="lineNum">     779 </span>            : 
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :   TDatabasePDG *db = TDatabasePDG::Instance(); </span>
<span class="lineNum">     781 </span>            :   TParticlePDG *type;
<span class="lineNum">     782 </span>            :   AliGeVSimParticle *partType;
<span class="lineNum">     783 </span>            : 
<span class="lineNum">     784 </span>            :   Int_t nType, nParticle, nParam;
<span class="lineNum">     785 </span>            :   const Int_t kNParams = 6;
<span class="lineNum">     786 </span>            : 
<span class="lineNum">     787 </span>            :   // reaction plane determination and model
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :   DetermineReactionPlane();</span>
<span class="lineNum">     789 </span>            : 
<span class="lineNum">     790 </span>            :   // loop over particle types
<span class="lineNum">     791 </span>            : 
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :   for (nType = 0; nType &lt; fPartTypes-&gt;GetEntries(); nType++) {</span>
<span class="lineNum">     793 </span>            : 
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :     partType = (AliGeVSimParticle *)fPartTypes-&gt;At(nType);</span>
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :     pdg = (PDG_t)partType-&gt;GetPdgCode();</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :     type = db-&gt;GetParticle(pdg);</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :     mass = type-&gt;Mass();</span>
<span class="lineNum">     799 </span>            : 
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :     fModel = partType-&gt;GetModel();</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :     SetFormula(pdg);</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :     fCurrentForm-&gt;SetParameter(&quot;mass&quot;, mass);</span>
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span>            : 
<span class="lineNum">     805 </span>            :     // Evaluation of parameters - loop over parameters
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :     for (nParam = 0; nParam &lt; kNParams; nParam++) {</span>
<span class="lineNum">     808 </span>            :       
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :       paramScaler = FindScaler(nParam, pdg);</span>
<span class="lineNum">     810 </span>            : 
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :       if (nParam == 0)</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :         fCurrentForm-&gt;SetParameter(&quot;temperature&quot;, paramScaler * partType-&gt;GetTemperature());</span>
<span class="lineNum">     813 </span>            : 
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :       if (nParam == 1 &amp;&amp; fModel == 1) </span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :         fYFormula-&gt;SetParameter(&quot;sigmaY&quot;, paramScaler * partType-&gt;GetSigmaY());</span>
<span class="lineNum">     816 </span>            :      
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :       if (nParam == 2 &amp;&amp; fModel == 4) {</span>
<span class="lineNum">     818 </span>            : 
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :         Double_t totalExpVal =  paramScaler * partType-&gt;GetExpansionVelocity();</span>
<span class="lineNum">     820 </span>            : 
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :         if (totalExpVal == 0.0) totalExpVal = 0.0001;</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :         if (totalExpVal == 1.0) totalExpVal = 9.9999;</span>
<span class="lineNum">     823 </span>            : 
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :         fCurrentForm-&gt;SetParameter(&quot;expVel&quot;, totalExpVal);</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     826 </span>            : 
<span class="lineNum">     827 </span>            :       // flow
<span class="lineNum">     828 </span>            :      
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :       if (nParam == 3) directedScaller = paramScaler;</span>
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :       if (nParam == 4) ellipticScaller = paramScaler;</span>
<span class="lineNum">     831 </span>            :       
<span class="lineNum">     832 </span>            :       // multiplicity
<span class="lineNum">     833 </span>            :       
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :       if (nParam == 5) {</span>
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :         if (partType-&gt;IsMultForced()) isMultTotal = partType-&gt;IsMultTotal();</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :         else isMultTotal = fIsMultTotal;</span>
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :         multiplicity = paramScaler * partType-&gt;GetMultiplicity();</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :         multiplicity *= (isMultTotal)? 1 : GetdNdYToTotal();</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :       } </span>
<span class="lineNum">     842 </span>            :     }
<span class="lineNum">     843 </span>            : 
<span class="lineNum">     844 </span>            :     // Flow defined on the particle type level (not parameterised)
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :     if (partType-&gt;IsFlowSimple()) {</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :       fPhiFormula-&gt;SetParameter(1, partType-&gt;GetDirectedFlow(0,0) * directedScaller);</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :       fPhiFormula-&gt;SetParameter(2, partType-&gt;GetEllipticFlow(0,0) * ellipticScaller);</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     849 </span>            : 
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :     AdjustFormula();</span>
<span class="lineNum">     851 </span>            : 
<span class="lineNum">     852 </span>            : 
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :     Info(&quot;Generate&quot;,&quot;PDG = %d \t Mult = %d&quot;, pdg, (Int_t)multiplicity);</span>
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span>            :     // loop over particles
<span class="lineNum">     856 </span>            :     
<span class="lineNum">     857 </span>            :     nParticle = 0;
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :     while (nParticle &lt; multiplicity) {</span>
<span class="lineNum">     859 </span>            : 
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :       Double_t pt, y, phi;       // momentum in [pt,y,phi]</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :       Float_t p[3] = {0,0,0};    // particle momentum</span>
<span class="lineNum">     862 </span>            : 
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :       GetRandomPtY(pt, y);</span>
<span class="lineNum">     864 </span>            : 
<span class="lineNum">     865 </span>            :       // phi distribution configuration when differential flow defined
<span class="lineNum">     866 </span>            :       // to be optimised in future release 
<span class="lineNum">     867 </span>            : 
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :       if (!partType-&gt;IsFlowSimple()) {</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :         fPhiFormula-&gt;SetParameter(1, partType-&gt;GetDirectedFlow(pt,y) * directedScaller);</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :         fPhiFormula-&gt;SetParameter(2, partType-&gt;GetEllipticFlow(pt,y) * ellipticScaller);</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     872 </span>            : 
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :       phi = fPhiFormula-&gt;GetRandom(); </span>
<span class="lineNum">     874 </span>            : 
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :       if (!isMultTotal) nParticle++;</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :       if (fModel &gt; 4 &amp;&amp; !CheckPtYPhi(pt,y,phi) ) continue;</span>
<span class="lineNum">     877 </span>            :       
<span class="lineNum">     878 </span>            :       // coordinate transformation
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :       v-&gt;SetPtEtaPhiM(pt, y, phi, mass);</span>
<span class="lineNum">     880 </span>            : 
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :       p[0] = v-&gt;Px();</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :       p[1] = v-&gt;Py();</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :       p[2] = v-&gt;Pz();</span>
<span class="lineNum">     884 </span>            : 
<span class="lineNum">     885 </span>            :       // momentum range test
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :       if ( !CheckAcceptance(p) ) continue;</span>
<span class="lineNum">     887 </span>            : 
<span class="lineNum">     888 </span>            :       // putting particle on the stack
<span class="lineNum">     889 </span>            : 
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :       PushTrack(fTrackIt, kParent, pdg, p, orgin, polar, time, kPPrimary, id, fTrackIt);     </span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :       if (isMultTotal) nParticle++;</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     893 </span>            :   }
<span class="lineNum">     894 </span>            : 
<span class="lineNum">     895 </span>            :   // prepare and store header
<span class="lineNum">     896 </span>            : 
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :   AliGenGeVSimEventHeader *header = new AliGenGeVSimEventHeader(&quot;GeVSim header&quot;);</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :   TArrayF eventVertex(3,orgin);</span>
<span class="lineNum">     899 </span>            : 
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :   header-&gt;SetPrimaryVertex(eventVertex);</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :   header-&gt;SetInteractionTime(time);</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :   header-&gt;SetEventPlane(fPsi);</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :   header-&gt;SetEllipticFlow(fPhiFormula-&gt;GetParameter(2));</span>
<span class="lineNum">     904 </span>            : 
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :   gAlice-&gt;SetGenEventHeader(header);</span>
<span class="lineNum">     906 </span>            : 
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :   delete v;</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     909 </span>            : 
<span class="lineNum">     910 </span>            : //////////////////////////////////////////////////////////////////////////////////
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
