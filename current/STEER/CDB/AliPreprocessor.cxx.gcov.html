<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - STEER/CDB/AliPreprocessor.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">STEER/CDB</a> - AliPreprocessor.cxx<span style="font-size: 80%;"> (source / <a href="AliPreprocessor.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">102</td>
            <td class="headerCovTableEntryLo">1.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">30</td>
            <td class="headerCovTableEntryLo">3.3 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /*
<span class="lineNum">      17 </span>            :    $Log$
<span class="lineNum">      18 </span>            :    Revision 1.17  2007/08/28 16:03:30  acolla
<span class="lineNum">      19 </span>            :    Restored to v1.14:
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : 
<span class="lineNum">      22 </span>            :    Function Bool_t GetHLTStatus() added to preprocessor interface. It will return
<span class="lineNum">      23 </span>            :    the status of HLT read from the run logbook.
<span class="lineNum">      24 </span>            : 
<span class="lineNum">      25 </span>            :    Revision 1.16  2007/08/22 09:20:50  hristov
<span class="lineNum">      26 </span>            :    Updated QA classes (Yves)
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span>            :    Revision 1.14  2007/05/30 06:35:21  jgrosseo
<span class="lineNum">      29 </span>            :    Adding functionality to the Shuttle/TestShuttle:
<span class="lineNum">      30 </span>            :    o) Function to retrieve list of sources from a given system (GetFileSources with id=0)
<span class="lineNum">      31 </span>            :    o) Function to retrieve list of IDs for a given source      (GetFileIDs)
<span class="lineNum">      32 </span>            :    These functions are needed for dealing with the tag files that are saved for the GRP preprocessor
<span class="lineNum">      33 </span>            :    Example code has been added to the TestProcessor in TestShuttle
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            :    Revision 1.13  2007/04/12 08:26:33  jgrosseo
<span class="lineNum">      36 </span>            :    updated commment
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            :    Revision 1.12  2007/04/05 08:05:55  acolla
<span class="lineNum">      39 </span>            :    Conversion from online to offline detector name in StoreReferenceFile
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            :    Revision 1.11  2007/04/04 10:29:18  jgrosseo
<span class="lineNum">      42 </span>            :    1) Storing of files to the Grid is now done _after_ your preprocessors succeeded. This is transparent, which means that you can still use the same functions (Store, StoreReferenceData) to store files to the Grid. However, the Shuttle first stores them locally and transfers them after the preprocessor finished. The return code of these two functions has changed from UInt_t to Bool_t which gives you the success of the storing.
<span class="lineNum">      43 </span>            :    In case of an error with the Grid, the Shuttle will retry the storing later, the preprocessor does not need to be run again.
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            :    2) The meaning of the return code of the preprocessor has changed. 0 is now success and any other value means failure. This value is stored in the log and you can use it to keep details about the error condition.
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            :    3) New function StoreReferenceFile to _directly_ store a file (without opening it) to the reference storage.
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            :    4) The memory usage of the preprocessor is monitored. If it exceeds 2 GB it is terminated.
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            :    5) New function AliPreprocessor::ProcessDCS(). If you do not need to have DCS data in all cases, you can skip the processing by implemting this function and returning kFALSE under certain conditions. E.g. if there is a certain run type.
<span class="lineNum">      52 </span>            :    If you always need DCS data (like before), you do not need to implement it.
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            :    6) The run type has been added to the monitoring page
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span>            :    Revision 1.9  2007/02/28 10:42:58  acolla
<span class="lineNum">      57 </span>            :    Run type field added in SHUTTLE framework. Run type is read from &quot;run type&quot; logbook and retrieved by
<span class="lineNum">      58 </span>            :    AliPreprocessor::GetRunType() function.
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            :    Revision 1.7  2006/11/06 14:24:21  jgrosseo
<span class="lineNum">      61 </span>            :    reading of run parameters from the logbook
<span class="lineNum">      62 </span>            :    online offline naming conversion
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            :    Revision 1.6  2006/10/02 12:57:48  jgrosseo
<span class="lineNum">      65 </span>            :    Small interface change of function StoreReferenceData in Shuttle
<span class="lineNum">      66 </span>            : 
<span class="lineNum">      67 </span>            :    Revision 1.5  2006/09/04 17:42:34  hristov
<span class="lineNum">      68 </span>            :    Changes required by Effective C++
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            :    Revision 1.4  2006/08/08 14:20:49  jgrosseo
<span class="lineNum">      71 </span>            :    Update to shuttle classes (Alberto)
<span class="lineNum">      72 </span>            : 
<span class="lineNum">      73 </span>            :    - Possibility to set the full object's path in the Preprocessor's and
<span class="lineNum">      74 </span>            :    Shuttle's  Store functions
<span class="lineNum">      75 </span>            :    - Possibility to extend the object's run validity in the same classes
<span class="lineNum">      76 </span>            :    (&quot;startValidity&quot; and &quot;validityInfinite&quot; parameters)
<span class="lineNum">      77 </span>            :    - Implementation of the StoreReferenceData function to store reference
<span class="lineNum">      78 </span>            :    data in a dedicated CDB storage.
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            :    Revision 1.3  2006/07/11 12:42:43  jgrosseo
<span class="lineNum">      81 </span>            :    adding parameters for extended validity range of data produced by preprocessor
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span>            :    Revision 1.2  2006/06/06 16:36:49  jgrosseo
<span class="lineNum">      84 </span>            :    minor changes in AliShuttleInterface and AliPreprocessor
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span>            :    Revision 1.1  2006/06/02 14:14:36  hristov
<span class="lineNum">      87 </span>            : Separate library for CDB (Jan)
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            :   Revision 1.2  2006/03/07 07:52:34  hristov
<span class="lineNum">      90 </span>            : New version (B.Yordanov)
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span>            :   Revision 1.3  2005/11/17 17:47:34  byordano
<span class="lineNum">      93 </span>            :   TList changed to TObjArray
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span>            :   Revision 1.2  2005/11/17 14:43:22  byordano
<span class="lineNum">      96 </span>            :   import to local CVS
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            :   Revision 1.1.1.1  2005/10/28 07:33:58  hristov
<span class="lineNum">      99 </span>            :   Initial import as subdirectory in AliRoot
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span>            :   Revision 1.1.1.1  2005/09/12 22:11:40  byordano
<span class="lineNum">     102 </span>            :   SHUTTLE package
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            :   Revision 1.2  2005/08/29 21:15:47  byordano
<span class="lineNum">     105 </span>            :   some docs added
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span>            :   */
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            :   // Description:
<span class="lineNum">     110 </span>            :   // This class is the CDBPreProcessor interface,
<span class="lineNum">     111 </span>            :   // supposed to be implemented by any detector
<span class="lineNum">     112 </span>            :   // interested in immediate processing of data 
<span class="lineNum">     113 </span>            :   // which is retrieved from DCS.
<span class="lineNum">     114 </span>            :   // For every particular run set of aliases and
<span class="lineNum">     115 </span>            :   // their corespoding value sets are returned.
<span class="lineNum">     116 </span>            :   // Usage schema:
<span class="lineNum">     117 </span>            :   //    1) virtual void Initialize(Int_t run, UInt_t startTime, UInt_t endTime) 
<span class="lineNum">     118 </span>            :   //    This method is called at the begining of data retrieval.
<span class="lineNum">     119 </span>            :   //    run: run number
<span class="lineNum">     120 </span>            :   //    startTime: when the run started
<span class="lineNum">     121 </span>            :   //    endTime: when the run finished  
<span class="lineNum">     122 </span>            :   //
<span class="lineNum">     123 </span>            :   //    2) virtual void Process()
<span class="lineNum">     124 </span>            :   //
<span class="lineNum">     125 </span>            :   //    This method is called and passed a list of retrieved values from DCS
<span class="lineNum">     126 </span>            :   //
<span class="lineNum">     127 </span>            :   //
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : #include &quot;AliPreprocessor.h&quot;
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span>            : #include &lt;TString.h&gt;
<span class="lineNum">     133 </span>            : #include &lt;TMap.h&gt;
<span class="lineNum">     134 </span>            : #include &lt;TObjString.h&gt;
<span class="lineNum">     135 </span>            : 
<span class="lineNum">     136 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">     137 </span>            : #include &quot;AliCDBMetaData.h&quot;
<span class="lineNum">     138 </span>            : #include &quot;AliCDBStorage.h&quot;
<span class="lineNum">     139 </span>            : #include &quot;AliCDBId.h&quot;
<span class="lineNum">     140 </span>            : #include &quot;AliCDBPath.h&quot;
<span class="lineNum">     141 </span>            : #include &quot;AliCDBEntry.h&quot;
<a name="142"><span class="lineNum">     142 </span>            : #include &quot;AliShuttleInterface.h&quot;</a>
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span><span class="lineCov">        128 : ClassImp(AliPreprocessor)</span>
<a name="145"><span class="lineNum">     145 </span>            : </a>
<span class="lineNum">     146 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     147 </span>            : AliPreprocessor::AliPreprocessor(const char* detector, AliShuttleInterface* shuttle) :
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :   TNamed(detector, &quot;&quot;),</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   fRun(-1),</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   fStartTime(0),</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   fEndTime(0),</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   fShuttle(shuttle),</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :   fRunTypes()</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :   SetTitle(Form(&quot;AliPreprocessor for %s subdetector.&quot;, detector));</span>
<span class="lineNum">     156 </span>            : 
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   if (!fShuttle)</span>
<span class="lineNum">     158 </span>            :   {
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :     AliFatal(&quot;Initialized without Shuttle instance.&quot;);</span>
<span class="lineNum">     160 </span>            :     return;
<span class="lineNum">     161 </span>            :   }
<span class="lineNum">     162 </span>            : 
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :   fShuttle-&gt;RegisterPreprocessor(this);</span>
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   fRunTypes.SetOwner(kTRUE);</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 : }</span>
<a name="167"><span class="lineNum">     167 </span>            : </a>
<span class="lineNum">     168 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     169 </span>            : AliPreprocessor::~AliPreprocessor()
<span class="lineNum">     170 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 : }</span>
<a name="172"><span class="lineNum">     172 </span>            : </a>
<span class="lineNum">     173 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     174 </span>            : void AliPreprocessor::Initialize(Int_t run, UInt_t startTime,   UInt_t endTime)
<span class="lineNum">     175 </span>            : {
<span class="lineNum">     176 </span>            :   // Sets the information of the run which is currently processed
<span class="lineNum">     177 </span>            :   // can be overriden for special behaviour, make sure that you call base class
<span class="lineNum">     178 </span>            :   // function
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :   fRun = run;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :   fStartTime = startTime;</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :   fEndTime = endTime;</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 : }</span>
<a name="184"><span class="lineNum">     184 </span>            : </a>
<span class="lineNum">     185 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     186 </span>            : Bool_t AliPreprocessor::Store(const char* pathLevel2, const char* pathLevel3, TObject* object,
<span class="lineNum">     187 </span>            :     AliCDBMetaData* metaData, Int_t validityStart, Bool_t validityInfinite)
<span class="lineNum">     188 </span>            : {
<span class="lineNum">     189 </span>            :   // Stores a CDB object in the storage for offline reconstruction. Objects that are not needed for
<span class="lineNum">     190 </span>            :   // offline reconstruction, but should be stored anyway (e.g. for debugging) should NOT be stored
<span class="lineNum">     191 </span>            :   // using this function. Use StoreReferenceData instead!
<span class="lineNum">     192 </span>            :   //
<span class="lineNum">     193 </span>            :   // This function should be called at the end of the preprocessor cycle
<span class="lineNum">     194 </span>            :   //
<span class="lineNum">     195 </span>            :   // The parameters are
<span class="lineNum">     196 </span>            :   //   1, 2) the 2nd and 3rd level of the object's path. The first level is the detector name which is provided
<span class="lineNum">     197 </span>            :   //         by the Preprocessor and converted to the Offline name. Thus the object's path is &quot;DET/level2/level3&quot;
<span class="lineNum">     198 </span>            :   //   3) the object to be stored
<span class="lineNum">     199 </span>            :   //   4) the metaData to be associated with the object
<span class="lineNum">     200 </span>            :   //   5) the validity start run number w.r.t. the current run,
<span class="lineNum">     201 </span>            :   //      if the data is valid only for this run leave the default 0
<span class="lineNum">     202 </span>            :   //   6) specifies if the calibration data is valid for infinity (this means until updated),
<span class="lineNum">     203 </span>            :   //      typical for calibration runs, the default is kFALSE
<span class="lineNum">     204 </span>            :   //
<span class="lineNum">     205 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :   const char* offlineDetName = AliShuttleInterface::GetOfflineDetName(GetName());</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :   if(!offlineDetName) return 0;</span>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;Store(AliCDBPath(offlineDetName, pathLevel2, pathLevel3), object,</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :       metaData, validityStart, validityInfinite);</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 : }</span>
<a name="213"><span class="lineNum">     213 </span>            : </a>
<span class="lineNum">     214 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     215 </span>            : Bool_t AliPreprocessor::StoreReferenceData(const char* pathLevel2, const char* pathLevel3, TObject* object,
<span class="lineNum">     216 </span>            :     AliCDBMetaData* metaData)
<span class="lineNum">     217 </span>            : {
<span class="lineNum">     218 </span>            :   // Stores a CDB object in the storage for reference data. This objects will not be available during
<span class="lineNum">     219 </span>            :   // offline reconstrunction. Use this function for reference data only!
<span class="lineNum">     220 </span>            :   //
<span class="lineNum">     221 </span>            :   // This function should be called at the end of the preprocessor cycle
<span class="lineNum">     222 </span>            :   //
<span class="lineNum">     223 </span>            :   // The parameters are
<span class="lineNum">     224 </span>            :   //   1, 2) the 2nd and 3rd level of the object's path. The first level is the detector name which is provided
<span class="lineNum">     225 </span>            :   //         by the Preprocessor and converted to the Offline name. Thus the object's path is &quot;DET/level2/level3&quot;
<span class="lineNum">     226 </span>            :   //   3) the object to be stored
<span class="lineNum">     227 </span>            :   //   4) the metaData to be associated with the object
<span class="lineNum">     228 </span>            :   //
<span class="lineNum">     229 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   const char* offlineDetName = AliShuttleInterface::GetOfflineDetName(GetName());</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :   if(!offlineDetName) return 0;</span>
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;StoreReferenceData(AliCDBPath(offlineDetName, pathLevel2, pathLevel3), object,</span>
<span class="lineNum">     235 </span>            :       metaData);
<span class="lineNum">     236 </span><span class="lineNoCov">          0 : }</span>
<a name="237"><span class="lineNum">     237 </span>            : </a>
<span class="lineNum">     238 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     239 </span>            : Bool_t AliPreprocessor::StoreReferenceFile(const char* localFile, const char* gridFileName)
<span class="lineNum">     240 </span>            : {
<span class="lineNum">     241 </span>            :   //
<span class="lineNum">     242 </span>            :   // Stores a file directly (without opening it) in the reference storage in the Grid
<span class="lineNum">     243 </span>            :   //
<span class="lineNum">     244 </span>            :   // The file is stored under the following location: 
<span class="lineNum">     245 </span>            :   // &lt;base folder of reference storage&gt;/&lt;DET&gt;/&lt;RUN#&gt;_&lt;gridFileName&gt;
<span class="lineNum">     246 </span>            :   // where &lt;gridFileName&gt; is the second parameter given to the function
<span class="lineNum">     247 </span>            :   //
<span class="lineNum">     248 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :   const char* offlineDetName = AliShuttleInterface::GetOfflineDetName(GetName());</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :   if(!offlineDetName) return 0;</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;StoreReferenceFile(GetName(), localFile, gridFileName);</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 : }</span>
<a name="254"><span class="lineNum">     254 </span>            : </a>
<span class="lineNum">     255 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     256 </span>            : Bool_t AliPreprocessor::StoreRunMetadataFile(const char* localFile, const char* gridFileName)
<span class="lineNum">     257 </span>            : {
<span class="lineNum">     258 </span>            :   //
<span class="lineNum">     259 </span>            :   // Stores Run metadata file to the Grid, in the run folder
<span class="lineNum">     260 </span>            :   //
<span class="lineNum">     261 </span>            :   // Only GRP can call this function.
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   if (detName != &quot;GRP&quot;) </span>
<span class="lineNum">     265 </span>            :   {
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :     Log(&quot;StoreRunMetadataFile - Only GRP can call this function.&quot;);</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<span class="lineNum">     268 </span>            :   }
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;StoreRunMetadataFile(localFile, gridFileName);</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 : }</span>
<a name="271"><span class="lineNum">     271 </span>            : </a>
<span class="lineNum">     272 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     273 </span>            : const char* AliPreprocessor::GetFile(Int_t system, const char* id, const char* source)
<span class="lineNum">     274 </span>            : {
<span class="lineNum">     275 </span>            :   // This function retrieves a file from the given system (kDAQ, kDCS, kHLT) with the given file id
<span class="lineNum">     276 </span>            :   // and from the given source in the system.
<span class="lineNum">     277 </span>            :   // The function returnes the path to the local file.
<span class="lineNum">     278 </span>            :   //
<span class="lineNum">     279 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetFile(system, GetName(), id, source);</span>
<span class="lineNum">     282 </span>            : }
<a name="283"><span class="lineNum">     283 </span>            : </a>
<span class="lineNum">     284 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     285 </span>            : TList* AliPreprocessor::GetFileSources(Int_t system, const char* id)
<span class="lineNum">     286 </span>            : {
<span class="lineNum">     287 </span>            :   // Returns a list of sources in a given system that saved a file with the given id
<span class="lineNum">     288 </span>            :   // if id is not given all sources are returned
<span class="lineNum">     289 </span>            :   //
<span class="lineNum">     290 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetFileSources(system, GetName(), id);</span>
<span class="lineNum">     293 </span>            : }
<a name="294"><span class="lineNum">     294 </span>            : </a>
<span class="lineNum">     295 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     296 </span>            : TList* AliPreprocessor::GetFileIDs(Int_t system, const char* source)
<span class="lineNum">     297 </span>            : {
<span class="lineNum">     298 </span>            :   // Returns a list of ids in a given system that saved a file with the given source
<span class="lineNum">     299 </span>            :   //
<span class="lineNum">     300 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetFileIDs(system, GetName(), source);</span>
<span class="lineNum">     303 </span>            : }
<a name="304"><span class="lineNum">     304 </span>            : </a>
<span class="lineNum">     305 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     306 </span>            : void AliPreprocessor::Log(const char* message, UInt_t level)
<span class="lineNum">     307 </span>            : {
<span class="lineNum">     308 </span>            :   // Adds a log message to the Shuttle log of this preprocessor
<span class="lineNum">     309 </span>            :   //
<span class="lineNum">     310 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     311 </span>            : 
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :   fShuttle-&gt;Log(GetName(), message, level);</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 : }</span>
<a name="314"><span class="lineNum">     314 </span>            : </a>
<span class="lineNum">     315 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     316 </span>            : const char* AliPreprocessor::GetRunParameter(const char* param)
<span class="lineNum">     317 </span>            : {
<span class="lineNum">     318 </span>            :   // Return run parameter read from run logbook
<span class="lineNum">     319 </span>            :   //
<span class="lineNum">     320 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetRunParameter(param);</span>
<span class="lineNum">     323 </span>            : }
<a name="324"><span class="lineNum">     324 </span>            : </a>
<span class="lineNum">     325 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     326 </span>            : AliCDBEntry* AliPreprocessor::GetFromOCDB(const char* pathLevel2, const char* pathLevel3)
<span class="lineNum">     327 </span>            : {
<span class="lineNum">     328 </span>            :   // Return object from OCDB valid for current run
<span class="lineNum">     329 </span>            :   //
<span class="lineNum">     330 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     331 </span>            : 
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   const char* offlineDetName = AliShuttleInterface::GetOfflineDetName(GetName());</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   if (!offlineDetName) return 0;</span>
<span class="lineNum">     334 </span>            : 
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   return dynamic_cast&lt;AliCDBEntry*&gt;</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :     (fShuttle-&gt;GetFromOCDB(GetName(), AliCDBPath(offlineDetName, pathLevel2, pathLevel3)));</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 : }</span>
<a name="338"><span class="lineNum">     338 </span>            : </a>
<span class="lineNum">     339 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     340 </span>            : AliCDBEntry* AliPreprocessor::GetGeometryFromOCDB()
<span class="lineNum">     341 </span>            : {
<span class="lineNum">     342 </span>            :   // Return geometry from OCDB (GRP/Geometry/Data) valid for current run
<span class="lineNum">     343 </span>            :   //
<span class="lineNum">     344 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     345 </span>            : 
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :   return dynamic_cast&lt;AliCDBEntry*&gt;</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :     (fShuttle-&gt;GetFromOCDB(GetName(), AliCDBPath(&quot;GRP&quot;, &quot;Geometry&quot;, &quot;Data&quot;)));</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 : }</span>
<a name="349"><span class="lineNum">     349 </span>            : </a>
<span class="lineNum">     350 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     351 </span>            : const char* AliPreprocessor::GetRunType()
<span class="lineNum">     352 </span>            : {
<span class="lineNum">     353 </span>            :   // Return run type string read from &quot;run type&quot; logbook
<span class="lineNum">     354 </span>            :   //
<span class="lineNum">     355 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetRunType();</span>
<span class="lineNum">     358 </span>            : }
<a name="359"><span class="lineNum">     359 </span>            : </a>
<span class="lineNum">     360 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     361 </span>            : Bool_t AliPreprocessor::GetHLTStatus()
<span class="lineNum">     362 </span>            : {
<span class="lineNum">     363 </span>            :   // Return HLT status (ON or OFF)
<span class="lineNum">     364 </span>            :   // Converts the HLT status from the status string read in the run logbook (not just a bool)
<span class="lineNum">     365 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetHLTStatus();</span>
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span>            : }
<a name="370"><span class="lineNum">     370 </span>            : </a>
<span class="lineNum">     371 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     372 </span>            : const char* AliPreprocessor::GetTriggerConfiguration()
<span class="lineNum">     373 </span>            : {
<span class="lineNum">     374 </span>            :   // Returns the trigger configuration which is read from a table in the DAQ logbook
<span class="lineNum">     375 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     376 </span>            :   // Only GRP can call this function.
<span class="lineNum">     377 </span>            : 
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :   if (detName != &quot;GRP&quot;) </span>
<span class="lineNum">     380 </span>            :   {
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :     Log(&quot;GetTriggerConfiguration - Only GRP can call this function.&quot;);</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     383 </span>            :   }
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetTriggerConfiguration();</span>
<a name="386"><span class="lineNum">     386 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     387 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     388 </span>            : const char* AliPreprocessor::GetCTPTimeParams()
<span class="lineNum">     389 </span>            : {
<span class="lineNum">     390 </span>            :   // Returns the CTP timing parameters read from a table in the DAQ logbook
<span class="lineNum">     391 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     392 </span>            :   // Only GRP can call this function.
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :   if (detName != &quot;GRP&quot;) </span>
<span class="lineNum">     396 </span>            :   {
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :     Log(&quot;GetCTPTimeParams - Only GRP can call this function.&quot;);</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     399 </span>            :   }
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetCTPTimeParams();</span>
<a name="402"><span class="lineNum">     402 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     403 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     404 </span>            : const char* AliPreprocessor::GetTriggerDetectorMask()
<span class="lineNum">     405 </span>            : {
<span class="lineNum">     406 </span>            :   // Returns the trigger detector mask which is read from a table in the DAQ logbook
<span class="lineNum">     407 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     408 </span>            :   // Only TRI can call this function.
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :   if (detName != &quot;TRI&quot;) </span>
<span class="lineNum">     412 </span>            :   {
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :     Log(&quot;GetTriggerDetectorMask - Only TRI can call this function.&quot;);</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     415 </span>            :   }
<span class="lineNum">     416 </span>            : 
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetTriggerDetectorMask();</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 : }</span>
<a name="419"><span class="lineNum">     419 </span>            : </a>
<span class="lineNum">     420 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     421 </span>            : void AliPreprocessor::AddRunType(const char* runType)
<span class="lineNum">     422 </span>            : {
<span class="lineNum">     423 </span>            :   // adds the given run type to the list of run types that are processed
<span class="lineNum">     424 </span>            :   // this function should be called in the constructor of the derived preprocessor
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   if (!runType)</span>
<span class="lineNum">     427 </span>            :     return;
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :   fRunTypes.Add(new TObjString(runType));</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 : }</span>
<a name="431"><span class="lineNum">     431 </span>            : </a>
<span class="lineNum">     432 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     433 </span>            : Bool_t AliPreprocessor::AliPreprocessor::ProcessRunType()
<span class="lineNum">     434 </span>            : {
<span class="lineNum">     435 </span>            :   // searches for the current run type in the list of run types that are processed by this
<span class="lineNum">     436 </span>            :   // preprocessor. The list is populated by AddRunType
<span class="lineNum">     437 </span>            : 
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :   const char* runType = GetRunType();</span>
<span class="lineNum">     439 </span>            : 
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :   Log(Form(&quot;Checking if run type %s is in the list of run types to be processed by this preprocessor...&quot;, runType));</span>
<span class="lineNum">     441 </span>            : 
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   if (fRunTypes.GetEntries() == 0)</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :     Log(&quot;WARNING! There are no run types defined. This preprocessor will never run.&quot;);</span>
<span class="lineNum">     444 </span>            : 
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   if (fRunTypes.FindObject(runType))</span>
<span class="lineNum">     446 </span>            :   {
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     Log(&quot;Run type found. Processing this run.&quot;);</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     449 </span>            :   }
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :   Log(&quot;Run type not found. Skipping this run.&quot;);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :   return kFALSE;</span>
<a name="453"><span class="lineNum">     453 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     454 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     455 </span>            : UInt_t AliPreprocessor::GetStartTimeDCSQuery()
<span class="lineNum">     456 </span>            : {
<span class="lineNum">     457 </span>            :   // Return Start Time for the DCS query
<span class="lineNum">     458 </span>            :   //
<span class="lineNum">     459 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     460 </span>            : 
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetStartTimeDCSQuery();</span>
<a name="462"><span class="lineNum">     462 </span>            : }</a>
<span class="lineNum">     463 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     464 </span>            : UInt_t AliPreprocessor::GetEndTimeDCSQuery()
<span class="lineNum">     465 </span>            : {
<span class="lineNum">     466 </span>            :   // Return End Time for the DCS query
<span class="lineNum">     467 </span>            :   //
<span class="lineNum">     468 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetEndTimeDCSQuery();</span>
<span class="lineNum">     471 </span>            : }
<a name="472"><span class="lineNum">     472 </span>            : </a>
<span class="lineNum">     473 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     474 </span>            : const char* AliPreprocessor::GetForeignFile(const char* detector, Int_t system, const char* id, const char* source)
<span class="lineNum">     475 </span>            : {
<span class="lineNum">     476 </span>            :   // This function retrieves a file produced from the given detector (different from the 
<span class="lineNum">     477 </span>            :   // current one) from the given system (kDAQ, kDCS, kHLT) 
<span class="lineNum">     478 </span>            :   // with the given file id
<span class="lineNum">     479 </span>            :   // and from the given source in the system.
<span class="lineNum">     480 </span>            :   // The function returnes the path to the local file.
<span class="lineNum">     481 </span>            :   //
<span class="lineNum">     482 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     483 </span>            :   // The function can be called only from the GRP preprocessor
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :   if (detName != &quot;GRP&quot;) </span>
<span class="lineNum">     487 </span>            :   {
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :     Log(&quot;GetForeignFile - Only GRP can call this function.&quot;);</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     490 </span>            :   }
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetFile(system, detector, id, source);</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 : }</span>
<a name="493"><span class="lineNum">     493 </span>            : </a>
<span class="lineNum">     494 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     495 </span>            : TList* AliPreprocessor::GetForeignFileSources(const char* detector, Int_t system, const char* id)
<span class="lineNum">     496 </span>            : {
<span class="lineNum">     497 </span>            :   // Returns the list of sources in a given system that produced the file 
<span class="lineNum">     498 </span>            :   // with the given id for the foreign detector specified
<span class="lineNum">     499 </span>            :   //
<span class="lineNum">     500 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     501 </span>            :   // The function can be called only from the GRP preprocessor
<span class="lineNum">     502 </span>            : 
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :   TString detName(GetName());</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :   if (detName != &quot;GRP&quot;) </span>
<span class="lineNum">     505 </span>            :   {
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :     Log(&quot;GetForeignFileSources - Only GRP can call this function.&quot;);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     508 </span>            :   }
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetFileSources(system, detector, id);</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 : }</span>
<a name="511"><span class="lineNum">     511 </span>            : </a>
<span class="lineNum">     512 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     513 </span>            : void AliPreprocessor::SendToML(const char* value)
<span class="lineNum">     514 </span>            : {
<span class="lineNum">     515 </span>            :   //
<span class="lineNum">     516 </span>            :   // Sending to ML the information coming from the current detector
<span class="lineNum">     517 </span>            :   //
<span class="lineNum">     518 </span>            : 
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;SendMLFromDet(value);</span>
<a name="520"><span class="lineNum">     520 </span>            : }</a>
<span class="lineNum">     521 </span>            : //______________________________________________________________________________________________
<span class="lineNum">     522 </span>            : TString* AliPreprocessor::GetLTUConfig(const char* det)
<span class="lineNum">     523 </span>            : {
<span class="lineNum">     524 </span>            :   // LTU config from logbook_detector table from DAQ logbook for detector det
<span class="lineNum">     525 </span>            :   //
<span class="lineNum">     526 </span>            :   // The call is delegated to AliShuttleInterface
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :   return fShuttle-&gt;GetLTUConfig(det);</span>
<span class="lineNum">     529 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
