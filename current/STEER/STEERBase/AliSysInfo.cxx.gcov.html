<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - STEER/STEERBase/AliSysInfo.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">STEER/STEERBase</a> - AliSysInfo.cxx<span style="font-size: 80%;"> (source / <a href="AliSysInfo.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">108</td>
            <td class="headerCovTableEntry">162</td>
            <td class="headerCovTableEntryLo">66.7 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">5</td>
            <td class="headerCovTableEntry">13</td>
            <td class="headerCovTableEntryLo">38.5 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : //
<span class="lineNum">      18 </span>            : // Origin:  marian.ivanov@cern.ch
<span class="lineNum">      19 </span>            : //
<span class="lineNum">      20 </span>            : //  Make   a log file for the CPU and Memory usage
<span class="lineNum">      21 </span>            : //
<span class="lineNum">      22 </span>            : //  Principles:
<span class="lineNum">      23 </span>            : //  Snapshots of the system information are writen to the text log files.
<span class="lineNum">      24 </span>            : //  Text files were chosen in order to get the ouptu also in case code 
<span class="lineNum">      25 </span>            : //  is crashing. 
<span class="lineNum">      26 </span>            : //  Following information is stored in the log file:
<span class="lineNum">      27 </span>            : //  TTimeStamp stamp;
<span class="lineNum">      28 </span>            : //  CpuInfo_t  cpuInfo;
<span class="lineNum">      29 </span>            : //  MemInfo_t  memInfo;
<span class="lineNum">      30 </span>            : //  ProcInfo_t procInfo;
<span class="lineNum">      31 </span>            : // 
<span class="lineNum">      32 </span>            : //  Root TSystem is used to retrieve this information:
<span class="lineNum">      33 </span>            : //  gSystem-&gt;GetCpuInfo(&amp;cpuInfo, 10);
<span class="lineNum">      34 </span>            : //  gSystem-&gt;GetMemInfo(&amp;memInfo);
<span class="lineNum">      35 </span>            : //  gSystem-&gt;GetProcInfo(&amp;procInfo);
<span class="lineNum">      36 </span>            : //  for details see:
<span class="lineNum">      37 </span>            : //  http://root.cern.ch/root/html/TUnixSystem.html
<span class="lineNum">      38 </span>            : //  http://root.cern.ch/root/html/ProcInfo_t.html
<span class="lineNum">      39 </span>            : //  http://root.cern.ch/root/html/MemInfo_t.html
<span class="lineNum">      40 </span>            : //  http://root.cern.ch/root/html/CpuInfo_t.html
<span class="lineNum">      41 </span>            : //  -------------------------------------------------------------------
<span class="lineNum">      42 </span>            : //  class CpuInfo_t
<span class="lineNum">      43 </span>            : //   Float_t    fIdle   cpu idle percentage
<span class="lineNum">      44 </span>            : //   Float_t    fLoad15m        cpu load average over 15 m
<span class="lineNum">      45 </span>            : //   Float_t    fLoad1m cpu load average over 1 m
<span class="lineNum">      46 </span>            : //   Float_t    fLoad5m cpu load average over 5 m
<span class="lineNum">      47 </span>            : //   Float_t    fSys    cpu sys load in percentage
<span class="lineNum">      48 </span>            : //   Float_t    fTotal  cpu user+sys load in percentage
<span class="lineNum">      49 </span>            : //   Float_t    fUser   cpu user load in percentage
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            : //  -------------------------------------------------------------------
<span class="lineNum">      52 </span>            : //  class ProcInfo_t:
<span class="lineNum">      53 </span>            : //  Float_t     fCpuSys system time used by this process in seconds
<span class="lineNum">      54 </span>            : //  Float_t     fCpuUser        user time used by this process in seconds
<span class="lineNum">      55 </span>            : //  Long_t      fMemResident    resident memory used by this process in KB
<span class="lineNum">      56 </span>            : //  Long_t      fMemVirtual     virtual memory used by this process in KB
<span class="lineNum">      57 </span>            : //  -------------------------------------------------------------------
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : //  The information from the AliSysInfo can be used as measurement
<span class="lineNum">      61 </span>            : //  of the code quality. Be aware of the limitation induced by
<span class="lineNum">      62 </span>            : //  using only system info described in the  AliSysInfo::Test() function
<span class="lineNum">      63 </span>            : // 
<span class="lineNum">      64 </span>            : //  The example usage of the AliSysInfo is shown in the
<span class="lineNum">      65 </span>            : //  AliSysInfo::Test() example.
<span class="lineNum">      66 </span>            : //  
<span class="lineNum">      67 </span>            : //  
<span class="lineNum">      68 </span>            : //
<span class="lineNum">      69 </span>            : //  
<span class="lineNum">      70 </span>            : //  The typical usage in the AliRoot code:
<span class="lineNum">      71 </span>            : //  Make a set of stamps in the code in the place of interest
<span class="lineNum">      72 </span>            : //  e.g. 
<span class="lineNum">      73 </span>            : //
<span class="lineNum">      74 </span>            : //  AliSysInfo::AddStamp(&quot;Start&quot;);
<span class="lineNum">      75 </span>            : //
<span class="lineNum">      76 </span>            : //  loader-&gt;UnloadRecPoints();
<span class="lineNum">      77 </span>            : //    AliSysInfo::AddStamp(Form(&quot;LRec%s_%d&quot;,fgkDetectorName[iDet],eventNr), iDet,1,eventNr);
<span class="lineNum">      78 </span>            : //
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : // The log file can be transformed to the tree - to make a visualization
<span class="lineNum">      81 </span>            : // See $ALICE_ROOT/macros/PlotSysInfo.C as an example
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span>            : 
<span class="lineNum">      84 </span>            : #include &lt;Riostream.h&gt;
<span class="lineNum">      85 </span>            : //#include &quot;AliLog.h&quot;
<span class="lineNum">      86 </span>            : #include &quot;TStopwatch.h&quot;
<span class="lineNum">      87 </span>            : #include &quot;TSystem.h&quot;
<span class="lineNum">      88 </span>            : #include &quot;TTree.h&quot;
<span class="lineNum">      89 </span>            : #include &quot;TFile.h&quot;
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            : #include &quot;TTimeStamp.h&quot;
<span class="lineNum">      92 </span>            : #include &quot;AliSysInfo.h&quot;
<span class="lineNum">      93 </span>            : #include &quot;TBufferFile.h&quot;
<span class="lineNum">      94 </span>            : #include &quot;TTreePlayer.h&quot;
<span class="lineNum">      95 </span>            : 
<span class="lineNum">      96 </span>            : //#include &quot;TMemStatManager.h&quot;  //USE IFDEF
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : using std::endl;
<span class="lineNum">     100 </span>            : using std::cout;
<a name="101"><span class="lineNum">     101 </span>            : using std::ios_base;</a>
<span class="lineNum">     102 </span>            : using std::setprecision;
<span class="lineNum">     103 </span><span class="lineCov">        176 : ClassImp(AliSysInfo)</span>
<span class="lineNum">     104 </span>            : 
<span class="lineNum">     105 </span>            : AliSysInfo* AliSysInfo::fInstance=0;
<span class="lineNum">     106 </span>            : Bool_t AliSysInfo::fgVerbose = kTRUE;
<a name="107"><span class="lineNum">     107 </span>            : Bool_t AliSysInfo::fgDisabled = kFALSE;</a>
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            : AliSysInfo::AliSysInfo():
<span class="lineNum">     110 </span><span class="lineCov">          3 :     TObject(),</span>
<span class="lineNum">     111 </span><span class="lineCov">          3 :     fSysWatch(0),</span>
<span class="lineNum">     112 </span><span class="lineCov">          3 :     fTimer(0),</span>
<span class="lineNum">     113 </span><span class="lineCov">          3 :     fMemStat(0),</span>
<span class="lineNum">     114 </span><span class="lineCov">          3 :     fCallBackFunc(0),</span>
<span class="lineNum">     115 </span><span class="lineCov">          3 :     fNCallBack(0)</span>
<span class="lineNum">     116 </span><span class="lineCov">         15 : {</span>
<span class="lineNum">     117 </span><span class="lineCov">          3 :   if (fgDisabled) return;</span>
<span class="lineNum">     118 </span><span class="lineCov">          9 :   fTimer = new TStopwatch;</span>
<span class="lineNum">     119 </span><span class="lineCov">          9 :   fSysWatch  = new fstream(&quot;syswatch.log&quot;, ios_base::out|ios_base::trunc);</span>
<span class="lineNum">     120 </span>            : 
<span class="lineNum">     121 </span>            :   //hname/C:sname/C:sec/D:mI.fMemUsed/F:mI.fSwapUsed/F:pI.fMemResident/F:pI.fMemVirtual/F:cI.fUser/F:cI.fSys/F:cI.fCpuUser/F:pI.fCpuSys/F
<span class="lineNum">     122 </span>            : 
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span><span class="lineCov">          6 :   (*fSysWatch) &lt;&lt;&quot;hname&quot;&lt;&lt;&quot;/C:&quot;               // hname - hostname  </span>
<span class="lineNum">     125 </span><span class="lineCov">          6 :                &lt;&lt;&quot;sname&quot;&lt;&lt;&quot;/C:&quot;              // stamp name</span>
<span class="lineNum">     126 </span><span class="lineCov">          6 :                &lt;&lt;&quot;id0&quot;&lt;&lt;&quot;/I:&quot;                // 0 id</span>
<span class="lineNum">     127 </span><span class="lineCov">          6 :                &lt;&lt;&quot;id1&quot;&lt;&lt;&quot;/I:&quot;                // 1 id</span>
<span class="lineNum">     128 </span><span class="lineCov">          6 :                &lt;&lt;&quot;id2&quot;&lt;&lt;&quot;/I:&quot;                // 1 id</span>
<span class="lineNum">     129 </span><span class="lineCov">          6 :                &lt;&lt;&quot;id3&quot;&lt;&lt;&quot;/I:&quot;                // 1 id</span>
<span class="lineNum">     130 </span><span class="lineCov">          6 :                &lt;&lt;&quot;first&quot;&lt;&lt;&quot;/D:&quot;              // first stamp</span>
<span class="lineNum">     131 </span>            :     //
<span class="lineNum">     132 </span><span class="lineCov">          6 :                &lt;&lt;&quot;stampSec&quot;&lt;&lt;&quot;/D:&quot;         // time  - time stamp in seconds</span>
<span class="lineNum">     133 </span><span class="lineCov">          6 :                &lt;&lt;&quot;mi.fMemUsed&quot;&lt;&lt;&quot;/D:&quot;       // system info </span>
<span class="lineNum">     134 </span><span class="lineCov">          6 :                &lt;&lt;&quot;mi.fSwapUsed&quot;&lt;&lt;&quot;/D:&quot;      //</span>
<span class="lineNum">     135 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cI.fUser&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     136 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cI.fSys&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     137 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cI.fLoad1m&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     138 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cI.fLoad5m&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     139 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cI.fLoad15m&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     140 </span>            :     // 
<span class="lineNum">     141 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pI.fMemResident&quot;&lt;&lt;&quot;/D:&quot;  // process info</span>
<span class="lineNum">     142 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pI.fMemVirtual&quot;&lt;&lt;&quot;/D:&quot;   //    </span>
<span class="lineNum">     143 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pI.fCpuUser&quot;&lt;&lt;&quot;/D:&quot;      //</span>
<span class="lineNum">     144 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pI.fCpuSys&quot;&lt;&lt;&quot;/D:&quot;       //</span>
<span class="lineNum">     145 </span>            :     //
<span class="lineNum">     146 </span><span class="lineCov">          6 :                &lt;&lt;&quot;stampOldSec&quot;&lt;&lt;&quot;/D:&quot;         // time  - time stamp in seconds</span>
<span class="lineNum">     147 </span><span class="lineCov">          6 :                &lt;&lt;&quot;miOld.fMemUsed&quot;&lt;&lt;&quot;/D:&quot;       // system info - previous</span>
<span class="lineNum">     148 </span><span class="lineCov">          6 :                &lt;&lt;&quot;miOld.fSwapUsed&quot;&lt;&lt;&quot;/D:&quot;      //</span>
<span class="lineNum">     149 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cIOld.fUser&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     150 </span><span class="lineCov">          6 :                &lt;&lt;&quot;cIOld.fSys&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     151 </span>            :     // 
<span class="lineNum">     152 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pIOld.fMemResident&quot;&lt;&lt;&quot;/D:&quot;  // process info -previous</span>
<span class="lineNum">     153 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pIOld.fMemVirtual&quot;&lt;&lt;&quot;/D:&quot;   //    </span>
<span class="lineNum">     154 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pIOld.fCpuUser&quot;&lt;&lt;&quot;/D:&quot;      //</span>
<span class="lineNum">     155 </span><span class="lineCov">          6 :                &lt;&lt;&quot;pIOld.fCpuSys&quot;&lt;&lt;&quot;/D:&quot;       //</span>
<span class="lineNum">     156 </span>            :     // 
<span class="lineNum">     157 </span><span class="lineCov">          6 :                &lt;&lt;&quot;fileBytesRead&quot;&lt;&lt;&quot;/D:&quot;       // file IO information</span>
<span class="lineNum">     158 </span><span class="lineCov">          6 :                &lt;&lt;&quot;fileBytesWritten&quot;&lt;&lt;&quot;/D:&quot;    //    </span>
<span class="lineNum">     159 </span><span class="lineCov">          6 :                &lt;&lt;&quot;fileCounter&quot;&lt;&lt;&quot;/D:&quot;         //</span>
<span class="lineNum">     160 </span><span class="lineCov">          6 :                &lt;&lt;&quot;fileReadCalls&quot;&lt;&lt;&quot;/D&quot;        //</span>
<span class="lineNum">     161 </span><span class="lineCov">          3 :                &lt;&lt; endl;</span>
<span class="lineNum">     162 </span>            :   
<span class="lineNum">     163 </span><span class="lineCov">          6 : }</span>
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            : 
<a name="166"><span class="lineNum">     166 </span>            : </a>
<span class="lineNum">     167 </span>            : 
<span class="lineNum">     168 </span>            : AliSysInfo * AliSysInfo::Instance(){
<span class="lineNum">     169 </span>            :   //
<span class="lineNum">     170 </span>            :   //
<span class="lineNum">     171 </span>            :   //
<span class="lineNum">     172 </span><span class="lineCov">       2952 :   if (!fInstance){</span>
<span class="lineNum">     173 </span><span class="lineCov">          6 :     fInstance = new AliSysInfo;</span>
<span class="lineNum">     174 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">     175 </span><span class="lineCov">       1476 :   return fInstance;</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 : }</span>
<a name="177"><span class="lineNum">     177 </span>            : </a>
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span>            : void AliSysInfo::AddStamp(const char *sname, Int_t id0, Int_t id1, Int_t id2, Int_t id3){
<span class="lineNum">     180 </span>            :   //
<span class="lineNum">     181 </span>            :   // 
<span class="lineNum">     182 </span><span class="lineCov">       1476 :   if (!fgVerbose) return;</span>
<span class="lineNum">     183 </span>            :   //
<span class="lineNum">     184 </span>            :   //
<span class="lineNum">     185 </span><span class="lineCov">        738 :   TTimeStamp stamp;</span>
<span class="lineNum">     186 </span><span class="lineCov">        738 :   CpuInfo_t  cpuInfo;</span>
<span class="lineNum">     187 </span><span class="lineCov">        738 :   MemInfo_t  memInfo;</span>
<span class="lineNum">     188 </span><span class="lineCov">        738 :   ProcInfo_t procInfo;  </span>
<span class="lineNum">     189 </span><span class="lineCov">        738 :   gSystem-&gt;GetCpuInfo(&amp;cpuInfo, 10);</span>
<span class="lineNum">     190 </span><span class="lineCov">        738 :   gSystem-&gt;GetMemInfo(&amp;memInfo);</span>
<span class="lineNum">     191 </span><span class="lineCov">        738 :   gSystem-&gt;GetProcInfo(&amp;procInfo);</span>
<span class="lineNum">     192 </span>            :   //  procInfo.fMemVirtual/=1024;  //size in MBy
<span class="lineNum">     193 </span>            :   //procInfo.fMemResident/=1024;  //size in MBy
<span class="lineNum">     194 </span>            : 
<span class="lineNum">     195 </span><span class="lineCov">        738 :   const char * hname = gSystem-&gt;HostName();</span>
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :   static Int_t entry=0;
<span class="lineNum">     198 </span><span class="lineCov">        744 :   static Double_t  first=stamp.GetSec()+stamp.GetNanoSec()/1000000000.;</span>
<span class="lineNum">     199 </span>            :   //
<span class="lineNum">     200 </span><span class="lineCov">        747 :   static TTimeStamp stampOld;</span>
<span class="lineNum">     201 </span><span class="lineCov">        747 :   static CpuInfo_t  cpuInfoOld;</span>
<span class="lineNum">     202 </span><span class="lineCov">        747 :   static MemInfo_t  memInfoOld;</span>
<span class="lineNum">     203 </span><span class="lineCov">        747 :   static ProcInfo_t procInfoOld;  </span>
<span class="lineNum">     204 </span><span class="lineCov">       1476 :   Double_t fileBytesRead    = TFile::GetFileBytesRead();</span>
<span class="lineNum">     205 </span><span class="lineCov">       1476 :   Double_t fileBytesWritten = TFile::GetFileBytesWritten();</span>
<span class="lineNum">     206 </span><span class="lineCov">       1476 :   Double_t fileCounter      = TFile::GetFileCounter();</span>
<span class="lineNum">     207 </span><span class="lineCov">       1476 :   Double_t fileReadCalls    = TFile::GetFileReadCalls();</span>
<span class="lineNum">     208 </span>            : 
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineCov">       1476 :   (*(Instance()-&gt;fSysWatch)) </span>
<span class="lineNum">     211 </span><span class="lineCov">       1476 :     &lt;&lt; hname   &lt;&lt;&quot;\t&quot;               // hname - hostname  </span>
<span class="lineNum">     212 </span><span class="lineCov">       1476 :     &lt;&lt; sname    &lt;&lt;&quot;\t&quot;              // stamp name</span>
<span class="lineNum">     213 </span><span class="lineCov">       1476 :     &lt;&lt; id0      &lt;&lt;&quot;\t&quot;</span>
<span class="lineNum">     214 </span><span class="lineCov">       1476 :     &lt;&lt; id1      &lt;&lt;&quot;\t&quot;</span>
<span class="lineNum">     215 </span><span class="lineCov">       1476 :     &lt;&lt; id2      &lt;&lt;&quot;\t&quot;</span>
<span class="lineNum">     216 </span><span class="lineCov">       1476 :     &lt;&lt; id3      &lt;&lt;&quot;\t&quot;</span>
<span class="lineNum">     217 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; first    &lt;&lt;&quot;\t&quot;              // first stamp               </span>
<span class="lineNum">     218 </span>            :     //
<span class="lineNum">     219 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; stamp.GetSec()+stamp.GetNanoSec()/1000000000.&lt;&lt;&quot;\t&quot;         // time  - time stamp in seconds</span>
<span class="lineNum">     220 </span><span class="lineCov">       1476 :     &lt;&lt; memInfo.fMemUsed&lt;&lt;&quot;\t&quot;       // system info </span>
<span class="lineNum">     221 </span><span class="lineCov">       1476 :     &lt;&lt; memInfo.fSwapUsed&lt;&lt;&quot;\t&quot;      //</span>
<span class="lineNum">     222 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfo.fUser &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     223 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfo.fSys  &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     224 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfo.fLoad1m  &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     225 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfo.fLoad5m  &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     226 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfo.fLoad15m  &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     227 </span>            :     // 
<span class="lineNum">     228 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; procInfo.fMemResident/1024.&lt;&lt;&quot;\t&quot;  // process info</span>
<span class="lineNum">     229 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; procInfo.fMemVirtual/1024.&lt;&lt;&quot;\t&quot;   //    </span>
<span class="lineNum">     230 </span><span class="lineCov">       1476 :     &lt;&lt; procInfo.fCpuUser&lt;&lt;&quot;\t&quot;      //</span>
<span class="lineNum">     231 </span><span class="lineCov">       1476 :     &lt;&lt; procInfo.fCpuSys&lt;&lt;&quot;\t&quot;       //</span>
<span class="lineNum">     232 </span>            :     //
<span class="lineNum">     233 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; stampOld.GetSec()+stampOld.GetNanoSec()/1000000000.&lt;&lt;&quot;\t&quot;         // time  - time stamp in seconds</span>
<span class="lineNum">     234 </span><span class="lineCov">       1476 :     &lt;&lt; memInfoOld.fMemUsed&lt;&lt;&quot;\t&quot;       // system info - previous</span>
<span class="lineNum">     235 </span><span class="lineCov">       1476 :     &lt;&lt; memInfoOld.fSwapUsed&lt;&lt;&quot;\t&quot;      //</span>
<span class="lineNum">     236 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfoOld.fUser &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     237 </span><span class="lineCov">       1476 :     &lt;&lt; cpuInfoOld.fSys  &lt;&lt;&quot;\t&quot;         //</span>
<span class="lineNum">     238 </span>            :     // 
<span class="lineNum">     239 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; procInfoOld.fMemResident/1024.&lt;&lt;&quot;\t&quot;  // process info -previous</span>
<span class="lineNum">     240 </span><span class="lineCov">       2952 :     &lt;&lt;setprecision(15)&lt;&lt; procInfoOld.fMemVirtual/1024.&lt;&lt;&quot;\t&quot;   //    </span>
<span class="lineNum">     241 </span><span class="lineCov">       1476 :     &lt;&lt; procInfoOld.fCpuUser&lt;&lt;&quot;\t&quot;      //</span>
<span class="lineNum">     242 </span><span class="lineCov">       1476 :     &lt;&lt; procInfoOld.fCpuSys&lt;&lt;&quot;\t&quot;       //</span>
<span class="lineNum">     243 </span>            :     //
<span class="lineNum">     244 </span><span class="lineCov">       1476 :     &lt;&lt;fileBytesRead&lt;&lt;&quot;\t&quot;           // file IO information</span>
<span class="lineNum">     245 </span><span class="lineCov">       1476 :     &lt;&lt;fileBytesWritten&lt;&lt;&quot;\t&quot;        //    </span>
<span class="lineNum">     246 </span><span class="lineCov">       1476 :     &lt;&lt;fileCounter&lt;&lt;&quot;\t&quot;             //</span>
<span class="lineNum">     247 </span><span class="lineCov">       1476 :     &lt;&lt;fileReadCalls&lt;&lt;&quot;\t&quot;            //</span>
<span class="lineNum">     248 </span><span class="lineCov">        738 :     &lt;&lt; endl;</span>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineCov">        738 :   stampOld   = stamp;</span>
<span class="lineNum">     251 </span><span class="lineCov">        738 :   cpuInfoOld = cpuInfo;</span>
<span class="lineNum">     252 </span><span class="lineCov">        738 :   memInfoOld = memInfo;</span>
<span class="lineNum">     253 </span><span class="lineCov">        738 :   procInfoOld= procInfo;</span>
<span class="lineNum">     254 </span>            : 
<span class="lineNum">     255 </span>            :   //  if (fInstance-&gt;fMemStat) fInstance-&gt;fMemStat-&gt;AddStamps(sname);
<span class="lineNum">     256 </span><span class="lineCov">       2214 :   for (Int_t icallback=0; icallback&lt;Instance()-&gt;fNCallBack; icallback++){</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :     Instance()-&gt;fCallBackFunc[icallback](sname);</span>
<span class="lineNum">     258 </span>            :   }
<span class="lineNum">     259 </span><span class="lineCov">        738 :   entry++;</span>
<span class="lineNum">     260 </span><span class="lineCov">       1476 : }</span>
<a name="261"><span class="lineNum">     261 </span>            : </a>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span>            : TTree * AliSysInfo::MakeTree(const char *lname, const char * fout){
<span class="lineNum">     264 </span>            :   // char * lname = &quot;syswatch.log&quot;
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :   TTree * tree = new TTree;</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :   tree-&gt;ReadFile(lname);</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;deltaT&quot;,&quot;stampSec-stampOldSec&quot;);</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;T&quot;,&quot;stampSec-first&quot;);</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;deltaVM&quot;,&quot;(pI.fMemVirtual-pIOld.fMemVirtual)&quot;);</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;VM&quot;,&quot;pI.fMemVirtual&quot;);</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;deltaRM&quot;,&quot;(pI.fMemResident-pIOld.fMemResident)&quot;);</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   tree-&gt;SetAlias(&quot;RM&quot;,&quot;pI.fMemResident&quot;);</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   if (fout!=0){</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :     TFile * f = TFile::Open(fout,&quot;recreate&quot;);</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :     f-&gt;cd();</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     tree-&gt;Write(&quot;AliSysInfo&quot;);</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     delete f;</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :   return tree;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 : }</span>
<a name="281"><span class="lineNum">     281 </span>            : </a>
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span>            : Bool_t AliSysInfo::Contain(const char * str1, const char * str2){
<span class="lineNum">     284 </span>            :   //
<span class="lineNum">     285 </span>            :   //
<span class="lineNum">     286 </span>            :   //
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   TString str(str1);</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   return str.Contains(str2);</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     290 </span>            : 
<a name="291"><span class="lineNum">     291 </span>            : </a>
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span>            : void AliSysInfo::OpenMemStat(){
<span class="lineNum">     294 </span>            :   //
<span class="lineNum">     295 </span>            :   //
<span class="lineNum">     296 </span>            :   //
<span class="lineNum">     297 </span>            :   //USE IFDEF if MEMSTAT ENABLED  
<span class="lineNum">     298 </span>            :   //  Instance()-&gt;fMemStat = TMemStatManager::GetInstance();
<span class="lineNum">     299 </span>            :   //   Instance()-&gt;fMemStat-&gt;SetAutoStamp(10000000, 10000000,1000000);
<span class="lineNum">     300 </span>            :   //   Instance()-&gt;fMemStat-&gt;Enable();  
<a name="301"><span class="lineNum">     301 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span>            : void AliSysInfo::CloseMemStat(){
<span class="lineNum">     304 </span>            :   //
<span class="lineNum">     305 </span>            :   //
<span class="lineNum">     306 </span>            :   //
<span class="lineNum">     307 </span>            :   //USE IFDEF if MEMSTAT ENABLED
<span class="lineNum">     308 </span>            :   //if (Instance()-&gt;fMemStat  == TMemStatManager::GetInstance()) Instance()-&gt;fMemStat-&gt;Close();
<span class="lineNum">     309 </span>            :   //Instance()-&gt;fMemStat=0;
<span class="lineNum">     310 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     311 </span>            : 
<a name="312"><span class="lineNum">     312 </span>            : </a>
<span class="lineNum">     313 </span>            : 
<span class="lineNum">     314 </span>            : void AliSysInfo::AddCallBack(StampCallback_t callback){
<span class="lineNum">     315 </span>            :   //
<span class="lineNum">     316 </span>            :   // add cal back function
<span class="lineNum">     317 </span>            :   //
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :   AliSysInfo *info =  Instance();</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :   if (!info-&gt;fCallBackFunc)</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :     info-&gt;fCallBackFunc = new StampCallback_t[100];</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :   info-&gt;fCallBackFunc[info-&gt;fNCallBack]=callback;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   info-&gt;fNCallBack++;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     324 </span>            : 
<a name="325"><span class="lineNum">     325 </span>            : </a>
<span class="lineNum">     326 </span>            : 
<span class="lineNum">     327 </span>            : TTree*  AliSysInfo::Test(){
<span class="lineNum">     328 </span>            :   //
<span class="lineNum">     329 </span>            :   // Test example for AliSysInfo:
<span class="lineNum">     330 </span>            :   // 1. Make huge memory leak
<span class="lineNum">     331 </span>            :   // 2. Slow down execution
<span class="lineNum">     332 </span>            :   /*
<span class="lineNum">     333 </span>            :     To use the test:
<span class="lineNum">     334 </span>            :     TTree * tree = AliSysInfo::Test();
<span class="lineNum">     335 </span>            :     // Make alias what we set as input
<span class="lineNum">     336 </span>            :     tree-&gt;SetAlias(&quot;deltaVMIn&quot;,&quot;(id0*100000+id1*10000+id2*1000)/1000000.&quot;)
<span class="lineNum">     337 </span>            :     tree-&gt;SetAlias(&quot;deltaVM&quot;,&quot;(pI.fMemVirtual-pIOld.fMemVirtual)&quot;);
<span class="lineNum">     338 </span>            :     tree-&gt;SetAlias(&quot;deltaTIn&quot;,&quot;(id1+id0*10)&quot;);
<span class="lineNum">     339 </span>            :     tree-&gt;SetAlias(&quot;deltaT&quot;,&quot;stampSec-stampOldSec&quot;);
<span class="lineNum">     340 </span>            :     //
<span class="lineNum">     341 </span>            :     tree-&gt;SetMarkerStyle(23); tree-&gt;SetMarkerSize(0.5);
<span class="lineNum">     342 </span>            :     // Memory usage
<span class="lineNum">     343 </span>            :     tree-&gt;Draw(&quot;deltaVM:deltaVMIn&quot;,&quot;Entry$&gt;0&quot;);
<span class="lineNum">     344 </span>            :     // or alternative
<span class="lineNum">     345 </span>            :     tree-&gt;Draw(&quot;deltaVM:deltaVMIn&quot;,&quot;Entry$&gt;0&quot;,&quot;prof&quot;);
<span class="lineNum">     346 </span>            :     //
<span class="lineNum">     347 </span>            :     // draw time usage
<span class="lineNum">     348 </span>            :     tree-&gt;Draw(&quot;deltaT:deltaTIn&quot;,&quot;Entry$&gt;0&quot;); 
<span class="lineNum">     349 </span>            :   */
<span class="lineNum">     350 </span>            :   //
<span class="lineNum">     351 </span>            :   // The delta of VM as obtained from the AliSysInfo starts to be proportional
<span class="lineNum">     352 </span>            :   // to  the input allocation after 0.12 MBy (and it is system dependent) 
<span class="lineNum">     353 </span>            :   // Bellow these limit the deltaVM can be used only in mean.
<span class="lineNum">     354 </span>            :   // (compare first and  profile histogram)
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :   for (Int_t id0=0; id0&lt;5; id0++)</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     for (Int_t id1=1; id1&lt;10; id1++)</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :       for (Int_t id2=0; id2&lt;20; id2++){</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :         new Char_t[id2*1000+id1*10000+id0*100000];  // emulate memory leak</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :         gSystem-&gt;Sleep(id1+id0*10);         // emulate CPU usage </span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :         AliSysInfo::AddStamp(&quot;Leak&quot;,id0,id1,id2);</span>
<span class="lineNum">     361 </span>            :       }
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :   TTree * tree = AliSysInfo::MakeTree(&quot;syswatch.log&quot;);</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   return tree;  </span>
<a name="364"><span class="lineNum">     364 </span>            : }</a>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span>            : Double_t AliSysInfo::EstimateObjectSize(TObject* object){
<span class="lineNum">     367 </span>            :   //
<span class="lineNum">     368 </span>            :   // Estimate size of object as represented in the memory size in bytes
<span class="lineNum">     369 </span>            :   // Warnings:
<span class="lineNum">     370 </span>            :   //  1. Only data memebrs which are persistent are counted
<span class="lineNum">     371 </span>            :   //  2. Local copy of the object is temporary created in memory
<span class="lineNum">     372 </span>            :   //  3. Do not use it in standard programs, time and memory consument procedure
<span class="lineNum">     373 </span>            :   //
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   if (!object) return 0;</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   TBufferFile * file = new TBufferFile(TBuffer::kWrite);</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   file-&gt;WriteObject(object);</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :   Double_t size=file-&gt;Length();</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   delete file;</span>
<span class="lineNum">     379 </span>            :   return size;
<span class="lineNum">     380 </span><span class="lineNoCov">          0 : }</span>
<a name="381"><span class="lineNum">     381 </span>            : </a>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span>            : void  AliSysInfo::PrintJiraTable(TTree * tree, const char *var, const char *cut, const char *format, const char *outputTable){
<span class="lineNum">     384 </span>            :   //
<span class="lineNum">     385 </span>            :   // Print Tree query table as a JIRA table
<span class="lineNum">     386 </span>            :   // Generic implementation using &quot;custom format&quot; in the future, e.g to print html tables
<span class="lineNum">     387 </span>            :   // 
<span class="lineNum">     388 </span>            :   /*
<span class="lineNum">     389 </span>            :     Example:
<span class="lineNum">     390 </span>            :     AliSysInfo::PrintJiraTable(tree, &quot;deltaT:sname&quot;, &quot;deltaT&gt;0&quot;, &quot;col=10:100&quot;, &quot;syswatch.table&quot;);
<span class="lineNum">     391 </span>            :     AliSysInfo::PrintJiraTable(tree, &quot;deltaT:sname&quot;, &quot;deltaT&gt;0&quot;, &quot;col=10:100&quot;, 0);
<span class="lineNum">     392 </span>            :     AliSysInfo::PrintJiraTable(tree, &quot;deltaT:sname:fileReadCalls:fileBytesRead/1000000&quot;, &quot;deltaT&gt;0&quot;, &quot;col=10:100:25:15&quot;, 0);
<span class="lineNum">     393 </span>            :   */
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   tree-&gt;SetScanField(tree-&gt;GetEntries());</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :   ((TTreePlayer*)(tree-&gt;GetPlayer()))-&gt;SetScanRedirect(true);</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :   ((TTreePlayer*)(tree-&gt;GetPlayer()))-&gt;SetScanFileName(&quot;AliSysInfo.PrintJiraTable.tmp0&quot;);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   tree-&gt;Scan(var,cut,format);</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   ((TTreePlayer*)(tree-&gt;GetPlayer()))-&gt;SetScanRedirect(0);</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   gSystem-&gt;Exec(&quot;cat AliSysInfo.PrintJiraTable.tmp0 | sed s_*_\&quot;|\&quot;_g | grep -v \&quot;|||\&quot; &gt; AliSysInfo.PrintJiraTable.tmp1&quot;);</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   if (outputTable==0){</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :     gSystem-&gt;Exec(&quot;cat AliSysInfo.PrintJiraTable.tmp1&quot;);</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   }else{</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :     gSystem-&gt;Exec(TString::Format(&quot;mv AliSysInfo.PrintJiraTable.tmp1 %s&quot;, outputTable).Data());</span>
<span class="lineNum">     404 </span>            :   }
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
