<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - PHOS/PHOSsim/AliPHOSv0.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">PHOS/PHOSsim</a> - AliPHOSv0.cxx<span style="font-size: 80%;"> (source / <a href="AliPHOSv0.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">331</td>
            <td class="headerCovTableEntry">494</td>
            <td class="headerCovTableEntryLo">67.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">7</td>
            <td class="headerCovTableEntry">11</td>
            <td class="headerCovTableEntryLo">63.6 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : /* $Id$ */
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : /* History of cvs commits:
<span class="lineNum">      18 </span>            :  *
<span class="lineNum">      19 </span>            :  * $Log$
<span class="lineNum">      20 </span>            :  * Revision 1.94  2007/10/18 08:40:02  kharlov
<span class="lineNum">      21 </span>            :  * Misalignment-related bug fixed
<span class="lineNum">      22 </span>            :  *
<span class="lineNum">      23 </span>            :  * Revision 1.93  2007/10/06 22:24:40  kharlov
<span class="lineNum">      24 </span>            :  * Bug in strip unit geometry is corrected
<span class="lineNum">      25 </span>            :  *
<span class="lineNum">      26 </span>            :  * Revision 1.92  2007/07/04 16:38:19  policheh
<span class="lineNum">      27 </span>            :  * Tracking2LocalCS matrices corrected for CPV.
<span class="lineNum">      28 </span>            :  *
<span class="lineNum">      29 </span>            :  * Revision 1.91  2007/07/02 14:50:49  policheh
<span class="lineNum">      30 </span>            :  * Tracking2LocalCS matrices corrected.
<span class="lineNum">      31 </span>            :  *
<span class="lineNum">      32 </span>            :  * Revision 1.90  2007/05/24 13:04:05  policheh
<span class="lineNum">      33 </span>            :  * AddAlignableVolumes: local to tracking CS transformation matrices creates for each
<span class="lineNum">      34 </span>            :  * PHOS supermodule
<span class="lineNum">      35 </span>            :  *
<span class="lineNum">      36 </span>            :  * Revision 1.89  2007/04/24 14:34:39  hristov
<span class="lineNum">      37 </span>            :  * Additional protection: do not search for alignable object if the CPV is not in the geometry
<span class="lineNum">      38 </span>            :  *
<span class="lineNum">      39 </span>            :  * Revision 1.88  2007/04/19 15:28:30  kharlov
<span class="lineNum">      40 </span>            :  * Modify strip unit geometry according to the final drawings (Timur)
<span class="lineNum">      41 </span>            :  *
<span class="lineNum">      42 </span>            :  * Revision 1.87  2007/04/01 07:37:10  kharlov
<span class="lineNum">      43 </span>            :  * TGeo RS to Local RS transf matr added
<span class="lineNum">      44 </span>            :  *
<span class="lineNum">      45 </span>            :  * Revision 1.86  2007/03/06 06:55:46  kharlov
<span class="lineNum">      46 </span>            :  * DP:Misalignment of CPV added
<span class="lineNum">      47 </span>            :  *
<span class="lineNum">      48 </span>            :  * Revision 1.85  2007/03/01 11:37:37  kharlov
<span class="lineNum">      49 </span>            :  * Strip units changed from 8x1 to 8x2 (T.Pocheptsov)
<span class="lineNum">      50 </span>            :  *
<span class="lineNum">      51 </span>            :  * Revision 1.84  2006/12/20 16:56:43  kharlov
<span class="lineNum">      52 </span>            :  * Optional geometry without CPV
<span class="lineNum">      53 </span>            :  *
<span class="lineNum">      54 </span>            :  * Revision 1.83  2006/11/14 17:11:15  hristov
<span class="lineNum">      55 </span>            :  * Removing inheritances from TAttLine, TAttMarker and AliRndm in AliModule. The copy constructor and assignment operators are moved to the private part of the class and not implemented. The corresponding changes are propagated to the detectors
<span class="lineNum">      56 </span>            :  *
<span class="lineNum">      57 </span>            :  * Revision 1.82  2006/09/27 19:55:57  kharlov
<span class="lineNum">      58 </span>            :  * Alignment object with symbolic volume names are introduced
<span class="lineNum">      59 </span>            :  *
<span class="lineNum">      60 </span>            :  * Revision 1.81  2006/03/04 20:25:56  kharlov
<span class="lineNum">      61 </span>            :  * Set geom parameters from CDB
<span class="lineNum">      62 </span>            :  *
<span class="lineNum">      63 </span>            :  * Revision 1.80  2005/06/17 07:39:07  hristov
<span class="lineNum">      64 </span>            :  * Removing GetDebug and SetDebug from AliRun and AliModule. Using AliLog for the messages
<span class="lineNum">      65 </span>            :  *
<span class="lineNum">      66 </span>            :  * Revision 1.79  2005/05/28 14:19:05  schutz
<span class="lineNum">      67 </span>            :  * Compilation warnings fixed by T.P.
<span class="lineNum">      68 </span>            :  *
<span class="lineNum">      69 </span>            :  */
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span>            : //_________________________________________________________________________
<span class="lineNum">      72 </span>            : // Implementation version v0 of PHOS Manager class 
<span class="lineNum">      73 </span>            : // An object of this class does not produce hits nor digits
<span class="lineNum">      74 </span>            : // It is the one to use if you do not want to produce outputs in TREEH or TREED
<span class="lineNum">      75 </span>            : //                  
<span class="lineNum">      76 </span>            : //*-- Author: Yves Schutz (SUBATECH) &amp; Dmitri Peressounko (RRC KI &amp; SUBATECH)
<span class="lineNum">      77 </span>            : 
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : // --- ROOT system ---
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span>            : #include &lt;TFolder.h&gt;
<span class="lineNum">      82 </span>            : #include &lt;TGeometry.h&gt;
<span class="lineNum">      83 </span>            : #include &lt;TROOT.h&gt;
<span class="lineNum">      84 </span>            : #include &lt;TRandom.h&gt;
<span class="lineNum">      85 </span>            : #include &lt;TTree.h&gt;
<span class="lineNum">      86 </span>            : #include &lt;TVirtualMC.h&gt;
<span class="lineNum">      87 </span>            : #include &lt;TGeoPhysicalNode.h&gt;
<span class="lineNum">      88 </span>            : #include &lt;TGeoManager.h&gt;
<span class="lineNum">      89 </span>            : #include &lt;TGeoMatrix.h&gt;
<span class="lineNum">      90 </span>            : #include &lt;TVector3.h&gt;
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span>            : // --- Standard library ---
<span class="lineNum">      93 </span>            : 
<span class="lineNum">      94 </span>            : #include &lt;string.h&gt;
<span class="lineNum">      95 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      96 </span>            : 
<span class="lineNum">      97 </span>            : // --- AliRoot header files ---
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : #include &quot;AliConst.h&quot;
<span class="lineNum">     100 </span>            : #include &quot;AliPHOSGeometry.h&quot;
<span class="lineNum">     101 </span>            : #include &quot;AliPHOSLoader.h&quot;
<span class="lineNum">     102 </span>            : #include &quot;AliPHOSv0.h&quot;
<span class="lineNum">     103 </span>            : #include &quot;AliRun.h&quot;
<span class="lineNum">     104 </span>            : #include &quot;AliLog.h&quot;
<a name="105"><span class="lineNum">     105 </span>            : #include &quot;AliGeomManager.h&quot;</a>
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span><span class="lineCov">         20 : ClassImp(AliPHOSv0)</span>
<a name="108"><span class="lineNum">     108 </span>            : </a>
<span class="lineNum">     109 </span>            : //____________________________________________________________________________
<span class="lineNum">     110 </span>            : AliPHOSv0::AliPHOSv0(const char *name, const char *title): 
<span class="lineNum">     111 </span><span class="lineCov">          1 :   AliPHOS(name,title),</span>
<span class="lineNum">     112 </span><span class="lineCov">          1 :  fCreateCPV(kFALSE), </span>
<span class="lineNum">     113 </span><span class="lineCov">          1 :  fCreateHalfMod(kFALSE) </span>
<span class="lineNum">     114 </span><span class="lineCov">          3 : {</span>
<span class="lineNum">     115 </span>            :   // ctor : title is used to identify the layout
<span class="lineNum">     116 </span>            :   //Check possible configurations  
<span class="lineNum">     117 </span>            :   
<span class="lineNum">     118 </span><span class="lineCov">         14 :   for(Int_t mod=0; mod&lt;6; mod++){</span>
<span class="lineNum">     119 </span><span class="lineCov">          6 :     fActiveModule[mod]=kFALSE ;</span>
<span class="lineNum">     120 </span><span class="lineCov">          6 :     fActiveCPV[mod]=kFALSE ;</span>
<span class="lineNum">     121 </span>            :   }
<span class="lineNum">     122 </span>            :   //Default geometries
<span class="lineNum">     123 </span>            :   //for period 2009-2013
<span class="lineNum">     124 </span><span class="lineCov">          2 :   if(strstr(title,&quot;Run1&quot;)!=0){</span>
<span class="lineNum">     125 </span><span class="lineCov">          1 :     fCreateCPV=kFALSE ;</span>
<span class="lineNum">     126 </span><span class="lineCov">          1 :     fCreateHalfMod=kFALSE;</span>
<span class="lineNum">     127 </span><span class="lineCov">          1 :     fActiveModule[1]=kTRUE ;</span>
<span class="lineNum">     128 </span><span class="lineCov">          1 :     fActiveModule[2]=kTRUE ;</span>
<span class="lineNum">     129 </span><span class="lineCov">          1 :     fActiveModule[3]=kTRUE ;</span>
<span class="lineNum">     130 </span>            :     //NO CPV in Run1   
<span class="lineNum">     131 </span><span class="lineCov">          1 :   }</span>
<span class="lineNum">     132 </span>            :   else{
<span class="lineNum">     133 </span>            :     //for period 2015-2018
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     if(strstr(title,&quot;Run2&quot;)!=0){</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :       fCreateCPV=kTRUE ;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :       fCreateHalfMod=kTRUE;</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :       fActiveModule[1]=kTRUE ;</span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :       fActiveModule[2]=kTRUE ;</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :       fActiveModule[3]=kTRUE ;</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :       fActiveModule[4]=kTRUE ;</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :       fActiveCPV[3]=kTRUE ;</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     143 </span>            :     else{
<span class="lineNum">     144 </span>            :      //custom geometry can be set in form
<span class="lineNum">     145 </span>            :      //Modxxx_CPVyyy, where xxx- list of PHOS modules in geometry, yyy -list of modules with CPVallFront
<span class="lineNum">     146 </span>            :      Bool_t isOK=kFALSE ;
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :      TString a(title); </span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :      Int_t modPos=a.Index(&quot;Mod&quot;,0,TString::kIgnoreCase) ;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :      Int_t cpvPos=a.Index(&quot;CPV&quot;,0,TString::kIgnoreCase) ;</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :      Int_t size = a.Sizeof() ;</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :      Int_t modEnd=(cpvPos&gt;modPos)?cpvPos:size ;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :      Int_t cpvEnd=(cpvPos&gt;modPos)?size:modPos ;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :      for(Int_t mod=1; mod&lt;6; mod++){</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :        Int_t imod=a.Index(Form(&quot;%d&quot;,mod),modPos);</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :        if(imod&gt;modPos &amp;&amp; imod&lt;modEnd){</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :          fActiveModule[mod]=kTRUE ;</span>
<span class="lineNum">     157 </span>            :          isOK=kTRUE ;
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :          if(mod==4)</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :            fCreateHalfMod=kTRUE;</span>
<span class="lineNum">     160 </span>            :        }
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :        Int_t icpv=a.Index(Form(&quot;%d&quot;,mod),cpvPos);</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :        if(icpv&gt;cpvPos &amp;&amp; icpv&lt;cpvEnd){</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :          fActiveCPV[mod]=kTRUE ;</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :          fCreateCPV=kTRUE ;</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :        }</span>
<span class="lineNum">     166 </span>            :      }
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :      if(!isOK){</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :        AliFatal(Form(&quot;Unknown PHOS configuration: %s. Possible: 'Run1' for 2009-2013, 'Run2' for 2015-2018', 'Modxxx_CPVyyy' for castom&quot;,title)) ; </span>
<span class="lineNum">     169 </span>            :      }
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     171 </span>            :   }
<span class="lineNum">     172 </span>            :    
<span class="lineNum">     173 </span><span class="lineCov">          1 :   GetGeometry() ; </span>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span>            :   
<span class="lineNum">     176 </span><span class="lineCov">          1 : }</span>
<a name="177"><span class="lineNum">     177 </span>            : </a>
<span class="lineNum">     178 </span>            : //____________________________________________________________________________
<span class="lineNum">     179 </span>            : void AliPHOSv0::CreateGeometry()
<span class="lineNum">     180 </span>            : {
<span class="lineNum">     181 </span>            :   // Create the PHOS geometry for Geant
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span><span class="lineCov">          4 :   AliPHOSv0 *phostmp = dynamic_cast&lt;AliPHOSv0*&gt;(gAlice-&gt;GetModule(&quot;PHOS&quot;)) ;</span>
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span><span class="lineCov">          1 :   if ( phostmp == NULL ) {</span>
<span class="lineNum">     186 </span>            :     
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :     fprintf(stderr, &quot;PHOS detector not found!\n&quot;) ;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     189 </span>            :     
<span class="lineNum">     190 </span>            :   }
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span><span class="lineCov">          1 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            :   // Get pointer to the array containing media indeces
<span class="lineNum">     195 </span><span class="lineCov">          1 :   Int_t *idtmed = fIdtmed-&gt;GetArray() - 699 ;</span>
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :   // Create a PHOS module.
<span class="lineNum">     198 </span>            :   
<span class="lineNum">     199 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PHOS&quot;, &quot;TRD1&quot;, idtmed[798], geom-&gt;GetPHOSParams(), 4) ;        </span>
<span class="lineNum">     200 </span><span class="lineCov">          1 :   if(fCreateHalfMod){</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PHOH&quot;, &quot;TRD1&quot;, idtmed[798], geom-&gt;GetPHOSParams(), 4) ;        </span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     203 </span><span class="lineCov">          1 :   if(fCreateCPV){</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PHOC&quot;, &quot;TRD1&quot;, idtmed[798], geom-&gt;GetPHOSParams(), 4) ;             </span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     206 </span>            :   
<span class="lineNum">     207 </span><span class="lineCov">          1 :   this-&gt;CreateGeometryforEMC() ; </span>
<span class="lineNum">     208 </span>            :   //Should we create 4-th module
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineCov">          1 :   if (fCreateCPV) </span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :     this-&gt;CreateGeometryforCPV() ;</span>
<span class="lineNum">     212 </span>            :   
<span class="lineNum">     213 </span><span class="lineCov">          1 :   this-&gt;CreateGeometryforSupport() ; </span>
<span class="lineNum">     214 </span>            :   
<span class="lineNum">     215 </span>            :   // --- Position  PHOS mdules in ALICE setup ---
<span class="lineNum">     216 </span><span class="lineCov">          1 :   Int_t idrotm[99] ;</span>
<span class="lineNum">     217 </span>            :   Int_t iXYZ,iAngle;
<span class="lineNum">     218 </span><span class="lineCov">          1 :   char im[5] ;</span>
<span class="lineNum">     219 </span><span class="lineCov">         12 :   for (Int_t iModule = 0; iModule &lt; 5 ; iModule++ ) {</span>
<span class="lineNum">     220 </span><span class="lineCov">          5 :     snprintf(im,5,&quot;%d&quot;,iModule+1) ;</span>
<span class="lineNum">     221 </span><span class="lineCov">          5 :     if(!fActiveModule[iModule+1])</span>
<span class="lineNum">     222 </span>            :       continue ;
<span class="lineNum">     223 </span><span class="lineCov">          3 :     Float_t angle[3][2];</span>
<span class="lineNum">     224 </span><span class="lineCov">         24 :     for (iXYZ=0; iXYZ&lt;3; iXYZ++)</span>
<span class="lineNum">     225 </span><span class="lineCov">         54 :       for (iAngle=0; iAngle&lt;2; iAngle++)</span>
<span class="lineNum">     226 </span><span class="lineCov">         18 :         angle[iXYZ][iAngle] = geom-&gt;GetModuleAngle(iModule,iXYZ, iAngle);</span>
<span class="lineNum">     227 </span><span class="lineCov">          6 :     AliMatrix(idrotm[iModule],</span>
<span class="lineNum">     228 </span><span class="lineCov">          3 :               angle[0][0],angle[0][1],</span>
<span class="lineNum">     229 </span><span class="lineCov">          3 :               angle[1][0],angle[1][1],</span>
<span class="lineNum">     230 </span><span class="lineCov">          3 :               angle[2][0],angle[2][1]) ;</span>
<span class="lineNum">     231 </span>            :     
<span class="lineNum">     232 </span><span class="lineCov">          3 :     Float_t pos[3];</span>
<span class="lineNum">     233 </span><span class="lineCov">         24 :     for (iXYZ=0; iXYZ&lt;3; iXYZ++)</span>
<span class="lineNum">     234 </span><span class="lineCov">          9 :       pos[iXYZ] = geom-&gt;GetModuleCenter(iModule,iXYZ);</span>
<span class="lineNum">     235 </span><span class="lineCov">          3 :     if(iModule==3){ //special 1/2 module</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :        TVirtualMC::GetMC()-&gt;Gspos(&quot;PHOH&quot;, iModule+1, &quot;ALIC&quot;, pos[0], pos[1], pos[2],</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :                idrotm[iModule], &quot;ONLY&quot;) ;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     239 </span>            :     else{
<span class="lineNum">     240 </span><span class="lineCov">          6 :       if(fActiveCPV[iModule+1]){ //use module with CPV</span>
<span class="lineNum">     241 </span><span class="lineCov">          3 :         TVirtualMC::GetMC()-&gt;Gspos(&quot;PHOC&quot;, iModule+1, &quot;ALIC&quot;, pos[0], pos[1], pos[2],</span>
<span class="lineNum">     242 </span><span class="lineCov">          3 :                idrotm[iModule], &quot;ONLY&quot;) ;</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     244 </span>            :       else{ //module wihtout CPV
<span class="lineNum">     245 </span><span class="lineCov">          3 :         TVirtualMC::GetMC()-&gt;Gspos(&quot;PHOS&quot;, iModule+1, &quot;ALIC&quot;, pos[0], pos[1], pos[2],</span>
<span class="lineNum">     246 </span>            :                idrotm[iModule], &quot;ONLY&quot;) ;
<span class="lineNum">     247 </span>            :       }
<span class="lineNum">     248 </span>            :    }
<span class="lineNum">     249 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">     250 </span><span class="lineCov">          2 : }</span>
<a name="251"><span class="lineNum">     251 </span>            : </a>
<span class="lineNum">     252 </span>            : //____________________________________________________________________________
<span class="lineNum">     253 </span>            : void AliPHOSv0::CreateGeometryforEMC()
<span class="lineNum">     254 </span>            : {
<span class="lineNum">     255 </span>            :   // Create the PHOS-EMC geometry for GEANT
<span class="lineNum">     256 </span>            :   // Author: Dmitri Peressounko August 2001
<span class="lineNum">     257 </span>            :   // The used coordinate system: 
<span class="lineNum">     258 </span>            :   //   1. in Module: X along longer side, Y out of beam, Z along shorter side (along beam)
<span class="lineNum">     259 </span>            :   //   2. In Strip the same: X along longer side, Y out of beam, Z along shorter side (along beam)
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span>            :     //BEGIN_HTML
<span class="lineNum">     263 </span>            :   /*
<span class="lineNum">     264 </span>            :     &lt;H2&gt;
<span class="lineNum">     265 </span>            :     Geant3 geometry tree of PHOS-EMC in ALICE
<span class="lineNum">     266 </span>            :     &lt;/H2&gt;
<span class="lineNum">     267 </span>            :     &lt;P&gt;&lt;CENTER&gt;
<span class="lineNum">     268 </span>            :     &lt;IMG Align=BOTTOM ALT=&quot;EMC geant tree&quot; SRC=&quot;../images/EMCinAlice.gif&quot;&gt; 
<span class="lineNum">     269 </span>            :     &lt;/CENTER&gt;&lt;P&gt;
<span class="lineNum">     270 </span>            :   */
<span class="lineNum">     271 </span>            :   //END_HTML  
<span class="lineNum">     272 </span>            :   
<span class="lineNum">     273 </span>            :   // Get pointer to the array containing media indexes
<span class="lineNum">     274 </span><span class="lineCov">          2 :   Int_t *idtmed = fIdtmed-&gt;GetArray() - 699 ;</span>
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span><span class="lineCov">          1 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">     277 </span><span class="lineCov">          1 :   AliPHOSEMCAGeometry * emcg = geom-&gt;GetEMCAGeometry() ;</span>
<span class="lineNum">     278 </span><span class="lineCov">          1 :   Float_t par[4];</span>
<span class="lineNum">     279 </span>            :   Int_t  ipar;
<span class="lineNum">     280 </span>            :   
<span class="lineNum">     281 </span>            :   // ======= Define the strip ===============
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetStripHalfSize() + ipar);</span>
<span class="lineNum">     284 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PSTR&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ;  //Made of steel</span>
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span>            :   // --- define steel volume (cell of the strip unit)
<span class="lineNum">     287 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetAirCellHalfSize() + ipar);</span>
<span class="lineNum">     288 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCEL&quot;, &quot;BOX &quot;, idtmed[798], par, 3);</span>
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            :   // --- define wrapped crystal and put it into steel cell
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetWrappedHalfSize() + ipar);</span>
<span class="lineNum">     293 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PWRA&quot;, &quot;BOX &quot;, idtmed[702], par, 3);</span>
<span class="lineNum">     294 </span><span class="lineCov">          1 :   const Float_t * pin    = emcg-&gt;GetAPDHalfSize() ; </span>
<span class="lineNum">     295 </span><span class="lineCov">          1 :   const Float_t * preamp = emcg-&gt;GetPreampHalfSize() ;</span>
<span class="lineNum">     296 </span><span class="lineCov">          1 :   Float_t y = (emcg-&gt;GetAirGapLed()-2*pin[1]-2*preamp[1])/2;</span>
<span class="lineNum">     297 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PWRA&quot;, 1, &quot;PCEL&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     298 </span>            :     
<span class="lineNum">     299 </span>            :   // --- Define crystal and put it into wrapped crystall ---
<span class="lineNum">     300 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetCrystalHalfSize() + ipar);</span>
<span class="lineNum">     301 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PXTL&quot;, &quot;BOX &quot;, idtmed[699], par, 3) ;</span>
<span class="lineNum">     302 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PXTL&quot;, 1, &quot;PWRA&quot;, 0.0, 0.0, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     303 </span>            :   
<span class="lineNum">     304 </span>            :   // --- define APD/PIN preamp and put it into AirCell
<span class="lineNum">     305 </span>            :  
<span class="lineNum">     306 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetAPDHalfSize() + ipar);</span>
<span class="lineNum">     307 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PPIN&quot;, &quot;BOX &quot;, idtmed[705], par, 3) ;</span>
<span class="lineNum">     308 </span><span class="lineCov">          1 :   const Float_t * crystal = emcg-&gt;GetCrystalHalfSize() ;</span>
<span class="lineNum">     309 </span><span class="lineCov">          1 :   y = crystal[1] + emcg-&gt;GetAirGapLed() /2 - preamp[1]; </span>
<span class="lineNum">     310 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PPIN&quot;, 1, &quot;PCEL&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     311 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetPreampHalfSize() + ipar);</span>
<span class="lineNum">     312 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PREA&quot;, &quot;BOX &quot;, idtmed[711], par, 3) ;   // Here I assumed preamp as a printed Circuit</span>
<span class="lineNum">     313 </span><span class="lineCov">          1 :   y = crystal[1] + emcg-&gt;GetAirGapLed() /2 + pin[1]  ;    // May it should be changed</span>
<span class="lineNum">     314 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PREA&quot;, 1, &quot;PCEL&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ; // to ceramics?</span>
<span class="lineNum">     315 </span>            :   
<span class="lineNum">     316 </span>            :   
<span class="lineNum">     317 </span>            :   // --- Fill strip with wrapped cristals in steel cells
<span class="lineNum">     318 </span>            :   
<span class="lineNum">     319 </span><span class="lineCov">          1 :   const Float_t* splate = emcg-&gt;GetSupportPlateHalfSize();  </span>
<span class="lineNum">     320 </span><span class="lineCov">          1 :   y = -splate[1] ;</span>
<span class="lineNum">     321 </span><span class="lineCov">          1 :   const Float_t* acel = emcg-&gt;GetAirCellHalfSize() ;</span>
<span class="lineNum">     322 </span>            :   
<span class="lineNum">     323 </span><span class="lineCov">         18 :   for(Int_t lev = 2, icel = 1; </span>
<span class="lineNum">     324 </span><span class="lineCov">          9 :       icel &lt;= emcg-&gt;GetNCellsXInStrip()*emcg-&gt;GetNCellsZInStrip(); </span>
<span class="lineNum">     325 </span><span class="lineCov">          8 :       icel += 2, lev += 2) {</span>
<span class="lineNum">     326 </span><span class="lineCov">          8 :     Float_t x = (2*(lev / 2) - 1 - emcg-&gt;GetNCellsXInStrip())* acel[0] ;</span>
<span class="lineNum">     327 </span><span class="lineCov">          8 :     Float_t z = acel[2];</span>
<span class="lineNum">     328 </span><span class="lineCov">          8 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCEL&quot;, icel, &quot;PSTR&quot;, x, y, +z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     329 </span><span class="lineCov">          8 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCEL&quot;, icel + 1, &quot;PSTR&quot;, x, y, -z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     330 </span>            :   }
<span class="lineNum">     331 </span>            : 
<span class="lineNum">     332 </span>            :   // --- define the support plate, hole in it and position it in strip ----
<span class="lineNum">     333 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetSupportPlateHalfSize() + ipar);</span>
<span class="lineNum">     334 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PSUP&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ;</span>
<span class="lineNum">     335 </span>            :   
<span class="lineNum">     336 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetSupportPlateInHalfSize() + ipar);</span>
<span class="lineNum">     337 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PSHO&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;</span>
<span class="lineNum">     338 </span><span class="lineCov">          1 :   Float_t z = emcg-&gt;GetSupportPlateThickness()/2 ;</span>
<span class="lineNum">     339 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PSHO&quot;, 1, &quot;PSUP&quot;, 0.0, 0.0, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     340 </span>            : 
<span class="lineNum">     341 </span><span class="lineCov">          1 :   y = acel[1] ;</span>
<span class="lineNum">     342 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PSUP&quot;, 1, &quot;PSTR&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span>            :   
<span class="lineNum">     345 </span>            :   // ========== Fill module with strips and put them into inner thermoinsulation=============
<span class="lineNum">     346 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetInnerThermoHalfSize() + ipar);</span>
<span class="lineNum">     347 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PTII&quot;, &quot;BOX &quot;, idtmed[706], par, 3) ;     </span>
<span class="lineNum">     348 </span>            :   
<span class="lineNum">     349 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PTIH&quot;, &quot;BOX &quot;, idtmed[706], par, 3) ;     </span>
<span class="lineNum">     351 </span>            :     
<span class="lineNum">     352 </span>            :   
<span class="lineNum">     353 </span><span class="lineCov">          1 :   const Float_t * inthermo = emcg-&gt;GetInnerThermoHalfSize() ;</span>
<span class="lineNum">     354 </span><span class="lineCov">          1 :   const Float_t * strip    = emcg-&gt;GetStripHalfSize() ;</span>
<span class="lineNum">     355 </span><span class="lineCov">          1 :   y = inthermo[1] - strip[1] ;</span>
<span class="lineNum">     356 </span>            :   Int_t irow;
<span class="lineNum">     357 </span>            :   Int_t nr = 1 ;
<span class="lineNum">     358 </span>            :   Int_t icol ;
<span class="lineNum">     359 </span>            :   
<span class="lineNum">     360 </span><span class="lineCov">         18 :   for(irow = 0; irow &lt; emcg-&gt;GetNStripX(); irow ++){</span>
<span class="lineNum">     361 </span><span class="lineCov">          8 :     Float_t x = (2*irow + 1 - emcg-&gt;GetNStripX())* strip[0] ;</span>
<span class="lineNum">     362 </span><span class="lineCov">        464 :     for(icol = 0; icol &lt; emcg-&gt;GetNStripZ(); icol ++){</span>
<span class="lineNum">     363 </span><span class="lineCov">        224 :       z = (2*icol + 1 - emcg-&gt;GetNStripZ()) * strip[2] ;</span>
<span class="lineNum">     364 </span><span class="lineCov">        224 :       TVirtualMC::GetMC()-&gt;Gspos(&quot;PSTR&quot;, nr, &quot;PTII&quot;, x, y, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     365 </span><span class="lineCov">        224 :       nr++ ;</span>
<span class="lineNum">     366 </span>            :     }
<span class="lineNum">     367 </span>            :   }
<span class="lineNum">     368 </span><span class="lineCov">          1 :   if(fCreateHalfMod){</span>
<span class="lineNum">     369 </span>            :     nr = 1 ;
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :     for(irow = 0; irow &lt; emcg-&gt;GetNStripX(); irow ++){</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :       Float_t x = (2*irow + 1 - emcg-&gt;GetNStripX())* strip[0] ;</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :       for(icol = 0; icol &lt; emcg-&gt;GetNStripZ(); icol ++){</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :         z = (2*icol + 1 - emcg-&gt;GetNStripZ()) * strip[2] ;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         if(irow&gt;=emcg-&gt;GetNStripX()/2)</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :           TVirtualMC::GetMC()-&gt;Gspos(&quot;PSTR&quot;, nr, &quot;PTIH&quot;, x, y, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :         nr++ ;</span>
<span class="lineNum">     377 </span>            :       }
<span class="lineNum">     378 </span>            :     }
<span class="lineNum">     379 </span>            :   }
<span class="lineNum">     380 </span>            :   
<span class="lineNum">     381 </span>            :   // ------- define the air gap between thermoinsulation and cooler
<span class="lineNum">     382 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetAirGapHalfSize() + ipar);</span>
<span class="lineNum">     383 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PAGA&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;   </span>
<span class="lineNum">     384 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PAGH&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;   </span>
<span class="lineNum">     386 </span><span class="lineCov">          1 :   const Float_t * agap = emcg-&gt;GetAirGapHalfSize() ;</span>
<span class="lineNum">     387 </span><span class="lineCov">          1 :   y = agap[1] - inthermo[1]  ;</span>
<span class="lineNum">     388 </span>            :   
<span class="lineNum">     389 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PTII&quot;, 1, &quot;PAGA&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     390 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PTIH&quot;, 1, &quot;PAGH&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span>            :   // ------- define the Al passive cooler 
<span class="lineNum">     395 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetCoolerHalfSize() + ipar);</span>
<span class="lineNum">     396 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCOR&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ;   </span>
<span class="lineNum">     397 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCOH&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ;   </span>
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineCov">          1 :   const Float_t * cooler = emcg-&gt;GetCoolerHalfSize() ;</span>
<span class="lineNum">     401 </span><span class="lineCov">          1 :   y = cooler[1] - agap[1]  ;</span>
<span class="lineNum">     402 </span>            :   
<span class="lineNum">     403 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PAGA&quot;, 1, &quot;PCOR&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     404 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PAGH&quot;, 1, &quot;PCOH&quot;, 0.0, y, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     406 </span>            :   
<span class="lineNum">     407 </span>            :   // ------- define the outer thermoinsulating cover
<span class="lineNum">     408 </span><span class="lineCov">         10 :   for (ipar=0; ipar&lt;4; ipar++) par[ipar] = *(emcg-&gt;GetOuterThermoParams() + ipar);</span>
<span class="lineNum">     409 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PTIO&quot;, &quot;TRD1&quot;, idtmed[706], par, 4) ;        </span>
<span class="lineNum">     410 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PIOH&quot;, &quot;TRD1&quot;, idtmed[706], par, 4) ;        </span>
<span class="lineNum">     412 </span><span class="lineCov">          1 :   const Float_t * outparams = emcg-&gt;GetOuterThermoParams() ; </span>
<span class="lineNum">     413 </span>            :   
<span class="lineNum">     414 </span><span class="lineCov">          1 :   Int_t idrotm[99] ;</span>
<span class="lineNum">     415 </span><span class="lineCov">          1 :   AliMatrix(idrotm[1], 90.0, 0.0, 0.0, 0.0, 90.0, 270.0) ;</span>
<span class="lineNum">     416 </span>            :   // Frame in outer thermoinsulation and so on: z out of beam, y along beam, x across beam
<span class="lineNum">     417 </span>            :   
<span class="lineNum">     418 </span><span class="lineCov">          1 :   z = outparams[3] - cooler[1] ;</span>
<span class="lineNum">     419 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCOR&quot;, 1, &quot;PTIO&quot;, 0., 0.0, z, idrotm[1], &quot;ONLY&quot;) ;</span>
<span class="lineNum">     420 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCOH&quot;, 1, &quot;PIOH&quot;, 0., 0.0, z, idrotm[1], &quot;ONLY&quot;) ;</span>
<span class="lineNum">     422 </span>            :   
<span class="lineNum">     423 </span>            :   // -------- Define the outer Aluminium cover -----
<span class="lineNum">     424 </span><span class="lineCov">         10 :   for (ipar=0; ipar&lt;4; ipar++) par[ipar] = *(emcg-&gt;GetAlCoverParams() + ipar);</span>
<span class="lineNum">     425 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCOL&quot;, &quot;TRD1&quot;, idtmed[701], par, 4) ;        </span>
<span class="lineNum">     426 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCLH&quot;, &quot;TRD1&quot;, idtmed[701], par, 4) ;        </span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineCov">          1 :   const Float_t * covparams = emcg-&gt;GetAlCoverParams() ; </span>
<span class="lineNum">     430 </span><span class="lineCov">          1 :   z = covparams[3] - outparams[3] ;  </span>
<span class="lineNum">     431 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PTIO&quot;, 1, &quot;PCOL&quot;, 0., 0.0, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     432 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PIOH&quot;, 1, &quot;PCLH&quot;, 0., 0.0, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            :   // --------- Define front fiberglass cover -----------
<span class="lineNum">     436 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFiberGlassHalfSize() + ipar);</span>
<span class="lineNum">     437 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFGC&quot;, &quot;BOX &quot;, idtmed[717], par, 3) ;  </span>
<span class="lineNum">     438 </span><span class="lineCov">          1 :   z = - outparams[3] ;</span>
<span class="lineNum">     439 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFGC&quot;, 1, &quot;PCOL&quot;, 0., 0.0, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     440 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PFGC&quot;, 1, &quot;PCLH&quot;, 0., 0.0, z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     442 </span>            : 
<span class="lineNum">     443 </span>            :   //=============This is all with cold section==============
<span class="lineNum">     444 </span>            :   
<span class="lineNum">     445 </span>            : 
<span class="lineNum">     446 </span>            :   //------ Warm Section --------------
<span class="lineNum">     447 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetWarmAlCoverHalfSize() + ipar);</span>
<span class="lineNum">     448 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PWAR&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ; </span>
<span class="lineNum">     449 </span><span class="lineCov">          1 :   const Float_t * warmcov = emcg-&gt;GetWarmAlCoverHalfSize() ;</span>
<span class="lineNum">     450 </span>            :   
<span class="lineNum">     451 </span>            :   // --- Define the outer thermoinsulation ---
<span class="lineNum">     452 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetWarmThermoHalfSize() + ipar);</span>
<span class="lineNum">     453 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PWTI&quot;, &quot;BOX &quot;, idtmed[706], par, 3) ; </span>
<span class="lineNum">     454 </span><span class="lineCov">          1 :   const Float_t * warmthermo = emcg-&gt;GetWarmThermoHalfSize() ;</span>
<span class="lineNum">     455 </span><span class="lineCov">          1 :   z = -warmcov[2] + warmthermo[2] ;</span>
<span class="lineNum">     456 </span>            :   
<span class="lineNum">     457 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PWTI&quot;, 1, &quot;PWAR&quot;, 0., 0.0, z, 0, &quot;ONLY&quot;) ;     </span>
<span class="lineNum">     458 </span>            :   
<span class="lineNum">     459 </span>            :   // --- Define cables area and put in it T-supports ---- 
<span class="lineNum">     460 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetTCables1HalfSize() + ipar);</span>
<span class="lineNum">     461 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCA1&quot;, &quot;BOX &quot;, idtmed[718], par, 3) ; </span>
<span class="lineNum">     462 </span><span class="lineCov">          1 :   const Float_t * cbox = emcg-&gt;GetTCables1HalfSize() ;</span>
<span class="lineNum">     463 </span>            :   
<span class="lineNum">     464 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetTSupport1HalfSize() + ipar);</span>
<span class="lineNum">     465 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PBE1&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ;</span>
<span class="lineNum">     466 </span><span class="lineCov">          1 :   const Float_t * beams = emcg-&gt;GetTSupport1HalfSize() ;</span>
<span class="lineNum">     467 </span>            :   Int_t isup ;
<span class="lineNum">     468 </span><span class="lineCov">         20 :   for(isup = 0; isup &lt; emcg-&gt;GetNTSuppots(); isup++){</span>
<span class="lineNum">     469 </span><span class="lineCov">          9 :     Float_t x = -cbox[0] + beams[0] + (2*beams[0]+emcg-&gt;GetTSupportDist())*isup ;</span>
<span class="lineNum">     470 </span><span class="lineCov">          9 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PBE1&quot;, isup, &quot;PCA1&quot;, x, 0.0, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     471 </span>            :   }
<span class="lineNum">     472 </span>            :   
<span class="lineNum">     473 </span><span class="lineCov">          1 :   z = -warmthermo[2] + cbox[2];</span>
<span class="lineNum">     474 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCA1&quot;, 1, &quot;PWTI&quot;, 0.0, 0.0, z, 0, &quot;ONLY&quot;) ;     </span>
<span class="lineNum">     475 </span>            :   
<span class="lineNum">     476 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetTCables2HalfSize() + ipar);</span>
<span class="lineNum">     477 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCA2&quot;, &quot;BOX &quot;, idtmed[718], par, 3) ; </span>
<span class="lineNum">     478 </span><span class="lineCov">          1 :   const Float_t * cbox2 = emcg-&gt;GetTCables2HalfSize() ;</span>
<span class="lineNum">     479 </span>            :   
<span class="lineNum">     480 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetTSupport2HalfSize() + ipar);</span>
<span class="lineNum">     481 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PBE2&quot;, &quot;BOX &quot;, idtmed[701], par, 3) ;</span>
<span class="lineNum">     482 </span><span class="lineCov">         20 :   for(isup = 0; isup &lt; emcg-&gt;GetNTSuppots(); isup++){</span>
<span class="lineNum">     483 </span><span class="lineCov">          9 :     Float_t x = -cbox[0] + beams[0] + (2*beams[0]+emcg-&gt;GetTSupportDist())*isup ;</span>
<span class="lineNum">     484 </span><span class="lineCov">          9 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PBE2&quot;, isup, &quot;PCA2&quot;, x, 0.0, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     485 </span>            :   }
<span class="lineNum">     486 </span>            :   
<span class="lineNum">     487 </span><span class="lineCov">          1 :   z = -warmthermo[2] + 2*cbox[2] + cbox2[2];</span>
<span class="lineNum">     488 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCA2&quot;, 1, &quot;PWTI&quot;, 0.0, 0.0, z, 0, &quot;ONLY&quot;) ;     </span>
<span class="lineNum">     489 </span>            :   
<span class="lineNum">     490 </span>            :   // --- Define frame ---
<span class="lineNum">     491 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFrameXHalfSize() + ipar);</span>
<span class="lineNum">     492 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFRX&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ; </span>
<span class="lineNum">     493 </span><span class="lineCov">          1 :   const Float_t * posit1 = emcg-&gt;GetFrameXPosition() ;</span>
<span class="lineNum">     494 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFRX&quot;, 1, &quot;PWTI&quot;, posit1[0],  posit1[1], posit1[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     495 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFRX&quot;, 2, &quot;PWTI&quot;, posit1[0], -posit1[1], posit1[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     496 </span>            :   
<span class="lineNum">     497 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFrameZHalfSize() + ipar);</span>
<span class="lineNum">     498 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFRZ&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ; </span>
<span class="lineNum">     499 </span><span class="lineCov">          1 :   const Float_t * posit2 = emcg-&gt;GetFrameZPosition() ;</span>
<span class="lineNum">     500 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFRZ&quot;, 1, &quot;PWTI&quot;,  posit2[0], posit2[1], posit2[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     501 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFRZ&quot;, 2, &quot;PWTI&quot;, -posit2[0], posit2[1], posit2[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     502 </span>            : 
<span class="lineNum">     503 </span>            :  // --- Define Fiber Glass support ---
<span class="lineNum">     504 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFGupXHalfSize() + ipar);</span>
<span class="lineNum">     505 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFG1&quot;, &quot;BOX &quot;, idtmed[717], par, 3) ; </span>
<span class="lineNum">     506 </span><span class="lineCov">          1 :   const Float_t * posit3 = emcg-&gt;GetFGupXPosition() ;</span>
<span class="lineNum">     507 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG1&quot;, 1, &quot;PWTI&quot;, posit3[0],  posit3[1], posit3[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     508 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG1&quot;, 2, &quot;PWTI&quot;, posit3[0], -posit3[1], posit3[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     509 </span>            :   
<span class="lineNum">     510 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFGupZHalfSize() + ipar);</span>
<span class="lineNum">     511 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFG2&quot;, &quot;BOX &quot;, idtmed[717], par, 3) ; </span>
<span class="lineNum">     512 </span><span class="lineCov">          1 :   const Float_t * posit4 = emcg-&gt;GetFGupZPosition();</span>
<span class="lineNum">     513 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG2&quot;, 1, &quot;PWTI&quot;,  posit4[0], posit4[1], posit4[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     514 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG2&quot;, 2, &quot;PWTI&quot;, -posit4[0], posit4[1], posit4[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     515 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFGlowXHalfSize() + ipar);</span>
<span class="lineNum">     516 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFG3&quot;, &quot;BOX &quot;, idtmed[717], par, 3) ; </span>
<span class="lineNum">     517 </span><span class="lineCov">          1 :   const Float_t * posit5 = emcg-&gt;GetFGlowXPosition() ;</span>
<span class="lineNum">     518 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG3&quot;, 1, &quot;PWTI&quot;, posit5[0],  posit5[1], posit5[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     519 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG3&quot;, 2, &quot;PWTI&quot;, posit5[0], -posit5[1], posit5[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     520 </span>            :     
<span class="lineNum">     521 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFGlowZHalfSize() + ipar);</span>
<span class="lineNum">     522 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PFG4&quot;, &quot;BOX &quot;, idtmed[717], par, 3) ; </span>
<span class="lineNum">     523 </span><span class="lineCov">          1 :   const Float_t * posit6 = emcg-&gt;GetFGlowZPosition() ;</span>
<span class="lineNum">     524 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG4&quot;, 1, &quot;PWTI&quot;,  posit6[0], posit6[1], posit6[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     525 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PFG4&quot;, 2, &quot;PWTI&quot;, -posit6[0], posit6[1], posit6[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     526 </span>            : 
<span class="lineNum">     527 </span>            :   // --- Define Air Gap for FEE electronics -----   
<span class="lineNum">     528 </span><span class="lineCov">          8 :   for (ipar=0; ipar&lt;3; ipar++) par[ipar] = *(emcg-&gt;GetFEEAirHalfSize() + ipar);</span>
<span class="lineNum">     529 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PAFE&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ; </span>
<span class="lineNum">     530 </span><span class="lineCov">          1 :   const Float_t * posit7 = emcg-&gt;GetFEEAirPosition() ;</span>
<span class="lineNum">     531 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PAFE&quot;, 1, &quot;PWTI&quot;,  posit7[0], posit7[1], posit7[2], 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     532 </span>            :   
<span class="lineNum">     533 </span>            :   // Define the EMC module volume and combine Cool and Warm sections  
<span class="lineNum">     534 </span><span class="lineCov">         10 :   for (ipar=0; ipar&lt;4; ipar++) par[ipar] = *(emcg-&gt;GetEMCParams() + ipar);</span>
<span class="lineNum">     535 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PEMC&quot;, &quot;TRD1&quot;, idtmed[798], par, 4) ;        </span>
<span class="lineNum">     536 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PEMH&quot;, &quot;TRD1&quot;, idtmed[798], par, 4) ;        </span>
<span class="lineNum">     538 </span><span class="lineCov">          1 :   z =  - warmcov[2] ;</span>
<span class="lineNum">     539 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCOL&quot;, 1, &quot;PEMC&quot;,  0., 0., z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     540 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCLH&quot;, 1, &quot;PEMH&quot;,  0., 0., z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     542 </span><span class="lineCov">          1 :   z = covparams[3] ;</span>
<span class="lineNum">     543 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PWAR&quot;, 1, &quot;PEMC&quot;,  0., 0., z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     544 </span><span class="lineCov">          1 :   if(fCreateHalfMod)</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PWAR&quot;, 1, &quot;PEMH&quot;,  0., 0., z, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     546 </span>            :   
<span class="lineNum">     547 </span>            :   
<span class="lineNum">     548 </span>            :   // Put created EMC geometry into PHOS volume
<span class="lineNum">     549 </span>            :   
<span class="lineNum">     550 </span><span class="lineCov">          1 :   z = geom-&gt;GetCPVBoxSize(1) / 2. ;</span>
<span class="lineNum">     551 </span>            :   //normal PHOS module
<span class="lineNum">     552 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PEMC&quot;, 1, &quot;PHOS&quot;, 0., 0., z, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     553 </span><span class="lineCov">          1 :   if(fCreateCPV) //Module with CPV </span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PEMC&quot;, 1, &quot;PHOC&quot;, 0., 0., z, 0, &quot;ONLY&quot;) ;   </span>
<span class="lineNum">     555 </span><span class="lineCov">          1 :   if(fCreateHalfMod) //half of PHOS module</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PEMH&quot;, 1, &quot;PHOH&quot;, 0., 0., z, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     557 </span>            :   
<span class="lineNum">     558 </span><span class="lineCov">          1 : }</span>
<a name="559"><span class="lineNum">     559 </span>            : </a>
<span class="lineNum">     560 </span>            : //____________________________________________________________________________
<span class="lineNum">     561 </span>            : void AliPHOSv0::CreateGeometryforCPV()
<span class="lineNum">     562 </span>            : {
<span class="lineNum">     563 </span>            :   
<span class="lineNum">     564 </span><span class="lineNoCov">          0 : printf(&quot;Create CPV geometry \n&quot;) ;  </span>
<span class="lineNum">     565 </span>            :   
<span class="lineNum">     566 </span>            :   // Create the PHOS-CPV geometry for GEANT
<span class="lineNum">     567 </span>            :   // Author: Yuri Kharlov 11 September 2000
<span class="lineNum">     568 </span>            :   //BEGIN_HTML
<span class="lineNum">     569 </span>            :   /*
<span class="lineNum">     570 </span>            :     &lt;H2&gt;
<span class="lineNum">     571 </span>            :     Geant3 geometry of PHOS-CPV in ALICE
<span class="lineNum">     572 </span>            :     &lt;/H2&gt;
<span class="lineNum">     573 </span>            :     &lt;table width=700&gt;
<span class="lineNum">     574 </span>            : 
<span class="lineNum">     575 </span>            :     &lt;tr&gt;
<span class="lineNum">     576 </span>            :          &lt;td&gt;CPV perspective view&lt;/td&gt;
<span class="lineNum">     577 </span>            :          &lt;td&gt;CPV front view      &lt;/td&gt;
<span class="lineNum">     578 </span>            :     &lt;/tr&gt;
<span class="lineNum">     579 </span>            : 
<span class="lineNum">     580 </span>            :     &lt;tr&gt;
<span class="lineNum">     581 </span>            :          &lt;td&gt; &lt;img height=300 width=290 src=&quot;../images/CPVallPersp.gif&quot;&gt; &lt;/td&gt;
<span class="lineNum">     582 </span>            :          &lt;td&gt; &lt;img height=300 width=290 src=&quot;../images/CPVallFront.gif&quot;&gt; &lt;/td&gt;
<span class="lineNum">     583 </span>            :     &lt;/tr&gt;
<span class="lineNum">     584 </span>            : 
<span class="lineNum">     585 </span>            :     &lt;tr&gt;
<span class="lineNum">     586 </span>            :          &lt;td&gt;One CPV module, perspective view                            &lt;/td&gt;
<span class="lineNum">     587 </span>            :          &lt;td&gt;One CPV module, front view (extended in vertical direction) &lt;/td&gt;
<span class="lineNum">     588 </span>            :     &lt;/tr&gt;
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span>            :     &lt;tr&gt;
<span class="lineNum">     591 </span>            :          &lt;td&gt;&lt;img height=300 width=290 src=&quot;../images/CPVmodulePers.gif&quot;&gt;&lt;/td&gt;
<span class="lineNum">     592 </span>            :          &lt;td&gt;&lt;img height=300 width=290 src=&quot;../images/CPVmoduleSide.gif&quot;&gt;&lt;/td&gt;
<span class="lineNum">     593 </span>            :     &lt;/tr&gt;
<span class="lineNum">     594 </span>            : 
<span class="lineNum">     595 </span>            :     &lt;/table&gt;
<span class="lineNum">     596 </span>            : 
<span class="lineNum">     597 </span>            :     &lt;H2&gt;
<span class="lineNum">     598 </span>            :     Geant3 geometry tree of PHOS-CPV in ALICE
<span class="lineNum">     599 </span>            :     &lt;/H2&gt;
<span class="lineNum">     600 </span>            :     &lt;center&gt;
<span class="lineNum">     601 </span>            :     &lt;img height=300 width=290 src=&quot;../images/CPVtree.gif&quot;&gt;
<span class="lineNum">     602 </span>            :     &lt;/center&gt;
<span class="lineNum">     603 </span>            :   */
<span class="lineNum">     604 </span>            :   //END_HTML  
<span class="lineNum">     605 </span>            : 
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :   Float_t par[3], x,y,z;</span>
<span class="lineNum">     607 </span>            : 
<span class="lineNum">     608 </span>            :   // Get pointer to the array containing media indexes
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :   Int_t *idtmed = fIdtmed-&gt;GetArray() - 699 ;</span>
<span class="lineNum">     610 </span>            : 
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">     612 </span>            : 
<span class="lineNum">     613 </span>            :   // The box containing all CPV for one PHOS module filled with air 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :   par[0] = geom-&gt;GetCPVBoxSize(0) / 2.0 ;  </span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVBoxSize(1) / 2.0 ; </span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :   par[2] = geom-&gt;GetCPVBoxSize(2) / 2.0 ;</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPV&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;</span>
<span class="lineNum">     618 </span>            : 
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :   const Float_t * emcParams = geom-&gt;GetEMCAGeometry()-&gt;GetEMCParams() ;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :   z = - emcParams[3] ;</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :   Int_t rotm ;</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :   AliMatrix(rotm, 90.,0., 0., 0., 90., 90.) ;</span>
<span class="lineNum">     623 </span>            : 
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCPV&quot;, 1, &quot;PHOC&quot;, 0.0, 0.0, z, rotm, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     625 </span>            :   
<span class="lineNum">     626 </span>            :   // Gassiplex board
<span class="lineNum">     627 </span>            :   
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :   par[0] = geom-&gt;GetGassiplexChipSize(0)/2.;</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetGassiplexChipSize(1)/2.;</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :   par[2] = geom-&gt;GetGassiplexChipSize(2)/2.;</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPC&quot;,&quot;BOX &quot;,idtmed[707],par,3);</span>
<span class="lineNum">     632 </span>            :   
<span class="lineNum">     633 </span>            :   // Cu+Ni foil covers Gassiplex board
<span class="lineNum">     634 </span>            : 
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVCuNiFoilThickness()/2;</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPD&quot;,&quot;BOX &quot;,idtmed[710],par,3);</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :   y      = -(geom-&gt;GetGassiplexChipSize(1)/2 - par[1]);</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PCPD&quot;,1,&quot;PCPC&quot;,0,y,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     639 </span>            : 
<span class="lineNum">     640 </span>            :   // Position of the chip inside CPV
<span class="lineNum">     641 </span>            : 
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :   Float_t xStep = geom-&gt;GetCPVActiveSize(0) / (geom-&gt;GetNumberOfCPVChipsPhi() + 1);</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :   Float_t zStep = geom-&gt;GetCPVActiveSize(1) / (geom-&gt;GetNumberOfCPVChipsZ()   + 1);</span>
<span class="lineNum">     644 </span>            :   Int_t   copy  = 0;
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :   y = geom-&gt;GetCPVFrameSize(1)/2           - geom-&gt;GetFTPosition(0) +</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :     geom-&gt;GetCPVTextoliteThickness() / 2 + geom-&gt;GetGassiplexChipSize(1) / 2 + 0.1;</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :   for (Int_t ix=0; ix&lt;geom-&gt;GetNumberOfCPVChipsPhi(); ix++) {</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :     x = xStep * (ix+1) - geom-&gt;GetCPVActiveSize(0)/2;</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :     for (Int_t iz=0; iz&lt;geom-&gt;GetNumberOfCPVChipsZ(); iz++) {</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :       copy++;</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :       z = zStep * (iz+1) - geom-&gt;GetCPVActiveSize(1)/2;</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :       TVirtualMC::GetMC()-&gt;Gspos(&quot;PCPC&quot;,copy,&quot;PCPV&quot;,x,y,z,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     653 </span>            :     }
<span class="lineNum">     654 </span>            :   }
<span class="lineNum">     655 </span>            : 
<span class="lineNum">     656 </span>            :   // Foiled textolite (1 mm of textolite + 50 mkm of Cu + 6 mkm of Ni)
<span class="lineNum">     657 </span>            :   
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :   par[0] = geom-&gt;GetCPVActiveSize(0)        / 2;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVTextoliteThickness() / 2;</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :   par[2] = geom-&gt;GetCPVActiveSize(1)        / 2;</span>
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPF&quot;,&quot;BOX &quot;,idtmed[707],par,3);</span>
<span class="lineNum">     662 </span>            : 
<span class="lineNum">     663 </span>            :   // Argon gas volume
<span class="lineNum">     664 </span>            : 
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :   par[1] = (geom-&gt;GetFTPosition(2) - geom-&gt;GetFTPosition(1) - geom-&gt;GetCPVTextoliteThickness()) / 2;</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPG&quot;,&quot;BOX &quot;,idtmed[715],par,3);</span>
<span class="lineNum">     667 </span>            : 
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;4; i++) {</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :     y = geom-&gt;GetCPVFrameSize(1) / 2 - geom-&gt;GetFTPosition(i) + geom-&gt;GetCPVTextoliteThickness()/2;</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCPF&quot;,i+1,&quot;PCPV&quot;,0,y,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :     if(i==1){</span>
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :       y-= (geom-&gt;GetFTPosition(2) - geom-&gt;GetFTPosition(1)) / 2;</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :       TVirtualMC::GetMC()-&gt;Gspos(&quot;PCPG&quot;,1,&quot;PCPV &quot;,0,y,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     675 </span>            :   }
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span>            :   // Dummy sensitive plane in the middle of argone gas volume
<span class="lineNum">     678 </span>            : 
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   par[1]=0.001;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCPQ&quot;,&quot;BOX &quot;,idtmed[715],par,3);</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gspos (&quot;PCPQ&quot;,1,&quot;PCPG&quot;,0,0,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     682 </span>            : 
<span class="lineNum">     683 </span>            :   // Cu+Ni foil covers textolite
<span class="lineNum">     684 </span>            : 
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVCuNiFoilThickness() / 2;</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCP1&quot;,&quot;BOX &quot;,idtmed[710],par,3);</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :   y = geom-&gt;GetCPVTextoliteThickness()/2 - par[1];</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gspos (&quot;PCP1&quot;,1,&quot;PCPF&quot;,0,y,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     689 </span>            : 
<span class="lineNum">     690 </span>            :   // Aluminum frame around CPV
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :   par[0] = geom-&gt;GetCPVFrameSize(0)/2;</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVFrameSize(1)/2;</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :   par[2] = geom-&gt;GetCPVBoxSize(2)  /2;</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCF1&quot;,&quot;BOX &quot;,idtmed[701],par,3);</span>
<span class="lineNum">     696 </span>            : 
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :   par[0] = geom-&gt;GetCPVBoxSize(0)/2 - geom-&gt;GetCPVFrameSize(0);</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :   par[1] = geom-&gt;GetCPVFrameSize(1)/2;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :   par[2] = geom-&gt;GetCPVFrameSize(2)/2;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCF2&quot;,&quot;BOX &quot;,idtmed[701],par,3);</span>
<span class="lineNum">     701 </span>            : 
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :   for (Int_t j=0; j&lt;=1; j++) {</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     x = TMath::Sign(1,2*j-1) * (geom-&gt;GetCPVBoxSize(0) - geom-&gt;GetCPVFrameSize(0)) / 2;</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCF1&quot;,j+1,&quot;PCPV&quot;, x,0,0,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :     z = TMath::Sign(1,2*j-1) * (geom-&gt;GetCPVBoxSize(2) - geom-&gt;GetCPVFrameSize(2)) / 2;</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PCF2&quot;,j+1,&quot;PCPV&quot;,0, 0,z,0,&quot;ONLY&quot;);</span>
<span class="lineNum">     707 </span>            :   }
<span class="lineNum">     708 </span>            : 
<span class="lineNum">     709 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     710 </span>            : 
<a name="711"><span class="lineNum">     711 </span>            : </a>
<span class="lineNum">     712 </span>            : //____________________________________________________________________________
<span class="lineNum">     713 </span>            : void AliPHOSv0::CreateGeometryforSupport()
<span class="lineNum">     714 </span>            : {
<span class="lineNum">     715 </span>            :   // Create the PHOS' support geometry for GEANT
<span class="lineNum">     716 </span>            :     //BEGIN_HTML
<span class="lineNum">     717 </span>            :   /*
<span class="lineNum">     718 </span>            :     &lt;H2&gt;
<span class="lineNum">     719 </span>            :     Geant3 geometry of the PHOS's support
<span class="lineNum">     720 </span>            :     &lt;/H2&gt;
<span class="lineNum">     721 </span>            :     &lt;P&gt;&lt;CENTER&gt;
<span class="lineNum">     722 </span>            :     &lt;IMG Align=BOTTOM ALT=&quot;EMC geant tree&quot; SRC=&quot;../images/PHOS_support.gif&quot;&gt; 
<span class="lineNum">     723 </span>            :     &lt;/CENTER&gt;&lt;P&gt;
<span class="lineNum">     724 </span>            :   */
<span class="lineNum">     725 </span>            :   //END_HTML  
<span class="lineNum">     726 </span>            :   
<span class="lineNum">     727 </span><span class="lineCov">          2 :   Float_t par[5], x0,y0,z0 ; </span>
<span class="lineNum">     728 </span>            :   Int_t   i,j,copy;
<span class="lineNum">     729 </span>            : 
<span class="lineNum">     730 </span>            :   // Get pointer to the array containing media indexes
<span class="lineNum">     731 </span><span class="lineCov">          1 :   Int_t *idtmed = fIdtmed-&gt;GetArray() - 699 ;</span>
<span class="lineNum">     732 </span>            : 
<span class="lineNum">     733 </span><span class="lineCov">          1 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span>            :   // --- Dummy box containing two rails on which PHOS support moves
<span class="lineNum">     736 </span>            :   // --- Put these rails to the bottom of the L3 magnet
<span class="lineNum">     737 </span>            : 
<span class="lineNum">     738 </span><span class="lineCov">          1 :   par[0] =  geom-&gt;GetRailRoadSize(0) / 2.0 ;</span>
<span class="lineNum">     739 </span><span class="lineCov">          1 :   par[1] =  geom-&gt;GetRailRoadSize(1) / 2.0 ;</span>
<span class="lineNum">     740 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetRailRoadSize(2) / 2.0 ;</span>
<span class="lineNum">     741 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PRRD&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;</span>
<span class="lineNum">     742 </span>            : 
<span class="lineNum">     743 </span><span class="lineCov">          1 :   y0     = -(geom-&gt;GetRailsDistanceFromIP() - geom-&gt;GetRailRoadSize(1) / 2.0) ;</span>
<span class="lineNum">     744 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PRRD&quot;, 1, &quot;ALIC&quot;, 0.0, y0, 0.0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     745 </span>            : 
<span class="lineNum">     746 </span>            :   // --- Dummy box containing one rail
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span><span class="lineCov">          1 :   par[0] =  geom-&gt;GetRailOuterSize(0) / 2.0 ;</span>
<span class="lineNum">     749 </span><span class="lineCov">          1 :   par[1] =  geom-&gt;GetRailOuterSize(1) / 2.0 ;</span>
<span class="lineNum">     750 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetRailOuterSize(2) / 2.0 ;</span>
<span class="lineNum">     751 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PRAI&quot;, &quot;BOX &quot;, idtmed[798], par, 3) ;</span>
<span class="lineNum">     752 </span>            : 
<span class="lineNum">     753 </span><span class="lineCov">          6 :   for (i=0; i&lt;2; i++) {</span>
<span class="lineNum">     754 </span><span class="lineCov">          2 :     x0     = (2*i-1) * geom-&gt;GetDistanceBetwRails()  / 2.0 ;</span>
<span class="lineNum">     755 </span><span class="lineCov">          2 :     TVirtualMC::GetMC()-&gt;Gspos(&quot;PRAI&quot;, i, &quot;PRRD&quot;, x0, 0.0, 0.0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     756 </span>            :   }
<span class="lineNum">     757 </span>            : 
<span class="lineNum">     758 </span>            :   // --- Upper and bottom steel parts of the rail
<span class="lineNum">     759 </span>            : 
<span class="lineNum">     760 </span><span class="lineCov">          1 :   par[0] =  geom-&gt;GetRailPart1(0) / 2.0 ;</span>
<span class="lineNum">     761 </span><span class="lineCov">          1 :   par[1] =  geom-&gt;GetRailPart1(1) / 2.0 ;</span>
<span class="lineNum">     762 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetRailPart1(2) / 2.0 ;</span>
<span class="lineNum">     763 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PRP1&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ;</span>
<span class="lineNum">     764 </span>            : 
<span class="lineNum">     765 </span><span class="lineCov">          1 :   y0     = - (geom-&gt;GetRailOuterSize(1) - geom-&gt;GetRailPart1(1))  / 2.0 ;</span>
<span class="lineNum">     766 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PRP1&quot;, 1, &quot;PRAI&quot;, 0.0, y0, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     767 </span><span class="lineCov">          1 :   y0     =   (geom-&gt;GetRailOuterSize(1) - geom-&gt;GetRailPart1(1))  / 2.0 - geom-&gt;GetRailPart3(1);</span>
<span class="lineNum">     768 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PRP1&quot;, 2, &quot;PRAI&quot;, 0.0, y0, 0.0, 0, &quot;ONLY&quot;) ;</span>
<span class="lineNum">     769 </span>            : 
<span class="lineNum">     770 </span>            :   // --- The middle vertical steel parts of the rail
<span class="lineNum">     771 </span>            : 
<span class="lineNum">     772 </span><span class="lineCov">          1 :   par[0] =  geom-&gt;GetRailPart2(0) / 2.0 ;</span>
<span class="lineNum">     773 </span><span class="lineCov">          1 :   par[1] =  geom-&gt;GetRailPart2(1) / 2.0 ;</span>
<span class="lineNum">     774 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetRailPart2(2) / 2.0 ;</span>
<span class="lineNum">     775 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PRP2&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ;</span>
<span class="lineNum">     776 </span>            : 
<span class="lineNum">     777 </span><span class="lineCov">          1 :   y0     =   - geom-&gt;GetRailPart3(1) / 2.0 ;</span>
<span class="lineNum">     778 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PRP2&quot;, 1, &quot;PRAI&quot;, 0.0, y0, 0.0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     779 </span>            : 
<span class="lineNum">     780 </span>            :   // --- The most upper steel parts of the rail
<span class="lineNum">     781 </span>            : 
<span class="lineNum">     782 </span><span class="lineCov">          1 :   par[0] =  geom-&gt;GetRailPart3(0) / 2.0 ;</span>
<span class="lineNum">     783 </span><span class="lineCov">          1 :   par[1] =  geom-&gt;GetRailPart3(1) / 2.0 ;</span>
<span class="lineNum">     784 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetRailPart3(2) / 2.0 ;</span>
<span class="lineNum">     785 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PRP3&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ;</span>
<span class="lineNum">     786 </span>            : 
<span class="lineNum">     787 </span><span class="lineCov">          1 :   y0     =   (geom-&gt;GetRailOuterSize(1) - geom-&gt;GetRailPart3(1))  / 2.0 ;</span>
<span class="lineNum">     788 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos(&quot;PRP3&quot;, 1, &quot;PRAI&quot;, 0.0, y0, 0.0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     789 </span>            : 
<span class="lineNum">     790 </span>            :   // --- The wall of the cradle
<span class="lineNum">     791 </span>            :   // --- The wall is empty: steel thin walls and air inside
<span class="lineNum">     792 </span>            : 
<span class="lineNum">     793 </span><span class="lineCov">          3 :   par[1] =  TMath::Sqrt(TMath::Power((geom-&gt;GetIPtoCPVDistance() + geom-&gt;GetOuterBoxSize(3)),2) +</span>
<span class="lineNum">     794 </span><span class="lineCov">          2 :                         TMath::Power((geom-&gt;GetOuterBoxSize(1)/2),2))+10. ;</span>
<span class="lineNum">     795 </span><span class="lineCov">          1 :   par[0] =  par[1] - geom-&gt;GetCradleWall(1) ;</span>
<span class="lineNum">     796 </span><span class="lineCov">          1 :   par[2] =  geom-&gt;GetCradleWall(2) / 2.0 ;</span>
<span class="lineNum">     797 </span><span class="lineCov">          1 :   par[3] =  geom-&gt;GetCradleWall(3) ;</span>
<span class="lineNum">     798 </span><span class="lineCov">          1 :   par[4] =  geom-&gt;GetCradleWall(4) ;</span>
<span class="lineNum">     799 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCRA&quot;, &quot;TUBS&quot;, idtmed[716], par, 5) ;</span>
<span class="lineNum">     800 </span>            : 
<span class="lineNum">     801 </span><span class="lineCov">          1 :   par[0] +=  geom-&gt;GetCradleWallThickness() ;</span>
<span class="lineNum">     802 </span><span class="lineCov">          1 :   par[1] -=  geom-&gt;GetCradleWallThickness() ;</span>
<span class="lineNum">     803 </span><span class="lineCov">          1 :   par[2] -=  geom-&gt;GetCradleWallThickness() ;</span>
<span class="lineNum">     804 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PCRE&quot;, &quot;TUBS&quot;, idtmed[798], par, 5) ;</span>
<span class="lineNum">     805 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gspos (&quot;PCRE&quot;, 1, &quot;PCRA&quot;, 0.0, 0.0, 0.0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span><span class="lineCov">          6 :   for (i=0; i&lt;2; i++) {</span>
<span class="lineNum">     808 </span><span class="lineCov">          2 :     z0 = (2*i-1) * (geom-&gt;GetOuterBoxSize(2) + geom-&gt;GetCradleWall(2) )/ 2.0  ;</span>
<span class="lineNum">     809 </span><span class="lineCov">          2 :         TVirtualMC::GetMC()-&gt;Gspos(&quot;PCRA&quot;, i, &quot;ALIC&quot;, 0.0, 0.0, z0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     810 </span>            :   }
<span class="lineNum">     811 </span>            : 
<span class="lineNum">     812 </span>            :   // --- The &quot;wheels&quot; of the cradle
<span class="lineNum">     813 </span>            :   
<span class="lineNum">     814 </span><span class="lineCov">          1 :   par[0] = geom-&gt;GetCradleWheel(0) / 2;</span>
<span class="lineNum">     815 </span><span class="lineCov">          1 :   par[1] = geom-&gt;GetCradleWheel(1) / 2;</span>
<span class="lineNum">     816 </span><span class="lineCov">          1 :   par[2] = geom-&gt;GetCradleWheel(2) / 2;</span>
<span class="lineNum">     817 </span><span class="lineCov">          1 :   TVirtualMC::GetMC()-&gt;Gsvolu(&quot;PWHE&quot;, &quot;BOX &quot;, idtmed[716], par, 3) ;</span>
<span class="lineNum">     818 </span>            : 
<span class="lineNum">     819 </span><span class="lineCov">          2 :   y0 = -(geom-&gt;GetRailsDistanceFromIP() - geom-&gt;GetRailRoadSize(1) -</span>
<span class="lineNum">     820 </span><span class="lineCov">          1 :          geom-&gt;GetCradleWheel(1)/2) ;</span>
<span class="lineNum">     821 </span><span class="lineCov">          6 :   for (i=0; i&lt;2; i++) {</span>
<span class="lineNum">     822 </span><span class="lineCov">          4 :     z0 = (2*i-1) * ((geom-&gt;GetOuterBoxSize(2) + geom-&gt;GetCradleWheel(2))/ 2.0 +</span>
<span class="lineNum">     823 </span><span class="lineCov">          2 :                     geom-&gt;GetCradleWall(2));</span>
<span class="lineNum">     824 </span><span class="lineCov">         12 :     for (j=0; j&lt;2; j++) {</span>
<span class="lineNum">     825 </span><span class="lineCov">          4 :       copy = 2*i + j;</span>
<span class="lineNum">     826 </span><span class="lineCov">          4 :       x0 = (2*j-1) * geom-&gt;GetDistanceBetwRails()  / 2.0 ;</span>
<span class="lineNum">     827 </span><span class="lineCov">          4 :       TVirtualMC::GetMC()-&gt;Gspos(&quot;PWHE&quot;, copy, &quot;ALIC&quot;, x0, y0, z0, 0, &quot;ONLY&quot;) ; </span>
<span class="lineNum">     828 </span>            :     }
<span class="lineNum">     829 </span>            :   }
<span class="lineNum">     830 </span>            : 
<span class="lineNum">     831 </span><span class="lineCov">          1 : }</span>
<a name="832"><span class="lineNum">     832 </span>            : </a>
<span class="lineNum">     833 </span>            : //_____________________________________________________________________________
<span class="lineNum">     834 </span>            : void AliPHOSv0::AddAlignableVolumes() const
<span class="lineNum">     835 </span>            : {
<span class="lineNum">     836 </span>            :   //
<span class="lineNum">     837 </span>            :   // Create entries for alignable volumes associating the symbolic volume
<span class="lineNum">     838 </span>            :   // name with the corresponding volume path. Needs to be syncronized with
<span class="lineNum">     839 </span>            :   // eventual changes in the geometry
<span class="lineNum">     840 </span>            :   // Alignable volumes are:
<span class="lineNum">     841 </span>            :   // 1) PHOS modules as a whole
<span class="lineNum">     842 </span>            :   // 2) Cradle
<span class="lineNum">     843 </span>            :   // 3) Cradle wheels
<span class="lineNum">     844 </span>            :   // 4) Strip units (group of 2x8 crystals)
<span class="lineNum">     845 </span>            : 
<span class="lineNum">     846 </span><span class="lineCov">          2 :   TString volpath, symname;</span>
<span class="lineNum">     847 </span>            : 
<span class="lineNum">     848 </span>            :   // Alignable modules
<span class="lineNum">     849 </span>            :   // Volume path /ALIC_1/PHOS_&lt;i&gt; =&gt; symbolic name /PHOS/Module&lt;i&gt;, &lt;i&gt;=1,2,3,4,5
<span class="lineNum">     850 </span>            :   
<span class="lineNum">     851 </span>            :   AliGeomManager::ELayerID idPHOS1 = AliGeomManager::kPHOS1;
<span class="lineNum">     852 </span>            :   AliGeomManager::ELayerID idPHOS2 = AliGeomManager::kPHOS2;
<span class="lineNum">     853 </span>            :   Int_t modUID, modnum = 0;
<span class="lineNum">     854 </span><span class="lineCov">          1 :   TString physModulePath=&quot;/ALIC_1/PHOS_&quot;;</span>
<span class="lineNum">     855 </span><span class="lineCov">          1 :   TString physModulePath2=&quot;/ALIC_1/PHOH_&quot;;</span>
<span class="lineNum">     856 </span><span class="lineCov">          1 :   TString physModulePath3=&quot;/ALIC_1/PHOC_&quot;;</span>
<span class="lineNum">     857 </span><span class="lineCov">          1 :   TString symbModuleName=&quot;PHOS/Module&quot;;</span>
<span class="lineNum">     858 </span><span class="lineCov">          2 :   Int_t nModules = GetGeometry()-&gt;GetNModules();</span>
<span class="lineNum">     859 </span>            :   
<span class="lineNum">     860 </span><span class="lineCov">         12 :   for(Int_t iModule=1; iModule&lt;=nModules; iModule++){</span>
<span class="lineNum">     861 </span><span class="lineCov">          5 :     if(!fActiveModule[iModule])</span>
<span class="lineNum">     862 </span>            :       continue ;
<span class="lineNum">     863 </span><span class="lineCov">          6 :     modUID = AliGeomManager::LayerToVolUID(idPHOS1,iModule-1);</span>
<span class="lineNum">     864 </span><span class="lineCov">          3 :      if(iModule==4)</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :       volpath = physModulePath2;</span>
<span class="lineNum">     866 </span>            :     else
<span class="lineNum">     867 </span><span class="lineCov">          3 :       if(fActiveCPV[iModule])</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :         volpath = physModulePath3;</span>
<span class="lineNum">     869 </span>            :       else
<span class="lineNum">     870 </span><span class="lineCov">          3 :         volpath = physModulePath;       </span>
<span class="lineNum">     871 </span><span class="lineCov">          3 :     volpath += iModule;</span>
<span class="lineNum">     872 </span>            :     //    volpath += &quot;/PEMC_1/PCOL_1/PTIO_1/PCOR_1/PAGA_1/PTII_1&quot;;
<span class="lineNum">     873 </span>            :  
<span class="lineNum">     874 </span>            :    // Check the volume path if not all 5 modules exist
<span class="lineNum">     875 </span><span class="lineCov">          9 :     if (!gGeoManager-&gt;CheckPath(volpath.Data())) {                                                                                         </span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :       AliError(Form(&quot;Volume path %s not valid!&quot;,volpath.Data()));                                                                          </span>
<span class="lineNum">     877 </span>            :       continue;                                                                                                                            
<span class="lineNum">     878 </span>            :     }                                                                                                                                      
<span class="lineNum">     879 </span>            :  
<span class="lineNum">     880 </span><span class="lineCov">          3 :     symname = symbModuleName;</span>
<span class="lineNum">     881 </span><span class="lineCov">          3 :     symname += iModule;</span>
<span class="lineNum">     882 </span><span class="lineCov">         12 :     if(!gGeoManager-&gt;SetAlignableEntry(symname.Data(),volpath.Data(),modUID))</span>
<span class="lineNum">     883 </span>            :       continue ;
<span class="lineNum">     884 </span>            : //      AliFatal(Form(&quot;Alignable entry %s not created. Volume path %s not valid&quot;, symname.Data(),volpath.Data()));
<span class="lineNum">     885 </span>            : 
<span class="lineNum">     886 </span>            :     // Creates the Tracking to Local transformation matrix for PHOS modules
<span class="lineNum">     887 </span><span class="lineCov">          3 :     TGeoPNEntry *alignableEntry = gGeoManager-&gt;GetAlignableEntryByUID(modUID) ;</span>
<span class="lineNum">     888 </span>            : 
<span class="lineNum">     889 </span><span class="lineCov">          6 :     Float_t angle = GetGeometry()-&gt;GetPHOSAngle(iModule);</span>
<span class="lineNum">     890 </span><span class="lineCov">          3 :     TGeoHMatrix* globMatrix = alignableEntry-&gt;GetGlobalOrig();</span>
<span class="lineNum">     891 </span>            : 
<span class="lineNum">     892 </span><span class="lineCov">          6 :     TGeoHMatrix *matTtoL = new TGeoHMatrix;</span>
<span class="lineNum">     893 </span><span class="lineCov">          3 :     matTtoL-&gt;RotateZ(-90.+angle);</span>
<span class="lineNum">     894 </span><span class="lineCov">          6 :     matTtoL-&gt;MultiplyLeft(&amp;(globMatrix-&gt;Inverse()));</span>
<span class="lineNum">     895 </span><span class="lineCov">          3 :     alignableEntry-&gt;SetMatrix(matTtoL);</span>
<span class="lineNum">     896 </span><span class="lineCov">          3 :   }</span>
<span class="lineNum">     897 </span>            : 
<span class="lineNum">     898 </span>            :   //Aligning of CPV should be done for volume PCPV_1
<span class="lineNum">     899 </span><span class="lineCov">          1 :   symbModuleName=&quot;PHOS/Module&quot;;</span>
<span class="lineNum">     900 </span>            :   modnum=0;
<span class="lineNum">     901 </span><span class="lineCov">         12 :   for(Int_t iModule=1; iModule&lt;=nModules; iModule++){</span>
<span class="lineNum">     902 </span><span class="lineCov">          5 :     if(!fActiveCPV[iModule])</span>
<span class="lineNum">     903 </span>            :       continue ;
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :     modUID = AliGeomManager::LayerToVolUID(idPHOS2,iModule-1);</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :     volpath = physModulePath3;</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :     volpath += iModule;</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :     volpath += &quot;/PCPV_1&quot;;</span>
<span class="lineNum">     908 </span>            :     // Check the volume path
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :     if (!gGeoManager-&gt;CheckPath(volpath.Data())) {</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :       AliError(Form(&quot;Volume path %s not valid!&quot;,volpath.Data()));</span>
<span class="lineNum">     911 </span>            :       continue;
<span class="lineNum">     912 </span>            :     }
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :     symname = symbModuleName;</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :     symname += iModule;</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :     symname += &quot;/CPV&quot;;</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :     if(!gGeoManager-&gt;SetAlignableEntry(symname.Data(),volpath.Data(),modUID))</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :       AliFatal(Form(&quot;Alignable entry %s not created. Volume path %s not valid&quot;, symname.Data(),volpath.Data()));</span>
<span class="lineNum">     919 </span>            :           
<span class="lineNum">     920 </span>            :     // Creates the TGeo Local to Tracking transformation matrix ...
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :     TGeoPNEntry *alignableEntry = gGeoManager-&gt;GetAlignableEntryByUID(modUID) ;</span>
<span class="lineNum">     922 </span>            : 
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :     Float_t angle = GetGeometry()-&gt;GetPHOSAngle(iModule);</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :     TGeoHMatrix* globMatrix = alignableEntry-&gt;GetGlobalOrig();</span>
<span class="lineNum">     925 </span>            : 
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     TGeoHMatrix *matTtoL = new TGeoHMatrix;</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :     matTtoL-&gt;RotateZ(-90.+angle);</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :     matTtoL-&gt;MultiplyLeft(&amp;(globMatrix-&gt;Inverse()));</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :     alignableEntry-&gt;SetMatrix(matTtoL);</span>
<span class="lineNum">     930 </span>            :     
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     932 </span>            :  
<span class="lineNum">     933 </span>            : 
<span class="lineNum">     934 </span>            :   // Alignable cradle walls
<span class="lineNum">     935 </span>            :   // Volume path /ALIC_1/PCRA_&lt;i&gt; =&gt; symbolic name /PHOS/Cradle&lt;i&gt;, &lt;i&gt;=0,1
<span class="lineNum">     936 </span>            : 
<span class="lineNum">     937 </span><span class="lineCov">          1 :   TString physCradlePath=&quot;/ALIC_1/PCRA_&quot;;</span>
<span class="lineNum">     938 </span><span class="lineCov">          1 :   TString symbCradleName=&quot;PHOS/Cradle&quot;;</span>
<span class="lineNum">     939 </span>            :   Int_t nCradles = 2;
<span class="lineNum">     940 </span>            : 
<span class="lineNum">     941 </span><span class="lineCov">          6 :   for(Int_t iCradle=0; iCradle&lt;nCradles; iCradle++){</span>
<span class="lineNum">     942 </span><span class="lineCov">          2 :     volpath = physCradlePath;</span>
<span class="lineNum">     943 </span><span class="lineCov">          2 :     volpath += iCradle;</span>
<span class="lineNum">     944 </span><span class="lineCov">          2 :     symname = symbCradleName;</span>
<span class="lineNum">     945 </span><span class="lineCov">          2 :     symname += iCradle;</span>
<span class="lineNum">     946 </span><span class="lineCov">          6 :     gGeoManager-&gt;SetAlignableEntry(symname.Data(),volpath.Data());</span>
<span class="lineNum">     947 </span>            :   }
<span class="lineNum">     948 </span>            : 
<span class="lineNum">     949 </span>            :   // Alignable wheels
<span class="lineNum">     950 </span>            :   // Volume path /ALIC_1/PWHE_&lt;i&gt; =&gt; symbolic name /PHOS/Wheel&lt;i&gt;, i=0,1,2,3
<span class="lineNum">     951 </span>            : 
<span class="lineNum">     952 </span><span class="lineCov">          1 :   TString physWheelPath=&quot;/ALIC_1/PWHE_&quot;;</span>
<span class="lineNum">     953 </span><span class="lineCov">          1 :   TString symbWheelName=&quot;PHOS/Wheel&quot;;</span>
<span class="lineNum">     954 </span>            :   Int_t nWheels = 4;
<span class="lineNum">     955 </span>            : 
<span class="lineNum">     956 </span><span class="lineCov">         10 :   for(Int_t iWheel=0; iWheel&lt;nWheels; iWheel++){</span>
<span class="lineNum">     957 </span><span class="lineCov">          4 :     volpath = physWheelPath;</span>
<span class="lineNum">     958 </span><span class="lineCov">          4 :     volpath += iWheel;</span>
<span class="lineNum">     959 </span><span class="lineCov">          4 :     symname = symbWheelName;</span>
<span class="lineNum">     960 </span><span class="lineCov">          4 :     symname += iWheel;</span>
<span class="lineNum">     961 </span><span class="lineCov">         12 :     gGeoManager-&gt;SetAlignableEntry(symname.Data(),volpath.Data());</span>
<span class="lineNum">     962 </span>            :   }
<span class="lineNum">     963 </span>            : 
<span class="lineNum">     964 </span>            :   
<span class="lineNum">     965 </span>            : /*  
<span class="lineNum">     966 </span>            :   //Physical strip path is a combination of: physModulePath + module number + 
<span class="lineNum">     967 </span>            :   //physStripPath + strip number == ALIC_1/PHOS_N/..../PSTR_M
<span class="lineNum">     968 </span>            :   const Int_t nStripsX = GetGeometry()-&gt;GetEMCAGeometry()-&gt;GetNStripX();
<span class="lineNum">     969 </span>            :   const Int_t nStripsZ = GetGeometry()-&gt;GetEMCAGeometry()-&gt;GetNStripZ();
<span class="lineNum">     970 </span>            :   TString partialPhysStripName(100);
<span class="lineNum">     971 </span>            :   TString fullPhysStripName(100);
<span class="lineNum">     972 </span>            :   TString partialSymbStripName(100);
<span class="lineNum">     973 </span>            :   TString fullSymbStripName(100);
<span class="lineNum">     974 </span>            : 
<span class="lineNum">     975 </span>            :   for(Int_t module = 1; module &lt;= nModules; ++module){
<span class="lineNum">     976 </span>            : 
<span class="lineNum">     977 </span>            :     snprintf(im,5,&quot;%d&quot;,module) ;
<span class="lineNum">     978 </span>            :     if(strstr(GetTitle(),im)==0 &amp;&amp; strcmp(GetTitle(),&quot;IHEP&quot;)!=0 &amp;&amp; strcmp(GetTitle(),&quot;noCPV&quot;)!=0)
<span class="lineNum">     979 </span>            :       continue ;
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span>            :     volpath = physModulePath;
<span class="lineNum">     982 </span>            :     volpath += module;
<span class="lineNum">     983 </span>            :     // Check the volume path if not all 5 modules exist
<span class="lineNum">     984 </span>            :     if (!gGeoManager-&gt;CheckPath(volpath.Data())) {
<span class="lineNum">     985 </span>            :       AliError(Form(&quot;Volume path %s does not exist&quot;,volpath.Data())) ;
<span class="lineNum">     986 </span>            :       continue;
<span class="lineNum">     987 </span>            :     }
<span class="lineNum">     988 </span>            : 
<span class="lineNum">     989 </span>            :     partialPhysStripName  = physModulePath;
<span class="lineNum">     990 </span>            :     partialPhysStripName += module;
<span class="lineNum">     991 </span>            :     if(module!=4)
<span class="lineNum">     992 </span>            :       partialPhysStripName += &quot;/PEMC_1/PCOL_1/PTIO_1/PCOR_1/PAGA_1/PTII_1/PSTR_&quot;;
<span class="lineNum">     993 </span>            :     else
<span class="lineNum">     994 </span>            :       partialPhysStripName += &quot;/PEMH_1/PCLH_1/PIOH_1/PCOH_1/PAGH_1/PTIH_1/PSTR_&quot;;
<span class="lineNum">     995 </span>            : 
<span class="lineNum">     996 </span>            :     partialSymbStripName  = symbModuleName;
<span class="lineNum">     997 </span>            :     partialSymbStripName += module;
<span class="lineNum">     998 </span>            :     partialSymbStripName += &quot;/Strip_&quot;;
<span class="lineNum">     999 </span>            : 
<span class="lineNum">    1000 </span>            :     for(Int_t i = 0, ind1D = 1; i &lt; nStripsX; ++i){//ind1D starts from 1 (PSTR_1...PSTR_224...)
<span class="lineNum">    1001 </span>            :       for(Int_t j = 0; j &lt; nStripsZ; ++j, ++ind1D){
<span class="lineNum">    1002 </span>            :          fullPhysStripName = partialPhysStripName;
<span class="lineNum">    1003 </span>            :          fullPhysStripName += ind1D;
<span class="lineNum">    1004 </span>            :          
<span class="lineNum">    1005 </span>            :          fullSymbStripName  = partialSymbStripName;
<span class="lineNum">    1006 </span>            :          fullSymbStripName += i;//ind1D;
<span class="lineNum">    1007 </span>            :          fullSymbStripName += '_';
<span class="lineNum">    1008 </span>            :          fullSymbStripName += j;
<span class="lineNum">    1009 </span>            : 
<span class="lineNum">    1010 </span>            :          gGeoManager-&gt;SetAlignableEntry(fullSymbStripName.Data(), fullPhysStripName.Data());
<span class="lineNum">    1011 </span>            : 
<span class="lineNum">    1012 </span>            :          // Creates the TGeo Local to Tracking transformation matrix ...
<span class="lineNum">    1013 </span>            :          TGeoPNEntry *alignableEntry = gGeoManager-&gt;GetAlignableEntry(fullSymbStripName.Data()) ;
<span class="lineNum">    1014 </span>            :          const char *path = alignableEntry-&gt;GetTitle();
<span class="lineNum">    1015 </span>            :          if (!gGeoManager-&gt;cd(path))
<span class="lineNum">    1016 </span>            :            AliFatal(Form(&quot;Volume path %s not valid!&quot;,path));
<span class="lineNum">    1017 </span>            :          TGeoHMatrix matLtoT = *gGeoManager-&gt;GetCurrentMatrix() ;
<span class="lineNum">    1018 </span>            :          Double_t refl[3]={-1.,-1.,-1.} ;
<span class="lineNum">    1019 </span>            :          matLtoT.SetScale(refl) ;
<span class="lineNum">    1020 </span>            :          TGeoHMatrix *matTtoL = new TGeoHMatrix(matLtoT.Inverse());
<span class="lineNum">    1021 </span>            :  
<span class="lineNum">    1022 </span>            :          char phosPath[50] ;
<span class="lineNum">    1023 </span>            :          snprintf(phosPath,50,&quot;/ALIC_1/PHOS_%d&quot;,module) ;
<span class="lineNum">    1024 </span>            :          if (!gGeoManager-&gt;cd(phosPath)){
<span class="lineNum">    1025 </span>            :             AliFatal(&quot;Geo manager can not find path \n&quot;);
<span class="lineNum">    1026 </span>            :          }
<span class="lineNum">    1027 </span>            :          TGeoHMatrix *mPHOS = gGeoManager-&gt;GetCurrentMatrix();
<span class="lineNum">    1028 </span>            :          if (mPHOS) 
<span class="lineNum">    1029 </span>            :            matTtoL-&gt;Multiply(mPHOS);
<span class="lineNum">    1030 </span>            :          else{
<span class="lineNum">    1031 </span>            :            AliFatal(&quot;Geo matrixes are not loaded \n&quot;) ;
<span class="lineNum">    1032 </span>            :          }
<span class="lineNum">    1033 </span>            :          //Switch y&lt;-&gt;z
<span class="lineNum">    1034 </span>            :          Double_t rot[9]={1.,0.,0.,  0.,1.,0., 0.,0.,1.} ;
<span class="lineNum">    1035 </span>            :          matTtoL-&gt;SetRotation(rot) ;
<span class="lineNum">    1036 </span>            :          alignableEntry-&gt;SetMatrix(matTtoL);
<span class="lineNum">    1037 </span>            : */
<span class="lineNum">    1038 </span>            : /*
<span class="lineNum">    1039 </span>            :   //Check poisition of corner cell of the strip
<span class="lineNum">    1040 </span>            :   AliPHOSGeometry * geom = AliPHOSGeometry::GetInstance() ;
<span class="lineNum">    1041 </span>            :   Int_t relid[4] ; 
<span class="lineNum">    1042 </span>            :   relid[0] = module ;
<span class="lineNum">    1043 </span>            :   relid[1] = 0 ;
<span class="lineNum">    1044 </span>            :   Int_t iStrip=ind1D ;
<span class="lineNum">    1045 </span>            :   Int_t icell=1 ;
<span class="lineNum">    1046 </span>            :   Int_t raw = geom-&gt;GetEMCAGeometry()-&gt;GetNCellsXInStrip()*((iStrip-1)/geom-&gt;GetEMCAGeometry()-&gt;GetNStripZ()) +
<span class="lineNum">    1047 </span>            :                 1 + (icell-1)/geom-&gt;GetEMCAGeometry()-&gt;GetNCellsZInStrip() ;
<span class="lineNum">    1048 </span>            :   Int_t col = geom-&gt;GetEMCAGeometry()-&gt;GetNCellsZInStrip()*(1+(iStrip-1)%geom-&gt;GetEMCAGeometry()-&gt;GetNStripZ()) - 
<span class="lineNum">    1049 </span>            :                 (icell-1)%geom-&gt;GetEMCAGeometry()-&gt;GetNCellsZInStrip() ;
<span class="lineNum">    1050 </span>            :   if(col==0) col=geom-&gt;GetNZ() ;
<span class="lineNum">    1051 </span>            :   relid[2] = raw ;
<span class="lineNum">    1052 </span>            :   relid[3] = col ;
<span class="lineNum">    1053 </span>            :   Float_t xG,zG ; 
<span class="lineNum">    1054 </span>            :   geom-&gt;RelPosInModule(relid, xG, zG) ;
<span class="lineNum">    1055 </span>            : printf(&quot;============\n&quot;) ;
<span class="lineNum">    1056 </span>            : printf(&quot;Geometry: x=%f, z=%f \n&quot;,xG,zG) ;
<span class="lineNum">    1057 </span>            :   Int_t absid ; 
<span class="lineNum">    1058 </span>            :   geom-&gt;RelToAbsNumbering(relid,absid) ;
<span class="lineNum">    1059 </span>            :   Double_t pos[3]= {-2.2*3.5,0.0,1.1}; //Position incide the strip (Y coordinalte is not important)
<span class="lineNum">    1060 </span>            :   Double_t posC[3]={0.0,0.0,0.}; //Global position
<span class="lineNum">    1061 </span>            :  
<span class="lineNum">    1062 </span>            :   matTtoL-&gt;MasterToLocal(pos,posC);
<span class="lineNum">    1063 </span>            : printf(&quot;Matrix:   x=%f, z=%f, y=%f \n&quot;,posC[0],posC[2],posC[1]) ;
<span class="lineNum">    1064 </span>            : */
<span class="lineNum">    1065 </span>            : //      }
<span class="lineNum">    1066 </span>            : //    }
<span class="lineNum">    1067 </span>            : //  }
<span class="lineNum">    1068 </span><span class="lineCov">          1 : }</span>
<a name="1069"><span class="lineNum">    1069 </span>            : </a>
<span class="lineNum">    1070 </span>            : //____________________________________________________________________________
<span class="lineNum">    1071 </span>            : Float_t AliPHOSv0::ZMin(void) const
<span class="lineNum">    1072 </span>            : {
<span class="lineNum">    1073 </span>            :   // Overall dimension of the PHOS (min)
<span class="lineNum">    1074 </span>            : 
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">    1076 </span>            : 
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :   return -geom-&gt;GetOuterBoxSize(2)/2.;</span>
<span class="lineNum">    1078 </span>            : }
<a name="1079"><span class="lineNum">    1079 </span>            : </a>
<span class="lineNum">    1080 </span>            : //____________________________________________________________________________
<span class="lineNum">    1081 </span>            : Float_t AliPHOSv0::ZMax(void) const
<span class="lineNum">    1082 </span>            : {
<span class="lineNum">    1083 </span>            :   // Overall dimension of the PHOS (max)
<span class="lineNum">    1084 </span>            : 
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :   AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">    1086 </span>            : 
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :   return  geom-&gt;GetOuterBoxSize(2)/2.;</span>
<span class="lineNum">    1088 </span>            : }
<a name="1089"><span class="lineNum">    1089 </span>            : </a>
<span class="lineNum">    1090 </span>            : //____________________________________________________________________________
<span class="lineNum">    1091 </span>            : void AliPHOSv0::Init(void)
<span class="lineNum">    1092 </span>            : {
<span class="lineNum">    1093 </span>            :   // Just prints an information message
<span class="lineNum">    1094 </span>            :   
<span class="lineNum">    1095 </span>            :   Int_t i;
<span class="lineNum">    1096 </span>            : 
<span class="lineNum">    1097 </span><span class="lineCov">          2 :   if(AliLog::GetGlobalDebugLevel()&gt;0) {</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :     TString st ; </span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :     for(i=0;i&lt;35;i++) </span>
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :       st += &quot;*&quot;;</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :     Info(&quot;Init&quot;, &quot;%s&quot;, st.Data()) ;  </span>
<span class="lineNum">    1102 </span>            :     // Here the PHOS initialisation code (if any!)
<span class="lineNum">    1103 </span>            :     
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :     AliPHOSGeometry * geom = GetGeometry() ; </span>
<span class="lineNum">    1105 </span>            : 
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :     if (geom!=0)  </span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       Info(&quot;Init&quot;, &quot;AliPHOS%s: PHOS geometry intialized for %s&quot;, Version().Data(), geom-&gt;GetName()) ;</span>
<span class="lineNum">    1108 </span>            :     else
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :       Info(&quot;Init&quot;, &quot;AliPHOS%s: PHOS geometry initialization failed !&quot;, Version().Data()) ;       </span>
<span class="lineNum">    1110 </span>            : 
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :     Info(&quot;Init&quot;, &quot;%s&quot;, st.Data()) ;  </span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1113 </span><span class="lineCov">          1 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
