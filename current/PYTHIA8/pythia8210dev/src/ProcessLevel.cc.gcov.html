<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - PYTHIA8/pythia8210dev/src/ProcessLevel.cc</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">PYTHIA8/pythia8210dev/src</a> - ProcessLevel.cc<span style="font-size: 80%;"> (source / <a href="ProcessLevel.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">801</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // ProcessLevel.cc is a part of the PYTHIA event generator.</a>
<span class="lineNum">       2 </span>            : // Copyright (C) 2015 Torbjorn Sjostrand.
<span class="lineNum">       3 </span>            : // PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.
<span class="lineNum">       4 </span>            : // Please respect the MCnet Guidelines, see GUIDELINES for details.
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : // Function definitions (not found in the header) for the ProcessLevel class.
<span class="lineNum">       7 </span>            : 
<span class="lineNum">       8 </span>            : #include &quot;Pythia8/ProcessLevel.h&quot;
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            : namespace Pythia8 {
<span class="lineNum">      11 </span>            : 
<span class="lineNum">      12 </span>            : //==========================================================================
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            : // The ProcessLevel class.
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : // Constants: could be changed here if desired, but normally should not.
<span class="lineNum">      19 </span>            : // These are of technical nature, as described for each.
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : // Allow a few failures in final construction of events.
<span class="lineNum">      22 </span>            : const int ProcessLevel::MAXLOOP = 5;
<span class="lineNum">      23 </span>            : 
<span class="lineNum">      24 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      25 </span>            : 
<a name="26"><span class="lineNum">      26 </span>            : // Destructor.</a>
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span><span class="lineNoCov">          0 : ProcessLevel::~ProcessLevel() {</span>
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            :   // Run through list of first hard processes and delete them.
<span class="lineNum">      31 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">      32 </span><span class="lineNoCov">          0 :     delete containerPtrs[i];</span>
<span class="lineNum">      33 </span>            : 
<span class="lineNum">      34 </span>            :   // Run through list of second hard processes and delete them.
<span class="lineNum">      35 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(container2Ptrs.size()); ++i)</span>
<span class="lineNum">      36 </span><span class="lineNoCov">          0 :     delete container2Ptrs[i];</span>
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      41 </span>            : 
<a name="42"><span class="lineNum">      42 </span>            : // Main routine to initialize generation process.</a>
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : bool ProcessLevel::init( Info* infoPtrIn, Settings&amp; settings,
<span class="lineNum">      45 </span>            :   ParticleData* particleDataPtrIn, Rndm* rndmPtrIn,
<span class="lineNum">      46 </span>            :   BeamParticle* beamAPtrIn, BeamParticle* beamBPtrIn,
<span class="lineNum">      47 </span>            :   Couplings* couplingsPtrIn, SigmaTotal* sigmaTotPtrIn, bool doLHA,
<span class="lineNum">      48 </span>            :   SLHAinterface* slhaInterfacePtrIn, UserHooks* userHooksPtrIn,
<span class="lineNum">      49 </span>            :   vector&lt;SigmaProcess*&gt;&amp; sigmaPtrs, vector&lt;PhaseSpace*&gt;&amp; phaseSpacePtrs,
<span class="lineNum">      50 </span>            :   ostream&amp; os) {
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            :   // Store input pointers for future use.
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :   infoPtr          = infoPtrIn;</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :   particleDataPtr  = particleDataPtrIn;</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :   rndmPtr          = rndmPtrIn;</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :   beamAPtr         = beamAPtrIn;</span>
<span class="lineNum">      57 </span><span class="lineNoCov">          0 :   beamBPtr         = beamBPtrIn;</span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :   couplingsPtr     = couplingsPtrIn;</span>
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :   sigmaTotPtr      = sigmaTotPtrIn;</span>
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :   userHooksPtr     = userHooksPtrIn;</span>
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :   slhaInterfacePtr = slhaInterfacePtrIn;</span>
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            :   // Send on some input pointers.
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   resonanceDecays.init( infoPtr, particleDataPtr, rndmPtr);</span>
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            :   // Set up SigmaTotal. Store sigma_nondiffractive for future use.
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   sigmaTotPtr-&gt;init( infoPtr, settings, particleDataPtr);</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   int    idA = infoPtr-&gt;idA();</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   int    idB = infoPtr-&gt;idB();</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   double eCM = infoPtr-&gt;eCM();</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :   sigmaTotPtr-&gt;calc( idA, idB, eCM);</span>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   sigmaND = sigmaTotPtr-&gt;sigmaND();</span>
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            :   // Options to allow second hard interaction and resonance decays.
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   doSecondHard  = settings.flag(&quot;SecondHard:generate&quot;);</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   doSameCuts    = settings.flag(&quot;PhaseSpace:sameForSecond&quot;);</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   doResDecays   = settings.flag(&quot;ProcessLevel:resonanceDecays&quot;);</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :   startColTag   = settings.mode(&quot;Event:startColTag&quot;);</span>
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            :   // Second interaction not to be combined with biased phase space.
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   if (doSecondHard &amp;&amp; userHooksPtr != 0</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   &amp;&amp; userHooksPtr-&gt;canBiasSelection()) {</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">      84 </span>            :       &quot;cannot combine second interaction with biased phase space&quot;);
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">      86 </span>            :   }
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            :   // Mass and pT cuts for two hard processes.
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :   mHatMin1      = settings.parm(&quot;PhaseSpace:mHatMin&quot;);</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :   mHatMax1      = settings.parm(&quot;PhaseSpace:mHatMax&quot;);</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :   if (mHatMax1 &lt; mHatMin1) mHatMax1 = eCM;</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :   pTHatMin1     = settings.parm(&quot;PhaseSpace:pTHatMin&quot;);</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :   pTHatMax1     = settings.parm(&quot;PhaseSpace:pTHatMax&quot;);</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :   if (pTHatMax1 &lt; pTHatMin1) pTHatMax1 = eCM;</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   mHatMin2      = settings.parm(&quot;PhaseSpace:mHatMinSecond&quot;);</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   mHatMax2      = settings.parm(&quot;PhaseSpace:mHatMaxSecond&quot;);</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   if (mHatMax2 &lt; mHatMin2) mHatMax2 = eCM;</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :   pTHatMin2     = settings.parm(&quot;PhaseSpace:pTHatMinSecond&quot;);</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   pTHatMax2     = settings.parm(&quot;PhaseSpace:pTHatMaxSecond&quot;);</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :   if (pTHatMax2 &lt; pTHatMin2) pTHatMax2 = eCM;</span>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span>            :   // Check whether mass and pT ranges agree or overlap.
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :   cutsAgree     = doSameCuts;</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   if (mHatMin2 == mHatMin1 &amp;&amp; mHatMax2 == mHatMax1 &amp;&amp; pTHatMin2 == pTHatMin1</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :       &amp;&amp; pTHatMax2 == pTHatMax1) cutsAgree = true;</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   cutsOverlap   = cutsAgree;</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   if (!cutsAgree) {</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :     bool mHatOverlap = (max( mHatMin1, mHatMin2)</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :                       &lt; min( mHatMax1, mHatMax2));</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :     bool pTHatOverlap = (max( pTHatMin1, pTHatMin2)</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :                        &lt; min( pTHatMax1, pTHatMax2));</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     if (mHatOverlap &amp;&amp; pTHatOverlap) cutsOverlap = true;</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     114 </span>            : 
<span class="lineNum">     115 </span>            :   // Set up containers for all the internal hard processes.
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :   SetupContainers setupContainers;</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :   setupContainers.init(containerPtrs, infoPtr, settings, particleDataPtr,</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :                        couplingsPtr);</span>
<span class="lineNum">     119 </span>            : 
<span class="lineNum">     120 </span>            :   // Append containers for external hard processes, if any.
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :   if (sigmaPtrs.size() &gt; 0) {</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     for (int iSig = 0; iSig &lt; int(sigmaPtrs.size()); ++iSig)</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :       containerPtrs.push_back( new ProcessContainer(sigmaPtrs[iSig],</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :         true, phaseSpacePtrs[iSig]) );</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     126 </span>            : 
<span class="lineNum">     127 </span>            :   // Append single container for Les Houches processes, if any.
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   if (doLHA) {</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :     SigmaProcess* sigmaPtr = new SigmaLHAProcess();</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :     containerPtrs.push_back( new ProcessContainer(sigmaPtr) );</span>
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span>            :     // Store location of this container, and send in LHA pointer.
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     iLHACont = containerPtrs.size() - 1;</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     containerPtrs[iLHACont]-&gt;setLHAPtr(lhaUpPtr);</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :   // If no processes found then refuse to do anything.
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :   if ( int(containerPtrs.size()) == 0) {</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     140 </span>            :       &quot;no process switched on&quot;);
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     142 </span>            :   }
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span>            :   // Check whether pT-based weighting in 2 -&gt; 2 is requested.
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :   if (settings.flag(&quot;PhaseSpace:bias2Selection&quot;)) {</span>
<span class="lineNum">     146 </span>            :     bool bias2Sel = false;
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     if (sigmaPtrs.size() == 0 &amp;&amp; !doLHA &amp;&amp; !doSecondHard) {</span>
<span class="lineNum">     148 </span>            :       bias2Sel = true;
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :       for (int i = 0; i &lt; int(containerPtrs.size()); ++i) {</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :         if (containerPtrs[i]-&gt;nFinal() != 2) bias2Sel = false;</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :         int code = containerPtrs[i]-&gt;code();</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :         if (code &gt; 100 &amp;&amp; code &lt; 110) bias2Sel = false;</span>
<span class="lineNum">     153 </span>            :       }
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :     if (!bias2Sel) {</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :       infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     157 </span>            :         &quot;requested event weighting not possible&quot;);
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :       return false;</span>
<span class="lineNum">     159 </span>            :     }
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span>            :   // Check that SUSY couplings were indeed initialized where necessary.
<span class="lineNum">     163 </span>            :   bool hasSUSY = false;
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :     if (containerPtrs[i]-&gt;isSUSY()) hasSUSY = true;</span>
<span class="lineNum">     166 </span>            : 
<span class="lineNum">     167 </span>            :   // If SUSY processes requested but no SUSY couplings present
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   if(hasSUSY &amp;&amp; !couplingsPtr-&gt;isSUSY) {</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     170 </span>            :       &quot;SUSY process switched on but no SUSY couplings found&quot;);
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     172 </span>            :   }
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span>            :   // Fill SLHA blocks SMINPUTS and MASS from PYTHIA SM parameter values.
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :   slhaInterfacePtr-&gt;pythia2slha(particleDataPtr);</span>
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span>            :   // Initialize each process.
<span class="lineNum">     178 </span>            :   int numberOn = 0;
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     if (containerPtrs[i]-&gt;init(true, infoPtr, settings, particleDataPtr,</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :       rndmPtr, beamAPtr, beamBPtr, couplingsPtr, sigmaTotPtr,</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :       &amp;resonanceDecays, slhaInterfacePtr, userHooksPtr)) ++numberOn;</span>
<span class="lineNum">     183 </span>            : 
<span class="lineNum">     184 </span>            :   // Sum maxima for Monte Carlo choice.
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   sigmaMaxSum = 0.;</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :     sigmaMaxSum += containerPtrs[i]-&gt;sigmaMax();</span>
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            :   // Option to pick a second hard interaction: repeat as above.
<span class="lineNum">     190 </span>            :   int number2On = 0;
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   if (doSecondHard) {</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :     setupContainers.init2(container2Ptrs, settings);</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :     if ( int(container2Ptrs.size()) == 0) {</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :       infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     195 </span>            :         &quot;no second hard process switched on&quot;);
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :       return false;</span>
<span class="lineNum">     197 </span>            :     }
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :     for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :       if (container2Ptrs[i2]-&gt;init(false, infoPtr, settings, particleDataPtr,</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :         rndmPtr, beamAPtr, beamBPtr, couplingsPtr, sigmaTotPtr,</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :         &amp;resonanceDecays, slhaInterfacePtr, userHooksPtr)) ++number2On;</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :     sigma2MaxSum = 0.;</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :     for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :       sigma2MaxSum += container2Ptrs[i2]-&gt;sigmaMax();</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            :   // Printout during initialization is optional.
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :   if (settings.flag(&quot;Init:showProcesses&quot;)) {</span>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            :     // Construct string with incoming beams and for cm energy.
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :     string collision = &quot;We collide &quot; + particleDataPtr-&gt;name(idA)</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :       + &quot; with &quot; + particleDataPtr-&gt;name(idB) + &quot; at a CM energy of &quot;;</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :     string pad( 51 - collision.length(), ' ');</span>
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span>            :     // Print initialization information: header.
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot;\n *-------  PYTHIA Process Initialization  ---------&quot;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;-----------------*\n&quot;</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;               |\n&quot;</span>
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; | &quot; &lt;&lt; collision &lt;&lt; scientific &lt;&lt; setprecision(3)</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(9) &lt;&lt; eCM &lt;&lt; &quot; GeV&quot; &lt;&lt; pad &lt;&lt; &quot; |\n&quot;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;               |\n&quot;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |---------------------------------------------------&quot;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;---------------|\n&quot;</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |             |\n&quot;</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; | Subprocess                                    Code&quot;</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |   Estimated |\n&quot;</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |    max (mb) |\n&quot;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |             |\n&quot;</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |---------------------------------------------------&quot;</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;---------------|\n&quot;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; |             |\n&quot;;</span>
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span>            :     // Loop over existing processes: print individual process info.
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :     map&lt;int, double&gt; sigmaMaxM;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :     map&lt;int, string&gt; nameM;</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     for (int i = 0; i &lt; int(containerPtrs.size()); ++i) {</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :       int code = containerPtrs[i]-&gt;code();</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :       nameM[code] = containerPtrs[i]-&gt;name();</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :       sigmaMaxM[code] = containerPtrs[i]-&gt;sigmaMax() &gt; sigmaMaxM[code] ?</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         containerPtrs[i]-&gt;sigmaMax() : sigmaMaxM[code];</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     for (map&lt;int, string&gt;::iterator i = nameM.begin(); i != nameM.end(); ++i)</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :       os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; i-&gt;second</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :          &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; i-&gt;first &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :          &lt;&lt; scientific &lt;&lt; setprecision(3) &lt;&lt; setw(11)</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :          &lt;&lt; sigmaMaxM[i-&gt;first] &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span>            :     // Loop over second hard processes, if any, and repeat as above.
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :     if (doSecondHard) {</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :       os &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; |             |\n&quot;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; |---------------------------------------------------&quot;</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :          &lt;&lt;&quot;---------------|\n&quot;</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; |                                                   &quot;</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :          &lt;&lt;&quot; |             |\n&quot;;</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :       sigmaMaxM.clear();</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :       nameM.clear();</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :       for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2) {</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         int code = container2Ptrs[i2]-&gt;code();</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         nameM[code] = container2Ptrs[i2]-&gt;name();</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :         sigmaMaxM[code] = container2Ptrs[i2]-&gt;sigmaMax() &gt; sigmaMaxM[code] ?</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :           container2Ptrs[i2]-&gt;sigmaMax() : sigmaMaxM[code];</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :       for (map&lt;int, string&gt;::iterator i2 = nameM.begin(); i2 != nameM.end();</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :            ++i2)</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :         os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; i2-&gt;second</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :            &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; i2-&gt;first &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :            &lt;&lt; scientific &lt;&lt; setprecision(3) &lt;&lt; setw(11)</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :            &lt;&lt; sigmaMaxM[i2-&gt;first] &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     277 </span>            : 
<span class="lineNum">     278 </span>            :     // Listing finished.
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot; |                                                     &quot;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot;             |\n&quot;</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; *-------  End PYTHIA Process Initialization ----------&quot;</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :        &lt;&lt;&quot;-------------*&quot; &lt;&lt; endl;</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     284 </span>            : 
<span class="lineNum">     285 </span>            :   // If sum of maxima vanishes then refuse to do anything.
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   if ( numberOn == 0  || sigmaMaxSum &lt;= 0.) {</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     288 </span>            :       &quot;all processes have vanishing cross sections&quot;);
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     290 </span>            :   }
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :   if ( doSecondHard &amp;&amp; (number2On == 0  || sigma2MaxSum &lt;= 0.) ) {</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::init: &quot;</span>
<span class="lineNum">     293 </span>            :       &quot;all second hard processes have vanishing cross sections&quot;);
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     295 </span>            :   }
<span class="lineNum">     296 </span>            : 
<span class="lineNum">     297 </span>            :   // If two hard processes then check whether some (but not all) agree.
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :   allHardSame  = true;</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :   noneHardSame = true;</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :   if (doSecondHard) {</span>
<span class="lineNum">     301 </span>            :     bool foundMatch = false;
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span>            :     // Check for each first process if matched in second.
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :     for (int i = 0; i &lt; int(containerPtrs.size()); ++i) {</span>
<span class="lineNum">     305 </span>            :       foundMatch = false;
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :       if (cutsOverlap)</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :         if (container2Ptrs[i2]-&gt;code() == containerPtrs[i]-&gt;code())</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :           foundMatch = true;</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :       containerPtrs[i]-&gt;isSame( foundMatch );</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       if (!foundMatch)  allHardSame = false;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       if ( foundMatch) noneHardSame = false;</span>
<span class="lineNum">     313 </span>            :     }
<span class="lineNum">     314 </span>            : 
<span class="lineNum">     315 </span>            :     // Check for each second process if matched in first.
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :     for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2) {</span>
<span class="lineNum">     317 </span>            :       foundMatch = false;
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :       if (cutsOverlap)</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :       for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :         if (containerPtrs[i]-&gt;code() == container2Ptrs[i2]-&gt;code())</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :           foundMatch = true;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :       container2Ptrs[i2]-&gt;isSame( foundMatch );</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :       if (!foundMatch)  allHardSame = false;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :       if ( foundMatch) noneHardSame = false;</span>
<span class="lineNum">     325 </span>            :     }
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span>            :   // Concluding classification, including cuts.
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :   if (!cutsAgree) allHardSame = false;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   someHardSame = !allHardSame &amp;&amp; !noneHardSame;</span>
<span class="lineNum">     331 </span>            : 
<span class="lineNum">     332 </span>            :   // Reset counters for average impact-parameter enhancement.
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   nImpact       = 0;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   sumImpactFac  = 0.;</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   sum2ImpactFac = 0.;</span>
<span class="lineNum">     336 </span>            : 
<span class="lineNum">     337 </span>            :   // Done.
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :   return true;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     340 </span>            : 
<span class="lineNum">     341 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     342 </span>            : 
<a name="343"><span class="lineNum">     343 </span>            : // Main routine to generate the hard process.</a>
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span>            : bool ProcessLevel::next( Event&amp; process) {
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span>            :   // Generate the next event with two or one hard interactions.
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   bool physical = (doSecondHard) ? nextTwo( process) : nextOne( process);</span>
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span>            :   // Check that colour assignments make sense.
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :   if (physical) physical = checkColours( process);</span>
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span>            :   // Done.
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :   return physical;</span>
<span class="lineNum">     355 </span>            : }
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     358 </span>            : 
<a name="359"><span class="lineNum">     359 </span>            : // Generate (= read in) LHA input of resonance decay only.</a>
<span class="lineNum">     360 </span>            : 
<span class="lineNum">     361 </span>            : bool ProcessLevel::nextLHAdec( Event&amp; process) {
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span>            :   // Read resonance decays from LHA interface.
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   infoPtr-&gt;setEndOfFile(false);</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   if (!lhaUpPtr-&gt;setEvent()) {</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :     infoPtr-&gt;setEndOfFile(true);</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     368 </span>            :   }
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span>            :   // Store LHA output in standard event record format.
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   containerLHAdec.constructDecays( process);</span>
<span class="lineNum">     372 </span>            : 
<span class="lineNum">     373 </span>            :   // Done.
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   return true;</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     378 </span>            : 
<a name="379"><span class="lineNum">     379 </span>            : // Accumulate and update statistics (after possible user veto).</a>
<span class="lineNum">     380 </span>            : 
<span class="lineNum">     381 </span>            : void ProcessLevel::accumulate() {
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span>            :   // Increase number of accepted events.
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :   containerPtrs[iContainer]-&gt;accumulate();</span>
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span>            :   // Provide current generated cross section estimate.
<span class="lineNum">     387 </span>            :   long   nTrySum    = 0;
<span class="lineNum">     388 </span>            :   long   nSelSum    = 0;
<span class="lineNum">     389 </span>            :   long   nAccSum    = 0;
<span class="lineNum">     390 </span>            :   double sigmaSum   = 0.;
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   double delta2Sum  = 0.;</span>
<span class="lineNum">     392 </span>            :   double sigSelSum  = 0.;
<span class="lineNum">     393 </span>            :   double weightSum  = 0.;
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   int    codeNow;</span>
<span class="lineNum">     395 </span>            :   long   nTryNow, nSelNow, nAccNow;
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :   double sigmaNow, deltaNow, sigSelNow, weightNow;</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   map&lt;int, bool&gt; duplicate;</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   if (containerPtrs[i]-&gt;sigmaMax() != 0.) {</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :     codeNow         = containerPtrs[i]-&gt;code();</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :     nTryNow         = containerPtrs[i]-&gt;nTried();</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :     nSelNow         = containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :     nAccNow         = containerPtrs[i]-&gt;nAccepted();</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :     sigmaNow        = containerPtrs[i]-&gt;sigmaMC();</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     deltaNow        = containerPtrs[i]-&gt;deltaMC();</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :     sigSelNow       = containerPtrs[i]-&gt;sigmaSelMC();</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :     weightNow       = containerPtrs[i]-&gt;weightSum();</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :     nTrySum        += nTryNow;</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :     nSelSum        += nSelNow;</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     nAccSum        += nAccNow;</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :     sigmaSum       += sigmaNow;</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :     delta2Sum      += pow2(deltaNow);</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :     sigSelSum      += sigSelNow;</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :     weightSum      += weightNow;</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :     if (!doSecondHard) {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :       if (!duplicate[codeNow])</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :         infoPtr-&gt;setSigma( codeNow, containerPtrs[i]-&gt;name(),</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :           nTryNow, nSelNow, nAccNow, sigmaNow, deltaNow, weightNow);</span>
<span class="lineNum">     419 </span>            :       else
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :         infoPtr-&gt;addSigma( codeNow, nTryNow, nSelNow, nAccNow, sigmaNow,</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :           deltaNow);</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :       duplicate[codeNow] = true;</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     424 </span>            :   }
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span>            :   // Normally only one hard interaction. Then store info and done.
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   if (!doSecondHard) {</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :     double deltaSum = sqrtpos(delta2Sum);</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :     infoPtr-&gt;setSigma( 0, &quot;sum&quot;, nTrySum, nSelSum, nAccSum, sigmaSum, deltaSum,</span>
<span class="lineNum">     430 </span>            :       weightSum);
<span class="lineNum">     431 </span>            :     return;
<span class="lineNum">     432 </span>            :   }
<span class="lineNum">     433 </span>            : 
<span class="lineNum">     434 </span>            :   // Increase counter for a second hard interaction.
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   container2Ptrs[i2Container]-&gt;accumulate();</span>
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span>            :   // Update statistics on average impact factor.
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :   ++nImpact;</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :   sumImpactFac     += infoPtr-&gt;enhanceMPI();</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :   sum2ImpactFac    += pow2(infoPtr-&gt;enhanceMPI());</span>
<span class="lineNum">     441 </span>            : 
<span class="lineNum">     442 </span>            :   // Cross section estimate for second hard process.
<span class="lineNum">     443 </span>            :   double sigma2Sum  = 0.;
<span class="lineNum">     444 </span>            :   double sig2SelSum = 0.;
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :   if (container2Ptrs[i2]-&gt;sigmaMax() != 0.) {</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     nTrySum        += container2Ptrs[i2]-&gt;nTried();</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     sigma2Sum      += container2Ptrs[i2]-&gt;sigmaMC();</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     sig2SelSum     += container2Ptrs[i2]-&gt;sigmaSelMC();</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     451 </span>            : 
<span class="lineNum">     452 </span>            :   // Average impact-parameter factor and error.
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :   double invN       = 1. / max(1, nImpact);</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :   double impactFac  = max( 1., sumImpactFac * invN);</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :   double impactErr2 = ( sum2ImpactFac * invN / pow2(impactFac) - 1.) * invN;</span>
<span class="lineNum">     456 </span>            : 
<span class="lineNum">     457 </span>            :   // Cross section estimate for combination of first and second process.
<span class="lineNum">     458 </span>            :   // Combine two possible ways and take average.
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   double sigmaComb  = 0.5 * (sigmaSum * sig2SelSum + sigSelSum * sigma2Sum);</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :   sigmaComb        *= impactFac / sigmaND;</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :   if (allHardSame) sigmaComb *= 0.5;</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :   double deltaComb  = sqrtpos(2. / nAccSum + impactErr2) * sigmaComb;</span>
<span class="lineNum">     463 </span>            : 
<span class="lineNum">     464 </span>            :   // Store info and done.
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :   infoPtr-&gt;setSigma( 0, &quot;sum&quot;, nTrySum, nSelSum, nAccSum, sigmaComb, deltaComb,</span>
<span class="lineNum">     466 </span>            :     weightSum);
<span class="lineNum">     467 </span>            : 
<span class="lineNum">     468 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     471 </span>            : 
<a name="472"><span class="lineNum">     472 </span>            : // Print statistics on cross sections and number of events.</a>
<span class="lineNum">     473 </span>            : 
<span class="lineNum">     474 </span>            : void ProcessLevel::statistics(bool reset, ostream&amp; os) {
<span class="lineNum">     475 </span>            : 
<span class="lineNum">     476 </span>            :   // Special processing if two hard interactions selected.
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :   if (doSecondHard) {</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :     statistics2(reset, os);</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     480 </span>            :   }
<span class="lineNum">     481 </span>            : 
<span class="lineNum">     482 </span>            :   // Header.
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot;\n *-------  PYTHIA Event and Cross Section Statistics  ------&quot;</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;-------------------------------------------------------*\n&quot;</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                            &quot;</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                                                     |\n&quot;</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | Subprocess                                    Code |       &quot;</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;     Number of events       |      sigma +- delta    |\n&quot;</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                    |       &quot;</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;Tried   Selected   Accepted |     (estimated) (mb)   |\n&quot;</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                    |       &quot;</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                            |                        |\n&quot;</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |------------------------------------------------------------&quot;</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;-----------------------------------------------------|\n&quot;</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                    |       &quot;</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                            |                        |\n&quot;;</span>
<span class="lineNum">     497 </span>            : 
<span class="lineNum">     498 </span>            :   // Reset sum counters.
<span class="lineNum">     499 </span>            :   long   nTrySum   = 0;
<span class="lineNum">     500 </span>            :   long   nSelSum   = 0;
<span class="lineNum">     501 </span>            :   long   nAccSum   = 0;
<span class="lineNum">     502 </span>            :   double sigmaSum  = 0.;
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :   double delta2Sum = 0.;</span>
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span>            :   // Reset process maps.
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :   map&lt;int, string&gt; nameM;</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :   map&lt;int, long&gt; nTryM, nSelM, nAccM;</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :   map&lt;int, double&gt; sigmaM, delta2M;</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :   vector&lt;ProcessContainer*&gt; lheContainerPtrs;</span>
<span class="lineNum">     510 </span>            : 
<span class="lineNum">     511 </span>            :   // Loop over existing processes.
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :   if (containerPtrs[i]-&gt;sigmaMax() != 0.) {</span>
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span>            :     // Read info for process. Sum counters.
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     nTrySum       += containerPtrs[i]-&gt;nTried();</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     nSelSum       += containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :     nAccSum       += containerPtrs[i]-&gt;nAccepted();</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     sigmaSum      += containerPtrs[i]-&gt;sigmaMC();</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     delta2Sum     += pow2(containerPtrs[i]-&gt;deltaMC());</span>
<span class="lineNum">     521 </span>            : 
<span class="lineNum">     522 </span>            :     // Skip Les Houches containers.
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     if (containerPtrs[i]-&gt;code() == 9999) {</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :       lheContainerPtrs.push_back(containerPtrs[i]);</span>
<span class="lineNum">     525 </span>            :       continue;
<span class="lineNum">     526 </span>            :     }
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span>            :     // Internal process info.
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :     int code = containerPtrs[i]-&gt;code();</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     nameM[code]   = containerPtrs[i]-&gt;name();</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :     nTryM[code]  += containerPtrs[i]-&gt;nTried();</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :     nSelM[code]  += containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     nAccM[code]  += containerPtrs[i]-&gt;nAccepted();</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :     sigmaM[code] += containerPtrs[i]-&gt;sigmaMC();</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     delta2M[code]+= pow2(containerPtrs[i]-&gt;deltaMC());</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     537 </span>            : 
<span class="lineNum">     538 </span>            :   // Print internal process info.
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :   for (map&lt;int, string&gt;::iterator i = nameM.begin(); i != nameM.end(); ++i) {</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     int code = i-&gt;first;</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; i-&gt;second</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :        &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; code &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; nTryM[code] &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelM[code] &lt;&lt; &quot; &quot;</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(10) &lt;&lt; nAccM[code] &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3)</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sigmaM[code]</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2M[code]) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span>            :   // Print Les Houches process info.
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(lheContainerPtrs.size()); ++i) {</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     ProcessContainer *ptr = lheContainerPtrs[i];</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; ptr-&gt;name()</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :        &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; ptr-&gt;code() &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; ptr-&gt;nTried() &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; ptr-&gt;nSelected()</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; ptr-&gt;nAccepted() &lt;&lt; &quot; | &quot; &lt;&lt; scientific</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :        &lt;&lt; setprecision(3) &lt;&lt; setw(11) &lt;&lt; ptr-&gt;sigmaMC() &lt;&lt; setw(11)</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :        &lt;&lt; ptr-&gt;deltaMC() &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">     558 </span>            : 
<span class="lineNum">     559 </span>            :     // Print subdivision by user code for Les Houches process.
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :     for (int j = 0; j &lt; ptr-&gt;codeLHASize(); ++j)</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :       os &lt;&lt; &quot; |    ... whereof user classification code &quot; &lt;&lt; setw(10)</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :          &lt;&lt; ptr-&gt;subCodeLHA(j) &lt;&lt; &quot; | &quot; &lt;&lt; setw(11) &lt;&lt; ptr-&gt;nTriedLHA(j)</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; ptr-&gt;nSelectedLHA(j) &lt;&lt; &quot; &quot; &lt;&lt; setw(10)</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :          &lt;&lt; ptr-&gt;nAcceptedLHA(j) &lt;&lt; &quot; |                        | \n&quot;;</span>
<span class="lineNum">     565 </span>            :   }
<span class="lineNum">     566 </span>            : 
<span class="lineNum">     567 </span>            :   // Print summed process info.
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                                    |       &quot;</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                            |                        |\n&quot;</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(50) &lt;&lt; &quot;sum&quot; &lt;&lt; right &lt;&lt; &quot; | &quot; &lt;&lt; setw(11)</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :      &lt;&lt; nTrySum &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelSum &lt;&lt; &quot; &quot; &lt;&lt; setw(10)</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :      &lt;&lt; nAccSum &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3) &lt;&lt; setw(11)</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :      &lt;&lt; sigmaSum &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2Sum) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">     574 </span>            : 
<span class="lineNum">     575 </span>            :   // Listing finished.
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                                            &quot;</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                                                     |\n&quot;</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; *-------  End PYTHIA Event and Cross Section Statistics -----&quot;</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;-----------------------------------------------------*&quot; &lt;&lt; endl;</span>
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span>            :   // Optionally reset statistics contants.
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :   if (reset) resetStatistics();</span>
<span class="lineNum">     583 </span>            : 
<span class="lineNum">     584 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     585 </span>            : 
<span class="lineNum">     586 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     587 </span>            : 
<a name="588"><span class="lineNum">     588 </span>            : // Reset statistics on cross sections and number of events.</a>
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span>            : void ProcessLevel::resetStatistics() {
<span class="lineNum">     591 </span>            : 
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :     containerPtrs[i]-&gt;reset();</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :   if (doSecondHard)</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :   for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :     container2Ptrs[i2]-&gt;reset();</span>
<span class="lineNum">     597 </span>            : 
<span class="lineNum">     598 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     599 </span>            : 
<span class="lineNum">     600 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     601 </span>            : 
<a name="602"><span class="lineNum">     602 </span>            : // Generate the next event with one interaction.</a>
<span class="lineNum">     603 </span>            : 
<span class="lineNum">     604 </span>            : bool ProcessLevel::nextOne( Event&amp; process) {
<span class="lineNum">     605 </span>            : 
<span class="lineNum">     606 </span>            :   // Update CM energy for phase space selection.
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :   double eCM = infoPtr-&gt;eCM();</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :     containerPtrs[i]-&gt;newECM(eCM);</span>
<span class="lineNum">     610 </span>            : 
<span class="lineNum">     611 </span>            :   // Outer loop in case of rare failures.
<span class="lineNum">     612 </span>            :   bool physical = true;
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :   for (int loop = 0; loop &lt; MAXLOOP; ++loop) {</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     if (!physical) process.clear();</span>
<span class="lineNum">     615 </span>            :     physical = true;
<span class="lineNum">     616 </span>            : 
<span class="lineNum">     617 </span>            :     // Loop over tries until trial event succeeds.
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :     for ( ; ; ) {</span>
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span>            :       // Pick one of the subprocesses.
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :       double sigmaMaxNow = sigmaMaxSum * rndmPtr-&gt;flat();</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :       int iMax = containerPtrs.size() - 1;</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :       iContainer = -1;</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :       do sigmaMaxNow -= containerPtrs[++iContainer]-&gt;sigmaMax();</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :       while (sigmaMaxNow &gt; 0. &amp;&amp; iContainer &lt; iMax);</span>
<span class="lineNum">     626 </span>            : 
<span class="lineNum">     627 </span>            :       // Do a trial event of this subprocess; accept or not.
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :       if (containerPtrs[iContainer]-&gt;trialProcess()) break;</span>
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span>            :       // Check for end-of-file condition for Les Houches events.
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :       if (infoPtr-&gt;atEndOfFile()) return false;</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     633 </span>            : 
<span class="lineNum">     634 </span>            :     // Update sum of maxima if current maximum violated.
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :     if (containerPtrs[iContainer]-&gt;newSigmaMax()) {</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :       sigmaMaxSum = 0.;</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :       for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :         sigmaMaxSum += containerPtrs[i]-&gt;sigmaMax();</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     640 </span>            : 
<span class="lineNum">     641 </span>            :     // Construct kinematics of acceptable process.
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     containerPtrs[iContainer]-&gt;constructState();</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :     if ( !containerPtrs[iContainer]-&gt;constructProcess( process) )</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :       physical = false;</span>
<span class="lineNum">     645 </span>            : 
<span class="lineNum">     646 </span>            :     // Do all resonance decays.
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :     if ( physical &amp;&amp; doResDecays</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :       &amp;&amp; !containerPtrs[iContainer]-&gt;decayResonances( process) )</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :       physical = false;</span>
<span class="lineNum">     650 </span>            : 
<span class="lineNum">     651 </span>            :     // Retry process for unphysical states.
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     for (int i =1; i &lt; process.size(); ++i)</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :       if (process[i].e() &lt; 0.) {</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :         infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::nextOne: &quot;</span>
<span class="lineNum">     655 </span>            :           &quot;Constructed particle with negative energy.&quot;);
<span class="lineNum">     656 </span>            :         physical = false;
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     658 </span>            : 
<span class="lineNum">     659 </span>            :     // Add any junctions to the process event record list.
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :     if (physical) findJunctions( process);</span>
<span class="lineNum">     661 </span>            : 
<span class="lineNum">     662 </span>            :     // Outer loop should normally work first time around.
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     if (physical) break;</span>
<span class="lineNum">     664 </span>            :   }
<span class="lineNum">     665 </span>            : 
<span class="lineNum">     666 </span>            :   // Done.
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :   return physical;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     669 </span>            : 
<span class="lineNum">     670 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     671 </span>            : 
<a name="672"><span class="lineNum">     672 </span>            : // Generate the next event with two hard interactions.</a>
<span class="lineNum">     673 </span>            : 
<span class="lineNum">     674 </span>            : bool ProcessLevel::nextTwo( Event&amp; process) {
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span>            :   // Update CM energy for phase space selection.
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :   double eCM = infoPtr-&gt;eCM();</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :     containerPtrs[i]-&gt;newECM(eCM);</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     container2Ptrs[i2]-&gt;newECM(eCM);</span>
<span class="lineNum">     682 </span>            : 
<span class="lineNum">     683 </span>            :   // Outer loop in case of rare failures.
<span class="lineNum">     684 </span>            :   bool physical = true;
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :   for (int loop = 0; loop &lt; MAXLOOP; ++loop) {</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     if (!physical) process.clear();</span>
<span class="lineNum">     687 </span>            :     physical = true;
<span class="lineNum">     688 </span>            : 
<span class="lineNum">     689 </span>            :     // Loop over both hard processes to find consistent common kinematics.
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :     for ( ; ; ) {</span>
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span>            :       // Loop internally over tries for hardest process until succeeds.
<span class="lineNum">     693 </span>            :       for ( ; ; ) {
<span class="lineNum">     694 </span>            : 
<span class="lineNum">     695 </span>            :         // Pick one of the subprocesses.
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :         double sigmaMaxNow = sigmaMaxSum * rndmPtr-&gt;flat();</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :         int iMax = containerPtrs.size() - 1;</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :         iContainer = -1;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :         do sigmaMaxNow -= containerPtrs[++iContainer]-&gt;sigmaMax();</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :         while (sigmaMaxNow &gt; 0. &amp;&amp; iContainer &lt; iMax);</span>
<span class="lineNum">     701 </span>            : 
<span class="lineNum">     702 </span>            :         // Do a trial event of this subprocess; accept or not.
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :         if (containerPtrs[iContainer]-&gt;trialProcess()) break;</span>
<span class="lineNum">     704 </span>            : 
<span class="lineNum">     705 </span>            :         // Check for end-of-file condition for Les Houches events.
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :         if (infoPtr-&gt;atEndOfFile()) return false;</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     708 </span>            : 
<span class="lineNum">     709 </span>            :       // Update sum of maxima if current maximum violated.
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :       if (containerPtrs[iContainer]-&gt;newSigmaMax()) {</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :         sigmaMaxSum = 0.;</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :         for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :           sigmaMaxSum += containerPtrs[i]-&gt;sigmaMax();</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     715 </span>            : 
<span class="lineNum">     716 </span>            :       // Loop internally over tries for second hardest process until succeeds.
<span class="lineNum">     717 </span>            :       for ( ; ; ) {
<span class="lineNum">     718 </span>            : 
<span class="lineNum">     719 </span>            :         // Pick one of the subprocesses.
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :         double sigma2MaxNow = sigma2MaxSum * rndmPtr-&gt;flat();</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :         int i2Max = container2Ptrs.size() - 1;</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :         i2Container = -1;</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :         do sigma2MaxNow -= container2Ptrs[++i2Container]-&gt;sigmaMax();</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :         while (sigma2MaxNow &gt; 0. &amp;&amp; i2Container &lt; i2Max);</span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span>            :         // Do a trial event of this subprocess; accept or not.
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :         if (container2Ptrs[i2Container]-&gt;trialProcess()) break;</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     729 </span>            : 
<span class="lineNum">     730 </span>            :       // Update sum of maxima if current maximum violated.
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :       if (container2Ptrs[i2Container]-&gt;newSigmaMax()) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :         sigma2MaxSum = 0.;</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :         for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :           sigma2MaxSum += container2Ptrs[i2]-&gt;sigmaMax();</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     736 </span>            : 
<span class="lineNum">     737 </span>            :       // Pick incoming flavours (etc), needed for PDF reweighting.
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :       containerPtrs[iContainer]-&gt;constructState();</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :       container2Ptrs[i2Container]-&gt;constructState();</span>
<span class="lineNum">     740 </span>            : 
<span class="lineNum">     741 </span>            :       // Check whether common set of x values is kinematically possible.
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :       double xA1      = containerPtrs[iContainer]-&gt;x1();</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :       double xB1      = containerPtrs[iContainer]-&gt;x2();</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :       double xA2      = container2Ptrs[i2Container]-&gt;x1();</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :       double xB2      = container2Ptrs[i2Container]-&gt;x2();</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :       if (xA1 + xA2 &gt;= 1. || xB1 + xB2 &gt;= 1.) continue;</span>
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span>            :       // Reset beam contents. Naive parton densities for second interaction.
<span class="lineNum">     749 </span>            :       // (Subsequent procedure could be symmetrized, but would be overkill.)
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :       beamAPtr-&gt;clear();</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :       beamBPtr-&gt;clear();</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :       int    idA1     = containerPtrs[iContainer]-&gt;id1();</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :       int    idB1     = containerPtrs[iContainer]-&gt;id2();</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :       int    idA2     = container2Ptrs[i2Container]-&gt;id1();</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :       int    idB2     = container2Ptrs[i2Container]-&gt;id2();</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :       double Q2Fac1   = containerPtrs[iContainer]-&gt;Q2Fac();</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :       double Q2Fac2   = container2Ptrs[i2Container]-&gt;Q2Fac();</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :       double pdfA2Raw = beamAPtr-&gt;xf( idA2, xA2,Q2Fac2);</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :       double pdfB2Raw = beamBPtr-&gt;xf( idB2, xB2,Q2Fac2);</span>
<span class="lineNum">     760 </span>            : 
<span class="lineNum">     761 </span>            :       // Remove partons in first interaction from beams.
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :       beamAPtr-&gt;append( 3, idA1, xA1);</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :       beamAPtr-&gt;xfISR( 0, idA1, xA1, Q2Fac1);</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :       beamAPtr-&gt;pickValSeaComp();</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :       beamBPtr-&gt;append( 4, idB1, xB1);</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :       beamBPtr-&gt;xfISR( 0, idB1, xB1, Q2Fac1);</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :       beamBPtr-&gt;pickValSeaComp();</span>
<span class="lineNum">     768 </span>            : 
<span class="lineNum">     769 </span>            :       // Reevaluate pdf's for second interaction and weight by reduction.
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :       double pdfA2Mod = beamAPtr-&gt;xfMPI( idA2, xA2,Q2Fac2);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :       double pdfB2Mod = beamBPtr-&gt;xfMPI( idB2, xB2,Q2Fac2);</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :       double wtPdfMod = (pdfA2Mod * pdfB2Mod) / (pdfA2Raw * pdfB2Raw);</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :       if (wtPdfMod &lt; rndmPtr-&gt;flat()) continue;</span>
<span class="lineNum">     774 </span>            : 
<span class="lineNum">     775 </span>            :       // Reduce by a factor of 2 for identical processes when others not,
<span class="lineNum">     776 </span>            :       // and when in same phase space region.
<span class="lineNum">     777 </span>            :       bool toLoop = false;
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :       if ( someHardSame &amp;&amp; containerPtrs[iContainer]-&gt;isSame()</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :         &amp;&amp; container2Ptrs[i2Container]-&gt;isSame()) {</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :         if (cutsAgree) {</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :           if (rndmPtr-&gt;flat() &gt; 0.5) toLoop = true;</span>
<span class="lineNum">     782 </span>            :         } else {
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :         double mHat1 = containerPtrs[iContainer]-&gt;mHat();</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :         double pTHat1 = containerPtrs[iContainer]-&gt;pTHat();</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :         double mHat2 = container2Ptrs[i2Container]-&gt;mHat();</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :         double pTHat2 = container2Ptrs[i2Container]-&gt;pTHat();</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :         if (mHat1 &gt; mHatMin2 &amp;&amp; mHat1 &lt; mHatMax2</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :            &amp;&amp; pTHat1 &gt; pTHatMin2 &amp;&amp; pTHat1 &lt; pTHatMax2</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :            &amp;&amp; mHat2 &gt; mHatMin1 &amp;&amp; mHat2 &lt; mHatMax1</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :            &amp;&amp; pTHat2 &gt; pTHatMin1 &amp;&amp; pTHat2 &lt; pTHatMax1</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :            &amp;&amp; rndmPtr-&gt;flat() &gt; 0.5) toLoop = true;</span>
<span class="lineNum">     792 </span>            :         }
<span class="lineNum">     793 </span>            :       }
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :       if (toLoop) continue;</span>
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span>            :       // If come this far then acceptable event.
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     798 </span>            :     }
<span class="lineNum">     799 </span>            : 
<span class="lineNum">     800 </span>            :     // Construct kinematics of acceptable processes.
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :     Event process2;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :     process2.init( &quot;(second hard)&quot;, particleDataPtr, startColTag);</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :     process2.initColTag();</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :     if ( !containerPtrs[iContainer]-&gt;constructProcess( process) )</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :       physical = false;</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :     if (physical &amp;&amp; !container2Ptrs[i2Container]-&gt;constructProcess( process2,</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :       false) ) physical = false;</span>
<span class="lineNum">     808 </span>            : 
<span class="lineNum">     809 </span>            :     // Do all resonance decays.
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :     if ( physical &amp;&amp; doResDecays</span>
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :       &amp;&amp;  !containerPtrs[iContainer]-&gt;decayResonances( process) )</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :       physical = false;</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :     if ( physical &amp;&amp; doResDecays</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :       &amp;&amp;  !container2Ptrs[i2Container]-&gt;decayResonances( process2) )</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :       physical = false;</span>
<span class="lineNum">     816 </span>            : 
<span class="lineNum">     817 </span>            :     // Append second hard interaction to normal process object.
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :     if (physical) combineProcessRecords( process, process2);</span>
<span class="lineNum">     819 </span>            : 
<span class="lineNum">     820 </span>            :     // Add any junctions to the process event record list.
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     if (physical) findJunctions( process);</span>
<span class="lineNum">     822 </span>            : 
<span class="lineNum">     823 </span>            :     // Outer loop should normally work first time around.
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :     if (physical) break;</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     826 </span>            : 
<span class="lineNum">     827 </span>            :   // Done.
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :   return physical;</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     830 </span>            : 
<span class="lineNum">     831 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     832 </span>            : 
<span class="lineNum">     833 </span>            : // Append second hard interaction to normal process object.
<a name="834"><span class="lineNum">     834 </span>            : // Complication: all resonance decay chains must be put at the end.</a>
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span>            : void ProcessLevel::combineProcessRecords( Event&amp; process, Event&amp; process2) {
<span class="lineNum">     837 </span>            : 
<span class="lineNum">     838 </span>            :   // Find first event record size, excluding resonances.
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :   int nSize = process.size();</span>
<span class="lineNum">     840 </span>            :   int nHard = 5;
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :   while (nHard &lt; nSize &amp;&amp; process[nHard].mother1() == 3) ++nHard;</span>
<span class="lineNum">     842 </span>            : 
<span class="lineNum">     843 </span>            :   // Save resonance products temporarily elsewhere.
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :   vector&lt;Particle&gt; resProd;</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :   if (nSize &gt; nHard) {</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :     for (int i = nHard; i &lt; nSize; ++i) resProd.push_back( process[i] );</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :     process.popBack(nSize - nHard);</span>
<span class="lineNum">     848 </span>            :   }
<span class="lineNum">     849 </span>            : 
<span class="lineNum">     850 </span>            :   // Find second event record size, excluding resonances.
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :   int nSize2 = process2.size();</span>
<span class="lineNum">     852 </span>            :   int nHard2 = 5;
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :   while (nHard2 &lt; nSize2 &amp;&amp; process2[nHard2].mother1() == 3) ++nHard2;</span>
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span>            :   // Find amount of necessary position and colour offset for second process.
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :   int addPos  = nHard  - 3;</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :   int addCol  = process.lastColTag() - startColTag;</span>
<span class="lineNum">     858 </span>            : 
<span class="lineNum">     859 </span>            :   // Loop over all particles (except beams) from second process.
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :   for (int i = 3; i &lt; nSize2; ++i) {</span>
<span class="lineNum">     861 </span>            : 
<span class="lineNum">     862 </span>            :     // Offset mother and daughter pointers and colour tags of particle.
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :     process2[i].offsetHistory( 2, addPos, 2, addPos);</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :     process2[i].offsetCol( addCol);</span>
<span class="lineNum">     865 </span>            : 
<span class="lineNum">     866 </span>            :     // Append hard-process particles from process2 to process.
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :     if (i &lt; nHard2) process.append( process2[i] );</span>
<span class="lineNum">     868 </span>            :   }
<span class="lineNum">     869 </span>            : 
<span class="lineNum">     870 </span>            :   // Reinsert resonance decay chains of first hard process.
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :   int addPos2 = nHard2 - 3;</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :   if (nHard &lt; nSize) {</span>
<span class="lineNum">     873 </span>            : 
<span class="lineNum">     874 </span>            :     // Offset daughter pointers of unmoved mothers.
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :     for (int i = 5; i &lt; nHard; ++i)</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :       process[i].offsetHistory( 0, 0, nHard - 1, addPos2);</span>
<span class="lineNum">     877 </span>            : 
<span class="lineNum">     878 </span>            :     // Modify history of resonance products when restoring.
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     for (int i = 0; i &lt; int(resProd.size()); ++i) {</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :       resProd[i].offsetHistory( nHard - 1, addPos2, nHard - 1, addPos2);</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :       process.append( resProd[i] );</span>
<span class="lineNum">     882 </span>            :     }
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     884 </span>            : 
<span class="lineNum">     885 </span>            :   // Insert resonance decay chains of second hard process.
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :   if (nHard2 &lt; nSize2) {</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :     int nHard3  = nHard + nHard2 - 3;</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :     int addPos3 = nSize - nHard;</span>
<span class="lineNum">     889 </span>            : 
<span class="lineNum">     890 </span>            :     // Offset daughter pointers of second-process mothers.
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :     for (int i = nHard + 2; i &lt; nHard3; ++i)</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :       process[i].offsetHistory( 0, 0, nHard3 - 1, addPos3);</span>
<span class="lineNum">     893 </span>            : 
<span class="lineNum">     894 </span>            :     // Modify history of second-process resonance products and insert.
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :     for (int i = nHard2; i &lt; nSize2; ++i) {</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :       process2[i].offsetHistory( nHard3 - 1, addPos3, nHard3 - 1, addPos3);</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :       process.append( process2[i] );</span>
<span class="lineNum">     898 </span>            :     }
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     900 </span>            : 
<span class="lineNum">     901 </span>            :   // Store PDF scale for second interaction.
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :   process.scaleSecond( process2.scale() );</span>
<span class="lineNum">     903 </span>            : 
<span class="lineNum">     904 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     905 </span>            : 
<span class="lineNum">     906 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     907 </span>            : 
<span class="lineNum">     908 </span>            : // Add any junctions to the process event record list.
<a name="909"><span class="lineNum">     909 </span>            : // Also check that do not doublebook if called repeatedly.</a>
<span class="lineNum">     910 </span>            : 
<span class="lineNum">     911 </span>            : void ProcessLevel::findJunctions( Event&amp; junEvent) {
<span class="lineNum">     912 </span>            : 
<span class="lineNum">     913 </span>            :   // Check all hard vertices for BNV
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :   for (int i = 1; i&lt;junEvent.size(); i++) {</span>
<span class="lineNum">     915 </span>            : 
<span class="lineNum">     916 </span>            :     // Ignore colorless particles and stages before hard-scattering
<span class="lineNum">     917 </span>            :     // final state.
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :     if (abs(junEvent[i].status()) &lt;= 21 || junEvent[i].colType() == 0)</span>
<span class="lineNum">     919 </span>            :       continue;
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; motherList   = junEvent[i].motherList();</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :     int iMot1 = motherList[0];</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; sisterList = junEvent[iMot1].daughterList();</span>
<span class="lineNum">     923 </span>            : 
<span class="lineNum">     924 </span>            :     // Check baryon number of vertex.
<span class="lineNum">     925 </span>            :     int barSum = 0;
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     map&lt;int,int&gt; colVertex, acolVertex;</span>
<span class="lineNum">     927 </span>            : 
<span class="lineNum">     928 </span>            :     // Loop over mothers (enter with crossed colors and negative sign).
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :     for (unsigned int indx = 0; indx &lt; motherList.size(); indx++) {</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :       int iMot = motherList[indx];</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :       if ( abs(junEvent[iMot].colType()) == 1 )</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :         barSum -= junEvent[iMot].colType();</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :       else if ( abs(junEvent[iMot].colType()) == 3)</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :         barSum -= 2*junEvent[iMot].colType()/3;</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :       int col  = junEvent[iMot].acol();</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :       int acol  = junEvent[iMot].col();</span>
<span class="lineNum">     937 </span>            : 
<span class="lineNum">     938 </span>            :       // If unmatched (so far), add end. Else erase matching parton.
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :       if (col &gt; 0) {</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :         if (acolVertex.find(col) == acolVertex.end() ) colVertex[col] = iMot;</span>
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :         else acolVertex.erase(col);</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :       } else if (col &lt; 0) {</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :         if (colVertex.find(-col) == colVertex.end() ) acolVertex[-col] = iMot;</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :         else colVertex.erase(-col);</span>
<span class="lineNum">     945 </span>            :       }
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :       if (acol &gt; 0) {</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :         if (colVertex.find(acol) == colVertex.end()) acolVertex[acol] = iMot;</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :         else colVertex.erase(acol);</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :       } else if (acol &lt; 0) {</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :         if (acolVertex.find(-acol) == acolVertex.end())</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :              colVertex[-acol] = iMot;</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :         else acolVertex.erase(-acol);</span>
<span class="lineNum">     953 </span>            :       }
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     955 </span>            : 
<span class="lineNum">     956 </span>            :     // Loop over sisters.
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :     for (unsigned int indx = 0; indx &lt; sisterList.size(); indx++) {</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :       int iDau = sisterList[indx];</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :       if ( abs(junEvent[iDau].colType()) == 1 )</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :         barSum += junEvent[iDau].colType();</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :       else if ( abs(junEvent[iDau].colType()) == 3)</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :         barSum += 2*junEvent[iDau].colType()/3;</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :       int col  = junEvent[iDau].col();</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :       int acol  = junEvent[iDau].acol();</span>
<span class="lineNum">     965 </span>            : 
<span class="lineNum">     966 </span>            :       // If unmatched (so far), add end. Else erase matching parton.
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :       if (col &gt; 0) {</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :         if (acolVertex.find(col) == acolVertex.end() ) colVertex[col] = iDau;</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :         else acolVertex.erase(col);</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :       } else if (col &lt; 0) {</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :         if (colVertex.find(-col) == colVertex.end() ) acolVertex[-col] = iDau;</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :         else colVertex.erase(-col);</span>
<span class="lineNum">     973 </span>            :       }
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :       if (acol &gt; 0) {</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :         if (colVertex.find(acol) == colVertex.end()) acolVertex[acol] = iDau;</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :         else colVertex.erase(acol);</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :       } else if (acol &lt; 0) {</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :         if (acolVertex.find(-acol) == acolVertex.end())</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :              colVertex[-acol] = iDau;</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :         else acolVertex.erase(-acol);</span>
<span class="lineNum">     981 </span>            :       }
<span class="lineNum">     982 </span>            : 
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     984 </span>            : 
<span class="lineNum">     985 </span>            :     // Skip if baryon number conserved in this vertex.
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :     if (barSum == 0) continue;</span>
<span class="lineNum">     987 </span>            : 
<span class="lineNum">     988 </span>            :     // Check and skip any junctions that have already been added.
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :     for (int iJun = 0; iJun &lt; junEvent.sizeJunction(); ++iJun) {</span>
<span class="lineNum">     990 </span>            :       // Remove the tags corresponding to each of the 3 existing junction legs.
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :       for (int j = 0; j &lt; 3; ++j) {</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :         int colNow = junEvent.colJunction(iJun, j);</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :         if (junEvent.kindJunction(iJun) % 2 == 1) colVertex.erase(colNow);</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :         else acolVertex.erase(colNow);</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     996 </span>            :     }
<span class="lineNum">     997 </span>            : 
<span class="lineNum">     998 </span>            :     // Skip if no junction colors remain.
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :     if (colVertex.size() == 0 &amp;&amp; acolVertex.size() == 0) continue;</span>
<span class="lineNum">    1000 </span>            : 
<span class="lineNum">    1001 </span>            :     // If baryon number violated, is B = +1 or -1 (larger values not handled).
<span class="lineNum">    1002 </span>            :     int kindJun = 0;
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :     if (colVertex.size() == 3 &amp;&amp; acolVertex.size() == 0) kindJun = 1;</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :     else if (colVertex.size() == 0 &amp;&amp; acolVertex.size() == 3) kindJun = 2;</span>
<span class="lineNum">    1005 </span>            :     else {
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :       infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::findJunctions: &quot;</span>
<span class="lineNum">    1007 </span>            :                         &quot;N(unmatched (anti)colour tags) != 3&quot;);
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :       return;</span>
<span class="lineNum">    1009 </span>            :     }
<span class="lineNum">    1010 </span>            : 
<span class="lineNum">    1011 </span>            :     // From now on, use colJun as shorthand for colVertex or acolVertex.
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :     map&lt;int,int&gt; colJun = (kindJun == 1) ? colVertex : acolVertex;</span>
<span class="lineNum">    1013 </span>            : 
<span class="lineNum">    1014 </span>            :     // Order so incoming tags appear first in colVec, outgoing tags last.
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; colVec;</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :     for (map&lt;int,int&gt;::iterator it = colJun.begin();</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :          it != colJun.end(); it++) {</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :       int col  = it-&gt;first;</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :       int iCol = it-&gt;second;</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :       for (unsigned int indx = 0; indx &lt; motherList.size(); indx++) {</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :         if (iCol == motherList[indx]) {</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :           kindJun += 2;</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :           colVec.insert(colVec.begin(),col);</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1025 </span>            :       }
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :       if (colVec.size() == 0 || colVec[0] != col) colVec.push_back(col);</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1028 </span>            : 
<span class="lineNum">    1029 </span>            :     // Add junction with these tags.
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :     junEvent.appendJunction( kindJun, colVec[0], colVec[1], colVec[2]);</span>
<span class="lineNum">    1031 </span>            : 
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1033 </span>            : 
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1035 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">    1036 </span>            : 
<a name="1037"><span class="lineNum">    1037 </span>            : // Check that colours match up.</a>
<span class="lineNum">    1038 </span>            : 
<span class="lineNum">    1039 </span>            : bool ProcessLevel::checkColours( Event&amp; process) {
<span class="lineNum">    1040 </span>            : 
<span class="lineNum">    1041 </span>            :   // Variables and arrays for common usage.
<span class="lineNum">    1042 </span>            :   bool physical = true;
<span class="lineNum">    1043 </span>            :   bool match;
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :   int colType, col, acol, iPos, iNow, iNowA;</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :   vector&lt;int&gt; colTags, colPos, acolPos;</span>
<span class="lineNum">    1046 </span>            : 
<span class="lineNum">    1047 </span>            :   // Check that each particle has the kind of colours expected of it.
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; process.size(); ++i) {</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :     colType = process[i].colType();</span>
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :     col     = process[i].col();</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :     acol    = process[i].acol();</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :     if      (colType ==  0 &amp;&amp; (col != 0 || acol != 0)) physical = false;</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :     else if (colType ==  1 &amp;&amp; (col &lt;= 0 || acol != 0)) physical = false;</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :     else if (colType == -1 &amp;&amp; (col != 0 || acol &lt;= 0)) physical = false;</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :     else if (colType ==  2 &amp;&amp; (col &lt;= 0 || acol &lt;= 0)) physical = false;</span>
<span class="lineNum">    1056 </span>            :     // Colour-sextet assignments (colType == 3 for sextet, -3 for antisextet).
<span class="lineNum">    1057 </span>            :     // Sextet (two colours) represented by (colour, negative anticolour) tags.
<span class="lineNum">    1058 </span>            :     // Antisextet (two anticolours) by (negative colour, anticolour) tags.
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :     else if (colType ==  3 &amp;&amp; (col &lt;= 0 || acol &gt;= 0)) physical = false;</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :     else if (colType == -3 &amp;&amp; (col &gt;= 0 || acol &lt;= 0)) physical = false;</span>
<span class="lineNum">    1061 </span>            :     // All other cases
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :     else if (colType == -2 || colType &lt; -3 || colType &gt; 3) physical = false;</span>
<span class="lineNum">    1063 </span>            : 
<span class="lineNum">    1064 </span>            :     // Add to the list of colour tags.
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :     if (col &gt; 0) {</span>
<span class="lineNum">    1066 </span>            :       match = false;
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :       for (int ic = 0; ic &lt; int(colTags.size()) ; ++ic)</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :         if (col == colTags[ic]) match = true;</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :       if (!match) colTags.push_back(col);</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :     } else if (acol &gt; 0) {</span>
<span class="lineNum">    1071 </span>            :       match = false;
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :       for (int ic = 0; ic &lt; int(colTags.size()) ; ++ic)</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         if (acol == colTags[ic]) match = true;</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :       if (!match) colTags.push_back(acol);</span>
<span class="lineNum">    1075 </span>            :     }
<span class="lineNum">    1076 </span>            :     // Colour sextets : map negative colour -&gt; anticolour and vice versa
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :     if (col &lt; 0) {</span>
<span class="lineNum">    1078 </span>            :       match = false;
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :       for (int ic = 0; ic &lt; int(colTags.size()) ; ++ic)</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :         if (-col == colTags[ic]) match = true;</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :       if (!match) colTags.push_back(-col);</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :     } else if (acol &lt; 0) {</span>
<span class="lineNum">    1083 </span>            :       match = false;
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :       for (int ic = 0; ic &lt; int(colTags.size()) ; ++ic)</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         if (-acol == colTags[ic]) match = true;</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :       if (!match) colTags.push_back(-acol);</span>
<span class="lineNum">    1087 </span>            :     }
<span class="lineNum">    1088 </span>            :   }
<span class="lineNum">    1089 </span>            : 
<span class="lineNum">    1090 </span>            :   // Warn and give up if particles did not have the expected colours.
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :   if (!physical) {</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::checkColours: &quot;</span>
<span class="lineNum">    1093 </span>            :       &quot;incorrect colour assignment&quot;);
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">    1095 </span>            :   }
<span class="lineNum">    1096 </span>            : 
<span class="lineNum">    1097 </span>            :   // Remove (anti)colours coming from an (anti)junction.
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :   for (int iJun = 0; iJun &lt; process.sizeJunction(); ++iJun) {</span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :     for (int j = 0; j &lt; 3; ++j) {</span>
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :       int colJun = process.colJunction(iJun, j);</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :       for (int ic = 0; ic &lt; int(colTags.size()) ; ++ic)</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :         if (colJun == colTags[ic]) {</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :           colTags[ic] = colTags[colTags.size() - 1];</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :           colTags.pop_back();</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1106 </span>            :         }
<span class="lineNum">    1107 </span>            :     }
<span class="lineNum">    1108 </span>            :   }
<span class="lineNum">    1109 </span>            : 
<span class="lineNum">    1110 </span>            :   // Loop through all colour tags and find their positions (by sign).
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :   for (int ic = 0; ic &lt; int(colTags.size()); ++ic) {</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :     col = colTags[ic];</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :     colPos.resize(0);</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :     acolPos.resize(0);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :     for (int i = 0; i &lt; process.size(); ++i) {</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :       if (process[i].col() == col || process[i].acol() == -col)</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :         colPos.push_back(i);</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :       if (process[i].acol() == col || process[i].col() == -col)</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :         acolPos.push_back(i);</span>
<span class="lineNum">    1120 </span>            :     }
<span class="lineNum">    1121 </span>            : 
<span class="lineNum">    1122 </span>            :     // Trace colours back through decays; remove daughters.
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :     while (colPos.size() &gt; 1) {</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :       iPos = colPos.size() - 1;</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :       iNow = colPos[iPos];</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :       if ( process[iNow].mother1() == colPos[iPos - 1]</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :         &amp;&amp; process[iNow].mother2() == 0) colPos.pop_back();</span>
<span class="lineNum">    1128 </span>            :       else break;
<span class="lineNum">    1129 </span>            :     }
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :     while (acolPos.size() &gt; 1) {</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :       iPos = acolPos.size() - 1;</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :       iNow = acolPos[iPos];</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :       if ( process[iNow].mother1() == acolPos[iPos - 1]</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :         &amp;&amp; process[iNow].mother2() == 0) acolPos.pop_back();</span>
<span class="lineNum">    1135 </span>            :       else break;
<span class="lineNum">    1136 </span>            :     }
<span class="lineNum">    1137 </span>            : 
<span class="lineNum">    1138 </span>            :     // Now colour should exist in only 2 copies.
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :     if (colPos.size() + acolPos.size() != 2) physical = false;</span>
<span class="lineNum">    1140 </span>            : 
<span class="lineNum">    1141 </span>            :     // If both colours or both anticolours then one mother of the other.
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :     else if (colPos.size() == 2) {</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :       iNow = colPos[1];</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :       if ( process[iNow].mother1() != colPos[0]</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :         &amp;&amp; process[iNow].mother2() != colPos[0] ) physical = false;</span>
<span class="lineNum">    1146 </span>            :     }
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :     else if (acolPos.size() == 2) {</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :       iNowA = acolPos[1];</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :       if ( process[iNowA].mother1() != acolPos[0]</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :         &amp;&amp; process[iNowA].mother2() != acolPos[0] ) physical = false;</span>
<span class="lineNum">    1151 </span>            :     }
<span class="lineNum">    1152 </span>            : 
<span class="lineNum">    1153 </span>            :     // If one of each then should have same mother(s), or point to beams.
<span class="lineNum">    1154 </span>            :     else {
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :       iNow  = colPos[0];</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :       iNowA = acolPos[0];</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :       if ( process[iNow].status() == -21 &amp;&amp;  process[iNowA].status() == -21 );</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :       else if ( (process[iNow].mother1() != process[iNowA].mother1())</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :              || (process[iNow].mother2() != process[iNowA].mother2()) )</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :         physical = false;</span>
<span class="lineNum">    1161 </span>            :     }
<span class="lineNum">    1162 </span>            : 
<span class="lineNum">    1163 </span>            :   }
<span class="lineNum">    1164 </span>            : 
<span class="lineNum">    1165 </span>            :   // Error message if problem found. Done.
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :   if (!physical) infoPtr-&gt;errorMsg(&quot;Error in ProcessLevel::checkColours: &quot;</span>
<span class="lineNum">    1167 </span>            :                    &quot;unphysical colour flow&quot;);
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :   return physical;</span>
<span class="lineNum">    1169 </span>            : 
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1171 </span>            : 
<span class="lineNum">    1172 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">    1173 </span>            : 
<a name="1174"><span class="lineNum">    1174 </span>            : // Print statistics when two hard processes allowed.</a>
<span class="lineNum">    1175 </span>            : 
<span class="lineNum">    1176 </span>            : void ProcessLevel::statistics2(bool reset, ostream&amp; os) {
<span class="lineNum">    1177 </span>            : 
<span class="lineNum">    1178 </span>            :   // Average impact-parameter factor and error.
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :   double invN          = 1. / max(1, nImpact);</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :   double impactFac     = max( 1., sumImpactFac * invN);</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :   double impactErr2    = ( sum2ImpactFac * invN / pow2(impactFac) - 1.) * invN;</span>
<span class="lineNum">    1182 </span>            : 
<span class="lineNum">    1183 </span>            :   // Derive scaling factor to be applied to first set of processes.
<span class="lineNum">    1184 </span>            :   double sigma2SelSum  = 0.;
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :   int    n2SelSum      = 0;</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :   for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2) {</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :     sigma2SelSum      += container2Ptrs[i2]-&gt;sigmaSelMC();</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :     n2SelSum          += container2Ptrs[i2]-&gt;nSelected();</span>
<span class="lineNum">    1189 </span>            :   }
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :   double factor1       = impactFac * sigma2SelSum / sigmaND;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :   double rel1Err       = sqrt(1. / max(1, n2SelSum) + impactErr2);</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :   if (allHardSame) factor1 *= 0.5;</span>
<span class="lineNum">    1193 </span>            : 
<span class="lineNum">    1194 </span>            :   // Derive scaling factor to be applied to second set of processes.
<span class="lineNum">    1195 </span>            :   double sigma1SelSum  = 0.;
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :   int    n1SelSum      = 0;</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i) {</span>
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :     sigma1SelSum      += containerPtrs[i]-&gt;sigmaSelMC();</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     n1SelSum          += containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">    1200 </span>            :   }
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :   double factor2       = impactFac * sigma1SelSum / sigmaND;</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :   if (allHardSame) factor2 *= 0.5;</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :   double rel2Err       = sqrt(1. / max(1, n1SelSum) + impactErr2);</span>
<span class="lineNum">    1204 </span>            : 
<span class="lineNum">    1205 </span>            :   // Header.
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot;\n *-------  PYTHIA Event and Cross Section Statistics  ------&quot;</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;--------------------------------------------------*\n&quot;</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                            &quot;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                                                |\n&quot;</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | Subprocess                               Code |            &quot;</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;Number of events       |      sigma +- delta    |\n&quot;</span>
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |       Tried&quot;</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;   Selected   Accepted |     (estimated) (mb)   |\n&quot;</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |------------------------------------------------------------&quot;</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;------------------------------------------------|\n&quot;</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | First hard process:                           |            &quot;</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;;</span>
<span class="lineNum">    1224 </span>            : 
<span class="lineNum">    1225 </span>            :   // Reset sum counters.
<span class="lineNum">    1226 </span>            :   long   nTrySum   = 0;
<span class="lineNum">    1227 </span>            :   long   nSelSum   = 0;
<span class="lineNum">    1228 </span>            :   long   nAccSum   = 0;
<span class="lineNum">    1229 </span>            :   double sigmaSum  = 0.;
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :   double delta2Sum = 0.;</span>
<span class="lineNum">    1231 </span>            : 
<span class="lineNum">    1232 </span>            :   // Reset process maps.
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :   map&lt;int, string&gt; nameM;</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :   map&lt;int, long&gt; nTryM, nSelM, nAccM;</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :   map&lt;int, double&gt; sigmaM, delta2M;</span>
<span class="lineNum">    1236 </span>            : 
<span class="lineNum">    1237 </span>            :   // Loop over existing first processes.
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(containerPtrs.size()); ++i)</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :   if (containerPtrs[i]-&gt;sigmaMax() != 0.) {</span>
<span class="lineNum">    1240 </span>            : 
<span class="lineNum">    1241 </span>            :     // Read info for process. Sum counters.
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :     int code = containerPtrs[i]-&gt;code();</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :     nTrySum       += containerPtrs[i]-&gt;nTried();</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :     nSelSum       += containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :     nAccSum       += containerPtrs[i]-&gt;nAccepted();</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :     sigmaSum      += containerPtrs[i]-&gt;sigmaMC() * factor1;</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :     delta2Sum     += pow2(containerPtrs[i]-&gt;deltaMC() * factor1);</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :     nameM[code]    = containerPtrs[i]-&gt;name();</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :     nTryM[code]   += containerPtrs[i]-&gt;nTried();</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :     nSelM[code]   += containerPtrs[i]-&gt;nSelected();</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :     nAccM[code]   += containerPtrs[i]-&gt;nAccepted();</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :     sigmaM[code]  += containerPtrs[i]-&gt;sigmaMC() * factor1;</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :     delta2M[code] += pow2(containerPtrs[i]-&gt;deltaMC() * factor1);</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :     delta2M[code] += pow2(containerPtrs[i]-&gt;sigmaMC() * factor1 * rel1Err);</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1256 </span>            : 
<span class="lineNum">    1257 </span>            :   // Print first process info.
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :   for (map&lt;int, string&gt;::iterator i = nameM.begin(); i != nameM.end(); ++i) {</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :     int code = i-&gt;first;</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(40) &lt;&lt; i-&gt;second</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :        &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; code &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; nTryM[code] &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelM[code] &lt;&lt; &quot; &quot;</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(10) &lt;&lt; nAccM[code] &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3)</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sigmaM[code]</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2M[code]) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1267 </span>            : 
<span class="lineNum">    1268 </span>            :   // Print summed info for first processes.
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :   delta2Sum       += pow2( sigmaSum * rel1Err );</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; &quot;sum&quot; &lt;&lt; right &lt;&lt; &quot; | &quot; &lt;&lt; setw(11)</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :      &lt;&lt; nTrySum &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelSum &lt;&lt; &quot; &quot; &lt;&lt; setw(10)</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :      &lt;&lt; nAccSum &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3) &lt;&lt; setw(11)</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :      &lt;&lt; sigmaSum &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2Sum) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">    1276 </span>            : 
<span class="lineNum">    1277 </span>            :   // Separation lines to second hard processes.
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |------------------------------------------------------------&quot;</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;------------------------------------------------|\n&quot;</span>
<span class="lineNum">    1282 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | Second hard process:                          |            &quot;</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;;</span>
<span class="lineNum">    1288 </span>            : 
<span class="lineNum">    1289 </span>            :   // Reset sum counters.
<span class="lineNum">    1290 </span>            :   nTrySum   = 0;
<span class="lineNum">    1291 </span>            :   nSelSum   = 0;
<span class="lineNum">    1292 </span>            :   nAccSum   = 0;
<span class="lineNum">    1293 </span>            :   sigmaSum  = 0.;
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :   delta2Sum = 0.;</span>
<span class="lineNum">    1295 </span>            : 
<span class="lineNum">    1296 </span>            :   // Reset process maps.
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :   nameM.clear();</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 :   nTryM.clear();</span>
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :   nSelM.clear();</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :   nAccM.clear();</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :   sigmaM.clear();</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :   delta2M.clear();</span>
<span class="lineNum">    1303 </span>            : 
<span class="lineNum">    1304 </span>            :   // Loop over existing second processes.
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :   for (int i2 = 0; i2 &lt; int(container2Ptrs.size()); ++i2)</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :   if (container2Ptrs[i2]-&gt;sigmaMax() != 0.) {</span>
<span class="lineNum">    1307 </span>            : 
<span class="lineNum">    1308 </span>            :     // Read info for process. Sum counters.
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :     int code = container2Ptrs[i2]-&gt;code();</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :     nTrySum       += container2Ptrs[i2]-&gt;nTried();</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :     nSelSum       += container2Ptrs[i2]-&gt;nSelected();</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">          0 :     nAccSum       += container2Ptrs[i2]-&gt;nAccepted();</span>
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :     sigmaSum      += container2Ptrs[i2]-&gt;sigmaMC() * factor2;</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :     delta2Sum     += pow2(container2Ptrs[i2]-&gt;deltaMC() * factor2);</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :     nameM[code]    = container2Ptrs[i2]-&gt;name();</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :     nTryM[code]   += container2Ptrs[i2]-&gt;nTried();</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :     nSelM[code]   += container2Ptrs[i2]-&gt;nSelected();</span>
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :     nAccM[code]   += container2Ptrs[i2]-&gt;nAccepted();</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :     sigmaM[code]  += container2Ptrs[i2]-&gt;sigmaMC() * factor2;</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :     delta2M[code] += pow2(container2Ptrs[i2]-&gt;deltaMC() * factor2);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :     delta2M[code] += pow2(container2Ptrs[i2]-&gt;sigmaMC() * factor2 * rel2Err);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1323 </span>            : 
<span class="lineNum">    1324 </span>            :   // Print second process info.
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :   for (map&lt;int, string&gt;::iterator i2 = nameM.begin(); i2 != nameM.end();</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :     ++i2) {</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :     int code = i2-&gt;first;</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :     os &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(40) &lt;&lt; i2-&gt;second</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :        &lt;&lt; right &lt;&lt; setw(5) &lt;&lt; code &lt;&lt; &quot; | &quot;</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; nTryM[code] &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelM[code] &lt;&lt; &quot; &quot;</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(10) &lt;&lt; nAccM[code] &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3)</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sigmaM[code]</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :        &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2M[code]) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1335 </span>            : 
<span class="lineNum">    1336 </span>            :   // Print summed info for second processes.
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :   delta2Sum       += pow2( sigmaSum * rel2Err );</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | &quot; &lt;&lt; left &lt;&lt; setw(45) &lt;&lt; &quot;sum&quot; &lt;&lt; right &lt;&lt; &quot; | &quot; &lt;&lt; setw(11)</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :      &lt;&lt; nTrySum &lt;&lt; &quot; &quot; &lt;&lt; setw(10) &lt;&lt; nSelSum &lt;&lt; &quot; &quot; &lt;&lt; setw(10)</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :      &lt;&lt; nAccSum &lt;&lt; &quot; | &quot; &lt;&lt; scientific &lt;&lt; setprecision(3) &lt;&lt; setw(11)</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :      &lt;&lt; sigmaSum &lt;&lt; setw(11) &lt;&lt; sqrtpos(delta2Sum) &lt;&lt; &quot; |\n&quot;;</span>
<span class="lineNum">    1344 </span>            : 
<span class="lineNum">    1345 </span>            :   // Print information on how the two processes were combined.
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                               |            &quot;</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                       |                        |\n&quot;</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |------------------------------------------------------------&quot;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;------------------------------------------------|\n&quot;</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; |                                                            &quot;</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                                                |\n&quot;</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | Uncombined cross sections for the two event sets were &quot;</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :      &lt;&lt; setw(10) &lt;&lt; sigma1SelSum &lt;&lt; &quot; and &quot; &lt;&lt; sigma2SelSum &lt;&lt; &quot; mb, &quot;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;respectively, combined  |\n&quot;</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; | using a sigma(nonDiffractive) of &quot; &lt;&lt; setw(10) &lt;&lt; sigmaND</span>
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; mb and an impact-parameter enhancement factor of &quot;</span>
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :      &lt;&lt; setw(10) &lt;&lt; impactFac &lt;&lt; &quot;.   |\n&quot;;</span>
<span class="lineNum">    1358 </span>            : 
<span class="lineNum">    1359 </span>            :   // Listing finished.
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 :   os &lt;&lt; &quot; |                                                            &quot;</span>
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;                                                |\n&quot;</span>
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot; *-------  End PYTHIA Event and Cross Section Statistics -----&quot;</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :      &lt;&lt; &quot;------------------------------------------------*&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span>            :   // Optionally reset statistics contants.
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :   if (reset) resetStatistics();</span>
<span class="lineNum">    1367 </span>            : 
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1369 </span>            : 
<span class="lineNum">    1370 </span>            : //==========================================================================
<span class="lineNum">    1371 </span>            : 
<span class="lineNum">    1372 </span>            : } // end namespace Pythia8
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
