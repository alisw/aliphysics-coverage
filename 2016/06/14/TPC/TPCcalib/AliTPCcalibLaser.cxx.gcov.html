<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TPC/TPCcalib/AliTPCcalibLaser.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">TPC/TPCcalib</a> - AliTPCcalibLaser.cxx<span style="font-size: 80%;"> (source / <a href="AliTPCcalibLaser.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">3088</td>
            <td class="headerCovTableEntryLo">0.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">31</td>
            <td class="headerCovTableEntryLo">3.2 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /*
<span class="lineNum">      17 </span>            :   //
<span class="lineNum">      18 </span>            :   // FUNCTIONALITY:
<span class="lineNum">      19 </span>            :   //
<span class="lineNum">      20 </span>            :   // 1. The laser track is associated with the mirror
<span class="lineNum">      21 </span>            :   //    see function FindMirror
<span class="lineNum">      22 </span>            :   //
<span class="lineNum">      23 </span>            :   // 2. The laser track is accepted for the analysis under certain condition
<span class="lineNum">      24 </span>            :   //    (see function Accpet laser)
<span class="lineNum">      25 </span>            :   //
<span class="lineNum">      26 </span>            :   // 3. The drift velocity and jitter is calculated event by event
<span class="lineNum">      27 </span>            :   //    (see function drift velocity)
<span class="lineNum">      28 </span>            :   //
<span class="lineNum">      29 </span>            :   // 4. The tracks are refitted at different sectors 
<span class="lineNum">      30 </span>            :   //    Fit model 
<span class="lineNum">      31 </span>            :   //      4.a) line
<span class="lineNum">      32 </span>            :   //      4.b) parabola
<span class="lineNum">      33 </span>            :   //      4.c) parabola with common P2 for inner and outer 
<span class="lineNum">      34 </span>            :   //
<span class="lineNum">      35 </span>            :   // To make laser scan the user interaction neccessary
<span class="lineNum">      36 </span>            :   //
<span class="lineNum">      37 </span>            :   .x ~/NimStyle.C
<span class="lineNum">      38 </span>            :   gSystem-&gt;Load(&quot;libANALYSIS&quot;);
<span class="lineNum">      39 </span>            :   gSystem-&gt;Load(&quot;libTPCcalib&quot;);
<span class="lineNum">      40 </span>            :   TFile fcalib(&quot;CalibObjectsTrain2.root&quot;);
<span class="lineNum">      41 </span>            :   AliTPCcalibLaser * laser = ( AliTPCcalibLaser *)fcalib-&gt;Get(&quot;laserTPC&quot;);
<span class="lineNum">      42 </span>            :   laser-&gt;DumpMeanInfo(run)
<span class="lineNum">      43 </span>            :   TFile fmean(&quot;laserMean.root&quot;)
<span class="lineNum">      44 </span>            :   //
<span class="lineNum">      45 </span>            :   //  laser track clasification;
<span class="lineNum">      46 </span>            :   //
<span class="lineNum">      47 </span>            :   TCut cutT(&quot;cutT&quot;,&quot;abs(Tr.fP[3])&lt;0.06&quot;);
<span class="lineNum">      48 </span>            :   TCut cutN(&quot;cutN&quot;,&quot;fTPCncls&gt;70&quot;);
<span class="lineNum">      49 </span>            :   TCut cutP(&quot;cutP&quot;,&quot;abs(atan2(x1,x0)-atan2(lx1,lx0))&lt;0.03&quot;)
<span class="lineNum">      50 </span>            :   TCut cutA = cutT+cutPt+cutP;
<span class="lineNum">      51 </span>            :   TChain * chainTrL = tool.MakeChain(&quot;laser.txt&quot;,&quot;Track&quot;,0,10200);
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span>            :   //
<span class="lineNum">      54 </span>            :   //
<span class="lineNum">      55 </span>            :   // Analyze  LASER scan 
<span class="lineNum">      56 </span>            :   //
<span class="lineNum">      57 </span>            :   
<span class="lineNum">      58 </span>            :   gSystem-&gt;AddIncludePath(&quot;-I$ALICE_ROOT/TPC/macros&quot;);
<span class="lineNum">      59 </span>            :   gROOT-&gt;LoadMacro(&quot;$ALICE_ROOT/TPC/macros/AliXRDPROOFtoolkit.cxx+&quot;)
<span class="lineNum">      60 </span>            :   AliXRDPROOFtoolkit tool;
<span class="lineNum">      61 </span>            :   TChain * chain = tool.MakeChain(&quot;laserScan.txt&quot;,&quot;Mean&quot;,0,10200);
<span class="lineNum">      62 </span>            :   chain-&gt;Lookup();
<span class="lineNum">      63 </span>            :   AliTPCcalibLaser::DumpScanInfo(chain)
<span class="lineNum">      64 </span>            :   TFile fscan(&quot;laserScan.root&quot;)
<span class="lineNum">      65 </span>            :   TTree * treeT = (TTree*)fscan.Get(&quot;Mean&quot;)
<span class="lineNum">      66 </span>            :   //
<span class="lineNum">      67 </span>            :   // Analyze laser 
<span class="lineNum">      68 </span>            :   //
<span class="lineNum">      69 </span>            :   gSystem-&gt;AddIncludePath(&quot;-I$ALICE_ROOT/TPC/macros&quot;);
<span class="lineNum">      70 </span>            :   gROOT-&gt;LoadMacro(&quot;$ALICE_ROOT/TPC/macros/AliXRDPROOFtoolkit.cxx+&quot;)
<span class="lineNum">      71 </span>            :   AliXRDPROOFtoolkit tool;
<span class="lineNum">      72 </span>            :   AliXRDPROOFtoolkit::FilterList(&quot;laserDebug.list&quot;,&quot;* driftvN&quot;,1) 
<span class="lineNum">      73 </span>            :   TChain * chainDrift = tool.MakeChainRandom(&quot;laser.txt.Good&quot;,&quot;driftv&quot;,0,50);
<span class="lineNum">      74 </span>            :   chainDrift-&gt;Lookup();
<span class="lineNum">      75 </span>            :   TChain * chainDriftN = tool.MakeChainRandom(&quot;laserDebug.list.Good&quot;,&quot;driftvN&quot;,0,300);
<span class="lineNum">      76 </span>            :   chainDriftN-&gt;Lookup();
<span class="lineNum">      77 </span>            : 
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            :   TChain * chain = tool.MakeChain(&quot;laser.txt&quot;,&quot;Residuals&quot;,0,10200);
<span class="lineNum">      80 </span>            :   chain-&gt;Lookup();
<span class="lineNum">      81 </span>            :   TChain * chainFit = tool.MakeChain(&quot;laser.txt&quot;,&quot;FitModels&quot;,0,10200);
<span class="lineNum">      82 </span>            :   chainFit-&gt;Lookup();
<span class="lineNum">      83 </span>            :   TChain * chainTrack = tool.MakeChainRandom(&quot;laser.txt&quot;,&quot;Track&quot;,0,30);
<span class="lineNum">      84 </span>            :   chainTrack-&gt;Lookup();
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span>            : */
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            : 
<span class="lineNum">      90 </span>            : #include &quot;TLinearFitter.h&quot;
<span class="lineNum">      91 </span>            : #include &quot;AliTPCcalibLaser.h&quot;
<span class="lineNum">      92 </span>            : #include &quot;AliExternalTrackParam.h&quot;
<span class="lineNum">      93 </span>            : #include &quot;AliESDEvent.h&quot;
<span class="lineNum">      94 </span>            : #include &quot;AliESDfriend.h&quot;
<span class="lineNum">      95 </span>            : #include &quot;AliESDtrack.h&quot;
<span class="lineNum">      96 </span>            : #include &quot;AliTPCTracklet.h&quot;
<span class="lineNum">      97 </span>            : #include &quot;TH1D.h&quot;
<span class="lineNum">      98 </span>            : #include &quot;TH1F.h&quot;
<span class="lineNum">      99 </span>            : #include &quot;TProfile.h&quot;
<span class="lineNum">     100 </span>            : #include &quot;TVectorD.h&quot;
<span class="lineNum">     101 </span>            : #include &quot;TTreeStream.h&quot;
<span class="lineNum">     102 </span>            : #include &quot;TFile.h&quot;
<span class="lineNum">     103 </span>            : #include &quot;TF1.h&quot;
<span class="lineNum">     104 </span>            : #include &quot;TGraphErrors.h&quot;
<span class="lineNum">     105 </span>            : #include &quot;AliTPCclusterMI.h&quot;
<span class="lineNum">     106 </span>            : #include &quot;AliTPCseed.h&quot;
<span class="lineNum">     107 </span>            : #include &quot;AliTracker.h&quot;
<span class="lineNum">     108 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">     109 </span>            : #include &quot;TClonesArray.h&quot;
<span class="lineNum">     110 </span>            : #include &quot;TPad.h&quot;
<span class="lineNum">     111 </span>            : #include &quot;TSystem.h&quot;
<span class="lineNum">     112 </span>            : #include &quot;TCut.h&quot;
<span class="lineNum">     113 </span>            : #include &quot;TChain.h&quot;
<span class="lineNum">     114 </span>            : #include &quot;TH2F.h&quot;
<span class="lineNum">     115 </span>            : #include &quot;TStatToolkit.h&quot;
<span class="lineNum">     116 </span>            : #include &quot;TROOT.h&quot;
<span class="lineNum">     117 </span>            : #include &quot;TDatabasePDG.h&quot;
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span>            : 
<span class="lineNum">     120 </span>            : #include &quot;TTreeStream.h&quot;
<span class="lineNum">     121 </span>            : #include &lt;iostream&gt;
<span class="lineNum">     122 </span>            : #include &lt;sstream&gt;
<span class="lineNum">     123 </span>            : #include &quot;AliTPCLaserTrack.h&quot;
<span class="lineNum">     124 </span>            : #include &quot;AliTPCcalibDB.h&quot;
<span class="lineNum">     125 </span>            : #include &quot;AliTPCParam.h&quot;
<span class="lineNum">     126 </span>            : #include &quot;AliTPCParamSR.h&quot;
<span class="lineNum">     127 </span>            : #include &quot;TTimeStamp.h&quot;
<span class="lineNum">     128 </span>            : #include &quot;AliDCSSensorArray.h&quot;
<span class="lineNum">     129 </span>            : #include &quot;AliDCSSensor.h&quot;
<span class="lineNum">     130 </span>            : #include &quot;AliGRPObject.h&quot;
<span class="lineNum">     131 </span>            : #include &quot;AliTPCROC.h&quot;
<span class="lineNum">     132 </span>            : #include &quot;AliTPCreco.h&quot;
<span class="lineNum">     133 </span>            : 
<a name="134"><span class="lineNum">     134 </span>            : using namespace std;</a>
<span class="lineNum">     135 </span>            : 
<a name="136"><span class="lineNum">     136 </span><span class="lineCov">          6 : ClassImp(AliTPCcalibLaser)</span></a>
<span class="lineNum">     137 </span>            : 
<span class="lineNum">     138 </span>            : AliTPCcalibLaser::AliTPCcalibLaser():
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :   AliTPCcalibBase(),</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :   fESD(0),</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :   fESDfriend(0),</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :   fNtracks(0),</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :   fTracksMirror(336),</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :   fTracksEsd(336),</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :   fTracksEsdParam(336),</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :   fTracksTPC(336),</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :   fFullCalib(kTRUE),</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :   fDeltaZ(336),</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   fDeltaP3(336),</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   fDeltaP4(336),</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   fDeltaPhi(336),</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   fDeltaPhiP(336),</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :   fSignals(336),</span>
<span class="lineNum">     154 </span>            :   //
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :   fHisLaser(0),      //  N dim histogram of laser</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   fHisLaserPad(0),      //  N dim histogram of laser</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   fHisLaserTime(0),      //  N dim histogram of laser</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   fHisNclIn(0),      //-&gt;Number of clusters inner</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :   fHisNclOut(0),     //-&gt;Number of clusters outer</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :   fHisNclIO(0),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :   fHisLclIn(0),      //-&gt;Level arm inner</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :   fHisLclOut(0),     //-&gt;Level arm outer</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :   fHisLclIO(0),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   fHisdEdx(0),     //-&gt;dEdx histo</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   fHisdZfit(0),     //-&gt;distance to the mirror after linear fit</span>
<span class="lineNum">     166 </span>            :   //
<span class="lineNum">     167 </span>            :   //
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   fHisChi2YIn1(0),      //-&gt;chi2 y inner - line</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   fHisChi2YOut1(0),     //-&gt;chi2 y inner - line</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :   fHisChi2YIn2(0),      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   fHisChi2YOut2(0),     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :   fHisChi2YIO1(0),      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1(0),      //-&gt;chi2 z inner - line</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1(0),     //-&gt;chi2 z inner - line</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2(0),      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2(0),     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1(0),      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">     178 </span>            :   //
<span class="lineNum">     179 </span>            :   //
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :   fHisPy1vP0(0),     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :   fHisPy2vP0(0),     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :   fHisPy3vP0(0),     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :   fHisPy1vP1(0),     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   fHisPy2vP1(0),     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :   fHisPy3vP1(0),     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :   fHisPy2vP2In(0),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out(0),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO(0),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     189 </span>            :   //
<span class="lineNum">     190 </span>            :   //
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   fHisPz1vP0(0),     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :   fHisPz2vP0(0),     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :   fHisPz3vP0(0),     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :   fHisPz1vP1(0),     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :   fHisPz2vP1(0),     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :   fHisPz3vP1(0),     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :   fHisPz2vP2In(0),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out(0),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO(0),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     200 </span>            :   //
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :   fDeltaYres(336),   //-&gt;2D histo of residuals</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :   fDeltaZres(336),   //-&gt;2D histo fo residuals</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   fDeltaYres2(336),   //-&gt;2D histo of residuals</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :   fDeltaZres2(336),   //-&gt;2D histo fo residuals</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   fDeltaYresAbs(336), //-&gt;2D histo of residuals</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :   fHisYAbsErrors(0),  //-&gt; total errors per beam in the abs res y analysis</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :   fDeltaZresAbs(336), //-&gt;2D histo of residuals</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :   fHisZAbsErrors(0),  //-&gt; total errors per beam in the abs res z analysis</span>
<span class="lineNum">     209 </span>            :   //fDeltaYres3(336),   //-&gt;2D histo of residuals
<span class="lineNum">     210 </span>            :   //fDeltaZres3(336),   //-&gt;2D histo fo residuals
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :   fFitAside(new TVectorD(5)),</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :   fFitCside(new TVectorD(5)),      </span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :   fFitACside(new TVectorD(6)),      </span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :   fEdgeXcuts(3),    </span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :   fEdgeYcuts(3),    </span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   fNClCuts(5),      </span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :   fNcuts(0),</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :   fBeamSectorOuter(336),</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :   fBeamSectorInner(336),</span>
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   fBeamOffsetYOuter(336),</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :   fBeamSlopeYOuter(336),</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :   fBeamOffsetYInner(336),</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :   fBeamSlopeYInner(336),</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :   fBeamOffsetZOuter(336),</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :   fBeamSlopeZOuter(336),</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :   fBeamOffsetZInner(336),</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :   fBeamSlopeZInner(336),</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :   fInverseSlopeZ(kTRUE),</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :   fUseFixedDriftV(0),</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :   fFixedFitAside0(0.0),</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   fFixedFitAside1(1.0),</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :   fFixedFitCside0(0.0),</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   fFixedFitCside1(1.0)</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     235 </span>            :   //
<span class="lineNum">     236 </span>            :   // Constructor
<span class="lineNum">     237 </span>            :   //
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :   fTracksEsdParam.SetOwner(kTRUE);</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;336; i++) {</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :     fFitZ[i]=0;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :     fCounter[i]=0;    //! counter of usage</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     fClusterCounter[i]=0; //!couter of clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     fClusterSatur[i]=0;   //!couter of saturated clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     244 </span>            :   }
<a name="245"><span class="lineNum">     245 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span>            : AliTPCcalibLaser::AliTPCcalibLaser(const Text_t *name, const Text_t *title, Bool_t full):
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :   AliTPCcalibBase(),</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :   fESD(0),</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :   fESDfriend(0),</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :   fNtracks(0),</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   fTracksMirror(336),</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :   fTracksEsd(336),</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :   fTracksEsdParam(336),</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :   fTracksTPC(336),</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :   fFullCalib(full),</span>
<span class="lineNum">     257 </span>            :   //
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :   fDeltaZ(336),          // array of histograms of delta z for each track</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :   fDeltaP3(336),          // array of histograms of delta z for each track</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :   fDeltaP4(336),          // array of histograms of P3 for each track</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :   fDeltaPhi(336),          // array of histograms of P4 for each track</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :   fDeltaPhiP(336),          // array of histograms of delta z for each track</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   fSignals(336),           // array of dedx signals</span>
<span class="lineNum">     264 </span>            :   //
<span class="lineNum">     265 </span>            :   //
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :   fHisLaser(0),      //  N dim histogram of laser</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :   fHisLaserPad(0),      //  N dim histogram of laser</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :   fHisLaserTime(0),      //  N dim histogram of laser</span>
<span class="lineNum">     269 </span>            : 
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   fHisNclIn(0),      //-&gt;Number of clusters inner</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   fHisNclOut(0),     //-&gt;Number of clusters outer</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   fHisNclIO(0),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   fHisLclIn(0),      //-&gt;Level arm inner</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :   fHisLclOut(0),     //-&gt;Level arm outer</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :   fHisLclIO(0),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   fHisdEdx(0), //-&gt;dEdx histo  </span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :   fHisdZfit(0),     //-&gt;distance to the mirror after linear fit</span>
<span class="lineNum">     278 </span>            :   //
<span class="lineNum">     279 </span>            :   //
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :   fHisChi2YIn1(0),      //-&gt;chi2 y inner - line</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :   fHisChi2YOut1(0),     //-&gt;chi2 y inner - line</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :   fHisChi2YIn2(0),      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   fHisChi2YOut2(0),     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   fHisChi2YIO1(0),      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1(0),      //-&gt;chi2 z inner - line</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1(0),     //-&gt;chi2 z inner - line</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2(0),      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2(0),     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1(0),      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">     290 </span>            :   //
<span class="lineNum">     291 </span>            :   //
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :   fHisPy1vP0(0),     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :   fHisPy2vP0(0),     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :   fHisPy3vP0(0),     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :   fHisPy1vP1(0),     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :   fHisPy2vP1(0),     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :   fHisPy3vP1(0),     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :   fHisPy2vP2In(0),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out(0),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO(0),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     301 </span>            :   //
<span class="lineNum">     302 </span>            :   //
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :   fHisPz1vP0(0),     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :   fHisPz2vP0(0),     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :   fHisPz3vP0(0),     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :   fHisPz1vP1(0),     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :   fHisPz2vP1(0),     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   fHisPz3vP1(0),     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   fHisPz2vP2In(0),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out(0),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO(0),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     312 </span>            :   //
<span class="lineNum">     313 </span>            :   //
<span class="lineNum">     314 </span>            :   //
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :   fDeltaYres(336),</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :   fDeltaZres(336),  </span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   fDeltaYres2(336),</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :   fDeltaZres2(336),  </span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :   fDeltaYresAbs(336),</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :   fHisYAbsErrors(0),</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :   fDeltaZresAbs(336),</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   fHisZAbsErrors(0),</span>
<span class="lineNum">     323 </span>            :   //  fDeltaYres3(336),
<span class="lineNum">     324 </span>            :   //fDeltaZres3(336),  
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :   fFitAside(new TVectorD(5)),        // drift fit - A side</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :   fFitCside(new TVectorD(5)),        // drift fit - C- side</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   fFitACside(new TVectorD(6)),        // drift fit - AC- side</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :   fEdgeXcuts(3),       // cuts in local x direction; used in the refit of the laser tracks</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :   fEdgeYcuts(3),       // cuts in local y direction; used in the refit of the laser tracks</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   fNClCuts(5),         // cuts on the number of clusters per tracklet; used in the refit of the laser tracks</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :   fNcuts(0),           // number of cuts</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   fBeamSectorOuter(336),</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   fBeamSectorInner(336),</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   fBeamOffsetYOuter(336),</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   fBeamSlopeYOuter(336),</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   fBeamOffsetYInner(336),</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :   fBeamSlopeYInner(336),</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :   fBeamOffsetZOuter(336),</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :   fBeamSlopeZOuter(336),</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :   fBeamOffsetZInner(336),</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :   fBeamSlopeZInner(336),</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :   fInverseSlopeZ(kTRUE),</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :   fUseFixedDriftV(0),</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :   fFixedFitAside0(0.0),</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :   fFixedFitAside1(1.0),</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :   fFixedFitCside0(0.0),</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   fFixedFitCside1(1.0)</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   SetName(name);</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :   SetTitle(title);</span>
<span class="lineNum">     351 </span>            :   //
<span class="lineNum">     352 </span>            :   // Constructor
<span class="lineNum">     353 </span>            :   //
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :   fTracksEsdParam.SetOwner(kTRUE);</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;336; i++) {</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     fFitZ[i]=0;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :     fCounter[i]=0;    //! counter of usage</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :     fClusterCounter[i]=0; //!couter of clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :     fClusterSatur[i]=0;   //!couter of saturated clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     360 </span>            :   }
<a name="361"><span class="lineNum">     361 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span>            : AliTPCcalibLaser::AliTPCcalibLaser(const AliTPCcalibLaser&amp; calibLaser):
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   AliTPCcalibBase(calibLaser), </span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   fESD(0),</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :   fESDfriend(0),</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   fNtracks(0),</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :   fTracksMirror(336),</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :   fTracksEsd(336),</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :   fTracksEsdParam(336),</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   fTracksTPC(336),</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :   fFullCalib(calibLaser.fFullCalib),</span>
<span class="lineNum">     373 </span>            :   //
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   fDeltaZ(calibLaser.fDeltaZ),          // array of histograms of delta z for each track</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   fDeltaP3(((calibLaser.fDeltaP3))),          // array of histograms of delta z for each track</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   fDeltaP4(((calibLaser.fDeltaP4))),          // array of histograms of P3 for each track</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :   fDeltaPhi(((calibLaser.fDeltaPhi))),          // array of histograms of P4 for each track</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   fDeltaPhiP(((calibLaser.fDeltaPhiP))),          // array of histograms of delta z for each track</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :   fSignals(((calibLaser.fSignals))),           // array of dedx signals</span>
<span class="lineNum">     380 </span>            :   //
<span class="lineNum">     381 </span>            :   //
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :   fHisLaser(0),      //  N dim histogram of laser</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   fHisLaserPad(0),      //  N dim histogram of laser</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :   fHisLaserTime(0),      //  N dim histogram of laser</span>
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :   fHisNclIn(new TH2F(*(calibLaser.fHisNclIn))),      //-&gt;Number of clusters inner</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :   fHisNclOut(new TH2F(*(calibLaser.fHisNclOut))),     //-&gt;Number of clusters outer</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :   fHisNclIO(new TH2F(*(calibLaser.fHisNclIO))),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   fHisLclIn(new TH2F(*(calibLaser.fHisLclIn))),      //-&gt;Level arm inner</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :   fHisLclOut(new TH2F(*(calibLaser.fHisLclOut))),     //-&gt;Level arm outer</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   fHisLclIO(new TH2F(*(calibLaser.fHisLclIO))),      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :   fHisdEdx(new TH2F(*(calibLaser.fHisdEdx))),      //</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   fHisdZfit(new TH2F(*(calibLaser.fHisdZfit))),     //-&gt;distance to the mirror after linear fit</span>
<span class="lineNum">     394 </span>            :   //
<span class="lineNum">     395 </span>            :   //
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :   fHisChi2YIn1(new TH2F(*(calibLaser.fHisChi2YIn1))),      //-&gt;chi2 y inner - line</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   fHisChi2YOut1(new TH2F(*(calibLaser.fHisChi2YOut1))),     //-&gt;chi2 y inner - line</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   fHisChi2YIn2(new TH2F(*(calibLaser.fHisChi2YIn2))),      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   fHisChi2YOut2(new TH2F(*(calibLaser.fHisChi2YOut2))),     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   fHisChi2YIO1(new TH2F(*(calibLaser.fHisChi2YIO1))),      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1(new TH2F(*(calibLaser.fHisChi2ZIn1))),      //-&gt;chi2 z inner - line</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1(new TH2F(*(calibLaser.fHisChi2ZOut1))),     //-&gt;chi2 z inner - line</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2(new TH2F(*(calibLaser.fHisChi2ZIn2))),      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2(new TH2F(*(calibLaser.fHisChi2ZOut2))),     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1(new TH2F(*(calibLaser.fHisChi2ZIO1))),      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">     406 </span>            :   //
<span class="lineNum">     407 </span>            :   //
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   fHisPy1vP0(new TH2F(*(calibLaser.fHisPy1vP0))),     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   fHisPy2vP0(new TH2F(*(calibLaser.fHisPy2vP0))),     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :   fHisPy3vP0(new TH2F(*(calibLaser.fHisPy3vP0))),     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :   fHisPy1vP1(new TH2F(*(calibLaser.fHisPy1vP1))),     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   fHisPy2vP1(new TH2F(*(calibLaser.fHisPy2vP1))),     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :   fHisPy3vP1(new TH2F(*(calibLaser.fHisPy3vP1))),     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :   fHisPy2vP2In(new TH2F(*(calibLaser.fHisPy2vP2In))),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out(new TH2F(*(calibLaser.fHisPy2vP2Out))),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO(new TH2F(*(calibLaser.fHisPy3vP2IO))),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     417 </span>            :   //
<span class="lineNum">     418 </span>            :   //
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :   fHisPz1vP0(new TH2F(*(calibLaser.fHisPz1vP0))),     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :   fHisPz2vP0(new TH2F(*(calibLaser.fHisPz2vP0))),     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :   fHisPz3vP0(new TH2F(*(calibLaser.fHisPz3vP0))),     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   fHisPz1vP1(new TH2F(*(calibLaser. fHisPz1vP1))),     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   fHisPz2vP1(new TH2F(*(calibLaser.fHisPz2vP1))),     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   fHisPz3vP1(new TH2F(*(calibLaser.fHisPz3vP1))),     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :   fHisPz2vP2In(new TH2F(*(calibLaser.fHisPz2vP2In))),   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out(new TH2F(*(calibLaser. fHisPz2vP2Out))),  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO(new TH2F(*(calibLaser.fHisPz3vP2IO))),   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     428 </span>            :   //
<span class="lineNum">     429 </span>            :   //
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   fDeltaYres(((calibLaser.fDeltaYres))),</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   fDeltaZres(((calibLaser.fDeltaZres))),  </span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :   fDeltaYres2(((calibLaser.fDeltaYres))),</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :   fDeltaZres2(((calibLaser.fDeltaZres))),  </span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :   fDeltaYresAbs(((calibLaser.fDeltaYresAbs))),</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   fHisYAbsErrors(new TH1F(*(calibLaser.fHisYAbsErrors))),</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :   fDeltaZresAbs(((calibLaser.fDeltaZresAbs))),</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   fHisZAbsErrors(new TH1F(*(calibLaser.fHisZAbsErrors))),</span>
<span class="lineNum">     438 </span>            :   //  fDeltaYres3(((calibLaser.fDeltaYres))),
<span class="lineNum">     439 </span>            :   //fDeltaZres3(((calibLaser.fDeltaZres))),  
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :   fFitAside(new TVectorD(5)),        // drift fit - A side</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   fFitCside(new TVectorD(5)),        // drift fit - C- side</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   fFitACside(new TVectorD(6)),        // drift fit - C- side</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :   fEdgeXcuts(3),       // cuts in local x direction; used in the refit of the laser tracks</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :   fEdgeYcuts(3),       // cuts in local y direction; used in the refit of the laser tracks</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   fNClCuts(5),         // cuts on the number of clusters per tracklet; used in the refit of the laser tracks</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :   fNcuts(0),           // number of cuts</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :   fBeamSectorOuter(336),</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :   fBeamSectorInner(336),</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :   fBeamOffsetYOuter(336),</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :   fBeamSlopeYOuter(336),</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :   fBeamOffsetYInner(336),</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :   fBeamSlopeYInner(336),</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :   fBeamOffsetZOuter(336),</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :   fBeamSlopeZOuter(336),</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :   fBeamOffsetZInner(336),</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :   fBeamSlopeZInner(336),</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :   fInverseSlopeZ(calibLaser.fInverseSlopeZ),</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :   fUseFixedDriftV(calibLaser.fUseFixedDriftV),</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   fFixedFitAside0(calibLaser.fFixedFitAside0),</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :   fFixedFitAside1(calibLaser.fFixedFitAside1),</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :   fFixedFitCside0(calibLaser.fFixedFitCside0),</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :   fFixedFitCside1(calibLaser.fFixedFitCside1)</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     464 </span>            :   //
<span class="lineNum">     465 </span>            :   // copy constructor
<span class="lineNum">     466 </span>            :   //
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;336; i++) {</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :     fFitZ[i]=0;</span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :     fCounter[i]=0;    //! counter of usage</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :     fClusterCounter[i]=0; //!couter of clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :     fClusterSatur[i]=0;   //!couter of saturated clusters in &quot;sensitive are&quot;</span>
<span class="lineNum">     472 </span>            :   }
<span class="lineNum">     473 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     474 </span>            : 
<a name="475"><span class="lineNum">     475 </span>            : </a>
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span>            : AliTPCcalibLaser &amp; AliTPCcalibLaser::operator=(const AliTPCcalibLaser&amp; calibLaser){
<span class="lineNum">     478 </span>            :   //
<span class="lineNum">     479 </span>            :   // assgnment operator
<span class="lineNum">     480 </span>            :   //
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :   if (this != &amp;calibLaser) {</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :     new (this) AliTPCcalibLaser(calibLaser);</span>
<span class="lineNum">     483 </span>            :   }
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :   return *this;</span>
<span class="lineNum">     485 </span>            : 
<span class="lineNum">     486 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     487 </span>            : 
<span class="lineNum">     488 </span>            : 
<a name="489"><span class="lineNum">     489 </span>            : </a>
<span class="lineNum">     490 </span>            : 
<span class="lineNum">     491 </span><span class="lineNoCov">          0 : AliTPCcalibLaser::~AliTPCcalibLaser() {</span>
<span class="lineNum">     492 </span>            :   //
<span class="lineNum">     493 </span>            :   // destructor
<span class="lineNum">     494 </span>            :   //
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :   if ( fHisNclIn){</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     delete fHisLaser;      //-&gt;</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :     delete fHisLaserPad;      //-&gt;</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :     delete fHisLaserTime;      //-&gt;</span>
<span class="lineNum">     499 </span>            : 
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :     delete fHisNclIn;      //-&gt;Number of clusters inner</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :     delete fHisNclOut;     //-&gt;Number of clusters outer</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :     delete fHisNclIO;      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :     delete fHisLclIn;      //-&gt;Level arm inner</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :     delete fHisLclOut;     //-&gt;Level arm outer</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :     delete fHisLclIO;      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :     delete fHisdEdx;</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :     delete fHisdZfit;     </span>
<span class="lineNum">     508 </span>            :     //
<span class="lineNum">     509 </span>            :     //
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :     delete fHisChi2YIn1;      //-&gt;chi2 y inner - line</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :     delete fHisChi2YOut1;     //-&gt;chi2 y inner - line</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :     delete fHisChi2YIn2;      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     delete fHisChi2YOut2;     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :     delete fHisChi2YIO1;      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :     delete fHisChi2ZIn1;      //-&gt;chi2 z inner - line</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     delete fHisChi2ZOut1;     //-&gt;chi2 z inner - line</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     delete fHisChi2ZIn2;      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :     delete fHisChi2ZOut2;     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     delete fHisChi2ZIO1;      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">     520 </span>            :     //
<span class="lineNum">     521 </span>            :     //
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :     delete fHisPy1vP0;     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :     delete fHisPy2vP0;     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     delete fHisPy3vP0;     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :     delete fHisPy1vP1;     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :     delete fHisPy2vP1;     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :     delete fHisPy3vP1;     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     delete fHisPy2vP2In;   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :     delete fHisPy2vP2Out;  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     delete fHisPy3vP2IO;   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     531 </span>            :     //
<span class="lineNum">     532 </span>            :     //
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     delete fHisPz1vP0;     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :     delete fHisPz2vP0;     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     delete fHisPz3vP0;     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :     delete fHisPz1vP1;     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :     delete fHisPz2vP1;     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :     delete fHisPz3vP1;     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :     delete fHisPz2vP2In;   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     delete fHisPz2vP2Out;  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     delete fHisPz3vP2IO;   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">     542 </span>            :   }
<span class="lineNum">     543 </span>            :   //
<span class="lineNum">     544 </span>            :   //
<span class="lineNum">     545 </span>            :   //
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :   fDeltaZ.SetOwner();          //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   fDeltaP3.SetOwner();         //-&gt; array of histograms of P3      for each track</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :   fDeltaP4.SetOwner();         //-&gt; array of histograms of P4      for each track</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :   fDeltaPhi.SetOwner();        //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :   fDeltaPhiP.SetOwner();       //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :   fSignals.SetOwner();         //-&gt;Array of dedx signals</span>
<span class="lineNum">     552 </span>            :   
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :   fDeltaZ.Delete();          //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :   fDeltaP3.Delete();         //-&gt; array of histograms of P3      for each track</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :   fDeltaP4.Delete();         //-&gt; array of histograms of P4      for each track</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :   fDeltaPhi.Delete();        //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :   fDeltaPhiP.Delete();       //-&gt; array of histograms of delta z for each track</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :   fSignals.Delete();         //-&gt;Array of dedx signals</span>
<span class="lineNum">     559 </span>            : 
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :   fDeltaYres.SetOwner();</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :   fDeltaYres.Delete();</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :   delete fHisYAbsErrors;</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :   fDeltaZres.SetOwner();</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :   fDeltaZres.Delete();</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :   delete fHisZAbsErrors;</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :   fDeltaYres2.SetOwner();</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :   fDeltaYres2.Delete();</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :   fDeltaZres2.SetOwner();</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :   fDeltaZres2.Delete();</span>
<span class="lineNum">     570 </span>            :   
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :   fDeltaYresAbs.SetOwner();</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :   fDeltaYresAbs.Delete();</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :   fDeltaZresAbs.SetOwner();</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :   fDeltaZresAbs.Delete();</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     576 </span>            : 
<a name="577"><span class="lineNum">     577 </span>            : </a>
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span>            : void AliTPCcalibLaser::Process(AliESDEvent * event) {
<span class="lineNum">     580 </span>            :   //
<span class="lineNum">     581 </span>            :   //
<span class="lineNum">     582 </span>            :   // Loop over tracks and call  Process function
<span class="lineNum">     583 </span>            :   //
<span class="lineNum">     584 </span>            :   const Int_t  kMinTracks=20;
<span class="lineNum">     585 </span>            :   const Int_t  kMinClusters=40;
<span class="lineNum">     586 </span>            : 
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :   fESD = event;</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :   if (!fESD) {</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     590 </span>            :   }
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :   fESDfriend=static_cast&lt;AliESDfriend*&gt;(fESD-&gt;FindListObject(&quot;AliESDfriend&quot;));</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :   if (!fESDfriend) {</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     594 </span>            :   }
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :   if (fESDfriend-&gt;TestSkipBit()) return;</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :   if (fESD-&gt;GetNumberOfTracks()&lt;kMinTracks) return; //not enough tracks</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :   AliDebug(4,Form(&quot;Event number in current file: %d&quot;,event-&gt;GetEventNumberInFile()));</span>
<span class="lineNum">     598 </span>            :   //
<span class="lineNum">     599 </span>            :   // find CE background if present
<span class="lineNum">     600 </span>            :   //
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :   if (AliTPCLaserTrack::GetTracks()==0) AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :   TH1D hisCE(&quot;hhisCE&quot;,&quot;hhisCE&quot;,100,-100,100);  </span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;fESD-&gt;GetNumberOfTracks();++i) {</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :     AliESDtrack *track=fESD-&gt;GetTrack(i);</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :     if (!track) continue;</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :     hisCE.Fill(track-&gt;GetZ());</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     hisCE.Fill(track-&gt;GetZ()+2);</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :     hisCE.Fill(track-&gt;GetZ()-2);</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     610 </span>            :   //
<span class="lineNum">     611 </span>            :   //
<span class="lineNum">     612 </span>            : 
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :   fTracksTPC.Clear();</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :   fTracksEsd.Clear();</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :   fTracksEsdParam.Delete();</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336;id++) {</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :     fCounter[id]=0;</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :     fClusterCounter[id]=0;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :     fClusterSatur[id]=0;</span>
<span class="lineNum">     621 </span>            :   }
<span class="lineNum">     622 </span>            :   //
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :   Int_t n=fESD-&gt;GetNumberOfTracks();</span>
<span class="lineNum">     624 </span>            :   Int_t counter=0;
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;n;++i) {</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :     AliESDtrack *track=fESD-&gt;GetTrack(i);</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     if (!track) continue;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :     AliESDfriendTrack *friendTrack=(AliESDfriendTrack*)track-&gt;GetFriendTrack();</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     if (!friendTrack) continue;</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :     Double_t binC = hisCE.GetBinContent(hisCE.FindBin(track-&gt;GetZ()));</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :     if (binC&gt;336) continue; //remove CE background</span>
<span class="lineNum">     632 </span>            :     TObject *calibObject=0;
<span class="lineNum">     633 </span>            :     AliTPCseed *seed=0;
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     for (Int_t j=0;(calibObject=friendTrack-&gt;GetCalibObject(j));++j)</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :       if ((seed=dynamic_cast&lt;AliTPCseed*&gt;(calibObject)))</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :     if (track&amp;&amp;seed&amp;&amp;track-&gt;GetTPCNcls()&gt;kMinClusters &amp;&amp; seed-&gt;GetNumberOfClusters() &gt;kMinClusters) {</span>
<span class="lineNum">     638 </span>            :       //filter CE tracks
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :       Int_t id = FindMirror(track,seed);</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :       if (id&gt;=0) counter++;</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     642 </span>            :     //
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :   } </span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :   fNtracks=counter;</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :   if (counter&lt;kMinTracks) return;</span>
<span class="lineNum">     646 </span>            : 
<span class="lineNum">     647 </span>            :   //FitDriftV();
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :   FitDriftV(0.2);</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :   if (!fFullCalib) return;</span>
<span class="lineNum">     650 </span>            :   static Bool_t init=kFALSE;
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :   if (!init){</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     init = kTRUE;  // way around for PROOF - to be investigated</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :     UpdateFitHistos();</span>
<span class="lineNum">     654 </span>            :   }
<span class="lineNum">     655 </span>            :   //
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){    </span>
<span class="lineNum">     657 </span>            :     //
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     if (!fTracksEsdParam.At(id)) continue;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :     if (fClusterSatur[id]&gt;0.3)   continue;  // tracks in saturation</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :     DumpLaser(id);</span>
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :     if ( AcceptLaser(id) &amp;&amp; fFitZ[id]&lt;0.5){</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :       RefitLaserJW(id);    </span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :       MakeDistHisto(id);</span>
<span class="lineNum">     664 </span>            :     }
<span class="lineNum">     665 </span>            :   }
<span class="lineNum">     666 </span>            : 
<a name="667"><span class="lineNum">     667 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     668 </span>            : 
<span class="lineNum">     669 </span>            : void AliTPCcalibLaser::MakeDistHisto(Int_t id){
<span class="lineNum">     670 </span>            :   //
<span class="lineNum">     671 </span>            :   //
<span class="lineNum">     672 </span>            :   //
<span class="lineNum">     673 </span>            :   //  for (Int_t id=0; id&lt;336; id++){
<span class="lineNum">     674 </span>            :     //
<span class="lineNum">     675 </span>            :     //
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :     if (!fTracksEsdParam.At(id)) return;</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     if (!AcceptLaser(id)) return;</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :     Double_t xhis[12]={0,0,0,0,0,0,0,0,0,0,0,0};</span>
<span class="lineNum">     679 </span>            :     //
<span class="lineNum">     680 </span>            :     //
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     TH1F * hisdz = (TH1F*)fDeltaZ.At(id);</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :     if (!hisdz) UpdateFitHistos();</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :     hisdz = (TH1F*)fDeltaZ.At(id);</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :     TH1F * hisP3 = (TH1F*)fDeltaP3.At(id);</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :     TH1F * hisP4 = (TH1F*)fDeltaP4.At(id);</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     TH1F * hisdphi = (TH1F*)fDeltaPhi.At(id);</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :     TH1F * hisdphiP = (TH1F*)fDeltaPhiP.At(id);</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :     TH1F * hisSignal = (TH1F*)fSignals.At(id);</span>
<span class="lineNum">     689 </span>            :     //
<span class="lineNum">     690 </span>            : 
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :     AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :     AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :     AliESDtrack   *track    = (AliESDtrack*)fTracksEsd.At(id);</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :     if (!param) return;</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     if (!ltrp) return;</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :     if (!track) return;</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :     Double_t xyz[3];</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :     Double_t pxyz[3];</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :     Double_t lxyz[3];</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :     Double_t lpxyz[3];</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :     param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :     param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">     705 </span>            :     //
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :     Float_t dz   = param-&gt;GetZ()-ltrp-&gt;GetZ();</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :     Float_t dphi = (TMath::ATan2(xyz[1],xyz[0])- TMath::ATan2(lxyz[1],lxyz[0]))*254.;</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :     Float_t dphiP = param-&gt;GetParameter()[2]-ltrp-&gt;GetParameter()[2];</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :     if (hisdz) hisdz-&gt;Fill(dz);</span>
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :     if (hisP3) hisP3-&gt;Fill(param-&gt;GetParameter()[3]);</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :     if (hisP4) hisP4-&gt;Fill(param-&gt;GetParameter()[4]);</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :     if (hisdphi) hisdphi-&gt;Fill(dphi);</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :     if (hisdphiP) hisdphiP-&gt;Fill(dphiP);</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :     if (hisSignal) hisSignal-&gt;Fill(TMath::Sqrt(TMath::Abs(track-&gt;GetTPCsignal())));</span>
<span class="lineNum">     715 </span>            :     // fill HisLaser
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :     xhis[0] = ltrp-&gt;GetId();</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     xhis[1] = ltrp-&gt;GetSide();</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     xhis[2] = ltrp-&gt;GetRod();</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :     xhis[3] = ltrp-&gt;GetBundle();</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :     xhis[4] = ltrp-&gt;GetBeam();</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :     xhis[5] = dphi;</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :     xhis[6] = fFitZ[id];</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :     xhis[7] = param-&gt;GetParameter()[2]-ltrp-&gt;GetParameter()[2]; //dp2</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :     xhis[8] = param-&gt;GetParameter()[3]-ltrp-&gt;GetParameter()[3]; //dp3</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :     xhis[9] = param-&gt;GetParameter()[4];</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     xhis[10]= track-&gt;GetTPCNcls();</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     xhis[11]= TMath::Sqrt(TMath::Abs(track-&gt;GetTPCsignal()));</span>
<span class="lineNum">     728 </span>            :     // }
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :     fHisLaser-&gt;Fill(xhis);</span>
<span class="lineNum">     730 </span>            :     //
<span class="lineNum">     731 </span>            :     
<a name="732"><span class="lineNum">     732 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     733 </span>            : 
<span class="lineNum">     734 </span>            : void AliTPCcalibLaser::FitDriftV(){
<span class="lineNum">     735 </span>            :   //
<span class="lineNum">     736 </span>            :   // Fit corrections to the drift velocity - linear approximation in the z and global y
<span class="lineNum">     737 </span>            :   //The transfromatiom from the drift time to the z position done in AliTPCTracnsform class
<span class="lineNum">     738 </span>            :   // 
<span class="lineNum">     739 </span>            :   /*
<span class="lineNum">     740 </span>            :     Formulas:
<span class="lineNum">     741 </span>            :     
<span class="lineNum">     742 </span>            :     z  = s* (z0 - vd*(t-t0))
<span class="lineNum">     743 </span>            :     
<span class="lineNum">     744 </span>            :     s  - side -1 and +1 
<span class="lineNum">     745 </span>            :     t0 - time 0
<span class="lineNum">     746 </span>            :     vd - nominal drift velocity
<span class="lineNum">     747 </span>            :     zs - miscalibrated position
<span class="lineNum">     748 </span>            :     
<span class="lineNum">     749 </span>            :     zs = s*(z0 - vd*(1+vr)*(t-(t0+dt))
<span class="lineNum">     750 </span>            :     vr  - relative change of the drift velocity
<span class="lineNum">     751 </span>            :     dzt - vd*dt
<span class="lineNum">     752 </span>            :     dr  = zz0-s*z
<span class="lineNum">     753 </span>            :     ..
<span class="lineNum">     754 </span>            :     ==&gt;
<span class="lineNum">     755 </span>            :     zs ~ z - s*vr*(z0-s*z)+s*dzt
<span class="lineNum">     756 </span>            :     --------------------------------
<span class="lineNum">     757 </span>            :     1. Correction function vr constant:
<span class="lineNum">     758 </span>            :     
<span class="lineNum">     759 </span>            :     
<span class="lineNum">     760 </span>            :     dz = zs-z = -s*vr *(z0-s*z)+s*dzt         
<span class="lineNum">     761 </span>            :     dzs/dl = dz/dl +s*s*vr*dz/dl 
<span class="lineNum">     762 </span>            :     d(dz/dl) = vr*dz/dl     
<span class="lineNum">     763 </span>            :   */
<span class="lineNum">     764 </span>            : 
<span class="lineNum">     765 </span>            :   const Float_t kZCut        = 240;    // remove the closest laser beam
<span class="lineNum">     766 </span>            :   const Float_t kSaturCut    = 0.05;   // remove saturated lasers - cut on fraction of saturated 
<span class="lineNum">     767 </span>            :   const Float_t kDistCut     = 3;    // distance sigma cut
<span class="lineNum">     768 </span>            :   const Float_t kDistCutAbs  = 0.25;  
<span class="lineNum">     769 </span>            :   const Float_t kMinClusters = 60;  // minimal amount of the clusters
<span class="lineNum">     770 </span>            :   const Float_t kMinSignal   = 16;  // minimal mean height of the signal
<span class="lineNum">     771 </span>            :   const Float_t kChi2Cut     = 0.1; // chi2 cut to accept drift fit
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftA(3,&quot;hyp2&quot;);</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftC(3,&quot;hyp2&quot;);</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftAC(4,&quot;hyp3&quot;);</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   TVectorD fitA(3),fitC(3),fitAC(4);</span>
<span class="lineNum">     776 </span>            :   
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :   AliTPCcalibDB*  calib=AliTPCcalibDB::Instance();</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :   AliTPCParam  * tpcparam    = calib-&gt;GetParameters();    </span>
<span class="lineNum">     779 </span>            :   //
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++) fFitZ[id]=0;</span>
<span class="lineNum">     781 </span>            : 
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :   Float_t chi2A = 10;</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :   Float_t chi2C = 10;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :   Float_t chi2AC = 10;</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :   Int_t npointsA=0;</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :   Int_t npointsC=0;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :   Int_t npointsAC=0;</span>
<span class="lineNum">     788 </span>            : 
<span class="lineNum">     789 </span>            : 
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :   for (Int_t iter=0; iter&lt;3; iter++){</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :     fdriftA.ClearPoints();</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :     fdriftC.ClearPoints();</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :     fdriftAC.ClearPoints();</span>
<span class="lineNum">     794 </span>            :     //
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :     for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :       if (!fTracksEsdParam.At(id)) continue;</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :       if (!AcceptLaser(id)) continue;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :       if ( fClusterSatur[id]&gt;kSaturCut)  continue;</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :       if ( fClusterCounter[id]&lt;kMinClusters)  continue;</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :       AliESDtrack   *track    = (AliESDtrack*)fTracksEsd.At(id);</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :       if (track-&gt;GetTPCsignal()&lt;kMinSignal) continue;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :       AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">     804 </span>            : 
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :       Double_t xyz[3];</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :       Double_t pxyz[3];</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :       Double_t lxyz[3];</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :       Double_t lpxyz[3];</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :       param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :       param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :       if (TMath::Abs(lxyz[2])&gt;kZCut) continue;</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :       Float_t sz = (ltrp-&gt;GetSide()==0) ? TMath::Sqrt(chi2A): TMath::Sqrt(chi2C);</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :       if (npointsAC&gt;0) sz =TMath::Sqrt(chi2AC); </span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :       if (TMath::Abs(fFitZ[id])&gt;sz*kDistCut) continue;</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :       if (iter&gt;0 &amp;&amp; TMath::Abs(fFitZ[id])&gt;kDistCutAbs) continue;</span>
<span class="lineNum">     818 </span>            : 
<span class="lineNum">     819 </span>            :       // drift distance
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :       Double_t zlength =  tpcparam-&gt;GetZLength(0);</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :       Double_t ldrift = zlength-TMath::Abs(lxyz[2]);</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :       Double_t mdrift = zlength-TMath::Abs(xyz[2]);</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :       Double_t xxx[2] = {ldrift,lxyz[1]*ldrift/(zlength*250.)};</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :       if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :         fdriftA.AddPoint(xxx,mdrift,1);</span>
<span class="lineNum">     826 </span>            :       }else{
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :         fdriftC.AddPoint(xxx,mdrift,1);</span>
<span class="lineNum">     828 </span>            :       }
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :       Double_t xxx2[3] = { static_cast&lt;Double_t&gt;(ltrp-&gt;GetSide()), ldrift,lxyz[1]*ldrift/(zlength*250.)};</span>
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :       fdriftAC.AddPoint(xxx2,mdrift,1);</span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     832 </span>            :     //
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :     if (fdriftA.GetNpoints()&gt;10){</span>
<span class="lineNum">     834 </span>            :       //
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :       fdriftA.Eval();</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :       if (iter==0) fdriftA.EvalRobust(0.7);</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :       else fdriftA.EvalRobust(0.8);</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :       fdriftA.GetParameters(fitA);</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :       npointsA= fdriftA.GetNpoints();</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :       chi2A = fdriftA.GetChisquare()/fdriftA.GetNpoints();</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :       if (chi2A&lt;kChi2Cut ||(*fFitAside)[0]==0 ) {</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :         if (fFitAside-&gt;GetNoElements()&lt;5) fFitAside-&gt;ResizeTo(5);</span>
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :         (*fFitAside)[0] = fitA[0];</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :         (*fFitAside)[1] = fitA[1];</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :         (*fFitAside)[2] = fitA[2];</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :         (*fFitAside)[3] = fdriftA.GetNpoints();</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :         (*fFitAside)[4] = chi2A;        </span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     849 </span>            :     }
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :     if (fdriftC.GetNpoints()&gt;10){</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :       fdriftC.Eval();</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :       if (iter==0) fdriftC.EvalRobust(0.7);</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :       else fdriftC.EvalRobust(0.8);</span>
<span class="lineNum">     854 </span>            :       //
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :       fdriftC.GetParameters(fitC);</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :       npointsC= fdriftC.GetNpoints();</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :       chi2C = fdriftC.GetChisquare()/fdriftC.GetNpoints();</span>
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :       if (chi2C&lt;kChi2Cut||(*fFitCside)[0]==0) {      </span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :         if (fFitCside-&gt;GetNoElements()&lt;5) fFitCside-&gt;ResizeTo(5);</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :         (*fFitCside)[0] = fitC[0];</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :         (*fFitCside)[1] = fitC[1];</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :         (*fFitCside)[2] = fitC[2];</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :         (*fFitCside)[3] = fdriftC.GetNpoints();</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :         (*fFitCside)[4] = chi2C;        </span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     866 </span>            :     }
<span class="lineNum">     867 </span>            : 
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     if (fdriftAC.GetNpoints()&gt;10&amp;&amp;fdriftC.GetNpoints()&gt;10&amp;&amp;fdriftA.GetNpoints()&gt;10){</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :       fdriftAC.Eval();</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :       if (iter==0) fdriftAC.EvalRobust(0.7);</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :       else fdriftAC.EvalRobust(0.8);</span>
<span class="lineNum">     872 </span>            :       //
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :       fdriftAC.GetParameters(fitAC);</span>
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :       npointsAC= fdriftAC.GetNpoints();</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :       chi2AC = fdriftAC.GetChisquare()/fdriftAC.GetNpoints();</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :       if (chi2AC&lt;kChi2Cut||(*fFitACside)[0]==0) (*fFitACside) = fitAC;</span>
<span class="lineNum">     877 </span>            :     }
<span class="lineNum">     878 </span>            :     
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :     for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :       if (!fTracksEsdParam.At(id)) continue;</span>
<span class="lineNum">     881 </span>            :       //
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :       AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :       Double_t xyz[3];</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :       Double_t pxyz[3];</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :       Double_t lxyz[3];</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :       Double_t lpxyz[3];</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :       param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :       param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetPxPyPz(lpxyz); </span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :       Double_t zlength =  tpcparam-&gt;GetZLength(0);</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :       Double_t ldrift = zlength-TMath::Abs(lxyz[2]);</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :       Double_t mdrift = zlength-TMath::Abs(xyz[2]);</span>
<span class="lineNum">     895 </span>            : 
<span class="lineNum">     896 </span>            :       Float_t fz =0;
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :       if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :         fz = (fitA)[0]+(fitA)[1]*ldrift+(fitA)[2]*lxyz[1]*ldrift/(zlength*250.);</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :       }else{</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :         fz = (fitC)[0]+(fitC)[1]*ldrift+(fitC)[2]*lxyz[1]*ldrift/(zlength*250.);        </span>
<span class="lineNum">     901 </span>            :       }
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :       if (npointsAC&gt;10){</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :         fz = (fitAC)[0]+(fitAC)[1]*ltrp-&gt;GetSide()+(fitAC)[2]*ldrift+(fitAC)[3]*lxyz[1]*ldrift/(zlength*250.);</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :       fFitZ[id]=mdrift-fz;</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :     if (fStreamLevel&gt;0){</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :       TTreeSRedirector *cstream = GetDebugStreamer();</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :       TTimeStamp tstamp(fTime);</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :       Float_t valuePressure0  = AliTPCcalibDB::GetPressure(tstamp,fRun,0);</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :       Float_t valuePressure1 = AliTPCcalibDB::GetPressure(tstamp,fRun,1);</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :       Double_t ptrelative0   = AliTPCcalibDB::GetPTRelative(tstamp,fRun,0);</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :       Double_t ptrelative1   = AliTPCcalibDB::GetPTRelative(tstamp,fRun,1);</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :       Double_t temp0         = AliTPCcalibDB::GetTemperature(tstamp,fRun,0);</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :       Double_t temp1         = AliTPCcalibDB::GetTemperature(tstamp,fRun,1);</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :       TVectorD vecGoofie(20);</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :       AliDCSSensorArray* goofieArray = AliTPCcalibDB::Instance()-&gt;GetGoofieSensors(fRun);</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :       if (goofieArray) </span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :         for (Int_t isensor=0; isensor&lt;goofieArray-&gt;NumSensors();isensor++){</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :           AliDCSSensor *gsensor = goofieArray-&gt;GetSensor(isensor);</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :           if (gsensor) vecGoofie[isensor]=gsensor-&gt;GetValue(tstamp);</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     923 </span>            : 
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :       if (cstream){</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :         (*cstream)&lt;&lt;&quot;driftv&quot;&lt;&lt;</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :           &quot;run=&quot;&lt;&lt;fRun&lt;&lt;              //  run number</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :           &quot;event=&quot;&lt;&lt;fEvent&lt;&lt;          //  event number</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :           &quot;time=&quot;&lt;&lt;fTime&lt;&lt;            //  time stamp of event</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :           &quot;trigger=&quot;&lt;&lt;fTrigger&lt;&lt;      //  trigger</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :           &quot;mag=&quot;&lt;&lt;fMagF&lt;&lt;             //  magnetic field</span>
<span class="lineNum">     931 </span>            :           // Environment values
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :           &quot;press0=&quot;&lt;&lt;valuePressure0&lt;&lt;</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :           &quot;press1=&quot;&lt;&lt;valuePressure1&lt;&lt;</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :           &quot;pt0=&quot;&lt;&lt;ptrelative0&lt;&lt;</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :           &quot;pt1=&quot;&lt;&lt;ptrelative1&lt;&lt;</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :           &quot;temp0=&quot;&lt;&lt;temp0&lt;&lt;</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :           &quot;temp1=&quot;&lt;&lt;temp1&lt;&lt;</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :           &quot;vecGoofie.=&quot;&lt;&lt;&amp;vecGoofie&lt;&lt;</span>
<span class="lineNum">     939 </span>            :           //
<span class="lineNum">     940 </span>            :           //
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :           &quot;iter=&quot;&lt;&lt;iter&lt;&lt;</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :           &quot;driftA.=&quot;&lt;&lt;fFitAside&lt;&lt;</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :           &quot;driftC.=&quot;&lt;&lt;fFitCside&lt;&lt;</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :           &quot;driftAC.=&quot;&lt;&lt;fFitACside&lt;&lt;</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :           &quot;chi2A=&quot;&lt;&lt;chi2A&lt;&lt;</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :           &quot;chi2C=&quot;&lt;&lt;chi2C&lt;&lt;</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :           &quot;chi2AC=&quot;&lt;&lt;chi2AC&lt;&lt;</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :           &quot;nA=&quot;&lt;&lt;npointsA&lt;&lt;</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :           &quot;nC=&quot;&lt;&lt;npointsC&lt;&lt;</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :           &quot;nAC=&quot;&lt;&lt;npointsAC&lt;&lt;</span>
<span class="lineNum">     951 </span>            :           &quot;\n&quot;;
<span class="lineNum">     952 </span>            :       }
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :     }</span>
<a name="954"><span class="lineNum">     954 </span>            :   }</a>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     956 </span>            : Bool_t  AliTPCcalibLaser::FitDriftV(Float_t minFraction){
<span class="lineNum">     957 </span>            :   //
<span class="lineNum">     958 </span>            :   // Fit corrections to the drift velocity - linear approximation in the z and global y
<span class="lineNum">     959 </span>            :   //The transfromatiom from the drift time to the z position done in AliTPCTracnsform class
<span class="lineNum">     960 </span>            :   // 
<span class="lineNum">     961 </span>            :   // Source of outlyers : 
<span class="lineNum">     962 </span>            :   // 0. Track in the saturation - postpeak
<span class="lineNum">     963 </span>            :   // 1. gating grid close the part of the signal for first bundle
<span class="lineNum">     964 </span>            : 
<span class="lineNum">     965 </span>            :   // The robust fit is performed in 2 itterations /robust fraction controlled by kFraction/
<span class="lineNum">     966 </span>            :   // 1. Robust fit is used in the itteration number 0
<span class="lineNum">     967 </span>            :   // only fraction of laser used
<span class="lineNum">     968 </span>            :   // 2. Only the tracks close to the fit used in the second itteration
<span class="lineNum">     969 </span>            :   /*
<span class="lineNum">     970 </span>            :     Formulas:
<span class="lineNum">     971 </span>            :     
<span class="lineNum">     972 </span>            :     z  = s* (z0 - vd*(t-t0))
<span class="lineNum">     973 </span>            :     
<span class="lineNum">     974 </span>            :     s  - side -1 and +1 
<span class="lineNum">     975 </span>            :     t0 - time 0
<span class="lineNum">     976 </span>            :     vd - nominal drift velocity
<span class="lineNum">     977 </span>            :     zs - miscalibrated position
<span class="lineNum">     978 </span>            :     
<span class="lineNum">     979 </span>            :     zs = s*(z0 - vd*(1+vr)*(t-(t0+dt))
<span class="lineNum">     980 </span>            :     vr  - relative change of the drift velocity
<span class="lineNum">     981 </span>            :     dzt - vd*dt
<span class="lineNum">     982 </span>            :     dr  = zz0-s*z
<span class="lineNum">     983 </span>            :     ..
<span class="lineNum">     984 </span>            :     ==&gt;
<span class="lineNum">     985 </span>            :     zs ~ z - s*vr*(z0-s*z)+s*dzt
<span class="lineNum">     986 </span>            :     --------------------------------
<span class="lineNum">     987 </span>            :     1. Correction function vr constant:
<span class="lineNum">     988 </span>            :     
<span class="lineNum">     989 </span>            :     
<span class="lineNum">     990 </span>            :     dz = zs-z = -s*vr *(z0-s*z)+s*dzt         
<span class="lineNum">     991 </span>            :     dzs/dl = dz/dl +s*s*vr*dz/dl 
<span class="lineNum">     992 </span>            :     d(dz/dl) = vr*dz/dl     
<span class="lineNum">     993 </span>            :   */
<span class="lineNum">     994 </span>            :   const Int_t   knLaser      = 336;     //n laser tracks
<span class="lineNum">     995 </span>            :   const Float_t kFraction[2] = {0.70,0.95};    // robust fit fraction
<span class="lineNum">     996 </span>            : 
<span class="lineNum">     997 </span>            :   const Float_t kSaturCut    = 0.05;    // remove saturated lasers - cut on fraction of saturated 
<span class="lineNum">     998 </span>            :   const Float_t kDistCut     = 3.;      // distance sigma cut - 3 sigma
<span class="lineNum">     999 </span>            :   const Float_t kDistCutAbs  = 1.;      // absolute cut 1 cm
<span class="lineNum">    1000 </span>            :   const Float_t kMinClusters = 40.;      // minimal amount of the clusters
<span class="lineNum">    1001 </span>            :   const Float_t kMinSignal   = 2.5;      // minimal mean height of the signal
<span class="lineNum">    1002 </span>            :   const Float_t kChi2Cut     = 1.0;     // chi2 cut to accept drift fit
<span class="lineNum">    1003 </span>            :   //
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftA(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftC(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :   static TLinearFitter fdriftAC(4,&quot;hyp3&quot;);</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :   TVectorD fitA(3),fitC(3),fitAC(4);</span>
<span class="lineNum">    1008 </span>            :   
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :   AliTPCcalibDB*  calib=AliTPCcalibDB::Instance();</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :   AliTPCParam  * tpcparam    = calib-&gt;GetParameters();    </span>
<span class="lineNum">    1011 </span>            :   //
<span class="lineNum">    1012 </span>            :   // reset old data
<span class="lineNum">    1013 </span>            :   //
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++) fFitZ[id]=0;</span>
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :   if (fFitAside-&gt;GetNoElements()&lt;5) fFitAside-&gt;ResizeTo(5);</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :   if (fFitCside-&gt;GetNoElements()&lt;5) fFitCside-&gt;ResizeTo(5);</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;5; i++){</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     (*fFitCside)[i]=0;</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :     (*fFitAside)[i]=0;</span>
<span class="lineNum">    1020 </span>            :   }
<span class="lineNum">    1021 </span>            :   //
<span class="lineNum">    1022 </span>            :   //
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :   Float_t chi2A = 10;</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :   Float_t chi2C = 10;</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :   Float_t chi2AC = 10;</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :   Int_t npointsA=0;</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :   Int_t npointsC=0;</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :   Int_t npointsAC=0;</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :   Int_t nbA[4]={0,0,0,0};</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :   Int_t nbC[4]={0,0,0,0};</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :   TVectorD vecZM(336);      // measured z potion of laser</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :   TVectorD vecA(336);       // accepted laser</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :   TVectorD vecZF(336);      // fitted position  </span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :   TVectorD vecDz(336);      // deltaZ</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :   TVectorD vecZS(336);      // surveyed position of laser</span>
<span class="lineNum">    1036 </span>            :   // additional variable to cut
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :   TVectorD vecdEdx(336);    // dEdx</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :   TVectorD vecSy(336);      // shape y</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :   TVectorD vecSz(336);      // shape z</span>
<span class="lineNum">    1040 </span>            :   //
<span class="lineNum">    1041 </span>            :   //
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    1043 </span>            :     Int_t reject=0;
<span class="lineNum">    1044 </span>            :     AliTPCLaserTrack *ltrp =
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :       (AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :     AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :     AliTPCseed * seed = (AliTPCseed*)fTracksTPC.At(id);</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :     vecZM(id)= (param==0) ? 0:param-&gt;GetZ();</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :     vecZS(id)= ltrp-&gt;GetZ();</span>
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :     vecDz(id)= 0;</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :     vecA(id)=1;</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :     vecdEdx(id)=(seed)?seed-&gt;GetdEdx():0;</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :     vecSy(id) =(seed)?seed-&gt;CookShape(1):0;</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :     vecSz(id) =(seed)?seed-&gt;CookShape(2):0;</span>
<span class="lineNum">    1055 </span>            :     //
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :     fFitZ[id]=0;</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :     if (!fTracksEsdParam.At(id)) reject|=1;</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :     if (!param) continue; </span>
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :     if (!AcceptLaser(id))        reject|=2;</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :     if ( fClusterSatur[id]&gt;kSaturCut)  reject|=4;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :     if ( fClusterCounter[id]&lt;kMinClusters)  reject|=8;</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :     vecA(id)=reject;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :     if (reject&gt;0) continue;</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :     if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :       npointsA++;</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :       nbA[ltrp-&gt;GetBundle()]++;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :     if (ltrp-&gt;GetSide()==1){</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :       npointsC++;</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :       nbC[ltrp-&gt;GetBundle()]++;</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1073 </span>            :   //
<span class="lineNum">    1074 </span>            :   // reject  &quot;bad events&quot;
<span class="lineNum">    1075 </span>            :   //
<span class="lineNum">    1076 </span>            :   Bool_t isOK=kTRUE;
<span class="lineNum">    1077 </span>            :   Int_t  naA=0;
<span class="lineNum">    1078 </span>            :   Int_t  naC=0;
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :   if (npointsA&lt;minFraction*0.5*knLaser &amp;&amp; npointsC&lt;minFraction*0.5*knLaser)</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :     isOK=kFALSE;</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;4;i++){</span>
<span class="lineNum">    1082 </span>            :     //count accepted for all layers
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :     if (nbA[i]&gt;minFraction*0.5*0.25*knLaser) naA++;</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :     if (nbC[i]&gt;minFraction*0.5*0.25*knLaser) naC++;</span>
<span class="lineNum">    1085 </span>            :   }
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :   if (naA&lt;3 &amp;&amp;naC&lt;3) isOK=kFALSE;</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :   if (isOK==kFALSE) return kFALSE;</span>
<span class="lineNum">    1088 </span>            :   
<span class="lineNum">    1089 </span>            :   //
<span class="lineNum">    1090 </span>            :   //
<span class="lineNum">    1091 </span>            :   //
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :   for (Int_t iter=0; iter&lt;2; iter++){</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :     fdriftA.ClearPoints();</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :     fdriftC.ClearPoints();</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :     fdriftAC.ClearPoints(); </span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :     npointsA=0;  npointsC=0;  npointsAC=0;</span>
<span class="lineNum">    1097 </span>            :     //
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :     for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :       if (!fTracksEsdParam.At(id)) continue;</span>
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :       if (!AcceptLaser(id)) continue;</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :       if ( fClusterSatur[id]&gt;kSaturCut)  continue;</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :       if ( fClusterCounter[id]&lt;kMinClusters)  continue;</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :       AliESDtrack   *track    = (AliESDtrack*)fTracksEsd.At(id);</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :       if (track-&gt;GetTPCsignal()&lt;kMinSignal) continue;</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :       AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       Double_t xyz[3];</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :       Double_t pxyz[3];</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :       Double_t lxyz[3];</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :       Double_t lpxyz[3];</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :       param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :       param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :       Float_t sz = (ltrp-&gt;GetSide()==0) ? TMath::Sqrt(chi2A): TMath::Sqrt(chi2C);</span>
<span class="lineNum">    1116 </span>            :       //if (npointsAC&gt;0) sz =TMath::Sqrt(chi2AC); 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :       if (iter&gt;0 &amp;&amp; TMath::Abs(fFitZ[id])&gt;sz*kDistCut) continue;</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :       if (iter&gt;0 &amp;&amp; TMath::Abs(fFitZ[id])&gt;kDistCutAbs) continue;</span>
<span class="lineNum">    1119 </span>            : 
<span class="lineNum">    1120 </span>            : //       // drift distance
<span class="lineNum">    1121 </span>            : //       Double_t zlength =  tpcparam-&gt;GetZLength(0);
<span class="lineNum">    1122 </span>            : //       Double_t ldrift  = zlength-TMath::Abs(lxyz[2]);
<span class="lineNum">    1123 </span>            : //       Double_t mdrift  = zlength-TMath::Abs(xyz[2]);
<span class="lineNum">    1124 </span>            :       //
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :       Double_t zlength = (ltrp-&gt;GetSide()==0)? tpcparam-&gt;GetZLength(36): tpcparam-&gt;GetZLength(71);</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :       Double_t ldrift  = (ltrp-&gt;GetSide()==0)?zlength-lxyz[2]:lxyz[2]+zlength;</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :       Double_t mdrift  = (ltrp-&gt;GetSide()==0)?zlength-xyz[2]:xyz[2]+zlength;</span>
<span class="lineNum">    1128 </span>            : 
<span class="lineNum">    1129 </span>            : 
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :       Double_t xxx[2] = {ldrift,lxyz[1]*ldrift/(zlength*250.)};</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :       if (iter==0 &amp;&amp;ltrp-&gt;GetBundle()==0) continue;  </span>
<span class="lineNum">    1132 </span>            :       // skip bundle 0 - can be wrong in the 0 iteration
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :       if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :         fdriftA.AddPoint(xxx,mdrift,1);</span>
<span class="lineNum">    1135 </span>            :       }else{
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :         fdriftC.AddPoint(xxx,mdrift,1);</span>
<span class="lineNum">    1137 </span>            :       }
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :       Double_t xxx2[3] = { static_cast&lt;Double_t&gt;(ltrp-&gt;GetSide()), ldrift,lxyz[1]*ldrift/(zlength*250.)};</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :       fdriftAC.AddPoint(xxx2,mdrift,1);</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1141 </span>            :     //
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :     if (fdriftA.GetNpoints()&gt;minFraction*0.5*knLaser){</span>
<span class="lineNum">    1143 </span>            :       //
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :       fdriftA.Eval();</span>
<span class="lineNum">    1145 </span>            :       //if (iter==0) fdriftA.FixParameter(2,0); //fix global y gradient
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :       npointsA= fdriftA.GetNpoints();</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :       chi2A = fdriftA.GetChisquare()/fdriftA.GetNpoints();</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :       fdriftA.EvalRobust(kFraction[iter]);</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :       fdriftA.GetParameters(fitA);</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :       if (chi2A&lt;kChi2Cut ||(*fFitAside)[0]==0 ) {</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :         if (fFitAside-&gt;GetNoElements()&lt;5) fFitAside-&gt;ResizeTo(5);</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :         (*fFitAside)[0] = fitA[0];</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :         (*fFitAside)[1] = fitA[1];</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :         (*fFitAside)[2] = fitA[2];</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :         (*fFitAside)[3] = fdriftA.GetNpoints();</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :         (*fFitAside)[4] = chi2A;        </span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1158 </span>            :     }
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :     if (fdriftC.GetNpoints()&gt;minFraction*0.5*knLaser){</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :       fdriftC.Eval();</span>
<span class="lineNum">    1161 </span>            :       //if (iter==0) fdriftC.FixParameter(2,0); //fix global y gradient
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :       npointsC= fdriftC.GetNpoints();</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :       chi2C = fdriftC.GetChisquare()/fdriftC.GetNpoints();</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :       fdriftC.EvalRobust(kFraction[iter]);</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :       fdriftC.GetParameters(fitC);</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :       if (chi2C&lt;kChi2Cut||(*fFitCside)[0]==0) {      </span>
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :         if (fFitCside-&gt;GetNoElements()&lt;5) fFitCside-&gt;ResizeTo(5);</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :         (*fFitCside)[0] = fitC[0];</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :         (*fFitCside)[1] = fitC[1];</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :         (*fFitCside)[2] = fitC[2];</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :         (*fFitCside)[3] = fdriftC.GetNpoints();</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :         (*fFitCside)[4] = chi2C;        </span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1174 </span>            :     }
<span class="lineNum">    1175 </span>            : 
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :     if (fdriftAC.GetNpoints()&gt;minFraction*knLaser &amp;&amp;npointsA&gt;0.5*minFraction*knLaser&amp;&amp;npointsC&gt;0.5*minFraction*knLaser){</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :       fdriftAC.Eval();</span>
<span class="lineNum">    1178 </span>            :       //if (iter==0) fdriftAC.FixParameter(2,0); //fix global y gradient
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :       npointsAC= fdriftAC.GetNpoints();</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :       chi2AC = fdriftAC.GetChisquare()/fdriftAC.GetNpoints();</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :       fdriftAC.EvalRobust(kFraction[iter]);</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :       fdriftAC.GetParameters(fitAC);</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :       if (chi2AC&lt;kChi2Cut||(*fFitACside)[0]==0) (*fFitACside) = fitAC;</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :       (*fFitACside)[0] = fitAC[0];</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :       (*fFitACside)[1] = fitAC[1];</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :       (*fFitACside)[2] = fitAC[2];</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :       (*fFitACside)[3] = fdriftAC.GetNpoints();</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :       (*fFitACside)[4] = chi2AC;</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1190 </span>            :     
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :     for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :       if (!fTracksEsdParam.At(id)) continue;</span>
<span class="lineNum">    1193 </span>            :       //
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :       AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :       Double_t xyz[3];</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :       Double_t pxyz[3];</span>
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :       Double_t lxyz[3];</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :       Double_t lpxyz[3];</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :       param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :       param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :       ltrp-&gt;GetPxPyPz(lpxyz); </span>
<span class="lineNum">    1204 </span>            :       //Double_t zlength =  tpcparam-&gt;GetZLength(0);
<span class="lineNum">    1205 </span>            :       //Double_t ldrift = zlength-TMath::Abs(lxyz[2]);
<span class="lineNum">    1206 </span>            :       //Double_t mdrift = zlength-TMath::Abs(xyz[2]);
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :       Double_t zlength = (ltrp-&gt;GetSide()==0)? tpcparam-&gt;GetZLength(36): tpcparam-&gt;GetZLength(71);</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :       Double_t ldrift  = (ltrp-&gt;GetSide()==0)?zlength-lxyz[2]:lxyz[2]+zlength;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :       Double_t mdrift  = (ltrp-&gt;GetSide()==0)?zlength-xyz[2]:xyz[2]+zlength;</span>
<span class="lineNum">    1210 </span>            : 
<span class="lineNum">    1211 </span>            : 
<span class="lineNum">    1212 </span>            :       Float_t fz =0;
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :       if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :         fz = (fitA)[0]+(fitA)[1]*ldrift+(fitA)[2]*lxyz[1]*ldrift/(zlength*250.);</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :       }else{</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :         fz = (fitC)[0]+(fitC)[1]*ldrift+(fitC)[2]*lxyz[1]*ldrift/(zlength*250.);        </span>
<span class="lineNum">    1217 </span>            :       }
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :       if (npointsAC&gt;10){</span>
<span class="lineNum">    1219 </span>            :         //fz = (fitAC)[0]+(fitAC)[1]*ltrp-&gt;GetSide()+(fitAC)[2]*ldrift+(fitAC)[3]*lxyz[1]*ldrift/(zlength*250.);
<span class="lineNum">    1220 </span>            :       }
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :       fFitZ[id]=mdrift-fz;</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :       vecZF[id]=fz;</span>
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :       vecDz[id]=mdrift-fz;</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :     if (fStreamLevel&gt;0){</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :       TTreeSRedirector *cstream = GetDebugStreamer();</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :       TTimeStamp tstamp(fTime);</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :       Float_t valuePressure0  = AliTPCcalibDB::GetPressure(tstamp,fRun,0);</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :       Float_t valuePressure1 = AliTPCcalibDB::GetPressure(tstamp,fRun,1);</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :       Double_t ptrelative0   = AliTPCcalibDB::GetPTRelative(tstamp,fRun,0);</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :       Double_t ptrelative1   = AliTPCcalibDB::GetPTRelative(tstamp,fRun,1);</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :       Double_t temp0         = AliTPCcalibDB::GetTemperature(tstamp,fRun,0);</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :       Double_t temp1         = AliTPCcalibDB::GetTemperature(tstamp,fRun,1);</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :       TVectorD vecGoofie(20);</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :       AliDCSSensorArray* goofieArray = AliTPCcalibDB::Instance()-&gt;GetGoofieSensors(fRun);</span>
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :       if (goofieArray) </span>
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :         for (Int_t isensor=0; isensor&lt;goofieArray-&gt;NumSensors();isensor++){</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :           AliDCSSensor *gsensor = goofieArray-&gt;GetSensor(isensor);</span>
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 :           if (gsensor) vecGoofie[isensor]=gsensor-&gt;GetValue(tstamp);</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1241 </span>            : 
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :       if (cstream){</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :         (*cstream)&lt;&lt;&quot;driftvN&quot;&lt;&lt;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :           &quot;run=&quot;&lt;&lt;fRun&lt;&lt;              //  run number</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :           &quot;event=&quot;&lt;&lt;fEvent&lt;&lt;          //  event number</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :           &quot;time=&quot;&lt;&lt;fTime&lt;&lt;            //  time stamp of event</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :           &quot;trigger=&quot;&lt;&lt;fTrigger&lt;&lt;      //  trigger</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :           &quot;mag=&quot;&lt;&lt;fMagF&lt;&lt;             //  magnetic field</span>
<span class="lineNum">    1249 </span>            :           // Environment values
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :           &quot;press0=&quot;&lt;&lt;valuePressure0&lt;&lt;</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :           &quot;press1=&quot;&lt;&lt;valuePressure1&lt;&lt;</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :           &quot;pt0=&quot;&lt;&lt;ptrelative0&lt;&lt;</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :           &quot;pt1=&quot;&lt;&lt;ptrelative1&lt;&lt;</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :           &quot;temp0=&quot;&lt;&lt;temp0&lt;&lt;</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :           &quot;temp1=&quot;&lt;&lt;temp1&lt;&lt;</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :           &quot;vecGoofie.=&quot;&lt;&lt;&amp;vecGoofie&lt;&lt;</span>
<span class="lineNum">    1257 </span>            :           //
<span class="lineNum">    1258 </span>            :           //
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :           &quot;vecZM.=&quot;&lt;&lt;&amp;vecZM&lt;&lt;   // measured z position</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :           &quot;vecZS.=&quot;&lt;&lt;&amp;vecZS&lt;&lt;   // surveyed z position</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :           &quot;vecZF.=&quot;&lt;&lt;&amp;vecZF&lt;&lt;   // fitted   z position</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :           &quot;vecDz.=&quot;&lt;&lt;&amp;vecDz&lt;&lt;   // fitted   z position</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :           &quot;vecA.=&quot;&lt;&lt;&amp;vecA&lt;&lt;     // accept laser flag</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :           &quot;vecdEdx.=&quot;&lt;&lt;&amp;vecdEdx&lt;&lt;   // dEdx  - to cut on</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :           &quot;vecSy.=&quot;&lt;&lt;&amp;vecSy&lt;&lt;       // shape y - to cut on</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :           &quot;vecSz.=&quot;&lt;&lt;&amp;vecSz&lt;&lt;       // shape z - to cut on</span>
<span class="lineNum">    1267 </span>            :           //
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :           &quot;iter=&quot;&lt;&lt;iter&lt;&lt;</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :           &quot;driftA.=&quot;&lt;&lt;fFitAside&lt;&lt;</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :           &quot;driftC.=&quot;&lt;&lt;fFitCside&lt;&lt;</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :           &quot;driftAC.=&quot;&lt;&lt;fFitACside&lt;&lt;</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :           &quot;chi2A=&quot;&lt;&lt;chi2A&lt;&lt;</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :           &quot;chi2C=&quot;&lt;&lt;chi2C&lt;&lt;</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :           &quot;chi2AC=&quot;&lt;&lt;chi2AC&lt;&lt;</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :           &quot;nA=&quot;&lt;&lt;npointsA&lt;&lt;</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :           &quot;nC=&quot;&lt;&lt;npointsC&lt;&lt;</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :           &quot;nAC=&quot;&lt;&lt;npointsAC&lt;&lt;</span>
<span class="lineNum">    1278 </span>            :           &quot;\n&quot;;
<span class="lineNum">    1279 </span>            :         /*
<span class="lineNum">    1280 </span>            :           //
<span class="lineNum">    1281 </span>            :           variables to check in debug mode:
<span class="lineNum">    1282 </span>            :           //
<span class="lineNum">    1283 </span>            :           chainDriftN-&gt;SetAlias(&quot;driftS&quot;,&quot;250-abs(vecZS.fElements)&quot;);
<span class="lineNum">    1284 </span>            :           chainDriftN-&gt;SetAlias(&quot;driftM&quot;,&quot;250-abs(vecZM.fElements)&quot;);
<span class="lineNum">    1285 </span>            :           chainDriftN-&gt;SetAlias(&quot;driftF&quot;,&quot;vecZF.fElements&quot;);       
<span class="lineNum">    1286 </span>            :           chainDriftN-&gt;SetAlias(&quot;deltaZ&quot;,&quot;driftF-driftM&quot;);  //deltaZ
<span class="lineNum">    1287 </span>            :           TCut cutA=&quot;iter==1&amp;&amp;sqrt(chi2A)&lt;0.1&amp;&amp;vecZS.fElements&gt;0&amp;&amp;vecA.fElements==0&quot;;
<span class="lineNum">    1288 </span>            :           TCut cutC=&quot;iter==1&amp;&amp;sqrt(chi2C)&lt;0.1&amp;&amp;vecZS.fElements&lt;0&amp;&amp;vecA.fElements==0&quot;;
<span class="lineNum">    1289 </span>            :           
<span class="lineNum">    1290 </span>            :          */
<span class="lineNum">    1291 </span>            :       }
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1293 </span>            :   }
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :   return kTRUE;</span>
<a name="1295"><span class="lineNum">    1295 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1296 </span>            : 
<span class="lineNum">    1297 </span>            : Float_t AliTPCcalibLaser::GetDistance(AliExternalTrackParam *param, AliTPCLaserTrack *ltrp){
<span class="lineNum">    1298 </span>            :   //
<span class="lineNum">    1299 </span>            :   // get distance between mirror and laser track
<span class="lineNum">    1300 </span>            :   //
<span class="lineNum">    1301 </span>            :   //
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :   Double_t xyz[3];</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :   Double_t lxyz[3];</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :   param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :   ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    1306 </span>            :   //
<span class="lineNum">    1307 </span>            :   //
<span class="lineNum">    1308 </span>            :   Double_t dist = 0;
<span class="lineNum">    1309 </span>            :   //radial distance
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :   dist+=TMath::Abs((TMath::ATan2(xyz[1],xyz[0])-TMath::ATan2(lxyz[1],lxyz[0]))*param-&gt;GetX());</span>
<span class="lineNum">    1311 </span>            :   //
<span class="lineNum">    1312 </span>            :   // z distance
<span class="lineNum">    1313 </span>            :   // apply drift correction if already exist
<span class="lineNum">    1314 </span>            :   //
<span class="lineNum">    1315 </span>            :   Float_t dz = 0;
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :   if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :     if ((*fFitAside)[1]&gt;0.) dz = ((*fFitAside)[0]+(*fFitAside)[1]*lxyz[2]+(*fFitAside)[2]*lxyz[1])-xyz[2];</span>
<span class="lineNum">    1318 </span>            :   }else{
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :     if ((*fFitCside)[1]&gt;0.) dz = ((*fFitCside)[0]+(*fFitCside)[1]*lxyz[2]+(*fFitCside)[2]*lxyz[1])-xyz[2];</span>
<span class="lineNum">    1320 </span>            :   }
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :   if (TMath::Abs(dz)&gt;3*(TMath::Abs(lxyz[2]-xyz[2])+1)) dz= TMath::Abs(lxyz[2]-xyz[2]);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :   dist+=TMath::Abs(dz);</span>
<span class="lineNum">    1323 </span>            :   //
<span class="lineNum">    1324 </span>            :   // phi dist - divergence on 50 cm
<span class="lineNum">    1325 </span>            :   //
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :   dist = TMath::Abs((param-&gt;GetParameter()[2]-ltrp-&gt;GetParameter()[2])*50);</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :   return dist;</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 : }</span>
<a name="1329"><span class="lineNum">    1329 </span>            : </a>
<span class="lineNum">    1330 </span>            : 
<span class="lineNum">    1331 </span>            : Bool_t  AliTPCcalibLaser::AcceptLaser(Int_t id){
<span class="lineNum">    1332 </span>            :   //
<span class="lineNum">    1333 </span>            :   //
<span class="lineNum">    1334 </span>            :   //
<span class="lineNum">    1335 </span>            :   /*
<span class="lineNum">    1336 </span>            :   TCut cutP0(&quot;cutP0&quot;,&quot;abs((atan2(x1,x0)-atan2(lx1,lx0))*254)&lt;1.5&quot;);
<span class="lineNum">    1337 </span>            :   TCut cutP1(&quot;cutP1&quot;,&quot;abs(LTr.fP[1]-Tr.fP[1])&lt;30&quot;);
<span class="lineNum">    1338 </span>            :   TCut cutP2(&quot;cutP2&quot;,&quot;abs(LTr.fP[2]-Tr.fP[2])&lt;0.03&quot;);
<span class="lineNum">    1339 </span>            :   TCut cutP3(&quot;cutP3&quot;,&quot;abs(Tr.fP[3])&lt;0.05&quot;);
<span class="lineNum">    1340 </span>            : 
<span class="lineNum">    1341 </span>            :   TCut cutA = cutP0+cutP1+cutP2+cutP3+cutP4;
<span class="lineNum">    1342 </span>            :   */
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :   AliExternalTrackParam *param =(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack *ltrp  = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    1345 </span>            :   //AliESDtrack   *track    = (AliESDtrack*)fTracksEsd.At(id);
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :   Double_t xyz[3];</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :   Double_t lxyz[3];</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :   param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :   ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :   if (TMath::Abs((TMath::ATan2(xyz[1],xyz[0])-TMath::ATan2(lxyz[1],lxyz[0]))*254)&gt;1.5) return kFALSE; //cut y- P0</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :   if (TMath::Abs(param-&gt;GetParameter()[1]-ltrp-&gt;GetParameter()[1])&gt;30) return kFALSE;    // cutZ -P1</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :   if (TMath::Abs(param-&gt;GetParameter()[2]-ltrp-&gt;GetParameter()[2])&gt;0.03) return kFALSE;  // cut -P2</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :   if (TMath::Abs(param-&gt;GetParameter()[3])&gt;0.05) return kFALSE;   // cut Tl -P3</span>
<span class="lineNum">    1354 </span>            :   //
<span class="lineNum">    1355 </span>            :   //
<span class="lineNum">    1356 </span>            : 
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :   return kTRUE;</span>
<a name="1358"><span class="lineNum">    1358 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1359 </span>            : 
<span class="lineNum">    1360 </span>            : Int_t  AliTPCcalibLaser::FindMirror(AliESDtrack *track, AliTPCseed *seed){
<span class="lineNum">    1361 </span>            :   //
<span class="lineNum">    1362 </span>            :   // Find corresponding mirror
<span class="lineNum">    1363 </span>            :   // add the corresponding tracks
<span class="lineNum">    1364 </span>            :  
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :   if (!track-&gt;GetOuterParam()) return -1;</span>
<span class="lineNum">    1366 </span>            : 
<span class="lineNum">    1367 </span>            :   Float_t kRadius0  = 252;
<span class="lineNum">    1368 </span>            :   Float_t kRadius   = 254.2;
<span class="lineNum">    1369 </span>            :   Int_t countercl=0;
<span class="lineNum">    1370 </span>            :   Float_t counterSatur=0;
<span class="lineNum">    1371 </span>            :   Int_t csideA =0;
<span class="lineNum">    1372 </span>            :   Int_t csideC =0;
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :   for (Int_t irow=158;irow&gt;-1;--irow) {</span>
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :     AliTPCclusterMI *c=seed-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :     if (!c) continue;</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :     Double_t pedgeY = c-&gt;GetX()*TMath::DegToRad()*(10)-TMath::Abs(c-&gt;GetY());</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :     Double_t pedgeX = TMath::Min((irow)*0.75, (kMaxRow-irow)*1.5);</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :     if (pedgeY&lt;3) continue;</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :     if (pedgeX&lt;3) continue;</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :     countercl++;</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :     if (c-&gt;GetDetector()%36&lt;18) csideA++;</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :     if (c-&gt;GetDetector()%36&gt;=18) csideC++;</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :     if (c-&gt;GetMax()&gt;900) counterSatur++;</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :   counterSatur/=(countercl+1);</span>
<span class="lineNum">    1386 </span>            :   //
<span class="lineNum">    1387 </span>            :   //
<span class="lineNum">    1388 </span>            :   //
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :   if (csideA&lt;0.9*seed-&gt;GetNumberOfClusters() &amp;&amp; csideC&lt;0.9*seed-&gt;GetNumberOfClusters()) return 0;  // cross laser track can not happen</span>
<span class="lineNum">    1390 </span>            : 
<span class="lineNum">    1391 </span>            :   Int_t side= 0;
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :   if (csideC&gt;0.5*seed-&gt;GetNumberOfClusters()) side=1;</span>
<span class="lineNum">    1393 </span>            : 
<span class="lineNum">    1394 </span>            : 
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :   AliExternalTrackParam param(*(track-&gt;GetOuterParam()));</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :   AliTracker::PropagateTrackTo(&amp;param,kRadius0,TDatabasePDG::Instance()-&gt;GetParticle(&quot;mu+&quot;)-&gt;Mass(),3,kTRUE);</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :   AliTracker::PropagateTrackTo(&amp;param,kRadius,TDatabasePDG::Instance()-&gt;GetParticle(&quot;mu+&quot;)-&gt;Mass(),0.1,kTRUE);</span>
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack ltr;</span>
<span class="lineNum">    1399 </span>            :   AliTPCLaserTrack *ltrp=0x0;
<span class="lineNum">    1400 </span>            :   //  AliTPCLaserTrack *ltrpjw=0x0;
<span class="lineNum">    1401 </span>            :   //
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :   Int_t id   = AliTPCLaserTrack::IdentifyTrack(&amp;param,side);</span>
<span class="lineNum">    1403 </span>            :  // Int_t idjw = AliTPCLaserTrack::IdentifyTrackJW(&amp;param);
<span class="lineNum">    1404 </span>            :   //AliDebug(4,Form(&quot;Identified Track: %03d (%03d)&quot;,id,idjw));
<span class="lineNum">    1405 </span>            : 
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :   if (id!=-1 &amp;&amp; (AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id)))</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :     ltrp=(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    1408 </span>            :   else
<span class="lineNum">    1409 </span>            :     ltrp=&amp;ltr;
<span class="lineNum">    1410 </span>            : 
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :   if (id&lt;0) return -1;</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :   if (ltrp-&gt;GetSide()!=side) return -1;</span>
<span class="lineNum">    1413 </span><span class="lineNoCov">          0 :   fCounter[id]++;</span>
<span class="lineNum">    1414 </span>            :   //
<span class="lineNum">    1415 </span>            :   //
<span class="lineNum">    1416 </span>            :   //
<span class="lineNum">    1417 </span>            :   //
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :   if (counterSatur&gt;fClusterSatur[id]) fClusterSatur[id]=counterSatur;</span>
<span class="lineNum">    1419 </span>            :   //
<span class="lineNum">    1420 </span>            :   //
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :   Float_t radius=TMath::Abs(ltrp-&gt;GetX());</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :   param.Rotate(ltrp-&gt;GetAlpha());</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :   AliTracker::PropagateTrackTo(&amp;param,radius,0.10566,0.01,kFALSE);</span>
<span class="lineNum">    1424 </span>            :   //
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :   if (!fTracksMirror.At(id)) fTracksMirror.AddAt(ltrp,id);</span>
<span class="lineNum">    1426 </span>            :   Bool_t accept=kTRUE;  
<span class="lineNum">    1427 </span>            :   //
<span class="lineNum">    1428 </span>            :   // choose closer track
<span class="lineNum">    1429 </span>            :   //
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :   AliExternalTrackParam * param0  = (AliExternalTrackParam *)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :   if (param0){</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :     Float_t dist0=GetDistance(param0,ltrp);</span>
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :     Float_t dist1=GetDistance(&amp;param,ltrp);</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     if (dist0&lt;dist1)    accept=kFALSE;       </span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1436 </span>            :   
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :   if (accept){</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :     fClusterCounter[id]=countercl;</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :     fTracksEsdParam.AddAt(param.Clone(),id);</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :     fTracksEsd.AddAt(track,id);</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :     fTracksTPC.AddAt(seed,id);</span>
<span class="lineNum">    1442 </span>            :   }
<span class="lineNum">    1443 </span>            :   return id;
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1445 </span>            : 
<a name="1446"><span class="lineNum">    1446 </span>            : </a>
<span class="lineNum">    1447 </span>            : 
<span class="lineNum">    1448 </span>            : void AliTPCcalibLaser::DumpLaser(Int_t id) {
<span class="lineNum">    1449 </span>            :   //
<span class="lineNum">    1450 </span>            :   //  Dump Laser info to the tree
<span class="lineNum">    1451 </span>            :   //
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :   AliESDtrack   *track    = (AliESDtrack*)fTracksEsd.At(id);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :   AliExternalTrackParam *param=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack *ltrp = ( AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    1455 </span>            :   //
<span class="lineNum">    1456 </span>            :   // Fast laser ID
<span class="lineNum">    1457 </span>            :   //
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :   Double_t xyz[3];</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :   Double_t pxyz[3];</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :   Double_t lxyz[3];</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :   Double_t lpxyz[3];</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :   param-&gt;GetXYZ(xyz);</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :   param-&gt;GetPxPyPz(pxyz);</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :   ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :   ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :   Float_t dist3D   = GetDistance(param,ltrp);</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :   Float_t dist0    = (TMath::ATan2(xyz[1],xyz[0])-TMath::ATan2(lxyz[1],lxyz[0]))*param-&gt;GetX();</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :   Float_t distphi  = (param-&gt;GetParameter()[2]-ltrp-&gt;GetParameter()[2])*50;</span>
<span class="lineNum">    1469 </span>            :   
<span class="lineNum">    1470 </span>            :   
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :   if (fStreamLevel&gt;0){</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :     TTreeSRedirector *cstream = GetDebugStreamer();</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :     Int_t time = fESD-&gt;GetTimeStamp();</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :     Bool_t accept = AcceptLaser(id);</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :     if (cstream){</span>
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :       (*cstream)&lt;&lt;&quot;Track&quot;&lt;&lt;</span>
<span class="lineNum">    1477 </span>            :         //
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :         &quot;run=&quot;&lt;&lt;fRun&lt;&lt;              //  run number</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :         &quot;event=&quot;&lt;&lt;fEvent&lt;&lt;          //  event number</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :         &quot;time=&quot;&lt;&lt;fTime&lt;&lt;            //  time stamp of event</span>
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :         &quot;trigger=&quot;&lt;&lt;fTrigger&lt;&lt;      //  trigger</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :         &quot;mag=&quot;&lt;&lt;fMagF&lt;&lt;             //  magnetic field</span>
<span class="lineNum">    1483 </span>            : 
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :         &quot;id=&quot;&lt;&lt;id&lt;&lt;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :         &quot;accept=&quot;&lt;&lt;accept&lt;&lt;</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :         &quot;driftA.=&quot;&lt;&lt;fFitAside&lt;&lt;</span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :         &quot;driftC.=&quot;&lt;&lt;fFitCside&lt;&lt;</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :         &quot;time=&quot;&lt;&lt;time&lt;&lt;</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :         &quot;dist3D=&quot;&lt;&lt;dist3D&lt;&lt;</span>
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         &quot;dist0=&quot;&lt;&lt;dist0&lt;&lt;</span>
<span class="lineNum">    1491 </span><span class="lineNoCov">          0 :         &quot;distphi=&quot;&lt;&lt;distphi&lt;&lt;</span>
<span class="lineNum">    1492 </span>            :         //
<span class="lineNum">    1493 </span>            :         //
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :         &quot;counter=&quot;&lt;&lt;fCounter[id]&lt;&lt;</span>
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :         &quot;clcounter=&quot;&lt;&lt;fClusterCounter[id]&lt;&lt;</span>
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :         &quot;satur=&quot;&lt;&lt;fClusterSatur[id]&lt;&lt;</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :         &quot;fz=&quot;&lt;&lt;fFitZ[id]&lt;&lt;</span>
<span class="lineNum">    1498 </span>            :         //
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :         &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;</span>
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :         &quot;Esd.=&quot;&lt;&lt;track&lt;&lt;</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :         &quot;Tr.=&quot;&lt;&lt;param&lt;&lt;</span>
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :         &quot;x0=&quot;&lt;&lt;xyz[0]&lt;&lt;</span>
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :         &quot;x1=&quot;&lt;&lt;xyz[1]&lt;&lt;</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :         &quot;x2=&quot;&lt;&lt;xyz[2]&lt;&lt;</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :         &quot;px0=&quot;&lt;&lt;pxyz[0]&lt;&lt;</span>
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :         &quot;px1=&quot;&lt;&lt;pxyz[1]&lt;&lt;</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :         &quot;px2=&quot;&lt;&lt;pxyz[2]&lt;&lt;</span>
<span class="lineNum">    1508 </span>            :         //
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :         &quot;lx0=&quot;&lt;&lt;lxyz[0]&lt;&lt;</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :         &quot;lx1=&quot;&lt;&lt;lxyz[1]&lt;&lt;</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :         &quot;lx2=&quot;&lt;&lt;lxyz[2]&lt;&lt;</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :         &quot;lpx0=&quot;&lt;&lt;lpxyz[0]&lt;&lt;</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :         &quot;lpx1=&quot;&lt;&lt;lpxyz[1]&lt;&lt;</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :         &quot;lpx2=&quot;&lt;&lt;lpxyz[2]&lt;&lt;</span>
<span class="lineNum">    1515 </span>            :         &quot;\n&quot;;
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 :   }</span>
<a name="1518"><span class="lineNum">    1518 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1519 </span>            : 
<span class="lineNum">    1520 </span>            : void AliTPCcalibLaser::RefitLaserJW(Int_t id){
<span class="lineNum">    1521 </span>            :   //
<span class="lineNum">    1522 </span>            :   // Refit the track with different tracklet models:
<span class="lineNum">    1523 </span>            :   // 1. Per ROC using the kalman filter, different edge cuts
<span class="lineNum">    1524 </span>            :   // 2. Per ROC linear in y and z
<span class="lineNum">    1525 </span>            :   // 3. Per ROC quadratic in y and z
<span class="lineNum">    1526 </span>            :   // 4. Per track offset for each sector, linear for each sector, common quadratic
<span class="lineNum">    1527 </span>            :   // store x, y, z information for all models and the cluster to calculate the residuals
<span class="lineNum">    1528 </span>            :   //
<span class="lineNum">    1529 </span>            :   
<span class="lineNum">    1530 </span>            :   // The clusters which do not fulfill given  criteria are skipped
<span class="lineNum">    1531 </span>            :   //
<span class="lineNum">    1532 </span>            :   // Cluters removed from fit
<span class="lineNum">    1533 </span>            :   //  1. Extended shape     &gt; kShapeCut
<span class="lineNum">    1534 </span>            :   //  2. In saturation  Max &gt; kMax
<span class="lineNum">    1535 </span>            :   //  3. Distance to edge   &lt; cutEdge
<span class="lineNum">    1536 </span>            :   //
<span class="lineNum">    1537 </span>            :   // Clusters not used for the calibration:
<span class="lineNum">    1538 </span>            :   //
<span class="lineNum">    1539 </span>            :   //  1. Extended shape     &gt; kShapeCut
<span class="lineNum">    1540 </span>            :   //  2. In saturation  Max &gt; kMax
<span class="lineNum">    1541 </span>            : 
<span class="lineNum">    1542 </span>            : 
<span class="lineNum">    1543 </span><span class="lineNoCov">          0 :   AliTPCseed *track      = (AliTPCseed*)fTracksTPC.At(id);</span>
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :   AliExternalTrackParam *extparam=(AliExternalTrackParam*)fTracksEsdParam.At(id);</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack *ltrp = (AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    1546 </span>            : 
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :   AliTPCclusterMI dummyCl;</span>
<span class="lineNum">    1548 </span>            : 
<span class="lineNum">    1549 </span>            :   //two tracklets
<span class="lineNum">    1550 </span>            :   Int_t kMaxTracklets=2;  
<span class="lineNum">    1551 </span>            :   Float_t kShapeCut = 1.3;
<span class="lineNum">    1552 </span>            :   Float_t kRatioCut = 2.;
<span class="lineNum">    1553 </span>            : 
<span class="lineNum">    1554 </span>            :   Float_t kMax      = 900.;
<span class="lineNum">    1555 </span>            : 
<span class="lineNum">    1556 </span>            : 
<span class="lineNum">    1557 </span>            :   //=============================================//
<span class="lineNum">    1558 </span>            :   // Linear Fitters for the Different Approaches //
<span class="lineNum">    1559 </span>            :   //=============================================//
<span class="lineNum">    1560 </span>            :   //linear fit model in y and z; inner - outer sector, combined with offset
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :   static TLinearFitter fy1I(2,&quot;hyp1&quot;);</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :   static TLinearFitter fy1O(2,&quot;hyp1&quot;);</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :   static TLinearFitter fz1I(2,&quot;hyp1&quot;);</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :   static TLinearFitter fz1O(2,&quot;hyp1&quot;);</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :   static TLinearFitter fy1IO(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :   static TLinearFitter fz1IO(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1567 </span>            :   //quadratic fit model in y and z; inner - sector
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :   static TLinearFitter fy2I(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :   static TLinearFitter fy2O(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :   static TLinearFitter fz2I(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :   static TLinearFitter fz2O(3,&quot;hyp2&quot;);</span>
<span class="lineNum">    1572 </span>            :   //common quadratic fit for IROC and OROC in y and z
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :   static TLinearFitter fy4(5,&quot;hyp4&quot;);</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :   static TLinearFitter fz4(5,&quot;hyp4&quot;);</span>
<span class="lineNum">    1575 </span>            : 
<span class="lineNum">    1576 </span>            : 
<span class="lineNum">    1577 </span>            :   //set standard cuts
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :   if ( fNcuts==0 ){</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :       fNcuts=1;</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :       fEdgeXcuts[0]=4;</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :       fEdgeYcuts[0]=3;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :       fNClCuts[0]=20;</span>
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1584 </span>            :   //=============================//
<span class="lineNum">    1585 </span>            :   // Loop over all Tracklet Cuts //
<span class="lineNum">    1586 </span>            :   //=============================//
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :   for (Int_t icut=0; icut&lt;fNcuts; icut++){</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :     Float_t xinMin = 2500, xinMax=-90;</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :     Float_t xoutMin=2500, xoutMax=-90;</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :     Float_t msigmaYIn=0;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :     Float_t msigmaYOut=0;</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :     Float_t mqratioIn=0;</span>
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :     Float_t mqratioOut=0;</span>
<span class="lineNum">    1594 </span>            : 
<span class="lineNum">    1595 </span>            : 
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :       AliDebug(4,Form(&quot;Processing cut %d for track with ID %d&quot;,icut,id));</span>
<span class="lineNum">    1597 </span>            :       //cut parameters
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :       Double_t edgeCutX = fEdgeXcuts[icut];</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :       Double_t edgeCutY = fEdgeYcuts[icut];</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :       Int_t    nclCut   = (Int_t)fNClCuts[icut];</span>
<span class="lineNum">    1601 </span>            :       //=========================//
<span class="lineNum">    1602 </span>            :       // Parameters to calculate //
<span class="lineNum">    1603 </span>            :       //=========================//
<span class="lineNum">    1604 </span>            :       //fit parameter inner, outer tracklet and combined fit
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :       TVectorD vecy1resInner(2),vecz1resInner(2); //pol1 fit parameters inner</span>
<span class="lineNum">    1606 </span><span class="lineNoCov">          0 :       TVectorD vecy2resInner(3),vecz2resInner(3); //pol2 fit parameters inner</span>
<span class="lineNum">    1607 </span>            :       //
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :       TVectorD vecy1resOuter(2),vecz1resOuter(2); //pol1 fit parameters outer</span>
<span class="lineNum">    1609 </span><span class="lineNoCov">          0 :       TVectorD vecy2resOuter(3),vecz2resOuter(3); //pol2 fit parameters outer</span>
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :       TVectorD vecy4res(5),vecz4res(5);</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :       TVectorD vecy1resIO(3),vecz1resIO(3);</span>
<span class="lineNum">    1612 </span>            :       // cluster and track positions for each row - used for residuals
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :       TVectorD vecgX(kMaxRow);        // global X</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :       TVectorD vecgY(kMaxRow);        // global Y</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :       TVectorD vecgZ(kMaxRow);        // global Z</span>
<span class="lineNum">    1616 </span>            : 
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :       TVectorD vecX(kMaxRow);        // x is the same for all (row center)</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :       TVectorD vecYkalman(kMaxRow);  // y from kalman fit</span>
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :       TVectorD vecZkalman(kMaxRow);  // z from kalman fit</span>
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :       TVectorD vecY1(kMaxRow);       // y from pol1 fit per ROC</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :       TVectorD vecZ1(kMaxRow);       // z from pol1 fit per ROC</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :       TVectorD vecY1IO(kMaxRow);     // y from pol1 fit per ROC</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :       TVectorD vecZ1IO(kMaxRow);     // z from pol1 fit per ROC</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :       TVectorD vecY2(kMaxRow);       // y from pol2 fit per ROC</span>
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :       TVectorD vecZ2(kMaxRow);       // z from pol2 fit per ROC</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :       TVectorD vecY4(kMaxRow);       // y from sector fit</span>
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :       TVectorD vecZ4(kMaxRow);       // z from sector fit</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :       TVectorD vecClY(kMaxRow);      // y cluster position</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :       TVectorD vecClZ(kMaxRow);      // z cluster position</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :       TVectorD vecSec(kMaxRow);      // sector for each row</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :       TVectorD  isReject(kMaxRow);    // flag - cluster to be rejected </span>
<span class="lineNum">    1632 </span>            :       //chi2 of fits
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :       Double_t chi2I1z=0;       // chi2 of pol1 fit in z (inner)</span>
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :       Double_t chi2I1y=0;       // chi2 of pol1 fit in y (inner)</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :       Double_t chi2O1z=0;       // chi2 of pol1 fit in z (outer)</span>
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 :       Double_t chi2O1y=0;       // chi2 of pol1 fit in y (outer)</span>
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :       Double_t chi2IO1z=0;       // chi2 of pol1 fit in z (outer)</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :       Double_t chi2IO1y=0;       // chi2 of pol1 fit in y (outer)</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :       Double_t chi2I2z=0;       // chi2 of pol2 fit in z (inner)</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :       Double_t chi2I2y=0;       // chi2 of pol2 fit in y (inner)</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :       Double_t chi2O2z=0;       // chi2 of pol2 fit in z (outer)</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :       Double_t chi2O2y=0;       // chi2 of pol2 fit in y (outer)</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :       Double_t chi2IOz=0;       // chi2 of hyp4 fit in z (inner+outer)</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :       Double_t chi2IOy=0;       // chi2 of hyp4 fit in y (inner+outer)</span>
<span class="lineNum">    1645 </span>            :       //more
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :       Int_t innerSector = -1;    // number of inner sector</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :       Int_t outerSector = -1;    // number of outer sector</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :       Int_t nclI=0;              // number of clusters (inner)</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :       Int_t nclO=0;              // number of clusters (outer)</span>
<span class="lineNum">    1650 </span>            :       //=================================================//
<span class="lineNum">    1651 </span>            :       // Perform the Kalman Fit using the Tracklet Class //
<span class="lineNum">    1652 </span>            :       //=================================================//
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :       AliTPCTracklet::SetEdgeCut(edgeCutX,edgeCutY);</span>
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :       TObjArray tracklets=</span>
<span class="lineNum">    1655 </span><span class="lineNoCov">          0 :           AliTPCTracklet::CreateTracklets(track,AliTPCTracklet::kKalman,</span>
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :                                           kFALSE,nclCut,kMaxTracklets);</span>
<span class="lineNum">    1657 </span>            :       // tracklet pointers
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :       AliTPCTracklet *trInner = (AliTPCTracklet*)tracklets.At(0);</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :       AliTPCTracklet *trOuter = (AliTPCTracklet*)tracklets.At(1);</span>
<span class="lineNum">    1660 </span>            :       AliTPCTracklet *tr=0x0;
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :       AliTPCTracklet dummy;</span>
<span class="lineNum">    1662 </span>            :       //continue if we didn't find a tracklet
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :       if ( !trInner &amp;&amp; !trOuter ) continue;</span>
<span class="lineNum">    1664 </span>            :       //================================================================================//
<span class="lineNum">    1665 </span>            :       // Swap Inner and Outer if necessary (inner sector is definde by smaller local x) //
<span class="lineNum">    1666 </span>            :       //================================================================================//
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :       if ( trInner &amp;&amp; trOuter ){</span>
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :           if ( !trInner-&gt;GetInner() || !trOuter-&gt;GetInner() ) continue;</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :           if ( trInner-&gt;GetInner()-&gt;GetX() &gt; trOuter-&gt;GetInner()-&gt;GetX() ){</span>
<span class="lineNum">    1670 </span>            :               tr = trInner;
<span class="lineNum">    1671 </span>            :               trInner=trOuter;
<span class="lineNum">    1672 </span>            :               trOuter=tr;
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :               AliDebug(5,Form(&quot;Swapped Sectors: %02d (%f) &lt;-&gt; %02d (%f)&quot;, trOuter-&gt;GetSector(), trOuter-&gt;GetInner()-&gt;GetX(), trInner-&gt;GetSector(), trInner-&gt;GetInner()-&gt;GetX()));</span>
<span class="lineNum">    1674 </span>            :           }
<span class="lineNum">    1675 </span>            :       } else {
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :           if ( trInner ){</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :               if ( !trInner-&gt;GetInner() ) continue;</span>
<span class="lineNum">    1678 </span>            :               trOuter=&amp;dummy;
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :               if ( trInner-&gt;GetSector()&gt;35 ){</span>
<span class="lineNum">    1680 </span>            :                   trOuter=trInner;
<span class="lineNum">    1681 </span>            :                   trInner=&amp;dummy;
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 :               }</span>
<span class="lineNum">    1683 </span>            :           } else { //trOuter
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :               if ( !trOuter-&gt;GetInner() ) continue;</span>
<span class="lineNum">    1685 </span>            :               trInner=&amp;dummy;
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :               if ( trOuter-&gt;GetSector()&lt;36 ){</span>
<span class="lineNum">    1687 </span>            :                   trInner=trOuter;
<span class="lineNum">    1688 </span>            :                   trOuter=&amp;dummy;
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :               }</span>
<span class="lineNum">    1690 </span>            :           }
<span class="lineNum">    1691 </span>            :       }
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :       innerSector = trInner-&gt;GetSector();</span>
<span class="lineNum">    1693 </span><span class="lineNoCov">          0 :       if ( innerSector&gt;=0 ) AliDebug(5,Form(&quot;Found inner Sector %02d at X %.2f&quot;, innerSector, trInner-&gt;GetInner()-&gt;GetX()));</span>
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :       outerSector = trOuter-&gt;GetSector();</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :       if ( outerSector&gt;=0 ) AliDebug(5,Form(&quot;Found outer Sector %02d at X %.2f&quot;, outerSector, trOuter-&gt;GetInner()-&gt;GetX()));</span>
<span class="lineNum">    1696 </span>            : 
<span class="lineNum">    1697 </span>            :       // array of clusters
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :       TClonesArray arrCl(&quot;AliTPCclusterMI&quot;,kMaxRow);</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :       arrCl.ExpandCreateFast(kMaxRow);</span>
<span class="lineNum">    1700 </span>            :       //=======================================//
<span class="lineNum">    1701 </span>            :       // fill fitters with cluster information //
<span class="lineNum">    1702 </span>            :       //=======================================//
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :       AliDebug(3,&quot;Filing Cluster Information&quot;);</span>
<span class="lineNum">    1704 </span>            : 
<span class="lineNum">    1705 </span>            :       //
<span class="lineNum">    1706 </span>            :       //
<span class="lineNum">    1707 </span>            : 
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :       for (Int_t irow=158;irow&gt;-1;--irow) {</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :           AliTPCclusterMI *c=track-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :           AliTPCclusterMI &amp;cl = (AliTPCclusterMI&amp;) (*arrCl[irow]);</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :           cl=dummyCl;</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 :           vecX[irow]   = 0;</span>
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :           vecClY[irow] = 0;</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :           vecClZ[irow] = 0;</span>
<span class="lineNum">    1715 </span>            :           Float_t meanY=0, sumY=0;
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :           for (Int_t drow=-1;drow&lt;=1;drow++) {</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :             if (irow+drow&lt;0) continue;</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :             if (irow+drow&gt;158) continue;</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :             AliTPCclusterMI *ccurrent=track-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 :             if (!ccurrent) continue;</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :             Int_t roc = static_cast&lt;Int_t&gt;(ccurrent-&gt;GetDetector());</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :             if ( roc!=innerSector &amp;&amp; roc!=outerSector ) continue;</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :             if (ccurrent-&gt;GetX()&lt;10) continue;</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :             if (ccurrent-&gt;GetY()==0) continue;</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :             meanY+=ccurrent-&gt;GetY();</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :             sumY++;</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 :           if (sumY&gt;0)  meanY/=sumY; </span>
<span class="lineNum">    1729 </span>            :          
<span class="lineNum">    1730 </span>            :           //
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :           vecSec[irow]=-1;</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :           if (!c) continue;</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :           Double_t pedgeY = c-&gt;GetX()*TMath::Tan(TMath::DegToRad()*(10))-TMath::Abs(meanY);</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :           Double_t pedgeX = TMath::Min((irow)*0.75, (kMaxRow-irow)*1.5);</span>
<span class="lineNum">    1735 </span>            :           
<span class="lineNum">    1736 </span>            :           //
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :           Int_t roc = static_cast&lt;Int_t&gt;(c-&gt;GetDetector());</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :           if ( roc!=innerSector &amp;&amp; roc!=outerSector ) continue;</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :           vecSec[irow]=roc;</span>
<span class="lineNum">    1740 </span>            :           //store clusters in clones array
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :           cl=*c;          </span>
<span class="lineNum">    1742 </span>            :           //
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :           if (c-&gt;GetMax()&lt;4)   continue;  // noise cluster?</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :           if (TMath::Abs(c-&gt;GetY())&lt;0.0001)   continue;  // noise cluster?</span>
<span class="lineNum">    1745 </span>            :           //cluster position
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :           vecX[irow]   = c-&gt;GetX();</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :           vecClY[irow] = c-&gt;GetY();</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :           vecClZ[irow] = c-&gt;GetZ();</span>
<span class="lineNum">    1749 </span>            :           //
<span class="lineNum">    1750 </span>            : //        Float_t gxyz[3];
<span class="lineNum">    1751 </span>            : //        c-&gt;GetGlobalXYZ(gxyz);
<span class="lineNum">    1752 </span>            : //        vecgX[irow]   = gxyz[0];
<span class="lineNum">    1753 </span>            : //        vecgY[irow]   = gxyz[1];
<span class="lineNum">    1754 </span>            : //        vecgZ[irow]   = gxyz[2];
<span class="lineNum">    1755 </span>            :           //
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :           Double_t x = vecX[irow]-133.4; //reference is between IROC and OROC</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :           Double_t y = vecClY[irow];</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :           Double_t z = vecClZ[irow];</span>
<span class="lineNum">    1759 </span>            :           //
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :           Double_t x2[2]={x,x*x};   //linear and parabolic parameters</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :           Double_t x4[4]={0,0,0,0}; //hyp4 parameters</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :           Double_t xIO[2]={0,x};    //common linear + offset IROC-OROC</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :           if ( roc == innerSector ) {</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :               x4[0]=1; //offset inner - outer sector</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :               x4[1]=x; //slope parameter inner sector</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :               xIO[0]=1;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :           } else {</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :               x4[2]=x; //slope parameter outer sector</span>
<span class="lineNum">    1769 </span>            :           }
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :           x4[3]=x*x;   //common parabolic shape</span>
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :           if (pedgeX &lt; fEdgeXcuts[icut]) continue;</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :           if (pedgeY &lt; fEdgeYcuts[icut]) continue;</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :           if (c-&gt;GetMax()&gt;900) continue;  // cluster in saturation          </span>
<span class="lineNum">    1774 </span>            :           //
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :           if ( roc==innerSector ){</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :               fy1I.AddPoint(x2,y);</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :               fz1I.AddPoint(x2,z);</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :               fy2I.AddPoint(x2,y);</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :               fz2I.AddPoint(x2,z);</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :               ++nclI;</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :               if (c-&gt;GetX()&lt;xinMin) xinMin=c-&gt;GetX();</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :               if (c-&gt;GetX()&gt;xinMax) xinMax=c-&gt;GetX();</span>
<span class="lineNum">    1783 </span>            : 
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :               msigmaYIn +=TMath::Sqrt(c-&gt;GetSigmaY2());</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :               mqratioIn +=c-&gt;GetMax()/c-&gt;GetQ();</span>
<span class="lineNum">    1786 </span>            : 
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :           if ( roc==outerSector ){</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :               fy1O.AddPoint(x2,y);</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :               fz1O.AddPoint(x2,z);</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :               fy2O.AddPoint(x2,y);</span>
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :               fz2O.AddPoint(x2,z);</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :               ++nclO;</span>
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :               if (c-&gt;GetX()&lt;xoutMin) xoutMin=c-&gt;GetX();</span>
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :               if (c-&gt;GetX()&gt;xoutMax) xoutMax=c-&gt;GetX();</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :               msigmaYOut +=TMath::Sqrt(c-&gt;GetSigmaY2());</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :               mqratioOut +=c-&gt;GetMax()/c-&gt;GetQ();</span>
<span class="lineNum">    1798 </span>            : 
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :           fy4.AddPoint(x4,y);</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :           fz4.AddPoint(x4,z);</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :           fy1IO.AddPoint(xIO,y);</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :           fz1IO.AddPoint(xIO,z);</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :       if (nclI&gt;0)  {</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :         msigmaYIn/=nclI;</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :         mqratioIn/=nclI;</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :       if (nclO&gt;0)  {</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :         msigmaYOut/=nclO;</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :         mqratioOut/=nclO;</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1813 </span>            :       //======================================//
<span class="lineNum">    1814 </span>            :       // Evaluate and retrieve fit parameters //
<span class="lineNum">    1815 </span>            :       //======================================//
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :       AliDebug(5,Form(&quot;Evaluating fits with inner (outer) Sec: %02d (%02d)&quot;,innerSector,outerSector));</span>
<span class="lineNum">    1817 </span>            :       //inner sector
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :       if (  (innerSector&gt;-1) &amp;&amp; (fy1I.GetNpoints()&gt;0) ){</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :           fy1I.Eval();</span>
<span class="lineNum">    1820 </span><span class="lineNoCov">          0 :           fz1I.Eval();</span>
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :           fy2I.Eval();</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :           fz2I.Eval();</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :           fy1I.GetParameters(vecy1resInner);</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :           fz1I.GetParameters(vecz1resInner);</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :           fy2I.GetParameters(vecy2resInner);</span>
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :           fz2I.GetParameters(vecz2resInner);</span>
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :           chi2I1y=fy1I.GetChisquare()/(fy1I.GetNpoints()-2);</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :           chi2I1z=fz1I.GetChisquare()/(fz1I.GetNpoints()-2);</span>
<span class="lineNum">    1829 </span><span class="lineNoCov">          0 :           chi2I2y=fy2I.GetChisquare()/(fy2I.GetNpoints()-3);</span>
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :           chi2I2z=fz2I.GetChisquare()/(fz2I.GetNpoints()-3);</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1832 </span>            :       //outer sector
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :       if (  (outerSector&gt;-1) &amp;&amp; (fy1O.GetNpoints()&gt;0) ){</span>
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :           fy1O.Eval();</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :           fz1O.Eval();</span>
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :           fy2O.Eval();</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :           fz2O.Eval();</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :           fy1O.GetParameters(vecy1resOuter);</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :           fz1O.GetParameters(vecz1resOuter);</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :           fy2O.GetParameters(vecy2resOuter);</span>
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :           fz2O.GetParameters(vecz2resOuter);</span>
<span class="lineNum">    1842 </span><span class="lineNoCov">          0 :           chi2O1y=fy1O.GetChisquare()/(fy1O.GetNpoints()-2);</span>
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :           chi2O1z=fz1O.GetChisquare()/(fz1O.GetNpoints()-2);</span>
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :           chi2O2y=fy2O.GetChisquare()/(fy2O.GetNpoints()-3);</span>
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :           chi2O2z=fz2O.GetChisquare()/(fz2O.GetNpoints()-3);</span>
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1847 </span>            :       //combined hyp4 fit
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :       if ( innerSector&gt;0 &amp;&amp; outerSector&gt;0 ){</span>
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :           if (fy4.GetNpoints()&gt;0) {</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :               fy4.Eval();</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :               fy4.GetParameters(vecy4res);</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :               chi2IOy=fy4.GetChisquare()/(fy4.GetNpoints()-5);</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1854 </span><span class="lineNoCov">          0 :           if (fz4.GetNpoints()&gt;0) {</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :               fz4.Eval();</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :               fz4.GetParameters(vecz4res);</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :               chi2IOz=fz4.GetChisquare()/(fz4.GetNpoints()-5);</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :           if (fy1IO.GetNpoints()&gt;0) {</span>
<span class="lineNum">    1860 </span><span class="lineNoCov">          0 :             fy1IO.Eval();</span>
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :             fy1IO.GetParameters(vecy1resIO);</span>
<span class="lineNum">    1862 </span><span class="lineNoCov">          0 :             chi2IO1y=fy1IO.GetChisquare()/(fy1IO.GetNpoints()-3);</span>
<span class="lineNum">    1863 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1864 </span><span class="lineNoCov">          0 :           if (fz1IO.GetNpoints()&gt;0) {</span>
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :             fz1IO.Eval();</span>
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :             fz1IO.GetParameters(vecz1resIO);</span>
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :             chi2IO1z=fz1IO.GetChisquare()/(fz1IO.GetNpoints()-3);</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1869 </span>            :       }
<span class="lineNum">    1870 </span>            :       //clear points
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :       fy4.ClearPoints();  fz4.ClearPoints();</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :       fy1I.ClearPoints(); fy1O.ClearPoints();</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :       fz1I.ClearPoints(); fz1O.ClearPoints();</span>
<span class="lineNum">    1874 </span><span class="lineNoCov">          0 :       fy2I.ClearPoints(); fy2O.ClearPoints();</span>
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :       fz2I.ClearPoints(); fz2O.ClearPoints();</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :       fy1IO.ClearPoints(); fz1IO.ClearPoints();</span>
<span class="lineNum">    1877 </span>            :       //==============================//
<span class="lineNum">    1878 </span>            :       // calculate tracklet positions //
<span class="lineNum">    1879 </span>            :       //==============================//
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :       AliDebug(4,&quot;Calculate tracklet positions&quot;);</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :       for (Int_t irow=158;irow&gt;-1;--irow) {</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :         isReject[irow]=0;</span>
<span class="lineNum">    1883 </span><span class="lineNoCov">          0 :          AliTPCclusterMI *c=track-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :          if ( vecSec[irow]!=innerSector &amp;&amp; vecSec[irow]!=outerSector ) { // no cluster in given sectors</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :            isReject[irow]+=1;</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :          }</span>
<span class="lineNum">    1887 </span>            : 
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :          if (!c) { //no cluster    </span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :            isReject[irow]+=2;</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :          }else{</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :            if (c-&gt;GetMax()&gt;kMax){   //saturation</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :              isReject[irow]+=4;</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :            }</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :            if ( vecSec[irow] == outerSector ) {   //extended shape</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :              if (c-&gt;GetMax()/c-&gt;GetQ()&gt; mqratioOut*kRatioCut)                isReject[irow]+=8;</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :              if (TMath::Sqrt(c-&gt;GetSigmaY2())&gt;msigmaYOut*kShapeCut)    isReject[irow]+=16;</span>
<span class="lineNum">    1897 </span>            :            }else{
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :              if (c-&gt;GetMax()/c-&gt;GetQ()&gt; mqratioIn*kRatioCut)                isReject[irow]+=8;</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :              if (TMath::Sqrt(c-&gt;GetSigmaY2())&gt;msigmaYIn*kShapeCut)    isReject[irow]+=16;</span>
<span class="lineNum">    1900 </span>            :            }       
<span class="lineNum">    1901 </span>            :          }
<span class="lineNum">    1902 </span>            : 
<span class="lineNum">    1903 </span>            : 
<span class="lineNum">    1904 </span>            : 
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :           if ( vecSec[irow]==-1 ) continue;  //no cluster info</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :           if ( vecSec[irow]!=innerSector &amp;&amp; vecSec[irow]!=outerSector ) continue;</span>
<span class="lineNum">    1907 </span>            :           tr=&amp;dummy;
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :           Double_t x=vecX[irow];</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :           Double_t xref=x-133.4;</span>
<span class="lineNum">    1910 </span>            :           //
<span class="lineNum">    1911 </span>            :           Double_t yoffInner=0;
<span class="lineNum">    1912 </span>            :           Double_t zoffInner=0;
<span class="lineNum">    1913 </span>            :           Double_t yoffInner1=0;
<span class="lineNum">    1914 </span>            :           Double_t zoffInner1=0;
<span class="lineNum">    1915 </span>            :           Double_t yslopeInner=0;
<span class="lineNum">    1916 </span>            :           Double_t yslopeOuter=0;
<span class="lineNum">    1917 </span>            :           Double_t zslopeInner=0;
<span class="lineNum">    1918 </span>            :           Double_t zslopeOuter=0;
<span class="lineNum">    1919 </span>            :           //positions of hyperplane fits
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 :           if ( vecSec[irow] == outerSector ) {</span>
<span class="lineNum">    1921 </span>            :               tr=trOuter;
<span class="lineNum">    1922 </span><span class="lineNoCov">          0 :               vecY1[irow]=vecy1resOuter[0]+vecy1resOuter[1]*xref;</span>
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :               vecZ1[irow]=vecz1resOuter[0]+vecz1resOuter[1]*xref;</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :               vecY2[irow]=vecy2resOuter[0]+vecy2resOuter[1]*xref+vecy2resOuter[2]*xref*xref;</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :               vecZ2[irow]=vecz2resOuter[0]+vecz2resOuter[1]*xref+vecz2resOuter[2]*xref*xref;</span>
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :               yslopeOuter=vecy4res[3];</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :               zslopeOuter=vecz4res[3];</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 :           } else {</span>
<span class="lineNum">    1929 </span>            :               tr=trInner;
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :               vecY1[irow]=vecy1resInner[0]+vecy1resInner[1]*xref;</span>
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :               vecZ1[irow]=vecz1resInner[0]+vecz1resInner[1]*xref;</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :               vecY2[irow]=vecy2resInner[0]+vecy2resInner[1]*xref+vecy2resInner[2]*xref*xref;</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :               vecZ2[irow]=vecz2resInner[0]+vecz2resInner[1]*xref+vecz2resInner[2]*xref*xref;</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :               yoffInner=vecy4res[1];</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :               zoffInner=vecz4res[1];</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :               yoffInner1=vecy1resIO[1];</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :               zoffInner1=vecz1resIO[1];</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :               yslopeInner=vecy4res[2];</span>
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 :               zslopeInner=vecz4res[2];</span>
<span class="lineNum">    1940 </span>            :           }
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :           vecY1IO[irow]=vecy1resIO[0]+yoffInner1+vecy1resIO[2]*xref;</span>
<span class="lineNum">    1942 </span><span class="lineNoCov">          0 :           vecZ1IO[irow]=vecz1resIO[0]+zoffInner1+vecz1resIO[2]*xref;</span>
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :           vecY4[irow]=vecy4res[0]+yoffInner+yslopeInner*xref+yslopeOuter*xref+vecy4res[4]*xref*xref;</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 :           vecZ4[irow]=vecz4res[0]+zoffInner+zslopeInner*xref+zslopeOuter*xref+vecz4res[4]*xref*xref;</span>
<span class="lineNum">    1945 </span>            :           //positions of kalman fits
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :           Double_t gxyz[3],xyz[3];</span>
<span class="lineNum">    1947 </span>            :           AliExternalTrackParam *param = 0x0;
<span class="lineNum">    1948 </span>            :           //
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :           param=tr-&gt;GetInner();</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :           if (param){</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :               param-&gt;GetXYZ(gxyz);</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :               Float_t bz = AliTracker::GetBz(gxyz);</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :               param-&gt;GetYAt(x, bz, xyz[1]);</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :               param-&gt;GetZAt(x, bz, xyz[2]);</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :               vecYkalman[irow]=xyz[1];</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :               vecZkalman[irow]=xyz[2];</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1958 </span>            :           //
<span class="lineNum">    1959 </span>            :           //
<span class="lineNum">    1960 </span>            :           //
<span class="lineNum">    1961 </span>            :          
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1963 </span>            :       //=====================================================================//
<span class="lineNum">    1964 </span>            :       // write results from the different tracklet fits with debug streamers //
<span class="lineNum">    1965 </span>            :       //=====================================================================//
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :       if (fStreamLevel&gt;4){</span>
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :           TTreeSRedirector *cstream = GetDebugStreamer();</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :           if (cstream){</span>
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :             Float_t dedx = track-&gt;GetdEdx();</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :             (*cstream)&lt;&lt;&quot;FitModels&quot;&lt;&lt;</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :               &quot;run=&quot;&lt;&lt;fRun&lt;&lt;              //  run number</span>
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :               &quot;event=&quot;&lt;&lt;fEvent&lt;&lt;          //  event number</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :               &quot;time=&quot;&lt;&lt;fTime&lt;&lt;            //  time stamp of event</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :               &quot;trigger=&quot;&lt;&lt;fTrigger&lt;&lt;      //  trigger</span>
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :               &quot;mag=&quot;&lt;&lt;fMagF&lt;&lt;             //  magnetic field            </span>
<span class="lineNum">    1976 </span>            :               //
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :               &quot;cutNr=&quot;      &lt;&lt; icut &lt;&lt;</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :               &quot;edgeCutX=&quot;   &lt;&lt; edgeCutX &lt;&lt;</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :               &quot;edgeCutY=&quot;   &lt;&lt; edgeCutY &lt;&lt;</span>
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :               &quot;nclCut=&quot;     &lt;&lt; nclCut &lt;&lt;</span>
<span class="lineNum">    1981 </span><span class="lineNoCov">          0 :               &quot;innerSector=&quot;&lt;&lt; innerSector &lt;&lt;</span>
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :               &quot;outerSector=&quot;&lt;&lt; outerSector &lt;&lt;</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :               &quot;dEdx=&quot;       &lt;&lt; dedx &lt;&lt;</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">          0 :               &quot;LTr.=&quot;       &lt;&lt; ltrp &lt;&lt;</span>
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 :               &quot;Tr.=&quot;        &lt;&lt; extparam &lt;&lt;</span>
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :               &quot;yPol1In.=&quot;   &lt;&lt; &amp;vecy1resInner &lt;&lt;</span>
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :               &quot;zPol1In.=&quot;   &lt;&lt; &amp;vecz1resInner &lt;&lt;</span>
<span class="lineNum">    1988 </span><span class="lineNoCov">          0 :               &quot;yPol1InOut.=&quot;&lt;&lt; &amp;vecy1resIO &lt;&lt;</span>
<span class="lineNum">    1989 </span><span class="lineNoCov">          0 :               &quot;zPol1InOut.=&quot;&lt;&lt; &amp;vecz1resIO &lt;&lt;</span>
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :               &quot;yPol2In.=&quot;   &lt;&lt; &amp;vecy2resInner &lt;&lt;</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :               &quot;zPol2In.=&quot;   &lt;&lt; &amp;vecz2resInner &lt;&lt;</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :               &quot;yPol1Out.=&quot;  &lt;&lt; &amp;vecy1resOuter &lt;&lt;</span>
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :               &quot;zPol1Out.=&quot;  &lt;&lt; &amp;vecz1resOuter &lt;&lt;</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :               &quot;yPol2Out.=&quot;  &lt;&lt; &amp;vecy2resOuter &lt;&lt;</span>
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :               &quot;zPol2Out.=&quot;  &lt;&lt; &amp;vecz2resOuter &lt;&lt;</span>
<span class="lineNum">    1996 </span><span class="lineNoCov">          0 :               &quot;yInOut.=&quot;    &lt;&lt; &amp;vecy4res &lt;&lt;</span>
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :               &quot;zInOut.=&quot;    &lt;&lt; &amp;vecz4res &lt;&lt;</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :               &quot;chi2y1In=&quot;   &lt;&lt; chi2I1y &lt;&lt;</span>
<span class="lineNum">    1999 </span><span class="lineNoCov">          0 :               &quot;chi2z1In=&quot;   &lt;&lt; chi2I1z &lt;&lt;</span>
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :               &quot;chi2y1InOut=&quot;&lt;&lt; chi2IO1y &lt;&lt;</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :               &quot;chi2z1InOut=&quot;&lt;&lt; chi2IO1z &lt;&lt;</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :               &quot;chi2y1Out=&quot;  &lt;&lt; chi2O1y &lt;&lt;</span>
<span class="lineNum">    2003 </span><span class="lineNoCov">          0 :               &quot;chi2z1Out=&quot;  &lt;&lt; chi2O1z &lt;&lt;</span>
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 :               &quot;chi2y2In=&quot;   &lt;&lt; chi2I2y &lt;&lt;</span>
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :               &quot;chi2z2In=&quot;   &lt;&lt; chi2I2z &lt;&lt;</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :               &quot;chi2y2Out=&quot;  &lt;&lt; chi2O2y &lt;&lt;</span>
<span class="lineNum">    2007 </span><span class="lineNoCov">          0 :               &quot;chi2z2Out=&quot;  &lt;&lt; chi2O2z &lt;&lt;</span>
<span class="lineNum">    2008 </span><span class="lineNoCov">          0 :               &quot;chi2yInOut=&quot; &lt;&lt; chi2IOy &lt;&lt;</span>
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :               &quot;chi2zInOut=&quot; &lt;&lt; chi2IOz &lt;&lt;</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :               &quot;trletIn.=&quot;   &lt;&lt; trInner &lt;&lt;</span>
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 :               &quot;trletOut.=&quot;  &lt;&lt; trOuter &lt;&lt;</span>
<span class="lineNum">    2012 </span><span class="lineNoCov">          0 :               &quot;nclI=&quot;       &lt;&lt; nclI &lt;&lt;</span>
<span class="lineNum">    2013 </span><span class="lineNoCov">          0 :               &quot;nclO=&quot;       &lt;&lt; nclO &lt;&lt;</span>
<span class="lineNum">    2014 </span><span class="lineNoCov">          0 :               &quot;xinMin=&quot;     &lt;&lt; xinMin&lt;&lt;</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :               &quot;xinMax=&quot;     &lt;&lt; xinMax&lt;&lt;</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :               &quot;xoutMin=&quot;    &lt;&lt; xoutMin&lt;&lt;</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :               &quot;xoutMax=&quot;     &lt;&lt; xoutMax&lt;&lt;</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :               &quot;msigmaYIn=&quot; &lt;&lt;msigmaYIn&lt;&lt;</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :               &quot;msigmaYOut=&quot; &lt;&lt;msigmaYOut&lt;&lt;</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :               &quot;mqratioIn=&quot; &lt;&lt;mqratioIn&lt;&lt;</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :               &quot;mqratioOut=&quot; &lt;&lt;  mqratioOut      &lt;&lt;</span>
<span class="lineNum">    2022 </span>            :               &quot;\n&quot;;
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2025 </span>            : 
<span class="lineNum">    2026 </span>            :       // wirte residuals information
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :       if (fStreamLevel&gt;5){</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :           TTreeSRedirector *cstream = GetDebugStreamer();</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :           if (cstream){</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 :             Float_t dedx = track-&gt;GetdEdx();</span>
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :             (*cstream)&lt;&lt;&quot;Residuals&quot;&lt;&lt;</span>
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :               &quot;run=&quot;&lt;&lt;fRun&lt;&lt;              //  run number</span>
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :               &quot;event=&quot;&lt;&lt;fEvent&lt;&lt;          //  event number</span>
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :               &quot;time=&quot;&lt;&lt;fTime&lt;&lt;            //  time stamp of event</span>
<span class="lineNum">    2035 </span><span class="lineNoCov">          0 :               &quot;trigger=&quot;&lt;&lt;fTrigger&lt;&lt;      //  trigger</span>
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :               &quot;mag=&quot;&lt;&lt;fMagF&lt;&lt;             //  magnetic field            </span>
<span class="lineNum">    2037 </span>            :               //
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :               &quot;cutNr=&quot;      &lt;&lt; icut &lt;&lt;</span>
<span class="lineNum">    2039 </span><span class="lineNoCov">          0 :               &quot;edgeCutX=&quot;   &lt;&lt; edgeCutX &lt;&lt;</span>
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :               &quot;edgeCutY=&quot;   &lt;&lt; edgeCutY &lt;&lt;</span>
<span class="lineNum">    2041 </span><span class="lineNoCov">          0 :               &quot;nclCut=&quot;     &lt;&lt; nclCut   &lt;&lt;</span>
<span class="lineNum">    2042 </span><span class="lineNoCov">          0 :               &quot;LTr.=&quot;       &lt;&lt; ltrp &lt;&lt;</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">          0 :               &quot;Tr.=&quot;        &lt;&lt; extparam&lt;&lt;</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">          0 :               &quot;dEdx=&quot;       &lt;&lt; dedx &lt;&lt;</span>
<span class="lineNum">    2045 </span><span class="lineNoCov">          0 :               &quot;Cl.=&quot;        &lt;&lt; &amp;arrCl &lt;&lt;</span>
<span class="lineNum">    2046 </span><span class="lineNoCov">          0 :               &quot;vX.=&quot;        &lt;&lt; &amp;vecgX&lt;&lt;   // global x</span>
<span class="lineNum">    2047 </span><span class="lineNoCov">          0 :               &quot;vY.=&quot;        &lt;&lt; &amp;vecgY&lt;&lt;   // global y</span>
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 :               &quot;vZ.=&quot;        &lt;&lt; &amp;vecgZ&lt;&lt;   // global z</span>
<span class="lineNum">    2049 </span><span class="lineNoCov">          0 :               &quot;TrX.=&quot;       &lt;&lt; &amp;vecX &lt;&lt;</span>
<span class="lineNum">    2050 </span><span class="lineNoCov">          0 :               &quot;TrYpol1.=&quot;   &lt;&lt; &amp;vecY1 &lt;&lt;</span>
<span class="lineNum">    2051 </span><span class="lineNoCov">          0 :               &quot;TrZpol1.=&quot;   &lt;&lt; &amp;vecZ1 &lt;&lt;</span>
<span class="lineNum">    2052 </span><span class="lineNoCov">          0 :               &quot;TrYpol2.=&quot;   &lt;&lt; &amp;vecY2 &lt;&lt;</span>
<span class="lineNum">    2053 </span><span class="lineNoCov">          0 :               &quot;TrZpol2.=&quot;   &lt;&lt; &amp;vecZ2 &lt;&lt;</span>
<span class="lineNum">    2054 </span><span class="lineNoCov">          0 :               &quot;TrYpol1InOut.=&quot;&lt;&lt; &amp;vecY1IO &lt;&lt;</span>
<span class="lineNum">    2055 </span><span class="lineNoCov">          0 :               &quot;TrZpol1InOut.=&quot;&lt;&lt; &amp;vecZ1IO &lt;&lt;</span>
<span class="lineNum">    2056 </span><span class="lineNoCov">          0 :               &quot;TrYInOut.=&quot;  &lt;&lt; &amp;vecY4 &lt;&lt;</span>
<span class="lineNum">    2057 </span><span class="lineNoCov">          0 :               &quot;TrZInOut.=&quot;  &lt;&lt; &amp;vecZ4 &lt;&lt;</span>
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :               &quot;ClY.=&quot;       &lt;&lt; &amp;vecClY &lt;&lt;</span>
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :               &quot;ClZ.=&quot;       &lt;&lt; &amp;vecClZ &lt;&lt;</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">          0 :               &quot;isReject.=&quot;  &lt;&lt; &amp;isReject&lt;&lt;</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :               &quot;sec.=&quot;       &lt;&lt; &amp;vecSec &lt;&lt;</span>
<span class="lineNum">    2062 </span><span class="lineNoCov">          0 :               &quot;nclI=&quot;       &lt;&lt; nclI &lt;&lt;</span>
<span class="lineNum">    2063 </span><span class="lineNoCov">          0 :               &quot;nclO=&quot;       &lt;&lt; nclO &lt;&lt;</span>
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :               &quot;xinMin=&quot;     &lt;&lt; xinMin&lt;&lt;</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :               &quot;xinMax=&quot;     &lt;&lt; xinMax&lt;&lt;</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :               &quot;xoutMin=&quot;    &lt;&lt; xoutMin&lt;&lt;</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :               &quot;xoutMax=&quot;     &lt;&lt; xoutMax&lt;&lt;</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :               &quot;msigmaYIn=&quot; &lt;&lt;msigmaYIn&lt;&lt;</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :               &quot;msigmaYOut=&quot; &lt;&lt;msigmaYOut&lt;&lt;</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :               &quot;mqratioIn=&quot; &lt;&lt;mqratioIn&lt;&lt;</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :               &quot;mqratioOut=&quot; &lt;&lt;  mqratioOut      &lt;&lt;</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :               &quot;yInOut.=&quot;    &lt;&lt; &amp;vecy4res &lt;&lt;</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :               &quot;zInOut.=&quot;    &lt;&lt; &amp;vecz4res &lt;&lt;</span>
<span class="lineNum">    2074 </span>            :               //chi2s
<span class="lineNum">    2075 </span><span class="lineNoCov">          0 :               &quot;chi2y1In=&quot;   &lt;&lt; chi2I1y &lt;&lt;    //</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :               &quot;chi2z1In=&quot;   &lt;&lt; chi2I1z &lt;&lt;</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :               &quot;chi2y1Out=&quot;  &lt;&lt; chi2O1y &lt;&lt;</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :               &quot;chi2z1Out=&quot;  &lt;&lt; chi2O1z &lt;&lt;</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :               &quot;chi2y1InOut=&quot;&lt;&lt; chi2IO1y &lt;&lt;</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :               &quot;chi2z1InOut=&quot;&lt;&lt; chi2IO1z &lt;&lt;</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :               &quot;chi2y2In=&quot;   &lt;&lt; chi2I2y &lt;&lt;</span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :               &quot;chi2z2In=&quot;   &lt;&lt; chi2I2z &lt;&lt;</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :               &quot;chi2y2Out=&quot;  &lt;&lt; chi2O2y &lt;&lt;</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :               &quot;chi2z2Out=&quot;  &lt;&lt; chi2O2z &lt;&lt;</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :               &quot;chi2yInOut=&quot; &lt;&lt; chi2IOy &lt;&lt;</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :               &quot;chi2zInOut=&quot; &lt;&lt; chi2IOz &lt;&lt;</span>
<span class="lineNum">    2087 </span>            :               // fit parameters
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 :               &quot;yPol1In.=&quot;   &lt;&lt; &amp;vecy1resInner &lt;&lt;</span>
<span class="lineNum">    2089 </span><span class="lineNoCov">          0 :               &quot;zPol1In.=&quot;   &lt;&lt; &amp;vecz1resInner &lt;&lt;</span>
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :               &quot;yPol2In.=&quot;   &lt;&lt; &amp;vecy2resInner &lt;&lt;</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :               &quot;zPol2In.=&quot;   &lt;&lt; &amp;vecz2resInner &lt;&lt;</span>
<span class="lineNum">    2092 </span><span class="lineNoCov">          0 :               &quot;yPol1Out.=&quot;  &lt;&lt; &amp;vecy1resOuter &lt;&lt;</span>
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :               &quot;zPol1Out.=&quot;  &lt;&lt; &amp;vecz1resOuter &lt;&lt;</span>
<span class="lineNum">    2094 </span><span class="lineNoCov">          0 :               &quot;yPol1InOut.=&quot;&lt;&lt; &amp;vecy1resIO &lt;&lt;</span>
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :               &quot;zPol1InOut.=&quot;&lt;&lt; &amp;vecz1resIO &lt;&lt;</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :               &quot;yPol2Out.=&quot;  &lt;&lt; &amp;vecy2resOuter &lt;&lt;</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :               &quot;zPol2Out.=&quot;  &lt;&lt; &amp;vecz2resOuter &lt;&lt;</span>
<span class="lineNum">    2098 </span>            : 
<span class="lineNum">    2099 </span>            :               &quot;\n&quot;;
<span class="lineNum">    2100 </span>            : 
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2102 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2103 </span>            :       //==========================//
<span class="lineNum">    2104 </span>            :       // Fill Residual Histograms //
<span class="lineNum">    2105 </span>            :       //==========================//
<span class="lineNum">    2106 </span><span class="lineNoCov">          0 :       if (!fHisNclIn) UpdateFitHistos(); </span>
<span class="lineNum">    2107 </span>            : 
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :       TH2F *profy = (TH2F*)fDeltaYres.UncheckedAt(id);</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">          0 :       TH2F *profz = (TH2F*)fDeltaZres.UncheckedAt(id);</span>
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :       TH2F *profy2 = (TH2F*)fDeltaYres2.UncheckedAt(id);</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :       TH2F *profz2 = (TH2F*)fDeltaZres2.UncheckedAt(id);</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :       TH2F *profyabs = (TH2F*)fDeltaYresAbs.UncheckedAt(id);</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :       TH2F *profzabs = (TH2F*)fDeltaZresAbs.UncheckedAt(id);</span>
<span class="lineNum">    2114 </span>            :       //      TH2F *profy3 = (TH2F*)fDeltaYres3.UncheckedAt(id);
<span class="lineNum">    2115 </span>            :       //TH2F *profz3 = (TH2F*)fDeltaZres3.UncheckedAt(id);
<span class="lineNum">    2116 </span>            :       //
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :       for (Int_t irow=158;irow&gt;-1;--irow) {</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :         if (vecSec[irow]==-1)continue; // no cluster info</span>
<span class="lineNum">    2119 </span><span class="lineNoCov">          0 :         if (isReject[irow]&gt;0.5) continue;  // </span>
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :         Double_t ycl  = vecClY[irow];</span>
<span class="lineNum">    2121 </span><span class="lineNoCov">          0 :         Double_t yfit = vecY1[irow];</span>
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :         Double_t yfit2 = vecY2[irow];</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :         Double_t x    = vecX[irow];</span>
<span class="lineNum">    2124 </span>            :         Double_t yabsbeam = -1000;
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :         if(vecSec[irow]==outerSector &amp;&amp; outerSector==fBeamSectorOuter[id])</span>
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :           yabsbeam = fBeamSlopeYOuter[id]*x + fBeamOffsetYOuter[id];</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :         else if(innerSector==fBeamSectorInner[id])</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :           yabsbeam = fBeamSlopeYInner[id]*x + fBeamOffsetYInner[id];</span>
<span class="lineNum">    2129 </span>            : 
<span class="lineNum">    2130 </span>            :         //      Double_t yfit3 = vecY2[irow];
<span class="lineNum">    2131 </span><span class="lineNoCov">          0 :         Double_t zcl  = vecClZ[irow];</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :         Double_t zfit = vecZ1[irow];</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :         Double_t zfit2 = vecZ2[irow];</span>
<span class="lineNum">    2134 </span>            :         //Double_t zfit3 = vecZ2[irow];
<span class="lineNum">    2135 </span>            : 
<span class="lineNum">    2136 </span>            :         // dz abs 
<span class="lineNum">    2137 </span>            :         // The expressions for zcorrected has been obtained by
<span class="lineNum">    2138 </span>            :         // inverting the fits in the FitDriftV() method (ignoring the
<span class="lineNum">    2139 </span>            :         // global y dependence for now):
<span class="lineNum">    2140 </span>            :         // A side:
<span class="lineNum">    2141 </span>            :         // 250 - zmeasured = [0] + [1]*(250 - zreal) + .... (yglobal)
<span class="lineNum">    2142 </span>            :         // =&gt;
<span class="lineNum">    2143 </span>            :         // zreal = (zmeasured + [0] - (1-[1])*250.0)/[1]
<span class="lineNum">    2144 </span>            :         // 
<span class="lineNum">    2145 </span>            :         // C side:
<span class="lineNum">    2146 </span>            :         // 250 + zmeasured  = [0] + [1]*(250+zreal) + .... (yglobal)
<span class="lineNum">    2147 </span>            :         // =&gt;
<span class="lineNum">    2148 </span>            :         // zreal = (zmeasured - [0] + (1 - [1])*250.0)/[1]
<span class="lineNum">    2149 </span>            : 
<span class="lineNum">    2150 </span>            :         Double_t dzabs = -1000;
<span class="lineNum">    2151 </span>            :         Double_t zcorrected = -1000;
<span class="lineNum">    2152 </span><span class="lineNoCov">          0 :         if (ltrp-&gt;GetSide()==0){</span>
<span class="lineNum">    2153 </span><span class="lineNoCov">          0 :           if ((*fFitAside)[1]&gt;0. || fUseFixedDriftV) { </span>
<span class="lineNum">    2154 </span>            :             // ignore global y dependence for now
<span class="lineNum">    2155 </span>            :             zcorrected = 0;         
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :             if(!fUseFixedDriftV) </span>
<span class="lineNum">    2157 </span><span class="lineNoCov">          0 :               zcorrected = (zcl + (*fFitAside)[0] - </span>
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :                             (1.0-(*fFitAside)[1])*250.0)/(*fFitAside)[1];</span>
<span class="lineNum">    2159 </span>            :             else
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :               zcorrected = (zcl + fFixedFitAside0 - </span>
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :                             (1.0-fFixedFitAside1)*250.0)/fFixedFitAside1;</span>
<span class="lineNum">    2162 </span>            :             //      zcorrected = zcl;
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :             if(vecSec[irow]==outerSector &amp;&amp; outerSector==fBeamSectorOuter[id])</span>
<span class="lineNum">    2164 </span><span class="lineNoCov">          0 :               dzabs = zcorrected -fBeamSlopeZOuter[id]*x -fBeamOffsetZOuter[id];</span>
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :             else if(innerSector==fBeamSectorInner[id])</span>
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :               dzabs = zcorrected -fBeamSlopeZInner[id]*x -fBeamOffsetZInner[id];</span>
<span class="lineNum">    2167 </span>            :           }
<span class="lineNum">    2168 </span>            :         } else {
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :           if ((*fFitCside)[1]&gt;0. || fUseFixedDriftV) {</span>
<span class="lineNum">    2170 </span>            :             
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 :             if(!fUseFixedDriftV) </span>
<span class="lineNum">    2172 </span><span class="lineNoCov">          0 :               zcorrected = (zcl - (*fFitCside)[0] + </span>
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :                             (1.0-(*fFitCside)[1])*250.0)/(*fFitCside)[1];</span>
<span class="lineNum">    2174 </span>            :             else
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :               zcorrected = (zcl - fFixedFitCside0 + </span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :                             (1.0-fFixedFitCside1)*250.0)/fFixedFitCside1;</span>
<span class="lineNum">    2177 </span>            :             
<span class="lineNum">    2178 </span>            :             //      zcorrected = zcl;
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :             if(vecSec[irow]==outerSector &amp;&amp; outerSector==fBeamSectorOuter[id])</span>
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :               dzabs = zcorrected -fBeamSlopeZOuter[id]*x -fBeamOffsetZOuter[id];</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :             else if(innerSector==fBeamSectorInner[id])</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :               dzabs = zcorrected -fBeamSlopeZInner[id]*x -fBeamOffsetZInner[id];</span>
<span class="lineNum">    2183 </span>            :           }
<span class="lineNum">    2184 </span>            :         }
<span class="lineNum">    2185 </span>            :         
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :         if (TMath::Abs(yfit-ycl)&lt;2&amp;&amp;TMath::Abs(zfit-zcl)&lt;2){</span>
<span class="lineNum">    2187 </span><span class="lineNoCov">          0 :           if (profy){       </span>
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :               profy-&gt;Fill(irow,ycl-yfit);</span>
<span class="lineNum">    2189 </span><span class="lineNoCov">          0 :               profy2-&gt;Fill(irow,ycl-yfit2);</span>
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :               if(yabsbeam&lt;-100) {</span>
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :                 fHisYAbsErrors-&gt;Fill(id);</span>
<span class="lineNum">    2192 </span>            :                 //              profyabs-&gt;Fill(irow,-0.99);
<span class="lineNum">    2193 </span>            :               } else
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                 profyabs-&gt;Fill(irow,ycl-yabsbeam);</span>
<span class="lineNum">    2195 </span>            : 
<span class="lineNum">    2196 </span>            :               //              profy3-&gt;Fill(irow,ycl-yfit3);
<span class="lineNum">    2197 </span>            :           }
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :           if (profz) {</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :               profz-&gt;Fill(irow,zcl-zfit);</span>
<span class="lineNum">    2200 </span><span class="lineNoCov">          0 :               profz2-&gt;Fill(irow,zcl-zfit2);</span>
<span class="lineNum">    2201 </span>            :               //profz3-&gt;Fill(irow,zcl-zfit3);
<span class="lineNum">    2202 </span><span class="lineNoCov">          0 :               if(dzabs&lt;-100) {</span>
<span class="lineNum">    2203 </span>            : 
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :                 fHisZAbsErrors-&gt;Fill(id);</span>
<span class="lineNum">    2205 </span>            :               }else
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :                 profzabs-&gt;Fill(irow,dzabs);</span>
<span class="lineNum">    2207 </span>            :           }
<span class="lineNum">    2208 </span>            :         }
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2210 </span>            :       //
<span class="lineNum">    2211 </span>            :       //
<span class="lineNum">    2212 </span>            :       // Fill laser fit histograms
<span class="lineNum">    2213 </span>            :       //
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :       Float_t dedx = track-&gt;GetdEdx();</span>
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :       if (nclI&gt;20&amp;&amp;nclO&gt;20){</span>
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :         fHisNclIn-&gt;Fill(id,nclI);      //-&gt;Number of clusters inner</span>
<span class="lineNum">    2217 </span><span class="lineNoCov">          0 :         fHisNclOut-&gt;Fill(id,nclO);     //-&gt;Number of clusters outer</span>
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :         fHisNclIO-&gt;Fill(id,nclI+nclO);      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    2219 </span>            :         //
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :         fHisLclIn-&gt;Fill(id,xinMax-xinMin);        //-&gt;Level arm inner</span>
<span class="lineNum">    2221 </span><span class="lineNoCov">          0 :         fHisLclOut-&gt;Fill(id,xoutMax-xoutMin);     //-&gt;Level arm outer</span>
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :         fHisLclIO-&gt;Fill(id,xoutMax-xinMin);       //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    2223 </span>            :         //
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :         fHisdEdx-&gt;Fill(id,TMath::Sqrt(TMath::Abs(dedx)));</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :         fHisdZfit-&gt;Fill(id,fFitZ[id]);</span>
<span class="lineNum">    2226 </span>            :         // 
<span class="lineNum">    2227 </span>            :         //
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :         fHisChi2YIn1-&gt;Fill(id,TMath::Sqrt(chi2I1y));      //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :         fHisChi2YOut1-&gt;Fill(id,TMath::Sqrt(chi2O1y));     //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :         fHisChi2YIn2-&gt;Fill(id,TMath::Sqrt(chi2I2y));      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :         fHisChi2YOut2-&gt;Fill(id,TMath::Sqrt(chi2O2y));     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2232 </span><span class="lineNoCov">          0 :         fHisChi2YIO1-&gt;Fill(id,TMath::Sqrt(chi2IOy));      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">    2233 </span>            :         
<span class="lineNum">    2234 </span>            :         
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :         fHisChi2ZIn1-&gt;Fill(id,TMath::Sqrt(chi2I1z));      //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :         fHisChi2ZOut1-&gt;Fill(id,TMath::Sqrt(chi2O1z));     //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :         fHisChi2ZIn2-&gt;Fill(id,TMath::Sqrt(chi2O2y));      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :         fHisChi2ZOut2-&gt;Fill(id,TMath::Sqrt(chi2O2z));     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         fHisChi2ZIO1-&gt;Fill(id,TMath::Sqrt(chi2IOz));      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">    2240 </span>            :         //
<span class="lineNum">    2241 </span>            :         //
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :         fHisPy1vP0-&gt;Fill(id,vecy1resOuter[0]-vecy1resInner[0]);     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :         fHisPy2vP0-&gt;Fill(id,vecy2resOuter[0]-vecy2resInner[0]);     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">    2244 </span><span class="lineNoCov">          0 :         fHisPy3vP0-&gt;Fill(id,vecy4res[1]);                           //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">    2245 </span>            :         //
<span class="lineNum">    2246 </span><span class="lineNoCov">          0 :         fHisPy1vP1-&gt;Fill(id,vecy1resOuter[1]-vecy1resInner[1]);     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :         fHisPy2vP1-&gt;Fill(id,vecy2resOuter[1]-vecy2resInner[1]);     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :         fHisPy3vP1-&gt;Fill(id,vecy4res[3]-vecy4res[2]);               //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">    2249 </span>            :         //
<span class="lineNum">    2250 </span><span class="lineNoCov">          0 :         fHisPy3vP2IO-&gt;Fill(id,vecy4res[4]);        //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :         fHisPz1vP0-&gt;Fill(id,vecz1resOuter[0]-vecz1resInner[0]);     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :         fHisPz2vP0-&gt;Fill(id,vecz2resOuter[0]-vecz2resInner[0]);     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 :         fHisPz3vP0-&gt;Fill(id,vecz4res[1]);                           //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">    2254 </span>            :         //
<span class="lineNum">    2255 </span><span class="lineNoCov">          0 :         fHisPz1vP1-&gt;Fill(id,vecz1resOuter[1]-vecz1resInner[1]);     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">    2256 </span><span class="lineNoCov">          0 :         fHisPz2vP1-&gt;Fill(id,vecz2resOuter[1]-vecz2resInner[1]);     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 :         fHisPz3vP1-&gt;Fill(id,vecz4res[3]-vecz4res[2]);               //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :         fHisPz3vP2IO-&gt;Fill(id,vecz4res[4]);        //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    2259 </span>            :       }
<span class="lineNum">    2260 </span><span class="lineNoCov">          0 :       if(nclI&gt;20){</span>
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :         fHisPy2vP2In-&gt;Fill(id,vecy2resInner[2]);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    2262 </span><span class="lineNoCov">          0 :         fHisPz2vP2In-&gt;Fill(id,vecz2resInner[2]);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    2263 </span>            :       }
<span class="lineNum">    2264 </span>            :       //
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :       if (nclO&gt;20){</span>
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :         fHisPz2vP2Out-&gt;Fill(id,vecz2resOuter[2]);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    2267 </span><span class="lineNoCov">          0 :         fHisPy2vP2Out-&gt;Fill(id,vecy2resOuter[2]);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    2268 </span>            :       }
<span class="lineNum">    2269 </span>            :       
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    2271 </span>            :   //
<span class="lineNum">    2272 </span>            :   // Fill raw THnSparses
<span class="lineNum">    2273 </span>            :   //
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :   for (Int_t irow=0;irow&lt;kMaxRow;irow++) {</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :     AliTPCclusterMI *c=track-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :     if (!c) continue;</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :     if (c-&gt;GetMax()&gt;800) continue; // saturation cut</span>
<span class="lineNum">    2278 </span>            :     //if (TMath::Sqrt(TMath::Abs(c-&gt;GetSigmaY2()))&gt;1) continue; // saturation cut
<span class="lineNum">    2279 </span>            :     //
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :     Double_t deltaY=c-&gt;GetY()-(*ltrp-&gt;GetVecLY())[irow];</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :     Double_t deltaZ=c-&gt;GetZ()-(*ltrp-&gt;GetVecLZ())[irow];</span>
<span class="lineNum">    2282 </span>            :     //TString axisName[6]={&quot;Delta&quot;,&quot;bin&quot;, &quot;rms shape&quot;, &quot;Q&quot;, &quot;row&quot;,&quot;trackID&quot;}
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :     Double_t xyz[6]={0, 0, 0,TMath::Sqrt(c-&gt;GetMax()), static_cast&lt;Double_t&gt;(irow), static_cast&lt;Double_t&gt;(id)};</span>
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :     xyz[0]=deltaY;</span>
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :     xyz[1]=c-&gt;GetPad();</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :     xyz[2]=TMath::Sqrt(TMath::Abs(c-&gt;GetSigmaY2()));</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :     fHisLaserPad-&gt;Fill(xyz);</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :     xyz[0]=deltaZ;</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :     xyz[1]=c-&gt;GetTimeBin();</span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :     xyz[2]=TMath::Sqrt(TMath::Abs(c-&gt;GetSigmaZ2()));</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :     fHisLaserTime-&gt;Fill(xyz);</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2294 </span>            : 
<a name="2295"><span class="lineNum">    2295 </span>            : </a>
<span class="lineNum">    2296 </span>            : 
<span class="lineNum">    2297 </span>            : void AliTPCcalibLaser::DumpMeanInfo(Int_t run){
<span class="lineNum">    2298 </span>            :   //
<span class="lineNum">    2299 </span>            :   //  Dump information about laser beams
<span class="lineNum">    2300 </span>            :   //  isOK variable indicates usability of the beam  
<span class="lineNum">    2301 </span>            :   //  Beam is not usable if:
<span class="lineNum">    2302 </span>            :   //     a.  No entries in range (krmsCut0)
<span class="lineNum">    2303 </span>            :   //     b.  Big sperad          (krmscut1)
<span class="lineNum">    2304 </span>            :   //     c.  RMSto fit sigma bigger then (kmultiCut)
<span class="lineNum">    2305 </span>            :   //     d.  Too big angular spread 
<span class="lineNum">    2306 </span>            :   //  
<span class="lineNum">    2307 </span>            : 
<span class="lineNum">    2308 </span>            :   const Float_t krmsCut0=0.001;
<span class="lineNum">    2309 </span>            :   const Float_t krmsCut1=0.16;
<span class="lineNum">    2310 </span>            :   const Float_t kmultiCut=2;
<span class="lineNum">    2311 </span>            :   const Float_t kcutP0=0.002;
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :   AliMagF* magF=  dynamic_cast&lt;AliMagF*&gt; (TGeoGlobalMagField::Instance()-&gt;GetField());</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :   Double_t xyz[3]={90,0,10};         // tmp. global position </span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :   Double_t bxyz[3]={90,0,10};        // tmp. mag field  integral - cylindrical</span>
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :   Double_t bgxyz[3]={90,0,10};       // tmp. mag field  integral - local</span>
<span class="lineNum">    2316 </span>            :   //
<span class="lineNum">    2317 </span>            :   AliTPCcalibLaser *laser = this;
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :   TTreeSRedirector *pcstream = new TTreeSRedirector(&quot;laserMean.root&quot;);</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :   TF1 fg(&quot;fg&quot;,&quot;gaus&quot;);</span>
<span class="lineNum">    2320 </span>            :   AliTPCParam  * tpcparam    = 0;   
<span class="lineNum">    2321 </span>            :   // start set up for absolute residuals analysis
<span class="lineNum">    2322 </span>            :   //
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :   AliTPCcalibDB*  calib=AliTPCcalibDB::Instance();</span>
<span class="lineNum">    2324 </span><span class="lineNoCov">          0 :   tpcparam    = calib-&gt;GetParameters(); </span>
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :   if (!tpcparam) tpcparam    = new AliTPCParamSR;</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :   tpcparam-&gt;Update();</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :   AliGRPObject *grp = AliTPCcalibDB::GetGRP(run);</span>
<span class="lineNum">    2328 </span>            :   Float_t current=0;
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :   Float_t bfield      = 0, bz=0;</span>
<span class="lineNum">    2330 </span>            : 
<span class="lineNum">    2331 </span><span class="lineNoCov">          0 :   if (grp){</span>
<span class="lineNum">    2332 </span><span class="lineNoCov">          0 :     Float_t polarity = (grp-&gt;GetL3Polarity()&gt;0) ? -1.:1;</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :     current = grp-&gt;GetL3Current((AliGRPObject::Stats)0);</span>
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 :     bfield = polarity*5*current/30000.;</span>
<span class="lineNum">    2335 </span>            :     bz = polarity*5*current/30000.;
<span class="lineNum">    2336 </span><span class="lineNoCov">          0 :     printf(&quot;Run%d\tL3 current%f\tBz\t%f\n&quot;,run,current,bz);</span>
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    2338 </span>            : 
<span class="lineNum">    2339 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetYOuter, fBeamSlopeYOuter, fBeamSectorOuter,0);</span>
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetYInner, fBeamSlopeYInner, fBeamSectorInner,1);</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :   TLinearFitter lfabsyInner(2);</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :   lfabsyInner.SetFormula(&quot;1 ++ x&quot;);</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 :   TLinearFitter lfabszInner(2);</span>
<span class="lineNum">    2344 </span><span class="lineNoCov">          0 :   lfabszInner.SetFormula(&quot;1 ++ x&quot;);</span>
<span class="lineNum">    2345 </span>            : 
<span class="lineNum">    2346 </span><span class="lineNoCov">          0 :   TLinearFitter lfabsyOuter(2);</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">          0 :   lfabsyOuter.SetFormula(&quot;1 ++ x&quot;);</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 :   TLinearFitter lfabszOuter(2);</span>
<span class="lineNum">    2349 </span><span class="lineNoCov">          0 :   lfabszOuter.SetFormula(&quot;1 ++ x&quot;);</span>
<span class="lineNum">    2350 </span>            :   // end set up for absolute residuals analysis
<span class="lineNum">    2351 </span>            : 
<span class="lineNum">    2352 </span>            :   //
<span class="lineNum">    2353 </span>            :   //
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :     Bool_t isOK=kTRUE;</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :     TH1F * hisphi  = (TH1F*)laser-&gt;fDeltaPhi.At(id);</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :     TH1F * hisphiP = (TH1F*)laser-&gt;fDeltaPhiP.At(id);</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :     TH1F * hisZ    = (TH1F*)laser-&gt;fDeltaZ.At(id);</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :     TH1F * hisP3    = (TH1F*)laser-&gt;fDeltaP3.At(id);</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :     TH1F * hisP4    = (TH1F*)laser-&gt;fDeltaP4.At(id);</span>
<span class="lineNum">    2361 </span><span class="lineNoCov">          0 :     TH1F * hisS    = (TH1F*)laser-&gt;fSignals.At(id);</span>
<span class="lineNum">    2362 </span>            :     //if (!hisphi) continue;
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :     Double_t entries = (hisphi==0)? 0: hisphi-&gt;GetEntries();</span>
<span class="lineNum">    2364 </span>            :     //if (entries&lt;minEntries) continue;
<span class="lineNum">    2365 </span>            :     //
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :     AliTPCLaserTrack *ltrp = (AliTPCLaserTrack*)fTracksMirror.At(id);</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :     if (!ltrp) {</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :      AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :       ltrp =(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :     ltrp-&gt;UpdatePoints();</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :     pcstream-&gt;GetFile()-&gt;cd();</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :     if (hisphi)  hisphi-&gt;Write();</span>
<span class="lineNum">    2374 </span><span class="lineNoCov">          0 :     if (hisphiP) hisphiP-&gt;Write();</span>
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :     if (hisZ)    hisZ-&gt;Write();</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :     if (hisP3)    hisP3-&gt;Write();</span>
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :     if (hisP4)    hisP4-&gt;Write();</span>
<span class="lineNum">    2378 </span>            :     
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :     Float_t meanphi = hisphi-&gt;GetMean();</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">          0 :     Float_t rmsphi = hisphi-&gt;GetRMS();</span>
<span class="lineNum">    2381 </span>            :     //
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :     Float_t meanphiP = hisphiP-&gt;GetMean();</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :     Float_t rmsphiP = hisphiP-&gt;GetRMS();</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :     Float_t meanZ = hisZ-&gt;GetMean();</span>
<span class="lineNum">    2385 </span><span class="lineNoCov">          0 :     Float_t rmsZ = hisZ-&gt;GetRMS();</span>
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :     if (hisphi-&gt;GetRMS()&gt;hisphi-&gt;GetBinWidth(1))</span>
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :       hisphi-&gt;Fit(&amp;fg,&quot;&quot;,&quot;&quot;,hisphi-&gt;GetMean()-4*hisphi-&gt;GetRMS(),hisphi-&gt;GetMean()+4*hisphi-&gt;GetRMS());</span>
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :     Double_t gphi1 = fg.GetParameter(1);</span>
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :     Double_t gphi2 = fg.GetParameter(2);</span>
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :     if (hisphiP-&gt;GetRMS()&gt;0)</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :       hisphiP-&gt;Fit(&amp;fg,&quot;&quot;,&quot;&quot;,hisphiP-&gt;GetMean()-4*hisphiP-&gt;GetRMS(),hisphiP-&gt;GetMean()+4*hisphiP-&gt;GetRMS());</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :     Double_t gphiP1 = fg.GetParameter(1);</span>
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :     Double_t gphiP2 = fg.GetParameter(2);</span>
<span class="lineNum">    2394 </span>            :     //
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :     if (hisZ-&gt;GetRMS()&gt;hisZ-&gt;GetBinWidth(1))</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :       hisZ-&gt;Fit(&amp;fg,&quot;&quot;,&quot;&quot;);</span>
<span class="lineNum">    2397 </span><span class="lineNoCov">          0 :     Double_t gz1 = fg.GetParameter(1);</span>
<span class="lineNum">    2398 </span><span class="lineNoCov">          0 :     Double_t gz2 = fg.GetParameter(2);</span>
<span class="lineNum">    2399 </span>            :     //
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :     if (hisP3-&gt;GetRMS()&gt;hisP3-&gt;GetBinWidth(1))</span>
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :       hisP3-&gt;Fit(&amp;fg,&quot;&quot;,&quot;&quot;,hisP3-&gt;GetMean()-4*hisP3-&gt;GetRMS(),hisP3-&gt;GetMean()+4*hisP3-&gt;GetRMS());</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :     Double_t gp31 = fg.GetParameter(1);</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :     Double_t gp32 = fg.GetParameter(2);</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :     Double_t meanp3 = hisP3-&gt;GetMean();</span>
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :     Double_t rmsp3  = hisP3-&gt;GetRMS();</span>
<span class="lineNum">    2406 </span>            :     //
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :     if (hisP4-&gt;GetRMS()&gt;hisP4-&gt;GetBinWidth(1))</span>
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :       hisP4-&gt;Fit(&amp;fg,&quot;&quot;,&quot;&quot;,hisP4-&gt;GetMean()-4*hisP4-&gt;GetRMS(),hisP4-&gt;GetMean()+4*hisP4-&gt;GetRMS());</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :     Double_t gp41 = fg.GetParameter(1);</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :     Double_t gp42 = fg.GetParameter(2);</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :     Double_t meanp4 = hisP4-&gt;GetMean();</span>
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :     Double_t rmsp4  = hisP4-&gt;GetRMS();</span>
<span class="lineNum">    2413 </span>            :     //
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :     Float_t meanS=hisS-&gt;GetMean();</span>
<span class="lineNum">    2415 </span>            :     //
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :     Double_t lxyz[3];</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :     Double_t lpxyz[3];</span>
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">    2420 </span>            : 
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :     if (rmsphi&lt;krmsCut0) isOK=kFALSE; // empty in range - not entries inside</span>
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 :     if (rmsphi&gt;krmsCut1) isOK=kFALSE; // empty in range - not entries inside</span>
<span class="lineNum">    2423 </span><span class="lineNoCov">          0 :     if (rmsphi&gt;krmsCut0) if (gphi2/rmsphi&gt;kmultiCut) isOK=kFALSE;   // multi peak structure</span>
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :     if (gphiP2&gt;kcutP0) isOK=kFALSE;</span>
<span class="lineNum">    2425 </span>            :     //
<span class="lineNum">    2426 </span>            :     //
<span class="lineNum">    2427 </span>            :     //
<span class="lineNum">    2428 </span>            :     TH1 *his =0;
<span class="lineNum">    2429 </span>            :     //
<span class="lineNum">    2430 </span><span class="lineNoCov">          0 :     his = fHisNclIn-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2431 </span><span class="lineNoCov">          0 :     Float_t mnclIn =  his-&gt;GetMean();</span>
<span class="lineNum">    2432 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :     his = fHisNclOut-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 :     Float_t mnclOut =  his-&gt;GetMean();</span>
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :     his = fHisNclIO-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2437 </span><span class="lineNoCov">          0 :     Float_t mnclIO =  his-&gt;GetMean();</span>
<span class="lineNum">    2438 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :     his = fHisLclIn-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :     Float_t mLclIn =  his-&gt;GetMean();</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :     his = fHisLclOut-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :     Float_t mLclOut =  his-&gt;GetMean();</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :     his = fHisLclIO-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :     Float_t mLclIO =  his-&gt;GetMean();</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2448 </span>            :     //
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :     his = fHisdEdx-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :     Float_t mdEdx =  his-&gt;GetMean();</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2452 </span>            :     //
<span class="lineNum">    2453 </span>            :     //
<span class="lineNum">    2454 </span>            :     //
<span class="lineNum">    2455 </span>            :     //
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :     his = fHisChi2YIn1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :     Float_t  mChi2YIn1=  his-&gt;GetMean();</span>
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :     his = fHisChi2YOut1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :     Float_t mChi2YOut1 =  his-&gt;GetMean();</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :     his = fHisChi2YIn2-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :     Float_t mChi2YIn2 =  his-&gt;GetMean();</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 :     his = fHisChi2YOut2-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2466 </span><span class="lineNoCov">          0 :     Float_t mChi2YOut2 =  his-&gt;GetMean();</span>
<span class="lineNum">    2467 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :     his = fHisChi2YIO1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :     Float_t mChi2YIO1 =  his-&gt;GetMean();</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :     his = fHisChi2ZIn1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :     Float_t mChi2ZIn1 =  his-&gt;GetMean();</span>
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">          0 :     his = fHisChi2ZOut1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :     Float_t mChi2ZOut1 =  his-&gt;GetMean();</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2477 </span><span class="lineNoCov">          0 :     his = fHisChi2ZIn2-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :     Float_t mChi2ZIn2 =  his-&gt;GetMean();</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2480 </span><span class="lineNoCov">          0 :     his = fHisChi2ZOut2-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :     Float_t mChi2ZOut2 =  his-&gt;GetMean();</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :     his = fHisChi2ZIO1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :     Float_t mChi2ZIO1 =  his-&gt;GetMean();</span>
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2486 </span>            :     //
<span class="lineNum">    2487 </span>            :     // fit res. histos
<span class="lineNum">    2488 </span>            :     // 
<span class="lineNum">    2489 </span><span class="lineNoCov">          0 :     his = fHisdZfit-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);</span>
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :     Float_t  edZfit  = his-&gt;GetEntries();</span>
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :     Float_t  mdZfit =  his-&gt;GetMean();</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :     Float_t  rdZfit  = his-&gt;GetRMS();</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2494 </span>            : 
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :     his = fHisPy1vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :     Float_t  ePy1vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :     Float_t  mPy1vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :     Float_t  rPy1vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2500 </span>            :     
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :     his = fHisPy2vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :     Float_t  ePy2vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :     Float_t  mPy2vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :     Float_t  rPy2vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2506 </span>            :     
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :     his = fHisPy3vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :     Float_t  ePy3vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :     Float_t  mPy3vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :     Float_t  rPy3vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2512 </span>            :     
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :     his = fHisPy1vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :     Float_t  ePy1vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :     Float_t  mPy1vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :     Float_t  rPy1vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2518 </span>            :     
<span class="lineNum">    2519 </span><span class="lineNoCov">          0 :     his = fHisPy2vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :     Float_t  ePy2vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :     Float_t  mPy2vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :     Float_t  rPy2vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2523 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2524 </span>            :     
<span class="lineNum">    2525 </span><span class="lineNoCov">          0 :     his = fHisPy3vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :     Float_t  ePy3vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :     Float_t  mPy3vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2528 </span><span class="lineNoCov">          0 :     Float_t  rPy3vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2530 </span>            :     
<span class="lineNum">    2531 </span><span class="lineNoCov">          0 :     his = fHisPy2vP2In-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :     Float_t  ePy2vP2In  = his-&gt;GetEntries();</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :     Float_t  mPy2vP2In  = his-&gt;GetMean();</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :     Float_t  rPy2vP2In  = his-&gt;GetRMS();</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2536 </span>            :     
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :     his = fHisPy2vP2Out-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :     Float_t  ePy2vP2Out  = his-&gt;GetEntries();</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :     Float_t  mPy2vP2Out  = his-&gt;GetMean();</span>
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :     Float_t  rPy2vP2Out  = his-&gt;GetRMS();</span>
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2542 </span>            :     
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :     his = fHisPy3vP2IO-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :     Float_t  ePy3vP2IO  = his-&gt;GetEntries();</span>
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :     Float_t  mPy3vP2IO  = his-&gt;GetMean();</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :     Float_t  rPy3vP2IO  = his-&gt;GetRMS();</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2548 </span>            :     
<span class="lineNum">    2549 </span>            :     //
<span class="lineNum">    2550 </span>            :     //
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :     his = fHisPz1vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">    2552 </span><span class="lineNoCov">          0 :     Float_t  ePz1vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2553 </span><span class="lineNoCov">          0 :     Float_t  mPz1vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :     Float_t  rPz1vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2556 </span>            :     
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 :     his = fHisPz2vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">    2558 </span><span class="lineNoCov">          0 :     Float_t  ePz2vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :     Float_t  mPz2vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :     Float_t  rPz2vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2562 </span>            :     
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :     his = fHisPz3vP0-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">    2564 </span><span class="lineNoCov">          0 :     Float_t  ePz3vP0  = his-&gt;GetEntries();</span>
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :     Float_t  mPz3vP0  = his-&gt;GetMean();</span>
<span class="lineNum">    2566 </span><span class="lineNoCov">          0 :     Float_t  rPz3vP0  = his-&gt;GetRMS();</span>
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2568 </span>            :     
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :     his = fHisPz1vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :     Float_t  ePz1vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :     Float_t  mPz1vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :     Float_t  rPz1vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2574 </span>            :     
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :     his = fHisPz2vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :     Float_t  ePz2vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :     Float_t  mPz2vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :     Float_t  rPz2vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2580 </span>            :     
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :     his = fHisPz3vP1-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :     Float_t  ePz3vP1  = his-&gt;GetEntries();</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :     Float_t  mPz3vP1  = his-&gt;GetMean();</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :     Float_t  rPz3vP1  = his-&gt;GetRMS();</span>
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2586 </span>            :     
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :     his = fHisPz2vP2In-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :     Float_t  ePz2vP2In  = his-&gt;GetEntries();</span>
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :     Float_t  mPz2vP2In  = his-&gt;GetMean();</span>
<span class="lineNum">    2590 </span><span class="lineNoCov">          0 :     Float_t  rPz2vP2In  = his-&gt;GetRMS();</span>
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2592 </span>            :     
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :     his = fHisPz2vP2Out-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :     Float_t  ePz2vP2Out  = his-&gt;GetEntries();</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :     Float_t  mPz2vP2Out  = his-&gt;GetMean();</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :     Float_t  rPz2vP2Out  = his-&gt;GetRMS();</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2598 </span>            :     
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :     his = fHisPz3vP2IO-&gt;ProjectionY(&quot;aaa&quot;,id+1,id+1);   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :     Float_t  ePz3vP2IO  = his-&gt;GetEntries();</span>
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :     Float_t  mPz3vP2IO  = his-&gt;GetMean();</span>
<span class="lineNum">    2602 </span><span class="lineNoCov">          0 :     Float_t  rPz3vP2IO  = his-&gt;GetRMS();</span>
<span class="lineNum">    2603 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    2604 </span>            : 
<span class="lineNum">    2605 </span>            :     // Fit absolute laser residuals
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :     TH2F* histAbsY = (TH2F*)laser-&gt;fDeltaYresAbs[id];</span>
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :     TH2F* histAbsZ = (TH2F*)laser-&gt;fDeltaZresAbs[id];</span>
<span class="lineNum">    2608 </span>            : 
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :     Int_t secInner = TMath::Nint(fBeamSectorInner[id]); </span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :     Int_t secOuter = TMath::Nint(fBeamSectorOuter[id]); </span>
<span class="lineNum">    2611 </span>            : 
<span class="lineNum">    2612 </span><span class="lineNoCov">          0 :     TVectorD vecX(kMaxRow);        // X</span>
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :     TVectorD vecY(kMaxRow);        // Y</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :     TVectorD vecR(kMaxRow);        // R</span>
<span class="lineNum">    2615 </span><span class="lineNoCov">          0 :     TVectorD vecDY(kMaxRow);       // absolute residuals in Y</span>
<span class="lineNum">    2616 </span><span class="lineNoCov">          0 :     TVectorD vecDZ(kMaxRow);       // absolute residuals in Z</span>
<span class="lineNum">    2617 </span><span class="lineNoCov">          0 :     TVectorD vecN(kMaxRow);        // number of clusters</span>
<span class="lineNum">    2618 </span><span class="lineNoCov">          0 :     TVectorD vecEy(kMaxRow);       //error y</span>
<span class="lineNum">    2619 </span><span class="lineNoCov">          0 :     TVectorD vecEz(kMaxRow);       //error z</span>
<span class="lineNum">    2620 </span><span class="lineNoCov">          0 :     TVectorD vecPhi(kMaxRow);      // local tangent</span>
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :     TVectorD vecPhiR(kMaxRow);     // local tangent</span>
<span class="lineNum">    2622 </span>            :     // magnetic field integrals
<span class="lineNum">    2623 </span><span class="lineNoCov">          0 :     TVectorD vecIBR(kMaxRow);        // radial</span>
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :     TVectorD vecIBRPhi(kMaxRow);     // r-phi</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :     TVectorD vecIBLX(kMaxRow);       // local x</span>
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 :     TVectorD vecIBLY(kMaxRow);       // local y</span>
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :     TVectorD vecIBGX(kMaxRow);       // local x</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :     TVectorD vecIBGY(kMaxRow);       // local y</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :     TVectorD vecIBZ(kMaxRow);        // z</span>
<span class="lineNum">    2630 </span>            :     //
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :     for (Int_t irow=0;irow&lt;kMaxRow;irow++){</span>
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :       vecIBR[irow]=0;</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :       vecIBRPhi[irow]=0;</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :       vecIBLX[irow]=0;</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :       vecIBLY[irow]=0;</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :       vecIBGX[irow]=0;</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :       vecIBGY[irow]=0;</span>
<span class="lineNum">    2638 </span><span class="lineNoCov">          0 :       vecIBZ[irow]=0;</span>
<span class="lineNum">    2639 </span><span class="lineNoCov">          0 :       Double_t gx    =(*(ltrp-&gt;fVecGX))[irow];</span>
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :       Double_t gy    =(*(ltrp-&gt;fVecGY))[irow];</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :       Int_t    lsec  =TMath::Nint((*(ltrp-&gt;fVecSec))[irow]);</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :       Double_t   ca  =TMath::Cos(TMath::Pi()*(lsec+0.5)/9.);</span>
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :       Double_t   sa  =TMath::Sin(TMath::Pi()*(lsec+0.5)/9.);</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :       xyz[2]=(*(ltrp-&gt;fVecGZ))[irow];</span>
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :       xyz[0]=TMath::Sqrt(gx*gx+gy*gy);</span>
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 :       xyz[1]=TMath::ATan2(gy,gx);</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :       Double_t gxyz[3]={gx,gy,(*(ltrp-&gt;fVecGZ))[irow]};</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :       if (magF){</span>
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :         magF-&gt;GetTPCIntCyl(xyz,bxyz);</span>
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :         magF-&gt;GetTPCInt(gxyz,bgxyz);</span>
<span class="lineNum">    2651 </span><span class="lineNoCov">          0 :         vecIBR[irow]=bxyz[0];</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :         vecIBRPhi[irow]=bxyz[1];</span>
<span class="lineNum">    2653 </span>            :         //
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :         vecIBGX[irow]=bgxyz[0];</span>
<span class="lineNum">    2655 </span><span class="lineNoCov">          0 :         vecIBGY[irow]=bgxyz[1];</span>
<span class="lineNum">    2656 </span>            :         //
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 :         vecIBLX[irow]=  bgxyz[0]*ca+bgxyz[1]*sa;</span>
<span class="lineNum">    2658 </span><span class="lineNoCov">          0 :         vecIBLY[irow]= -bgxyz[0]*sa+bgxyz[1]*ca;</span>
<span class="lineNum">    2659 </span>            :         //
<span class="lineNum">    2660 </span>            : 
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :         vecIBZ[irow]=bxyz[2];</span>
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2663 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    2664 </span>            : 
<span class="lineNum">    2665 </span>            : 
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :     lfabsyInner.ClearPoints();    </span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :     lfabszInner.ClearPoints();    </span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :     lfabsyOuter.ClearPoints();    </span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :     lfabszOuter.ClearPoints();    </span>
<span class="lineNum">    2670 </span>            :     // dummy fit values
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :     Int_t    nClInY         = 0;</span>
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :     Float_t  yAbsInOffset  = -100;</span>
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :     Float_t  yAbsInSlope   = -100;</span>
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :     Float_t  yAbsInDeltay  = -100;</span>
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :     Int_t    nClInZ         = 0;</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :     Float_t  zAbsInOffset  = -100;</span>
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :     Float_t  zAbsInSlope   = -100;</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :     Float_t  zAbsInDeltaz  = -100;</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :     Int_t    nClOutY         = 0;</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :     Float_t  yAbsOutOffset  = -100;</span>
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :     Float_t  yAbsOutSlope   = -100;</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :     Float_t  yAbsOutDeltay  = -100;</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :     Int_t    nClOutZ         = 0;</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :     Float_t  zAbsOutOffset  = -100;</span>
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :     Float_t  zAbsOutSlope   = -100;</span>
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :     Float_t  zAbsOutDeltaz  = -100;</span>
<span class="lineNum">    2687 </span>            : 
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 :     Float_t  lasTanPhiLocIn = -100;</span>
<span class="lineNum">    2689 </span><span class="lineNoCov">          0 :     Float_t  lasTanPhiLocOut = -100;</span>
<span class="lineNum">    2690 </span>            : 
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :     if(histAbsY &amp;&amp; histAbsY-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    2692 </span>            :       
<span class="lineNum">    2693 </span>            :       Double_t rotAngOut = 10;
<span class="lineNum">    2694 </span>            :       Double_t rotAngIn = 10;
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :       if((secInner%36)!=(secOuter%36))</span>
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :         rotAngIn += 20; // 30 degrees</span>
<span class="lineNum">    2697 </span>            :       
<span class="lineNum">    2698 </span>            :       // Calculate laser mirror X position in local frame
<span class="lineNum">    2699 </span>            :       Double_t laserposOut = 
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :         TMath::Abs(ltrp-&gt;GetX()*TMath::Cos(rotAngOut*TMath::DegToRad()));</span>
<span class="lineNum">    2701 </span>            :       Double_t laserposIn = 
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :         TMath::Abs(ltrp-&gt;GetX()*TMath::Cos(rotAngIn*TMath::DegToRad()));</span>
<span class="lineNum">    2703 </span>            :       
<span class="lineNum">    2704 </span>            :       // Calculate laser tan phi in local frame
<span class="lineNum">    2705 </span><span class="lineNoCov">          0 :       lasTanPhiLocOut  = TMath::ASin(ltrp-&gt;GetSnp());</span>
<span class="lineNum">    2706 </span><span class="lineNoCov">          0 :       if(lasTanPhiLocOut&lt;0) {</span>
<span class="lineNum">    2707 </span><span class="lineNoCov">          0 :         lasTanPhiLocIn  = lasTanPhiLocOut - rotAngIn*TMath::DegToRad();</span>
<span class="lineNum">    2708 </span><span class="lineNoCov">          0 :         lasTanPhiLocOut -= rotAngOut*TMath::DegToRad();</span>
<span class="lineNum">    2709 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">    2710 </span>            :         
<span class="lineNum">    2711 </span><span class="lineNoCov">          0 :         lasTanPhiLocIn  = lasTanPhiLocOut + rotAngIn*TMath::DegToRad();</span>
<span class="lineNum">    2712 </span><span class="lineNoCov">          0 :         lasTanPhiLocOut += rotAngOut*TMath::DegToRad();</span>
<span class="lineNum">    2713 </span>            :       }
<span class="lineNum">    2714 </span>            :       
<span class="lineNum">    2715 </span><span class="lineNoCov">          0 :       lasTanPhiLocIn = TMath::Tan(lasTanPhiLocIn);</span>
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :       lasTanPhiLocOut = TMath::Tan(lasTanPhiLocOut);</span>
<span class="lineNum">    2717 </span>            :       
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :       TProfile* yprof  = histAbsY-&gt;ProfileX(&quot;yprof&quot;);</span>
<span class="lineNum">    2719 </span><span class="lineNoCov">          0 :       TProfile* zprof  = histAbsZ-&gt;ProfileX(&quot;zprof&quot;);</span>
<span class="lineNum">    2720 </span>            :       
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :       for(Int_t bin = 1; bin&lt;=kMaxRow; bin++) {</span>
<span class="lineNum">    2722 </span>            :         
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :         if(yprof-&gt;GetBinEntries(bin)&lt;5&amp;&amp;</span>
<span class="lineNum">    2724 </span><span class="lineNoCov">          0 :            zprof-&gt;GetBinEntries(bin)&lt;5) {</span>
<span class="lineNum">    2725 </span>            :           continue;     
<span class="lineNum">    2726 </span>            :         }
<span class="lineNum">    2727 </span>            :         
<span class="lineNum">    2728 </span>            :         // There is a problem in defining inner and outer sectors for
<span class="lineNum">    2729 </span>            :         // the outer beams (0 and 6) where both sectors are OROCs. To
<span class="lineNum">    2730 </span>            :         // make sure there is no overlap row 94 to 99 are cutted.
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :         if(((ltrp-&gt;GetBeam()==0)||(ltrp-&gt;GetBeam()==6))&amp;&amp;bin&gt;=95&amp;&amp;bin&lt;=100)</span>
<span class="lineNum">    2732 </span>            :           continue;
<span class="lineNum">    2733 </span>            :         
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :         Int_t row = (bin-1);</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :         if(row&gt;62)</span>
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :           row -= 63;</span>
<span class="lineNum">    2737 </span>            : 
<span class="lineNum">    2738 </span>            :         Bool_t isOuter = kTRUE;
<span class="lineNum">    2739 </span><span class="lineNoCov">          0 :         Int_t sector = TMath::Nint(fBeamSectorOuter[id]);</span>
<span class="lineNum">    2740 </span>            :         
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :         if(bin&lt;=62 ||                                        </span>
<span class="lineNum">    2742 </span><span class="lineNoCov">          0 :            (((ltrp-&gt;GetBeam()==0)||(ltrp-&gt;GetBeam()==6))&amp;&amp;bin&lt;=95)) {</span>
<span class="lineNum">    2743 </span>            : 
<span class="lineNum">    2744 </span>            :           isOuter = kFALSE;
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :           sector = TMath::Nint(fBeamSectorInner[id]);</span>
<span class="lineNum">    2746 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2747 </span>            : 
<span class="lineNum">    2748 </span>            : 
<span class="lineNum">    2749 </span><span class="lineNoCov">          0 :         Double_t x = tpcparam-&gt;GetPadRowRadii(sector, row); // slope</span>
<span class="lineNum">    2750 </span><span class="lineNoCov">          0 :         vecN[bin-1] =yprof-&gt;GetBinEntries(bin);</span>
<span class="lineNum">    2751 </span><span class="lineNoCov">          0 :         vecEy[bin-1]=yprof-&gt;GetBinError(bin);</span>
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 :         vecEz[bin-1]=zprof-&gt;GetBinError(bin);</span>
<span class="lineNum">    2753 </span><span class="lineNoCov">          0 :         vecX[bin-1] = x;</span>
<span class="lineNum">    2754 </span><span class="lineNoCov">          0 :         vecDY[bin-1] = yprof-&gt;GetBinContent(bin);</span>
<span class="lineNum">    2755 </span><span class="lineNoCov">          0 :         vecDZ[bin-1] = zprof-&gt;GetBinContent(bin);</span>
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :         if (bin&gt;0&amp;&amp;bin&lt;kMaxRow){</span>
<span class="lineNum">    2757 </span>            :           //
<span class="lineNum">    2758 </span>            :           //truncated mean - skip first and the last  pad row
<span class="lineNum">    2759 </span>            :           //
<span class="lineNum">    2760 </span><span class="lineNoCov">          0 :           Int_t firstBin=TMath::Max(bin-5,0);</span>
<span class="lineNum">    2761 </span><span class="lineNoCov">          0 :           Int_t lastBin =TMath::Min(bin+5,158);</span>
<span class="lineNum">    2762 </span><span class="lineNoCov">          0 :           histAbsY-&gt;GetXaxis()-&gt;SetRangeUser(firstBin,lastBin);</span>
<span class="lineNum">    2763 </span><span class="lineNoCov">          0 :           histAbsY-&gt;GetYaxis()-&gt;SetRangeUser(-2,2);</span>
<span class="lineNum">    2764 </span><span class="lineNoCov">          0 :           vecEy[bin-1]=histAbsY-&gt;GetRMS(2);</span>
<span class="lineNum">    2765 </span><span class="lineNoCov">          0 :           vecDY[bin-1]=histAbsY-&gt;GetMean(2);</span>
<span class="lineNum">    2766 </span><span class="lineNoCov">          0 :           histAbsY-&gt;GetXaxis()-&gt;SetRangeUser(firstBin+2,lastBin-2);//use+-2 bins</span>
<span class="lineNum">    2767 </span><span class="lineNoCov">          0 :           histAbsY-&gt;GetYaxis()-&gt;SetRangeUser(vecDY[bin-1]-4*vecEy[bin-1],vecDY[bin-1]+4*vecEy[bin-1]);</span>
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 :           if (yprof-&gt;GetBinEntries(bin-1)&gt;0) vecEy[bin-1]=histAbsY-&gt;GetRMS(2)/TMath::Sqrt(yprof-&gt;GetBinEntries(bin-1));</span>
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 :           vecDY[bin-1]=histAbsY-&gt;GetMean(2);</span>
<span class="lineNum">    2770 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2771 </span>            : 
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :         if(!isOuter) { // inner   </span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :           vecPhi[bin-1]=lasTanPhiLocIn;</span>
<span class="lineNum">    2774 </span>            :           // Calculate local y from residual and database
<span class="lineNum">    2775 </span><span class="lineNoCov">          0 :           Double_t y  = fBeamSlopeYInner[id]*x + fBeamOffsetYInner[id]</span>
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :             + vecDY[bin-1];</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :           vecY[bin-1] = y;</span>
<span class="lineNum">    2778 </span><span class="lineNoCov">          0 :           Double_t r  = TMath::Sqrt(x*x + y*y);</span>
<span class="lineNum">    2779 </span><span class="lineNoCov">          0 :           vecR[bin-1] = r;</span>
<span class="lineNum">    2780 </span>            :           // Find angle between laser vector and R vector
<span class="lineNum">    2781 </span>            :           // cos angle = (x,y).(1,fBeamSlopeYInner)/R/sqrt(1+fBeamSlopeYInner**2)
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :           Double_t cosPhi = x + y*fBeamSlopeYInner[id];</span>
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :           cosPhi /= r*TMath::Sqrt(1+fBeamSlopeYInner[id]*fBeamSlopeYInner[id]);</span>
<span class="lineNum">    2784 </span><span class="lineNoCov">          0 :           vecPhiR[bin-1] = TMath::Tan(TMath::ACos(cosPhi));</span>
<span class="lineNum">    2785 </span><span class="lineNoCov">          0 :           if(lasTanPhiLocIn&lt;0)</span>
<span class="lineNum">    2786 </span><span class="lineNoCov">          0 :             vecPhiR[bin-1]*=-1; // to have the same sign</span>
<span class="lineNum">    2787 </span>            :           
<span class="lineNum">    2788 </span><span class="lineNoCov">          0 :           if(yprof-&gt;GetBinEntries(bin)&gt;=10) {</span>
<span class="lineNum">    2789 </span><span class="lineNoCov">          0 :             lfabsyInner.AddPoint(&amp;x, yprof-&gt;GetBinContent(bin), </span>
<span class="lineNum">    2790 </span><span class="lineNoCov">          0 :                                   TMath::Max(yprof-&gt;GetBinError(bin), 0.001));</span>
<span class="lineNum">    2791 </span>            :           } 
<span class="lineNum">    2792 </span><span class="lineNoCov">          0 :           if(zprof-&gt;GetBinEntries(bin)&gt;=10) {</span>
<span class="lineNum">    2793 </span><span class="lineNoCov">          0 :             lfabszInner.AddPoint(&amp;x, zprof-&gt;GetBinContent(bin), </span>
<span class="lineNum">    2794 </span><span class="lineNoCov">          0 :                                   TMath::Max(zprof-&gt;GetBinError(bin), 0.001));</span>
<span class="lineNum">    2795 </span>            :           }
<span class="lineNum">    2796 </span><span class="lineNoCov">          0 :         } else { // outer</span>
<span class="lineNum">    2797 </span><span class="lineNoCov">          0 :           vecPhi[bin-1]=lasTanPhiLocOut;          </span>
<span class="lineNum">    2798 </span>            :           // Calculate local y from residual and database
<span class="lineNum">    2799 </span><span class="lineNoCov">          0 :           Double_t y  = fBeamSlopeYOuter[id]*x + fBeamOffsetYOuter[id]</span>
<span class="lineNum">    2800 </span><span class="lineNoCov">          0 :             + vecDY[bin-1];</span>
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :           vecY[bin-1] = y;</span>
<span class="lineNum">    2802 </span><span class="lineNoCov">          0 :           Double_t r  = TMath::Sqrt(x*x + y*y);</span>
<span class="lineNum">    2803 </span><span class="lineNoCov">          0 :           vecR[bin-1] = r;</span>
<span class="lineNum">    2804 </span>            : 
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :           Double_t cosPhi = x + y*fBeamSlopeYOuter[id];</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :           cosPhi /= r*TMath::Sqrt(1+fBeamSlopeYOuter[id]*fBeamSlopeYOuter[id]);</span>
<span class="lineNum">    2807 </span><span class="lineNoCov">          0 :           vecPhiR[bin-1] = TMath::Tan(TMath::ACos(cosPhi));</span>
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :           if(lasTanPhiLocOut&lt;0)</span>
<span class="lineNum">    2809 </span><span class="lineNoCov">          0 :             vecPhiR[bin-1]*=-1; // to have the same sign</span>
<span class="lineNum">    2810 </span>            : 
<span class="lineNum">    2811 </span><span class="lineNoCov">          0 :           if(yprof-&gt;GetBinEntries(bin)&gt;=10) {</span>
<span class="lineNum">    2812 </span><span class="lineNoCov">          0 :             lfabsyOuter.AddPoint(&amp;x, yprof-&gt;GetBinContent(bin), </span>
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 :                                   TMath::Max(yprof-&gt;GetBinError(bin), 0.001));</span>
<span class="lineNum">    2814 </span>            :           }
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 :           if(zprof-&gt;GetBinEntries(bin)&gt;=10) {</span>
<span class="lineNum">    2816 </span><span class="lineNoCov">          0 :             lfabszOuter.AddPoint(&amp;x, zprof-&gt;GetBinContent(bin), </span>
<span class="lineNum">    2817 </span><span class="lineNoCov">          0 :                                   TMath::Max(zprof-&gt;GetBinError(bin), 0.001));</span>
<span class="lineNum">    2818 </span>            :           }
<span class="lineNum">    2819 </span>            :         }
<span class="lineNum">    2820 </span>            :         // global position
<span class="lineNum">    2821 </span>            :         
<span class="lineNum">    2822 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2823 </span>            :         
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :       delete yprof; delete zprof;</span>
<span class="lineNum">    2825 </span>            : 
<span class="lineNum">    2826 </span>            :       
<span class="lineNum">    2827 </span>            :       // Fit laser abs residuals with linear robust fit (exclude 5% outliers)
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :       nClInY = lfabsyInner.GetNpoints();</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :       if(lfabsyInner.GetNpoints()&gt;10) {</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 :         lfabsyInner.EvalRobust(0.95);</span>
<span class="lineNum">    2831 </span>            :         
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 :         TVectorD result(2);</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :         lfabsyInner.GetParameters(result);</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :         yAbsInOffset = result[0];</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :         yAbsInSlope  = result[1];</span>
<span class="lineNum">    2836 </span><span class="lineNoCov">          0 :         yAbsInDeltay = yAbsInSlope*laserposIn + yAbsInOffset;</span>
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :       nClInZ = lfabszInner.GetNpoints();</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :       if(lfabszInner.GetNpoints()&gt;10) {</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :         lfabszInner.EvalRobust(0.95);</span>
<span class="lineNum">    2841 </span>            :         
<span class="lineNum">    2842 </span><span class="lineNoCov">          0 :         TVectorD result(2);</span>
<span class="lineNum">    2843 </span><span class="lineNoCov">          0 :         lfabszInner.GetParameters(result);</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :         zAbsInOffset = result[0];</span>
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :         zAbsInSlope  = result[1];</span>
<span class="lineNum">    2846 </span><span class="lineNoCov">          0 :         zAbsInDeltaz = zAbsInSlope*laserposIn + zAbsInOffset;</span>
<span class="lineNum">    2847 </span><span class="lineNoCov">          0 :       } </span>
<span class="lineNum">    2848 </span><span class="lineNoCov">          0 :       nClOutY = lfabsyOuter.GetNpoints();</span>
<span class="lineNum">    2849 </span><span class="lineNoCov">          0 :       if(lfabsyOuter.GetNpoints()&gt;10) {</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :         lfabsyOuter.EvalRobust(0.95);</span>
<span class="lineNum">    2851 </span>            :         
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :         TVectorD result(2);</span>
<span class="lineNum">    2853 </span><span class="lineNoCov">          0 :         lfabsyOuter.GetParameters(result);</span>
<span class="lineNum">    2854 </span><span class="lineNoCov">          0 :         yAbsOutOffset = result[0];</span>
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :         yAbsOutSlope  = result[1];</span>
<span class="lineNum">    2856 </span><span class="lineNoCov">          0 :         yAbsOutDeltay = yAbsOutSlope*laserposOut + yAbsOutOffset;</span>
<span class="lineNum">    2857 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2858 </span><span class="lineNoCov">          0 :       nClOutZ = lfabszOuter.GetNpoints();</span>
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :       if(lfabszOuter.GetNpoints()&gt;10) {</span>
<span class="lineNum">    2860 </span><span class="lineNoCov">          0 :         lfabszOuter.EvalRobust(0.95);</span>
<span class="lineNum">    2861 </span>            :         
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :         TVectorD result(2);</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">          0 :         lfabszOuter.GetParameters(result);</span>
<span class="lineNum">    2864 </span><span class="lineNoCov">          0 :         zAbsOutOffset = result[0];</span>
<span class="lineNum">    2865 </span><span class="lineNoCov">          0 :         zAbsOutSlope  = result[1];</span>
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :         zAbsOutDeltaz = zAbsOutSlope*laserposOut + zAbsOutOffset;</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    2869 </span>            : 
<span class="lineNum">    2870 </span>            :     
<span class="lineNum">    2871 </span>            :     Int_t itime=-1;
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :     Float_t  coverIA=AliTPCcalibDB::GetCoverVoltage(run,0,itime);</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">          0 :     Float_t  coverIC=AliTPCcalibDB::GetCoverVoltage(run,18,itime);</span>
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :     Float_t  coverOA=AliTPCcalibDB::GetCoverVoltage(run,36,itime);</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :     Float_t  coverOC=AliTPCcalibDB::GetCoverVoltage(run,54,itime);</span>
<span class="lineNum">    2876 </span>            :     //
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :     Float_t  skirtA=AliTPCcalibDB::GetSkirtVoltage(run,0,itime);</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :     Float_t  skirtC=AliTPCcalibDB::GetSkirtVoltage(run,18,itime);</span>
<span class="lineNum">    2879 </span>            :     //
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :     Float_t  ggOffA=AliTPCcalibDB::GetGGoffsetVoltage(run,0,itime);</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :     Float_t  ggOffC=AliTPCcalibDB::GetGGoffsetVoltage(run,18,itime);</span>
<span class="lineNum">    2882 </span>            : 
<span class="lineNum">    2883 </span>            :     //
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :     (*pcstream)&lt;&lt;&quot;Mean&quot;&lt;&lt;</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :       &quot;run=&quot;&lt;&lt;run&lt;&lt;               //</span>
<span class="lineNum">    2886 </span>            :       //voltages
<span class="lineNum">    2887 </span><span class="lineNoCov">          0 :       &quot;UcIA=&quot;&lt;&lt;coverIA&lt;&lt;</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :       &quot;UcIC=&quot;&lt;&lt;coverIC&lt;&lt;</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :       &quot;UcOA=&quot;&lt;&lt;coverOA&lt;&lt;</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :       &quot;UcOC=&quot;&lt;&lt;coverOC&lt;&lt;</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :       &quot;UsA=&quot;&lt;&lt;skirtA&lt;&lt;</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :       &quot;UsC=&quot;&lt;&lt;skirtC&lt;&lt;</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :       &quot;UggA=&quot;&lt;&lt;ggOffA&lt;&lt;</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">          0 :       &quot;UggC=&quot;&lt;&lt;ggOffC&lt;&lt;</span>
<span class="lineNum">    2895 </span>            :       //
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :       &quot;isOK=&quot;&lt;&lt;isOK&lt;&lt;             //</span>
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :       &quot;id=&quot;&lt;&lt;id&lt;&lt;                 // track id</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :       &quot;entries=&quot;&lt;&lt;entries&lt;&lt;       // number of entries</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :       &quot;bz=&quot;&lt;&lt;bfield&lt;&lt;             // bfield</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :       &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;             // refernece track</span>
<span class="lineNum">    2901 </span>            :       //
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :       &quot;mnclIn=&quot;&lt;&lt;mnclIn&lt;&lt;         // mean number of clusters in inner</span>
<span class="lineNum">    2903 </span><span class="lineNoCov">          0 :       &quot;mnclOut=&quot;&lt;&lt;mnclOut&lt;&lt;       // mean number of clusters in outer</span>
<span class="lineNum">    2904 </span><span class="lineNoCov">          0 :       &quot;mnclIO=&quot;&lt;&lt;mnclIO&lt;&lt;         // mean number of clusters in inner+outer</span>
<span class="lineNum">    2905 </span><span class="lineNoCov">          0 :       &quot;mLclIn=&quot;&lt;&lt;mLclIn&lt;&lt;         // mean number of clusters in inner</span>
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :       &quot;mLclOut=&quot;&lt;&lt;mLclOut&lt;&lt;       // mean number of clusters in outer</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :       &quot;mLclIO=&quot;&lt;&lt;mLclIO&lt;&lt;         // mean number of clusters in inner+outer</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :       &quot;mdEdx=&quot;&lt;&lt;mdEdx&lt;&lt;           // mean dEdx</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :       &quot;edZfit=&quot;&lt;&lt;edZfit&lt;&lt;           // entries z fit</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :       &quot;mdZfit=&quot;&lt;&lt;mdZfit&lt;&lt;           // mean z fit</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :       &quot;rdZfit=&quot;&lt;&lt;rdZfit&lt;&lt;           // RMS z fit</span>
<span class="lineNum">    2912 </span>            :       //
<span class="lineNum">    2913 </span>            :       //
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :       &quot;mChi2YIn1=&quot;&lt;&lt;mChi2YIn1&lt;&lt;       //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :       &quot;mChi2YOut1=&quot;&lt;&lt;mChi2YOut1&lt;&lt;     //-&gt;chi2 y inner - line</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :       &quot;mChi2YIn2=&quot;&lt;&lt;mChi2YIn2&lt;&lt;       //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :       &quot;mChi2YOut2=&quot;&lt;&lt;mChi2YOut2&lt;&lt;     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :       &quot;mChi2YIO1=&quot;&lt;&lt;mChi2YIO1&lt;&lt;       //-&gt;chi2 y IO    - common</span>
<span class="lineNum">    2919 </span><span class="lineNoCov">          0 :       &quot;mChi2ZIn1=&quot;&lt;&lt;mChi2ZIn1&lt;&lt;       //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2920 </span><span class="lineNoCov">          0 :       &quot;mChi2ZOut1=&quot;&lt;&lt;mChi2ZOut1&lt;&lt;     //-&gt;chi2 z inner - line</span>
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :       &quot;mChi2ZIn2=&quot;&lt;&lt;mChi2ZIn2&lt;&lt;       //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :       &quot;mChi2ZOut2=&quot;&lt;&lt;mChi2ZOut2&lt;&lt;     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :       &quot;mChi2ZIO1=&quot;&lt;&lt;mChi2ZIO1&lt;&lt;       //-&gt;chi2 z IO    - common</span>
<span class="lineNum">    2924 </span>            :       //
<span class="lineNum">    2925 </span>            :       //
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :       &quot;ePy1vP0=&quot;&lt;&lt;ePy1vP0&lt;&lt;</span>
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :       &quot;mPy1vP0=&quot;&lt;&lt;mPy1vP0&lt;&lt;</span>
<span class="lineNum">    2928 </span><span class="lineNoCov">          0 :       &quot;rPy1vP0=&quot;&lt;&lt;rPy1vP0&lt;&lt;</span>
<span class="lineNum">    2929 </span><span class="lineNoCov">          0 :       &quot;ePy2vP0=&quot;&lt;&lt;ePy2vP0&lt;&lt;</span>
<span class="lineNum">    2930 </span><span class="lineNoCov">          0 :       &quot;mPy2vP0=&quot;&lt;&lt;mPy2vP0&lt;&lt;</span>
<span class="lineNum">    2931 </span><span class="lineNoCov">          0 :       &quot;rPy2vP0=&quot;&lt;&lt;rPy2vP0&lt;&lt;      </span>
<span class="lineNum">    2932 </span><span class="lineNoCov">          0 :       &quot;ePy3vP0=&quot;&lt;&lt;ePy3vP0&lt;&lt;</span>
<span class="lineNum">    2933 </span><span class="lineNoCov">          0 :       &quot;mPy3vP0=&quot;&lt;&lt;mPy3vP0&lt;&lt;</span>
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :       &quot;rPy3vP0=&quot;&lt;&lt;rPy3vP0&lt;&lt;</span>
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :       &quot;ePy1vP1=&quot;&lt;&lt;ePy1vP1&lt;&lt;</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :       &quot;mPy1vP1=&quot;&lt;&lt;mPy1vP1&lt;&lt;</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :       &quot;rPy1vP1=&quot;&lt;&lt;rPy1vP1&lt;&lt;</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :       &quot;ePy2vP1=&quot;&lt;&lt;ePy2vP1&lt;&lt;</span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :       &quot;mPy2vP1=&quot;&lt;&lt;mPy2vP1&lt;&lt;</span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :       &quot;rPy2vP1=&quot;&lt;&lt;rPy2vP1&lt;&lt;</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :       &quot;ePy3vP1=&quot;&lt;&lt;ePy3vP1&lt;&lt;</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :       &quot;mPy3vP1=&quot;&lt;&lt;mPy3vP1&lt;&lt;</span>
<span class="lineNum">    2943 </span><span class="lineNoCov">          0 :       &quot;rPy3vP1=&quot;&lt;&lt;rPy3vP1&lt;&lt;</span>
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :       &quot;ePy2vP2In=&quot;&lt;&lt;ePy2vP2In&lt;&lt;</span>
<span class="lineNum">    2945 </span><span class="lineNoCov">          0 :       &quot;mPy2vP2In=&quot;&lt;&lt;mPy2vP2In&lt;&lt;</span>
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :       &quot;rPy2vP2In=&quot;&lt;&lt;rPy2vP2In&lt;&lt;</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :       &quot;ePy2vP2Out=&quot;&lt;&lt;ePy2vP2Out&lt;&lt;</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :       &quot;mPy2vP2Out=&quot;&lt;&lt;mPy2vP2Out&lt;&lt;</span>
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :       &quot;rPy2vP2Out=&quot;&lt;&lt;rPy2vP2Out&lt;&lt;</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :       &quot;ePy3vP2IO=&quot;&lt;&lt;ePy3vP2IO&lt;&lt;</span>
<span class="lineNum">    2951 </span><span class="lineNoCov">          0 :       &quot;mPy3vP2IO=&quot;&lt;&lt;mPy3vP2IO&lt;&lt;</span>
<span class="lineNum">    2952 </span><span class="lineNoCov">          0 :       &quot;rPy3vP2IO=&quot;&lt;&lt;rPy3vP2IO&lt;&lt;</span>
<span class="lineNum">    2953 </span>            :       //
<span class="lineNum">    2954 </span>            :       //
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :       &quot;ePz1vP0=&quot;&lt;&lt;ePz1vP0&lt;&lt;</span>
<span class="lineNum">    2956 </span><span class="lineNoCov">          0 :       &quot;mPz1vP0=&quot;&lt;&lt;mPz1vP0&lt;&lt;</span>
<span class="lineNum">    2957 </span><span class="lineNoCov">          0 :       &quot;rPz1vP0=&quot;&lt;&lt;rPz1vP0&lt;&lt;</span>
<span class="lineNum">    2958 </span><span class="lineNoCov">          0 :       &quot;ePz2vP0=&quot;&lt;&lt;ePz2vP0&lt;&lt;</span>
<span class="lineNum">    2959 </span><span class="lineNoCov">          0 :       &quot;mPz2vP0=&quot;&lt;&lt;mPz2vP0&lt;&lt;</span>
<span class="lineNum">    2960 </span><span class="lineNoCov">          0 :       &quot;rPz2vP0=&quot;&lt;&lt;rPz2vP0&lt;&lt;</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :       &quot;ePz3vP0=&quot;&lt;&lt;ePz3vP0&lt;&lt;</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">          0 :       &quot;mPz3vP0=&quot;&lt;&lt;mPz3vP0&lt;&lt;</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :       &quot;rPz3vP0=&quot;&lt;&lt;rPz3vP0&lt;&lt;</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :       &quot;ePz1vP1=&quot;&lt;&lt;ePz1vP1&lt;&lt;</span>
<span class="lineNum">    2965 </span><span class="lineNoCov">          0 :       &quot;mPz1vP1=&quot;&lt;&lt;mPz1vP1&lt;&lt;</span>
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :       &quot;rPz1vP1=&quot;&lt;&lt;rPz1vP1&lt;&lt;</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :       &quot;ePz2vP1=&quot;&lt;&lt;ePz2vP1&lt;&lt;</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :       &quot;mPz2vP1=&quot;&lt;&lt;mPz2vP1&lt;&lt;</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :       &quot;rPz2vP1=&quot;&lt;&lt;rPz2vP1&lt;&lt;</span>
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :       &quot;ePz3vP1=&quot;&lt;&lt;ePz3vP1&lt;&lt;</span>
<span class="lineNum">    2971 </span><span class="lineNoCov">          0 :       &quot;mPz3vP1=&quot;&lt;&lt;mPz3vP1&lt;&lt;</span>
<span class="lineNum">    2972 </span><span class="lineNoCov">          0 :       &quot;rPz3vP1=&quot;&lt;&lt;rPz3vP1&lt;&lt;</span>
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :       &quot;ePz2vP2In=&quot;&lt;&lt;ePz2vP2In&lt;&lt;</span>
<span class="lineNum">    2974 </span><span class="lineNoCov">          0 :       &quot;mPz2vP2In=&quot;&lt;&lt;mPz2vP2In&lt;&lt;</span>
<span class="lineNum">    2975 </span><span class="lineNoCov">          0 :       &quot;rPz2vP2In=&quot;&lt;&lt;rPz2vP2In&lt;&lt;</span>
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :       &quot;ePz2vP2Out=&quot;&lt;&lt;ePz2vP2Out&lt;&lt;</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :       &quot;mPz2vP2Out=&quot;&lt;&lt;mPz2vP2Out&lt;&lt;</span>
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :       &quot;rPz2vP2Out=&quot;&lt;&lt;rPz2vP2Out&lt;&lt;</span>
<span class="lineNum">    2979 </span><span class="lineNoCov">          0 :       &quot;ePz3vP2IO=&quot;&lt;&lt;ePz3vP2IO&lt;&lt;  </span>
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :       &quot;mPz3vP2IO=&quot;&lt;&lt;mPz3vP2IO&lt;&lt;</span>
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :       &quot;rPz3vP2IO=&quot;&lt;&lt;rPz3vP2IO&lt;&lt;     </span>
<span class="lineNum">    2982 </span>            :       //
<span class="lineNum">    2983 </span>            :       //
<span class="lineNum">    2984 </span>            :       //
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 :       &quot;lx0=&quot;&lt;&lt;lxyz[0]&lt;&lt;            // reference x</span>
<span class="lineNum">    2986 </span><span class="lineNoCov">          0 :       &quot;lx1=&quot;&lt;&lt;lxyz[1]&lt;&lt;            // reference y</span>
<span class="lineNum">    2987 </span><span class="lineNoCov">          0 :       &quot;lx2=&quot;&lt;&lt;lxyz[2]&lt;&lt;            // refernece z</span>
<span class="lineNum">    2988 </span><span class="lineNoCov">          0 :       &quot;lpx0=&quot;&lt;&lt;lpxyz[0]&lt;&lt;           // reference x</span>
<span class="lineNum">    2989 </span><span class="lineNoCov">          0 :       &quot;lpx1=&quot;&lt;&lt;lpxyz[1]&lt;&lt;          // reference y</span>
<span class="lineNum">    2990 </span><span class="lineNoCov">          0 :       &quot;lpx2=&quot;&lt;&lt;lpxyz[2]&lt;&lt;          // refernece z</span>
<span class="lineNum">    2991 </span>            :       //
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :       &quot;msig=&quot;&lt;&lt;meanS&lt;&lt;</span>
<span class="lineNum">    2993 </span>            :       //
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :       &quot;mphi=&quot;&lt;&lt;meanphi&lt;&lt;         //</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :       &quot;rmsphi=&quot;&lt;&lt;rmsphi&lt;&lt;        //</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :       &quot;gphi1=&quot;&lt;&lt;gphi1&lt;&lt;</span>
<span class="lineNum">    2997 </span><span class="lineNoCov">          0 :       &quot;gphi2=&quot;&lt;&lt;gphi2&lt;&lt;</span>
<span class="lineNum">    2998 </span>            :       //
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :       &quot;mphiP=&quot;&lt;&lt;meanphiP&lt;&lt;       //</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :       &quot;rmsphiP=&quot;&lt;&lt;rmsphiP&lt;&lt;      //</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :       &quot;gphiP1=&quot;&lt;&lt;gphiP1&lt;&lt;</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :       &quot;gphiP2=&quot;&lt;&lt;gphiP2&lt;&lt;</span>
<span class="lineNum">    3003 </span>            :       //
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :       &quot;meanZ=&quot;&lt;&lt;meanZ&lt;&lt;</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :       &quot;rmsZ=&quot;&lt;&lt;rmsZ&lt;&lt;</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :       &quot;gz1=&quot;&lt;&lt;gz1&lt;&lt;</span>
<span class="lineNum">    3007 </span><span class="lineNoCov">          0 :       &quot;gz2=&quot;&lt;&lt;gz2&lt;&lt;</span>
<span class="lineNum">    3008 </span>            :       //
<span class="lineNum">    3009 </span><span class="lineNoCov">          0 :       &quot;gp31=&quot;&lt;&lt;gp31&lt;&lt;            //gaus mean - tgl</span>
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :       &quot;gp32=&quot;&lt;&lt;gp32&lt;&lt;            //gaus rms  -tgl</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :       &quot;meanp3=&quot;&lt;&lt;meanp3&lt;&lt;            //mean - tgl</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">          0 :       &quot;rmsp3=&quot;&lt;&lt;rmsp3&lt;&lt;            //rms  -tgl</span>
<span class="lineNum">    3013 </span><span class="lineNoCov">          0 :       &quot;gp41=&quot;&lt;&lt;gp41&lt;&lt;            //gaus mean - P4</span>
<span class="lineNum">    3014 </span><span class="lineNoCov">          0 :       &quot;gp42=&quot;&lt;&lt;gp42&lt;&lt;            //gaus rms  - P4</span>
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :       &quot;meanp4=&quot;&lt;&lt;meanp4&lt;&lt;            //mean - P4</span>
<span class="lineNum">    3016 </span><span class="lineNoCov">          0 :       &quot;rmsp4=&quot;&lt;&lt;rmsp4&lt;&lt;            //rms  - P4</span>
<span class="lineNum">    3017 </span>            :       // Parameters from abs res analysis
<span class="lineNum">    3018 </span><span class="lineNoCov">          0 :       &quot;SecIn=&quot;&lt;&lt;secInner&lt;&lt;              // inner sector</span>
<span class="lineNum">    3019 </span><span class="lineNoCov">          0 :       &quot;SecOut=&quot;&lt;&lt;secOuter&lt;&lt;             // outer sector</span>
<span class="lineNum">    3020 </span><span class="lineNoCov">          0 :       &quot;lasTanPhiLocIn=&quot;&lt;&lt;lasTanPhiLocIn&lt;&lt; // laser tan phi in local frame (inner)</span>
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :       &quot;lasTanPhiLocOut=&quot;&lt;&lt;lasTanPhiLocOut&lt;&lt;// laser tan phi in local frame (outer)</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :       &quot;ibr.=&quot;&lt;&lt;&amp;vecIBR&lt;&lt;   // radial filed integral</span>
<span class="lineNum">    3023 </span><span class="lineNoCov">          0 :       &quot;ibrphi.=&quot;&lt;&lt;&amp;vecIBRPhi&lt;&lt;   // r=phifiled integral</span>
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :       &quot;ibr.=&quot;&lt;&lt;&amp;vecIBR&lt;&lt;   // radial filed integral</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :       &quot;ibz.=&quot;&lt;&lt;&amp;vecIBZ&lt;&lt;   // z filed integral</span>
<span class="lineNum">    3026 </span>            :       //
<span class="lineNum">    3027 </span><span class="lineNoCov">          0 :       &quot;iblx.=&quot;&lt;&lt;&amp;vecIBLX&lt;&lt;   // local bx  integral</span>
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 :       &quot;ibly.=&quot;&lt;&lt;&amp;vecIBLY&lt;&lt;   // local by integral</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :       &quot;ibgx.=&quot;&lt;&lt;&amp;vecIBGX&lt;&lt;   // global bx  integral</span>
<span class="lineNum">    3030 </span><span class="lineNoCov">          0 :       &quot;ibgy.=&quot;&lt;&lt;&amp;vecIBGY&lt;&lt;   // global by integral</span>
<span class="lineNum">    3031 </span>            :       //
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 :       &quot;X.=&quot;&lt;&lt;&amp;vecX&lt;&lt;       // local x </span>
<span class="lineNum">    3033 </span><span class="lineNoCov">          0 :       &quot;Y.=&quot;&lt;&lt;&amp;vecY&lt;&lt;       // local y </span>
<span class="lineNum">    3034 </span><span class="lineNoCov">          0 :       &quot;R.=&quot;&lt;&lt;&amp;vecR&lt;&lt;       // radius </span>
<span class="lineNum">    3035 </span><span class="lineNoCov">          0 :       &quot;dY.=&quot;&lt;&lt;&amp;vecDY&lt;&lt;     // abs y residuals</span>
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :       &quot;dZ.=&quot;&lt;&lt;&amp;vecDZ&lt;&lt;     // abs z residuals</span>
<span class="lineNum">    3037 </span><span class="lineNoCov">          0 :       &quot;eY.=&quot;&lt;&lt;&amp;vecEy&lt;&lt;     // error of y residuals</span>
<span class="lineNum">    3038 </span><span class="lineNoCov">          0 :       &quot;eZ.=&quot;&lt;&lt;&amp;vecEz&lt;&lt;     // error of z residuals</span>
<span class="lineNum">    3039 </span><span class="lineNoCov">          0 :       &quot;kY.=&quot;&lt;&lt;&amp;vecPhi&lt;&lt;    // local tangent y (fixed for sector)</span>
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :       &quot;kYR.=&quot;&lt;&lt;&amp;vecPhiR&lt;&lt;  // tangent between laser and R vector (varies inside sector) </span>
<span class="lineNum">    3041 </span><span class="lineNoCov">          0 :       &quot;nCl.=&quot;&lt;&lt;&amp;vecN&lt;&lt;     // number of clusters</span>
<span class="lineNum">    3042 </span>            :       //
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 :       &quot;nClInY=&quot;&lt;&lt;nClInY&lt;&lt;               // Number of clusters for inner y</span>
<span class="lineNum">    3044 </span><span class="lineNoCov">          0 :       &quot;yAbsInOffset=&quot;&lt;&lt;yAbsInOffset&lt;&lt; // fitted offset absres (inner y)</span>
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :       &quot;yAbsInSlope=&quot;&lt;&lt;yAbsInSlope &lt;&lt;  // fitted slope absres (inner y)</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :       &quot;yAbsInDeltay=&quot;&lt;&lt;yAbsInDeltay&lt;&lt; // fitted laser offset absres (inner y)</span>
<span class="lineNum">    3047 </span><span class="lineNoCov">          0 :       &quot;nClInZ=&quot;&lt;&lt;nClInZ&lt;&lt;               // Number of clusters for inner z</span>
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 :       &quot;zAbsInOffset=&quot;&lt;&lt;zAbsInOffset&lt;&lt; // fitted offset absres (inner z)</span>
<span class="lineNum">    3049 </span><span class="lineNoCov">          0 :       &quot;zAbsInSlope=&quot;&lt;&lt;zAbsInSlope &lt;&lt;  // fitted slope absres (inner z)</span>
<span class="lineNum">    3050 </span><span class="lineNoCov">          0 :       &quot;zAbsInDeltaz=&quot;&lt;&lt;zAbsInDeltaz&lt;&lt; // fitted laser offset absres (inner z)</span>
<span class="lineNum">    3051 </span>            :       //
<span class="lineNum">    3052 </span><span class="lineNoCov">          0 :       &quot;nClOutY=&quot;&lt;&lt;nClOutY&lt;&lt;               // Number of clusters for outer y</span>
<span class="lineNum">    3053 </span><span class="lineNoCov">          0 :       &quot;yAbsOutOffset=&quot;&lt;&lt;yAbsOutOffset&lt;&lt; // fitted offset absres (outer y)</span>
<span class="lineNum">    3054 </span><span class="lineNoCov">          0 :       &quot;yAbsOutSlope=&quot;&lt;&lt;yAbsOutSlope &lt;&lt;  // fitted slope absres (outer y)</span>
<span class="lineNum">    3055 </span><span class="lineNoCov">          0 :       &quot;yAbsOutDeltay=&quot;&lt;&lt;yAbsOutDeltay&lt;&lt; // fitted laser offset absres (outer y)</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :       &quot;nClOutZ=&quot;&lt;&lt;nClOutZ&lt;&lt;               // Number of clusters for outer z</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">          0 :       &quot;zAbsOutOffset=&quot;&lt;&lt;zAbsOutOffset&lt;&lt; // fitted offset absres (outer z)</span>
<span class="lineNum">    3058 </span><span class="lineNoCov">          0 :       &quot;zAbsOutSlope=&quot;&lt;&lt;zAbsOutSlope &lt;&lt;  // fitted slope absres (outer z)</span>
<span class="lineNum">    3059 </span><span class="lineNoCov">          0 :       &quot;zAbsOutDeltaz=&quot;&lt;&lt;zAbsOutDeltaz&lt;&lt; // fitted laser offset absres (outer z)</span>
<span class="lineNum">    3060 </span>            :       //
<span class="lineNum">    3061 </span>            :       &quot;\n&quot;;
<span class="lineNum">    3062 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :   delete pcstream;</span>
<span class="lineNum">    3064 </span>            :   /*
<span class="lineNum">    3065 </span>            :     Browse the content
<span class="lineNum">    3066 </span>            :     TFile fmean(&quot;laserMean.root&quot;);
<span class="lineNum">    3067 </span>            :     
<span class="lineNum">    3068 </span>            : 
<span class="lineNum">    3069 </span>            :    */
<span class="lineNum">    3070 </span>            : 
<span class="lineNum">    3071 </span>            : 
<span class="lineNum">    3072 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3073 </span>            : 
<a name="3074"><span class="lineNum">    3074 </span>            : </a>
<span class="lineNum">    3075 </span>            : 
<span class="lineNum">    3076 </span>            : void AliTPCcalibLaser::DumpScanInfo(TTree * chain, const char * cutUser){
<span class="lineNum">    3077 </span>            :   //
<span class="lineNum">    3078 </span>            :   //
<span class="lineNum">    3079 </span>            :   //
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :   TTreeSRedirector *pcstream = new TTreeSRedirector(&quot;laserScan.root&quot;);</span>
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 :   TFile * f = pcstream-&gt;GetFile();</span>
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :   f-&gt;mkdir(&quot;dirphi&quot;);</span>
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :   f-&gt;mkdir(&quot;dirphiP&quot;);</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :   f-&gt;mkdir(&quot;dirZ&quot;);</span>
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 :   TF1 fp(&quot;p1&quot;,&quot;pol1&quot;);</span>
<span class="lineNum">    3086 </span>            :   //
<span class="lineNum">    3087 </span>            :   //
<span class="lineNum">    3088 </span><span class="lineNoCov">          0 :   char    cut[1000];</span>
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :   char grname[1000];</span>
<span class="lineNum">    3090 </span><span class="lineNoCov">          0 :   char grnamefull[1000];</span>
<span class="lineNum">    3091 </span>            : 
<span class="lineNum">    3092 </span><span class="lineNoCov">          0 :   Double_t mphi[100];</span>
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :   Double_t mphiP[100];</span>
<span class="lineNum">    3094 </span><span class="lineNoCov">          0 :   Double_t smphi[100];</span>
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :   Double_t smphiP[100];</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">          0 :   Double_t mZ[100];</span>
<span class="lineNum">    3097 </span><span class="lineNoCov">          0 :   Double_t smZ[100];</span>
<span class="lineNum">    3098 </span><span class="lineNoCov">          0 :   Double_t bz[100];</span>
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :   Double_t sbz[100];</span>
<span class="lineNum">    3100 </span>            :   // fit parameters
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :   Double_t pphi[3];</span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :   Double_t pphiP[3];</span>
<span class="lineNum">    3103 </span><span class="lineNoCov">          0 :   Double_t pmZ[3];</span>
<span class="lineNum">    3104 </span>            :   
<span class="lineNum">    3105 </span>            :   //
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    3107 </span>            :     // id =205;
<span class="lineNum">    3108 </span><span class="lineNoCov">          0 :     snprintf(cut,1000,&quot;fId==%d&amp;&amp;%s&quot;,id,cutUser);</span>
<span class="lineNum">    3109 </span><span class="lineNoCov">          0 :     Int_t entries = chain-&gt;Draw(&quot;bz&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3110 </span><span class="lineNoCov">          0 :     if (entries&lt;3) continue;</span>
<span class="lineNum">    3111 </span>            :     AliTPCLaserTrack *ltrp = 0;
<span class="lineNum">    3112 </span><span class="lineNoCov">          0 :     if (!AliTPCLaserTrack::GetTracks()) AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">    3113 </span><span class="lineNoCov">          0 :     ltrp =(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    3114 </span><span class="lineNoCov">          0 :     Double_t lxyz[3];</span>
<span class="lineNum">    3115 </span><span class="lineNoCov">          0 :     Double_t lpxyz[3];</span>
<span class="lineNum">    3116 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetXYZ(lxyz);</span>
<span class="lineNum">    3117 </span><span class="lineNoCov">          0 :     ltrp-&gt;GetPxPyPz(lpxyz);</span>
<span class="lineNum">    3118 </span>            : 
<span class="lineNum">    3119 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;bz&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3120 </span><span class="lineNoCov">          0 :     memcpy(bz, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;0.01*abs(bz)+0.02&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3122 </span><span class="lineNoCov">          0 :     memcpy(sbz, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3123 </span>            :     //
<span class="lineNum">    3124 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;gphi1&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3125 </span><span class="lineNoCov">          0 :     memcpy(mphi, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;0.05*abs(mphi)+abs(gphi2)*0.5+0.05&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3127 </span><span class="lineNoCov">          0 :     memcpy(smphi, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3128 </span>            :     //
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;gphiP1&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3130 </span><span class="lineNoCov">          0 :     memcpy(mphiP, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;0.05*abs(mphiP)+abs(gphiP2)*0.5+0.001&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :     memcpy(smphiP, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3133 </span>            :     //
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;gz1&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3135 </span><span class="lineNoCov">          0 :     memcpy(mZ, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :     chain-&gt;Draw(&quot;0.01*abs(meanZ)+abs(gz2)*0.5+0.1&quot;,cut,&quot;goff&quot;);</span>
<span class="lineNum">    3137 </span><span class="lineNoCov">          0 :     memcpy(smZ, chain-&gt;GetV1(), entries*sizeof(Double_t));</span>
<span class="lineNum">    3138 </span>            :     //
<span class="lineNum">    3139 </span>            :     //
<span class="lineNum">    3140 </span><span class="lineNoCov">          0 :     snprintf(grnamefull,1000,&quot;Side_%d_Bundle_%d_Rod_%d_Beam_%d&quot;,</span>
<span class="lineNum">    3141 </span><span class="lineNoCov">          0 :             ltrp-&gt;GetSide(),  ltrp-&gt;GetBundle(), ltrp-&gt;GetRod(), ltrp-&gt;GetBeam());</span>
<span class="lineNum">    3142 </span>            :     // store data  
<span class="lineNum">    3143 </span>            :     // phi
<span class="lineNum">    3144 </span><span class="lineNoCov">          0 :     f-&gt;cd(&quot;dirphi&quot;);</span>
<span class="lineNum">    3145 </span><span class="lineNoCov">          0 :     Float_t phiB0 =0;</span>
<span class="lineNum">    3146 </span><span class="lineNoCov">          0 :     Float_t phiPB0=0;</span>
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :     Float_t zB0=0;</span>
<span class="lineNum">    3148 </span><span class="lineNoCov">          0 :     for (Int_t ientry=0; ientry&lt;entries; ientry++){</span>
<span class="lineNum">    3149 </span><span class="lineNoCov">          0 :       if (TMath::Abs(bz[ientry])&lt;0.05){</span>
<span class="lineNum">    3150 </span><span class="lineNoCov">          0 :         phiB0  = mphi[ientry];</span>
<span class="lineNum">    3151 </span><span class="lineNoCov">          0 :         phiPB0 = mphiP[ientry];</span>
<span class="lineNum">    3152 </span><span class="lineNoCov">          0 :         zB0    = mZ[ientry];</span>
<span class="lineNum">    3153 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3154 </span>            :     }
<span class="lineNum">    3155 </span><span class="lineNoCov">          0 :     TGraphErrors *grphi = new TGraphErrors(entries,bz,mphi,sbz,smphi);</span>
<span class="lineNum">    3156 </span><span class="lineNoCov">          0 :     grphi-&gt;Draw(&quot;a*&quot;);</span>
<span class="lineNum">    3157 </span><span class="lineNoCov">          0 :     grphi-&gt;Fit(&amp;fp);</span>
<span class="lineNum">    3158 </span><span class="lineNoCov">          0 :     pphi[0] = fp.GetParameter(0);                          // offset</span>
<span class="lineNum">    3159 </span><span class="lineNoCov">          0 :     pphi[1] = fp.GetParameter(1);                          // slope</span>
<span class="lineNum">    3160 </span><span class="lineNoCov">          0 :     pphi[2] = TMath::Sqrt(fp.GetChisquare()/(entries-2.));  // normalized chi2</span>
<span class="lineNum">    3161 </span><span class="lineNoCov">          0 :     snprintf(grname,1000,&quot;phi_id%d&quot;,id);</span>
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :     grphi-&gt;SetName(grname);  grphi-&gt;SetTitle(grnamefull);</span>
<span class="lineNum">    3163 </span><span class="lineNoCov">          0 :     grphi-&gt;GetXaxis()-&gt;SetTitle(&quot;b_{z} (T)&quot;);</span>
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :     grphi-&gt;GetYaxis()-&gt;SetTitle(&quot;#Delta r#phi (cm)&quot;);</span>
<span class="lineNum">    3165 </span><span class="lineNoCov">          0 :     grphi-&gt;SetMaximum(1.2);</span>
<span class="lineNum">    3166 </span><span class="lineNoCov">          0 :     grphi-&gt;SetMinimum(-1.2);</span>
<span class="lineNum">    3167 </span><span class="lineNoCov">          0 :     grphi-&gt;Draw(&quot;a*&quot;);</span>
<span class="lineNum">    3168 </span>            : 
<span class="lineNum">    3169 </span><span class="lineNoCov">          0 :     grphi-&gt;Write();</span>
<span class="lineNum">    3170 </span><span class="lineNoCov">          0 :     gPad-&gt;SaveAs(Form(&quot;pic/phi/phi_%s.gif&quot;,grnamefull));</span>
<span class="lineNum">    3171 </span>            :     // phiP
<span class="lineNum">    3172 </span><span class="lineNoCov">          0 :     f-&gt;cd(&quot;dirphiP)&quot;);</span>
<span class="lineNum">    3173 </span><span class="lineNoCov">          0 :     TGraphErrors *grphiP = new TGraphErrors(entries,bz,mphiP,sbz,smphiP);</span>
<span class="lineNum">    3174 </span><span class="lineNoCov">          0 :     grphiP-&gt;Draw(&quot;a*&quot;);</span>
<span class="lineNum">    3175 </span><span class="lineNoCov">          0 :     grphiP-&gt;Fit(&amp;fp);</span>
<span class="lineNum">    3176 </span><span class="lineNoCov">          0 :     pphiP[0] = fp.GetParameter(0);                          // offset</span>
<span class="lineNum">    3177 </span><span class="lineNoCov">          0 :     pphiP[1] = fp.GetParameter(1);                          // slope</span>
<span class="lineNum">    3178 </span><span class="lineNoCov">          0 :     pphiP[2] = TMath::Sqrt(fp.GetChisquare()/(entries-2.));  // normalized chi2</span>
<span class="lineNum">    3179 </span><span class="lineNoCov">          0 :     snprintf(grname,1000,&quot;phiP_id%d&quot;,id);</span>
<span class="lineNum">    3180 </span><span class="lineNoCov">          0 :     grphiP-&gt;SetName(grname);  grphiP-&gt;SetTitle(grnamefull);</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :     grphiP-&gt;GetXaxis()-&gt;SetTitle(&quot;b_{z} (T)&quot;);</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">          0 :     grphiP-&gt;GetYaxis()-&gt;SetTitle(&quot;#Delta #phi (rad)&quot;);</span>
<span class="lineNum">    3183 </span><span class="lineNoCov">          0 :     grphiP-&gt;SetMaximum(pphiP[0]+0.005);</span>
<span class="lineNum">    3184 </span><span class="lineNoCov">          0 :     grphiP-&gt;SetMinimum(pphiP[0]-0.005);</span>
<span class="lineNum">    3185 </span>            : 
<span class="lineNum">    3186 </span><span class="lineNoCov">          0 :     gPad-&gt;SaveAs(Form(&quot;pic/phiP/phiP_%s.gif&quot;,grnamefull));</span>
<span class="lineNum">    3187 </span><span class="lineNoCov">          0 :     grphiP-&gt;Write();</span>
<span class="lineNum">    3188 </span>            :     //
<span class="lineNum">    3189 </span>            :     //Z
<span class="lineNum">    3190 </span><span class="lineNoCov">          0 :     f-&gt;cd(&quot;dirZ&quot;);</span>
<span class="lineNum">    3191 </span><span class="lineNoCov">          0 :     TGraphErrors *grmZ = new TGraphErrors(entries,bz,mZ,sbz,smZ);</span>
<span class="lineNum">    3192 </span><span class="lineNoCov">          0 :     grmZ-&gt;Draw(&quot;a*&quot;);</span>
<span class="lineNum">    3193 </span><span class="lineNoCov">          0 :     grmZ-&gt;Fit(&amp;fp);</span>
<span class="lineNum">    3194 </span><span class="lineNoCov">          0 :     pmZ[0] = fp.GetParameter(0);                          // offset</span>
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 :     pmZ[1] = fp.GetParameter(1);                          // slope</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :     pmZ[2] = TMath::Sqrt(fp.GetChisquare()/(entries-2.));  // normalized chi2</span>
<span class="lineNum">    3197 </span><span class="lineNoCov">          0 :     snprintf(grname,1000,&quot;mZ_id%d&quot;,id);</span>
<span class="lineNum">    3198 </span><span class="lineNoCov">          0 :     grmZ-&gt;SetName(grname);  grmZ-&gt;SetTitle(grnamefull);</span>
<span class="lineNum">    3199 </span><span class="lineNoCov">          0 :     grmZ-&gt;GetXaxis()-&gt;SetTitle(&quot;b_{z} (T)&quot;);</span>
<span class="lineNum">    3200 </span><span class="lineNoCov">          0 :     grmZ-&gt;GetYaxis()-&gt;SetTitle(&quot;#Delta z (cm)&quot;);</span>
<span class="lineNum">    3201 </span>            : 
<span class="lineNum">    3202 </span><span class="lineNoCov">          0 :     gPad-&gt;SaveAs(Form(&quot;pic/z/z_%s.gif&quot;,grnamefull));</span>
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :     grmZ-&gt;Write();</span>
<span class="lineNum">    3204 </span>            :     //
<span class="lineNum">    3205 </span>            :     // P4
<span class="lineNum">    3206 </span>            :     //
<span class="lineNum">    3207 </span>            : 
<span class="lineNum">    3208 </span><span class="lineNoCov">          0 :     for (Int_t ientry=0; ientry&lt;entries; ientry++){</span>
<span class="lineNum">    3209 </span><span class="lineNoCov">          0 :       (*pcstream)&lt;&lt;&quot;Mean&quot;&lt;&lt;</span>
<span class="lineNum">    3210 </span><span class="lineNoCov">          0 :         &quot;id=&quot;&lt;&lt;id&lt;&lt;</span>
<span class="lineNum">    3211 </span><span class="lineNoCov">          0 :         &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;</span>
<span class="lineNum">    3212 </span><span class="lineNoCov">          0 :         &quot;entries=&quot;&lt;&lt;entries&lt;&lt;</span>
<span class="lineNum">    3213 </span><span class="lineNoCov">          0 :         &quot;bz=&quot;&lt;&lt;bz[ientry]&lt;&lt;</span>
<span class="lineNum">    3214 </span><span class="lineNoCov">          0 :         &quot;lx0=&quot;&lt;&lt;lxyz[0]&lt;&lt;          // reference x</span>
<span class="lineNum">    3215 </span><span class="lineNoCov">          0 :         &quot;lx1=&quot;&lt;&lt;lxyz[1]&lt;&lt;          // reference y</span>
<span class="lineNum">    3216 </span><span class="lineNoCov">          0 :         &quot;lx2=&quot;&lt;&lt;lxyz[2]&lt;&lt;          // refernece z      </span>
<span class="lineNum">    3217 </span><span class="lineNoCov">          0 :         &quot;lpx0=&quot;&lt;&lt;lpxyz[0]&lt;&lt;          // reference x</span>
<span class="lineNum">    3218 </span><span class="lineNoCov">          0 :         &quot;lpx1=&quot;&lt;&lt;lpxyz[1]&lt;&lt;          // reference y</span>
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :         &quot;lpx2=&quot;&lt;&lt;lpxyz[2]&lt;&lt;          // refernece z            </span>
<span class="lineNum">    3220 </span>            :         //values
<span class="lineNum">    3221 </span><span class="lineNoCov">          0 :         &quot;phiB0=&quot;&lt;&lt;phiB0&lt;&lt;          // position shift at 0 field</span>
<span class="lineNum">    3222 </span><span class="lineNoCov">          0 :         &quot;phiPB0=&quot;&lt;&lt;phiPB0&lt;&lt;        // angular  shift at 0 field</span>
<span class="lineNum">    3223 </span><span class="lineNoCov">          0 :         &quot;zB0=&quot;&lt;&lt;zB0&lt;&lt;              // z shift for 0 field</span>
<span class="lineNum">    3224 </span>            :         //
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :         &quot;gphi1=&quot;&lt;&lt;mphi[ientry]&lt;&lt; // mean - from gaus fit</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :         &quot;pphi0=&quot;&lt;&lt;pphi[0]&lt;&lt;   // offset</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 :         &quot;pphi1=&quot;&lt;&lt;pphi[1]&lt;&lt;   // slope</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :         &quot;pphi2=&quot;&lt;&lt;pphi[2]&lt;&lt;   // norm chi2</span>
<span class="lineNum">    3229 </span>            :         //
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :         &quot;gphiP1=&quot;&lt;&lt;mphiP[ientry]&lt;&lt; // mean - from gaus fit</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :         &quot;pphiP0=&quot;&lt;&lt;pphiP[0]&lt;&lt; // offset</span>
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :         &quot;pphiP1=&quot;&lt;&lt;pphiP[1]&lt;&lt; // slope</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :         &quot;pphiP2=&quot;&lt;&lt;pphiP[2]&lt;&lt; // norm chi2</span>
<span class="lineNum">    3234 </span>            :         //
<span class="lineNum">    3235 </span><span class="lineNoCov">          0 :         &quot;gz1=&quot;&lt;&lt;mZ[ientry]&lt;&lt;</span>
<span class="lineNum">    3236 </span><span class="lineNoCov">          0 :         &quot;pmZ0=&quot;&lt;&lt;pmZ[0]&lt;&lt;     // offset</span>
<span class="lineNum">    3237 </span><span class="lineNoCov">          0 :         &quot;pmZ1=&quot;&lt;&lt;pmZ[1]&lt;&lt;     // slope</span>
<span class="lineNum">    3238 </span><span class="lineNoCov">          0 :         &quot;pmZ2=&quot;&lt;&lt;pmZ[2]&lt;&lt;     // norm chi2</span>
<span class="lineNum">    3239 </span>            :         &quot;\n&quot;;
<span class="lineNum">    3240 </span>            :     }
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    3242 </span>            :   
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :   delete pcstream;</span>
<span class="lineNum">    3244 </span>            :   
<span class="lineNum">    3245 </span><span class="lineNoCov">          0 : }</span>
<a name="3246"><span class="lineNum">    3246 </span>            : </a>
<span class="lineNum">    3247 </span>            : 
<span class="lineNum">    3248 </span>            : void AliTPCcalibLaser::Analyze(){
<span class="lineNum">    3249 </span>            :   //
<span class="lineNum">    3250 </span>            :   //
<span class="lineNum">    3251 </span>            :   //
<span class="lineNum">    3252 </span><span class="lineNoCov">          0 : }</span>
<a name="3253"><span class="lineNum">    3253 </span>            : </a>
<span class="lineNum">    3254 </span>            : 
<span class="lineNum">    3255 </span>            : Long64_t AliTPCcalibLaser::Merge(TCollection *li) {
<span class="lineNum">    3256 </span>            : 
<span class="lineNum">    3257 </span><span class="lineNoCov">          0 :   TIterator* iter = li-&gt;MakeIterator();</span>
<span class="lineNum">    3258 </span>            :   AliTPCcalibLaser* cal = 0;
<span class="lineNum">    3259 </span>            :   static Int_t counter0=0;
<span class="lineNum">    3260 </span><span class="lineNoCov">          0 :   while ((cal = (AliTPCcalibLaser*)iter-&gt;Next())) {</span>
<span class="lineNum">    3261 </span><span class="lineNoCov">          0 :     if (!cal-&gt;InheritsFrom(AliTPCcalibLaser::Class())) {</span>
<span class="lineNum">    3262 </span>            :       //      Error(&quot;Merge&quot;,&quot;Attempt to add object of class %s to a %s&quot;, cal-&gt;ClassName(), this-&gt;ClassName());
<span class="lineNum">    3263 </span><span class="lineNoCov">          0 :       return -1;</span>
<span class="lineNum">    3264 </span>            :     }
<span class="lineNum">    3265 </span><span class="lineNoCov">          0 :     AliDebug(5,Form(&quot;Marging number %d\n&quot;, counter0));</span>
<span class="lineNum">    3266 </span><span class="lineNoCov">          0 :     counter0++;</span>
<span class="lineNum">    3267 </span>            :     //
<span class="lineNum">    3268 </span><span class="lineNoCov">          0 :     MergeFitHistos(cal);</span>
<span class="lineNum">    3269 </span>            :     TH1F *h=0x0;
<span class="lineNum">    3270 </span>            :     TH1F *hm=0x0;
<span class="lineNum">    3271 </span>            :     TH2F *h2=0x0;
<span class="lineNum">    3272 </span>            :     TH2F *h2m=0x0;
<span class="lineNum">    3273 </span>            :     //    TProfile *hp=0x0;
<span class="lineNum">    3274 </span>            :     //TProfile *hpm=0x0;
<span class="lineNum">    3275 </span>            : 
<span class="lineNum">    3276 </span><span class="lineNoCov">          0 :     for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    3277 </span>            :       // merge fDeltaZ histograms
<span class="lineNum">    3278 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fDeltaZ.At(id);</span>
<span class="lineNum">    3279 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fDeltaZ.At(id);</span>
<span class="lineNum">    3280 </span><span class="lineNoCov">          0 :       if (!h &amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3281 </span><span class="lineNoCov">          0 :         h=(TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3282 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3283 </span><span class="lineNoCov">          0 :         fDeltaZ.AddAt(h,id);      </span>
<span class="lineNum">    3284 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3285 </span><span class="lineNoCov">          0 :       if (h &amp;&amp; hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3286 </span>            : 
<span class="lineNum">    3287 </span>            :       // merge fP3 histograms
<span class="lineNum">    3288 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fDeltaP3.At(id);</span>
<span class="lineNum">    3289 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fDeltaP3.At(id);</span>
<span class="lineNum">    3290 </span><span class="lineNoCov">          0 :       if (!h&amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3291 </span><span class="lineNoCov">          0 :         h=(TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3292 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3293 </span><span class="lineNoCov">          0 :         fDeltaP3.AddAt(h,id);</span>
<span class="lineNum">    3294 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3295 </span><span class="lineNoCov">          0 :       if (h &amp;&amp; hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3296 </span>            :       // merge fP4 histograms
<span class="lineNum">    3297 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fDeltaP4.At(id);</span>
<span class="lineNum">    3298 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fDeltaP4.At(id);</span>
<span class="lineNum">    3299 </span><span class="lineNoCov">          0 :       if (!h &amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3300 </span><span class="lineNoCov">          0 :         h=(TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3301 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :         fDeltaP4.AddAt(h,id);</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :       if (h&amp;&amp;hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3305 </span>            : 
<span class="lineNum">    3306 </span>            :       //
<span class="lineNum">    3307 </span>            :       // merge fDeltaPhi histograms
<span class="lineNum">    3308 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fDeltaPhi.At(id);</span>
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fDeltaPhi.At(id);</span>
<span class="lineNum">    3310 </span><span class="lineNoCov">          0 :       if (!h &amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3311 </span><span class="lineNoCov">          0 :         h= (TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3312 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3313 </span><span class="lineNoCov">          0 :         fDeltaPhi.AddAt(h,id);</span>
<span class="lineNum">    3314 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3315 </span><span class="lineNoCov">          0 :       if (h&amp;&amp;hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3316 </span>            :       // merge fDeltaPhiP histograms
<span class="lineNum">    3317 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fDeltaPhiP.At(id);</span>
<span class="lineNum">    3318 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fDeltaPhiP.At(id);</span>
<span class="lineNum">    3319 </span><span class="lineNoCov">          0 :       if (!h&amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3320 </span><span class="lineNoCov">          0 :         h=(TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3321 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3322 </span><span class="lineNoCov">          0 :         fDeltaPhiP.AddAt(h,id);</span>
<span class="lineNum">    3323 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3324 </span><span class="lineNoCov">          0 :       if (h&amp;&amp;hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3325 </span>            :       // merge fSignals histograms
<span class="lineNum">    3326 </span><span class="lineNoCov">          0 :       hm = (TH1F*)cal-&gt;fSignals.At(id);</span>
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 :       h  = (TH1F*)fSignals.At(id);</span>
<span class="lineNum">    3328 </span><span class="lineNoCov">          0 :       if (!h&amp;&amp;hm &amp;&amp;hm-&gt;GetEntries()&gt;0) {</span>
<span class="lineNum">    3329 </span><span class="lineNoCov">          0 :         h=(TH1F*)hm-&gt;Clone();</span>
<span class="lineNum">    3330 </span><span class="lineNoCov">          0 :         h-&gt;SetDirectory(0);</span>
<span class="lineNum">    3331 </span><span class="lineNoCov">          0 :         fSignals.AddAt(h,id);</span>
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    3333 </span><span class="lineNoCov">          0 :       if (h&amp;&amp;hm) h-&gt;Add(hm);</span>
<span class="lineNum">    3334 </span>            :       //
<span class="lineNum">    3335 </span>            :       //
<span class="lineNum">    3336 </span>            :       // merge ProfileY histograms -0
<span class="lineNum">    3337 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaYres.At(id);</span>
<span class="lineNum">    3338 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaYres.At(id);</span>
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3340 </span>            :       //
<span class="lineNum">    3341 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaZres.At(id);</span>
<span class="lineNum">    3342 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaZres.At(id);</span>
<span class="lineNum">    3343 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3344 </span>            :       // merge ProfileY histograms - 2
<span class="lineNum">    3345 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaYres2.At(id);</span>
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaYres2.At(id);</span>
<span class="lineNum">    3347 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3348 </span>            :       //
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaZres2.At(id);</span>
<span class="lineNum">    3350 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaZres2.At(id);</span>
<span class="lineNum">    3351 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3352 </span>            : 
<span class="lineNum">    3353 </span>            :       // merge ProfileY histograms - abs
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaYresAbs.At(id);</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaYresAbs.At(id);</span>
<span class="lineNum">    3356 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3357 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;!h2) { h2=(TH2F*)h2m-&gt;Clone(); h2-&gt;SetDirectory(0); fDeltaYresAbs.AddAt(h2,id);}</span>
<span class="lineNum">    3358 </span><span class="lineNoCov">          0 :       h2m = (TH2F*)cal-&gt;fDeltaZresAbs.At(id);</span>
<span class="lineNum">    3359 </span><span class="lineNoCov">          0 :       h2  = (TH2F*)fDeltaZresAbs.At(id);</span>
<span class="lineNum">    3360 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;h2) h2-&gt;Add(h2m);</span>
<span class="lineNum">    3361 </span><span class="lineNoCov">          0 :       if (h2m&amp;&amp;!h2) { h2=(TH2F*)h2m-&gt;Clone(); h2-&gt;SetDirectory(0); fDeltaZresAbs.AddAt(h2,id);}</span>
<span class="lineNum">    3362 </span>            :       // merge ProfileY histograms - 3
<span class="lineNum">    3363 </span>            :       //h2m = (TH2F*)cal-&gt;fDeltaYres3.At(id);
<span class="lineNum">    3364 </span>            :       //h2  = (TH2F*)fDeltaYres3.At(id);
<span class="lineNum">    3365 </span>            :       //if (h2m) h2-&gt;Add(h2m);
<span class="lineNum">    3366 </span>            :       //
<span class="lineNum">    3367 </span>            :       //h2m = (TH2F*)cal-&gt;fDeltaZres3.At(id);
<span class="lineNum">    3368 </span>            :       //h2  = (TH2F*)fDeltaZres3.At(id);
<span class="lineNum">    3369 </span>            :       //if (h2m) h-&gt;Add(h2m);
<span class="lineNum">    3370 </span>            :       //
<span class="lineNum">    3371 </span>            :       //
<span class="lineNum">    3372 </span>            :     }
<span class="lineNum">    3373 </span>            :   }
<span class="lineNum">    3374 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="3375"><span class="lineNum">    3375 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3376 </span>            : 
<span class="lineNum">    3377 </span>            : void AliTPCcalibLaser::MakeFitHistos(){
<span class="lineNum">    3378 </span>            :   //
<span class="lineNum">    3379 </span>            :   // Make a fit histograms
<span class="lineNum">    3380 </span>            :   // 
<span class="lineNum">    3381 </span>            :   // Number of clusters
<span class="lineNum">    3382 </span>            :   //
<span class="lineNum">    3383 </span>            :   //TH2F           *fHisNclIn;      //-&gt;Number of clusters inner
<span class="lineNum">    3384 </span>            :   //TH2F           *fHisNclOut;     //-&gt;Number of clusters outer
<span class="lineNum">    3385 </span>            :   //TH2F           *fHisNclIO;      //-&gt;Number of cluster inner outer
<span class="lineNum">    3386 </span>            :   // TH2F           *fHisdEdx;       //-&gt;dEdx histo
<span class="lineNum">    3387 </span><span class="lineNoCov">          0 :   fHisNclIn = new TH2F(&quot;HisNclIn&quot;,&quot;HisNclIn&quot;,336,0,336,64,10,64);</span>
<span class="lineNum">    3388 </span><span class="lineNoCov">          0 :   fHisNclOut = new TH2F(&quot;HisNclOut&quot;,&quot;HisNclOut&quot;,336,0,336,100,10,100);</span>
<span class="lineNum">    3389 </span><span class="lineNoCov">          0 :   fHisNclIO = new TH2F(&quot;HisNclIO&quot;,&quot;HisNclIO&quot;,336,0,336,kMaxRow,10,kMaxRow);</span>
<span class="lineNum">    3390 </span>            :   //
<span class="lineNum">    3391 </span><span class="lineNoCov">          0 :   fHisLclIn  = new TH2F(&quot;HisLclIn&quot;,&quot;HisLclIn&quot;,336,0,336,64,10,64);</span>
<span class="lineNum">    3392 </span><span class="lineNoCov">          0 :   fHisLclOut = new TH2F(&quot;HisLclOut&quot;,&quot;HisLclOut&quot;,336,0,336,100,10,150);</span>
<span class="lineNum">    3393 </span><span class="lineNoCov">          0 :   fHisLclIO  = new TH2F(&quot;HisLclIO&quot;,&quot;HisLclIO&quot;,336,0,336,kMaxRow,10,kMaxRow);</span>
<span class="lineNum">    3394 </span>            :   //
<span class="lineNum">    3395 </span><span class="lineNoCov">          0 :   fHisdEdx = new TH2F(&quot;HisdEdx&quot;,&quot;HisdEdx&quot;,336,0,336,160,1,50);</span>
<span class="lineNum">    3396 </span><span class="lineNoCov">          0 :   fHisdZfit = new TH2F(&quot;HisdZfit&quot;,&quot;HisdZfit&quot;,336,0,336,300,-0.3,0.3);</span>
<span class="lineNum">    3397 </span>            :   
<span class="lineNum">    3398 </span>            :   //
<span class="lineNum">    3399 </span>            :   //  Chi2
<span class="lineNum">    3400 </span>            :   //
<span class="lineNum">    3401 </span>            :   //   TH2F           *fHisChi2YIn1;      //-&gt;chi2 y inner - line
<span class="lineNum">    3402 </span>            :   //   TH2F           *fHisChi2YOut1;     //-&gt;chi2 y inner - line
<span class="lineNum">    3403 </span>            :   //   TH2F           *fHisChi2YIn2;      //-&gt;chi2 y inner - parabola
<span class="lineNum">    3404 </span>            :   //   TH2F           *fHisChi2YOut2;     //-&gt;chi2 y inner - parabola
<span class="lineNum">    3405 </span>            :   //   TH2F           *fHisChi2YIO1;      //-&gt;chi2 y IO    - common
<span class="lineNum">    3406 </span><span class="lineNoCov">          0 :   fHisChi2YIn1   = new TH2F(&quot;Chi2YIn1&quot;,&quot;Chi2YIn1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 :   fHisChi2YOut1  = new TH2F(&quot;Chi2YOut1&quot;,&quot;Chi2YOut1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3408 </span><span class="lineNoCov">          0 :   fHisChi2YIn2   = new TH2F(&quot;Chi2YIn2&quot;,&quot;Chi2YIn2&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :   fHisChi2YOut2  = new TH2F(&quot;Chi2YOut2&quot;,&quot;Chi2YOut2&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :   fHisChi2YIO1   = new TH2F(&quot;Chi2YIO1&quot;,&quot;Chi2YIO1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3411 </span>            :   //   TH2F           *fHisChi2ZIn1;      //-&gt;chi2 z inner - line
<span class="lineNum">    3412 </span>            :   //   TH2F           *fHisChi2ZOut1;     //-&gt;chi2 z inner - line
<span class="lineNum">    3413 </span>            :   //   TH2F           *fHisChi2ZIn2;      //-&gt;chi2 z inner - parabola
<span class="lineNum">    3414 </span>            :   //   TH2F           *fHisChi2ZOut2;     //-&gt;chi2 z inner - parabola
<span class="lineNum">    3415 </span>            :   //   TH2F           *fHisChi2ZIO1;      //-&gt;chi2 z IO    - common
<span class="lineNum">    3416 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1   = new TH2F(&quot;Chi2ZIn1&quot;,&quot;Chi2ZIn1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3417 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1  = new TH2F(&quot;Chi2ZOut1&quot;,&quot;Chi2ZOut1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3418 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2   = new TH2F(&quot;Chi2ZIn2&quot;,&quot;Chi2ZIn2&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3419 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2  = new TH2F(&quot;Chi2ZOut2&quot;,&quot;Chi2ZOut2&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3420 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1   = new TH2F(&quot;Chi2ZIO1&quot;,&quot;Chi2ZIO1&quot;,336,0,336,500,0.001,0.5);</span>
<span class="lineNum">    3421 </span>            :   //
<span class="lineNum">    3422 </span>            :   // Fit
<span class="lineNum">    3423 </span>            :   //
<span class="lineNum">    3424 </span>            :   //
<span class="lineNum">    3425 </span>            :   //   TH2F           *fHisPy1vP0;     //-&gt; delta y   P0outer-P0inner - line
<span class="lineNum">    3426 </span>            :   //   TH2F           *fHisPy2vP0;     //-&gt; delta y   P0outer-P0inner - parabola
<span class="lineNum">    3427 </span>            :   //   TH2F           *fHisPy3vP0;     //-&gt; delta y   P0outer-P0inner - common parabola
<span class="lineNum">    3428 </span>            :   //   TH2F           *fHisPy1vP1;     //-&gt; delta ky  P1outer-P1inner - line
<span class="lineNum">    3429 </span>            :   //   TH2F           *fHisPy2vP1;     //-&gt; delta ky  P1outer-P1inner - parabola
<span class="lineNum">    3430 </span>            :   //   TH2F           *fHisPy3vP1;     //-&gt; delta ky  P1outer-P1inner - common parabola
<span class="lineNum">    3431 </span>            :   //   TH2F           *fHisPy2vP2In;   //-&gt; Curv  P2inner - parabola
<span class="lineNum">    3432 </span>            :   //   TH2F           *fHisPy2vP2Out;  //-&gt; Curv  P2outer - parabola
<span class="lineNum">    3433 </span>            :   //   TH2F           *fHisPy3vP2IO;   //-&gt; Curv  P2outerinner - common parabola
<span class="lineNum">    3434 </span><span class="lineNoCov">          0 :   fHisPy1vP0   = new TH2F(&quot;HisPy1vP0&quot;,   &quot;HisPy1vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3435 </span><span class="lineNoCov">          0 :   fHisPy2vP0   = new TH2F(&quot;HisPy2vP0&quot;,   &quot;HisPy2vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3436 </span><span class="lineNoCov">          0 :   fHisPy3vP0   = new TH2F(&quot;HisPy3vP0&quot;,   &quot;HisPy3vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3437 </span><span class="lineNoCov">          0 :   fHisPy1vP1   = new TH2F(&quot;HisPy1vP1&quot;,   &quot;HisPy1vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3438 </span><span class="lineNoCov">          0 :   fHisPy2vP1   = new TH2F(&quot;HisPy2vP1&quot;,   &quot;HisPy2vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3439 </span><span class="lineNoCov">          0 :   fHisPy3vP1   = new TH2F(&quot;HisPy3vP1&quot;,   &quot;HisPy3vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3440 </span><span class="lineNoCov">          0 :   fHisPy2vP2In = new TH2F(&quot;HisPy2vP2In&quot;, &quot;HisPy2vP2In&quot;,336,0,336,500,-0.0003,0.0003);</span>
<span class="lineNum">    3441 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out= new TH2F(&quot;HisPy2vP2Out&quot;,&quot;HisPy2vP2Out&quot;,336,0,336,500,-0.0003,0.0003);</span>
<span class="lineNum">    3442 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO = new TH2F(&quot;HisPy3vP2IO&quot;, &quot;HisPy3vP2IO&quot;,336,0,336,500,-0.0003,0.0003);</span>
<span class="lineNum">    3443 </span>            :   //
<span class="lineNum">    3444 </span>            :   //
<span class="lineNum">    3445 </span>            :   //   TH2F           *fHisPz1vP0;     //-&gt; delta z   P0outer-P0inner - line
<span class="lineNum">    3446 </span>            :   //   TH2F           *fHisPz2vP0;     //-&gt; delta z   P0outer-P0inner - parabola
<span class="lineNum">    3447 </span>            :   //   TH2F           *fHisPz3vP0;     //-&gt; delta z   P0outer-P0inner - common parabola
<span class="lineNum">    3448 </span>            :   //   TH2F           *fHisPz1vP1;     //-&gt; delta kz  P1outer-P1inner - line
<span class="lineNum">    3449 </span>            :   //   TH2F           *fHisPz2vP1;     //-&gt; delta kz  P1outer-P1inner - parabola
<span class="lineNum">    3450 </span>            :   //   TH2F           *fHisPz3vP1;     //-&gt; delta kz  P1outer-P1inner - common parabola
<span class="lineNum">    3451 </span>            :   //   TH2F           *fHisPz2vP2In;   //-&gt; Curv  P2inner - parabola
<span class="lineNum">    3452 </span>            :   //   TH2F           *fHisPz2vP2Out;  //-&gt; Curv  P2outer - parabola
<span class="lineNum">    3453 </span>            :   //   TH2F           *fHisPz3vP2IO;   //-&gt; Curv  P2outerinner - common parabola
<span class="lineNum">    3454 </span><span class="lineNoCov">          0 :   fHisPz1vP0   = new TH2F(&quot;HisPz1vP0&quot;,   &quot;HisPz1vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3455 </span><span class="lineNoCov">          0 :   fHisPz2vP0   = new TH2F(&quot;HisPz2vP0&quot;,   &quot;HisPz2vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3456 </span><span class="lineNoCov">          0 :   fHisPz3vP0   = new TH2F(&quot;HisPz3vP0&quot;,   &quot;HisPz3vP0&quot;,336,0,336,500,-0.3,0.3);</span>
<span class="lineNum">    3457 </span><span class="lineNoCov">          0 :   fHisPz1vP1   = new TH2F(&quot;HisPz1vP1&quot;,   &quot;HisPz1vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3458 </span><span class="lineNoCov">          0 :   fHisPz2vP1   = new TH2F(&quot;HisPz2vP1&quot;,   &quot;HisPz2vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3459 </span><span class="lineNoCov">          0 :   fHisPz3vP1   = new TH2F(&quot;HisPz3vP1&quot;,   &quot;HisPz3vP1&quot;,336,0,336,500,-0.01,0.01);</span>
<span class="lineNum">    3460 </span><span class="lineNoCov">          0 :   fHisPz2vP2In = new TH2F(&quot;HisPz2vP2In&quot;, &quot;HisPz2vP2In&quot;,336,0,336,500,-0.0003,0.0003);</span>
<span class="lineNum">    3461 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out= new TH2F(&quot;HisPz2vP2Out&quot;,&quot;HisPz2vP2Out&quot;,336,0,336,500,-0.0002,0.0002);</span>
<span class="lineNum">    3462 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO = new TH2F(&quot;HisPz3vP2IO&quot;, &quot;HisPz3vP2IO&quot;,336,0,336,500,-0.0002,0.0002);</span>
<span class="lineNum">    3463 </span>            :   
<span class="lineNum">    3464 </span><span class="lineNoCov">          0 :   fHisYAbsErrors = new TH1F(&quot;HisYabsErrors&quot;, &quot;Errors per beam (y)&quot;, 336, 0, 336);</span>
<span class="lineNum">    3465 </span><span class="lineNoCov">          0 :   fHisZAbsErrors = new TH1F(&quot;HisZabsErrors&quot;, &quot;Errors per beam (z)&quot;, 336, 0, 336);</span>
<span class="lineNum">    3466 </span>            : 
<span class="lineNum">    3467 </span><span class="lineNoCov">          0 :   fHisNclIn-&gt;SetDirectory(0);      //-&gt;Number of clusters inner</span>
<span class="lineNum">    3468 </span><span class="lineNoCov">          0 :   fHisNclOut-&gt;SetDirectory(0);     //-&gt;Number of clusters outer</span>
<span class="lineNum">    3469 </span><span class="lineNoCov">          0 :   fHisNclIO-&gt;SetDirectory(0);      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3470 </span><span class="lineNoCov">          0 :   fHisLclIn-&gt;SetDirectory(0);      //-&gt;Level arm inner</span>
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :   fHisLclOut-&gt;SetDirectory(0);     //-&gt;Level arm outer</span>
<span class="lineNum">    3472 </span><span class="lineNoCov">          0 :   fHisLclIO-&gt;SetDirectory(0);      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3473 </span><span class="lineNoCov">          0 :   fHisdEdx-&gt;SetDirectory(0);      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3474 </span><span class="lineNoCov">          0 :   fHisdZfit-&gt;SetDirectory(0);      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3475 </span>            :   //
<span class="lineNum">    3476 </span>            :   //
<span class="lineNum">    3477 </span><span class="lineNoCov">          0 :   fHisChi2YIn1-&gt;SetDirectory(0);      //-&gt;chi2 y inner - line</span>
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :   fHisChi2YOut1-&gt;SetDirectory(0);     //-&gt;chi2 y inner - line</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :   fHisChi2YIn2-&gt;SetDirectory(0);      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    3480 </span><span class="lineNoCov">          0 :   fHisChi2YOut2-&gt;SetDirectory(0);     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    3481 </span><span class="lineNoCov">          0 :   fHisChi2YIO1-&gt;SetDirectory(0);      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">    3482 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1-&gt;SetDirectory(0);      //-&gt;chi2 z inner - line</span>
<span class="lineNum">    3483 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1-&gt;SetDirectory(0);     //-&gt;chi2 z inner - line</span>
<span class="lineNum">    3484 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2-&gt;SetDirectory(0);      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    3485 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2-&gt;SetDirectory(0);     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1-&gt;SetDirectory(0);      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">    3487 </span>            :   //
<span class="lineNum">    3488 </span>            :   //
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :   fHisPy1vP0-&gt;SetDirectory(0);     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :   fHisPy2vP0-&gt;SetDirectory(0);     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">    3491 </span><span class="lineNoCov">          0 :   fHisPy3vP0-&gt;SetDirectory(0);     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">    3492 </span><span class="lineNoCov">          0 :   fHisPy1vP1-&gt;SetDirectory(0);     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">    3493 </span><span class="lineNoCov">          0 :   fHisPy2vP1-&gt;SetDirectory(0);     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">    3494 </span><span class="lineNoCov">          0 :   fHisPy3vP1-&gt;SetDirectory(0);     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">    3495 </span><span class="lineNoCov">          0 :   fHisPy2vP2In-&gt;SetDirectory(0);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    3496 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out-&gt;SetDirectory(0);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    3497 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO-&gt;SetDirectory(0);   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    3498 </span>            :   //
<span class="lineNum">    3499 </span>            :   //
<span class="lineNum">    3500 </span><span class="lineNoCov">          0 :   fHisPz1vP0-&gt;SetDirectory(0);     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">    3501 </span><span class="lineNoCov">          0 :   fHisPz2vP0-&gt;SetDirectory(0);     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">    3502 </span><span class="lineNoCov">          0 :   fHisPz3vP0-&gt;SetDirectory(0);     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">    3503 </span><span class="lineNoCov">          0 :   fHisPz1vP1-&gt;SetDirectory(0);     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">    3504 </span><span class="lineNoCov">          0 :   fHisPz2vP1-&gt;SetDirectory(0);     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">    3505 </span><span class="lineNoCov">          0 :   fHisPz3vP1-&gt;SetDirectory(0);     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">    3506 </span><span class="lineNoCov">          0 :   fHisPz2vP2In-&gt;SetDirectory(0);   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    3507 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out-&gt;SetDirectory(0);  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    3508 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO-&gt;SetDirectory(0);   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    3509 </span>            : 
<span class="lineNum">    3510 </span><span class="lineNoCov">          0 :   fHisYAbsErrors-&gt;SetDirectory(0); //-&gt; total errors per beam in the abs res y analysis</span>
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :   fHisZAbsErrors-&gt;SetDirectory(0); //-&gt; total errors per beam in the abs res z analysis</span>
<span class="lineNum">    3512 </span>            : 
<span class="lineNum">    3513 </span>            :   
<span class="lineNum">    3514 </span>            : 
<span class="lineNum">    3515 </span>            :   //
<span class="lineNum">    3516 </span>            :   //
<span class="lineNum">    3517 </span>            :   //
<span class="lineNum">    3518 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336;id++){</span>
<span class="lineNum">    3519 </span><span class="lineNoCov">          0 :     TH2F *profy = (TH2F*)fDeltaYres.UncheckedAt(id);</span>
<span class="lineNum">    3520 </span><span class="lineNoCov">          0 :     TH2F *profz = (TH2F*)fDeltaZres.UncheckedAt(id);</span>
<span class="lineNum">    3521 </span>            :     //TH2F *profy2 = (TH2F*)fDeltaYres2.UncheckedAt(id);
<span class="lineNum">    3522 </span>            :     TH2F *profy2 = 0;
<span class="lineNum">    3523 </span>            :     TH2F *profz2 = 0;//(TH2F*)fDeltaZres2.UncheckedAt(id);
<span class="lineNum">    3524 </span>            :     TH2F *profyabs = 0; //(TH2F*)fDeltaYresAbs.UncheckedAt(id);
<span class="lineNum">    3525 </span>            :     TH2F *profzabs = 0; //(TH2F*)fDeltaYresAbs.UncheckedAt(id);
<span class="lineNum">    3526 </span>            :     //    TH2F *profy3 = (TH2F*)fDeltaYres3.UncheckedAt(id);
<span class="lineNum">    3527 </span>            :     //TH2F *profz3 = (TH2F*)fDeltaZres3.UncheckedAt(id);
<span class="lineNum">    3528 </span><span class="lineNoCov">          0 :     if (!profy){</span>
<span class="lineNum">    3529 </span><span class="lineNoCov">          0 :       profy=new TH2F(Form(&quot;pry%03d&quot;,id),Form(&quot;Y Residuals for Laser Beam %03d -Linear&quot;,id),160,0,160,50,-0.5,0.5);</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :       profy-&gt;SetDirectory(0);</span>
<span class="lineNum">    3531 </span><span class="lineNoCov">          0 :       fDeltaYres.AddAt(profy,id);</span>
<span class="lineNum">    3532 </span><span class="lineNoCov">          0 :       profy2=new TH2F(Form(&quot;pry%03d&quot;,id),Form(&quot;Y Residuals for Laser Beam %03d -Parabolic&quot;,id),160,0,160,50,-0.5,0.5);</span>
<span class="lineNum">    3533 </span><span class="lineNoCov">          0 :       profy2-&gt;SetDirectory(0);</span>
<span class="lineNum">    3534 </span><span class="lineNoCov">          0 :       fDeltaYres2.AddAt(profy2,id);</span>
<span class="lineNum">    3535 </span><span class="lineNoCov">          0 :       if(!fUseFixedDriftV)</span>
<span class="lineNum">    3536 </span><span class="lineNoCov">          0 :         profyabs=new TH2F(Form(&quot;pryabs%03d&quot;,id),Form(&quot;Y Residuals for Laser Beam %03d -Absolute&quot;,id),160,0,160,100,-1.0,1.0); // has to be bigger based on earlier studies</span>
<span class="lineNum">    3537 </span>            :       else
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :         profyabs=new TH2F(Form(&quot;pryabs%03d&quot;,id),Form(&quot;Y Residuals for Laser Beam %03d -Absolute&quot;,id),160,0,160,200,-2.0,2.0); // has to be bigger based on earlier studies</span>
<span class="lineNum">    3539 </span><span class="lineNoCov">          0 :       profyabs-&gt;SetDirectory(0);</span>
<span class="lineNum">    3540 </span><span class="lineNoCov">          0 :       fDeltaYresAbs.AddAt(profyabs,id);</span>
<span class="lineNum">    3541 </span>            :       //profy3=new TH2F(Form(&quot;pry%03d&quot;,id),Form(&quot;Y Residuals for Laser Beam %03d- Parabolic2&quot;,id),160,0,160,100,-0.5,0.5);
<span class="lineNum">    3542 </span>            :       //profy3-&gt;SetDirectory(0);
<span class="lineNum">    3543 </span>            :       //fDeltaYres3.AddAt(profy3,id);
<span class="lineNum">    3544 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    3545 </span><span class="lineNoCov">          0 :     if (!profz){</span>
<span class="lineNum">    3546 </span><span class="lineNoCov">          0 :       profz=new TH2F(Form(&quot;prz%03d&quot;,id),Form(&quot;Z Residuals for Laser Beam %03d Linear&quot;,id),160,0,160,50,-0.5,0.5);</span>
<span class="lineNum">    3547 </span><span class="lineNoCov">          0 :       profz-&gt;SetDirectory(0);</span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :       fDeltaZres.AddAt(profz,id);</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :       profz2=new TH2F(Form(&quot;prz%03d&quot;,id),Form(&quot;Z Residuals for Laser Beam %03d - Parabolic&quot;,id),160,0,160,50,-0.5,0.5);</span>
<span class="lineNum">    3550 </span><span class="lineNoCov">          0 :       profz2-&gt;SetDirectory(0);</span>
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :       fDeltaZres2.AddAt(profz2,id);</span>
<span class="lineNum">    3552 </span><span class="lineNoCov">          0 :       if(!fUseFixedDriftV)</span>
<span class="lineNum">    3553 </span><span class="lineNoCov">          0 :         profzabs=new TH2F(Form(&quot;przabs%03d&quot;,id),Form(&quot;Z Residuals for Laser Beam %03d -Absolute&quot;,id),160,0,160,100,-1.0,1.0); // has to be bigger based on earlier studies</span>
<span class="lineNum">    3554 </span>            :       else
<span class="lineNum">    3555 </span><span class="lineNoCov">          0 :         profzabs=new TH2F(Form(&quot;przabs%03d&quot;,id),Form(&quot;Z Residuals for Laser Beam %03d -Absolute&quot;,id),160,0,160,200,-2.0,2.0); // has to be bigger based on earlier studies</span>
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 :       profzabs-&gt;SetDirectory(0);</span>
<span class="lineNum">    3557 </span><span class="lineNoCov">          0 :       fDeltaZresAbs.AddAt(profzabs,id);</span>
<span class="lineNum">    3558 </span>            :       //profz3=new TH2F(Form(&quot;prz%03d&quot;,id),Form(&quot;Z Residuals for Laser Beam %03d- Parabolic2&quot;,id),160,0,160,100,-0.5,0.5);
<span class="lineNum">    3559 </span>            :       //profz3-&gt;SetDirectory(0);
<span class="lineNum">    3560 </span>            :       //fDeltaZres3.AddAt(profz3,id);
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    3562 </span>            :   }
<span class="lineNum">    3563 </span>            :   //
<span class="lineNum">    3564 </span>            :   //
<span class="lineNum">    3565 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336;id++){</span>
<span class="lineNum">    3566 </span><span class="lineNoCov">          0 :     TH1F * hisdz = (TH1F*)fDeltaZ.At(id);</span>
<span class="lineNum">    3567 </span>            :     //TH1F * hisP3 = (TH1F*)fDeltaP3.At(id);
<span class="lineNum">    3568 </span>            :     TH1F * hisP3 = 0;
<span class="lineNum">    3569 </span>            :     TH1F * hisP4 = 0;
<span class="lineNum">    3570 </span>            :     
<span class="lineNum">    3571 </span>            :     TH1F * hisdphi = 0;//(TH1F*)fDeltaPhi.At(id);
<span class="lineNum">    3572 </span>            :     TH1F * hisdphiP = 0;//(TH1F*)fDeltaPhiP.At(id);
<span class="lineNum">    3573 </span>            :     TH1F * hisSignal = 0; //(TH1F*)fSignals.At(id);
<span class="lineNum">    3574 </span>            : 
<span class="lineNum">    3575 </span><span class="lineNoCov">          0 :     if (!hisdz){</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 :       hisdz = new TH1F(Form(&quot;hisdz%d&quot;,id),Form(&quot;hisdz%d&quot;,id),1000,-10,10);</span>
<span class="lineNum">    3577 </span><span class="lineNoCov">          0 :       hisdz-&gt;SetDirectory(0);</span>
<span class="lineNum">    3578 </span><span class="lineNoCov">          0 :       fDeltaZ.AddAt(hisdz,id);</span>
<span class="lineNum">    3579 </span>            : 
<span class="lineNum">    3580 </span><span class="lineNoCov">          0 :       hisP3 = new TH1F(Form(&quot;hisPar3v%d&quot;,id),Form(&quot;hisPar3v%d&quot;,id),400,-0.06,0.06);</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">          0 :       hisP3-&gt;SetDirectory(0);</span>
<span class="lineNum">    3582 </span><span class="lineNoCov">          0 :       fDeltaP3.AddAt(hisP3,id);</span>
<span class="lineNum">    3583 </span>            :       //
<span class="lineNum">    3584 </span><span class="lineNoCov">          0 :       hisP4 = new TH1F(Form(&quot;hisPar4v%d&quot;,id),Form(&quot;hisPar4v%d&quot;,id),200,-0.06,0.06);</span>
<span class="lineNum">    3585 </span><span class="lineNoCov">          0 :       hisP4-&gt;SetDirectory(0);</span>
<span class="lineNum">    3586 </span><span class="lineNoCov">          0 :       fDeltaP4.AddAt(hisP4,id);</span>
<span class="lineNum">    3587 </span>            : 
<span class="lineNum">    3588 </span>            :       //
<span class="lineNum">    3589 </span><span class="lineNoCov">          0 :       hisdphi = new TH1F(Form(&quot;hisdphi%d&quot;,id),Form(&quot;hisdphi%d&quot;,id),1000,-1,1);</span>
<span class="lineNum">    3590 </span><span class="lineNoCov">          0 :       hisdphi-&gt;SetDirectory(0);</span>
<span class="lineNum">    3591 </span><span class="lineNoCov">          0 :       fDeltaPhi.AddAt(hisdphi,id);</span>
<span class="lineNum">    3592 </span>            :       //
<span class="lineNum">    3593 </span><span class="lineNoCov">          0 :       hisdphiP = new TH1F(Form(&quot;hisdphiP%d&quot;,id),Form(&quot;hisdphiP%d&quot;,id),1000,-0.01,0.01);</span>
<span class="lineNum">    3594 </span><span class="lineNoCov">          0 :       hisdphiP-&gt;SetDirectory(0);</span>
<span class="lineNum">    3595 </span><span class="lineNoCov">          0 :       fDeltaPhiP.AddAt(hisdphiP,id);</span>
<span class="lineNum">    3596 </span><span class="lineNoCov">          0 :       hisSignal = new TH1F(Form(&quot;hisSignal%d&quot;,id),Form(&quot;hisSignal%d&quot;,id),100,0,300);</span>
<span class="lineNum">    3597 </span><span class="lineNoCov">          0 :       hisSignal-&gt;SetDirectory(0);</span>
<span class="lineNum">    3598 </span><span class="lineNoCov">          0 :       fSignals.AddAt(hisSignal,id);</span>
<span class="lineNum">    3599 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    3600 </span>            :   }
<span class="lineNum">    3601 </span>            : 
<span class="lineNum">    3602 </span>            :   //
<span class="lineNum">    3603 </span>            :   // Make THnSparse
<span class="lineNum">    3604 </span>            :   //
<span class="lineNum">    3605 </span>            :   //                   id   side   rod  bundle  beam  dP0  dP1  dP2  dP3  dP4 ncl dEdx 
<span class="lineNum">    3606 </span><span class="lineNoCov">          0 :   Int_t binsLaser[12]= {336,  //id</span>
<span class="lineNum">    3607 </span>            :                         2,    //side
<span class="lineNum">    3608 </span>            :                         6,    //rod
<span class="lineNum">    3609 </span>            :                         4,    //bundle
<span class="lineNum">    3610 </span>            :                         7,    //beam
<span class="lineNum">    3611 </span>            :                         300,  //dP0
<span class="lineNum">    3612 </span>            :                         300,  //dP1
<span class="lineNum">    3613 </span>            :                         300,  //dP2
<span class="lineNum">    3614 </span>            :                         300,  //dP3
<span class="lineNum">    3615 </span>            :                         300,  //dP4
<span class="lineNum">    3616 </span>            :                         80,   //ncl
<span class="lineNum">    3617 </span>            :                         50};   //dEdx
<span class="lineNum">    3618 </span><span class="lineNoCov">          0 :   Double_t xminLaser[12]= {0,  //id</span>
<span class="lineNum">    3619 </span>            :                         0,     //side
<span class="lineNum">    3620 </span>            :                         0,     //rod
<span class="lineNum">    3621 </span>            :                         0,     //bundle
<span class="lineNum">    3622 </span>            :                         0,     //beam
<span class="lineNum">    3623 </span>            :                         -1,    //dP0
<span class="lineNum">    3624 </span>            :                         -1,    //dP1
<span class="lineNum">    3625 </span>            :                         -0.01,   //dP2
<span class="lineNum">    3626 </span>            :                         -0.01,  //dP3
<span class="lineNum">    3627 </span>            :                         -0.1,  //dP4
<span class="lineNum">    3628 </span>            :                         0,   //ncl
<span class="lineNum">    3629 </span>            :                         0};   //sqrt dEdx
<span class="lineNum">    3630 </span><span class="lineNoCov">          0 :   Double_t xmaxLaser[12]= {336,  //id</span>
<span class="lineNum">    3631 </span>            :                         2,    //side
<span class="lineNum">    3632 </span>            :                         6,    //rod
<span class="lineNum">    3633 </span>            :                         4,    //bundle
<span class="lineNum">    3634 </span>            :                         7,    //beam
<span class="lineNum">    3635 </span>            :                         1,  //dP0
<span class="lineNum">    3636 </span>            :                         1,  //dP1
<span class="lineNum">    3637 </span>            :                         0.01,  //dP2
<span class="lineNum">    3638 </span>            :                         0.01,  //dP3
<span class="lineNum">    3639 </span>            :                         0.1,  //dP4
<span class="lineNum">    3640 </span>            :                         160,   //ncl
<span class="lineNum">    3641 </span>            :                         40};   //sqrt dEdx
<span class="lineNum">    3642 </span>            :   
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :   TString nameLaser[12]= {&quot;id&quot;,</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">          0 :                           &quot;side&quot;,</span>
<span class="lineNum">    3645 </span><span class="lineNoCov">          0 :                           &quot;rod&quot;,</span>
<span class="lineNum">    3646 </span><span class="lineNoCov">          0 :                           &quot;bundle&quot;,</span>
<span class="lineNum">    3647 </span><span class="lineNoCov">          0 :                           &quot;beam&quot;,</span>
<span class="lineNum">    3648 </span><span class="lineNoCov">          0 :                           &quot;dP0&quot;,</span>
<span class="lineNum">    3649 </span><span class="lineNoCov">          0 :                           &quot;dP1&quot;,</span>
<span class="lineNum">    3650 </span><span class="lineNoCov">          0 :                           &quot;dP2&quot;,</span>
<span class="lineNum">    3651 </span><span class="lineNoCov">          0 :                           &quot;dP3&quot;,</span>
<span class="lineNum">    3652 </span><span class="lineNoCov">          0 :                           &quot;dP4&quot;,</span>
<span class="lineNum">    3653 </span><span class="lineNoCov">          0 :                           &quot;ncl&quot;,</span>
<span class="lineNum">    3654 </span><span class="lineNoCov">          0 :                           &quot;sqrt dEdx&quot;};</span>
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :   TString titleLaser[12]= {&quot;id&quot;,</span>
<span class="lineNum">    3656 </span><span class="lineNoCov">          0 :                           &quot;side&quot;,</span>
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :                           &quot;rod&quot;,</span>
<span class="lineNum">    3658 </span><span class="lineNoCov">          0 :                           &quot;bundle&quot;,</span>
<span class="lineNum">    3659 </span><span class="lineNoCov">          0 :                           &quot;beam&quot;,</span>
<span class="lineNum">    3660 </span><span class="lineNoCov">          0 :                           &quot;#Delta_{P0}&quot;,</span>
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :                           &quot;#Delta_{P1}&quot;,</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 :                           &quot;#Delta_{P2}&quot;,</span>
<span class="lineNum">    3663 </span><span class="lineNoCov">          0 :                           &quot;#Delta_{P3}&quot;,</span>
<span class="lineNum">    3664 </span><span class="lineNoCov">          0 :                           &quot;#Delta_{P4}&quot;,</span>
<span class="lineNum">    3665 </span><span class="lineNoCov">          0 :                           &quot;N_{cl}&quot;,</span>
<span class="lineNum">    3666 </span><span class="lineNoCov">          0 :                           &quot;#sqrt{dEdx}&quot;};</span>
<span class="lineNum">    3667 </span><span class="lineNoCov">          0 :   fHisLaser = new THnSparseS(&quot;dLaser&quot;,&quot;#Delta_{Laser}&quot;, 12, binsLaser,xminLaser, xmaxLaser);</span>
<span class="lineNum">    3668 </span><span class="lineNoCov">          0 :   for (Int_t iaxis=1; iaxis&lt;12; iaxis++){</span>
<span class="lineNum">    3669 </span><span class="lineNoCov">          0 :     fHisLaser-&gt;GetAxis(iaxis)-&gt;SetName(nameLaser[iaxis]);</span>
<span class="lineNum">    3670 </span><span class="lineNoCov">          0 :     fHisLaser-&gt;GetAxis(iaxis)-&gt;SetTitle(titleLaser[iaxis]);</span>
<span class="lineNum">    3671 </span>            :   }
<span class="lineNum">    3672 </span>            :   //
<span class="lineNum">    3673 </span>            :   //                  Delta       Time bin
<span class="lineNum">    3674 </span>            :   //                              Pad        SigmaShape      Q charge  pad row  trackID
<span class="lineNum">    3675 </span><span class="lineNoCov">          0 :   Int_t   binsRow[6]={200,        10000,           20,            30,     kMaxRow,  336};</span>
<span class="lineNum">    3676 </span><span class="lineNoCov">          0 :   Double_t axisMin[6]={-1,             0,           0,            1,     0  ,    0};</span>
<span class="lineNum">    3677 </span><span class="lineNoCov">          0 :   Double_t axisMax[6]={ 1,          1000,           1,           30,     kMaxRow,  336};</span>
<span class="lineNum">    3678 </span><span class="lineNoCov">          0 :   TString axisName[6]={&quot;Delta&quot;,&quot;bin&quot;, &quot;rms shape&quot;, &quot;sqrt(Q)&quot;, &quot;row&quot;,&quot;trackID&quot;};</span>
<span class="lineNum">    3679 </span>            : 
<span class="lineNum">    3680 </span><span class="lineNoCov">          0 :   binsRow[1]=2000;</span>
<span class="lineNum">    3681 </span><span class="lineNoCov">          0 :   axisMin[1]=0;</span>
<span class="lineNum">    3682 </span><span class="lineNoCov">          0 :   axisMax[1]=200;</span>
<span class="lineNum">    3683 </span><span class="lineNoCov">          0 :   fHisLaserPad = new THnSparseS(&quot;laserPad&quot;,&quot;#Delta_{Laser}&quot;, 6, binsRow,axisMin, axisMax);  </span>
<span class="lineNum">    3684 </span>            :   //
<span class="lineNum">    3685 </span><span class="lineNoCov">          0 :   binsRow[0]=1000;</span>
<span class="lineNum">    3686 </span><span class="lineNoCov">          0 :   axisMin[0]=-20;</span>
<span class="lineNum">    3687 </span><span class="lineNoCov">          0 :   axisMax[0]=20;</span>
<span class="lineNum">    3688 </span><span class="lineNoCov">          0 :   binsRow[1]=10000;</span>
<span class="lineNum">    3689 </span><span class="lineNoCov">          0 :   axisMin[1]=0;</span>
<span class="lineNum">    3690 </span><span class="lineNoCov">          0 :   axisMax[1]=1000;</span>
<span class="lineNum">    3691 </span>            :   //
<span class="lineNum">    3692 </span><span class="lineNoCov">          0 :   fHisLaserTime= new THnSparseS(&quot;laserTime&quot;,&quot;#Delta_{Laser}&quot;, 6, binsRow,axisMin, axisMax);</span>
<span class="lineNum">    3693 </span>            :   //
<span class="lineNum">    3694 </span><span class="lineNoCov">          0 :   for (Int_t iaxis=0; iaxis&lt;6; iaxis++){</span>
<span class="lineNum">    3695 </span><span class="lineNoCov">          0 :     fHisLaserPad-&gt;GetAxis(iaxis)-&gt;SetName(axisName[iaxis]);</span>
<span class="lineNum">    3696 </span><span class="lineNoCov">          0 :     fHisLaserTime-&gt;GetAxis(iaxis)-&gt;SetTitle(axisName[iaxis]);</span>
<span class="lineNum">    3697 </span>            :   }
<a name="3698"><span class="lineNum">    3698 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3699 </span>            : 
<span class="lineNum">    3700 </span>            : void AliTPCcalibLaser::UpdateFitHistos(){
<span class="lineNum">    3701 </span>            :   //create the fit histos and set the beam parameters(needs OCDB access)
<span class="lineNum">    3702 </span><span class="lineNoCov">          0 :   MakeFitHistos();</span>
<span class="lineNum">    3703 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetZOuter, fBeamSlopeZOuter, fBeamSectorOuter,2);</span>
<span class="lineNum">    3704 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetZInner, fBeamSlopeZInner, fBeamSectorInner,3);</span>
<span class="lineNum">    3705 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetYOuter, fBeamSlopeYOuter, fBeamSectorOuter,0);</span>
<span class="lineNum">    3706 </span><span class="lineNoCov">          0 :   SetBeamParameters(fBeamOffsetYInner, fBeamSlopeYInner, fBeamSectorInner,1);</span>
<a name="3707"><span class="lineNum">    3707 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3708 </span>            : 
<span class="lineNum">    3709 </span>            : void AliTPCcalibLaser::MergeFitHistos(AliTPCcalibLaser * laser){
<span class="lineNum">    3710 </span>            :   //
<span class="lineNum">    3711 </span>            :   // Merge content of histograms 
<span class="lineNum">    3712 </span>            :   //
<span class="lineNum">    3713 </span>            :   // Only first histogram is checked - all other should be the same
<span class="lineNum">    3714 </span><span class="lineNoCov">          0 :   if (fHisLaser &amp;&amp;laser-&gt;fHisLaser) fHisLaser-&gt;Add(laser-&gt;fHisLaser);</span>
<span class="lineNum">    3715 </span><span class="lineNoCov">          0 :   if (fHisLaserPad &amp;&amp;laser-&gt;fHisLaserPad) fHisLaserPad-&gt;Add(laser-&gt;fHisLaserPad);</span>
<span class="lineNum">    3716 </span><span class="lineNoCov">          0 :   if (!fHisLaserPad &amp;&amp;laser-&gt;fHisLaserPad) fHisLaserPad=(THnSparseS*)laser-&gt;fHisLaserPad-&gt;Clone();</span>
<span class="lineNum">    3717 </span><span class="lineNoCov">          0 :   if (fHisLaserTime &amp;&amp;laser-&gt;fHisLaserTime) fHisLaserTime-&gt;Add(laser-&gt;fHisLaserTime);</span>
<span class="lineNum">    3718 </span><span class="lineNoCov">          0 :   if (!fHisLaserTime &amp;&amp;laser-&gt;fHisLaserTime) fHisLaserTime=(THnSparseS*)laser-&gt;fHisLaserTime-&gt;Clone();</span>
<span class="lineNum">    3719 </span>            :   
<span class="lineNum">    3720 </span><span class="lineNoCov">          0 :   if (!laser-&gt;fHisNclIn) laser-&gt;MakeFitHistos();  // empty histograms</span>
<span class="lineNum">    3721 </span><span class="lineNoCov">          0 :   if (!fHisNclIn) MakeFitHistos();</span>
<span class="lineNum">    3722 </span><span class="lineNoCov">          0 :   if (fHisNclIn-&gt;GetEntries()&lt;1) MakeFitHistos();</span>
<span class="lineNum">    3723 </span>            :   //
<span class="lineNum">    3724 </span><span class="lineNoCov">          0 :   fHisNclIn-&gt;Add(laser-&gt;fHisNclIn  );      //-&gt;Number of clusters inner</span>
<span class="lineNum">    3725 </span><span class="lineNoCov">          0 :   fHisNclOut-&gt;Add(laser-&gt;fHisNclOut  );     //-&gt;Number of clusters outer</span>
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :   fHisNclIO-&gt;Add(laser-&gt;fHisNclIO  );      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3727 </span><span class="lineNoCov">          0 :   fHisLclIn-&gt;Add(laser-&gt;fHisLclIn  );      //-&gt;Level arm inner</span>
<span class="lineNum">    3728 </span><span class="lineNoCov">          0 :   fHisLclOut-&gt;Add(laser-&gt;fHisLclOut  );     //-&gt;Level arm outer</span>
<span class="lineNum">    3729 </span><span class="lineNoCov">          0 :   fHisLclIO-&gt;Add(laser-&gt;fHisLclIO  );      //-&gt;Number of cluster inner outer</span>
<span class="lineNum">    3730 </span><span class="lineNoCov">          0 :   fHisdEdx-&gt;Add(laser-&gt;fHisdEdx  );      //-&gt;dedx</span>
<span class="lineNum">    3731 </span><span class="lineNoCov">          0 :   fHisdZfit-&gt;Add(laser-&gt;fHisdZfit  );      //-&gt;dedx</span>
<span class="lineNum">    3732 </span>            :   //
<span class="lineNum">    3733 </span>            :   //
<span class="lineNum">    3734 </span><span class="lineNoCov">          0 :   fHisChi2YIn1-&gt;Add(laser-&gt;fHisChi2YIn1  );      //-&gt;chi2 y inner - line</span>
<span class="lineNum">    3735 </span><span class="lineNoCov">          0 :   fHisChi2YOut1-&gt;Add(laser-&gt;fHisChi2YOut1  );     //-&gt;chi2 y inner - line</span>
<span class="lineNum">    3736 </span><span class="lineNoCov">          0 :   fHisChi2YIn2-&gt;Add(laser-&gt;fHisChi2YIn2  );      //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    3737 </span><span class="lineNoCov">          0 :   fHisChi2YOut2-&gt;Add(laser-&gt;fHisChi2YOut2  );     //-&gt;chi2 y inner - parabola</span>
<span class="lineNum">    3738 </span><span class="lineNoCov">          0 :   fHisChi2YIO1-&gt;Add(laser-&gt;fHisChi2YIO1  );      //-&gt;chi2 y IO    - common</span>
<span class="lineNum">    3739 </span><span class="lineNoCov">          0 :   fHisChi2ZIn1-&gt;Add(laser-&gt;fHisChi2ZIn1  );      //-&gt;chi2 z inner - line</span>
<span class="lineNum">    3740 </span><span class="lineNoCov">          0 :   fHisChi2ZOut1-&gt;Add(laser-&gt;fHisChi2ZOut1  );     //-&gt;chi2 z inner - line</span>
<span class="lineNum">    3741 </span><span class="lineNoCov">          0 :   fHisChi2ZIn2-&gt;Add(laser-&gt;fHisChi2ZIn2  );      //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    3742 </span><span class="lineNoCov">          0 :   fHisChi2ZOut2-&gt;Add(laser-&gt;fHisChi2ZOut2  );     //-&gt;chi2 z inner - parabola</span>
<span class="lineNum">    3743 </span><span class="lineNoCov">          0 :   fHisChi2ZIO1-&gt;Add(laser-&gt;fHisChi2ZIO1  );      //-&gt;chi2 z IO    - common</span>
<span class="lineNum">    3744 </span>            :   //
<span class="lineNum">    3745 </span>            :   //
<span class="lineNum">    3746 </span><span class="lineNoCov">          0 :   fHisPy1vP0-&gt;Add(laser-&gt;fHisPy1vP0  );     //-&gt; delta y   P0outer-P0inner - line</span>
<span class="lineNum">    3747 </span><span class="lineNoCov">          0 :   fHisPy2vP0-&gt;Add(laser-&gt;fHisPy2vP0  );     //-&gt; delta y   P0outer-P0inner - parabola</span>
<span class="lineNum">    3748 </span><span class="lineNoCov">          0 :   fHisPy3vP0-&gt;Add(laser-&gt;fHisPy3vP0  );     //-&gt; delta y   P0outer-P0inner - common parabola</span>
<span class="lineNum">    3749 </span><span class="lineNoCov">          0 :   fHisPy1vP1-&gt;Add(laser-&gt;fHisPy1vP1  );     //-&gt; delta ky  P1outer-P1inner - line</span>
<span class="lineNum">    3750 </span><span class="lineNoCov">          0 :   fHisPy2vP1-&gt;Add(laser-&gt;fHisPy2vP1  );     //-&gt; delta ky  P1outer-P1inner - parabola</span>
<span class="lineNum">    3751 </span><span class="lineNoCov">          0 :   fHisPy3vP1-&gt;Add(laser-&gt;fHisPy3vP1  );     //-&gt; delta ky  P1outer-P1inner - common parabola</span>
<span class="lineNum">    3752 </span><span class="lineNoCov">          0 :   fHisPy2vP2In-&gt;Add(laser-&gt; fHisPy2vP2In  );   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">          0 :   fHisPy2vP2Out-&gt;Add(laser-&gt;fHisPy2vP2Out  );  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    3754 </span><span class="lineNoCov">          0 :   fHisPy3vP2IO-&gt;Add(laser-&gt;fHisPy3vP2IO  );   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    3755 </span>            :   //
<span class="lineNum">    3756 </span>            :   //
<span class="lineNum">    3757 </span><span class="lineNoCov">          0 :   fHisPz1vP0-&gt;Add(laser-&gt;fHisPz1vP0  );     //-&gt; delta z   P0outer-P0inner - line</span>
<span class="lineNum">    3758 </span><span class="lineNoCov">          0 :   fHisPz2vP0-&gt;Add(laser-&gt;fHisPz2vP0  );     //-&gt; delta z   P0outer-P0inner - parabola</span>
<span class="lineNum">    3759 </span><span class="lineNoCov">          0 :   fHisPz3vP0-&gt;Add(laser-&gt;fHisPz3vP0  );     //-&gt; delta z   P0outer-P0inner - common parabola</span>
<span class="lineNum">    3760 </span><span class="lineNoCov">          0 :   fHisPz1vP1-&gt;Add(laser-&gt;fHisPz1vP1  );     //-&gt; delta kz  P1outer-P1inner - line</span>
<span class="lineNum">    3761 </span><span class="lineNoCov">          0 :   fHisPz2vP1-&gt;Add(laser-&gt;fHisPz2vP1  );     //-&gt; delta kz  P1outer-P1inner - parabola</span>
<span class="lineNum">    3762 </span><span class="lineNoCov">          0 :   fHisPz3vP1-&gt;Add(laser-&gt;fHisPz3vP1  );     //-&gt; delta kz  P1outer-P1inner - common parabola</span>
<span class="lineNum">    3763 </span><span class="lineNoCov">          0 :   fHisPz2vP2In-&gt;Add(laser-&gt;fHisPz2vP2In  );   //-&gt; Curv  P2inner - parabola</span>
<span class="lineNum">    3764 </span><span class="lineNoCov">          0 :   fHisPz2vP2Out-&gt;Add(laser-&gt;fHisPz2vP2Out  );  //-&gt; Curv  P2outer - parabola</span>
<span class="lineNum">    3765 </span><span class="lineNoCov">          0 :   fHisPz3vP2IO-&gt;Add(laser-&gt;fHisPz3vP2IO  );   //-&gt; Curv  P2outerinner - common parabola</span>
<span class="lineNum">    3766 </span><span class="lineNoCov">          0 :   fHisYAbsErrors-&gt;Add(laser-&gt;fHisYAbsErrors); //-&gt; total errors per beam in the abs res y analysis</span>
<span class="lineNum">    3767 </span><span class="lineNoCov">          0 :   fHisZAbsErrors-&gt;Add(laser-&gt;fHisZAbsErrors); //-&gt; total errors per beam in the abs res z analysis</span>
<span class="lineNum">    3768 </span>            :   //
<span class="lineNum">    3769 </span>            :   //
<span class="lineNum">    3770 </span>            :   //
<span class="lineNum">    3771 </span>            :   
<span class="lineNum">    3772 </span>            : 
<span class="lineNum">    3773 </span>            : 
<span class="lineNum">    3774 </span>            : 
<span class="lineNum">    3775 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3776 </span>            : 
<span class="lineNum">    3777 </span>            : 
<a name="3778"><span class="lineNum">    3778 </span>            : </a>
<span class="lineNum">    3779 </span>            : 
<span class="lineNum">    3780 </span>            : void AliTPCcalibLaser::DumpFitInfo(TTree * chainFit,Int_t id){
<span class="lineNum">    3781 </span>            :   //
<span class="lineNum">    3782 </span>            :   // Dump fit information - collect information from the streamers 
<span class="lineNum">    3783 </span>            :   //
<span class="lineNum">    3784 </span>            :   /*
<span class="lineNum">    3785 </span>            :     TChain * chainFit=0;
<span class="lineNum">    3786 </span>            :     TChain * chainTrack=0;
<span class="lineNum">    3787 </span>            :     TChain * chain=0;
<span class="lineNum">    3788 </span>            :     //
<span class="lineNum">    3789 </span>            :     gSystem-&gt;AddIncludePath(&quot;-I$ALICE_ROOT/TPC/macros&quot;);
<span class="lineNum">    3790 </span>            :     gROOT-&gt;LoadMacro(&quot;$ALICE_ROOT/TPC/macros/AliXRDPROOFtoolkit.cxx+&quot;);
<span class="lineNum">    3791 </span>            :     AliXRDPROOFtoolkit tool;
<span class="lineNum">    3792 </span>            :     chainTrack = tool.MakeChain(&quot;laser.txt&quot;,&quot;Track&quot;,0,10200);
<span class="lineNum">    3793 </span>            :     chainTrack-&gt;Lookup();
<span class="lineNum">    3794 </span>            :     chainTrack-&gt;SetProof(kTRUE);
<span class="lineNum">    3795 </span>            :     chainDrift = tool.MakeChain(&quot;laser.txt&quot;,&quot;driftv&quot;,0,10200);
<span class="lineNum">    3796 </span>            :     chainDrift-&gt;Lookup();
<span class="lineNum">    3797 </span>            :     chainDrift-&gt;SetProof(kTRUE);
<span class="lineNum">    3798 </span>            :  
<span class="lineNum">    3799 </span>            :     chain = tool.MakeChain(&quot;laser.txt&quot;,&quot;Residuals&quot;,0,10200);
<span class="lineNum">    3800 </span>            :     chain-&gt;Lookup();
<span class="lineNum">    3801 </span>            :     chainFit = tool.MakeChain(&quot;laser.txt&quot;,&quot;FitModels&quot;,0,10200);
<span class="lineNum">    3802 </span>            :     chainFit-&gt;Lookup();
<span class="lineNum">    3803 </span>            :     chainFit-&gt;SetProof(kTRUE);
<span class="lineNum">    3804 </span>            :     chain-&gt;SetProof(kTRUE);
<span class="lineNum">    3805 </span>            :     AliTPCLaserTrack::LoadTracks();  
<span class="lineNum">    3806 </span>            :     //AliTPCcalibLaser::DumpFitInfo(chainFit,0);
<span class="lineNum">    3807 </span>            : 
<span class="lineNum">    3808 </span>            :   */
<span class="lineNum">    3809 </span>            :   //
<span class="lineNum">    3810 </span>            :   // Fit cuts
<span class="lineNum">    3811 </span>            :   //
<span class="lineNum">    3812 </span><span class="lineNoCov">          0 :   TCut cutP3(&quot;abs(Tr.fP[3])&lt;0.1&quot;);</span>
<span class="lineNum">    3813 </span><span class="lineNoCov">          0 :   TCut cutP4(&quot;abs(Tr.fP[4])&lt;0.5&quot;);</span>
<span class="lineNum">    3814 </span><span class="lineNoCov">          0 :   TCut cutPx = cutP3+cutP4;</span>
<span class="lineNum">    3815 </span><span class="lineNoCov">          0 :   TCut cutChi2YOut(&quot;sqrt(chi2y2Out*dEdx)&lt;5&amp;&amp;chi2y2Out&gt;0&quot;);</span>
<span class="lineNum">    3816 </span><span class="lineNoCov">          0 :   TCut cutChi2ZOut(&quot;sqrt(chi2z2Out*dEdx)&lt;5&amp;&amp;chi2z2Out&gt;0&quot;);</span>
<span class="lineNum">    3817 </span><span class="lineNoCov">          0 :   TCut cutChi2YIn(&quot;sqrt(chi2y2In*dEdx)&lt;5&amp;&amp;chi2y2In&gt;0&quot;);</span>
<span class="lineNum">    3818 </span><span class="lineNoCov">          0 :   TCut cutChi2ZIn(&quot;sqrt(chi2z2In*dEdx)&lt;5&amp;&amp;chi2z2In&gt;0&quot;);</span>
<span class="lineNum">    3819 </span>            :   //
<span class="lineNum">    3820 </span><span class="lineNoCov">          0 :   TCut cutdEdx(&quot;sqrt(dEdx)&gt;3&quot;);</span>
<span class="lineNum">    3821 </span><span class="lineNoCov">          0 :   TCut cutDY(&quot;abs(yPol2In.fElements[2]*nclI*nclI/4.)&lt;3&quot;);</span>
<span class="lineNum">    3822 </span><span class="lineNoCov">          0 :   TCut cutN(&quot;nclO&gt;20&amp;&amp;nclI&gt;20&quot;);</span>
<span class="lineNum">    3823 </span><span class="lineNoCov">          0 :   TCut cutA = cutChi2YOut+cutChi2ZOut+cutChi2YIn+cutChi2ZIn+cutN+cutdEdx+cutPx+&quot;accept&quot;;</span>
<span class="lineNum">    3824 </span>            :   //
<span class="lineNum">    3825 </span>            :   // Cluster cuts
<span class="lineNum">    3826 </span>            :   //
<span class="lineNum">    3827 </span><span class="lineNoCov">          0 :   TCut cutClY(&quot;abs(Cl[].fY-TrYpol2.fElements)&lt;0.15&quot;);</span>
<span class="lineNum">    3828 </span><span class="lineNoCov">          0 :   TCut cutClZ(&quot;abs(Cl[].fZ-TrZpol2.fElements)&lt;0.15&quot;);</span>
<span class="lineNum">    3829 </span><span class="lineNoCov">          0 :   TCut cutClX(&quot;abs(Cl[].fX)&gt;10&quot;);</span>
<span class="lineNum">    3830 </span><span class="lineNoCov">          0 :   TCut cutE(&quot;abs(Cl[].fY/Cl[].fX)&lt;0.14&quot;);</span>
<span class="lineNum">    3831 </span><span class="lineNoCov">          0 :   TCut cutSY(&quot;sqrt(Cl[].fSigmaY2)&gt;0.05&quot;);</span>
<span class="lineNum">    3832 </span><span class="lineNoCov">          0 :   TCut cutSZ(&quot;sqrt(Cl[].fSigmaZ2)&gt;0.05&quot;);</span>
<span class="lineNum">    3833 </span><span class="lineNoCov">          0 :   TCut cutQ(&quot;sqrt(Cl[].fMax)&gt;4&quot;);</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">          0 :   TCut cutCl=cutClY+cutClZ+cutClX+cutE+cutSY+cutSZ+cutQ;</span>
<span class="lineNum">    3835 </span>            : 
<span class="lineNum">    3836 </span>            : 
<span class="lineNum">    3837 </span>            :   TH1F * phisAl     = 0;
<span class="lineNum">    3838 </span>            :   TH1F * phisAccept = 0;
<span class="lineNum">    3839 </span>            :   TH1F * phisOut    = 0;
<span class="lineNum">    3840 </span>            :   TProfile * pdEdx  = 0;
<span class="lineNum">    3841 </span>            : 
<span class="lineNum">    3842 </span>            :   TProfile * pP0    = 0;
<span class="lineNum">    3843 </span>            :   TProfile * pP1    = 0;
<span class="lineNum">    3844 </span>            :   TProfile * pP2    = 0;
<span class="lineNum">    3845 </span>            :   TProfile * pP3    = 0;
<span class="lineNum">    3846 </span>            :   TProfile * pP4    = 0;
<span class="lineNum">    3847 </span>            :   //
<span class="lineNum">    3848 </span>            :   TProfile * pNclI  = 0;
<span class="lineNum">    3849 </span>            :   TProfile * pNclO  = 0;
<span class="lineNum">    3850 </span>            :   //
<span class="lineNum">    3851 </span>            :   TProfile * pchi2YIn   =0;
<span class="lineNum">    3852 </span>            :   TProfile * pchi2ZIn   =0;
<span class="lineNum">    3853 </span>            :   TProfile * pchi2YOut  =0;
<span class="lineNum">    3854 </span>            :   TProfile * pchi2ZOut  =0;
<span class="lineNum">    3855 </span>            :   TProfile * pchi2YInOut =0;
<span class="lineNum">    3856 </span>            :   TProfile * pchi2ZInOut =0;;
<span class="lineNum">    3857 </span>            :   // laser counters
<span class="lineNum">    3858 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;LTr.fId&gt;&gt;hisAl(350,0,350)&quot;,&quot;LTr.fId&lt;350&quot;);</span>
<span class="lineNum">    3859 </span><span class="lineNoCov">          0 :   phisAl = (TH1F*)gROOT-&gt;FindObject(&quot;hisAl&quot;);</span>
<span class="lineNum">    3860 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;LTr.fId&gt;&gt;hisAccept(350,0,350)&quot;,&quot;LTr.fId&lt;350&quot;+cutA);</span>
<span class="lineNum">    3861 </span><span class="lineNoCov">          0 :   phisAccept = (TH1F*)gROOT-&gt;FindObject(&quot;hisAccept&quot;);</span>
<span class="lineNum">    3862 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;LTr.fId&gt;&gt;hisOut(350,0,350)&quot;,&quot;LTr.fId&lt;350&quot;+!cutA);</span>
<span class="lineNum">    3863 </span><span class="lineNoCov">          0 :   phisOut = (TH1F*)gROOT-&gt;FindObject(&quot;hisOut&quot;);</span>
<span class="lineNum">    3864 </span>            :   //
<span class="lineNum">    3865 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(dEdx):LTr.fId&gt;&gt;hdEdx(350,0,350)&quot;,&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3866 </span><span class="lineNoCov">          0 :   pdEdx   = (TProfile*)gROOT-&gt;FindObject(&quot;hdEdx&quot;);</span>
<span class="lineNum">    3867 </span>            :   // track param
<span class="lineNum">    3868 </span>            :   //
<span class="lineNum">    3869 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;Tr.fP[0]:LTr.fId&gt;&gt;hP0(350,0,350)&quot;,&quot;Tr.fP[4]/sqrt(Tr.fC[14])&lt;20&quot;+cutA,&quot;prof&quot;);</span>
<span class="lineNum">    3870 </span><span class="lineNoCov">          0 :   pP0   = (TProfile*)gROOT-&gt;FindObject(&quot;hP0&quot;);</span>
<span class="lineNum">    3871 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;Tr.fP[1]:LTr.fId&gt;&gt;hP1(350,0,350)&quot;,&quot;Tr.fP[4]/sqrt(Tr.fC[14])&lt;20&quot;+cutA,&quot;prof&quot;);</span>
<span class="lineNum">    3872 </span><span class="lineNoCov">          0 :   pP1   = (TProfile*)gROOT-&gt;FindObject(&quot;hP1&quot;);</span>
<span class="lineNum">    3873 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;Tr.fP[2]:LTr.fId&gt;&gt;hP2(350,0,350)&quot;,&quot;Tr.fP[4]/sqrt(Tr.fC[14])&lt;20&quot;+cutA,&quot;prof&quot;);</span>
<span class="lineNum">    3874 </span><span class="lineNoCov">          0 :   pP2   = (TProfile*)gROOT-&gt;FindObject(&quot;hP2&quot;);</span>
<span class="lineNum">    3875 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;Tr.fP[3]:LTr.fId&gt;&gt;hP3(350,0,350)&quot;,&quot;Tr.fP[4]/sqrt(Tr.fC[14])&lt;20&quot;+cutA,&quot;prof&quot;);</span>
<span class="lineNum">    3876 </span><span class="lineNoCov">          0 :   pP3   = (TProfile*)gROOT-&gt;FindObject(&quot;hP3&quot;);</span>
<span class="lineNum">    3877 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;Tr.fP[4]:LTr.fId&gt;&gt;hP4(350,0,350)&quot;,&quot;Tr.fP[4]/sqrt(Tr.fC[14])&lt;20&quot;+cutA,&quot;prof&quot;);</span>
<span class="lineNum">    3878 </span><span class="lineNoCov">          0 :   pP4   = (TProfile*)gROOT-&gt;FindObject(&quot;hP4&quot;);</span>
<span class="lineNum">    3879 </span>            :   //
<span class="lineNum">    3880 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;nclI:LTr.fId&gt;&gt;hNclI(350,0,350)&quot;,&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3881 </span><span class="lineNoCov">          0 :   pNclI   = (TProfile*)gROOT-&gt;FindObject(&quot;hNclI&quot;);</span>
<span class="lineNum">    3882 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;nclO:LTr.fId&gt;&gt;hNclO(350,0,350)&quot;,&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3883 </span><span class="lineNoCov">          0 :   pNclO   = (TProfile*)gROOT-&gt;FindObject(&quot;hNclO&quot;);</span>
<span class="lineNum">    3884 </span>            :   //
<span class="lineNum">    3885 </span>            :   //
<span class="lineNum">    3886 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2y2In):LTr.fId&gt;&gt;hChi2YIn(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3887 </span><span class="lineNoCov">          0 :   pchi2YIn   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2YIn&quot;);</span>
<span class="lineNum">    3888 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2y2Out):LTr.fId&gt;&gt;hChi2YOut(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3889 </span><span class="lineNoCov">          0 :   pchi2YOut   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2YOut&quot;);</span>
<span class="lineNum">    3890 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2yInOut):LTr.fId&gt;&gt;hChi2YInOut(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3891 </span><span class="lineNoCov">          0 :   pchi2YInOut   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2YInOut&quot;);</span>
<span class="lineNum">    3892 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2z2In):LTr.fId&gt;&gt;hChi2ZIn(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3893 </span><span class="lineNoCov">          0 :   pchi2ZIn   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2ZIn&quot;);</span>
<span class="lineNum">    3894 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2z2Out):LTr.fId&gt;&gt;hChi2ZOut(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3895 </span><span class="lineNoCov">          0 :   pchi2ZOut   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2ZOut&quot;);</span>
<span class="lineNum">    3896 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;sqrt(chi2zInOut):LTr.fId&gt;&gt;hChi2ZInOut(350,0,350)&quot;,cutA+&quot;&quot;,&quot;prof&quot;);</span>
<span class="lineNum">    3897 </span><span class="lineNoCov">          0 :   pchi2ZInOut   = (TProfile*)gROOT-&gt;FindObject(&quot;hChi2ZInOut&quot;);</span>
<span class="lineNum">    3898 </span>            :   //
<span class="lineNum">    3899 </span>            :   // second derivatives
<span class="lineNum">    3900 </span>            :   //
<span class="lineNum">    3901 </span><span class="lineNoCov">          0 :   TH2F * phisPy2In = new TH2F(&quot;Py2Inner&quot;,&quot;Py2Inner&quot;,350,0,350,100,-0.001,0.001);</span>
<span class="lineNum">    3902 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;yPol2In.fElements[2]:LTr.fId&gt;&gt;Py2Inner&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3903 </span><span class="lineNoCov">          0 :   TH2F * phisPy2Out = new TH2F(&quot;Py2Outer&quot;,&quot;Py2Outer&quot;,350,0,350,200,-0.0005,0.0005);</span>
<span class="lineNum">    3904 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;yPol2Out.fElements[2]:LTr.fId&gt;&gt;Py2Outer&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3905 </span><span class="lineNoCov">          0 :   TH2F * phisPy2InOut = new TH2F(&quot;Py2InOut&quot;,&quot;Py2InOut&quot;,350,0,350,200,-0.0005,0.0005);</span>
<span class="lineNum">    3906 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;yInOut.fElements[4]:LTr.fId&gt;&gt;Py2InOut&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3907 </span>            :   //
<span class="lineNum">    3908 </span><span class="lineNoCov">          0 :   phisPy2In-&gt;FitSlicesY();</span>
<span class="lineNum">    3909 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Inner_0&quot;);</span>
<span class="lineNum">    3910 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InMean = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Inner_1&quot;);</span>
<span class="lineNum">    3911 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Inner_2&quot;);</span>
<span class="lineNum">    3912 </span>            :   //
<span class="lineNum">    3913 </span><span class="lineNoCov">          0 :   phisPy2Out-&gt;FitSlicesY();</span>
<span class="lineNum">    3914 </span><span class="lineNoCov">          0 :   TH1D * phisPy2OutEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Outer_0&quot;);</span>
<span class="lineNum">    3915 </span><span class="lineNoCov">          0 :   TH1D * phisPy2OutMean = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Outer_1&quot;);</span>
<span class="lineNum">    3916 </span><span class="lineNoCov">          0 :   TH1D * phisPy2OutSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Py2Outer_2&quot;);</span>
<span class="lineNum">    3917 </span>            :   //
<span class="lineNum">    3918 </span><span class="lineNoCov">          0 :   phisPy2InOut-&gt;FitSlicesY();</span>
<span class="lineNum">    3919 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InOutEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Py2InOut_0&quot;);</span>
<span class="lineNum">    3920 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InOutMean = (TH1D*)gROOT-&gt;FindObject(&quot;Py2InOut_1&quot;);</span>
<span class="lineNum">    3921 </span><span class="lineNoCov">          0 :   TH1D * phisPy2InOutSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Py2InOut_2&quot;);</span>
<span class="lineNum">    3922 </span>            :   //
<span class="lineNum">    3923 </span><span class="lineNoCov">          0 :   TH2F * phisPz2In = new TH2F(&quot;Pz2Inner&quot;,&quot;Pz2Inner&quot;,350,0,350,100,-0.001,0.001);</span>
<span class="lineNum">    3924 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;zPol2In.fElements[2]:LTr.fId&gt;&gt;Pz2Inner&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3925 </span><span class="lineNoCov">          0 :   TH2F * phisPz2Out = new TH2F(&quot;Pz2Outer&quot;,&quot;Pz2Outer&quot;,350,0,350,200,-0.0005,0.0005);</span>
<span class="lineNum">    3926 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;zPol2Out.fElements[2]:LTr.fId&gt;&gt;Pz2Outer&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3927 </span><span class="lineNoCov">          0 :   TH2F * phisPz2InOut = new TH2F(&quot;Pz2InOut&quot;,&quot;Pz2InOut&quot;,350,0,350,200,-0.0005,0.0005);</span>
<span class="lineNum">    3928 </span><span class="lineNoCov">          0 :   chainFit-&gt;Draw(&quot;zInOut.fElements[4]:LTr.fId&gt;&gt;Pz2InOut&quot;,cutA,&quot;&quot;);</span>
<span class="lineNum">    3929 </span>            :   //
<span class="lineNum">    3930 </span><span class="lineNoCov">          0 :   phisPz2In-&gt;FitSlicesY();</span>
<span class="lineNum">    3931 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Inner_0&quot;);</span>
<span class="lineNum">    3932 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InMean = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Inner_1&quot;);</span>
<span class="lineNum">    3933 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Inner_2&quot;);</span>
<span class="lineNum">    3934 </span>            :   //
<span class="lineNum">    3935 </span><span class="lineNoCov">          0 :   phisPz2Out-&gt;FitSlicesY();</span>
<span class="lineNum">    3936 </span><span class="lineNoCov">          0 :   TH1D * phisPz2OutEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Outer_0&quot;);</span>
<span class="lineNum">    3937 </span><span class="lineNoCov">          0 :   TH1D * phisPz2OutMean = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Outer_1&quot;);</span>
<span class="lineNum">    3938 </span><span class="lineNoCov">          0 :   TH1D * phisPz2OutSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2Outer_2&quot;);</span>
<span class="lineNum">    3939 </span>            :   //
<span class="lineNum">    3940 </span><span class="lineNoCov">          0 :   phisPz2InOut-&gt;FitSlicesY();</span>
<span class="lineNum">    3941 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InOutEntries = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2InOut_0&quot;);</span>
<span class="lineNum">    3942 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InOutMean = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2InOut_1&quot;);</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">          0 :   TH1D * phisPz2InOutSigma = (TH1D*)gROOT-&gt;FindObject(&quot;Pz2InOut_2&quot;);</span>
<span class="lineNum">    3944 </span>            :   //
<span class="lineNum">    3945 </span>            :   //
<span class="lineNum">    3946 </span>            :   //
<span class="lineNum">    3947 </span>            : 
<span class="lineNum">    3948 </span>            : 
<span class="lineNum">    3949 </span>            :   {
<span class="lineNum">    3950 </span><span class="lineNoCov">          0 :     TTreeSRedirector *pcstream = new TTreeSRedirector(&quot;vscan.root&quot;);</span>
<span class="lineNum">    3951 </span><span class="lineNoCov">          0 :     for (Int_t ilaser=0; ilaser&lt;336; ilaser++){</span>
<span class="lineNum">    3952 </span><span class="lineNoCov">          0 :       Float_t all=phisAl-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3953 </span><span class="lineNoCov">          0 :       Float_t accept=phisAccept-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3954 </span><span class="lineNoCov">          0 :       Float_t out=phisOut-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3955 </span><span class="lineNoCov">          0 :       Float_t sdedx = pdEdx-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3956 </span><span class="lineNoCov">          0 :       Float_t mP0 = pP0-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3957 </span><span class="lineNoCov">          0 :       Float_t mP1 = pP1-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3958 </span><span class="lineNoCov">          0 :       Float_t mP2 = pP2-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3959 </span><span class="lineNoCov">          0 :       Float_t mP3 = pP3-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3960 </span><span class="lineNoCov">          0 :       Float_t mP4 = pP4-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3961 </span>            : 
<span class="lineNum">    3962 </span>            : 
<span class="lineNum">    3963 </span><span class="lineNoCov">          0 :       Float_t nclI  = pNclI-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3964 </span><span class="lineNoCov">          0 :       Float_t nclO  = pNclO-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3965 </span>            :       //
<span class="lineNum">    3966 </span><span class="lineNoCov">          0 :       Float_t chi2YIn=pchi2YIn-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3967 </span><span class="lineNoCov">          0 :       Float_t chi2YOut=pchi2YOut-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3968 </span><span class="lineNoCov">          0 :       Float_t chi2YInOut=pchi2YInOut-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3969 </span><span class="lineNoCov">          0 :       Float_t chi2ZIn=pchi2ZIn-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3970 </span><span class="lineNoCov">          0 :       Float_t chi2ZOut=pchi2ZOut-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3971 </span><span class="lineNoCov">          0 :       Float_t chi2ZInOut=pchi2ZInOut-&gt;GetBinContent(ilaser+1); </span>
<span class="lineNum">    3972 </span>            :       //
<span class="lineNum">    3973 </span><span class="lineNoCov">          0 :       Float_t entriesPy2In  = phisPy2InEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3974 </span><span class="lineNoCov">          0 :       Float_t meanPy2In     = phisPy2InMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3975 </span><span class="lineNoCov">          0 :       Float_t sigmaPy2In    = phisPy2InSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3976 </span>            :       //
<span class="lineNum">    3977 </span><span class="lineNoCov">          0 :       Float_t entriesPy2Out  = phisPy2OutEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3978 </span><span class="lineNoCov">          0 :       Float_t meanPy2Out     = phisPy2OutMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3979 </span><span class="lineNoCov">          0 :       Float_t sigmaPy2Out    = phisPy2OutSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3980 </span>            :       //
<span class="lineNum">    3981 </span><span class="lineNoCov">          0 :       Float_t entriesPy2InOut  = phisPy2InOutEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3982 </span><span class="lineNoCov">          0 :       Float_t meanPy2InOut     = phisPy2InOutMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3983 </span><span class="lineNoCov">          0 :       Float_t sigmaPy2InOut    = phisPy2InOutSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3984 </span>            :       //
<span class="lineNum">    3985 </span><span class="lineNoCov">          0 :       Float_t entriesPz2In  = phisPz2InEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3986 </span><span class="lineNoCov">          0 :       Float_t meanPz2In     = phisPz2InMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3987 </span><span class="lineNoCov">          0 :       Float_t sigmaPz2In    = phisPz2InSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3988 </span>            :       //
<span class="lineNum">    3989 </span><span class="lineNoCov">          0 :       Float_t entriesPz2Out  = phisPz2OutEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3990 </span><span class="lineNoCov">          0 :       Float_t meanPz2Out     = phisPz2OutMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3991 </span><span class="lineNoCov">          0 :       Float_t sigmaPz2Out    = phisPz2OutSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3992 </span>            :       //
<span class="lineNum">    3993 </span><span class="lineNoCov">          0 :       Float_t entriesPz2InOut  = phisPz2InOutEntries-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3994 </span><span class="lineNoCov">          0 :       Float_t meanPz2InOut     = phisPz2InOutMean-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3995 </span><span class="lineNoCov">          0 :       Float_t sigmaPz2InOut    = phisPz2InOutSigma-&gt;GetBinContent(ilaser+1);</span>
<span class="lineNum">    3996 </span>            :       
<span class="lineNum">    3997 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack* ltrp =(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(ilaser);</span>
<span class="lineNum">    3998 </span><span class="lineNoCov">          0 :       (*pcstream)&lt;&lt;&quot;Scan&quot;&lt;&lt;</span>
<span class="lineNum">    3999 </span><span class="lineNoCov">          0 :         &quot;Run=&quot;&lt;&lt;id&lt;&lt;</span>
<span class="lineNum">    4000 </span><span class="lineNoCov">          0 :         &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;</span>
<span class="lineNum">    4001 </span><span class="lineNoCov">          0 :         &quot;all=&quot;&lt;&lt;all&lt;&lt;</span>
<span class="lineNum">    4002 </span><span class="lineNoCov">          0 :         &quot;accept=&quot;&lt;&lt;accept&lt;&lt;</span>
<span class="lineNum">    4003 </span><span class="lineNoCov">          0 :         &quot;out=&quot;&lt;&lt;out&lt;&lt;</span>
<span class="lineNum">    4004 </span><span class="lineNoCov">          0 :         &quot;sdedx=&quot;&lt;&lt;sdedx&lt;&lt;</span>
<span class="lineNum">    4005 </span><span class="lineNoCov">          0 :         &quot;mP0=&quot;&lt;&lt;mP0&lt;&lt;</span>
<span class="lineNum">    4006 </span><span class="lineNoCov">          0 :         &quot;mP1=&quot;&lt;&lt;mP1&lt;&lt;</span>
<span class="lineNum">    4007 </span><span class="lineNoCov">          0 :         &quot;mP2=&quot;&lt;&lt;mP2&lt;&lt;</span>
<span class="lineNum">    4008 </span><span class="lineNoCov">          0 :         &quot;mP3=&quot;&lt;&lt;mP3&lt;&lt;</span>
<span class="lineNum">    4009 </span><span class="lineNoCov">          0 :         &quot;mP4=&quot;&lt;&lt;mP4&lt;&lt;</span>
<span class="lineNum">    4010 </span><span class="lineNoCov">          0 :         &quot;nclI=&quot;&lt;&lt;nclI&lt;&lt;</span>
<span class="lineNum">    4011 </span><span class="lineNoCov">          0 :         &quot;nclO=&quot;&lt;&lt;nclO&lt;&lt;</span>
<span class="lineNum">    4012 </span><span class="lineNoCov">          0 :         &quot;chi2YIn=&quot;&lt;&lt;chi2YIn&lt;&lt;</span>
<span class="lineNum">    4013 </span><span class="lineNoCov">          0 :         &quot;chi2YOut=&quot;&lt;&lt;chi2YOut&lt;&lt;</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">          0 :         &quot;chi2YInOut=&quot;&lt;&lt;chi2YInOut&lt;&lt;</span>
<span class="lineNum">    4015 </span><span class="lineNoCov">          0 :         &quot;chi2ZIn=&quot;&lt;&lt;chi2ZIn&lt;&lt;</span>
<span class="lineNum">    4016 </span><span class="lineNoCov">          0 :         &quot;chi2ZOut=&quot;&lt;&lt;chi2ZOut&lt;&lt;</span>
<span class="lineNum">    4017 </span><span class="lineNoCov">          0 :         &quot;chi2ZInOut=&quot;&lt;&lt;chi2ZInOut&lt;&lt;</span>
<span class="lineNum">    4018 </span>            :         //
<span class="lineNum">    4019 </span><span class="lineNoCov">          0 :         &quot;nPy2In=&quot;&lt;&lt;entriesPy2In&lt;&lt;</span>
<span class="lineNum">    4020 </span><span class="lineNoCov">          0 :         &quot;mPy2In=&quot;&lt;&lt;meanPy2In&lt;&lt;</span>
<span class="lineNum">    4021 </span><span class="lineNoCov">          0 :         &quot;sPy2In=&quot;&lt;&lt;sigmaPy2In&lt;&lt;</span>
<span class="lineNum">    4022 </span>            :         //
<span class="lineNum">    4023 </span><span class="lineNoCov">          0 :         &quot;nPy2Out=&quot;&lt;&lt;entriesPy2Out&lt;&lt;</span>
<span class="lineNum">    4024 </span><span class="lineNoCov">          0 :         &quot;mPy2Out=&quot;&lt;&lt;meanPy2Out&lt;&lt;</span>
<span class="lineNum">    4025 </span><span class="lineNoCov">          0 :         &quot;sPy2Out=&quot;&lt;&lt;sigmaPy2Out&lt;&lt;</span>
<span class="lineNum">    4026 </span>            :         //
<span class="lineNum">    4027 </span><span class="lineNoCov">          0 :         &quot;nPy2InOut=&quot;&lt;&lt;entriesPy2InOut&lt;&lt;</span>
<span class="lineNum">    4028 </span><span class="lineNoCov">          0 :         &quot;mPy2InOut=&quot;&lt;&lt;meanPy2InOut&lt;&lt;</span>
<span class="lineNum">    4029 </span><span class="lineNoCov">          0 :         &quot;sPy2InOut=&quot;&lt;&lt;sigmaPy2InOut&lt;&lt;</span>
<span class="lineNum">    4030 </span>            :         //
<span class="lineNum">    4031 </span><span class="lineNoCov">          0 :         &quot;nPz2In=&quot;&lt;&lt;entriesPz2In&lt;&lt;</span>
<span class="lineNum">    4032 </span><span class="lineNoCov">          0 :         &quot;mPz2In=&quot;&lt;&lt;meanPz2In&lt;&lt;</span>
<span class="lineNum">    4033 </span><span class="lineNoCov">          0 :         &quot;sPz2In=&quot;&lt;&lt;sigmaPz2In&lt;&lt;</span>
<span class="lineNum">    4034 </span>            :         //
<span class="lineNum">    4035 </span><span class="lineNoCov">          0 :         &quot;nPz2Out=&quot;&lt;&lt;entriesPz2Out&lt;&lt;</span>
<span class="lineNum">    4036 </span><span class="lineNoCov">          0 :         &quot;mPz2Out=&quot;&lt;&lt;meanPz2Out&lt;&lt;</span>
<span class="lineNum">    4037 </span><span class="lineNoCov">          0 :         &quot;sPz2Out=&quot;&lt;&lt;sigmaPz2Out&lt;&lt;</span>
<span class="lineNum">    4038 </span>            :         //
<span class="lineNum">    4039 </span><span class="lineNoCov">          0 :         &quot;nPz2InOut=&quot;&lt;&lt;entriesPz2InOut&lt;&lt;</span>
<span class="lineNum">    4040 </span><span class="lineNoCov">          0 :         &quot;mPz2InOut=&quot;&lt;&lt;meanPz2InOut&lt;&lt;</span>
<span class="lineNum">    4041 </span><span class="lineNoCov">          0 :         &quot;sPz2InOut=&quot;&lt;&lt;sigmaPz2InOut&lt;&lt;</span>
<span class="lineNum">    4042 </span>            :         &quot;\n&quot;;
<span class="lineNum">    4043 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4044 </span>            :     
<span class="lineNum">    4045 </span><span class="lineNoCov">          0 :     delete pcstream;</span>
<span class="lineNum">    4046 </span>            :   }
<a name="4047"><span class="lineNum">    4047 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4048 </span>            : 
<span class="lineNum">    4049 </span>            : void AliTPCcalibLaser::SetBeamParameters(TVectorD&amp; meanOffset,
<span class="lineNum">    4050 </span>            :                                          TVectorD&amp; meanSlope,
<span class="lineNum">    4051 </span>            :                                          TVectorD&amp; sectorArray,
<span class="lineNum">    4052 </span>            :                                          Int_t option)
<span class="lineNum">    4053 </span>            : {
<span class="lineNum">    4054 </span>            :   // This method should ideally go in AliTPCLaser
<span class="lineNum">    4055 </span>            :   // option == 0 (pads outer - closest to beam)
<span class="lineNum">    4056 </span>            :   // option == 1 (pads inner)
<span class="lineNum">    4057 </span>            :   // option == 2 (time outer)
<span class="lineNum">    4058 </span>            :   // option == 3 (time inner)
<span class="lineNum">    4059 </span>            :   Int_t nFailures = 0;
<span class="lineNum">    4060 </span>            : 
<span class="lineNum">    4061 </span><span class="lineNoCov">          0 :   for(Int_t id = 0; id &lt; 336; id++) {</span>
<span class="lineNum">    4062 </span>            :     
<span class="lineNum">    4063 </span><span class="lineNoCov">          0 :     if (!AliTPCLaserTrack::GetTracks()) </span>
<span class="lineNum">    4064 </span><span class="lineNoCov">          0 :       AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">    4065 </span>            :     AliTPCLaserTrack *ltrp =
<span class="lineNum">    4066 </span><span class="lineNoCov">          0 :       (AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    4067 </span>            :     
<span class="lineNum">    4068 </span><span class="lineNoCov">          0 :     AliExternalTrackParam trackParam(*ltrp);</span>
<span class="lineNum">    4069 </span>            :     
<span class="lineNum">    4070 </span>            :     Double_t deltaangle = 10.0; // sector is 1/2 a sector away from mirror
<span class="lineNum">    4071 </span><span class="lineNoCov">          0 :     if((option==1 || option==3)&amp;&amp; (ltrp-&gt;GetBeam()&lt;=1 || ltrp-&gt;GetBeam()&gt;=5))</span>
<span class="lineNum">    4072 </span><span class="lineNoCov">          0 :       deltaangle = 30.0; // inner sector is 1 sector further away from mirror</span>
<span class="lineNum">    4073 </span>            :     
<span class="lineNum">    4074 </span><span class="lineNoCov">          0 :     Double_t angle = trackParam.GetAlpha();</span>
<span class="lineNum">    4075 </span><span class="lineNoCov">          0 :     if(angle&lt;0)</span>
<span class="lineNum">    4076 </span><span class="lineNoCov">          0 :       angle += 2*TMath::Pi();</span>
<span class="lineNum">    4077 </span><span class="lineNoCov">          0 :     if(trackParam.GetSnp()&gt;0) // track points to sector &quot;before&quot;</span>
<span class="lineNum">    4078 </span><span class="lineNoCov">          0 :       angle -= deltaangle*TMath::DegToRad();</span>
<span class="lineNum">    4079 </span>            :     else // track points to sector &quot;after&quot;
<span class="lineNum">    4080 </span><span class="lineNoCov">          0 :       angle += deltaangle*TMath::DegToRad();</span>
<span class="lineNum">    4081 </span>            :     
<span class="lineNum">    4082 </span><span class="lineNoCov">          0 :     Bool_t success = trackParam.Rotate(angle);</span>
<span class="lineNum">    4083 </span>            :     
<span class="lineNum">    4084 </span><span class="lineNoCov">          0 :     if(!success) {</span>
<span class="lineNum">    4085 </span>            :       //      cout &lt;&lt; &quot;WARNING: Rotate failed for ID: &quot; &lt;&lt; id &lt;&lt; endl;
<span class="lineNum">    4086 </span><span class="lineNoCov">          0 :       nFailures++;</span>
<span class="lineNum">    4087 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4088 </span>            :     
<span class="lineNum">    4089 </span><span class="lineNoCov">          0 :     angle *= TMath::RadToDeg();</span>
<span class="lineNum">    4090 </span>            :     
<span class="lineNum">    4091 </span><span class="lineNoCov">          0 :     Int_t sector = TMath::Nint((angle-10.0)/20.0);</span>
<span class="lineNum">    4092 </span><span class="lineNoCov">          0 :     if(sector&lt;0)</span>
<span class="lineNum">    4093 </span><span class="lineNoCov">          0 :       sector += 18;</span>
<span class="lineNum">    4094 </span><span class="lineNoCov">          0 :     else if(sector&gt;=18)</span>
<span class="lineNum">    4095 </span><span class="lineNoCov">          0 :       sector -= 18;</span>
<span class="lineNum">    4096 </span><span class="lineNoCov">          0 :     if(ltrp-&gt;GetSide()==1) // C side</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">          0 :       sector += 18;</span>
<span class="lineNum">    4098 </span><span class="lineNoCov">          0 :     if(option==0 || option==2)</span>
<span class="lineNum">    4099 </span><span class="lineNoCov">          0 :       sector += 36;</span>
<span class="lineNum">    4100 </span><span class="lineNoCov">          0 :     if((option==1||option==3)&amp;&amp;(ltrp-&gt;GetBeam()==0||ltrp-&gt;GetBeam()==6)) </span>
<span class="lineNum">    4101 </span><span class="lineNoCov">          0 :       sector += 36;</span>
<span class="lineNum">    4102 </span>            : 
<span class="lineNum">    4103 </span><span class="lineNoCov">          0 :     sectorArray[id] = sector;</span>
<span class="lineNum">    4104 </span>            : 
<span class="lineNum">    4105 </span>            :     const Double_t x0 = 0;
<span class="lineNum">    4106 </span>            :     
<span class="lineNum">    4107 </span><span class="lineNoCov">          0 :     Double_t slopey  = TMath::Tan(TMath::ASin(trackParam.GetSnp()));</span>
<span class="lineNum">    4108 </span><span class="lineNoCov">          0 :     Double_t slopez  = trackParam.GetTgl();</span>
<span class="lineNum">    4109 </span>            :     //  One needs a factor sqrt(1+slopey**2) to take into account the
<span class="lineNum">    4110 </span>            :     //  longer path length
<span class="lineNum">    4111 </span><span class="lineNoCov">          0 :     slopez *= TMath::Sqrt(1.0 + slopey*slopey);    </span>
<span class="lineNum">    4112 </span><span class="lineNoCov">          0 :     if(fInverseSlopeZ) // wrong sign in database, should be fixed there</span>
<span class="lineNum">    4113 </span><span class="lineNoCov">          0 :       slopez *= -1;</span>
<span class="lineNum">    4114 </span>            :     //    Double_t offsetz = trackParam.GetZ();
<span class="lineNum">    4115 </span><span class="lineNoCov">          0 :     Double_t offsety = trackParam.GetY() + slopey*(x0-trackParam.GetX());</span>
<span class="lineNum">    4116 </span><span class="lineNoCov">          0 :     Double_t offsetz = trackParam.GetZ() + slopez*(x0-trackParam.GetX());</span>
<span class="lineNum">    4117 </span><span class="lineNoCov">          0 :     if(option==2 || option==3) {</span>
<span class="lineNum">    4118 </span><span class="lineNoCov">          0 :       meanOffset[id] = offsetz; meanSlope[id] = slopez;</span>
<span class="lineNum">    4119 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">    4120 </span><span class="lineNoCov">          0 :       meanOffset[id] = offsety; meanSlope[id] = slopey;</span>
<span class="lineNum">    4121 </span>            :     }
<span class="lineNum">    4122 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    4123 </span>            : 
<span class="lineNum">    4124 </span><span class="lineNoCov">          0 :   if(nFailures&gt;0)</span>
<span class="lineNum">    4125 </span><span class="lineNoCov">          0 :     AliWarning(Form(&quot;Rotate method failed %d times&quot;, nFailures));</span>
<span class="lineNum">    4126 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    4127 </span>            : 
<a name="4128"><span class="lineNum">    4128 </span>            : </a>
<span class="lineNum">    4129 </span>            : 
<span class="lineNum">    4130 </span>            : void AliTPCcalibLaser::DumpLaser(const char *finput, Int_t run){
<span class="lineNum">    4131 </span>            :   //
<span class="lineNum">    4132 </span>            :   //
<span class="lineNum">    4133 </span>            :   //input=&quot;TPCLaserObjects.root&quot;
<span class="lineNum">    4134 </span>            :   //
<span class="lineNum">    4135 </span>            :   // 0. OBJ: TAxis     Delta
<span class="lineNum">    4136 </span>            :   // 1. OBJ: TAxis     bin
<span class="lineNum">    4137 </span>            :   // 2. OBJ: TAxis     rms shape
<span class="lineNum">    4138 </span>            :   // 3. OBJ: TAxis     sqrt(Q)
<span class="lineNum">    4139 </span>            :   // 4. OBJ: TAxis     row
<span class="lineNum">    4140 </span>            :   // 5. OBJ: TAxis     trackID
<span class="lineNum">    4141 </span>            : 
<span class="lineNum">    4142 </span>            :   const Double_t kSigma=4.;
<span class="lineNum">    4143 </span><span class="lineNoCov">          0 :   TFile f(finput);</span>
<span class="lineNum">    4144 </span><span class="lineNoCov">          0 :   AliTPCcalibLaser *laserTPC = (AliTPCcalibLaser*) f.Get(&quot;laserTPC&quot;);</span>
<span class="lineNum">    4145 </span><span class="lineNoCov">          0 :   THnSparse * hisPadInput   = laserTPC-&gt;fHisLaserPad;</span>
<span class="lineNum">    4146 </span><span class="lineNoCov">          0 :   THnSparse * hisTimeInput = laserTPC-&gt;fHisLaserTime;</span>
<span class="lineNum">    4147 </span><span class="lineNoCov">          0 :   TTreeSRedirector *pcstream= new TTreeSRedirector(&quot;hisLasers.root&quot;);</span>
<span class="lineNum">    4148 </span><span class="lineNoCov">          0 :   TVectorD meanY(kMaxRow), sigmaY(kMaxRow);</span>
<span class="lineNum">    4149 </span><span class="lineNoCov">          0 :   TVectorD meanZ(kMaxRow), sigmaZ(kMaxRow);</span>
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :   TVectorD meanPad(kMaxRow), sigmaPad(kMaxRow);</span>
<span class="lineNum">    4151 </span><span class="lineNoCov">          0 :   TVectorD meanTime(kMaxRow), sigmaTime(kMaxRow);</span>
<span class="lineNum">    4152 </span><span class="lineNoCov">          0 :   TVectorD meanDPad(kMaxRow), sigmaDPad(kMaxRow);</span>
<span class="lineNum">    4153 </span><span class="lineNoCov">          0 :   TVectorD meanDTime(kMaxRow), sigmaDTime(kMaxRow);</span>
<span class="lineNum">    4154 </span><span class="lineNoCov">          0 :   TVectorD meandEdx(kMaxRow), sigmadEdx(kMaxRow);</span>
<span class="lineNum">    4155 </span><span class="lineNoCov">          0 :   TVectorD meanSTime(kMaxRow), sigmaSTime(kMaxRow);</span>
<span class="lineNum">    4156 </span><span class="lineNoCov">          0 :   TVectorD meanSPad(kMaxRow), sigmaSPad(kMaxRow);</span>
<span class="lineNum">    4157 </span><span class="lineNoCov">          0 :   TVectorD entries(kMaxRow);</span>
<span class="lineNum">    4158 </span>            :   //
<span class="lineNum">    4159 </span><span class="lineNoCov">          0 :   Int_t indexes[10]={0,1,2,3,4,5,6};</span>
<span class="lineNum">    4160 </span>            :   TH1 *his=0;
<span class="lineNum">    4161 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">    4162 </span>            :   //
<span class="lineNum">    4163 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){ // llop over laser beams </span>
<span class="lineNum">    4164 </span><span class="lineNoCov">          0 :     printf(&quot;id=\t%d\n&quot;,id);</span>
<span class="lineNum">    4165 </span>            :     //
<span class="lineNum">    4166 </span><span class="lineNoCov">          0 :     AliTPCLaserTrack *ltrp =(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    4167 </span>            :     //
<span class="lineNum">    4168 </span><span class="lineNoCov">          0 :     hisPadInput-&gt;GetAxis(5)-&gt;SetRange(id+1,id+1);</span>
<span class="lineNum">    4169 </span><span class="lineNoCov">          0 :     hisTimeInput-&gt;GetAxis(5)-&gt;SetRange(id+1,id+1);</span>
<span class="lineNum">    4170 </span>            :     //
<span class="lineNum">    4171 </span><span class="lineNoCov">          0 :     his=hisTimeInput-&gt;Projection(3);</span>
<span class="lineNum">    4172 </span><span class="lineNoCov">          0 :     Int_t firstBindEdx=his-&gt;FindFirstBinAbove(0);</span>
<span class="lineNum">    4173 </span><span class="lineNoCov">          0 :     Int_t lastBindEdx=his-&gt;FindLastBinAbove(0);</span>
<span class="lineNum">    4174 </span><span class="lineNoCov">          0 :     hisPadInput-&gt;GetAxis(3)-&gt;SetRange(firstBindEdx, lastBindEdx);</span>
<span class="lineNum">    4175 </span><span class="lineNoCov">          0 :     hisTimeInput-&gt;GetAxis(3)-&gt;SetRange(firstBindEdx, lastBindEdx);</span>
<span class="lineNum">    4176 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    4177 </span>            :     //
<span class="lineNum">    4178 </span><span class="lineNoCov">          0 :     his=hisTimeInput-&gt;Projection(1);</span>
<span class="lineNum">    4179 </span>            :     //    Int_t firstBinTime=his-&gt;FindFirstBinAbove(0);
<span class="lineNum">    4180 </span>            :     //Int_t lastBinTime=his-&gt;FindLastBinAbove(0);
<span class="lineNum">    4181 </span>            :     //hisTimeInput-&gt;GetAxis(1)-&gt;SetRange(firstBinTime, lastBinTime);
<span class="lineNum">    4182 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    4183 </span>            :     //
<span class="lineNum">    4184 </span>            :     //
<span class="lineNum">    4185 </span><span class="lineNoCov">          0 :     his=hisTimeInput-&gt;Projection(2);</span>
<span class="lineNum">    4186 </span>            :     //Int_t firstBinZ=his-&gt;FindFirstBinAbove(0);
<span class="lineNum">    4187 </span>            :     //Int_t lastBinZ=his-&gt;FindLastBinAbove(0);
<span class="lineNum">    4188 </span>            :     //hisTimeInput-&gt;GetAxis(2)-&gt;SetRange(firstBinZ, lastBinZ);
<span class="lineNum">    4189 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    4190 </span>            :     //
<span class="lineNum">    4191 </span><span class="lineNoCov">          0 :     his=hisPadInput-&gt;Projection(2);</span>
<span class="lineNum">    4192 </span>            :     //    Int_t firstBinY=his-&gt;FindFirstBinAbove(0);
<span class="lineNum">    4193 </span>            :     //Int_t lastBinY=his-&gt;FindLastBinAbove(0);
<span class="lineNum">    4194 </span>            :     //hisPadInput-&gt;GetAxis(2)-&gt;SetRange(firstBinY, lastBinY);
<span class="lineNum">    4195 </span><span class="lineNoCov">          0 :     delete his;</span>
<span class="lineNum">    4196 </span>            :     //
<span class="lineNum">    4197 </span>            :     //
<span class="lineNum">    4198 </span>            :     //
<span class="lineNum">    4199 </span><span class="lineNoCov">          0 :     THnSparse *hisPad0  = hisPadInput-&gt;Projection(5,indexes);</span>
<span class="lineNum">    4200 </span><span class="lineNoCov">          0 :     THnSparse *hisTime0 = hisTimeInput-&gt;Projection(5,indexes);</span>
<span class="lineNum">    4201 </span>            :     //
<span class="lineNum">    4202 </span>            :     //    
<span class="lineNum">    4203 </span><span class="lineNoCov">          0 :     for (Int_t irow=0; irow&lt;kMaxRow; irow++){</span>
<span class="lineNum">    4204 </span><span class="lineNoCov">          0 :       entries[irow]=0;</span>
<span class="lineNum">    4205 </span><span class="lineNoCov">          0 :       if ((*(ltrp-&gt;GetVecSec()))[irow] &lt;0) continue;</span>
<span class="lineNum">    4206 </span><span class="lineNoCov">          0 :       if ((*(ltrp-&gt;GetVecLX()))[irow] &lt;80) continue;</span>
<span class="lineNum">    4207 </span>            : 
<span class="lineNum">    4208 </span><span class="lineNoCov">          0 :       hisPad0-&gt;GetAxis(4)-&gt;SetRange(irow+1,irow+1);</span>
<span class="lineNum">    4209 </span><span class="lineNoCov">          0 :       hisTime0-&gt;GetAxis(4)-&gt;SetRange(irow+1,irow+1);</span>
<span class="lineNum">    4210 </span>            :       //THnSparse *hisPad  = hisPad0-&gt;Projection(4,indexes);
<span class="lineNum">    4211 </span>            :       //THnSparse *hisTime = hisTime0-&gt;Projection(4,indexes);
<span class="lineNum">    4212 </span>            :       THnSparse *hisPad  = hisPad0;
<span class="lineNum">    4213 </span>            :       THnSparse *hisTime = hisTime0;
<span class="lineNum">    4214 </span>            :       //
<span class="lineNum">    4215 </span>            :       // Get mean value of QA variables
<span class="lineNum">    4216 </span>            :       //
<span class="lineNum">    4217 </span>            :       // dEdx
<span class="lineNum">    4218 </span><span class="lineNoCov">          0 :       his=hisTime-&gt;Projection(3);</span>
<span class="lineNum">    4219 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4220 </span><span class="lineNoCov">          0 :       meandEdx[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4221 </span><span class="lineNoCov">          0 :       sigmadEdx[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4222 </span>            :       //      Int_t bindedx0= his-&gt;FindBin(meandEdx[irow]-kSigma*sigmadEdx[irow]);
<span class="lineNum">    4223 </span>            :       //Int_t bindedx1= his-&gt;FindBin(meandEdx[irow]+kSigma*sigmadEdx[irow]);
<span class="lineNum">    4224 </span>            :       //      hisPad-&gt;GetAxis(3)-&gt;SetRange(bindedx0,bindedx1);
<span class="lineNum">    4225 </span>            :       //hisTime-&gt;GetAxis(3)-&gt;SetRange(bindedx0,bindedx1 );
<span class="lineNum">    4226 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4227 </span>            :       //
<span class="lineNum">    4228 </span>            :       // sigma Time
<span class="lineNum">    4229 </span>            :       //
<span class="lineNum">    4230 </span><span class="lineNoCov">          0 :       his=hisTime-&gt;Projection(2);</span>
<span class="lineNum">    4231 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()-kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4232 </span><span class="lineNoCov">          0 :       meanSTime[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4233 </span><span class="lineNoCov">          0 :       sigmaSTime[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4234 </span>            :       //Int_t binSTime0= his-&gt;FindBin(his-&gt;GetMean()-kSigma*his-&gt;GetRMS());
<span class="lineNum">    4235 </span>            :       //Int_t binSTime1= his-&gt;FindBin(his-&gt;GetMean()+kSigma*his-&gt;GetRMS());
<span class="lineNum">    4236 </span>            :       //      hisTime-&gt;GetAxis(2)-&gt;SetRange(binSTime0, binSTime1);
<span class="lineNum">    4237 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4238 </span>            :       //
<span class="lineNum">    4239 </span>            :       // sigma Pad
<span class="lineNum">    4240 </span><span class="lineNoCov">          0 :       his=hisPad-&gt;Projection(2);</span>
<span class="lineNum">    4241 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4242 </span><span class="lineNoCov">          0 :       meanSPad[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4243 </span><span class="lineNoCov">          0 :       sigmaSPad[irow]=his-&gt;GetRMS();   </span>
<span class="lineNum">    4244 </span>            :       //      Int_t binSPad0= his-&gt;FindBin(his-&gt;GetMean()-kSigma*his-&gt;GetRMS());
<span class="lineNum">    4245 </span>            :       //Int_t binSPad1= his-&gt;FindBin(his-&gt;GetMean()+kSigma*his-&gt;GetRMS());
<span class="lineNum">    4246 </span>            :       //      hisPad-&gt;GetAxis(2)-&gt;SetRange(binSPad0, binSPad1);
<span class="lineNum">    4247 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4248 </span>            :       //
<span class="lineNum">    4249 </span>            :       // apply selection on QA variables
<span class="lineNum">    4250 </span>            :       //
<span class="lineNum">    4251 </span>            :       //
<span class="lineNum">    4252 </span>            :       //
<span class="lineNum">    4253 </span>            :       // Y
<span class="lineNum">    4254 </span><span class="lineNoCov">          0 :       his=hisPad-&gt;Projection(0);</span>
<span class="lineNum">    4255 </span><span class="lineNoCov">          0 :       entries[irow]=his-&gt;GetEntries();</span>
<span class="lineNum">    4256 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4257 </span><span class="lineNoCov">          0 :       meanY[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4258 </span><span class="lineNoCov">          0 :       sigmaY[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4259 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4260 </span>            :       // Z
<span class="lineNum">    4261 </span><span class="lineNoCov">          0 :       his=hisTime-&gt;Projection(0);</span>
<span class="lineNum">    4262 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4263 </span><span class="lineNoCov">          0 :       meanZ[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4264 </span><span class="lineNoCov">          0 :       sigmaZ[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4265 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4266 </span>            :       // Pad
<span class="lineNum">    4267 </span><span class="lineNoCov">          0 :       his=hisPad-&gt;Projection(1);</span>
<span class="lineNum">    4268 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4269 </span><span class="lineNoCov">          0 :       meanPad[irow] =his-&gt;GetMean();</span>
<span class="lineNum">    4270 </span><span class="lineNoCov">          0 :       meanDPad[irow] =his-&gt;GetMean()-Int_t(his-&gt;GetMean());</span>
<span class="lineNum">    4271 </span><span class="lineNoCov">          0 :       sigmaPad[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4272 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4273 </span>            :       // Time
<span class="lineNum">    4274 </span><span class="lineNoCov">          0 :       his=hisTime-&gt;Projection(1);</span>
<span class="lineNum">    4275 </span><span class="lineNoCov">          0 :       his-&gt;GetXaxis()-&gt;SetRangeUser(his-&gt;GetMean()-kSigma*his-&gt;GetRMS(), his-&gt;GetMean()+kSigma*his-&gt;GetRMS());</span>
<span class="lineNum">    4276 </span><span class="lineNoCov">          0 :       meanTime[irow]  = his-&gt;GetMean();</span>
<span class="lineNum">    4277 </span><span class="lineNoCov">          0 :       meanDTime[irow] = his-&gt;GetMean()-Int_t(his-&gt;GetMean());</span>
<span class="lineNum">    4278 </span><span class="lineNoCov">          0 :       sigmaTime[irow]=his-&gt;GetRMS();</span>
<span class="lineNum">    4279 </span><span class="lineNoCov">          0 :       delete his;</span>
<span class="lineNum">    4280 </span>            :       //
<span class="lineNum">    4281 </span>            :       //delete hisTime;
<span class="lineNum">    4282 </span>            :       //delete hisPad;
<span class="lineNum">    4283 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4284 </span>            :     //
<span class="lineNum">    4285 </span>            :     //
<span class="lineNum">    4286 </span>            :     //
<span class="lineNum">    4287 </span><span class="lineNoCov">          0 :     (*pcstream)&lt;&lt;&quot;laserClusters&quot;&lt;&lt;</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">          0 :       &quot;id=&quot;&lt;&lt;id&lt;&lt;      </span>
<span class="lineNum">    4289 </span><span class="lineNoCov">          0 :       &quot;run=&quot;&lt;&lt;run&lt;&lt;</span>
<span class="lineNum">    4290 </span><span class="lineNoCov">          0 :       &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;</span>
<span class="lineNum">    4291 </span>            :       //
<span class="lineNum">    4292 </span><span class="lineNoCov">          0 :       &quot;entries.=&quot;&lt;&lt;&amp;entries&lt;&lt;</span>
<span class="lineNum">    4293 </span><span class="lineNoCov">          0 :       &quot;my.=&quot;&lt;&lt;&amp;meanY&lt;&lt;           //mean delta y</span>
<span class="lineNum">    4294 </span><span class="lineNoCov">          0 :       &quot;rmsy.=&quot;&lt;&lt;&amp;sigmaY&lt;&lt;        //rms deltay</span>
<span class="lineNum">    4295 </span><span class="lineNoCov">          0 :       &quot;mz.=&quot;&lt;&lt;&amp;meanZ&lt;&lt;           //mean deltaz</span>
<span class="lineNum">    4296 </span><span class="lineNoCov">          0 :       &quot;rmsz.=&quot;&lt;&lt;&amp;sigmaZ&lt;&lt;        //rms z</span>
<span class="lineNum">    4297 </span>            :       //
<span class="lineNum">    4298 </span><span class="lineNoCov">          0 :       &quot;mPad.=&quot;&lt;&lt;&amp;meanPad&lt;&lt;       // mean pad</span>
<span class="lineNum">    4299 </span><span class="lineNoCov">          0 :       &quot;mDPad.=&quot;&lt;&lt;&amp;meanDPad&lt;&lt;     // mead dpad</span>
<span class="lineNum">    4300 </span><span class="lineNoCov">          0 :       &quot;rmsPad.=&quot;&lt;&lt;&amp;sigmaPad&lt;&lt;    // rms pad</span>
<span class="lineNum">    4301 </span><span class="lineNoCov">          0 :       &quot;mTime.=&quot;&lt;&lt;&amp;meanTime&lt;&lt;     </span>
<span class="lineNum">    4302 </span><span class="lineNoCov">          0 :       &quot;mDTime.=&quot;&lt;&lt;&amp;meanTime&lt;&lt;</span>
<span class="lineNum">    4303 </span><span class="lineNoCov">          0 :       &quot;rmsTime.=&quot;&lt;&lt;&amp;sigmaTime&lt;&lt;</span>
<span class="lineNum">    4304 </span>            :       //
<span class="lineNum">    4305 </span><span class="lineNoCov">          0 :       &quot;mdEdx.=&quot;&lt;&lt;&amp;meandEdx&lt;&lt;      //mean dedx</span>
<span class="lineNum">    4306 </span><span class="lineNoCov">          0 :       &quot;rmsdEdx.=&quot;&lt;&lt;&amp;sigmadEdx&lt;&lt;   //rms dedx</span>
<span class="lineNum">    4307 </span><span class="lineNoCov">          0 :       &quot;mSPad.=&quot;&lt;&lt;&amp;meanSPad&lt;&lt;      //mean sigma pad</span>
<span class="lineNum">    4308 </span><span class="lineNoCov">          0 :       &quot;rmsSPad.=&quot;&lt;&lt;&amp;sigmaSPad&lt;&lt;   //rms sigma pad</span>
<span class="lineNum">    4309 </span><span class="lineNoCov">          0 :       &quot;mSTime.=&quot;&lt;&lt;&amp;meanSTime&lt;&lt;    //mean sigma time</span>
<span class="lineNum">    4310 </span><span class="lineNoCov">          0 :       &quot;rmsSTime.=&quot;&lt;&lt;&amp;sigmaSTime&lt;&lt;</span>
<span class="lineNum">    4311 </span>            :       &quot;\n&quot;;
<span class="lineNum">    4312 </span>            :     //
<span class="lineNum">    4313 </span><span class="lineNoCov">          0 :     delete hisPad0;</span>
<span class="lineNum">    4314 </span><span class="lineNoCov">          0 :     delete hisTime0;</span>
<span class="lineNum">    4315 </span>            :   }
<span class="lineNum">    4316 </span><span class="lineNoCov">          0 :   delete pcstream;</span>
<span class="lineNum">    4317 </span>            : 
<span class="lineNum">    4318 </span>            :   /*
<span class="lineNum">    4319 </span>            :     
<span class="lineNum">    4320 </span>            :   */
<a name="4321"><span class="lineNum">    4321 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4322 </span>            : 
<span class="lineNum">    4323 </span>            : void AliTPCcalibLaser::FitLaserClusters(Int_t run){
<span class="lineNum">    4324 </span>            :   //
<span class="lineNum">    4325 </span>            :   //
<span class="lineNum">    4326 </span>            :   //input=&quot;TPCLaserObjects.root&quot;
<span class="lineNum">    4327 </span>            :   //Algorithm:
<span class="lineNum">    4328 </span>            :   //   1. Select cluster candidates, remove outlyers
<span class="lineNum">    4329 </span>            :   //             edge clusters
<span class="lineNum">    4330 </span>            :   //             clusters with atypical spread (e.g due track overlaps)
<span class="lineNum">    4331 </span>            :   //             small amount of entries clusters (absolute minimal cut + raltive -to mean cut) 
<span class="lineNum">    4332 </span>            :   //   2. Fit the tracklets -per sector - in pad and time coordinate frame
<span class="lineNum">    4333 </span>            :   //             Remove outlyers
<span class="lineNum">    4334 </span>            :   //             Store info distance of track to pad, time center
<span class="lineNum">    4335 </span>            :   //             Fit the correction for distance to the center (sin,cos)
<span class="lineNum">    4336 </span>            :   //   3. Do local fit
<span class="lineNum">    4337 </span>            :   const Double_t kEpsilon=0.000001;
<span class="lineNum">    4338 </span>            :   const Int_t     kMinClusters=20;
<span class="lineNum">    4339 </span>            :   const Double_t kEdgeCut=3;
<span class="lineNum">    4340 </span>            :   const Double_t kDistCut=1.5;                 // cut distance to the ideal track
<span class="lineNum">    4341 </span>            :   const Double_t kDistCutFit=0.5;              
<span class="lineNum">    4342 </span>            :   const Double_t kDistCutFitPad=0.25;
<span class="lineNum">    4343 </span>            :   const Double_t kDistCutFitTime=0.25;
<span class="lineNum">    4344 </span>            :   const Int_t kSmoothRow=5;
<span class="lineNum">    4345 </span><span class="lineNoCov">          0 :   TFile f(&quot;hisLasers.root&quot;);  // Input file</span>
<span class="lineNum">    4346 </span><span class="lineNoCov">          0 :   TTree * treeInput=(TTree*)f.Get(&quot;laserClusters&quot;); </span>
<span class="lineNum">    4347 </span><span class="lineNoCov">          0 :   TTreeSRedirector *pcstream=new TTreeSRedirector(&quot;fitLasers.root&quot;);</span>
<span class="lineNum">    4348 </span><span class="lineNoCov">          0 :   TVectorD *vecN=0;</span>
<span class="lineNum">    4349 </span><span class="lineNoCov">          0 :   TVectorD *vecMY=0;</span>
<span class="lineNum">    4350 </span><span class="lineNoCov">          0 :   TVectorD *vecMZ=0;</span>
<span class="lineNum">    4351 </span><span class="lineNoCov">          0 :   TVectorD *vecPad=0;</span>
<span class="lineNum">    4352 </span><span class="lineNoCov">          0 :   TVectorD *vecTime=0;</span>
<span class="lineNum">    4353 </span><span class="lineNoCov">          0 :   TVectorD *vecSY=0;</span>
<span class="lineNum">    4354 </span><span class="lineNoCov">          0 :   TVectorD *vecSZ=0;</span>
<span class="lineNum">    4355 </span><span class="lineNoCov">          0 :   TVectorD *meandEdx=0;</span>
<span class="lineNum">    4356 </span><span class="lineNoCov">          0 :   TVectorD  isOK(kMaxRow);</span>
<span class="lineNum">    4357 </span><span class="lineNoCov">          0 :   TVectorD  fitPad(kMaxRow);</span>
<span class="lineNum">    4358 </span><span class="lineNoCov">          0 :   TVectorD  fitTime(kMaxRow);</span>
<span class="lineNum">    4359 </span><span class="lineNoCov">          0 :   TVectorD  fitPadLocal(kMaxRow);</span>
<span class="lineNum">    4360 </span><span class="lineNoCov">          0 :   TVectorD  fitTimeLocal(kMaxRow);</span>
<span class="lineNum">    4361 </span><span class="lineNoCov">          0 :   TVectorD  fitDPad(kMaxRow);</span>
<span class="lineNum">    4362 </span><span class="lineNoCov">          0 :   TVectorD  fitDTime(kMaxRow);</span>
<span class="lineNum">    4363 </span><span class="lineNoCov">          0 :   TVectorD  fitIPad(kMaxRow);</span>
<span class="lineNum">    4364 </span><span class="lineNoCov">          0 :   TVectorD  fitITime(kMaxRow);</span>
<span class="lineNum">    4365 </span><span class="lineNoCov">          0 :   Double_t  chi2PadIROC=0;</span>
<span class="lineNum">    4366 </span><span class="lineNoCov">          0 :   Double_t  chi2PadOROC=0;</span>
<span class="lineNum">    4367 </span>            :   //
<span class="lineNum">    4368 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;my.&quot;,&amp;vecMY);</span>
<span class="lineNum">    4369 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;mz.&quot;,&amp;vecMZ);</span>
<span class="lineNum">    4370 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;mPad.&quot;,&amp;vecPad);</span>
<span class="lineNum">    4371 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;mTime.&quot;,&amp;vecTime);</span>
<span class="lineNum">    4372 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;rmsy.&quot;,&amp;vecSY);</span>
<span class="lineNum">    4373 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;rmsz.&quot;,&amp;vecSZ);</span>
<span class="lineNum">    4374 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;entries.&quot;,&amp;vecN);</span>
<span class="lineNum">    4375 </span><span class="lineNoCov">          0 :   treeInput-&gt;SetBranchAddress(&quot;mdEdx.&quot;,&amp;meandEdx);</span>
<span class="lineNum">    4376 </span>            : 
<span class="lineNum">    4377 </span><span class="lineNoCov">          0 :   AliTPCLaserTrack::LoadTracks();</span>
<span class="lineNum">    4378 </span>            :   //
<span class="lineNum">    4379 </span>            :   //
<span class="lineNum">    4380 </span><span class="lineNoCov">          0 :   TVectorD fitPadIROC(3),     fitPadOROC(3);</span>
<span class="lineNum">    4381 </span><span class="lineNoCov">          0 :   TVectorD fitPadIROCSin(3),  fitPadOROCSin(3);</span>
<span class="lineNum">    4382 </span><span class="lineNoCov">          0 :   TVectorD fitTimeIROC(3),    fitTimeOROC(3);</span>
<span class="lineNum">    4383 </span><span class="lineNoCov">          0 :   TVectorD fitTimeIROCSin(3), fitTimeOROCSin(3);</span>
<span class="lineNum">    4384 </span>            :   //
<span class="lineNum">    4385 </span><span class="lineNoCov">          0 :   AliTPCROC * roc = AliTPCROC::Instance();</span>
<span class="lineNum">    4386 </span><span class="lineNoCov">          0 :   Double_t refX=roc-&gt;GetPadRowRadii(0,roc-&gt;GetNRows(0)-1);</span>
<span class="lineNum">    4387 </span>            :   
<span class="lineNum">    4388 </span>            :   //
<span class="lineNum">    4389 </span><span class="lineNoCov">          0 :   for (Int_t id=0; id&lt;336; id++){</span>
<span class="lineNum">    4390 </span>            :     //
<span class="lineNum">    4391 </span><span class="lineNoCov">          0 :     treeInput-&gt;GetEntry(id);</span>
<span class="lineNum">    4392 </span><span class="lineNoCov">          0 :     AliTPCLaserTrack *ltrp =(AliTPCLaserTrack*)AliTPCLaserTrack::GetTracks()-&gt;UncheckedAt(id);</span>
<span class="lineNum">    4393 </span><span class="lineNoCov">          0 :     Int_t medianEntries = TMath::Nint(TMath::Median(kMaxRow,vecN-&gt;GetMatrixArray()));</span>
<span class="lineNum">    4394 </span><span class="lineNoCov">          0 :     Double_t medianRMSY = TMath::Median(kMaxRow,vecSY-&gt;GetMatrixArray());</span>
<span class="lineNum">    4395 </span><span class="lineNoCov">          0 :     Double_t rmsRMSY    = TMath::RMS(kMaxRow,vecSY-&gt;GetMatrixArray());</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">          0 :     Double_t medianRMSZ = TMath::Median(kMaxRow,vecSZ-&gt;GetMatrixArray());</span>
<span class="lineNum">    4397 </span><span class="lineNoCov">          0 :     Double_t rmsRMSZ    = TMath::RMS(kMaxRow,vecSZ-&gt;GetMatrixArray());</span>
<span class="lineNum">    4398 </span><span class="lineNoCov">          0 :     Double_t mdEdx      = TMath::Median(kMaxRow,meandEdx-&gt;GetMatrixArray());</span>
<span class="lineNum">    4399 </span><span class="lineNoCov">          0 :     Int_t sectorInner= TMath::Nint(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[63/2]);</span>
<span class="lineNum">    4400 </span><span class="lineNoCov">          0 :     Int_t sectorOuter= TMath::Nint(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[64+96/2]);</span>
<span class="lineNum">    4401 </span><span class="lineNoCov">          0 :     TLinearFitter fitterY(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4402 </span><span class="lineNoCov">          0 :     TLinearFitter fitterZ(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4403 </span><span class="lineNoCov">          0 :     TLinearFitter fitterPad(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4404 </span><span class="lineNoCov">          0 :     TLinearFitter fitterTime(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4405 </span><span class="lineNoCov">          0 :     TLinearFitter fitterPadSin(2,&quot;hyp1&quot;);</span>
<span class="lineNum">    4406 </span><span class="lineNoCov">          0 :     TLinearFitter fitterTimeSin(3,&quot;hyp2&quot;);    </span>
<span class="lineNum">    4407 </span>            :     //
<span class="lineNum">    4408 </span>            :     //
<span class="lineNum">    4409 </span><span class="lineNoCov">          0 :     for (UInt_t irow=0; irow&lt;kMaxRow; irow++){</span>
<span class="lineNum">    4410 </span><span class="lineNoCov">          0 :       fitPad[irow]=0; fitIPad[irow]=0; fitDPad[irow]=0;</span>
<span class="lineNum">    4411 </span><span class="lineNoCov">          0 :       fitTime[irow]=0; fitITime[irow]=0; fitDTime[irow]=0;</span>
<span class="lineNum">    4412 </span><span class="lineNoCov">          0 :       Double_t sign=(ltrp-&gt;GetZ()&gt;0) ? 1.:-1.;</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">          0 :       isOK[irow]=kFALSE;    </span>
<span class="lineNum">    4414 </span><span class="lineNoCov">          0 :       fitPad[irow]=0;</span>
<span class="lineNum">    4415 </span><span class="lineNoCov">          0 :       fitTime[irow]=0;</span>
<span class="lineNum">    4416 </span><span class="lineNoCov">          0 :       Int_t sector=(irow&lt;roc-&gt;GetNRows(0))? sectorInner:sectorOuter;      </span>
<span class="lineNum">    4417 </span><span class="lineNoCov">          0 :       Int_t npads=(irow&lt;roc-&gt;GetNRows(0))? roc-&gt;GetNPads(sector,irow):roc-&gt;GetNPads(sector,irow-roc-&gt;GetNRows(0));</span>
<span class="lineNum">    4418 </span><span class="lineNoCov">          0 :       (*vecPad)[irow]-=npads*0.5;       </span>
<span class="lineNum">    4419 </span>            :       //
<span class="lineNum">    4420 </span><span class="lineNoCov">          0 :       if ((irow&lt;roc-&gt;GetNRows(0)) &amp;&amp;TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorInner)&gt;0.1) continue;</span>
<span class="lineNum">    4421 </span><span class="lineNoCov">          0 :       if ((irow&gt;=roc-&gt;GetNRows(0)) &amp;&amp;TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorOuter)&gt;0.1) continue;</span>
<span class="lineNum">    4422 </span>            :       //
<span class="lineNum">    4423 </span><span class="lineNoCov">          0 :       if (TMath::Abs((*vecMY)[irow])&lt;kEpsilon) continue;   //not determined position</span>
<span class="lineNum">    4424 </span><span class="lineNoCov">          0 :       if (TMath::Abs((*vecMZ)[irow])&lt;kEpsilon) continue;   //not determined position</span>
<span class="lineNum">    4425 </span><span class="lineNoCov">          0 :       if (TMath::Abs((*vecPad)[irow])&lt;kEpsilon) continue;   //not determined position</span>
<span class="lineNum">    4426 </span><span class="lineNoCov">          0 :       if (TMath::Abs((*vecTime)[irow])&lt;kEpsilon) continue;   //not determined position</span>
<span class="lineNum">    4427 </span><span class="lineNoCov">          0 :       if ((*vecN)[irow]&lt;0.5*medianEntries) continue;       //small amount of clusters</span>
<span class="lineNum">    4428 </span><span class="lineNoCov">          0 :       if ((*vecSY)[irow]&gt;medianRMSY+3*rmsRMSY) continue;   //big sigma</span>
<span class="lineNum">    4429 </span><span class="lineNoCov">          0 :       if ((*vecSZ)[irow]&gt;medianRMSZ+3*rmsRMSZ) continue;   //big sigma</span>
<span class="lineNum">    4430 </span><span class="lineNoCov">          0 :       Double_t dEdge= TMath::Abs((*(ltrp-&gt;GetVecLY()))[irow])-(*(ltrp-&gt;GetVecLX()))[irow]*TMath::Tan(TMath::Pi()/18.); //edge cut</span>
<span class="lineNum">    4431 </span><span class="lineNoCov">          0 :       if (TMath::Abs(dEdge)&lt;kEdgeCut) continue;</span>
<span class="lineNum">    4432 </span><span class="lineNoCov">          0 :       if (irow&lt;roc-&gt;GetNRows(0)){</span>
<span class="lineNum">    4433 </span><span class="lineNoCov">          0 :         if (TMath::Abs(((*ltrp-&gt;GetVecLY())[irow])-sign*(*vecPad)[irow]*0.4)&gt;kDistCut) continue;</span>
<span class="lineNum">    4434 </span>            :       }
<span class="lineNum">    4435 </span><span class="lineNoCov">          0 :       if (irow&gt;roc-&gt;GetNRows(0)){</span>
<span class="lineNum">    4436 </span><span class="lineNoCov">          0 :         if (TMath::Abs(((*ltrp-&gt;GetVecLY())[irow])-sign*(*vecPad)[irow]*0.6)&gt;kDistCut) continue;</span>
<span class="lineNum">    4437 </span>            :       }
<span class="lineNum">    4438 </span>            :       
<span class="lineNum">    4439 </span><span class="lineNoCov">          0 :       isOK[irow]=kTRUE;     </span>
<span class="lineNum">    4440 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4441 </span>            :     //
<span class="lineNum">    4442 </span>            :     //fit OROC - get delta pad and delta time 
<span class="lineNum">    4443 </span>            :     //
<span class="lineNum">    4444 </span><span class="lineNoCov">          0 :     fitterPad.ClearPoints();</span>
<span class="lineNum">    4445 </span><span class="lineNoCov">          0 :     fitterTime.ClearPoints();    </span>
<span class="lineNum">    4446 </span><span class="lineNoCov">          0 :     fitterPadSin.ClearPoints();</span>
<span class="lineNum">    4447 </span><span class="lineNoCov">          0 :     fitterTimeSin.ClearPoints();    </span>
<span class="lineNum">    4448 </span><span class="lineNoCov">          0 :     {for (Int_t irow=2; irow&lt;157; irow++){</span>
<span class="lineNum">    4449 </span><span class="lineNoCov">          0 :         if (isOK[irow]&lt;0.5) continue;        </span>
<span class="lineNum">    4450 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorOuter)&gt;0.1) continue;</span>
<span class="lineNum">    4451 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow])&lt;80) continue;</span>
<span class="lineNum">    4452 </span><span class="lineNoCov">          0 :         Double_t y=(*vecPad)[irow];</span>
<span class="lineNum">    4453 </span><span class="lineNoCov">          0 :         Double_t z=(*vecTime)[irow];</span>
<span class="lineNum">    4454 </span><span class="lineNoCov">          0 :         Double_t x=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow]-refX;</span>
<span class="lineNum">    4455 </span><span class="lineNoCov">          0 :         fitterPad.AddPoint(&amp;x,y);</span>
<span class="lineNum">    4456 </span><span class="lineNoCov">          0 :         fitterTime.AddPoint(&amp;x,z);</span>
<span class="lineNum">    4457 </span><span class="lineNoCov">          0 :       }}</span>
<span class="lineNum">    4458 </span><span class="lineNoCov">          0 :     chi2PadOROC=0;</span>
<span class="lineNum">    4459 </span><span class="lineNoCov">          0 :     if (fitterPad.GetNpoints()&gt;kMinClusters&amp;&amp;fitterTime.GetNpoints()&gt;kMinClusters){</span>
<span class="lineNum">    4460 </span><span class="lineNoCov">          0 :       fitterPad.Eval();</span>
<span class="lineNum">    4461 </span><span class="lineNoCov">          0 :       fitterTime.Eval();</span>
<span class="lineNum">    4462 </span><span class="lineNoCov">          0 :       chi2PadOROC=TMath::Sqrt(fitterPad.GetChisquare()/fitterPad.GetNpoints());</span>
<span class="lineNum">    4463 </span><span class="lineNoCov">          0 :       for (Int_t irow=2; irow&lt;157; irow++){</span>
<span class="lineNum">    4464 </span><span class="lineNoCov">          0 :         if (isOK[irow]&lt;0.5) continue;        </span>
<span class="lineNum">    4465 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorOuter)&gt;0.1) continue;</span>
<span class="lineNum">    4466 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow])&lt;80) continue;</span>
<span class="lineNum">    4467 </span><span class="lineNoCov">          0 :         Double_t y=(*vecPad)[irow];</span>
<span class="lineNum">    4468 </span><span class="lineNoCov">          0 :         Double_t z=(*vecTime)[irow];</span>
<span class="lineNum">    4469 </span><span class="lineNoCov">          0 :         Double_t x=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow]-refX;</span>
<span class="lineNum">    4470 </span><span class="lineNoCov">          0 :         Double_t fitP=fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x;</span>
<span class="lineNum">    4471 </span><span class="lineNoCov">          0 :         Double_t fitT=fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x;</span>
<span class="lineNum">    4472 </span><span class="lineNoCov">          0 :         fitPad[irow]=fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x;</span>
<span class="lineNum">    4473 </span><span class="lineNoCov">          0 :         fitTime[irow]=fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x;</span>
<span class="lineNum">    4474 </span><span class="lineNoCov">          0 :         fitDPad[irow]=y-(fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x);</span>
<span class="lineNum">    4475 </span><span class="lineNoCov">          0 :         fitDTime[irow]=z-(fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x);</span>
<span class="lineNum">    4476 </span><span class="lineNoCov">          0 :         fitIPad[irow]=fitP-TMath::Nint(fitP-0.5);</span>
<span class="lineNum">    4477 </span><span class="lineNoCov">          0 :         fitITime[irow]=fitT-TMath::Nint(fitT-0.5);</span>
<span class="lineNum">    4478 </span><span class="lineNoCov">          0 :         if (fitDPad[irow]&gt;kDistCutFit) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4479 </span><span class="lineNoCov">          0 :         if (fitDTime[irow]&gt;kDistCutFit) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4480 </span><span class="lineNoCov">          0 :         if (isOK[irow]&gt;0){</span>
<span class="lineNum">    4481 </span><span class="lineNoCov">          0 :           Double_t xxxPad[2]={TMath::Sin(2*TMath::Pi()*fitIPad[irow])};</span>
<span class="lineNum">    4482 </span><span class="lineNoCov">          0 :           Double_t xxxTime[3]={TMath::Sin(2*TMath::Pi()*fitITime[irow]),</span>
<span class="lineNum">    4483 </span><span class="lineNoCov">          0 :                                TMath::Cos(2*TMath::Pi()*fitITime[irow])};</span>
<span class="lineNum">    4484 </span><span class="lineNoCov">          0 :           fitterPadSin.AddPoint(xxxPad,fitDPad[irow]);</span>
<span class="lineNum">    4485 </span><span class="lineNoCov">          0 :           fitterTimeSin.AddPoint(xxxTime,fitDTime[irow]);</span>
<span class="lineNum">    4486 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    4487 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    4488 </span><span class="lineNoCov">          0 :       fitterPadSin.Eval();</span>
<span class="lineNum">    4489 </span><span class="lineNoCov">          0 :       fitterTimeSin.Eval();</span>
<span class="lineNum">    4490 </span><span class="lineNoCov">          0 :       fitterPadSin.FixParameter(0,0);</span>
<span class="lineNum">    4491 </span><span class="lineNoCov">          0 :       fitterTimeSin.FixParameter(0,0);</span>
<span class="lineNum">    4492 </span><span class="lineNoCov">          0 :       fitterPadSin.Eval();</span>
<span class="lineNum">    4493 </span><span class="lineNoCov">          0 :       fitterTimeSin.Eval();</span>
<span class="lineNum">    4494 </span>            :       //
<span class="lineNum">    4495 </span><span class="lineNoCov">          0 :       fitterPad.GetParameters(fitPadOROC);</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">          0 :       fitterTime.GetParameters(fitTimeOROC);</span>
<span class="lineNum">    4497 </span><span class="lineNoCov">          0 :       fitterPadSin.GetParameters(fitPadOROCSin);</span>
<span class="lineNum">    4498 </span><span class="lineNoCov">          0 :       fitterTimeSin.GetParameters(fitTimeOROCSin);</span>
<span class="lineNum">    4499 </span>            :     }
<span class="lineNum">    4500 </span>            :     //
<span class="lineNum">    4501 </span>            :     //
<span class="lineNum">    4502 </span>            :     //fit IROC
<span class="lineNum">    4503 </span>            :     //
<span class="lineNum">    4504 </span><span class="lineNoCov">          0 :     fitterPad.ClearPoints();</span>
<span class="lineNum">    4505 </span><span class="lineNoCov">          0 :     fitterTime.ClearPoints();    </span>
<span class="lineNum">    4506 </span><span class="lineNoCov">          0 :     fitterPadSin.ClearPoints();</span>
<span class="lineNum">    4507 </span><span class="lineNoCov">          0 :     fitterTimeSin.ClearPoints();    </span>
<span class="lineNum">    4508 </span><span class="lineNoCov">          0 :     for (Int_t irow=2; irow&lt;157; irow++){</span>
<span class="lineNum">    4509 </span><span class="lineNoCov">          0 :       if (isOK[irow]&lt;0.5) continue;  </span>
<span class="lineNum">    4510 </span><span class="lineNoCov">          0 :       if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorInner)&gt;0.1) continue;</span>
<span class="lineNum">    4511 </span><span class="lineNoCov">          0 :       if (TMath::Abs(ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow])&lt;80) continue;</span>
<span class="lineNum">    4512 </span><span class="lineNoCov">          0 :       Double_t y=(*vecPad)[irow];</span>
<span class="lineNum">    4513 </span><span class="lineNoCov">          0 :       Double_t z=(*vecTime)[irow];</span>
<span class="lineNum">    4514 </span><span class="lineNoCov">          0 :       Double_t x=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow]-refX;</span>
<span class="lineNum">    4515 </span><span class="lineNoCov">          0 :       fitterPad.AddPoint(&amp;x,y);</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">          0 :       fitterTime.AddPoint(&amp;x,z);</span>
<span class="lineNum">    4517 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4518 </span><span class="lineNoCov">          0 :     chi2PadIROC=0;</span>
<span class="lineNum">    4519 </span><span class="lineNoCov">          0 :     if (fitterPad.GetNpoints()&gt;kMinClusters&amp;&amp;fitterTime.GetNpoints()&gt;kMinClusters){</span>
<span class="lineNum">    4520 </span><span class="lineNoCov">          0 :       fitterPad.Eval();</span>
<span class="lineNum">    4521 </span><span class="lineNoCov">          0 :       fitterTime.Eval();</span>
<span class="lineNum">    4522 </span><span class="lineNoCov">          0 :       chi2PadIROC=TMath::Sqrt(fitterPad.GetChisquare()/fitterPad.GetNpoints());</span>
<span class="lineNum">    4523 </span><span class="lineNoCov">          0 :       for (Int_t irow=2; irow&lt;157; irow++){</span>
<span class="lineNum">    4524 </span><span class="lineNoCov">          0 :         if (isOK[irow]&lt;0.5) continue;        </span>
<span class="lineNum">    4525 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sectorInner)&gt;0.1) continue;</span>
<span class="lineNum">    4526 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow])&lt;80) continue;</span>
<span class="lineNum">    4527 </span><span class="lineNoCov">          0 :         Double_t y=(*vecPad)[irow];</span>
<span class="lineNum">    4528 </span><span class="lineNoCov">          0 :         Double_t z=(*vecTime)[irow];</span>
<span class="lineNum">    4529 </span><span class="lineNoCov">          0 :         Double_t x=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow]-refX;</span>
<span class="lineNum">    4530 </span><span class="lineNoCov">          0 :         Double_t fitP=fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x;</span>
<span class="lineNum">    4531 </span><span class="lineNoCov">          0 :         Double_t fitT=fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x;</span>
<span class="lineNum">    4532 </span><span class="lineNoCov">          0 :         fitPad[irow]=fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x;</span>
<span class="lineNum">    4533 </span><span class="lineNoCov">          0 :         fitTime[irow]=fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x;</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">          0 :         fitDPad[irow]=y-(fitterPad.GetParameter(0)+fitterPad.GetParameter(1)*x);</span>
<span class="lineNum">    4535 </span><span class="lineNoCov">          0 :         fitDTime[irow]=z-(fitterTime.GetParameter(0)+fitterTime.GetParameter(1)*x);</span>
<span class="lineNum">    4536 </span><span class="lineNoCov">          0 :         fitIPad[irow]=fitP-TMath::Nint(fitP-0.5);</span>
<span class="lineNum">    4537 </span><span class="lineNoCov">          0 :         fitITime[irow]=fitT-TMath::Nint(fitT-0.5);</span>
<span class="lineNum">    4538 </span><span class="lineNoCov">          0 :         if (fitDPad[irow]&gt;kDistCutFit) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4539 </span><span class="lineNoCov">          0 :         if (fitDTime[irow]&gt;kDistCutFit) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4540 </span><span class="lineNoCov">          0 :         if (isOK[irow]&gt;0.5){</span>
<span class="lineNum">    4541 </span><span class="lineNoCov">          0 :           Double_t xxxPad[3]={TMath::Sin(2*TMath::Pi()*fitIPad[irow]),</span>
<span class="lineNum">    4542 </span><span class="lineNoCov">          0 :                          TMath::Cos(2*TMath::Pi()*fitIPad[irow])};</span>
<span class="lineNum">    4543 </span><span class="lineNoCov">          0 :           Double_t xxxTime[3]={TMath::Sin(2*TMath::Pi()*fitITime[irow]),</span>
<span class="lineNum">    4544 </span><span class="lineNoCov">          0 :                          TMath::Cos(2*TMath::Pi()*fitITime[irow])};</span>
<span class="lineNum">    4545 </span><span class="lineNoCov">          0 :           fitterPadSin.AddPoint(xxxPad,fitDPad[irow]);</span>
<span class="lineNum">    4546 </span><span class="lineNoCov">          0 :           fitterTimeSin.AddPoint(xxxTime,fitDTime[irow]);</span>
<span class="lineNum">    4547 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    4548 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    4549 </span><span class="lineNoCov">          0 :       fitterPadSin.Eval();</span>
<span class="lineNum">    4550 </span><span class="lineNoCov">          0 :       fitterTimeSin.Eval();</span>
<span class="lineNum">    4551 </span><span class="lineNoCov">          0 :       fitterPadSin.FixParameter(0,0);</span>
<span class="lineNum">    4552 </span><span class="lineNoCov">          0 :       fitterTimeSin.FixParameter(0,0);</span>
<span class="lineNum">    4553 </span><span class="lineNoCov">          0 :       fitterPadSin.Eval();</span>
<span class="lineNum">    4554 </span><span class="lineNoCov">          0 :       fitterTimeSin.Eval();</span>
<span class="lineNum">    4555 </span><span class="lineNoCov">          0 :       fitterPad.GetParameters(fitPadIROC);</span>
<span class="lineNum">    4556 </span><span class="lineNoCov">          0 :       fitterTime.GetParameters(fitTimeIROC);</span>
<span class="lineNum">    4557 </span><span class="lineNoCov">          0 :       fitterPadSin.GetParameters(fitPadIROCSin);</span>
<span class="lineNum">    4558 </span><span class="lineNoCov">          0 :       fitterTimeSin.GetParameters(fitTimeIROCSin);</span>
<span class="lineNum">    4559 </span>            :     }
<span class="lineNum">    4560 </span><span class="lineNoCov">          0 :     for (Int_t irow=0; irow&lt;kMaxRow; irow++){</span>
<span class="lineNum">    4561 </span><span class="lineNoCov">          0 :       if (TMath::Abs(fitDPad[irow])&lt;kEpsilon)  isOK[irow]=kFALSE;</span>
<span class="lineNum">    4562 </span><span class="lineNoCov">          0 :       if (TMath::Abs(fitDTime[irow])&lt;kEpsilon) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4563 </span><span class="lineNoCov">          0 :       if (TMath::Abs(fitDPad[irow])&gt;kDistCutFitPad)  isOK[irow]=kFALSE;</span>
<span class="lineNum">    4564 </span><span class="lineNoCov">          0 :       if (TMath::Abs(fitDTime[irow])&gt;kDistCutFitTime) isOK[irow]=kFALSE;</span>
<span class="lineNum">    4565 </span>            :     }
<span class="lineNum">    4566 </span><span class="lineNoCov">          0 :     for (Int_t irow=kSmoothRow/2; irow&lt;kMaxRow-kSmoothRow/2; irow++){</span>
<span class="lineNum">    4567 </span><span class="lineNoCov">          0 :       fitPadLocal[irow]=0;</span>
<span class="lineNum">    4568 </span><span class="lineNoCov">          0 :       fitTimeLocal[irow]=0;</span>
<span class="lineNum">    4569 </span><span class="lineNoCov">          0 :       if (isOK[irow]&lt;0.5) continue;     </span>
<span class="lineNum">    4570 </span><span class="lineNoCov">          0 :       Int_t sector=(irow&lt;Int_t(roc-&gt;GetNRows(0)))? sectorInner:sectorOuter;</span>
<span class="lineNum">    4571 </span><span class="lineNoCov">          0 :       if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[irow]-sector)&gt;0.1) continue;</span>
<span class="lineNum">    4572 </span>            :       //
<span class="lineNum">    4573 </span><span class="lineNoCov">          0 :       TLinearFitter fitterPadLocal(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4574 </span><span class="lineNoCov">          0 :       TLinearFitter fitterTimeLocal(2,&quot;pol1&quot;);</span>
<span class="lineNum">    4575 </span><span class="lineNoCov">          0 :       Double_t xref=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[irow];</span>
<span class="lineNum">    4576 </span><span class="lineNoCov">          0 :       for (Int_t delta=-kSmoothRow; delta&lt;=kSmoothRow; delta++){</span>
<span class="lineNum">    4577 </span><span class="lineNoCov">          0 :         Int_t jrow=irow+delta;</span>
<span class="lineNum">    4578 </span><span class="lineNoCov">          0 :         if (jrow&lt;0) jrow=0;</span>
<span class="lineNum">    4579 </span><span class="lineNoCov">          0 :         if (jrow&gt;=kMaxRow) jrow=kMaxRow-1;   </span>
<span class="lineNum">    4580 </span><span class="lineNoCov">          0 :         if (isOK[jrow]&lt;0.5) continue;        </span>
<span class="lineNum">    4581 </span><span class="lineNoCov">          0 :         if (TMath::Abs(ltrp-&gt;GetVecSec()-&gt;GetMatrixArray()[jrow]-sector)&gt;0.1) continue;</span>
<span class="lineNum">    4582 </span><span class="lineNoCov">          0 :         Double_t y=(*vecPad)[jrow];</span>
<span class="lineNum">    4583 </span><span class="lineNoCov">          0 :         Double_t z=(*vecTime)[jrow];</span>
<span class="lineNum">    4584 </span><span class="lineNoCov">          0 :         Double_t x=ltrp-&gt;GetVecLX()-&gt;GetMatrixArray()[jrow]-xref;</span>
<span class="lineNum">    4585 </span><span class="lineNoCov">          0 :         fitterPadLocal.AddPoint(&amp;x,y);</span>
<span class="lineNum">    4586 </span><span class="lineNoCov">          0 :         fitterTimeLocal.AddPoint(&amp;x,z);</span>
<span class="lineNum">    4587 </span><span class="lineNoCov">          0 :       }      </span>
<span class="lineNum">    4588 </span><span class="lineNoCov">          0 :       if (fitterPadLocal.GetNpoints()&lt;kSmoothRow) continue;</span>
<span class="lineNum">    4589 </span><span class="lineNoCov">          0 :       fitterPadLocal.Eval();</span>
<span class="lineNum">    4590 </span><span class="lineNoCov">          0 :       fitterTimeLocal.Eval();</span>
<span class="lineNum">    4591 </span><span class="lineNoCov">          0 :       fitPadLocal[irow]=fitterPadLocal.GetParameter(0);</span>
<span class="lineNum">    4592 </span><span class="lineNoCov">          0 :       fitTimeLocal[irow]=fitterTimeLocal.GetParameter(0);</span>
<span class="lineNum">    4593 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    4594 </span>            :     //
<span class="lineNum">    4595 </span>            :     //
<span class="lineNum">    4596 </span><span class="lineNoCov">          0 :     (*pcstream)&lt;&lt;&quot;fit&quot;&lt;&lt;</span>
<span class="lineNum">    4597 </span><span class="lineNoCov">          0 :       &quot;run=&quot;&lt;&lt;run&lt;&lt;</span>
<span class="lineNum">    4598 </span><span class="lineNoCov">          0 :       &quot;id=&quot;&lt;&lt;id&lt;&lt;</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">          0 :       &quot;chi2PadIROC=&quot;&lt;&lt;chi2PadIROC&lt;&lt;</span>
<span class="lineNum">    4600 </span><span class="lineNoCov">          0 :       &quot;chi2PadOROC=&quot;&lt;&lt;chi2PadOROC&lt;&lt;</span>
<span class="lineNum">    4601 </span><span class="lineNoCov">          0 :       &quot;mdEdx=&quot;&lt;&lt;mdEdx&lt;&lt;</span>
<span class="lineNum">    4602 </span><span class="lineNoCov">          0 :       &quot;LTr.=&quot;&lt;&lt;ltrp&lt;&lt;</span>
<span class="lineNum">    4603 </span><span class="lineNoCov">          0 :       &quot;isOK.=&quot;&lt;&lt;&amp;isOK&lt;&lt;</span>
<span class="lineNum">    4604 </span>            :       // mean measured-ideal values
<span class="lineNum">    4605 </span><span class="lineNoCov">          0 :       &quot;mY.=&quot;&lt;&lt;vecMY&lt;&lt;</span>
<span class="lineNum">    4606 </span><span class="lineNoCov">          0 :       &quot;mZ.=&quot;&lt;&lt;vecMZ&lt;&lt;</span>
<span class="lineNum">    4607 </span>            :       // local coordinate fit
<span class="lineNum">    4608 </span><span class="lineNoCov">          0 :       &quot;mPad.=&quot;&lt;&lt;vecPad&lt;&lt;</span>
<span class="lineNum">    4609 </span><span class="lineNoCov">          0 :       &quot;mTime.=&quot;&lt;&lt;vecTime&lt;&lt;</span>
<span class="lineNum">    4610 </span><span class="lineNoCov">          0 :       &quot;fitPad.=&quot;&lt;&lt;&amp;fitPad&lt;&lt;</span>
<span class="lineNum">    4611 </span><span class="lineNoCov">          0 :       &quot;fitTime.=&quot;&lt;&lt;&amp;fitTime&lt;&lt;</span>
<span class="lineNum">    4612 </span><span class="lineNoCov">          0 :       &quot;fitPadLocal.=&quot;&lt;&lt;&amp;fitPadLocal&lt;&lt;</span>
<span class="lineNum">    4613 </span><span class="lineNoCov">          0 :       &quot;fitTimeLocal.=&quot;&lt;&lt;&amp;fitTimeLocal&lt;&lt;</span>
<span class="lineNum">    4614 </span><span class="lineNoCov">          0 :       &quot;fitDPad.=&quot;&lt;&lt;&amp;fitDPad&lt;&lt;</span>
<span class="lineNum">    4615 </span><span class="lineNoCov">          0 :       &quot;fitDTime.=&quot;&lt;&lt;&amp;fitDTime&lt;&lt;</span>
<span class="lineNum">    4616 </span><span class="lineNoCov">          0 :       &quot;fitIPad.=&quot;&lt;&lt;&amp;fitIPad&lt;&lt;</span>
<span class="lineNum">    4617 </span><span class="lineNoCov">          0 :       &quot;fitITime.=&quot;&lt;&lt;&amp;fitITime&lt;&lt;         </span>
<span class="lineNum">    4618 </span>            :       //
<span class="lineNum">    4619 </span><span class="lineNoCov">          0 :       &quot;fitPadIROC.=&quot;&lt;&lt;&amp;fitPadIROC&lt;&lt;           // pad fit linear IROC</span>
<span class="lineNum">    4620 </span><span class="lineNoCov">          0 :       &quot;fitPadIROCSin.=&quot;&lt;&lt;&amp;fitPadIROCSin&lt;&lt;     // pad fit linear+ pad correction</span>
<span class="lineNum">    4621 </span><span class="lineNoCov">          0 :       &quot;fitPadOROC.=&quot;&lt;&lt;&amp;fitPadOROC&lt;&lt;</span>
<span class="lineNum">    4622 </span><span class="lineNoCov">          0 :       &quot;fitPadOROCSin.=&quot;&lt;&lt;&amp;fitPadOROCSin&lt;&lt;</span>
<span class="lineNum">    4623 </span>            :       //
<span class="lineNum">    4624 </span><span class="lineNoCov">          0 :       &quot;fitTimeIROC.=&quot;&lt;&lt;&amp;fitTimeIROC&lt;&lt;</span>
<span class="lineNum">    4625 </span><span class="lineNoCov">          0 :       &quot;fitTimeIROCSin.=&quot;&lt;&lt;&amp;fitTimeIROCSin&lt;&lt;</span>
<span class="lineNum">    4626 </span><span class="lineNoCov">          0 :       &quot;fitTimeOROC.=&quot;&lt;&lt;&amp;fitTimeOROC&lt;&lt;</span>
<span class="lineNum">    4627 </span><span class="lineNoCov">          0 :       &quot;fitTimeOROCSin.=&quot;&lt;&lt;&amp;fitTimeOROCSin&lt;&lt;</span>
<span class="lineNum">    4628 </span>            :       &quot;\n&quot;;    
<span class="lineNum">    4629 </span><span class="lineNoCov">          0 :   }  </span>
<span class="lineNum">    4630 </span><span class="lineNoCov">          0 :   delete pcstream;</span>
<span class="lineNum">    4631 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
