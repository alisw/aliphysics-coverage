<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TPC/TPCrec/AliTPCCosmicTrackfit.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">TPC/TPCrec</a> - AliTPCCosmicTrackfit.cxx<span style="font-size: 80%;"> (source / <a href="AliTPCCosmicTrackfit.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">114</td>
            <td class="headerCovTableEntry">207</td>
            <td class="headerCovTableEntryLo">55.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">18</td>
            <td class="headerCovTableEntryLo">66.7 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : //
<span class="lineNum">      16 </span>            : //-------------------------------------------------------
<span class="lineNum">      17 </span>            : //          Implementation of the TPC cosmic trackfit
<span class="lineNum">      18 </span>            : //
<span class="lineNum">      19 </span>            : //   Origin:  Xianguo Lu lu@physi.uni-heidelberg.de  Xianguo.Lu@cern.ch
<span class="lineNum">      20 </span>            : //
<span class="lineNum">      21 </span>            : //=========================================================================================
<span class="lineNum">      22 </span>            : // Motivation:
<span class="lineNum">      23 </span>            : // 
<span class="lineNum">      24 </span>            : // In the default reconstruction in the ALICE the cosmic tracks are found  as two independent particles.
<span class="lineNum">      25 </span>            : //
<span class="lineNum">      26 </span>            : // In general any of  subtracks can be used for the physics studies. In order to avoid the double counting,
<span class="lineNum">      27 </span>            : // the track from the upper hemisphere can be used. 
<span class="lineNum">      28 </span>            : //
<span class="lineNum">      29 </span>            : // The momentum resolution is determined by the lever arm (1/L^2) and by the number of clusters
<span class="lineNum">      30 </span>            : // used for the track fitting (1/sqrt(Ncl)). 
<span class="lineNum">      31 </span>            : // Combining/refitting  the two segments together significantly better momentum resolution can be obtained.
<span class="lineNum">      32 </span>            : //    sigma_{1/pt} ~ 8x10^-3  - defaul tracking (e.g only upper track)
<span class="lineNum">      33 </span>            : //    sigma_{1/pt} ~ 8x10^-4  - combined tracking
<span class="lineNum">      34 </span>            : //===========================================================================================
<span class="lineNum">      35 </span>            : // 
<span class="lineNum">      36 </span>            : // Interface/Implementation:
<span class="lineNum">      37 </span>            : // This class provide the functionality to combine two ESD tracks and perform the trackfit using all related track points.
<span class="lineNum">      38 </span>            : // Input: AliESDtrack's (or AliTPCseed's, expert use)
<span class="lineNum">      39 </span>            : // Output: the trackparams from the combined fit are stored as data member of this class, and they can be accessed via getter or copy.
<span class="lineNum">      40 </span>            : //
<span class="lineNum">      41 </span>            : //===========================================================================================      
<span class="lineNum">      42 </span>            : //
<span class="lineNum">      43 </span>            : // Algorithm:
<span class="lineNum">      44 </span>            : // 1. Read in two ESDtracks (see function CombineESDtracks())
<span class="lineNum">      45 </span>            : //      TPCseeds are got from ESDfriends
<span class="lineNum">      46 </span>            : //      Cuts are applied on the following quantities: #TPC cluster, relation between global-y coordinate of the two tracks, lever arm.
<span class="lineNum">      47 </span>            : // 2. AliTPCCosmicUtils::CombinedFit is called and refit is performed using the TPCseeds from both tracks
<span class="lineNum">      48 </span>            : // 3. The fitting quality is analyzed and stored and can be accessed via function GetStatus(). The detailed judgement of the quality is recorded as &quot;enum CombineStatus&quot;
<span class="lineNum">      49 </span>            : //
<span class="lineNum">      50 </span>            : //
<span class="lineNum">      51 </span>            : //===========================================================================================
<span class="lineNum">      52 </span>            : // Algorithm numerical debugging:
<span class="lineNum">      53 </span>            : // The class can be used in the different debug/verbose level (see fDebugLevel) 
<span class="lineNum">      54 </span>            : // Several intermediate variables can be stored in the trees, printout, or draw.
<span class="lineNum">      55 </span>            : // Given functionality (dumping of variables to the tree) was also used for the tuning of the pair
<span class="lineNum">      56 </span>            : // selection criterias, and for validation of the fit functionality. 
<span class="lineNum">      57 </span>            : //
<span class="lineNum">      58 </span>            : // ----- Debug output:
<span class="lineNum">      59 </span>            : // for (debuglevel &amp; 1)==1 &amp;&amp; good fit, the following info saved:
<span class="lineNum">      60 </span>            : /*
<span class="lineNum">      61 </span>            :   (*fStreamer)&lt;&lt;&quot;TrackProp&quot;&lt;&lt;
<span class="lineNum">      62 </span>            :   &quot;Tup.=&quot;&lt;&lt;fTrackparUp&lt;&lt;          //AliExternalTrackParam at uppermost cluster obtained by upward propagation
<span class="lineNum">      63 </span>            :   &quot;Tlow.=&quot;&lt;&lt;fTrackparLow&lt;&lt;        //AliExternalTrackParam at lowermost cluster obtained by downward propagation
<span class="lineNum">      64 </span>            :   &quot;icup.=&quot;&lt;&lt;&amp;fInnerClusterUp&lt;&lt;    //TVector3 position of the innermost cluster of the upper track
<span class="lineNum">      65 </span>            :   &quot;iclow.=&quot;&lt;&lt;&amp;fInnerClusterLow&lt;&lt;
<span class="lineNum">      66 </span>            :   &quot;leverarm=&quot;&lt;&lt;fLeverArm&lt;&lt;
<span class="lineNum">      67 </span>            :   &quot;ncl=&quot;&lt;&lt;fFitNcls&lt;&lt;              //number of clusters used in successful propagation  
<span class="lineNum">      68 </span>            :   &quot;nmiss=&quot;&lt;&lt;fMissNcls&lt;&lt;           //number of clusters failed in propagation, should always be 0 in this case.
<span class="lineNum">      69 </span>            :   &quot;chi2=&quot;&lt;&lt;fPreChi2&lt;&lt;             //chi2/nfit  
<span class="lineNum">      70 </span>            :   &quot;momup=&quot;&lt;&lt;  momup &lt;&lt;            //momentum at uppermost cluster with upward propagation
<span class="lineNum">      71 </span>            :   &quot;momlow=&quot;&lt;&lt; momlow &lt;&lt;           //momentum at lowermost cluster with downward propagation
<span class="lineNum">      72 </span>            :   &quot;ptup=&quot;&lt;&lt;   ptup &lt;&lt;
<span class="lineNum">      73 </span>            :   &quot;ptlow=&quot;&lt;&lt;  ptlow &lt;&lt;
<span class="lineNum">      74 </span>            :       &quot;\n&quot;;
<span class="lineNum">      75 </span>            : */
<span class="lineNum">      76 </span>            : // for (debuglevel &amp; 2)==1, debug info in AliTPCCosmicUtils::FitKernel saved
<span class="lineNum">      77 </span>            : //
<span class="lineNum">      78 </span>            : //===========================================================================================
<span class="lineNum">      79 </span>            : // Usage
<span class="lineNum">      80 </span>            : /*
<span class="lineNum">      81 </span>            :   fCosmicTrackfit = new AliTPCCosmicTrackfit(debuglevel, &quot;anystring&quot;);
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span>            :   //order not important; will be internally ordered (potinters modified due to &amp;) such that track0 is the upper one
<span class="lineNum">      84 </span>            :   //kfit = kTRUE: good fit, kFALSE: bad fit
<span class="lineNum">      85 </span>            :   const Bool_t kfit = fCosmicTrackfit-&gt;CombineESDtracks(esdtrack0, esdtrack1);
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span>            :   //status = 0 for good fit (i.e. kfit=kTRUE), non-0 for bad fit (i.e. kfit=kFALSE), see &quot;enum CombineStatus&quot; definition in header file
<span class="lineNum">      88 </span>            :   const Int_t status = fCosmicTrackfit-&gt;GetStatus(); 
<span class="lineNum">      89 </span>            : */
<span class="lineNum">      90 </span>            : //===========================================================================================
<span class="lineNum">      91 </span>            : // Efficiency
<span class="lineNum">      92 </span>            : //
<span class="lineNum">      93 </span>            : // for 2011 Feb. cosmic data nch=2 events, the kfit and status look like:
<span class="lineNum">      94 </span>            : /*
<span class="lineNum">      95 </span>            : kfit,status (  0,   1):   16337 /  443901 =   3.680%          //kFailGetTPCseeds
<span class="lineNum">      96 </span>            : kfit,status (  0,   2):    3692 /  443901 =   0.832%          //not both tracks have ncl &gt; AliTPCCosmicUtils::NclsMin()
<span class="lineNum">      97 </span>            : kfit,status (  0,   3):    6527 /  443901 =   1.470%          //clusters in two tracks should be clearly separated in y, i.e. lowest cluster of upper track higher than highest cluster of lower track; otherwise fail 
<span class="lineNum">      98 </span>            : kfit,status (  0,   4):    7033 /  443901 =   1.584%          //fLeverArm&lt;CutLeverArm()
<span class="lineNum">      99 </span>            : kfit,status (  0,   6):    4398 /  443901 =   0.991%          //fail in propagation of at least one cluster
<span class="lineNum">     100 </span>            : kfit,status (  0,   7):     508 /  443901 =   0.114%          //chi2/nfit &gt; MaxChi2()
<span class="lineNum">     101 </span>            : kfit,status (  0,   8):      52 /  443901 =   0.012%          //fail in geting impact parameters
<span class="lineNum">     102 </span>            : kfit,status (  1,   0):  405354 /  443901 =  91.316%          //i.e. 91% of nch=2 events are successfully fitted.
<span class="lineNum">     103 </span>            : */
<span class="lineNum">     104 </span>            : //
<span class="lineNum">     105 </span>            : //===========================================================================================
<span class="lineNum">     106 </span>            : // Resolution
<span class="lineNum">     107 </span>            : //
<span class="lineNum">     108 </span>            : // for muon momentum small than 20 GeV, energy loss in muon filter is visable when compaing fTrackparUp and fTrackparLow; energy loss estimated as 5 MeV/cm.
<span class="lineNum">     109 </span>            : // particle traversing muon filter can be rejected by requiring &quot;fInnerClusterUp.fZ &gt; -40 &amp;&amp; fInnerClusterLow.fZ &gt; -40&quot;
<span class="lineNum">     110 </span>            : // momentum resolution is estimated by comparing the trackfit result by upward propagation through odd pad rows and that by downward propagation through even pad rows. Number of clusters used in this case is only half of that in normal usage.
<span class="lineNum">     111 </span>            : // RMS of log10 p = 0.01 at 10 GeV/c, 0.1 at 100 GeV/c, 0.5 at 1 TeV/c.
<span class="lineNum">     112 </span>            : // muon filter deteriorates momentum resolution by about +0.01 (absolute value).
<span class="lineNum">     113 </span>            : //
<span class="lineNum">     114 </span>            : 
<span class="lineNum">     115 </span>            : #include &lt;TAxis.h&gt;
<span class="lineNum">     116 </span>            : #include &lt;TCanvas.h&gt;
<span class="lineNum">     117 </span>            : #include &lt;TFile.h&gt;
<span class="lineNum">     118 </span>            : #include &lt;TGraph.h&gt;
<span class="lineNum">     119 </span>            : #include &lt;TTreeStream.h&gt;
<span class="lineNum">     120 </span>            : #include &lt;TVector3.h&gt;
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span>            : #include &quot;AliESDtrack.h&quot;
<span class="lineNum">     123 </span>            : #include &quot;AliESDfriendTrack.h&quot;
<span class="lineNum">     124 </span>            : #include &quot;AliTPCseed.h&quot;
<span class="lineNum">     125 </span>            : #include &quot;AliTrackerBase.h&quot;
<span class="lineNum">     126 </span>            : #include &quot;AliTrackPointArray.h&quot;
<span class="lineNum">     127 </span>            : 
<span class="lineNum">     128 </span>            : #include &quot;AliTPCCosmicUtils.h&quot;
<a name="129"><span class="lineNum">     129 </span>            : #include &quot;AliTPCCosmicTrackfit.h&quot;</a>
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span>            : AliTPCCosmicTrackfit::AliTPCCosmicTrackfit(const Int_t dlev, const TString tag):
<span class="lineNum">     132 </span><span class="lineCov">         16 :   fStreamer(0x0), fDebugLevel(dlev)</span>
<span class="lineNum">     133 </span><span class="lineCov">          8 :   , fSeedUp(0x0), fSeedLow(0x0), fTrackparUp(0x0), fTrackparLow(0x0), fIniTrackparUp(0x0), fIniTrackparLow(0x0)</span>
<span class="lineNum">     134 </span><span class="lineCov">          8 :   , fStatus(-999)</span>
<span class="lineNum">     135 </span><span class="lineCov">          8 :   , fKswap(0)</span>
<span class="lineNum">     136 </span><span class="lineCov">          8 :   , fInnerClusterUp(-999,-999,-999)</span>
<span class="lineNum">     137 </span><span class="lineCov">          8 :   , fInnerClusterLow(-999,-999,-999)</span>
<span class="lineNum">     138 </span><span class="lineCov">          8 :   , fLeverArm(-999)</span>
<span class="lineNum">     139 </span><span class="lineCov">          8 :   , fFitNcls(-999), fMissNcls(-999), fPreChi2(-999), fFitLeverArm(-999), fImpactD(-999), fImpactZ(-999)</span>
<span class="lineNum">     140 </span><span class="lineCov">          8 :   , fRowStartShift(-999)</span>
<span class="lineNum">     141 </span><span class="lineCov">          8 :   , fRowStep(-999)</span>
<span class="lineNum">     142 </span><span class="lineCov">          8 :   , fXMin(-999)</span>
<span class="lineNum">     143 </span><span class="lineCov">          8 :   , fXMax(-999)</span>
<span class="lineNum">     144 </span><span class="lineCov">         16 : {</span>
<span class="lineNum">     145 </span>            :   //
<span class="lineNum">     146 </span>            :   //Constructor
<span class="lineNum">     147 </span>            :   //
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span><span class="lineCov">          8 :   if(fDebugLevel&gt;0)</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     fStreamer = new TTreeSRedirector(Form(&quot;CosmicTrackfit_%s.root&quot;, tag.Data()));</span>
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span><span class="lineCov">          8 :   SetRow(0,1);</span>
<span class="lineNum">     153 </span><span class="lineCov">          8 :   SetX(-1e10, 1e10);</span>
<a name="154"><span class="lineNum">     154 </span><span class="lineCov">         16 : }</span></a>
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span>            : AliTPCCosmicTrackfit::~AliTPCCosmicTrackfit()
<span class="lineNum">     157 </span><span class="lineCov">         16 : {</span>
<span class="lineNum">     158 </span>            :   //
<span class="lineNum">     159 </span>            :   //Destructor
<span class="lineNum">     160 </span>            :   //
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span><span class="lineCov">         16 :   delete fStreamer;</span>
<span class="lineNum">     163 </span>            :   
<span class="lineNum">     164 </span><span class="lineCov">          9 :   delete fTrackparUp;</span>
<span class="lineNum">     165 </span><span class="lineCov">          9 :   delete fTrackparLow;</span>
<span class="lineNum">     166 </span><span class="lineCov">          9 :   delete fIniTrackparUp;</span>
<span class="lineNum">     167 </span><span class="lineCov">          9 :   delete fIniTrackparLow;</span>
<a name="168"><span class="lineNum">     168 </span><span class="lineCov">         16 : }</span></a>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span>            : Bool_t AliTPCCosmicTrackfit::CombineESDtracks(AliESDtrack * &amp;trk0, AliESDtrack *&amp;trk1)
<span class="lineNum">     171 </span>            : {
<span class="lineNum">     172 </span>            :   //
<span class="lineNum">     173 </span>            :   //Get TPCseeds from the 2 ESDtracks, swap TPCseeds and ESDTracks (if necessary) according to y (0:upper 1:lower), perform trackfit using TPCseeds
<span class="lineNum">     174 </span>            :   //if fStatus==0, i.e. combine is successful, swap of the ESDtracks is kept since pointer *&amp; is used
<span class="lineNum">     175 </span>            :   //
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span><span class="lineCov">          6 :   IniCombineESDtracks();</span>
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span><span class="lineCov">          3 :   if(!GetTPCseeds(trk0, trk1)){</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     return kFALSE; </span>
<span class="lineNum">     181 </span>            :   }
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span><span class="lineCov">          3 :   CombineTPCseeds();</span>
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span><span class="lineCov">          3 :   if(fStatus == 0){</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :     if(fKswap){</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :       AliESDtrack * tmptrk = trk0;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :       trk0 = trk1;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :       trk1 = tmptrk;</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     192 </span>            :   }
<span class="lineNum">     193 </span>            :   else
<span class="lineNum">     194 </span><span class="lineCov">          3 :     return kFALSE;</span>
<a name="195"><span class="lineNum">     195 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            : Bool_t AliTPCCosmicTrackfit::CombineTPCseedsFast(AliTPCseed * tpcseeds[], const AliExternalTrackParam * trkpars[])
<span class="lineNum">     198 </span>            : {
<span class="lineNum">     199 </span>            :   //
<span class="lineNum">     200 </span>            :   //do combined track fit for given TPC seeds and initial trackpar, [0]: upper, [1]: lower
<span class="lineNum">     201 </span>            :   //
<span class="lineNum">     202 </span>            : 
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   IniCombineESDtracks();</span>
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   fSeedUp = tpcseeds[0];</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :   fSeedLow = tpcseeds[1];</span>
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :   fTrackparUp =  new AliExternalTrackParam(*(trkpars[0]));</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :   fTrackparLow = new AliExternalTrackParam(*(trkpars[1]));</span>
<span class="lineNum">     210 </span>            : 
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :   AliExternalTrackParam * trackPars[]={fTrackparUp, fTrackparLow};</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :   const AliTPCseed *seeds[]={fSeedUp, fSeedLow};</span>
<span class="lineNum">     213 </span>            :   TTreeSRedirector * debugstreamer = 0x0;
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :   if(fDebugLevel&amp;2){</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :     debugstreamer = fStreamer;</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     217 </span>            : 
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :   AliTPCCosmicUtils::CombinedFit(trackPars, seeds, fRowStartShift, fRowStep, fXMin, fXMax, fFitNcls, fMissNcls, fPreChi2, fFitLeverArm, fImpactD, fImpactZ, debugstreamer);</span>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   Update();</span>
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :   if(fStatus == 0){</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     224 </span>            :   }
<span class="lineNum">     225 </span>            :   else
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<a name="227"><span class="lineNum">     227 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span>            : Bool_t AliTPCCosmicTrackfit::CombineTPCseeds(AliTPCseed * &amp;seed0, AliTPCseed *&amp;seed1)
<span class="lineNum">     230 </span>            : {
<span class="lineNum">     231 </span>            :   //
<span class="lineNum">     232 </span>            :   //same as AliTPCCosmicTrackfit::CombineESDtracks, except that the seeds are passed in from outside, which can be still unordered
<span class="lineNum">     233 </span>            :   //if fStatus==0, i.e. combine is successful, swap of the TPCseeds is kept since pointer *&amp; is used
<span class="lineNum">     234 </span>            :   //
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :   IniCombineESDtracks();</span>
<span class="lineNum">     236 </span>            : 
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :   fSeedUp  = seed0;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :   fSeedLow = seed1;</span>
<span class="lineNum">     239 </span>            :   
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :   CombineTPCseeds();</span>
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :   if(fStatus==0){</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     if(fKswap){</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :       AliTPCseed * tmpseed = seed0;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :       seed0 = seed1;</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :       seed1 = tmpseed;</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">     249 </span>            :   }
<span class="lineNum">     250 </span>            :   else 
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<a name="252"><span class="lineNum">     252 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span>            : void AliTPCCosmicTrackfit::Print() const
<span class="lineNum">     255 </span>            : {
<span class="lineNum">     256 </span>            :   //
<span class="lineNum">     257 </span>            :   //print out variable values
<span class="lineNum">     258 </span>            :   //
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :   printf(&quot;Status %2d NclsU %3d NclsD %3d ZinnerU %7.2f ZinnerD %7.2f LeverArm %7.2f\n&quot;, fStatus, fSeedUp-&gt;GetNumberOfClusters(), fSeedLow-&gt;GetNumberOfClusters(), fInnerClusterUp.Z(), fInnerClusterLow.Z(), fLeverArm);</span>
<a name="260"><span class="lineNum">     260 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span>            : TVector3 AliTPCCosmicTrackfit::ImpactParameter2D() const
<span class="lineNum">     263 </span>            : {
<span class="lineNum">     264 </span>            :   //
<span class="lineNum">     265 </span>            :   //calculate the 2D-impactparameter from (0,0)
<span class="lineNum">     266 </span>            :   //
<span class="lineNum">     267 </span>            : 
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :   const TVector3 p0(0,0,0);</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :   const TVector3 l1(fInnerClusterUp.X(),  fInnerClusterUp.Y(),  0);</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   const TVector3 l2(fInnerClusterLow.X(), fInnerClusterLow.Y(), 0);</span>
<span class="lineNum">     271 </span>            : 
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   TVector3 vtx;</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   AliTPCCosmicUtils::Point2LineDist(p0, l1, l2, &amp;vtx);</span>
<span class="lineNum">     274 </span>            :   return vtx;
<a name="275"><span class="lineNum">     275 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     276 </span>            : 
<span class="lineNum">     277 </span>            : TVector3 AliTPCCosmicTrackfit::ImpactParameter3D() const
<span class="lineNum">     278 </span>            : {
<span class="lineNum">     279 </span>            :   //
<span class="lineNum">     280 </span>            :   //calculate the 3D-impactparameter from (0,0,0)
<span class="lineNum">     281 </span>            :   //
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   const TVector3 p0(0,0,0);</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   const TVector3 l1(fInnerClusterUp);</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   const TVector3 l2(fInnerClusterLow);</span>
<span class="lineNum">     286 </span>            : 
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   TVector3 vtx;</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   AliTPCCosmicUtils::Point2LineDist(p0, l1, l2, &amp;vtx);</span>
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            :   //==========================
<span class="lineNum">     291 </span>            :   /*
<span class="lineNum">     292 </span>            :   printf(&quot;testing... \n&quot;);
<span class="lineNum">     293 </span>            :   TVector3 tmpv = ImpactParameter2D();
<span class="lineNum">     294 </span>            :   if(fabs(tmpv.Mag()-vtx.Pt())&gt;1e-6){
<span class="lineNum">     295 </span>            :     printf(&quot;strange!!! %e %e %e\n&quot;, tmpv.Mag(), vtx.Pt(), fabs(tmpv.Mag()-vtx.Pt()));
<span class="lineNum">     296 </span>            :     vtx.Print();
<span class="lineNum">     297 </span>            :     tmpv.Print();
<span class="lineNum">     298 </span>            :     fInnerClusterUp.Print();
<span class="lineNum">     299 </span>            :     fInnerClusterLow.Print();
<span class="lineNum">     300 </span>            :   }
<span class="lineNum">     301 </span>            :   */
<span class="lineNum">     302 </span>            :   //==========================
<span class="lineNum">     303 </span>            :   return vtx;
<a name="304"><span class="lineNum">     304 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span>            : Double_t AliTPCCosmicTrackfit::MinPhi() const
<span class="lineNum">     307 </span>            : {
<span class="lineNum">     308 </span>            :   //
<span class="lineNum">     309 </span>            :   //the smaller phi of the two tracks w.r.t. horizon
<span class="lineNum">     310 </span>            :   //
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :   Double_t fsp[] = {TMath::Abs(TMath::Sin(fTrackparUp-&gt;Phi())), TMath::Abs(TMath::Sin(fTrackparLow-&gt;Phi()))};;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :   return TMath::ASin(TMath::Min(fsp[0], fsp[1])) * TMath::RadToDeg();</span>
<span class="lineNum">     313 </span>            : }
<span class="lineNum">     314 </span>            : //===================================================================================================
<a name="315"><span class="lineNum">     315 </span>            : //===================================================================================================</a>
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span>            : void AliTPCCosmicTrackfit::IniCombineESDtracks()
<span class="lineNum">     318 </span>            : {
<span class="lineNum">     319 </span>            :   //
<span class="lineNum">     320 </span>            :   //initialization, for reuse of the same AliTPCCosmicTrackfit instance
<span class="lineNum">     321 </span>            :   //
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span><span class="lineCov">          6 :   fSeedUp = 0x0;</span>
<span class="lineNum">     324 </span><span class="lineCov">          3 :   fSeedLow = 0x0;</span>
<span class="lineNum">     325 </span><span class="lineCov">          4 :   delete fTrackparUp;</span>
<span class="lineNum">     326 </span><span class="lineCov">          4 :   delete fTrackparLow;</span>
<span class="lineNum">     327 </span><span class="lineCov">          3 :   fTrackparUp = 0x0;</span>
<span class="lineNum">     328 </span><span class="lineCov">          3 :   fTrackparLow = 0x0;</span>
<span class="lineNum">     329 </span>            : 
<span class="lineNum">     330 </span><span class="lineCov">          4 :   delete fIniTrackparUp;</span>
<span class="lineNum">     331 </span><span class="lineCov">          4 :   delete fIniTrackparLow;</span>
<span class="lineNum">     332 </span><span class="lineCov">          3 :   fIniTrackparUp = 0x0;</span>
<span class="lineNum">     333 </span><span class="lineCov">          3 :   fIniTrackparLow = 0x0;</span>
<span class="lineNum">     334 </span>            : 
<span class="lineNum">     335 </span><span class="lineCov">          3 :   fStatus = 0;</span>
<span class="lineNum">     336 </span><span class="lineCov">          3 :   fKswap = kFALSE;</span>
<a name="337"><span class="lineNum">     337 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     338 </span>            : 
<span class="lineNum">     339 </span>            : void AliTPCCosmicTrackfit::CombineTPCseeds()
<span class="lineNum">     340 </span>            : {
<span class="lineNum">     341 </span>            :   //
<span class="lineNum">     342 </span>            :   //do combined trackfit using TPCseeds
<span class="lineNum">     343 </span>            :   //
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span>            :   if(
<span class="lineNum">     346 </span><span class="lineCov">          9 :      !CheckNcls()</span>
<span class="lineNum">     347 </span><span class="lineCov">          6 :      || !AnaSeeds() // fSeedUp/Low swapped here! check by runTest.C </span>
<span class="lineNum">     348 </span><span class="lineCov">          6 :      || !CheckLeverArm()</span>
<span class="lineNum">     349 </span>            :      )
<span class="lineNum">     350 </span>            :     return;
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span>            :   //AliExternalTrackParam object created
<span class="lineNum">     353 </span><span class="lineCov">          2 :   fTrackparUp  = AliTPCCosmicUtils::MakeSeed(fSeedUp);</span>
<span class="lineNum">     354 </span><span class="lineCov">          2 :   fTrackparLow = AliTPCCosmicUtils::MakeSeed(fSeedLow);</span>
<span class="lineNum">     355 </span><span class="lineCov">          4 :   if(!fTrackparUp || !fTrackparLow){</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     fStatus = kFailMakeSeed;</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     358 </span>            :   }
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span><span class="lineCov">          4 :   fIniTrackparUp = new AliExternalTrackParam(*fTrackparUp);</span>
<span class="lineNum">     361 </span><span class="lineCov">          4 :   fIniTrackparLow = new AliExternalTrackParam(*fTrackparLow);</span>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span><span class="lineCov">          2 :   AliExternalTrackParam * trackPars[]={fTrackparUp, fTrackparLow};</span>
<span class="lineNum">     364 </span><span class="lineCov">          2 :   const AliTPCseed *seeds[]={fSeedUp, fSeedLow};</span>
<span class="lineNum">     365 </span>            :   TTreeSRedirector * debugstreamer = 0x0;
<span class="lineNum">     366 </span><span class="lineCov">          2 :   if(fDebugLevel&amp;2){</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :     debugstreamer = fStreamer;</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span><span class="lineCov">          2 :   AliTPCCosmicUtils::CombinedFit(trackPars, seeds, fRowStartShift, fRowStep, fXMin, fXMax, fFitNcls, fMissNcls, fPreChi2, fFitLeverArm, fImpactD, fImpactZ, debugstreamer);</span>
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span><span class="lineCov">          2 :   Update();</span>
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span>            :   return;
<a name="375"><span class="lineNum">     375 </span><span class="lineCov">          5 : }</span></a>
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span>            : void AliTPCCosmicTrackfit::Update()
<span class="lineNum">     378 </span>            : {
<span class="lineNum">     379 </span>            :   //
<span class="lineNum">     380 </span>            :   //Update variables depending on the fit result
<span class="lineNum">     381 </span>            :   //
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span><span class="lineCov">          6 :   if(fMissNcls || fFitNcls==0){</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     fStatus = kFailPropagation;</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     386 </span>            :   }
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span><span class="lineCov">          2 :   fPreChi2 /= fFitNcls;</span>
<span class="lineNum">     389 </span><span class="lineCov">          2 :   if(fPreChi2&gt;MaxChi2()){</span>
<span class="lineNum">     390 </span><span class="lineCov">          2 :     fStatus = kFailChi2;</span>
<span class="lineNum">     391 </span><span class="lineCov">          2 :     return;</span>
<span class="lineNum">     392 </span>            :   }
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   if(fImpactD&lt;0){</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :     fStatus = kFailImpact;</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     397 </span>            :   }
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   if( fStatus == 0 &amp;&amp; (fDebugLevel&amp;1) ){</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :     Double_t momup  = fTrackparUp-&gt;P();</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :     Double_t momlow = fTrackparLow-&gt;P();</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :     Double_t ptup   = fTrackparUp-&gt;Pt();</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :     Double_t ptlow  = fTrackparLow-&gt;Pt();</span>
<span class="lineNum">     404 </span>            : 
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     (*fStreamer)&lt;&lt;&quot;TrackProp&quot;&lt;&lt;</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :       &quot;Tup.=&quot;&lt;&lt;fTrackparUp&lt;&lt;</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :       &quot;Tlow.=&quot;&lt;&lt;fTrackparLow&lt;&lt;</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :       &quot;icup.=&quot;&lt;&lt;&amp;fInnerClusterUp&lt;&lt;</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :       &quot;iclow.=&quot;&lt;&lt;&amp;fInnerClusterLow&lt;&lt;</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :       &quot;leverarm=&quot;&lt;&lt;fLeverArm&lt;&lt;</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :       &quot;ncl=&quot;&lt;&lt;fFitNcls&lt;&lt;</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :       &quot;nmiss=&quot;&lt;&lt;fMissNcls&lt;&lt;</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :       &quot;chi2=&quot;&lt;&lt;fPreChi2&lt;&lt;</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :       &quot;momup=&quot;&lt;&lt;  momup &lt;&lt;</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :       &quot;momlow=&quot;&lt;&lt; momlow &lt;&lt;</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :       &quot;ptup=&quot;&lt;&lt;   ptup &lt;&lt;</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :       &quot;ptlow=&quot;&lt;&lt;  ptlow &lt;&lt;</span>
<span class="lineNum">     418 </span>            :       &quot;\n&quot;;
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :   }</span>
<a name="420"><span class="lineNum">     420 </span><span class="lineCov">          2 : }</span></a>
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span>            : Bool_t AliTPCCosmicTrackfit::CheckLeverArm()
<span class="lineNum">     423 </span>            : {
<span class="lineNum">     424 </span>            :   //
<span class="lineNum">     425 </span>            :   //if lever arm is too short, no need to use combined track fit. 
<span class="lineNum">     426 </span>            :   //On the other hand, short lever arm from two tracks mostly means they are fake pairs.
<span class="lineNum">     427 </span>            :   //lever arm extents over one quadrant, e.g. (0,250)-(250,0): 250*sqrt(2)~350
<span class="lineNum">     428 </span>            :   //
<span class="lineNum">     429 </span><span class="lineCov">          6 :   if(fLeverArm&lt;CutLeverArm()){</span>
<span class="lineNum">     430 </span><span class="lineCov">          1 :     fStatus = kFailLeverArm;</span>
<span class="lineNum">     431 </span><span class="lineCov">          1 :     return kFALSE;</span>
<span class="lineNum">     432 </span>            :   }
<span class="lineNum">     433 </span>            :   else 
<span class="lineNum">     434 </span><span class="lineCov">          2 :     return kTRUE;</span>
<a name="435"><span class="lineNum">     435 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span>            : Bool_t AliTPCCosmicTrackfit::AnaSeeds()
<span class="lineNum">     438 </span>            : {
<span class="lineNum">     439 </span>            :   //
<span class="lineNum">     440 </span>            :   //swap seeds (if necessary) so that (y of fSeedUp) &gt; (y of fSeedLow)
<span class="lineNum">     441 </span>            :   //
<span class="lineNum">     442 </span>            : 
<span class="lineNum">     443 </span>            :   //---------------------------------- navigate through all clusters ----------------------------------
<span class="lineNum">     444 </span><span class="lineCov">          6 :   AliTPCseed ** seeds[]={&amp;fSeedUp, &amp;fSeedLow};</span>
<span class="lineNum">     445 </span>            : 
<span class="lineNum">     446 </span>            :   //min, max according to y
<span class="lineNum">     447 </span><span class="lineCov">         30 :   TVector3 singlemin[2], singlemax[2];</span>
<span class="lineNum">     448 </span><span class="lineCov">         18 :   for(Int_t ii=0; ii&lt;2; ii++){</span>
<span class="lineNum">     449 </span><span class="lineCov">          6 :     singlemin[ii].SetXYZ( 1e10,  1e10,  1e10);</span>
<span class="lineNum">     450 </span><span class="lineCov">          6 :     singlemax[ii].SetXYZ(-1e10, -1e10, -1e10);</span>
<span class="lineNum">     451 </span>            :   }
<span class="lineNum">     452 </span>            :   
<span class="lineNum">     453 </span><span class="lineCov">         18 :   for(Int_t itrk=0; itrk&lt;2; itrk++){</span>
<span class="lineNum">     454 </span><span class="lineCov">       1920 :     for(Int_t irow=0; irow&lt;AliTPCCosmicUtils::NRow(); irow++){</span>
<span class="lineNum">     455 </span><span class="lineCov">        954 :       const AliTPCclusterMI * cls = (*seeds[itrk])-&gt;GetClusterPointer(irow);</span>
<span class="lineNum">     456 </span><span class="lineCov">        954 :       if(!cls)</span>
<span class="lineNum">     457 </span><span class="lineCov">         83 :         continue;</span>
<span class="lineNum">     458 </span>            :       
<span class="lineNum">     459 </span><span class="lineCov">        871 :       Float_t xyz[3]={-999,-999,-999};</span>
<span class="lineNum">     460 </span><span class="lineCov">        871 :       cls-&gt;GetGlobalXYZ(xyz);</span>
<span class="lineNum">     461 </span><span class="lineCov">        871 :       if(xyz[1]&lt;singlemin[itrk].Y()){</span>
<span class="lineNum">     462 </span><span class="lineCov">        456 :         singlemin[itrk].SetXYZ(xyz[0], xyz[1], xyz[2]);</span>
<span class="lineNum">     463 </span><span class="lineCov">        456 :       }</span>
<span class="lineNum">     464 </span><span class="lineCov">        871 :       if(xyz[1]&gt;singlemax[itrk].Y()){</span>
<span class="lineNum">     465 </span><span class="lineCov">        405 :         singlemax[itrk].SetXYZ(xyz[0], xyz[1], xyz[2]);</span>
<span class="lineNum">     466 </span><span class="lineCov">        405 :       }</span>
<span class="lineNum">     467 </span><span class="lineCov">        871 :     }</span>
<span class="lineNum">     468 </span>            :   }
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span>            :   //--------------------------------
<span class="lineNum">     471 </span>            : 
<span class="lineNum">     472 </span>            :   //kpass true if y of the two seeds clearly separate: min of one &gt; max of the other
<span class="lineNum">     473 </span>            :   Bool_t kpass = kFALSE;
<span class="lineNum">     474 </span>            : 
<span class="lineNum">     475 </span><span class="lineCov">          3 :   fInnerClusterUp.SetXYZ(-999,-999,-999);</span>
<span class="lineNum">     476 </span><span class="lineCov">          3 :   fInnerClusterLow.SetXYZ(-999,-999,-999);</span>
<span class="lineNum">     477 </span><span class="lineCov">          6 :   TVector3 combinedmin, combinedmax;</span>
<span class="lineNum">     478 </span><span class="lineCov">          3 :   if(singlemin[0].Y()&gt; singlemax[1].Y()){</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :     fInnerClusterUp  = singlemin[0];</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :     fInnerClusterLow = singlemax[1];</span>
<span class="lineNum">     481 </span>            : 
<span class="lineNum">     482 </span>            :     //no need to swap
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :     fKswap = kFALSE;</span>
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span>            :     kpass = kTRUE;
<span class="lineNum">     486 </span>            : 
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :     combinedmax = singlemax[0];</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :     combinedmin = singlemin[1];</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     490 </span><span class="lineCov">          3 :   else if(singlemin[1].Y()&gt; singlemax[0].Y()){</span>
<span class="lineNum">     491 </span><span class="lineCov">          3 :     fInnerClusterUp  = singlemin[1];</span>
<span class="lineNum">     492 </span><span class="lineCov">          3 :     fInnerClusterLow = singlemax[0];</span>
<span class="lineNum">     493 </span>            :   
<span class="lineNum">     494 </span>            :     //have to be swapped
<span class="lineNum">     495 </span><span class="lineCov">          3 :     fKswap = kTRUE;</span>
<span class="lineNum">     496 </span><span class="lineCov">          3 :     AliTPCseed *tmp=*(seeds[0]);</span>
<span class="lineNum">     497 </span><span class="lineCov">          3 :     *(seeds[0])=*(seeds[1]);</span>
<span class="lineNum">     498 </span><span class="lineCov">          3 :     *(seeds[1])=tmp;</span>
<span class="lineNum">     499 </span>            :     
<span class="lineNum">     500 </span>            :     kpass = kTRUE;
<span class="lineNum">     501 </span>            : 
<span class="lineNum">     502 </span><span class="lineCov">          3 :     combinedmax = singlemax[1];</span>
<span class="lineNum">     503 </span><span class="lineCov">          3 :     combinedmin = singlemin[0];</span>
<span class="lineNum">     504 </span><span class="lineCov">          3 :   }           </span>
<span class="lineNum">     505 </span>            :   else
<span class="lineNum">     506 </span>            :     kpass = kFALSE;
<span class="lineNum">     507 </span>            : 
<span class="lineNum">     508 </span><span class="lineCov">          3 :   const TVector3 comdelta = combinedmax-combinedmin;</span>
<span class="lineNum">     509 </span><span class="lineCov">          6 :   fLeverArm = comdelta.Pt();</span>
<span class="lineNum">     510 </span>            : 
<span class="lineNum">     511 </span><span class="lineCov">          3 :   if(!kpass){</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :     fStatus = kFailSwapSeeds;</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<span class="lineNum">     514 </span>            :   }
<span class="lineNum">     515 </span>            :   else
<span class="lineNum">     516 </span><span class="lineCov">          3 :     return kTRUE;</span>
<a name="517"><span class="lineNum">     517 </span><span class="lineCov">         21 : }</span></a>
<span class="lineNum">     518 </span>            : 
<span class="lineNum">     519 </span>            : Bool_t AliTPCCosmicTrackfit::CheckNcls()
<span class="lineNum">     520 </span>            : {
<span class="lineNum">     521 </span>            :   //
<span class="lineNum">     522 </span>            :   //check number of clusters in TPCseed, for too small number MakeSeed will fail
<span class="lineNum">     523 </span>            :   //
<span class="lineNum">     524 </span><span class="lineCov">          9 :   if( fSeedUp-&gt;GetNumberOfClusters()&lt;AliTPCCosmicUtils::NclsMin() || fSeedLow-&gt;GetNumberOfClusters()&lt;AliTPCCosmicUtils::NclsMin() ){</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :     fStatus = kFailNclsMin;</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<span class="lineNum">     527 </span>            :   }
<span class="lineNum">     528 </span>            :   else
<span class="lineNum">     529 </span><span class="lineCov">          3 :     return kTRUE;</span>
<a name="530"><span class="lineNum">     530 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     531 </span>            : 
<span class="lineNum">     532 </span>            : Bool_t AliTPCCosmicTrackfit::GetTPCseeds(const AliESDtrack *trk0,  const AliESDtrack *trk1)
<span class="lineNum">     533 </span>            : {
<span class="lineNum">     534 </span>            :   //
<span class="lineNum">     535 </span>            :   //Get TPC seeds from ESDfriendTrack
<span class="lineNum">     536 </span>            :   //
<span class="lineNum">     537 </span><span class="lineCov">          6 :   fSeedUp  = AliTPCCosmicUtils::GetTPCseed(trk0);</span>
<span class="lineNum">     538 </span><span class="lineCov">          3 :   fSeedLow = AliTPCCosmicUtils::GetTPCseed(trk1);</span>
<span class="lineNum">     539 </span>            : 
<span class="lineNum">     540 </span><span class="lineCov">          6 :   if(!fSeedUp || !fSeedLow){</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     fStatus = kFailGetTPCseeds;</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :     return kFALSE;</span>
<span class="lineNum">     543 </span>            :   }
<span class="lineNum">     544 </span>            : 
<span class="lineNum">     545 </span><span class="lineCov">          3 :   return kTRUE;</span>
<span class="lineNum">     546 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     547 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
