<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HLT/BASE/util/AliHLTGlobalBarrelTrack.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">HLT/BASE/util</a> - AliHLTGlobalBarrelTrack.cxx<span style="font-size: 80%;"> (source / <a href="AliHLTGlobalBarrelTrack.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">315</td>
            <td class="headerCovTableEntryLo">0.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">29</td>
            <td class="headerCovTableEntryLo">3.4 %</td>
          </tr>
          <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // $Id$</a>
<span class="lineNum">       2 </span>            : 
<span class="lineNum">       3 </span>            : //**************************************************************************
<span class="lineNum">       4 </span>            : //* This file is property of and copyright by the                          * 
<span class="lineNum">       5 </span>            : //* ALICE Experiment at CERN, All rights reserved.                         *
<span class="lineNum">       6 </span>            : //*                                                                        *
<span class="lineNum">       7 </span>            : //* Primary Authors: Matthias Richter &lt;Matthias.Richter@ift.uib.no&gt;        *
<span class="lineNum">       8 </span>            : //*                  for The ALICE HLT Project.                            *
<span class="lineNum">       9 </span>            : //*                                                                        *
<span class="lineNum">      10 </span>            : //* Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">      11 </span>            : //* documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">      12 </span>            : //* without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      13 </span>            : //* copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      14 </span>            : //* appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      15 </span>            : //* about the suitability of this software for any purpose. It is          *
<span class="lineNum">      16 </span>            : //* provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      17 </span>            : //**************************************************************************
<span class="lineNum">      18 </span>            : 
<span class="lineNum">      19 </span>            : /// @file   AliHLTGlobalBarrelTrack.cxx
<span class="lineNum">      20 </span>            : /// @author Matthias Richter
<span class="lineNum">      21 </span>            : /// @date   2009-06-24
<span class="lineNum">      22 </span>            : /// @brief  An AliKalmanTrack implementation for global HLT barrel tracks.
<span class="lineNum">      23 </span>            : ///
<span class="lineNum">      24 </span>            : 
<span class="lineNum">      25 </span>            : #include &lt;cassert&gt;
<span class="lineNum">      26 </span>            : #include &lt;memory&gt;
<span class="lineNum">      27 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      28 </span>            : #include &quot;AliHLTGlobalBarrelTrack.h&quot;
<span class="lineNum">      29 </span>            : #include &quot;AliHLTSpacePointContainer.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;AliHLTTrackGeometry.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;AliHLTMisc.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;TClonesArray.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;TFile.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;TArrayC.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;TMath.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;TMarker.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;TArc.h&quot;
<span class="lineNum">      38 </span>            : 
<span class="lineNum">      39 </span>            : using namespace std;
<a name="40"><span class="lineNum">      40 </span>            : </a>
<span class="lineNum">      41 </span>            : /** ROOT macro for the implementation of ROOT specific class methods */
<a name="42"><span class="lineNum">      42 </span><span class="lineCov">          8 : ClassImp(AliHLTGlobalBarrelTrack)</span></a>
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : AliHLTGlobalBarrelTrack::AliHLTGlobalBarrelTrack()
<span class="lineNum">      45 </span><span class="lineNoCov">          0 :   : AliKalmanTrack()</span>
<span class="lineNum">      46 </span><span class="lineNoCov">          0 :   , fPoints()</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :   , fLastX(0.0)</span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 :   , fLastY(0.0)</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :   , fTrackID(-1)</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 :   , fHelixRadius(0.0)</span>
<span class="lineNum">      51 </span><span class="lineNoCov">          0 :   , fHelixCenterX(0.0)</span>
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :   , fHelixCenterY(0.0)</span>
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :   , fSpacePoints(NULL)</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :   , fTrackPoints(NULL)</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      56 </span>            :   //  constructor
<span class="lineNum">      57 </span>            :   //
<span class="lineNum">      58 </span>            :   //  An AliKalmanTrack implementation for global HLT barrel tracks.
<span class="lineNum">      59 </span>            :   //
<span class="lineNum">      60 </span>            :   //
<a name="61"><span class="lineNum">      61 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            : AliHLTGlobalBarrelTrack::AliHLTGlobalBarrelTrack(const AliHLTGlobalBarrelTrack&amp; t)
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   : AliKalmanTrack(t)</span>
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   , fPoints()</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :   , fLastX(t.GetLastPointX())</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   , fLastY(t.GetLastPointY())</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   , fTrackID(t.TrackID())</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   , fHelixRadius(t.fHelixRadius)</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   , fHelixCenterX(t.fHelixCenterX)</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :   , fHelixCenterY(t.fHelixCenterY)</span>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   , fSpacePoints(NULL)</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   , fTrackPoints(NULL)</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      75 </span>            :   // copy constructor
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   fPoints.assign(t.fPoints.begin(), t.fPoints.end());</span>
<a name="77"><span class="lineNum">      77 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : AliHLTGlobalBarrelTrack::AliHLTGlobalBarrelTrack(const AliHLTExternalTrackParam&amp; p )
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :   : AliKalmanTrack()</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   , fPoints()</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   , fLastX(p.fLastX)</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :   , fLastY(p.fLastY)</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :   , fTrackID(p.fTrackID)</span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :   , fHelixRadius(0.0)</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :   , fHelixCenterX(0.0)</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :   , fHelixCenterY(0.0)</span>
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :   , fSpacePoints(NULL)</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :   , fTrackPoints(NULL)</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      91 </span>            :   // constructor from AliHLTExternalTrackParam
<span class="lineNum">      92 </span>            : 
<span class="lineNum">      93 </span>            :   // the 5 track parameters are named in the AliHLTExternalTrackParam
<span class="lineNum">      94 </span>            :   // while AliExternalTrackParam just uses an array[5]
<span class="lineNum">      95 </span>            :   // the members have the same order, fY is the first one
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   Set(p.fX, p.fAlpha, &amp;p.fY, p.fC);</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   SetPoints(p.fPointIDs, p.fNPoints);</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :   SetNumberOfClusters(p.fNPoints);</span>
<span class="lineNum">      99 </span>            :   //SetIntegratedLength(GetPathLengthTo( GetLastPointX(), b);
<a name="100"><span class="lineNum">     100 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span>            : AliHLTGlobalBarrelTrack::AliHLTGlobalBarrelTrack(const AliExternalTrackParam&amp; p )
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :   : AliKalmanTrack()</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   , fPoints()</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :   , fLastX(0)</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   , fLastY(0)</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   , fTrackID(0)</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :   , fHelixRadius(0.0)</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   , fHelixCenterX(0.0)</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :   , fHelixCenterY(0.0)</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :   , fSpacePoints(NULL)</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :   , fTrackPoints(NULL)</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     114 </span>            :   // constructor from AliExternalTrackParam
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :   *(dynamic_cast&lt;AliExternalTrackParam*&gt;(this))=p;</span>
<a name="116"><span class="lineNum">     116 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     117 </span>            : 
<span class="lineNum">     118 </span>            : AliHLTGlobalBarrelTrack::~AliHLTGlobalBarrelTrack()
<span class="lineNum">     119 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     120 </span>            :   // destructor
<span class="lineNum">     121 </span><span class="lineNoCov">          0 : }</span>
<a name="122"><span class="lineNum">     122 </span>            : </a>
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span>            : Double_t AliHLTGlobalBarrelTrack::GetPathLengthTo( Double_t x, Double_t b ) const
<span class="lineNum">     125 </span>            : {
<span class="lineNum">     126 </span>            :   // calculate the trajectory length for dx step
<span class="lineNum">     127 </span>            :     
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   Double_t dx = x - GetX();</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :   Double_t ey = GetSnp();</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :   if( TMath::Abs( ey )&gt;=kAlmost1 ) return 0;</span>
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   Double_t ex = TMath::Sqrt(1-ey*ey);</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :   Double_t k  = GetC(b);</span>
<span class="lineNum">     134 </span>            : 
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :   Double_t ey1 = k * dx + ey;</span>
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :   // check for intersection with X=x
<span class="lineNum">     138 </span>            : 
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :   if ( TMath::Abs( ey1 ) &gt;= kAlmost1  ) return 0;</span>
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :   Double_t ex1 = TMath::Sqrt(1-ey1*ey1);</span>
<span class="lineNum">     142 </span>            : 
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :   Double_t ss = ey + ey1;</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :   Double_t cc = ex + ex1;</span>
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :   if ( TMath::Abs( cc ) &lt; 1.e-4  ) return 0;</span>
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :   Double_t tg = ss / cc; </span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   Double_t dl = dx * TMath::Sqrt( 1 + tg * tg );</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   Double_t dSin = dl * k / 2;</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   if ( dSin &gt; 1 ) dSin = 1;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   if ( dSin &lt; -1 ) dSin = -1;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :   Double_t dS = ( TMath::Abs( k ) &gt; 1.e-4 )  ? ( 2 * TMath::ASin( dSin ) / k ) : dl;</span>
<span class="lineNum">     154 </span>            : 
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :   return dS*TMath::Sqrt(1 + GetTgl()*GetTgl() );</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     157 </span>            : 
<span class="lineNum">     158 </span>            : 
<a name="159"><span class="lineNum">     159 </span>            : </a>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            : int AliHLTGlobalBarrelTrack::ConvertTrackDataArray(const AliHLTTracksData* pTracks, unsigned sizeInByte, vector&lt;AliHLTGlobalBarrelTrack&gt; &amp;tgtArray )
<span class="lineNum">     162 </span>            : {
<span class="lineNum">     163 </span>            :   // convert a binary data block to array of tracks
<span class="lineNum">     164 </span>            :   int iResult=0;
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   if (!pTracks || sizeInByte&lt;sizeof(AliHLTTracksData) || pTracks-&gt;fCount==0) return 0;</span>
<span class="lineNum">     166 </span>            : 
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   const AliHLTUInt8_t* pEnd=reinterpret_cast&lt;const AliHLTUInt8_t*&gt;(pTracks);</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   pEnd+=sizeInByte;</span>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :   tgtArray.resize(pTracks-&gt;fCount + tgtArray.size());</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   const AliHLTUInt8_t* pCurrent=reinterpret_cast&lt;const AliHLTUInt8_t*&gt;(pTracks-&gt;fTracklets);</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :   for (unsigned i=0; i&lt;pTracks-&gt;fCount; i++) {</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :     if (pCurrent+sizeof(AliHLTExternalTrackParam)&gt;pEnd) {</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :       iResult=-EINVAL; break;</span>
<span class="lineNum">     175 </span>            :     }
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :     const AliHLTExternalTrackParam* track=reinterpret_cast&lt;const AliHLTExternalTrackParam*&gt;(pCurrent);</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :     if (pCurrent+sizeof(AliHLTExternalTrackParam)+track-&gt;fNPoints*sizeof(UInt_t)&gt;pEnd) {</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :       iResult=-EINVAL; break;</span>
<span class="lineNum">     179 </span>            :     }
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     tgtArray[i]=*track;</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :     pCurrent+=sizeof(AliHLTExternalTrackParam)+track-&gt;fNPoints*sizeof(UInt_t);</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :   if (iResult&lt;0) tgtArray.clear();</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   else iResult=tgtArray.size();</span>
<span class="lineNum">     185 </span>            :   return iResult;
<a name="186"><span class="lineNum">     186 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     187 </span>            : 
<span class="lineNum">     188 </span>            : UInt_t AliHLTGlobalBarrelTrack::GetNumberOfPoints() const
<span class="lineNum">     189 </span>            : {
<span class="lineNum">     190 </span>            :   // get number of assigned points
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   return fPoints.size();</span>
<a name="192"><span class="lineNum">     192 </span>            : }</a>
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            : const UInt_t* AliHLTGlobalBarrelTrack::GetPoints() const
<span class="lineNum">     195 </span>            : {
<span class="lineNum">     196 </span>            :   // get array of points
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :   if (fPoints.size()==0) return NULL;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :   return &amp;fPoints[0];</span>
<a name="199"><span class="lineNum">     199 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            : int AliHLTGlobalBarrelTrack::SetPoints(const UInt_t* pArray, UInt_t arraySize)
<span class="lineNum">     202 </span>            : {
<span class="lineNum">     203 </span>            :   // copy the array of points to internal memory
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :   if (!pArray || arraySize==0) return 0;</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   fPoints.resize(arraySize);</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :   for (unsigned i=0; i&lt;arraySize; i++) fPoints[i]=pArray[i];</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :   return fPoints.size();</span>
<a name="208"><span class="lineNum">     208 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            : int AliHLTGlobalBarrelTrack::CalculateHelixParams()
<span class="lineNum">     211 </span>            : {
<span class="lineNum">     212 </span>            :   // calculate radius and center of the helix
<span class="lineNum">     213 </span>            :   // using the global magnetic field
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :   return CalculateHelixParams(AliHLTMisc::Instance().GetBz());</span>
<a name="215"><span class="lineNum">     215 </span>            : }</a>
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span>            : int AliHLTGlobalBarrelTrack::CalculateHelixParams(float bfield)
<span class="lineNum">     218 </span>            : {
<span class="lineNum">     219 </span>            :   // calculate radius and center of the helix
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   if (TMath::Abs(bfield)&lt;kAlmost0) {</span>
<span class="lineNum">     221 </span>            :     // no magnetic field -&gt; straight lines
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :     fHelixRadius=kVeryBig;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     fHelixCenterX=kVeryBig;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :     fHelixCenterY=kVeryBig;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :     fHelixRadius = GetSignedPt()/(-kB2C*bfield);</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :     Double_t trackPhi = Phi()-GetAlpha();</span>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span>            :     //cout &lt;&lt; &quot;Helix: phi=&quot; &lt;&lt; trackPhi &lt;&lt; &quot; x=&quot; &lt;&lt; GetX() &lt;&lt; &quot; y=&quot; &lt;&lt; GetY() &lt;&lt; endl;
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :     fHelixCenterX = GetX() + fHelixRadius *  sin(trackPhi);</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :     fHelixCenterY = GetY() - fHelixRadius *  cos(trackPhi);</span>
<span class="lineNum">     232 </span>            :     //cout &lt;&lt; &quot;Helix: center&quot; &lt;&lt; &quot; x=&quot; &lt;&lt; fHelixCenterX &lt;&lt; &quot; y=&quot; &lt;&lt; fHelixCenterY &lt;&lt; endl;
<span class="lineNum">     233 </span>            :   }
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="235"><span class="lineNum">     235 </span>            : }</a>
<span class="lineNum">     236 </span>            : 
<span class="lineNum">     237 </span>            : int AliHLTGlobalBarrelTrack::CalculateCrossingPoint(float xPlane, float alphaPlane, float&amp; y, float&amp; z)
<span class="lineNum">     238 </span>            : {
<span class="lineNum">     239 </span>            :   // calculate crossing point of helix with a plane in yz
<span class="lineNum">     240 </span>            :   // in the local coordinates of the plane
<span class="lineNum">     241 </span>            :   int iResult=0;
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :   if (TMath::Abs(fHelixRadius)&lt;kAlmost0 &amp;&amp;</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :       (iResult=CalculateHelixParams())&lt;0) {</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     return iResult;</span>
<span class="lineNum">     245 </span>            :   }
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :   if (TMath::Abs(fHelixRadius)&gt;=kVeryBig) {</span>
<span class="lineNum">     248 </span>            :     // no magnetic field -&gt; straight lines
<span class="lineNum">     249 </span>            :   } else {
<span class="lineNum">     250 </span>            :     // rotate helix center to local coordinates of the plane reference frame
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :     float cosa=TMath::Cos(alphaPlane-GetAlpha());</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :     float sina=TMath::Sin(alphaPlane-GetAlpha());</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :     float cx= fHelixCenterX * cosa + fHelixCenterY * sina;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :     float cy=-fHelixCenterX * sina + fHelixCenterY * cosa;</span>
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span>            :     // crossing point of helix with plane
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :     Double_t aa = (cx - xPlane)*(cx - xPlane);</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :     Double_t r2 = fHelixRadius*fHelixRadius;</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :     if(aa &gt; r2) // no crossing</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :       return 0;</span>
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :     Double_t aa2 = sqrt(r2 - aa);</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :     Double_t y1 = cy + aa2;</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     Double_t y2 = cy - aa2;</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :     y = y1;</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :     if(TMath::Abs(y2) &lt; TMath::Abs(y1)) y = y2;</span>
<span class="lineNum">     267 </span>            :   
<span class="lineNum">     268 </span>            :     // calculate the arc length between (x,y) and (x0,y0) with radius (cx,cy)
<span class="lineNum">     269 </span>            :     // reference point is (x0,y0) rotated by the diffence of the plane angle and
<span class="lineNum">     270 </span>            :     // the track reference frame angle alpha
<span class="lineNum">     271 </span>            :     // 1) angle of (x,y)
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :     Double_t angle1 = atan2((y - cy),(xPlane - cx));</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :     if(angle1 &lt; 0) angle1 += TMath::TwoPi();</span>
<span class="lineNum">     274 </span>            : 
<span class="lineNum">     275 </span>            :     // 2) angle of (x0,y0)
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     float x0= GetX() * cosa + GetY() * sina;</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     float y0=-GetX() * sina + GetY() * cosa;</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :     Double_t angle2 = atan2((y0 - cy),(x0 - cx));</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     if(angle2 &lt; 0) angle2 += TMath::TwoPi();</span>
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span>            :     // 3) angle between (x,y) and (x0,y0)
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :     Double_t diffangle = angle1 - angle2;</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :     diffangle = fmod(diffangle,TMath::TwoPi());</span>
<span class="lineNum">     284 </span>            : 
<span class="lineNum">     285 </span>            :     // 4) arc length
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :     Double_t arclength = TMath::Abs(diffangle*fHelixRadius);</span>
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span>            :     // 5) direction depending on whether going outwards or inwards
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :     int direction=GetX()&gt;xPlane?-1:1;</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     z = GetZ() + direction*arclength*GetTgl();</span>
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span>            :     //cout &lt;&lt; &quot;x=&quot; &lt;&lt; xPlane &lt;&lt; &quot; y=&quot; &lt;&lt; y &lt;&lt; &quot; cx=&quot; &lt;&lt; cx &lt;&lt; &quot; cy=&quot; &lt;&lt; cy &lt;&lt; &quot; a1=&quot; &lt;&lt; angle1 &lt;&lt; &quot; a2=&quot; &lt;&lt; angle2 &lt;&lt; &quot; diffa=&quot; &lt;&lt; diffangle &lt;&lt; &quot; s=&quot; &lt;&lt; arclength &lt;&lt; &quot; z=&quot; &lt;&lt; z &lt;&lt; endl;
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :   return 1;</span>
<a name="295"><span class="lineNum">     295 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     296 </span>            : 
<span class="lineNum">     297 </span>            : void AliHLTGlobalBarrelTrack::Print(Option_t* option) const
<span class="lineNum">     298 </span>            : {
<span class="lineNum">     299 </span>            :   // see header file for class documentation
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;********* Track Id: &quot; &lt;&lt; fTrackID &lt;&lt; &quot; *******************&quot; &lt;&lt; endl;</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :   AliExternalTrackParam::Print(option);</span>
<span class="lineNum">     302 </span>            : //   cout &lt;&lt; &quot;  Alpha &quot;     &lt;&lt; GetAlpha();
<span class="lineNum">     303 </span>            : //   cout &lt;&lt; &quot;  X &quot;         &lt;&lt; GetX();
<span class="lineNum">     304 </span>            : //   cout &lt;&lt; &quot;  Y &quot;         &lt;&lt; GetY();
<span class="lineNum">     305 </span>            : //   cout &lt;&lt; &quot;  Z &quot;         &lt;&lt; GetZ() &lt;&lt; endl;
<span class="lineNum">     306 </span>            : //   cout &lt;&lt; &quot;  Snp &quot;       &lt;&lt; GetSnp();
<span class="lineNum">     307 </span>            : //   cout &lt;&lt; &quot;  Tgl &quot;       &lt;&lt; GetTgl();
<span class="lineNum">     308 </span>            : //   cout &lt;&lt; &quot;  Signed1Pt &quot; &lt;&lt; GetSigned1Pt() &lt;&lt; endl;
<a name="309"><span class="lineNum">     309 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     310 </span>            : 
<span class="lineNum">     311 </span>            : void AliHLTGlobalBarrelTrack::Draw(Option_t *option)
<span class="lineNum">     312 </span>            : {
<span class="lineNum">     313 </span>            :   /// Inherited from TObject, draw the track
<span class="lineNum">     314 </span>            :   float scale=250;
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :   float center[2]={0.5,0.5};</span>
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   if (TMath::Abs(fHelixRadius)&lt;kAlmost0 &amp;&amp;</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :       (CalculateHelixParams())&lt;0) {</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     320 </span>            :   }
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   TString strOption(option);</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   if (strOption.IsNull()) strOption=&quot;spacepoints trackarc&quot;;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :   std::auto_ptr&lt;TObjArray&gt; tokens(strOption.Tokenize(&quot; &quot;));</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :   if (!tokens.get()) return;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :   for (int i=0; i&lt;tokens-&gt;GetEntriesFast(); i++) {</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :     if (!tokens-&gt;At(i)) continue;</span>
<span class="lineNum">     328 </span>            :     const char* key=&quot;&quot;;
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :     TString arg=tokens-&gt;At(i)-&gt;GetName();</span>
<span class="lineNum">     330 </span>            : 
<span class="lineNum">     331 </span>            :     key=&quot;scale=&quot;;
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :     if (arg.BeginsWith(key)) {</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :       arg.ReplaceAll(key, &quot;&quot;);</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :       scale=arg.Atof();</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     336 </span>            :     }
<span class="lineNum">     337 </span>            :     key=&quot;centerx=&quot;;
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :     if (arg.BeginsWith(key)) {</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :       arg.ReplaceAll(key, &quot;&quot;);</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :       center[0]=arg.Atof();</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     342 </span>            :     }
<span class="lineNum">     343 </span>            :     key=&quot;centery=&quot;;
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :     if (arg.BeginsWith(key)) {</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :       arg.ReplaceAll(key, &quot;&quot;);</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :       center[1]=arg.Atof();</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     348 </span>            :     }
<span class="lineNum">     349 </span>            :     key=&quot;spacepoints&quot;;
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     if (arg.CompareTo(key)==0) {</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :       if (fSpacePoints) DrawProjXYSpacePoints(option, fSpacePoints, scale, center);</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     353 </span>            :     }
<span class="lineNum">     354 </span>            :     key=&quot;trackarc&quot;;
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :     if (arg.CompareTo(key)==0) {</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :       DrawProjXYTrack(option, scale, center);</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     358 </span>            :     }
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :   }</span>
<a name="360"><span class="lineNum">     360 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            : int AliHLTGlobalBarrelTrack::DrawProjXYSpacePoints(Option_t */*option*/, const AliHLTSpacePointContainer* spacePoints, const float scale, float center[2])
<span class="lineNum">     363 </span>            : {
<span class="lineNum">     364 </span>            :   /// draw space points
<span class="lineNum">     365 </span>            :   int markerColor=3;
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   if (!spacePoints) return -EINVAL;</span>
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :   const UInt_t* pointids=GetPoints();</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :   for (unsigned i=0; i&lt;GetNumberOfPoints() &amp;&amp; pointids; i++) {</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :     float clusterphi=spacePoints-&gt;GetPhi(pointids[i]);</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :     float cosphi=TMath::Cos(clusterphi);</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :     float sinphi=TMath::Sin(clusterphi);</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :     float clusterx=spacePoints-&gt;GetX(pointids[i]);</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :     float clustery=spacePoints-&gt;GetY(pointids[i]);</span>
<span class="lineNum">     376 </span>            :     // rotate
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :     float pointx= clusterx*sinphi + clustery*cosphi;</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :     float pointy=-clusterx*cosphi + clustery*sinphi;</span>
<span class="lineNum">     379 </span>            : 
<span class="lineNum">     380 </span>            :     // FIXME: cleanup of marker objects
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :     TMarker* m=new TMarker(pointx/(2*scale)+center[0], pointy/(2*scale)+center[1], 3);</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :     m-&gt;SetMarkerColor(markerColor);</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :     m-&gt;Draw(&quot;same&quot;);</span>
<span class="lineNum">     384 </span>            :   }
<span class="lineNum">     385 </span>            :   return 0;
<span class="lineNum">     386 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span>            : // FIXME: make this a general geometry definition
<span class="lineNum">     389 </span>            : // through an abstract class interface
<span class="lineNum">     390 </span>            : const Double_t gkTPCX[159] = {
<span class="lineNum">     391 </span>            :   85.195,
<span class="lineNum">     392 </span>            :   85.945,
<span class="lineNum">     393 </span>            :   86.695,
<span class="lineNum">     394 </span>            :   87.445,
<span class="lineNum">     395 </span>            :   88.195,
<span class="lineNum">     396 </span>            :   88.945,
<span class="lineNum">     397 </span>            :   89.695,
<span class="lineNum">     398 </span>            :   90.445,
<span class="lineNum">     399 </span>            :   91.195,
<span class="lineNum">     400 </span>            :   91.945,
<span class="lineNum">     401 </span>            :   92.695,
<span class="lineNum">     402 </span>            :   93.445,
<span class="lineNum">     403 </span>            :   94.195,
<span class="lineNum">     404 </span>            :   94.945,
<span class="lineNum">     405 </span>            :   95.695,
<span class="lineNum">     406 </span>            :   96.445,
<span class="lineNum">     407 </span>            :   97.195,
<span class="lineNum">     408 </span>            :   97.945,
<span class="lineNum">     409 </span>            :   98.695,
<span class="lineNum">     410 </span>            :   99.445,
<span class="lineNum">     411 </span>            :   100.195,
<span class="lineNum">     412 </span>            :   100.945,
<span class="lineNum">     413 </span>            :   101.695,
<span class="lineNum">     414 </span>            :   102.445,
<span class="lineNum">     415 </span>            :   103.195,
<span class="lineNum">     416 </span>            :   103.945,
<span class="lineNum">     417 </span>            :   104.695,
<span class="lineNum">     418 </span>            :   105.445,
<span class="lineNum">     419 </span>            :   106.195,
<span class="lineNum">     420 </span>            :   106.945,
<span class="lineNum">     421 </span>            :   107.695,
<span class="lineNum">     422 </span>            :   108.445,
<span class="lineNum">     423 </span>            :   109.195,
<span class="lineNum">     424 </span>            :   109.945,
<span class="lineNum">     425 </span>            :   110.695,
<span class="lineNum">     426 </span>            :   111.445,
<span class="lineNum">     427 </span>            :   112.195,
<span class="lineNum">     428 </span>            :   112.945,
<span class="lineNum">     429 </span>            :   113.695,
<span class="lineNum">     430 </span>            :   114.445,
<span class="lineNum">     431 </span>            :   115.195,
<span class="lineNum">     432 </span>            :   115.945,
<span class="lineNum">     433 </span>            :   116.695,
<span class="lineNum">     434 </span>            :   117.445,
<span class="lineNum">     435 </span>            :   118.195,
<span class="lineNum">     436 </span>            :   118.945,
<span class="lineNum">     437 </span>            :   119.695,
<span class="lineNum">     438 </span>            :   120.445,
<span class="lineNum">     439 </span>            :   121.195,
<span class="lineNum">     440 </span>            :   121.945,
<span class="lineNum">     441 </span>            :   122.695,
<span class="lineNum">     442 </span>            :   123.445,
<span class="lineNum">     443 </span>            :   124.195,
<span class="lineNum">     444 </span>            :   124.945,
<span class="lineNum">     445 </span>            :   125.695,
<span class="lineNum">     446 </span>            :   126.445,
<span class="lineNum">     447 </span>            :   127.195,
<span class="lineNum">     448 </span>            :   127.945,
<span class="lineNum">     449 </span>            :   128.695,
<span class="lineNum">     450 </span>            :   129.445,
<span class="lineNum">     451 </span>            :   130.195,
<span class="lineNum">     452 </span>            :   130.945,
<span class="lineNum">     453 </span>            :   131.695,
<span class="lineNum">     454 </span>            :   135.180,
<span class="lineNum">     455 </span>            :   136.180,
<span class="lineNum">     456 </span>            :   137.180,
<span class="lineNum">     457 </span>            :   138.180,
<span class="lineNum">     458 </span>            :   139.180,
<span class="lineNum">     459 </span>            :   140.180,
<span class="lineNum">     460 </span>            :   141.180,
<span class="lineNum">     461 </span>            :   142.180,
<span class="lineNum">     462 </span>            :   143.180,
<span class="lineNum">     463 </span>            :   144.180,
<span class="lineNum">     464 </span>            :   145.180,
<span class="lineNum">     465 </span>            :   146.180,
<span class="lineNum">     466 </span>            :   147.180,
<span class="lineNum">     467 </span>            :   148.180,
<span class="lineNum">     468 </span>            :   149.180,
<span class="lineNum">     469 </span>            :   150.180,
<span class="lineNum">     470 </span>            :   151.180,
<span class="lineNum">     471 </span>            :   152.180,
<span class="lineNum">     472 </span>            :   153.180,
<span class="lineNum">     473 </span>            :   154.180,
<span class="lineNum">     474 </span>            :   155.180,
<span class="lineNum">     475 </span>            :   156.180,
<span class="lineNum">     476 </span>            :   157.180,
<span class="lineNum">     477 </span>            :   158.180,
<span class="lineNum">     478 </span>            :   159.180,
<span class="lineNum">     479 </span>            :   160.180,
<span class="lineNum">     480 </span>            :   161.180,
<span class="lineNum">     481 </span>            :   162.180,
<span class="lineNum">     482 </span>            :   163.180,
<span class="lineNum">     483 </span>            :   164.180,
<span class="lineNum">     484 </span>            :   165.180,
<span class="lineNum">     485 </span>            :   166.180,
<span class="lineNum">     486 </span>            :   167.180,
<span class="lineNum">     487 </span>            :   168.180,
<span class="lineNum">     488 </span>            :   169.180,
<span class="lineNum">     489 </span>            :   170.180,
<span class="lineNum">     490 </span>            :   171.180,
<span class="lineNum">     491 </span>            :   172.180,
<span class="lineNum">     492 </span>            :   173.180,
<span class="lineNum">     493 </span>            :   174.180,
<span class="lineNum">     494 </span>            :   175.180,
<span class="lineNum">     495 </span>            :   176.180,
<span class="lineNum">     496 </span>            :   177.180,
<span class="lineNum">     497 </span>            :   178.180,
<span class="lineNum">     498 </span>            :   179.180,
<span class="lineNum">     499 </span>            :   180.180,
<span class="lineNum">     500 </span>            :   181.180,
<span class="lineNum">     501 </span>            :   182.180,
<span class="lineNum">     502 </span>            :   183.180,
<span class="lineNum">     503 </span>            :   184.180,
<span class="lineNum">     504 </span>            :   185.180,
<span class="lineNum">     505 </span>            :   186.180,
<span class="lineNum">     506 </span>            :   187.180,
<span class="lineNum">     507 </span>            :   188.180,
<span class="lineNum">     508 </span>            :   189.180,
<span class="lineNum">     509 </span>            :   190.180,
<span class="lineNum">     510 </span>            :   191.180,
<span class="lineNum">     511 </span>            :   192.180,
<span class="lineNum">     512 </span>            :   193.180,
<span class="lineNum">     513 </span>            :   194.180,
<span class="lineNum">     514 </span>            :   195.180,
<span class="lineNum">     515 </span>            :   196.180,
<span class="lineNum">     516 </span>            :   197.180,
<span class="lineNum">     517 </span>            :   198.180,
<span class="lineNum">     518 </span>            :   199.430,
<span class="lineNum">     519 </span>            :   200.930,
<span class="lineNum">     520 </span>            :   202.430,
<span class="lineNum">     521 </span>            :   203.930,
<span class="lineNum">     522 </span>            :   205.430,
<span class="lineNum">     523 </span>            :   206.930,
<span class="lineNum">     524 </span>            :   208.430,
<span class="lineNum">     525 </span>            :   209.930,
<span class="lineNum">     526 </span>            :   211.430,
<span class="lineNum">     527 </span>            :   212.930,
<span class="lineNum">     528 </span>            :   214.430,
<span class="lineNum">     529 </span>            :   215.930,
<span class="lineNum">     530 </span>            :   217.430,
<span class="lineNum">     531 </span>            :   218.930,
<span class="lineNum">     532 </span>            :   220.430,
<span class="lineNum">     533 </span>            :   221.930,
<span class="lineNum">     534 </span>            :   223.430,
<span class="lineNum">     535 </span>            :   224.930,
<span class="lineNum">     536 </span>            :   226.430,
<span class="lineNum">     537 </span>            :   227.930,
<span class="lineNum">     538 </span>            :   229.430,
<span class="lineNum">     539 </span>            :   230.930,
<span class="lineNum">     540 </span>            :   232.430,
<span class="lineNum">     541 </span>            :   233.930,
<span class="lineNum">     542 </span>            :   235.430,
<span class="lineNum">     543 </span>            :   236.930,
<span class="lineNum">     544 </span>            :   238.430,
<span class="lineNum">     545 </span>            :   239.930,
<span class="lineNum">     546 </span>            :   241.430,
<span class="lineNum">     547 </span>            :   242.930,
<span class="lineNum">     548 </span>            :   244.430,
<span class="lineNum">     549 </span>            :   245.930
<a name="550"><span class="lineNum">     550 </span>            : };</a>
<span class="lineNum">     551 </span>            : 
<span class="lineNum">     552 </span>            : int AliHLTGlobalBarrelTrack::DrawProjXYTrack(Option_t *option, const float scale, float center[2])
<span class="lineNum">     553 </span>            : {
<span class="lineNum">     554 </span>            :   /// draw track
<span class="lineNum">     555 </span>            :   bool bDrawArc=false; // draw TArc
<span class="lineNum">     556 </span>            :   //bool bNoTrackPoints=false; // don't draw track points
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :   TString strOption(option);</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :   if (strOption.IsNull()) strOption=&quot;spacepoints trackarc&quot;;</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :   std::auto_ptr&lt;TObjArray&gt; tokens(strOption.Tokenize(&quot; &quot;));</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :   if (!tokens.get()) return 0;</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :   for (int i=0; i&lt;tokens-&gt;GetEntriesFast(); i++) {</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :     if (!tokens-&gt;At(i)) continue;</span>
<span class="lineNum">     563 </span>            :     const char* key=&quot;&quot;;
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :     TString arg=tokens-&gt;At(i)-&gt;GetName();</span>
<span class="lineNum">     565 </span>            : 
<span class="lineNum">     566 </span>            :     key=&quot;drawarc&quot;;
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :     if (arg.BeginsWith(key)) {</span>
<span class="lineNum">     568 </span>            :       bDrawArc=true;
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     570 </span>            :     }
<span class="lineNum">     571 </span>            :     key=&quot;notrackpoints&quot;;
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :     if (arg.BeginsWith(key)) {</span>
<span class="lineNum">     573 </span>            :       //bNoTrackPoints=true;
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :       continue;</span>
<span class="lineNum">     575 </span>            :     }
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     577 </span>            : 
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :   float cosa=TMath::Cos(GetAlpha());</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :   float sina=TMath::Sin(GetAlpha());</span>
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span>            :   // first point
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :   float firstpoint[2];</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :   firstpoint[0]= GetX()*sina + GetY()*cosa;</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :   firstpoint[1]=-GetX()*cosa + GetY()*sina;</span>
<span class="lineNum">     585 </span>            :   {
<span class="lineNum">     586 </span>            :     //cout &lt;&lt; &quot; first point alpha=&quot; &lt;&lt; GetAlpha() &lt;&lt; &quot; x: &quot; &lt;&lt; firstpoint[0] &lt;&lt; &quot; y: &quot; &lt;&lt; firstpoint[1] &lt;&lt; endl;
<span class="lineNum">     587 </span>            :     // FIXME: cleanup of marker objects
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :     TMarker* m=new TMarker(firstpoint[0]/(2*scale)+center[0], firstpoint[1]/(2*scale)+center[1], 29);</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     m-&gt;SetMarkerSize(2);</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :     m-&gt;SetMarkerColor(2);</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :     m-&gt;Draw(&quot;same&quot;);</span>
<span class="lineNum">     592 </span>            :   }
<span class="lineNum">     593 </span>            : 
<span class="lineNum">     594 </span>            :   // draw points in step width and remember the last point
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :   float lastpoint[2]={0.0, 0.0};</span>
<span class="lineNum">     596 </span>            :   int firstpadrow=0;
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :   for (; firstpadrow&lt;159 &amp;&amp; gkTPCX[firstpadrow]&lt;GetX(); firstpadrow++);</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :   DrawProjXYTrackPoints(option, scale, center, firstpadrow, -1, firstpoint);</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :   DrawProjXYTrackPoints(option, scale, center, firstpadrow, 1, lastpoint);</span>
<span class="lineNum">     600 </span>            : 
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :   if (bDrawArc) {</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     if (TMath::Abs(fHelixRadius)&gt;=kVeryBig) {</span>
<span class="lineNum">     603 </span>            :       // no magnetic field -&gt; straight lines
<span class="lineNum">     604 </span>            :     } else {
<span class="lineNum">     605 </span>            :       // rotate helix center to local coordinates of the plane reference frame
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :       float cx= fHelixCenterX * sina + fHelixCenterY * cosa;</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :       float cy=-fHelixCenterX * cosa + fHelixCenterY * sina;</span>
<span class="lineNum">     608 </span>            : 
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :       float diffx=cx-firstpoint[0];</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :       float diffy=cy-firstpoint[1];</span>
<span class="lineNum">     611 </span>            :       float phimin=0.0;
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :       float phimax=2*TMath::Pi();</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :       if (TMath::Abs(diffx)&lt;kAlmost0) {</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :         phimin=TMath::Pi()/2;</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         phimin=TMath::ATan(diffy/diffx);</span>
<span class="lineNum">     617 </span>            :       }
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :       if (diffx&gt;0) phimin+=TMath::Pi();</span>
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :       diffx=cx-lastpoint[0];</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :       diffy=cy-lastpoint[1];</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :       if (TMath::Abs(diffx)&lt;kAlmost0) {</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :         phimax=TMath::Pi()/2;</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :         phimax=TMath::ATan(diffy/diffx);</span>
<span class="lineNum">     626 </span>            :       }
<span class="lineNum">     627 </span>            :       //cout &lt;&lt; &quot;diffx=&quot; &lt;&lt; diffx &lt;&lt; &quot; diffy=&quot; &lt;&lt; diffy &lt;&lt; &quot; phimin=&quot; &lt;&lt; phimin &lt;&lt; &quot; phimax=&quot; &lt;&lt; phimax &lt;&lt; endl;
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :       if (diffx&gt;0) phimax+=TMath::Pi();</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :       if (phimax&lt;0 &amp;&amp; phimin&gt;=0 &amp;&amp; </span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :           phimax+TMath::TwoPi()-phimin&lt;TMath::Pi()) phimax+=TMath::TwoPi();</span>
<span class="lineNum">     631 </span>            :       //if (phimax&lt;0 &amp;&amp; TMath::Abs(phimax-phimin)&lt;TMath::Pi()) phimax+=TMath::TwoPi();
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :       if (phimax-phimin&gt;TMath::Pi()) phimax-=TMath::TwoPi();</span>
<span class="lineNum">     633 </span>            : 
<span class="lineNum">     634 </span>            :       if (0/*phimin&gt;phimax*/) {
<span class="lineNum">     635 </span>            :         float tmp=phimin;
<span class="lineNum">     636 </span>            :         phimin=phimax;
<span class="lineNum">     637 </span>            :         phimax=tmp;
<span class="lineNum">     638 </span>            :       }
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :       phimin*=360.0/(2*TMath::Pi());</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :       phimax*=360.0/(2*TMath::Pi());</span>
<span class="lineNum">     641 </span>            :       //cout &lt;&lt; &quot; cx=&quot; &lt;&lt; cx &lt;&lt; &quot; cy=&quot; &lt;&lt; cy &lt;&lt; &quot; r=&quot; &lt;&lt; fHelixRadius &lt;&lt; &quot; phimin=&quot; &lt;&lt; phimin &lt;&lt; &quot; phimax=&quot; &lt;&lt; phimax &lt;&lt; endl;
<span class="lineNum">     642 </span>            :       // FIXME: cleanup of graphics objects
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :       TArc* tarc=new TArc(cx/(2*scale)+center[0], cy/(2*scale)+center[1], TMath::Abs(fHelixRadius)/(2*scale), phimin, phimax);</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :       tarc-&gt;SetNoEdges();</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :       tarc-&gt;SetFillStyle(0);</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :       tarc-&gt;Draw(&quot;same&quot;);</span>
<span class="lineNum">     647 </span>            :     }
<span class="lineNum">     648 </span>            :   }
<span class="lineNum">     649 </span>            :   return 0;
<a name="650"><span class="lineNum">     650 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     651 </span>            : 
<span class="lineNum">     652 </span>            : int AliHLTGlobalBarrelTrack::DrawProjXYTrackPoints(Option_t */*option*/, const float scale, const float center[2], int firstpadrow, int step, float point[2])
<span class="lineNum">     653 </span>            : {
<span class="lineNum">     654 </span>            :   // draw points in step width and return the last point
<span class="lineNum">     655 </span>            :   float offsetAlpha=0.0;
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :   float cosa=TMath::Cos(GetAlpha());</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :   float sina=TMath::Sin(GetAlpha());</span>
<span class="lineNum">     658 </span>            :   int markerColor=1;
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :   for (int padrow=firstpadrow; padrow&gt;=0 &amp;&amp; padrow&lt;159; padrow+=step) {</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :     float x=gkTPCX[padrow];</span>
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :     float y=0.0;</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     float z=0.0;</span>
<span class="lineNum">     663 </span>            : 
<span class="lineNum">     664 </span>            :     int maxshift=9;
<span class="lineNum">     665 </span>            :     int shift=0;
<span class="lineNum">     666 </span>            :     int result=0;
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :     do {</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :       if ((result=CalculateCrossingPoint(x, GetAlpha()-offsetAlpha, y, z))&lt;1) break;</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :       float pointAlpha=TMath::ATan(y/x);</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :       if (TMath::Abs(pointAlpha)&gt;TMath::Pi()/18) {</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :         offsetAlpha+=(pointAlpha&gt;0?-1:1)*TMath::Pi()/9;</span>
<span class="lineNum">     672 </span>            :         result=0;
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :         markerColor++;</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :         cosa=TMath::Cos(GetAlpha()-offsetAlpha);</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :         sina=TMath::Sin(GetAlpha()-offsetAlpha);</span>
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     } while (result==0 &amp;&amp; shift++&lt;maxshift);</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :     if (result&lt;1) continue;</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :     point[0]= x*sina + y*cosa;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :     point[1]=-x*cosa + y*sina;</span>
<span class="lineNum">     681 </span>            : 
<span class="lineNum">     682 </span>            :     //cout &lt;&lt; x &lt;&lt; &quot; : x=&quot; &lt;&lt; x &lt;&lt; &quot; y=&quot; &lt;&lt; y &lt;&lt; endl;
<span class="lineNum">     683 </span>            :     // FIXME: cleanup of TMarker objects?
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :     TMarker* m=new TMarker(point[0]/(2*scale)+center[0], point[1]/(2*scale)+center[1], z&gt;=0?2:5);</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :     m-&gt;SetMarkerColor(markerColor);</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     m-&gt;Draw(&quot;same&quot;);</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="689"><span class="lineNum">     689 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     690 </span>            : 
<span class="lineNum">     691 </span>            : void AliHLTGlobalBarrelTrack::SetTrackGeometry(AliHLTTrackGeometry* points)
<span class="lineNum">     692 </span>            : {
<span class="lineNum">     693 </span>            :   /// set the instance to the track points container
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :   fTrackPoints=points; </span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :   if (!fTrackPoints) return; </span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :   fTrackPoints-&gt;SetTrackId(GetID());</span>
<a name="697"><span class="lineNum">     697 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     698 </span>            : 
<span class="lineNum">     699 </span>            : int AliHLTGlobalBarrelTrack::AssociateSpacePoints(AliHLTTrackGeometry* trackpoints, AliHLTSpacePointContainer&amp; spacepoints) const
<span class="lineNum">     700 </span>            : {
<span class="lineNum">     701 </span>            :   /// associate the track space points to the calculated track points
<span class="lineNum">     702 </span>            :   AliHLTTrackGeometry* instance=trackpoints;
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :   if (!instance) instance=fTrackPoints;</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :   if (!instance) return 0;</span>
<span class="lineNum">     705 </span>            : 
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :   UInt_t nofIds=GetNumberOfPoints();</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :   const UInt_t* ids=GetPoints();</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :   int result=instance-&gt;AssociateSpacePoints(ids, nofIds, spacepoints);</span>
<span class="lineNum">     709 </span>            :   return result;
<a name="710"><span class="lineNum">     710 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     711 </span>            : 
<span class="lineNum">     712 </span>            : int AliHLTGlobalBarrelTrack::ReadTracks(const char* filename, TClonesArray&amp; tgt, AliHLTComponentDataType /*dt*/, unsigned /*specification*/)
<span class="lineNum">     713 </span>            : {
<span class="lineNum">     714 </span>            :   // open block from file and add to collection
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :   if (!filename) return -EINVAL;</span>
<span class="lineNum">     716 </span>            :   
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :   TString input=filename;</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :   input+=&quot;?filetype=raw&quot;;</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :   std::auto_ptr&lt;TFile&gt; pFile(new TFile(input));</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :   if (!pFile.get()) return -ENOMEM;</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :   if (pFile-&gt;IsZombie()) return -ENOENT;</span>
<span class="lineNum">     722 </span>            : 
<span class="lineNum">     723 </span>            :   int iResult=0;
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :   pFile-&gt;Seek(0);</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :   std::auto_ptr&lt;TArrayC&gt; buffer(new TArrayC);</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :   if (!buffer.get()) return -ENOMEM;</span>
<span class="lineNum">     727 </span>            : 
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :   buffer-&gt;Set(pFile-&gt;GetSize());</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :   if (pFile-&gt;ReadBuffer(buffer-&gt;GetArray(), buffer-&gt;GetSize())==0) {</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :     const AliHLTTracksData* pTracks=reinterpret_cast&lt;const AliHLTTracksData*&gt;(buffer-&gt;GetArray());</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :     vector&lt;AliHLTGlobalBarrelTrack&gt; tracks;</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :     iResult=ConvertTrackDataArray(pTracks, buffer-&gt;GetSize(), tracks);</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :     if (iResult&gt;=0) {</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :       int offset=tgt.GetEntriesFast();</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :       tgt.ExpandCreate(offset+tracks.size());</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :       for (unsigned i=0; i&lt;tracks.size(); i++) {</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :         new (tgt[offset+i]) AliHLTGlobalBarrelTrack(tracks[i]);</span>
<span class="lineNum">     738 </span>            :       }
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :       iResult=tracks.size();</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     } else {</span>
<span class="lineNum">     741 </span>            :       //HLTError(&quot;failed to convert tracks from file %s size %d byte(s) &quot;, filename, pFile-&gt;GetSize());
<span class="lineNum">     742 </span>            :     }
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :   } else {</span>
<span class="lineNum">     744 </span>            :     //HLTError(&quot;failed reading %d byte(s) from file %s&quot;, pFile-&gt;GetSize(), filename);
<span class="lineNum">     745 </span>            :     iResult=-ENODATA;
<span class="lineNum">     746 </span>            :   }
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :   return iResult;</span>
<a name="749"><span class="lineNum">     749 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     750 </span>            : 
<span class="lineNum">     751 </span>            : int AliHLTGlobalBarrelTrack::ReadTrackList(const char* listfile, TClonesArray&amp; tgt, AliHLTComponentDataType dt, unsigned specification)
<span class="lineNum">     752 </span>            : {
<span class="lineNum">     753 </span>            :   // open blank separated list of files and read tracks
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :   ifstream list(listfile);</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :   if (!list.good()) return -ENOENT;</span>
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span>            :   int count=0;
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :   TString file;</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :   while (file.ReadLine(list)) {</span>
<span class="lineNum">     760 </span>            :     //HLTInfo(&quot;adding tracks from file %s&quot;, file.Data());
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :     int iResult=ReadTracks(file.Data(), tgt, dt, specification);</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     if (iResult&lt;0) {</span>
<span class="lineNum">     763 </span>            :       //HLTInfo(&quot;failed to add data from file %s: error %d&quot;, file.Data(), iResult);
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :       return iResult;</span>
<span class="lineNum">     765 </span>            :     }
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     count+=iResult;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     768 </span>            : 
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :   return count;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
