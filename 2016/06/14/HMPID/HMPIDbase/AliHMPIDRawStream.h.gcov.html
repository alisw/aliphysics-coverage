<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - HMPID/HMPIDbase/AliHMPIDRawStream.h</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">HMPID/HMPIDbase</a> - AliHMPIDRawStream.h<span style="font-size: 80%;"> (source / <a href="AliHMPIDRawStream.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">89</td>
            <td class="headerCovTableEntry">123</td>
            <td class="headerCovTableEntryLo">72.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">32</td>
            <td class="headerCovTableEntryLo">37.5 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : #ifndef ALIHMPIDRAWSTREAM_H</a>
<span class="lineNum">       2 </span>            : #define ALIHMPIDRAWSTREAM_H
<span class="lineNum">       3 </span>            : /* Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       4 </span>            :  * See cxx source for full Copyright notice                               */
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">       7 </span>            : ///
<span class="lineNum">       8 </span>            : /// This is a class for reading raw data digits for HMPID.
<span class="lineNum">       9 </span>            : /// The data format is taken from the document provided by Paolo Martinengo.
<span class="lineNum">      10 </span>            : ///
<span class="lineNum">      11 </span>            : /// cvetan.cheshkov@cern.ch 19/07/2007
<span class="lineNum">      12 </span>            : ///
<span class="lineNum">      13 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : #include &lt;TObject.h&gt;
<span class="lineNum">      16 </span>            : #include &lt;TH1F.h&gt;
<span class="lineNum">      17 </span>            : #include &lt;TH2F.h&gt;
<span class="lineNum">      18 </span>            : #include &lt;TFile.h&gt;
<span class="lineNum">      19 </span>            : #include &quot;AliHMPIDParam.h&quot;
<span class="lineNum">      20 </span>            : #include &lt;AliBitPacking.h&gt;
<span class="lineNum">      21 </span>            : #include &lt;AliFstream.h&gt;
<span class="lineNum">      22 </span>            : #include &quot;AliHMPIDDigit.h&quot;
<span class="lineNum">      23 </span>            : #include &quot;AliDAQ.h&quot;
<span class="lineNum">      24 </span>            : #include &quot;AliRawDataHeaderSim.h&quot;
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : class AliRawReader;
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span>            : class AliHMPIDRawStream: public TObject {
<span class="lineNum">      29 </span>            :   public :
<span class="lineNum">      30 </span>            :     AliHMPIDRawStream(AliRawReader* rawReader);
<span class="lineNum">      31 </span>            :     AliHMPIDRawStream();
<span class="lineNum">      32 </span>            :     
<span class="lineNum">      33 </span>            :     virtual ~AliHMPIDRawStream();
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            :     virtual void     Reset();
<span class="lineNum">      36 </span>            :     virtual Bool_t   Next();
<span class="lineNum">      37 </span>            :             void     InitVars(Int_t n);
<span class="lineNum">      38 </span>            :             void     DelVars();
<span class="lineNum">      39 </span>            :     
<a name="40"><span class="lineNum">      40 </span>            :    static  inline Int_t GetPad(Int_t ddl,Int_t row,Int_t dil,Int_t pad);               //get absolute pad number</a>
<a name="41"><span class="lineNum">      41 </span>            :    static  inline Int_t GetFee(Int_t ddl,Int_t row);                                   //get the FEE number</a>
<span class="lineNum">      42 </span><span class="lineNoCov">          0 :    static  Int_t GetNDDL()     { return kNDDL;}                                        //return the number of max # of DDLs</span>
<a name="43"><span class="lineNum">      43 </span><span class="lineNoCov">          0 :    static  Int_t GetNErrors()  { return kSumErr;}                                      //return the number of max # of Error Types</span></a>
<a name="44"><span class="lineNum">      44 </span>            : </a>
<a name="45"><span class="lineNum">      45 </span><span class="lineCov">       1174 :             Int_t   GetNPads()         const { return fNPads;}                         //Get number of pads present in the stream</span></a>
<a name="46"><span class="lineNum">      46 </span><span class="lineCov">       1062 :             Int_t*  GetPadArray()      const { return fPad;}                           //Get pad array from stream decoded</span></a>
<a name="47"><span class="lineNum">      47 </span><span class="lineCov">       1062 :             Int_t*  GetChargeArray()   const { return fCharge;}                        //Get the charge of the pads from dedcoded stream </span></a>
<a name="48"><span class="lineNum">      48 </span><span class="lineNoCov">          0 :             Int_t*  GetnDDLInStream()  const { return fnDDLInStream;}                  //Get the DDL input check array</span></a>
<a name="49"><span class="lineNum">      49 </span><span class="lineNoCov">          0 :             Int_t*  GetnDDLOutStream() const { return fnDDLOutStream;}                 //Get the DDL output check array</span></a>
<a name="50"><span class="lineNum">      50 </span><span class="lineNoCov">          0 :             Int_t   Pc          ( Int_t ddl,Int_t row,Int_t dil,Int_t pad                            ) {return AliHMPIDParam::A2P(GetPad(ddl,row,dil,pad));}                                                 //PC position number</span></a>
<span class="lineNum">      51 </span><span class="lineNoCov">          0 :             Int_t   PadPcX      ( Int_t ddl,Int_t row,Int_t dil,Int_t pad                            ) {return AliHMPIDParam::A2X(GetPad(ddl,row,dil,pad));}                                                 //pad pc x # 0..79</span>
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :             Int_t   PadPcY      ( Int_t ddl,Int_t row,Int_t dil,Int_t pad                            ) {return AliHMPIDParam::A2Y(GetPad(ddl,row,dil,pad));}                                                 //pad pc y # 0..47</span>
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            :     static inline const Char_t* GetErrName(Int_t eType);      
<span class="lineNum">      55 </span>            :     inline  Bool_t SetZeroSup (Bool_t isSup);
<a name="56"><span class="lineNum">      56 </span>            :     inline  Bool_t GetZeroSup()const; </a>
<a name="57"><span class="lineNum">      57 </span>            :     inline  Int_t  GetErrors(Int_t ddl,Int_t eType)const;                                                                                   //Get errors and occurance</a>
<a name="58"><span class="lineNum">      58 </span><span class="lineCov">        112 :     Int_t  GetDDLNumber() const{ return fDDLNumber;} //return the number of DDL actually being decoded</span></a>
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :     UInt_t GetLDCNumber() const{ return fLDCNumber;} //return the number of LDC actually being decoded</span>
<a name="60"><span class="lineNum">      60 </span><span class="lineNoCov">          0 :     UInt_t GetTimeStamp() const{ return fTimeStamp;} //return the time stamp of the event actually being decoded</span></a>
<a name="61"><span class="lineNum">      61 </span>            : </a>
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :     void   SetTurbo(Bool_t isTurbo){fTurbo=isTurbo;}     // Enable/Disable Turbo</span>
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :     Bool_t GetTurbo(){ return fTurbo;}                   // Enable Turbo</span>
<span class="lineNum">      64 </span>            :     Bool_t Turbo();                                      // Read HMPID Raw data without error checks
<span class="lineNum">      65 </span>            :     Bool_t ReadHMPIDRawData();                           // Read HMPID Raw data
<span class="lineNum">      66 </span>            :     Bool_t ReadSegment(Int_t &amp;cntSegment);               // Read Segment
<span class="lineNum">      67 </span>            :     Bool_t ReadRow(Int_t &amp;cntRow);                       // Read Row
<span class="lineNum">      68 </span>            :     Bool_t ReadDilogic(Int_t &amp;cntDilogic);               // Read Dilogic
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            :     Bool_t CheckRow(UInt_t row);                         // Check Row
<span class="lineNum">      71 </span>            :     Bool_t CheckDilogic(UInt_t dilogic);                 // Check Dilogic
<span class="lineNum">      72 </span>            :     Bool_t CheckPad(UInt_t pad);                         // Check pad
<span class="lineNum">      73 </span>            :     Bool_t CheckEoE(Int_t &amp;nDil);                        // Check EoE
<span class="lineNum">      74 </span>            :     Bool_t CheckRowMarker();                             // Check RowMarker
<span class="lineNum">      75 </span>            :     Bool_t CheckSegment();                               // Check Segment
<span class="lineNum">      76 </span>            :     void   DumpData(Int_t nw);                           // Dump Data
<a name="77"><span class="lineNum">      77 </span>            :     void   StorePosition();                              //Debug purpose</a>
<span class="lineNum">      78 </span>            :     
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     Double_t GetDdlDataSize()      { return 4.0*fRawDataSize;} //returns the data size for the DDL which is decoded in Next(); fRawDataSize = Bytes/4  </span>
<span class="lineNum">      80 </span>            :     
<span class="lineNum">      81 </span>            : //    inline void    Raw            (UInt_t &amp;w32,Int_t &amp;ddl,Int_t &amp;r,Int_t &amp;d,Int_t &amp;a);                                              //digit-&gt;(w32,ddl,r,d,a)
<span class="lineNum">      82 </span>            : //    inline void    Raw            (Int_t ddl,Int_t r,Int_t d,Int_t a);                                                              //raw-&gt;abs pad number
<span class="lineNum">      83 </span>            : //    inline Bool_t  Raw            (UInt_t  w32,Int_t  ddl,AliRawReader *pRR);                                                       //(w32,ddl)-&gt;digit
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span>            :     inline void   WriteRaw       (TObjArray *pDigLst                             );                 //write as raw stream     
<span class="lineNum">      86 </span>            :     inline void   WriteRowMarker  (AliFstream *ddl,UInt_t size);                                    //write row marker in simulation
<span class="lineNum">      87 </span>            :     inline void   WriteEoE        (AliFstream *ddl,UInt_t row,UInt_t dil,UInt_t wordCnt);           //write Enf Of Event word in simulation
<span class="lineNum">      88 </span>            :     inline void   WriteSegMarker  (AliFstream *ddl,UInt_t row, Int_t nwInSeg);                      //write Segment Marker word in simulation
<span class="lineNum">      89 </span>            :     inline void   Write5FirmwareWords(AliFstream *ddl);                                             //write the firmware control words in simulation
<span class="lineNum">      90 </span>            :     
<span class="lineNum">      91 </span>            : //    inline TClonesArray  ReMap(TClonesArray *pDigIn);
<span class="lineNum">      92 </span>            : enum EDirection {kFwd,kBwd};
<span class="lineNum">      93 </span>            : 
<span class="lineNum">      94 </span>            : enum Ebits {kbit0,kbit1 , kbit2, kbit3, kbit4, kbit5, kbit6, kbit7, kbit8,
<span class="lineNum">      95 </span>            :                   kbit9 ,kbit10,kbit11,kbit12,kbit13,kbit14,kbit15,kbit16,
<span class="lineNum">      96 </span>            :                   kbit17,kbit18,kbit19,kbit20,kbit21,kbit22,kbit23,kbit24,
<span class="lineNum">      97 </span>            :                   kbit25,kbit26,kbit27,kbit28,kbit29,kbit30,kbit31,kbit32};
<span class="lineNum">      98 </span>            :     
<span class="lineNum">      99 </span>            :   enum EHMPIDRawStreamError { kRawDataSizeErr   = 0,  kRowMarkerErr     = 1,  kWrongRowErr      = 2,  kWrongDilogicErr  = 3,
<span class="lineNum">     100 </span>            :                               kWrongPadErr      = 4,  kEoEFlagErr       = 5,  kEoESizeErr       = 6,  kEoEDILOGICErr    = 7,
<span class="lineNum">     101 </span>            :                               kEoERowErr        = 8,  kBadSegWordErr    = 9,  kWrongSegErr      = 10, kRowMarkerSizeErr = 11,
<span class="lineNum">     102 </span>            :                               kPedQZero         =12,  kSumErr           = 13  //This is always the last one, to retreive the number of errors
<span class="lineNum">     103 </span>            :                             };                        //Always check the updated list of names in the .cxx file for print-out!
<span class="lineNum">     104 </span>            :    
<span class="lineNum">     105 </span>            :   enum {
<span class="lineNum">     106 </span>            :       kNRows       = 24,                                    // Number of rows (starting from 1 !)//was25
<span class="lineNum">     107 </span>            :       kNDILOGICAdd = 10,                                    // Number of DILOGIC addresses in a row (starting from 1 !) //was11
<span class="lineNum">     108 </span>            :       kNPadAdd     = 48,                                    // Number of pad row
<span class="lineNum">     109 </span>            :       kNRowsPerSegment = 8,                                 // Number of rows per segment
<span class="lineNum">     110 </span>            :       kNDDL = 14
<span class="lineNum">     111 </span>            :     };
<span class="lineNum">     112 </span>            :  enum EHMPIDRawError {
<span class="lineNum">     113 </span>            :     kInvalidRawDataWord = 1
<span class="lineNum">     114 </span>            :   };
<span class="lineNum">     115 </span>            : 
<span class="lineNum">     116 </span>            :     
<span class="lineNum">     117 </span>            :   private :
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span>            :     AliHMPIDRawStream&amp; operator = (const AliHMPIDRawStream&amp; stream);
<span class="lineNum">     120 </span>            :     AliHMPIDRawStream(const AliHMPIDRawStream&amp; stream);
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span>            :     Bool_t           GetWord(Int_t n=1,EDirection dir=kFwd);             // Get n-th word
<span class="lineNum">     123 </span>            :     UInt_t           GetNextWord();                                      // Get next word
<span class="lineNum">     124 </span>            :     Int_t            fNPads;                                             // counter of pads in one DDL
<span class="lineNum">     125 </span>            :     Int_t           *fCharge;                                            // Array for charge values for all channels in one DDL
<span class="lineNum">     126 </span>            :     Int_t           *fPad;                                               // Array for abs pad values for all channels in one DDL
<span class="lineNum">     127 </span>            :     Int_t            fDDLNumber;                                         // index of current DDL number
<span class="lineNum">     128 </span>            :     Int_t           *fnDDLInStream;                                      // if the DDL is in the raw data
<span class="lineNum">     129 </span>            :     Int_t           *fnDDLOutStream;                                     // if the DDL is in the raw data
<span class="lineNum">     130 </span>            :     UInt_t           fLDCNumber;                                         // index of current LDC number
<span class="lineNum">     131 </span>            :     UInt_t           fTimeStamp;                                         // TimeStamp
<span class="lineNum">     132 </span>            :     AliRawReader    *fRawReader;                                         // object for reading the raw data
<span class="lineNum">     133 </span>            :     UChar_t         *fData;                                              // raw data
<span class="lineNum">     134 </span>            :     Int_t          **fNumOfErr;                                          // Store the numner of errors for a given error type and a given DDL
<span class="lineNum">     135 </span>            :     Int_t            fPosition;                                          // current word
<span class="lineNum">     136 </span>            :     UInt_t           fWord;                                              // current position in fData
<span class="lineNum">     137 </span>            :     Bool_t           fZeroSup;                                           // set if zero suppression is applied
<span class="lineNum">     138 </span>            :     Int_t           *fPos;                                               // for debug purposes
<span class="lineNum">     139 </span>            :     Int_t            fiPos;                                              // counter for debug
<a name="140"><span class="lineNum">     140 </span>            :     Bool_t           fTurbo;                                             // kTRUE = Turbo decoding is called. DEFAULT: kFALSE = normal decoding is called</a>
<span class="lineNum">     141 </span>            :     Int_t            fRawDataSize;
<span class="lineNum">     142 </span><span class="lineCov">        376 :     ClassDef(AliHMPIDRawStream, 4)                                       // base class for reading HMPID raw digits</span>
<span class="lineNum">     143 </span>            : };
<span class="lineNum">     144 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     145 </span>            :     /*
<span class="lineNum">     146 </span>            : void AliHMPIDRawStream::Raw(UInt_t &amp;w32,Int_t &amp;ddl,Int_t &amp;r,Int_t &amp;d,Int_t &amp;a)
<span class="lineNum">     147 </span>            : {
<span class="lineNum">     148 </span>            : // Convert raw stream word to raw word format
<span class="lineNum">     149 </span>            : // Arguments: w32,ddl,r,d,a where to write the results
<span class="lineNum">     150 </span>            : // Returns: none
<span class="lineNum">     151 </span>            :   Int_t y2a[6]={5,3,1,0,2,4};
<span class="lineNum">     152 </span>            :   
<span class="lineNum">     153 </span>            :   ddl=2*Ch(ddl,r,d,a)+Pc(ddl,r,d,a)%2;                                                          //DDL# 0..13
<span class="lineNum">     154 </span>            :   Int_t tmp=1+Pc(ddl,r,d,a)/2*8+PadPcY(ddl,r,d,a)/6;  r=(Pc(ddl,r,d,a)%2)? 25-tmp:tmp;              //row r=1..24
<span class="lineNum">     155 </span>            :   d=1+PadPcX(ddl,r,d,a)/8;                                                                  //DILOGIC# 1..10
<span class="lineNum">     156 </span>            :   a=y2a[PadPcY(ddl,r,d,a)%6]+6*(PadPcX(ddl,r,d,a)%8);                                           //ADDRESS 0..47        
<span class="lineNum">     157 </span>            :   
<span class="lineNum">     158 </span>            :   w32=0;    
<span class="lineNum">     159 </span>            :   AliBitPacking::PackWord((fCharge[fNPads]&gt;4095)?4095:(UInt_t)fCharge[fNPads],w32, 0,11);       // 0000 0rrr rrdd ddaa aaaa qqqq qqqq qqqq        Qdc               bits (00..11) counts (0..4095)
<span class="lineNum">     160 </span>            :   //molnarl: Since in simulation the the charge can be &gt; than 4095 but not in real life we need to protect. If fQ&gt;4095 after packing we will get 0 for the charge! 
<span class="lineNum">     161 </span>            :   assert(0&lt;=a&amp;&amp;a&lt;=47);AliBitPacking::PackWord(        a ,w32,12,17);  // 3322 2222 2222 1111 1111 1000 0000 0000        DILOGIC address   bits (12..17) counts (0..47)
<span class="lineNum">     162 </span>            :   assert(1&lt;=d&amp;&amp;d&lt;=10);AliBitPacking::PackWord(        d ,w32,18,21);  // 1098 7654 3210 9876 5432 1098 7654 3210        DILOGIC number    bits (18..21) counts (1..10)
<span class="lineNum">     163 </span>            :   assert(1&lt;=r&amp;&amp;r&lt;=24);AliBitPacking::PackWord(        r ,w32,22,26);  //                                                Row number        bits (22..26) counts (1..24)  
<span class="lineNum">     164 </span>            : }
<span class="lineNum">     165 </span>            : */
<span class="lineNum">     166 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     167 </span>            :     /*
<span class="lineNum">     168 </span>            : Int_t AliHMPIDRawStream::Raw(Int_t ddl,Int_t r,Int_t d,Int_t a)
<span class="lineNum">     169 </span>            : {
<span class="lineNum">     170 </span>            :   //Assign absolute pad ID based on ddl,row,dil,pad
<span class="lineNum">     171 </span>            :   //Arguments: DDL, row number, dilogic number, dilogic address(pad)
<span class="lineNum">     172 </span>            :   //Returns  : nothing
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span>            :   assert(0&lt;=ddl&amp;&amp;ddl&lt;=13); assert(1&lt;=r&amp;&amp;r&lt;=24); assert(1&lt;=d&amp;&amp;d&lt;=10);   assert(0&lt;=a&amp;&amp;a&lt;=47);  
<span class="lineNum">     175 </span>            :   Int_t a2y[6]={3,2,4,1,5,0};//pady for a given address (for single DILOGIC chip)
<span class="lineNum">     176 </span>            :                                   Int_t ch=ddl/2;
<span class="lineNum">     177 </span>            :   Int_t tmp=(r-1)/8;              Int_t pc=(ddl%2)? 5-2*tmp:2*tmp; 
<span class="lineNum">     178 </span>            :                                   Int_t px=(d-1)*8+a/6;
<span class="lineNum">     179 </span>            :         tmp=(ddl%2)?(24-r):r-1;   Int_t py=6*(tmp%8)+a2y[a%6];
<span class="lineNum">     180 </span>            :   return AliHMPIDParam::Abs(ch,pc,px,py);
<span class="lineNum">     181 </span>            : }
<span class="lineNum">     182 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     183 </span>            : Bool_t AliHMPIDRawStream::Raw(UInt_t w32,Int_t ddl, AliRawReader *pRR)
<span class="lineNum">     184 </span>            : {
<span class="lineNum">     185 </span>            : // Converts a given raw data word to a digit
<span class="lineNum">     186 </span>            : // Arguments: w32 - 32 bits raw data word
<span class="lineNum">     187 </span>            : //            ddl - DDL idx  0 1 2 3 4 ... 13
<span class="lineNum">     188 </span>            : //   Returns: none
<span class="lineNum">     189 </span>            :   Int_t r = AliBitPacking::UnpackWord(w32,22,26); assert(1&lt;=r&amp;&amp;r&lt;=24);   //                                         Row number      (1..24)    
<span class="lineNum">     190 </span>            :   Int_t d = AliBitPacking::UnpackWord(w32,18,21); assert(1&lt;=d&amp;&amp;d&lt;=10);   // 3322 2222 2222 1111 1111 1000 0000 0000 DILOGIC number  (1..10)
<span class="lineNum">     191 </span>            :   Int_t a = AliBitPacking::UnpackWord(w32,12,17); assert(0&lt;=a&amp;&amp;a&lt;=47);   // 1098 7654 3210 9876 5432 1098 7654 3210 DILOGIC address (0..47)  
<span class="lineNum">     192 </span>            :   Int_t q = AliBitPacking::UnpackWord(w32, 0,11); assert(0&lt;=q&amp;&amp;q&lt;=4095); // 0000 0rrr rrdd ddaa aaaa qqqq qqqq qqqq Qdc             (0..4095) 
<span class="lineNum">     193 </span>            :   if (r&lt;1 || r&gt;24 || d&lt;1 || d&gt;10 || a&lt;0 || a&gt;47 || q&lt;0 || q&gt;4095) {
<span class="lineNum">     194 </span>            :     AliWarning(Form(&quot;Invalid raw data word %x&quot;,w32));
<span class="lineNum">     195 </span>            :     pRR-&gt;AddMajorErrorLog(kInvalidRawDataWord,Form(&quot;w=%x&quot;,w32));
<span class="lineNum">     196 </span>            :     return kFALSE;
<span class="lineNum">     197 </span>            :   }
<span class="lineNum">     198 </span>            :   Raw(ddl,r,d,a);
<span class="lineNum">     199 </span>            :   fCharge[ddl][r][d][a]=q;
<span class="lineNum">     200 </span>            :   return kTRUE;
<span class="lineNum">     201 </span>            : }
<a name="202"><span class="lineNum">     202 </span>            : */</a>
<span class="lineNum">     203 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     204 </span>            : Int_t AliHMPIDRawStream::GetPad(Int_t ddl,Int_t row,Int_t dil,Int_t pad)
<span class="lineNum">     205 </span>            : {
<span class="lineNum">     206 </span>            :   // The method returns the absolute pad number or -1 
<span class="lineNum">     207 </span>            :   // in case the charge from the channels
<span class="lineNum">     208 </span>            :   // has not been read or invalid arguments
<span class="lineNum">     209 </span>            :  
<span class="lineNum">     210 </span>            :  
<span class="lineNum">     211 </span><span class="lineCov">       2124 :   if(ddl&lt;0 || ddl &gt;13 || row&lt;1 || row &gt;25 || dil&lt;1 || dil &gt;10 || pad&lt;0 || pad &gt;47 ) return -1;</span>
<span class="lineNum">     212 </span><span class="lineCov">       1062 :   Int_t a2y[6]={3,2,4,1,5,0};     //pady for a given padress (for single DILOGIC chip)</span>
<span class="lineNum">     213 </span><span class="lineCov">       1062 :   Int_t ch=ddl/2;</span>
<span class="lineNum">     214 </span><span class="lineCov">       1062 :   Int_t tmp=(24-row)/8;</span>
<span class="lineNum">     215 </span><span class="lineCov">       1062 :   Int_t pc=(ddl%2)?5-2*tmp:2*tmp;</span>
<span class="lineNum">     216 </span><span class="lineCov">       1062 :   Int_t px=(kNDILOGICAdd+1 - dil)*8-pad/6-1;  //flip according to Paolo (2-9-2008)</span>
<span class="lineNum">     217 </span>            : 
<span class="lineNum">     218 </span><span class="lineCov">       1062 :   tmp=(ddl%2)?row-1:(24-row);</span>
<span class="lineNum">     219 </span><span class="lineCov">       1062 :   Int_t py=6*(tmp%8)+a2y[pad%6];</span>
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span><span class="lineCov">       1062 :   return AliHMPIDParam::Abs(ch,pc,px,py);</span>
<a name="222"><span class="lineNum">     222 </span><span class="lineCov">       2124 : }//GetPad()</span></a>
<span class="lineNum">     223 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     224 </span>            : Int_t AliHMPIDRawStream::GetFee(Int_t ddl,Int_t row)
<span class="lineNum">     225 </span>            : {
<span class="lineNum">     226 </span>            :    // The method returns the FEE number or -1 
<span class="lineNum">     227 </span>            :    // in case of invalid argument(s)
<span class="lineNum">     228 </span>            :  
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :    if(ddl&lt;0 || ddl &gt;13 || row&lt;1 || row &gt;25  ) return -1;</span>
<span class="lineNum">     230 </span>            :    Int_t fee=-1, kLeft=0, kRight=0;
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :    if(ddl%2==0) {kLeft=1;kRight=0;}</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :    if(ddl%2!=0) {kLeft=0;kRight=1;}</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=24 &amp;&amp; row&gt;=21) || (kRight==1 &amp;&amp; row&lt;=4  &amp;&amp; row&gt;=1)) fee=0;    //calculation of FEE values based on Giacomos pedestal macro</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=20 &amp;&amp; row&gt;=17) || (kRight==1 &amp;&amp; row&lt;=8  &amp;&amp; row&gt;=5)) fee=1;</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=16 &amp;&amp; row&gt;=13) || (kRight==1 &amp;&amp; row&lt;=12 &amp;&amp; row&gt;=9)) fee=2;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=12 &amp;&amp; row&gt;=9)  || (kRight==1 &amp;&amp; row&lt;=16 &amp;&amp; row&gt;=13))fee=3;</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=8  &amp;&amp; row&gt;=5)  || (kRight==1 &amp;&amp; row&lt;=20 &amp;&amp; row&gt;=17))fee=4;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :    if((kLeft==1 &amp;&amp; row&lt;=4  &amp;&amp; row&gt;=1)  || (kRight==1 &amp;&amp; row&lt;=24 &amp;&amp; row&gt;=21))fee=5;</span>
<span class="lineNum">     239 </span>            :    return fee;
<a name="240"><span class="lineNum">     240 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     241 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     242 </span>            : void AliHMPIDRawStream::WriteRowMarker(AliFstream *ddl,UInt_t size)
<span class="lineNum">     243 </span>            : {
<span class="lineNum">     244 </span>            :   //Writes the row marker for real data and pedestal into the ddl stream
<span class="lineNum">     245 </span>            :   //Arguments: ddl stream and the size of the block of the given row, the siye is at least the 10 EoE words!
<span class="lineNum">     246 </span>            :   //Returns:   nothing
<span class="lineNum">     247 </span><span class="lineCov">       5376 :   UInt_t w32=0;</span>
<span class="lineNum">     248 </span>            :   UInt_t marker=13992;                                   //for pedestal=12968  ==  32a8 for zero suppressed 36a8
<span class="lineNum">     249 </span><span class="lineCov">       2688 :   AliBitPacking::PackWord(size,  w32, 16,31);            //number of roaw written after row marker (digits and EoE)</span>
<span class="lineNum">     250 </span><span class="lineCov">       2688 :   AliBitPacking::PackWord(marker,w32,0,15);              //the marker word</span>
<span class="lineNum">     251 </span><span class="lineCov">       2688 :   ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<a name="252"><span class="lineNum">     252 </span><span class="lineCov">       2688 : }</span></a>
<span class="lineNum">     253 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     254 </span>            : void AliHMPIDRawStream::WriteEoE(AliFstream *ddl,UInt_t row,UInt_t dil,UInt_t wordCnt  )
<span class="lineNum">     255 </span>            : {
<span class="lineNum">     256 </span>            :   //Writes the EoE word from real data and pedestals into the ddl stream
<span class="lineNum">     257 </span>            :   //Arguments:  ddl stream, row number, dilogic number and the number of words before the EoE
<span class="lineNum">     258 </span>            :   //Retursns:   nothing
<span class="lineNum">     259 </span>            :   UInt_t e=1;
<span class="lineNum">     260 </span><span class="lineCov">      26880 :   UInt_t w32=0;</span>
<span class="lineNum">     261 </span><span class="lineCov">      26880 :   assert(1&lt;=row&amp;&amp;row&lt;=24);      AliBitPacking::PackWord((UInt_t)row     ,w32,22,26);    // row number (1...24)</span>
<span class="lineNum">     262 </span><span class="lineCov">      26880 :   assert(1&lt;=dil&amp;&amp;dil&lt;=10);      AliBitPacking::PackWord((UInt_t)dil     ,w32,18,21);    // DILOGIC number (1...10)</span>
<span class="lineNum">     263 </span><span class="lineCov">      13440 :                                 AliBitPacking::PackWord(          e     ,w32, 7,17);   // event number -- not used</span>
<span class="lineNum">     264 </span><span class="lineCov">      13440 :                                 AliBitPacking::PackWord((UInt_t)wordCnt ,w32, 0, 6);  // word counter (0...47)                                                                  AliBitPacking::PackWord((UInt_t)1       ,w32,27,27);  // bit 27 is always 1 by definition of EoE</span>
<span class="lineNum">     265 </span><span class="lineCov">      13440 :                                 AliBitPacking::PackWord((UInt_t)1       ,w32,27,27);  // bit 27 is always 1 by definition of EoE    </span>
<span class="lineNum">     266 </span><span class="lineCov">      13440 :   ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));      </span>
<a name="267"><span class="lineNum">     267 </span><span class="lineCov">      13440 : } </span></a>
<span class="lineNum">     268 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     
<span class="lineNum">     269 </span>            : void AliHMPIDRawStream::WriteSegMarker(AliFstream *ddl,UInt_t row, Int_t nwInSeg)
<span class="lineNum">     270 </span>            : {
<span class="lineNum">     271 </span>            :   //Writes the segment marker (after 8 rows) into the ddl stream
<span class="lineNum">     272 </span>            :   //Arguments: ddl stream and the segment: row 8 -&gt; 0x5800, row 16 -&gt; 5801, row 24 -&gt; 5802 for pedestal
<span class="lineNum">     273 </span>            :   //Retruns:   nothing
<span class="lineNum">     274 </span><span class="lineCov">        336 :     UInt_t w32=0;</span>
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span>            :       //Segment marker: 2736 == ab0
<span class="lineNum">     277 </span>            :       //AliBitPacking::PackWord((UInt_t)0   ,w32,27,31);          //zero out the rest of the bits, since they are not needed
<span class="lineNum">     278 </span><span class="lineCov">        168 :       AliBitPacking::PackWord((UInt_t)2736   ,w32,20,31);       //ab0 the segment marker word</span>
<span class="lineNum">     279 </span><span class="lineCov">        168 :       AliBitPacking::PackWord((UInt_t)nwInSeg,w32, 8,19);       //number of words in the segment</span>
<span class="lineNum">     280 </span><span class="lineCov">        168 :       AliBitPacking::PackWord((UInt_t)(row/8),w32, 0, 7);       //segment 0,1,2    </span>
<span class="lineNum">     281 </span><span class="lineCov">        168 :       ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32)); </span>
<span class="lineNum">     282 </span>            :       //Printf(&quot;Segment word created is: %x&quot;,w32);
<a name="283"><span class="lineNum">     283 </span><span class="lineCov">        168 : }      </span></a>
<span class="lineNum">     284 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     
<span class="lineNum">     285 </span>            : void AliHMPIDRawStream::Write5FirmwareWords(AliFstream *ddl)
<span class="lineNum">     286 </span>            : {
<span class="lineNum">     287 </span>            :   //Before each DDL payload 5 words are written: 
<span class="lineNum">     288 </span>            :   // 1.) Firmware version,              for sim = 999
<span class="lineNum">     289 </span>            :   // 2.) Status and error bits from CD, for sim = 0
<span class="lineNum">     290 </span>            :   // 3.) # FEE RESET received         , for sim = 0
<span class="lineNum">     291 </span>            :   // 4.) # TTC READY                  , for sim = 0  
<span class="lineNum">     292 </span>            :   // 5.) Spare/Reserved               , for sim = 0
<span class="lineNum">     293 </span>            :   //Returns:   nothing
<span class="lineNum">     294 </span><span class="lineCov">        112 :   UInt_t w32=0;</span>
<span class="lineNum">     295 </span><span class="lineCov">         56 :   AliBitPacking::PackWord((UInt_t)999,w32,0,31); ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<span class="lineNum">     296 </span><span class="lineCov">         56 :   AliBitPacking::PackWord((UInt_t) 10,w32,0,31); ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<span class="lineNum">     297 </span><span class="lineCov">         56 :   AliBitPacking::PackWord((UInt_t) 11,w32,0,31); ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<span class="lineNum">     298 </span><span class="lineCov">         56 :   AliBitPacking::PackWord((UInt_t) 12,w32,0,31); ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<span class="lineNum">     299 </span><span class="lineCov">         56 :   AliBitPacking::PackWord((UInt_t) 13,w32,0,31); ddl-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));              </span>
<span class="lineNum">     300 </span>            :   
<a name="301"><span class="lineNum">     301 </span><span class="lineCov">         56 : }</span></a>
<span class="lineNum">     302 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     
<span class="lineNum">     303 </span>            : Bool_t AliHMPIDRawStream::SetZeroSup (Bool_t isSup)
<span class="lineNum">     304 </span>            : {
<span class="lineNum">     305 </span>            :   //Prevision to turn OFF zero suppression
<span class="lineNum">     306 </span>            :   //Arguments: setter
<span class="lineNum">     307 </span>            :   //Returns:   switch
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :   fZeroSup=isSup;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   return fZeroSup;</span>
<a name="310"><span class="lineNum">     310 </span>            : }</a>
<span class="lineNum">     311 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     
<span class="lineNum">     312 </span>            : Bool_t AliHMPIDRawStream::GetZeroSup()const
<span class="lineNum">     313 </span>            : {
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :   if(fZeroSup==kTRUE) return kTRUE;</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :   else                return kFALSE;</span>
<a name="316"><span class="lineNum">     316 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     317 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     
<span class="lineNum">     318 </span>            : void AliHMPIDRawStream::WriteRaw(TObjArray *pDigAll)
<span class="lineNum">     319 </span>            : {
<span class="lineNum">     320 </span>            : // Write a list of digits for a given chamber in raw data stream
<span class="lineNum">     321 </span>            : // Arguments: pDigAll- list of digits 
<span class="lineNum">     322 </span>            : //   Returns: none      
<span class="lineNum">     323 </span><span class="lineCov">          8 :   Int_t  ddl,r,d,a;            //32 bits data word </span>
<span class="lineNum">     324 </span>            :   Int_t  cntLpad,cntRpad;
<span class="lineNum">     325 </span>            :   Int_t  cntLrow,cntRrow;
<span class="lineNum">     326 </span>            :   Int_t  cntL=0,cntR=0;                           //data words counters for DDLs
<span class="lineNum">     327 </span>            :   Int_t  cntLeoe,cntReoe;
<span class="lineNum">     328 </span>            :   UInt_t posL,posR;
<span class="lineNum">     329 </span>            :   UInt_t cntLseg,cntRseg;
<span class="lineNum">     330 </span>            :   UInt_t cntwInLseg=0,cntwInRseg=0;
<span class="lineNum">     331 </span>            :   Int_t  cntRdig=0,cntLdig=0;
<span class="lineNum">     332 </span>            :   
<span class="lineNum">     333 </span>            :   UInt_t posLmarker,posRmarker;
<span class="lineNum">     334 </span>            :   //  Int_t digcnt=0;
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span><span class="lineCov">          4 :   Int_t isDigThere[14][25][11][48];</span>
<span class="lineNum">     337 </span>            :   
<span class="lineNum">     338 </span><span class="lineCov">         64 :   for(Int_t iCh=AliHMPIDParam::kMinCh;iCh&lt;=AliHMPIDParam::kMaxCh;iCh++){//chambers loop</span>
<span class="lineNum">     339 </span>            :     cntL=0;cntR=0;   
<span class="lineNum">     340 </span><span class="lineCov">        840 :     for(Int_t iddl=0;iddl&lt;14;iddl++){</span>
<span class="lineNum">     341 </span><span class="lineCov">      19600 :       for(Int_t irow=1;irow&lt;=24;irow++){</span>
<span class="lineNum">     342 </span><span class="lineCov">     206976 :         for(Int_t idil=1;idil&lt;=10;idil++){</span>
<span class="lineNum">     343 </span><span class="lineCov">    9219840 :           for(Int_t ipad=0;ipad&lt;48;ipad++){</span>
<span class="lineNum">     344 </span><span class="lineCov">    4515840 :             isDigThere[iddl][irow][idil][ipad]=-1;</span>
<span class="lineNum">     345 </span>            :           }
<span class="lineNum">     346 </span>            :         }
<span class="lineNum">     347 </span>            :       }
<span class="lineNum">     348 </span>            :     }
<span class="lineNum">     349 </span>            :     
<span class="lineNum">     350 </span>            :     AliFstream* ddlL;                                 //output streams, 2 per chamber
<span class="lineNum">     351 </span>            :     AliFstream* ddlR;                          
<span class="lineNum">     352 </span>            :     
<span class="lineNum">     353 </span><span class="lineCov">         28 :     AliRawDataHeaderSim header; header.SetAttribute(0);  //empty DDL header</span>
<span class="lineNum">     354 </span>            :     
<span class="lineNum">     355 </span><span class="lineCov">         56 :     ddlL = new AliFstream(AliDAQ::DdlFileName(&quot;HMPID&quot;,2*iCh+1)); //left and right looking at the IP</span>
<span class="lineNum">     356 </span><span class="lineCov">         56 :     ddlR = new AliFstream(AliDAQ::DdlFileName(&quot;HMPID&quot;,2*iCh));   //open both DDL of this chamber in parallel</span>
<span class="lineNum">     357 </span>            :     
<span class="lineNum">     358 </span><span class="lineCov">         28 :     ddlL-&gt;WriteBuffer((char*)&amp;header,sizeof(header));            //write dummy header as place holder, actual </span>
<span class="lineNum">     359 </span><span class="lineCov">         28 :     ddlR-&gt;WriteBuffer((char*)&amp;header,sizeof(header));            //will be rewritten later when total size of DDL is known</span>
<span class="lineNum">     360 </span>            :     
<span class="lineNum">     361 </span><span class="lineCov">         28 :     UInt_t w32=0;                 //32 bits data word </span>
<span class="lineNum">     362 </span>            :     //    digcnt=0;
<span class="lineNum">     363 </span>            :     
<span class="lineNum">     364 </span>            :     //added frimware control words
<span class="lineNum">     365 </span><span class="lineCov">         28 :     Write5FirmwareWords(ddlL);  cntL+=5;</span>
<span class="lineNum">     366 </span><span class="lineCov">         28 :     Write5FirmwareWords(ddlR);  cntR+=5;</span>
<span class="lineNum">     367 </span>            :    
<span class="lineNum">     368 </span>            :     
<span class="lineNum">     369 </span><span class="lineCov">         28 :     TClonesArray *pDigCh=(TClonesArray *)pDigAll-&gt;At(iCh); //list of digits for current chamber </span>
<span class="lineNum">     370 </span>            :    
<span class="lineNum">     371 </span><span class="lineCov">       1118 :     for(Int_t iDig=0;iDig&lt;pDigCh-&gt;GetEntriesFast();iDig++){//digits loop</span>
<span class="lineNum">     372 </span><span class="lineCov">        531 :       AliHMPIDDigit *pDig1=(AliHMPIDDigit*)pDigCh-&gt;At(iDig);</span>
<span class="lineNum">     373 </span><span class="lineCov">        531 :       pDig1-&gt;Raw(w32,ddl,r,d,a);  //??????????</span>
<span class="lineNum">     374 </span><span class="lineCov">        531 :       isDigThere[ddl][r][d][a]=iDig;</span>
<span class="lineNum">     375 </span>            :     }  
<span class="lineNum">     376 </span>            :     
<span class="lineNum">     377 </span><span class="lineCov">       1400 :     for(Int_t row = 1; row &lt;= AliHMPIDRawStream::kNRows; row++){ //AliHMPIDRawStream::kNRows=25!</span>
<span class="lineNum">     378 </span>            :       cntRrow=0;cntLrow=0;cntLseg=0;cntRseg=0;// 
<span class="lineNum">     379 </span>            :       cntLeoe=0;cntReoe=0;
<span class="lineNum">     380 </span><span class="lineCov">        672 :       posLmarker=ddlL-&gt;Tellp(); WriteRowMarker(ddlL,(UInt_t)1);   cntL++; cntRrow++; cntwInRseg++;</span>
<span class="lineNum">     381 </span><span class="lineCov">        672 :       posRmarker=ddlR-&gt;Tellp(); WriteRowMarker(ddlR,(UInt_t)1);   cntR++; cntLrow++; cntwInLseg++;</span>
<span class="lineNum">     382 </span><span class="lineCov">      14784 :       for(Int_t dil = 1; dil &lt;= AliHMPIDRawStream::kNDILOGICAdd; dil++){ //AliHMPIDRawStream::kNDILOGICAdd = 11!</span>
<span class="lineNum">     383 </span>            :         cntLpad=0;cntRpad=0;
<span class="lineNum">     384 </span><span class="lineCov">     658560 :         for(Int_t pad = 0; pad &lt; AliHMPIDRawStream::kNPadAdd; pad++){   //AliHMPIDRawStream::kNPadAdd     = 48</span>
<span class="lineNum">     385 </span><span class="lineCov">    1935360 :           for ( Int_t iddl=2*iCh; iddl&lt;=2*iCh+1;iddl++){</span>
<span class="lineNum">     386 </span><span class="lineCov">     645120 :             if (isDigThere[iddl][row][dil][pad]!=-1) {</span>
<span class="lineNum">     387 </span><span class="lineCov">        531 :               AliHMPIDDigit *pDig=(AliHMPIDDigit*)pDigCh-&gt;At(isDigThere[iddl][row][dil][pad]);             </span>
<span class="lineNum">     388 </span><span class="lineCov">        531 :               pDig-&gt;Raw(w32,ddl,r,d,a);  </span>
<span class="lineNum">     389 </span><span class="lineCov">        531 :               if(pDig-&gt;Q() &lt; 0 ) continue;                                                 //We can turn of the zero sup for pedestal simulation</span>
<span class="lineNum">     390 </span><span class="lineCov">        531 :                 if(ddl%2){                                                                               //write raw digit selecting on DDL</span>
<span class="lineNum">     391 </span><span class="lineCov">        131 :                 ddlL-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));   cntL++; cntLpad++; cntLrow++;  cntLdig++; cntwInLseg++;//Printf(&quot; WL: %x isDig: %d&quot;,w32,isDigThere[iddl][row][dil][pad]);</span>
<span class="lineNum">     392 </span><span class="lineCov">        131 :               }else{</span>
<span class="lineNum">     393 </span><span class="lineCov">        400 :                 ddlR-&gt;WriteBuffer((char*)&amp;w32,sizeof(w32));   cntR++; cntRpad++; cntRrow++;   cntRdig++;cntwInRseg++;//Printf(&quot; WR: %x isDig: %d&quot;,w32,isDigThere[iddl][row][dil][pad]);</span>
<span class="lineNum">     394 </span>            :               }
<span class="lineNum">     395 </span><span class="lineCov">        531 :             }//ddl </span>
<span class="lineNum">     396 </span>            :           }//isDig
<span class="lineNum">     397 </span>            :         }//pad
<span class="lineNum">     398 </span><span class="lineCov">       6720 :         WriteEoE(ddlL,row,dil,cntLpad); cntL++;  cntLrow++;    cntLeoe++;   cntwInLseg++;                              //molnarl: write EoE markers</span>
<span class="lineNum">     399 </span><span class="lineCov">       6720 :         WriteEoE(ddlR,row,dil,cntRpad); cntR++;  cntRrow++;    cntReoe++;   cntwInRseg++;</span>
<span class="lineNum">     400 </span>            :       }//dil
<span class="lineNum">     401 </span><span class="lineCov">        672 :       if(row%8==0){                                               </span>
<span class="lineNum">     402 </span><span class="lineCov">         84 :         WriteSegMarker(ddlL,row,cntwInLseg); cntL++;  cntLseg++; cntwInLseg=0;</span>
<span class="lineNum">     403 </span><span class="lineCov">         84 :         WriteSegMarker(ddlR,row,cntwInRseg); cntR++;  cntRseg++;  cntwInRseg=0; </span>
<span class="lineNum">     404 </span><span class="lineCov">         84 :       }</span>
<span class="lineNum">     405 </span><span class="lineCov">        672 :       posL=ddlL-&gt;Tellp();   ddlL-&gt;Seekp(posLmarker);    WriteRowMarker(ddlL,(UInt_t)(cntLrow-1)); ddlL-&gt;Seekp(posL);      //find the marker position write and  go back to the actual position to continue writing                    </span>
<span class="lineNum">     406 </span><span class="lineCov">        672 :       posR=ddlR-&gt;Tellp();   ddlR-&gt;Seekp(posRmarker);    WriteRowMarker(ddlR,(UInt_t)(cntRrow-1)); ddlR-&gt;Seekp(posR);                           </span>
<span class="lineNum">     407 </span>            :     }//row
<span class="lineNum">     408 </span><span class="lineCov">         56 :     header.fSize=sizeof(header)+cntL*sizeof(w32); ddlL-&gt;Seekp(0); ddlL-&gt;WriteBuffer((char*)&amp;header,sizeof(header)); delete ddlL; //rewrite header with size set to</span>
<span class="lineNum">     409 </span><span class="lineCov">         56 :     header.fSize=sizeof(header)+cntR*sizeof(w32); ddlR-&gt;Seekp(0); ddlR-&gt;WriteBuffer((char*)&amp;header,sizeof(header)); delete ddlR; //number of bytes and close file</span>
<span class="lineNum">     410 </span>            :     
<span class="lineNum">     411 </span>            :     //Printf(&quot;In Ch %d # digits written to LDD %d RDDL %d&quot;,iCh,cntLdig,cntRdig);
<span class="lineNum">     412 </span>            :     
<span class="lineNum">     413 </span><span class="lineCov">         28 :   }//chambers loop</span>
<a name="414"><span class="lineNum">     414 </span><span class="lineCov">          4 : }//WriteRaw()</span></a>
<span class="lineNum">     415 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     416 </span>            : Int_t AliHMPIDRawStream::GetErrors(Int_t ddl,Int_t eType)const
<span class="lineNum">     417 </span>            : {
<span class="lineNum">     418 </span>            : // Return the number of errors for a given error tye during raw data reading
<span class="lineNum">     419 </span>            : // Arguments: errorType
<span class="lineNum">     420 </span>            : // Returns: error or -999 if error Type does not exist
<span class="lineNum">     421 </span>            :   
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :   if(eType &lt; 0 || eType&gt; kSumErr ||  ddl &lt; 0 || ddl &gt; kNDDL-1 ) return -999;</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   else return fNumOfErr[ddl][eType];</span>
<a name="424"><span class="lineNum">     424 </span><span class="lineNoCov">          0 : } //GetErrors()     </span></a>
<span class="lineNum">     425 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     426 </span>            : const Char_t* AliHMPIDRawStream::GetErrName(Int_t eType)
<span class="lineNum">     427 </span>            : {
<span class="lineNum">     428 </span>            :   // Return the name of the error for a given error tye during raw data reading
<span class="lineNum">     429 </span>            :   // Arguments: errorType
<span class="lineNum">     430 </span>            :   // Returns: error or -999 if error Type does not exist
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   const Char_t *eName[]={ &quot;kRawDataSizeErr&quot;,  &quot;kRowMarkerErr&quot; , &quot;kWrongRowErr&quot; , &quot;kWrongDilogicErr&quot;,</span>
<span class="lineNum">     432 </span>            :                     &quot;kWrongPadErr&quot;   ,  &quot;kEoEFlagErr&quot;   , &quot;kEoESizeErr&quot;  , &quot;kEoEDILOGICErr&quot;,
<span class="lineNum">     433 </span>            :                     &quot;kEoERowErr&quot;     ,  &quot;kBadSegWordErr&quot;, &quot;kWrongSegErr&quot; , &quot;kRowMarkerSizeErr&quot;,
<span class="lineNum">     434 </span>            :                     &quot;kPedQZero&quot;      ,  &quot;kSumErr&quot;        };                       
<span class="lineNum">     435 </span>            :   const Char_t *eNoErr=&quot;NotDefinedErrorType&quot;;
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :   if(eType&lt;0 || eType&gt;kSumErr) return eNoErr;</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   else                         return eName[eType];</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 : }//GetErrName()</span>
<span class="lineNum">     439 </span>            : //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<span class="lineNum">     440 </span>            :     
<span class="lineNum">     441 </span>            :     
<span class="lineNum">     442 </span>            :     
<span class="lineNum">     443 </span>            : #endif
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
