<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TEvtGen/EvtGen/EvtGenModels/EvtVectorIsr.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">TEvtGen/EvtGen/EvtGenModels</a> - EvtVectorIsr.cpp<span style="font-size: 80%;"> (source / <a href="EvtVectorIsr.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">200</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">10</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : //--------------------------------------------------------------------------</a>
<span class="lineNum">       2 </span>            : //
<span class="lineNum">       3 </span>            : // Environment:
<span class="lineNum">       4 </span>            : //      This software is part of the EvtGen package developed jointly
<span class="lineNum">       5 </span>            : //      for the BaBar and CLEO collaborations.  If you use all or part
<span class="lineNum">       6 </span>            : //      of it, please give an appropriate acknowledgement.
<span class="lineNum">       7 </span>            : //
<span class="lineNum">       8 </span>            : // Copyright Information: See EvtGen/COPYRIGHT
<span class="lineNum">       9 </span>            : //      Copyright (C) 1998      Caltech, UCSB
<span class="lineNum">      10 </span>            : //
<span class="lineNum">      11 </span>            : // Module: EvtVectorIsr.cc
<span class="lineNum">      12 </span>            : //
<span class="lineNum">      13 </span>            : // Description: 
<span class="lineNum">      14 </span>            : //   This is a special decay model to generate e+e- -&gt; phi gamma + soft gammas
<span class="lineNum">      15 </span>            : //   using soft collinear ISR calculation from AfkQed
<span class="lineNum">      16 </span>            : //   This is implemented as a decay of the VPHO.
<span class="lineNum">      17 </span>            : //
<span class="lineNum">      18 </span>            : // Modification history:
<span class="lineNum">      19 </span>            : //
<span class="lineNum">      20 </span>            : //    Joe Izen        Oct, 2005             Soft Colinear Photons (secondary ISR) ported from AfkQed
<span class="lineNum">      21 </span>            : //    Joe Izen        Dec  16, 2002         Fix cos_theta distribution - prevents boom at cos_theta=+/-1 
<span class="lineNum">      22 </span>            : //    RYD/Adriano     June 16, 1998         Module created
<span class="lineNum">      23 </span>            : //
<span class="lineNum">      24 </span>            : //------------------------------------------------------------------------
<span class="lineNum">      25 </span>            : //
<span class="lineNum">      26 </span>            : #include &quot;EvtGenBase/EvtPatches.hh&quot;
<span class="lineNum">      27 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      31 </span>            : #include &lt;iomanip&gt;
<span class="lineNum">      32 </span>            : #include &lt;sstream&gt;
<span class="lineNum">      33 </span>            : 
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            : #include &quot;EvtGenBase/EvtParticle.hh&quot;
<span class="lineNum">      36 </span>            : #include &quot;EvtGenBase/EvtPhotonParticle.hh&quot;
<span class="lineNum">      37 </span>            : #include &quot;EvtGenBase/EvtRandom.hh&quot;
<span class="lineNum">      38 </span>            : #include &quot;EvtGenBase/EvtPDL.hh&quot;
<span class="lineNum">      39 </span>            : #include &quot;EvtGenBase/EvtAbsLineShape.hh&quot;
<span class="lineNum">      40 </span>            : #include &quot;EvtGenModels/EvtVectorIsr.hh&quot;
<span class="lineNum">      41 </span>            : #include &quot;EvtGenBase/EvtReport.hh&quot;
<span class="lineNum">      42 </span>            : #include &quot;EvtGenBase/EvtConst.hh&quot;
<span class="lineNum">      43 </span>            : #include &quot;EvtGenBase/EvtAbsLineShape.hh&quot;
<span class="lineNum">      44 </span>            : #include &lt;string&gt;
<a name="45"><span class="lineNum">      45 </span>            : #include &quot;EvtGenBase/EvtVector4C.hh&quot;</a>
<span class="lineNum">      46 </span>            : 
<a name="47"><span class="lineNum">      47 </span><span class="lineNoCov">          0 : EvtVectorIsr::~EvtVectorIsr() {}</span></a>
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : std::string EvtVectorIsr::getName(){
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span><span class="lineNoCov">          0 :   return &quot;VECTORISR&quot;;     </span>
<a name="52"><span class="lineNum">      52 </span>            : }</a>
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : EvtDecayBase* EvtVectorIsr::clone(){
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :   return new EvtVectorIsr;</span>
<a name="57"><span class="lineNum">      57 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : void EvtVectorIsr::init(){
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            :   // check that there are 2 arguments
<span class="lineNum">      62 </span>            :   
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   checkNDaug(2);</span>
<span class="lineNum">      64 </span>            :   
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   checkSpinParent(EvtSpinType::VECTOR);</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :   checkSpinDaughter(0,EvtSpinType::VECTOR);</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   checkSpinDaughter(1,EvtSpinType::PHOTON);</span>
<span class="lineNum">      68 </span>            : 
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   int narg = getNArg();</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   if ( narg &gt; 4 ) checkNArg(4);</span>
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   csfrmn=1.;</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   csbkmn=1.;</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :   fmax=1.2;</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   firstorder=false;</span>
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   if ( narg &gt; 0 ) csfrmn=getArg(0);</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :   if ( narg &gt; 1 ) csbkmn=getArg(1);</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :   if ( narg &gt; 2 ) fmax=getArg(2);</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :   if ( narg &gt; 3 ) firstorder=true;</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 : }</span>
<a name="82"><span class="lineNum">      82 </span>            : </a>
<span class="lineNum">      83 </span>            : 
<span class="lineNum">      84 </span>            : void EvtVectorIsr::initProbMax(){
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :   noProbMax();</span>
<a name="87"><span class="lineNum">      87 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            : void EvtVectorIsr::decay( EvtParticle *p ){
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            :   //the elctron mass
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :   double electMass=EvtPDL::getMeanMass(EvtPDL::getId(&quot;e-&quot;));</span>
<span class="lineNum">      93 </span>            : 
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :   static EvtId gammaId=EvtPDL::getId(&quot;gamma&quot;);</span>
<span class="lineNum">      95 </span>            : 
<span class="lineNum">      96 </span>            :   EvtParticle *phi;
<span class="lineNum">      97 </span>            :   EvtParticle *gamma;
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            :   //4-mom of the two colinear photons to the decay of the vphoton
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :   EvtVector4R p4softg1(0.,0.,0.,0.);</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :   EvtVector4R p4softg2(0.,0.,0.,0.);</span>
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            :   //get pointers to the daughters set
<span class="lineNum">     105 </span>            :   //get masses/initial phase space - will overwrite the
<span class="lineNum">     106 </span>            :   //p4s below to get the kinematic distributions correct
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   p-&gt;initializePhaseSpace(getNDaug(),getDaugs());</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :   phi=p-&gt;getDaug(0);</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   gamma=p-&gt;getDaug(1);</span>
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span>            :   //Generate soft colinear photons and the electron and positron energies after emission.
<span class="lineNum">     112 </span>            :   //based on method of AfkQed and notes of Vladimir Druzhinin.
<span class="lineNum">     113 </span>            :   //
<span class="lineNum">     114 </span>            :   //function ckhrad(eb,q2m,r1,r2,e01,e02,f_col)
<span class="lineNum">     115 </span>            :   //eb:      energy of incoming electrons in CM frame
<span class="lineNum">     116 </span>            :   //q2m:     minimum invariant mass of the virtual photon after soft colinear photon emission
<span class="lineNum">     117 </span>            :   //returned arguments
<span class="lineNum">     118 </span>            :   //e01,e02: energies of e+ and e- after soft colinear photon emission
<span class="lineNum">     119 </span>            :   //fcol:    weighting factor for Born cross section for use in an accept/reject test.
<span class="lineNum">     120 </span>            : 
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :   double wcm=p-&gt;mass();</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :   double eb=0.5*wcm;</span>
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span>            :   //TO guarantee the collinear photons are softer than the ISR photon, require q2m &gt; m*wcm
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :   double q2m=phi-&gt;mass()*wcm;</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   double f_col(0.);</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   double e01(0.);</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :   double e02(0.);</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :   double ebeam=eb;</span>
<span class="lineNum">     131 </span>            :   double wcm_new = wcm;
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   double s_new = wcm*wcm;</span>
<span class="lineNum">     133 </span>            : 
<span class="lineNum">     134 </span>            :   double fran = 1.;
<span class="lineNum">     135 </span>            :   double f = 0;
<span class="lineNum">     136 </span>            :   int m = 0;
<span class="lineNum">     137 </span>            :   double largest_f=0;//only used when determining max weight for this vector particle mass
<span class="lineNum">     138 </span>            :     
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :   if (!firstorder){</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :     while (fran &gt; f){</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :       m++;    </span>
<span class="lineNum">     142 </span>            :     
<span class="lineNum">     143 </span>            :       int n=0;
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :       while (f_col == 0.){</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :         n++;</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :         ckhrad(eb,q2m,e01,e02,f_col);</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :         if (n &gt; 10000){</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :           report(Severity::Info,&quot;EvtGen&quot;) &lt;&lt; &quot;EvtVectorIsr is having problems. Called ckhrad 10000 times.\n&quot;;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :           assert(0);</span>
<span class="lineNum">     150 </span>            :         }
<span class="lineNum">     151 </span>            :       }
<span class="lineNum">     152 </span>            :     
<span class="lineNum">     153 </span>            :       //Effective beam energy after soft photon emission (neglecting electron mass)
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :       ebeam = sqrt(e01*e02);</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :       wcm_new = 2*ebeam;</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :       s_new = wcm_new*wcm_new;</span>
<span class="lineNum">     157 </span>            :     
<span class="lineNum">     158 </span>            :       //The Vector mass should never be greater than wcm_new
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :       if (phi-&gt;mass() &gt; wcm_new){</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :         report(Severity::Info,&quot;EvtGen&quot;) &lt;&lt; &quot;EvtVectorIsr finds Vector mass=&quot;&lt;&lt;phi-&gt;mass()&lt;&lt;&quot; &gt; Weff=&quot; &lt;&lt; wcm_new&lt;&lt;&quot;.  Should not happen\n&quot;;</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :         assert(0);</span>
<span class="lineNum">     162 </span>            :       }
<span class="lineNum">     163 </span>            :  
<span class="lineNum">     164 </span>            :       //Determine Born cross section @ wcm_new for e+e- -&gt; gamma V.  We aren't interested in the absolute normalization
<span class="lineNum">     165 </span>            :       //Just the functional dependence. Assuming a narrow resonance when determining cs_Born
<span class="lineNum">     166 </span>            :       double cs_Born = 1.;
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :       if (EvtPDL::getMaxRange(phi-&gt;getId()) &gt; 0.) {</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :         double x0 = 1 - EvtPDL::getMeanMass(phi-&gt;getId())*EvtPDL::getMeanMass(phi-&gt;getId())/s_new;</span>
<span class="lineNum">     169 </span>            :       
<span class="lineNum">     170 </span>            :         //L = log(s/(electMass*electMass)  
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :         double L = 2.*log(wcm_new/electMass);</span>
<span class="lineNum">     172 </span>            :       
<span class="lineNum">     173 </span>            :         // W(x0) is actually 2*alpha/pi times the following
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :         double W = (L-1.)*(1. - x0 +0.5*x0*x0);</span>
<span class="lineNum">     175 </span>            :       
<span class="lineNum">     176 </span>            :         //Born cross section is actually 12*pi*pi*Gammaee/EvtPDL::getMeanMass(phi-&gt;getId()) times the following
<span class="lineNum">     177 </span>            :         //(we'd need the full W(x0) as well)
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :         cs_Born = W/s_new;</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     180 </span>            :     
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :       f = cs_Born*f_col;</span>
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span>            :       //if fmax was set properly, f should NEVER be larger than fmax
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :       if (f &gt; fmax &amp;&amp; fmax &gt; 0.){</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :           report(Severity::Info,&quot;EvtGen&quot;) &lt;&lt; &quot;EvtVectorIsr finds a problem with fmax, the maximum weight setting\n&quot;</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;fmax is the third decay argument in the .dec file. VectorIsr attempts to set it reasonably if it wasn't provided\n&quot;</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;To determine a more appropriate value, build GeneratorQAApp, and set the third argument for this decay &lt;0.\n&quot;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;If you haven't been providing the first 2 arguments, set them to be 1. 1.). The program will report\n&quot;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;the largest weight it finds.  You should set fmax to be slightly larger.\n&quot;</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;Alternatively try the following values for various vector particles: &quot;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;phi-&gt;1.15   J/psi-psi(4415)-&gt;0.105\n&quot;</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;The current value of f and fmax for &quot; &lt;&lt; EvtPDL::name(phi-&gt;getId()) &lt;&lt; &quot; are &quot; &lt;&lt; f &lt;&lt; &quot;  &quot; &lt;&lt; fmax &lt;&lt; &quot;\n&quot;</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot;Will now assert\n&quot;;</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :         assert(0);</span>
<span class="lineNum">     195 </span>            :       }
<span class="lineNum">     196 </span>            :  
<span class="lineNum">     197 </span>            : 
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :       if (fmax &gt; 0.) {</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :         fran = fmax*EvtRandom::Flat(0.0,1.0);</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     201 </span>            :     
<span class="lineNum">     202 </span>            :       else {
<span class="lineNum">     203 </span>            :         //determine max weight for this vector particle mass
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :         if (f&gt;largest_f) {</span>
<span class="lineNum">     205 </span>            :           largest_f = f;
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :           report(Severity::Info,&quot;EvtGen&quot;)  &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt;  EvtPDL::name(phi-&gt;getId()) &lt;&lt; &quot; &quot;</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot;vector_mass &quot; </span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot; &quot; &lt;&lt; EvtPDL::getMeanMass(phi-&gt;getId()) &lt;&lt; &quot;  fmax should be at least &quot; &lt;&lt; largest_f </span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot;.        f_col cs_B = &quot; &lt;&lt; f_col &lt;&lt; &quot; &quot; &lt;&lt; cs_Born </span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :                &lt;&lt; std::endl;</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         if (m%10000 == 0) {  </span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :           report(Severity::Info,&quot;EvtGen&quot;) &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt;  EvtPDL::name(phi-&gt;getId()) &lt;&lt; &quot; &quot;</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot;vector_mass &quot; </span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot; &quot; &lt;&lt; EvtPDL::getMeanMass(phi-&gt;getId()) &lt;&lt; &quot;  fmax should be at least &quot; &lt;&lt; largest_f </span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :                &lt;&lt; &quot;.        f_col cs_B = &quot; &lt;&lt; f_col &lt;&lt; &quot; &quot; &lt;&lt; cs_Born </span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :                &lt;&lt; std::endl;</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     219 </span>            :       
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :         f_col = 0.;</span>
<span class="lineNum">     221 </span>            :         f = 0.;
<span class="lineNum">     222 </span>            :         //determine max weight for this vector particle mass
<span class="lineNum">     223 </span>            :       }
<span class="lineNum">     224 </span>            :     
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :       if (m &gt; 100000){</span>
<span class="lineNum">     226 </span>            :       
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :         if (fmax &gt; 0.) report(Severity::Info,&quot;EvtGen&quot;) &lt;&lt; &quot;EvtVectorIsr is having problems. Check the fmax value - the 3rd argument in the .dec file\n&quot;</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :                                              &lt;&lt; &quot;Recommended values for various vector particles: &quot;</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :                                              &lt;&lt; &quot;phi-&gt;1.15   J/psi-psi(4415)-&gt;0.105   &quot;</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :                                              &lt;&lt; &quot;Upsilon(1S,2S,3S)-&gt;0.14\n&quot;;</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         assert(0);</span>
<span class="lineNum">     232 </span>            :       }
<span class="lineNum">     233 </span>            :     }//while (fran &gt; f)
<span class="lineNum">     234 </span>            :   
<span class="lineNum">     235 </span>            :   }//if (firstorder)
<span class="lineNum">     236 </span>            :   
<span class="lineNum">     237 </span>            :   //Compute parameters for boost to/from the system after colinear radiation
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span>            :   double bet_l;
<span class="lineNum">     240 </span>            :   double gam_l;
<span class="lineNum">     241 </span>            :   double betgam_l;
<span class="lineNum">     242 </span>            :   
<span class="lineNum">     243 </span>            :   double csfrmn_new;
<span class="lineNum">     244 </span>            :   double csbkmn_new;
<span class="lineNum">     245 </span>            : 
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   if (firstorder){</span>
<span class="lineNum">     247 </span>            :     bet_l = 0.;
<span class="lineNum">     248 </span>            :     gam_l = 1.;
<span class="lineNum">     249 </span>            :     betgam_l = 0.;
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :     csfrmn_new = csfrmn;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :     csbkmn_new = csbkmn;</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   } else {  </span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :     double xx       = e02/e01;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :     double sq_xx    = sqrt(xx);</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :     bet_l    = (1.-xx)/(1.+xx);</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :     gam_l    = (1.+xx)/(2.*sq_xx);</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :     betgam_l = (1.-xx)/(2.*sq_xx);</span>
<span class="lineNum">     258 </span>            :   
<span class="lineNum">     259 </span>            :     //Boost photon cos_theta limits in lab to limits in the system after colinear rad
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :     csfrmn_new=(csfrmn - bet_l)/(1. - bet_l*csfrmn);</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :     csbkmn_new=(csbkmn - bet_l)/(1. - bet_l*csbkmn);</span>
<span class="lineNum">     262 </span>            :   }
<span class="lineNum">     263 </span>            :  
<span class="lineNum">     264 </span>            : //    //generate kinematics according to Bonneau-Martin article
<span class="lineNum">     265 </span>            : //    //Nucl. Phys. B27 (1971) 381-397
<span class="lineNum">     266 </span>            : 
<span class="lineNum">     267 </span>            :   // For backward compatibility with .dec files before SP5, the backward cos limit for
<span class="lineNum">     268 </span>            :   //the ISR photon is actually given as *minus* the actual limit. Sorry, this wouldn't be
<span class="lineNum">     269 </span>            :   //my choice.  -Joe
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span>            :    //gamma momentum in the vpho restframe *after* soft colinear radiation
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   double pg = (s_new - phi-&gt;mass()*phi-&gt;mass())/(2.*wcm_new);</span>
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span>            : 
<span class="lineNum">     275 </span>            :   //calculate the beta of incoming electrons after  colinear rad in the frame where e= and e- have equal momentum
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   double beta=electMass/ebeam; //electMass/Ebeam = 1/gamma</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :   beta=sqrt(1. - beta*beta);   //sqrt (1 - (1/gamma)**2)</span>
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :   double ymax=log((1.+beta*csfrmn_new)/(1.-beta*csfrmn_new));</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :   double ymin=log((1.-beta*csbkmn_new)/(1.+beta*csbkmn_new));</span>
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span>            :   // photon theta distributed as  2*beta/(1-beta**2*cos(theta)**2)
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   double y=(ymax-ymin)*EvtRandom::Flat(0.0,1.0) + ymin;</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   double cs=exp(y);</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   cs=(cs - 1.)/(cs + 1.)/beta;</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   double sn=sqrt(1-cs*cs);</span>
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   double fi=EvtRandom::Flat(EvtConst::twoPi);</span>
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            :   //four-vector for the phi
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :   double phi_p0 = sqrt(phi-&gt;mass()*phi-&gt;mass()+pg*pg);</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :   double phi_p3 = -pg*cs;</span>
<span class="lineNum">     293 </span>            : 
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span>            :   //boost back to frame before colinear radiation.
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :   EvtVector4R p4phi(gam_l*phi_p0 + betgam_l*phi_p3,</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :                     -pg*sn*cos(fi),</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :                     -pg*sn*sin(fi),</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :                     betgam_l*phi_p0 + gam_l*phi_p3);</span>
<span class="lineNum">     300 </span>            : 
<span class="lineNum">     301 </span>            :   double isr_p0 = pg;
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   double isr_p3 = -phi_p3;</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :   EvtVector4R p4gamma(gam_l*isr_p0 + betgam_l*isr_p3,</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :                       -p4phi.get(1),</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :                       -p4phi.get(2),</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :                       betgam_l*isr_p0 + gam_l*isr_p3);</span>
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span>            :   
<span class="lineNum">     309 </span>            :   //four-vectors of the collinear photons
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :   if (!firstorder) {</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :     p4softg1.set(0, eb-e02);    p4softg1.set(3, e02-eb);</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :     p4softg2.set(0, eb-e01);    p4softg2.set(3, eb-e01);</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     314 </span>            :   
<span class="lineNum">     315 </span>            :   //save momenta for particles
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :   phi-&gt;init( getDaug(0),p4phi);</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :   gamma-&gt;init( getDaug(1),p4gamma);</span>
<span class="lineNum">     318 </span>            : 
<span class="lineNum">     319 </span>            : 
<span class="lineNum">     320 </span>            :   //add the two colinear photons as vphoton daughters
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :   EvtPhotonParticle *softg1=new EvtPhotonParticle;;</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :   EvtPhotonParticle *softg2=new EvtPhotonParticle;;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   softg1-&gt;init(gammaId,p4softg1);</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :   softg2-&gt;init(gammaId,p4softg2);</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :   softg1-&gt;addDaug(p);</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :   softg2-&gt;addDaug(p);</span>
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span>            :   //try setting the spin density matrix of the phi
<span class="lineNum">     329 </span>            :   //get polarization vector for phi in its parents restframe.
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   EvtVector4C phi0=phi-&gt;epsParent(0);</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :   EvtVector4C phi1=phi-&gt;epsParent(1);</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   EvtVector4C phi2=phi-&gt;epsParent(2);</span>
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span>            :   //get polarization vector for a photon in its parents restframe.
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :   EvtVector4C gamma0=gamma-&gt;epsParentPhoton(0);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   EvtVector4C gamma1=gamma-&gt;epsParentPhoton(1);</span>
<span class="lineNum">     337 </span>            : 
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :   EvtComplex r1p=phi0*gamma0;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :   EvtComplex r2p=phi1*gamma0;</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :   EvtComplex r3p=phi2*gamma0;</span>
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span>            : 
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :   EvtComplex r1m=phi0*gamma1;</span>
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :   EvtComplex r2m=phi1*gamma1;</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :   EvtComplex r3m=phi2*gamma1;</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   EvtComplex rho33=r3p*conj(r3p)+r3m*conj(r3m);</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   EvtComplex rho22=r2p*conj(r2p)+r2m*conj(r2m);</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   EvtComplex rho11=r1p*conj(r1p)+r1m*conj(r1m);</span>
<span class="lineNum">     350 </span>            : 
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :   EvtComplex rho13=r3p*conj(r1p)+r3m*conj(r1m);</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :   EvtComplex rho12=r2p*conj(r1p)+r2m*conj(r1m);</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :   EvtComplex rho23=r3p*conj(r2p)+r3m*conj(r2m);</span>
<span class="lineNum">     354 </span>            : 
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :   EvtComplex rho31=conj(rho13);</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :   EvtComplex rho32=conj(rho23);</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :   EvtComplex rho21=conj(rho12);</span>
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :   EvtSpinDensity rho;</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :   rho.setDim(3);</span>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   rho.set(0,0,rho11);</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   rho.set(0,1,rho12);</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   rho.set(0,2,rho13);</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :   rho.set(1,0,rho21);</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   rho.set(1,1,rho22);</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :   rho.set(1,2,rho23);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :   rho.set(2,0,rho31);</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :   rho.set(2,1,rho32);</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   rho.set(2,2,rho33);</span>
<span class="lineNum">     372 </span>            : 
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :   setDaughterSpinDensity(0);</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :   phi-&gt;setSpinDensityForward(rho);</span>
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span>            :   return ;
<a name="377"><span class="lineNum">     377 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     378 </span>            : 
<span class="lineNum">     379 </span>            : double EvtVectorIsr::ckhrad1(double xx, double a, double b){
<span class="lineNum">     380 </span>            :   //port of AfkQed/ckhrad.F function ckhrad1
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :   double yy = xx*xx; </span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :   double zz = 1. - 2*xx + yy; </span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   return  0.5* (1. + yy + zz/(a-1.) + 0.25*b*( -0.5*(1. + 3*yy)*log(xx)) - zz  );</span>
<a name="384"><span class="lineNum">     384 </span>            : }</a>
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span>            : void EvtVectorIsr::ckhrad(const double&amp; e_beam,const double&amp; q2_min,double&amp; e01,double&amp; e02,double&amp; f){
<span class="lineNum">     387 </span>            :   //port of AfkQed/ckhrad.F subroutine ckhrad
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :   const double adp   = 1. / 137.0359895 / EvtConst::pi;</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   const double pi2   = EvtConst::pi*EvtConst::pi;</span>
<span class="lineNum">     390 </span>            :   //  const double dme   = 0.00051099906;
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   const double dme   = EvtPDL::getMeanMass(EvtPDL::getId(&quot;e-&quot;));</span>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   double r1=EvtRandom::Flat();//Generates Flat from 0 - 1</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   double r2=EvtRandom::Flat();</span>
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :   double sss    = 4.*e_beam*e_beam;</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   double biglog = log(sss/(dme*dme));</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :   double beta   = 2.*adp*(biglog - 1.);</span>
<span class="lineNum">     399 </span>            :   double betae_lab = beta;
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   double p3     = adp*(pi2/3. - 0.5);</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   double p12    = adp*adp * (11./8. - 2.*pi2/3.);</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   double coefener =  1. + 0.75*betae_lab + p3;</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :   double coef1 = coefener + 0.125*pi2*beta*beta;</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :   double coef2 = p12* biglog*biglog;</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   double facts  = coef1 + coef2; </span>
<span class="lineNum">     406 </span>            :   
<span class="lineNum">     407 </span>            :   double y1_min = 0;
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   double e1min  = 0.25 * q2_min/e_beam; </span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   double y1_max = pow( 1. - e1min/e_beam, 0.5*beta );</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :   double y1     = y1_min +r1 *(y1_max - y1_min);</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :   e01           = e_beam *(1. - pow(y1, 2./beta) );</span>
<span class="lineNum">     412 </span>            :   
<span class="lineNum">     413 </span>            :   double y2_min = 0.;
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :   double e2min  = 0.25 * q2_min/e01; </span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   double y2_max = pow( 1. - e2min/e_beam, 0.5*beta);</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   double y2     = y2_min +r2 *(y2_max - y2_min);</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :   e02           = e_beam *(1. - pow(y2, 2./beta) );</span>
<span class="lineNum">     418 </span>            :   
<span class="lineNum">     419 </span>            : 
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :   double xx1 = e01/e_beam;</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :   double xx2 = e02/e_beam;</span>
<span class="lineNum">     422 </span>            : 
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :   f = y1_max * y2_max * ckhrad1(xx1,biglog,betae_lab) * ckhrad1(xx2,biglog,betae_lab) * facts;</span>
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span>            :   return;
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :  }</span>
<span class="lineNum">     427 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
