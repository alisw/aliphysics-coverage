<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TEvtGen/Photos/src/photosFortranInterfaces/PH_HEPEVT_Interface.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">TEvtGen/Photos/src/photosFortranInterfaces</a> - PH_HEPEVT_Interface.cxx<span style="font-size: 80%;"> (source / <a href="PH_HEPEVT_Interface.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">219</td>
            <td class="headerCovTableEntryLo">0.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntryLo">12.5 %</td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : #include &lt;vector&gt;</a>
<span class="lineNum">       2 </span>            : #include &lt;cmath&gt;
<span class="lineNum">       3 </span>            : #include &quot;PhotosBranch.h&quot;
<span class="lineNum">       4 </span>            : #include &quot;PhotosParticle.h&quot;
<span class="lineNum">       5 </span>            : #include &quot;PH_HEPEVT_Interface.h&quot;
<span class="lineNum">       6 </span>            : #include &quot;Log.h&quot;
<span class="lineNum">       7 </span>            : using namespace std;
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : namespace Photospp
<a name="10"><span class="lineNum">      10 </span>            : {</a>
<span class="lineNum">      11 </span>            : 
<span class="lineNum">      12 </span><span class="lineCov">          6 : vector&lt;PhotosParticle*&gt; PH_HEPEVT_Interface::m_particle_list;</span>
<span class="lineNum">      13 </span>            : int PH_HEPEVT_Interface::ME_channel=0;
<a name="14"><span class="lineNum">      14 </span>            : int PH_HEPEVT_Interface::decay_idx=0;</a>
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : void PH_HEPEVT_Interface::clear(){
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span><span class="lineNoCov">          0 :   m_particle_list.clear();</span>
<span class="lineNum">      19 </span>            : 
<span class="lineNum">      20 </span><span class="lineNoCov">          0 :   hep.nevhep=0; </span>
<span class="lineNum">      21 </span><span class="lineNoCov">          0 :   hep.nhep=0;</span>
<span class="lineNum">      22 </span>            :   
<span class="lineNum">      23 </span>            : 
<span class="lineNum">      24 </span>            :   /**  for(int i=0; i &lt; NMXHEP; i++){
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            :     hep.isthep[i]=0;
<span class="lineNum">      27 </span>            :     hep.idhep[i]=0;
<span class="lineNum">      28 </span>            :     
<span class="lineNum">      29 </span>            :     for(int j=0; j&lt;2; j++){
<span class="lineNum">      30 </span>            :       hep.jmohep[i][j]=0;
<span class="lineNum">      31 </span>            :       hep.jdahep[i][j]=0;
<span class="lineNum">      32 </span>            :     }
<span class="lineNum">      33 </span>            :     
<span class="lineNum">      34 </span>            :     for(int j=0; j&lt;5; j++)
<span class="lineNum">      35 </span>            :       hep.phep[i][j]=0;
<span class="lineNum">      36 </span>            :     
<span class="lineNum">      37 </span>            :     for(int j=0; j&lt;4; j++)
<span class="lineNum">      38 </span>            :       hep.vhep[i][j]=0;
<span class="lineNum">      39 </span>            :   
<span class="lineNum">      40 </span>            :       ph_phoqed_.qedrad[i]=0;
<span class="lineNum">      41 </span>            :   
<span class="lineNum">      42 </span>            :       }**/
<a name="43"><span class="lineNum">      43 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : void PH_HEPEVT_Interface::add_particle(int i,PhotosParticle * particle,
<span class="lineNum">      46 </span>            :                                        int first_mother, int last_mother,
<span class="lineNum">      47 </span>            :                                        int first_daughter, int last_daughter){
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :   if(i&gt;0)</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 :     i--; //account for fortran indicies begining at 1</span>
<span class="lineNum">      51 </span>            :   else
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :     Log::Warning()&lt;&lt;&quot;Index given to PH_HEPEVT_Interface::add_particle &quot;</span>
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot;is too low (it must be &gt; 0).&quot;&lt;&lt;endl;</span>
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            :   //add to our internal list of pointer/index pairs
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :   m_particle_list.push_back(particle);</span>
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            :   //now set the element of PH_HEPEVT
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :   hep.nevhep=0; //dummy</span>
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :   hep.nhep = hep.nhep + 1; // 1.II.2014: fix for gcc 4.8.1. Previously it was:</span>
<span class="lineNum">      61 </span>            :                            // hep.nhep = hep.nhep++; which technically is an undefined operation
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :   hep.isthep[i]=particle-&gt;getStatus();</span>
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   hep.idhep[i]=particle-&gt;getPdgID();</span>
<span class="lineNum">      64 </span>            : 
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   hep.jmohep[i][0]=first_mother;</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :   hep.jmohep[i][1]=last_mother;</span>
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   hep.jdahep[i][0]=first_daughter;</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   hep.jdahep[i][1]=last_daughter;</span>
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :   hep.phep[i][0]=particle-&gt;getPx();</span>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   hep.phep[i][1]=particle-&gt;getPy();</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   hep.phep[i][2]=particle-&gt;getPz();</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :   hep.phep[i][3]=particle-&gt;getE();</span>
<span class="lineNum">      75 </span>            :   
<span class="lineNum">      76 </span>            :   // if massFrom4Vector=true (default) - get sqrt(e^2-p^2)
<span class="lineNum">      77 </span>            :   // otherwise - get mass from event record
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :   if(!Photos::massFrom4Vector) hep.phep[i][4]=particle-&gt;getMass();</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :   else                         hep.phep[i][4]=particle-&gt;getVirtuality();</span>
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   int pdgid = abs(particle-&gt;getPdgID());</span>
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span>            :   // if 'forceMass' for this PDGID was used - overwrite mass
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :   if(Photos::forceMassList)</span>
<span class="lineNum">      85 </span>            :   {
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :     for(unsigned int j=0;j&lt;Photos::forceMassList-&gt;size();j++)</span>
<span class="lineNum">      87 </span>            :     {
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :       if(pdgid == abs(Photos::forceMassList-&gt;at(j)-&gt;first))</span>
<span class="lineNum">      89 </span>            :       {
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :         double mass = Photos::forceMassList-&gt;at(j)-&gt;second;</span>
<span class="lineNum">      91 </span>            :         
<span class="lineNum">      92 </span>            :         // when 'forceMass' is used the mass provided is larger than 0.0
<span class="lineNum">      93 </span>            :         // when 'forceMassFromEventRecord' is used mass is -1.0
<span class="lineNum">      94 </span>            :         // in this case - get mass from event record
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :         if(mass&lt;0.0) mass = particle-&gt;getMass();</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :         hep.phep[i][4] = mass;</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">      98 </span>            :     }
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :   hep.vhep[i][0]=0;</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :   hep.vhep[i][1]=0;</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :   hep.vhep[i][2]=0;</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   hep.vhep[i][3]=0;</span>
<span class="lineNum">     105 </span>            : 
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   hep.qedrad[i]=1;</span>
<span class="lineNum">     107 </span>            : 
<a name="108"><span class="lineNum">     108 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     109 </span>            : 
<span class="lineNum">     110 </span>            : int PH_HEPEVT_Interface::set(PhotosBranch *branch)
<span class="lineNum">     111 </span>            : {
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :         PH_HEPEVT_Interface::clear();</span>
<span class="lineNum">     113 </span>            :         int idx=1;
<span class="lineNum">     114 </span>            : 
<span class="lineNum">     115 </span>            :         //get mothers
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :         vector&lt;PhotosParticle *&gt; mothers = branch-&gt;getMothers();</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :         int nmothers=mothers.size();</span>
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span>            :         //check if mid-particle exist
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :         decay_idx=0;</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :         PhotosParticle *decay_particle = branch-&gt;getDecayingParticle();</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :         if(decay_particle) decay_idx=nmothers+1;</span>
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span>            :         //get daughters
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :         vector&lt;PhotosParticle *&gt; daughters = branch-&gt;getDaughters();</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :         int ndaughters=daughters.size();</span>
<span class="lineNum">     127 </span>            : 
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :         for(int i=0;i&lt;nmothers;i++)</span>
<span class="lineNum">     129 </span>            :         {
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :                 if(decay_idx)</span>
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :                         add_particle(idx++,mothers.at(i),</span>
<span class="lineNum">     132 </span>            :                                      0,0, //mothers
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :                                      decay_idx,decay_idx); //daughters</span>
<span class="lineNum">     134 </span>            :                 else
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :                         add_particle(idx++,mothers.at(i),</span>
<span class="lineNum">     136 </span>            :                                      0,0, //mothers
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :                                      nmothers+1,nmothers+ndaughters); //daughters</span>
<span class="lineNum">     138 </span>            :         }
<span class="lineNum">     139 </span>            : 
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :         if(decay_particle)</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :                 add_particle(idx++,decay_particle,</span>
<span class="lineNum">     142 </span>            :                              1,nmothers, //mothers
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :                              nmothers+2,nmothers+1+ndaughters); //daughters</span>
<span class="lineNum">     144 </span>            : 
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :         for(int i=0;i&lt;ndaughters;i++)</span>
<span class="lineNum">     146 </span>            :         {
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :                 if(decay_idx)</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :                         add_particle(idx++,daughters.at(i),</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :                                      decay_idx,decay_idx, //mothers</span>
<span class="lineNum">     150 </span>            :                                      0,0); //daughters
<span class="lineNum">     151 </span>            :                 else
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :                         add_particle(idx++,daughters.at(i),</span>
<span class="lineNum">     153 </span>            :                                      1,nmothers, //mothers
<span class="lineNum">     154 </span>            :                                      0,0); //daughters
<span class="lineNum">     155 </span>            :         }
<span class="lineNum">     156 </span>            :         //Log::RedirectOutput( phodmp_ , Log::Debug(1000) );
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :         Log::Debug(1000,false)&lt;&lt;&quot;PH_HEPEVT returning: &quot;&lt;&lt;( (decay_idx) ? decay_idx : 1 )&lt;&lt;&quot; from &quot;&lt;&lt;idx-1&lt;&lt;&quot; particles.&quot;&lt;&lt;endl;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :         return (decay_idx) ? decay_idx : 1;</span>
<a name="159"><span class="lineNum">     159 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            : void PH_HEPEVT_Interface::get(){
<span class="lineNum">     162 </span>            : 
<span class="lineNum">     163 </span>            :   int index = 0;
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            :   //if no photons have been added to the event record, do nothing.
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   if(hep.nhep == (int) m_particle_list.size())</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     168 </span>            : 
<span class="lineNum">     169 </span>            :   //phodmp_();
<span class="lineNum">     170 </span>            : 
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :   int  particle_count  = m_particle_list.size();</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :   int  daughters_start = hep.jmohep[hep.nhep-1][0];</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   int  photons         = hep.nhep - m_particle_list.size();</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :   bool isPhotonCreated = (photons&gt;0);</span>
<span class="lineNum">     175 </span>            :   
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   std::vector&lt;PhotosParticle*&gt; photon_list; // list of added photons</span>
<span class="lineNum">     177 </span>            :                                             // which need kinematical treatment
<span class="lineNum">     178 </span>            :                                             // in special case
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span>            :   // we decipher daughters_start from  last entry 
<span class="lineNum">     181 </span>            :   // that is last daughter in  ph_hepevt_
<span class="lineNum">     182 </span>            :   // another option of this functionality may be 
<span class="lineNum">     183 </span>            :   // hep.jdahep[ hep.jmohep[hep.nhep-1][0]-1][0];
<span class="lineNum">     184 </span>            :   // Update daughters_start if there are two mothers
<span class="lineNum">     185 </span>            :   // NOTE: daughters_start is index for C++ arrays, while hep.jmohep
<span class="lineNum">     186 </span>            :   //       contains indices for Fortran arrays.
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   if(hep.jmohep[hep.nhep-1][1]&gt;0)</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :     daughters_start = hep.jmohep[hep.nhep-1][1];</span>
<span class="lineNum">     189 </span>            :   
<span class="lineNum">     190 </span>            :   index = particle_count;
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            :   // Add extra photons
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :   for(;photons&gt;0; photons--, index++){</span>
<span class="lineNum">     194 </span>            :     
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :     if(hep.idhep[index]!=PhotosParticle::GAMMA)</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :       Log::Fatal(&quot;PH_HEPEVT_Interface::get(): Extra particle added to the PH_HEPEVT common block in not a photon!&quot;,6);</span>
<span class="lineNum">     197 </span>            :     
<span class="lineNum">     198 </span>            :     //create a new particle
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :     PhotosParticle * new_photon;</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :     new_photon = m_particle_list.at(0)-&gt;createNewParticle(hep.idhep[index],</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :                                                           hep.isthep[index],</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :                                                           hep.phep[index][4],</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :                                                           hep.phep[index][0],</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :                                                           hep.phep[index][1],</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :                                                           hep.phep[index][2],</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :                                                           hep.phep[index][3]);</span>
<span class="lineNum">     207 </span>            :     
<span class="lineNum">     208 </span>            :     //add into the event record
<span class="lineNum">     209 </span>            :     //get mother particle of photon
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :     PhotosParticle * mother =  m_particle_list.at(hep.jmohep[index][0]-1);</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :     mother-&gt;addDaughter(new_photon);</span>
<span class="lineNum">     212 </span>            :     
<span class="lineNum">     213 </span>            :     //add to list of photons
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :     photon_list.push_back(new_photon);</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span>            :   // Before we update particles, we check for special cases
<span class="lineNum">     218 </span>            :   // At this step, particles are yet unmodified
<span class="lineNum">     219 </span>            :   // but photons are already in the event record
<span class="lineNum">     220 </span>            :   bool special=false;
<span class="lineNum">     221 </span>            :   PhotosParticle *p1 = NULL;
<span class="lineNum">     222 </span>            :   PhotosParticle *p2 = NULL;
<span class="lineNum">     223 </span>            : 
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :   if( isPhotonCreated )</span>
<span class="lineNum">     225 </span>            :   {
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :     std::vector&lt;PhotosParticle*&gt; daughters;</span>
<span class="lineNum">     227 </span>            : 
<span class="lineNum">     228 </span>            :     // in the following we create list of   daughters,
<span class="lineNum">     229 </span>            :     // later  we calculate bool special which is true only if all
<span class="lineNum">     230 </span>            :     // daughters self-decay
<span class="lineNum">     231 </span>            :     // at peresent warning for  mixed self-decay and not self decay 
<span class="lineNum">     232 </span>            :     // daughters is not printed.
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     for(int i=daughters_start;i&lt;particle_count;i++)</span>
<span class="lineNum">     235 </span>            :     {
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :       PhotosParticle *p = m_particle_list.at(i);</span>
<span class="lineNum">     237 </span>            : 
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :       daughters.push_back(p);</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            :     // Check if this is a special case
<span class="lineNum">     242 </span>            :     special = true;
<span class="lineNum">     243 </span>            :     
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     if(daughters.size()==0) special = false;</span>
<span class="lineNum">     245 </span>            :     
<span class="lineNum">     246 </span>            :     // special = false if there is a stable particle on the list
<span class="lineNum">     247 </span>            :     //                 or there is a particle without self-decay
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     for(unsigned int i=0;i&lt;daughters.size();i++)</span>
<span class="lineNum">     249 </span>            :     {
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       if(daughters[i]-&gt;getStatus()==1)</span>
<span class="lineNum">     251 </span>            :       {
<span class="lineNum">     252 </span>            :         special = false;
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     254 </span>            :       }
<span class="lineNum">     255 </span>            :       
<span class="lineNum">     256 </span>            :       // NOTE: We can use 'getDaughters' here, because vertices
<span class="lineNum">     257 </span>            :       //       of daughters are not being modified by Photos right now
<span class="lineNum">     258 </span>            :       //       (so there will be no caching)
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :       std::vector&lt;PhotosParticle*&gt; daughters2 = daughters[i]-&gt;getDaughters();</span>
<span class="lineNum">     260 </span>            :       
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :       if(daughters2.size()!=1 || </span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :          daughters2[0]-&gt;getPdgID() != daughters[i]-&gt;getPdgID() )</span>
<span class="lineNum">     263 </span>            :       {
<span class="lineNum">     264 </span>            :         special = false;
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     266 </span>            :       }
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     if( special )</span>
<span class="lineNum">     270 </span>            :     {
<span class="lineNum">     271 </span>            :       double px1=0.0, py1=0.0, pz1=0.0, e1=0.0;
<span class="lineNum">     272 </span>            :       double px2=0.0, py2=0.0, pz2=0.0, e2=0.0;
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span>            :       // get sum of 4-momenta of unmodified particles
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :       for(unsigned int i=0;i&lt;daughters.size();i++)</span>
<span class="lineNum">     276 </span>            :       {
<span class="lineNum">     277 </span>            :         // ignore photons
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :         if(daughters[i]-&gt;getPdgID()==22) continue;</span>
<span class="lineNum">     279 </span>            : 
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :         px1+=daughters[i]-&gt;getPx();</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :         py1+=daughters[i]-&gt;getPy();</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :         pz1+=daughters[i]-&gt;getPz();</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         e1 +=daughters[i]-&gt;getE();</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span>            :       // get sum of 4-momenta of particles in self-decay vertices
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :       for(unsigned int i=0;i&lt;daughters.size();i++)</span>
<span class="lineNum">     288 </span>            :       {
<span class="lineNum">     289 </span>            :         // ignore photons
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :         if(daughters[i]-&gt;getPdgID()==22) continue;</span>
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span>            :         // since 'allDaughtersSelfDecay()' is true
<span class="lineNum">     293 </span>            :         // each of these particles has exactly one daughter
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :         px2 += daughters[i]-&gt;getDaughters().at(0)-&gt;getPx();</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :         py2 += daughters[i]-&gt;getDaughters().at(0)-&gt;getPy();</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :         pz2 += daughters[i]-&gt;getDaughters().at(0)-&gt;getPz();</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :         e2  += daughters[i]-&gt;getDaughters().at(0)-&gt;getE();</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span>            :       //cout&lt;&lt;&quot;ORIG: &quot;&lt;&lt;px1&lt;&lt;&quot; &quot;&lt;&lt;py1&lt;&lt;&quot; &quot;&lt;&lt;pz1&lt;&lt;&quot; &quot;&lt;&lt;e1&lt;&lt;endl;
<span class="lineNum">     301 </span>            :       //cout&lt;&lt;&quot;SELF: &quot;&lt;&lt;px2&lt;&lt;&quot; &quot;&lt;&lt;py2&lt;&lt;&quot; &quot;&lt;&lt;pz2&lt;&lt;&quot; &quot;&lt;&lt;e2&lt;&lt;endl;
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :       p1 = m_particle_list.at(0)-&gt;createNewParticle(0,-1,0.0,px1,py1,pz1,e1);</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :       p2 = m_particle_list.at(0)-&gt;createNewParticle(0,-2,0.0,px2,py2,pz2,e2);</span>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span>            :       // Finaly, boost photons to appropriate frame
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       for(unsigned int i=0;i&lt;photon_list.size();i++)</span>
<span class="lineNum">     308 </span>            :       {
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         PhotosParticle *boosted = photon_list[i]-&gt;createNewParticle( 22, 1,</span>
<span class="lineNum">     310 </span>            :                                     0.0,
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :                                     photon_list[i]-&gt;getPx(),</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :                                     photon_list[i]-&gt;getPy(),</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :                                     photon_list[i]-&gt;getPz(),</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :                                     photon_list[i]-&gt;getE()   );</span>
<span class="lineNum">     315 </span>            :                 
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :         boosted-&gt;boostToRestFrame(p1);</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :         boosted-&gt;boostFromRestFrame(p2);</span>
<span class="lineNum">     318 </span>            :         
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :         photon_list[i]-&gt;createSelfDecayVertex(boosted);</span>
<span class="lineNum">     320 </span>            :         
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :         delete boosted;</span>
<span class="lineNum">     322 </span>            :       }
<span class="lineNum">     323 </span>            : 
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :       Log::Warning()&lt;&lt;&quot;Hidden interaction, all daughters self decay.&quot;</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :           &lt;&lt;&quot;Potentially over simplified solution applied.&quot;&lt;&lt;endl;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     328 </span>            : 
<span class="lineNum">     329 </span>            :   //otherwise loop over particles which are already in the
<span class="lineNum">     330 </span>            :   //event record and modify their 4 momentum
<span class="lineNum">     331 </span>            :   //4.03.2012: Fix to prevent kinematical trap in vertex of simultaneous:
<span class="lineNum">     332 </span>            :   //           z-collinear and non-conservation pf E,p for dauthters of grandmothers
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   for(index=daughters_start; index &lt; particle_count &amp;&amp; index &lt; (int) m_particle_list.size(); index++){</span>
<span class="lineNum">     334 </span>            : 
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :     PhotosParticle * particle = m_particle_list.at(index);</span>
<span class="lineNum">     336 </span>            : 
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :     if(hep.idhep[index]!=particle-&gt;getPdgID())</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :       Log::Fatal(&quot;PH_HEPEVT_Interface::get(): Something is wrong with the PH_HEPEVT common block&quot;,5);</span>
<span class="lineNum">     339 </span>            : 
<span class="lineNum">     340 </span>            :     // If photons were added - for each daughter create a history entry
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :     if(isPhotonCreated &amp;&amp; Photos::isCreateHistoryEntries)</span>
<span class="lineNum">     342 </span>            :     {
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :       particle-&gt;createHistoryEntry();</span>
<span class="lineNum">     344 </span>            :     }
<span class="lineNum">     345 </span>            :     
<span class="lineNum">     346 </span>            :     //check to see if this particle's 4-momentum has been modified
<span class="lineNum">     347 </span>            :     bool   update=false;
<span class="lineNum">     348 </span>            : 
<span class="lineNum">     349 </span>            :     // don't update particle if difference lower than THRESHOLD * particle energy (default threshold = 10e-8)
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     double threshold = NO_BOOST_THRESHOLD*hep.phep[index][3];</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :     if( fabs(hep.phep[index][0]-particle-&gt;getPx()) &gt; threshold ||</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :         fabs(hep.phep[index][1]-particle-&gt;getPy()) &gt; threshold ||</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :         fabs(hep.phep[index][2]-particle-&gt;getPz()) &gt; threshold ||</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :         fabs(hep.phep[index][3]-particle-&gt;getE())  &gt; threshold    ) update=true;</span>
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     if(update)</span>
<span class="lineNum">     357 </span>            :     {
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            :       //modify this particle's momentum and it's daughters momentum
<span class="lineNum">     360 </span>            :       //Steps 1., 2. and 3. must be executed in order.
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            :       //1. boost the particles daughters into it's (old) rest frame
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :       particle-&gt;boostDaughtersToRestFrame(particle);</span>
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span>            :       //2. change this particles 4 momentum
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :       particle-&gt;setPx(hep.phep[index][0]);</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :       particle-&gt;setPy(hep.phep[index][1]);</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :       particle-&gt;setPz(hep.phep[index][2]);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :       particle-&gt;setE(hep.phep[index][3]);</span>
<span class="lineNum">     370 </span>            : 
<span class="lineNum">     371 </span>            :       //3. boost the particles daughters back into the lab frame
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :       particle-&gt;boostDaughtersFromRestFrame(particle);</span>
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :       if(special &amp;&amp; particle-&gt;getDaughters().size()&gt;0){</span>
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span>            :       // Algorithm for special case:
<span class="lineNum">     377 </span>            :       // a. get self-daughter of 'particle'
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :       PhotosParticle *particled = particle-&gt;getDaughters().at(0);</span>
<span class="lineNum">     379 </span>            : 
<span class="lineNum">     380 </span>            :       // b. boost 'particled' daughters to rest frame
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :       particled-&gt;boostDaughtersToRestFrame(particled);</span>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span>            :       // c. copy four momentum of 'particle' into four momentum of
<span class="lineNum">     384 </span>            :       //    its self-daughter 'particled'
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :       particled-&gt;setPx( particle-&gt;getPx() );</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :       particled-&gt;setPy( particle-&gt;getPy() );</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :       particled-&gt;setPz( particle-&gt;getPz() );</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :       particled-&gt;setE ( particle-&gt;getE()  );</span>
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span>            :       // d. boost self daughter to rest-frame of &lt;e1&gt;
<span class="lineNum">     392 </span>            :       //    boost self daughter from rest-frame of &lt;e2&gt;
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :       particled-&gt;boostToRestFrame(p1);</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :       particled-&gt;boostFromRestFrame(p2);</span>
<span class="lineNum">     396 </span>            : 
<span class="lineNum">     397 </span>            :       // e. boost the 'particled' daughters back into the lab frame
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :       particled-&gt;boostDaughtersFromRestFrame(particled);</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span>            :     }
<span class="lineNum">     402 </span>            :   }
<span class="lineNum">     403 </span>            :   
<span class="lineNum">     404 </span>            :   // cleanup
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   if(p1) delete p1;</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :   if(p2) delete p2;</span>
<a name="407"><span class="lineNum">     407 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span>            : void PH_HEPEVT_Interface::prepare()
<span class="lineNum">     410 </span>            : {
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :         check_ME_channel();</span>
<a name="412"><span class="lineNum">     412 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span>            : void PH_HEPEVT_Interface::complete()
<span class="lineNum">     415 </span>            : {
<span class="lineNum">     416 </span>            : 
<a name="417"><span class="lineNum">     417 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span>            : void PH_HEPEVT_Interface::check_ME_channel()
<span class="lineNum">     420 </span>            : {
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :         ME_channel=0;</span>
<span class="lineNum">     422 </span>            : 
<span class="lineNum">     423 </span>            : // Check mothers:
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :         if(decay_idx==2)                              return; // Only one mother present</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :         if(hep.idhep[0]*hep.idhep[1]&gt;0) return; // Mothers have same sign</span>
<span class="lineNum">     427 </span>            : 
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :         Log::Debug(900)&lt;&lt;&quot;ME_channel: Mothers PDG:  &quot;&lt;&lt;hep.idhep[0]&lt;&lt;&quot; &quot;&lt;&lt;hep.idhep[1]&lt;&lt;endl;</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :         if(decay_idx)</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :                 Log::Debug(900,false)&lt;&lt;&quot;            Intermediate: &quot;&lt;&lt;hep.idhep[decay_idx-1]&lt;&lt;endl;</span>
<span class="lineNum">     431 </span>            : 
<span class="lineNum">     432 </span>            :         int              firstDaughter=3;
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :         if(decay_idx==0) firstDaughter=2; // if no intermediate particle - daughters start at idx 2</span>
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            :         // Are mothers in range +/- 1-6; +/- 11-16?
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :         int mother1 = abs(hep.idhep[0]);</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :         int mother2 = abs(hep.idhep[1]);</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         if( mother1&lt;1 || (mother1&gt;6 &amp;&amp; mother1&lt;11) || mother1&gt;16 ) return;</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :         if( mother2&lt;1 || (mother2&gt;6 &amp;&amp; mother2&lt;11) || mother2&gt;16 ) return;</span>
<span class="lineNum">     440 </span>            : 
<span class="lineNum">     441 </span>            : //Check daughters
<span class="lineNum">     442 </span>            : 
<span class="lineNum">     443 </span>            :         // Z: check for pairs 11 -11 ; 13 -13 ; 15 -15
<span class="lineNum">     444 </span>            :         // -------------------------------------------
<span class="lineNum">     445 </span>            :         int firstPDG =0;
<span class="lineNum">     446 </span>            :         int secondPDG=0;
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         for(int i=firstDaughter; i&lt;hep.nhep;i++)</span>
<span class="lineNum">     448 </span>            :         {
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :                 int pdg = abs(hep.idhep[i]);</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :                 if(pdg==11 || pdg==13 || pdg==15)</span>
<span class="lineNum">     451 </span>            :                 {
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :                         if(firstPDG==0) firstPDG=hep.idhep[i];</span>
<span class="lineNum">     453 </span>            :                         else
<span class="lineNum">     454 </span>            :                         {
<span class="lineNum">     455 </span>            :                                 secondPDG=hep.idhep[i];
<span class="lineNum">     456 </span>            :                                 // Just in case two pairs are genereted - verify that we have a pair with oposite signs
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :                                 if(firstPDG*secondPDG&gt;0) secondPDG=0;</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">     459 </span>            :                         }
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     462 </span>            : 
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :         if( ME_channel==0 &amp;&amp; firstPDG!=0 &amp;&amp; secondPDG!=0 &amp;&amp;</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :             firstPDG==-secondPDG ) ME_channel=1;</span>
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span>            :         // W: check for pairs 11 -12; -11 12; 13 -14; -13 14; 15 -16; -15 16
<span class="lineNum">     467 </span>            :         // -----------------------------------------------------------------
<span class="lineNum">     468 </span>            :         firstPDG =0;
<span class="lineNum">     469 </span>            :         secondPDG=0;
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :         for(int i=firstDaughter; i&lt;hep.nhep;i++)</span>
<span class="lineNum">     471 </span>            :         {
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :                 int pdg = abs(hep.idhep[i]);</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :                 if(pdg&gt;=11 &amp;&amp; pdg&lt;=16)</span>
<span class="lineNum">     474 </span>            :                 {
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :                         if(firstPDG==0) firstPDG=hep.idhep[i];</span>
<span class="lineNum">     476 </span>            :                         else
<span class="lineNum">     477 </span>            :                         {
<span class="lineNum">     478 </span>            :                                 secondPDG=hep.idhep[i];
<span class="lineNum">     479 </span>            :                                 // Just in case two pairs are genereted - verify that we have a pair with oposite signs
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :                                 if(firstPDG*secondPDG&gt;0) secondPDG=0;</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">     482 </span>            :                         }
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     485 </span>            : 
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :         firstPDG =abs(firstPDG);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :         secondPDG=abs(secondPDG);</span>
<span class="lineNum">     488 </span>            : 
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :         if(  ME_channel==0 &amp;&amp; firstPDG!=0 &amp;&amp; secondPDG!=0 &amp;&amp;</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :            ( ( firstPDG==11 &amp;&amp; secondPDG==12 ) || (firstPDG == 12 &amp;&amp; secondPDG == 11) ||</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :              ( firstPDG==13 &amp;&amp; secondPDG==14 ) || (firstPDG == 14 &amp;&amp; secondPDG == 13) ||</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :              ( firstPDG==15 &amp;&amp; secondPDG==16 ) || (firstPDG == 16 &amp;&amp; secondPDG == 15)</span>
<span class="lineNum">     493 </span>            :            )
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :           ) ME_channel=2;</span>
<span class="lineNum">     495 </span>            : 
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :         Log::Debug(901)&lt;&lt;&quot;ME_channel: Found ME_channel: &quot;&lt;&lt;ME_channel&lt;&lt;endl;</span>
<span class="lineNum">     497 </span>            : 
<span class="lineNum">     498 </span>            : // Check intermediate particle (if exists):
<span class="lineNum">     499 </span>            : 
<span class="lineNum">     500 </span>            :         // Verify that intermediate particle PDG matches ME_channel found
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :         if(ME_channel&gt;0 &amp;&amp; decay_idx)</span>
<span class="lineNum">     502 </span>            :         {
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :                 int pdg=hep.idhep[decay_idx-1];</span>
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :                 if(ME_channel==1 &amp;&amp; !(pdg==22 || pdg==23) ) ME_channel=0; //gamma/Z</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :                 if(ME_channel==2 &amp;&amp; !(pdg==24 || pdg==-24)) ME_channel=0; //W+/W-</span>
<span class="lineNum">     507 </span>            : 
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :                 if(ME_channel==0)</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :                         Log::Debug(901,false)&lt;&lt;&quot;            but set to 0: wrong intermediate particle: &quot;&lt;&lt;pdg&lt;&lt;endl;</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     511 </span>            : 
<span class="lineNum">     512 </span>            : // Check flags
<span class="lineNum">     513 </span>            : 
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :         switch(ME_channel)</span>
<span class="lineNum">     515 </span>            :         {
<span class="lineNum">     516 </span>            :                 case  0: break; // Ok - no channel found
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :                 case  1: if(!Photos::meCorrectionWtForZ) ME_channel=0; break;</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                 case  2: if(!Photos::meCorrectionWtForW) ME_channel=0; break;</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :                 default: Log::Error()&lt;&lt;&quot;Unimplemented ME channel: &quot;&lt;&lt;ME_channel&lt;&lt;endl; break;</span>
<span class="lineNum">     520 </span>            :         }
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :         Log::Debug(902)&lt;&lt;&quot;ME_channel: Finally, after flag check, ME_channel is: &quot;&lt;&lt;ME_channel&lt;&lt;endl;</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     523 </span>            : 
<span class="lineNum">     524 </span>            : 
<span class="lineNum">     525 </span>            : } // namespace Photospp
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
