<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TEvtGen/HepMC/GenVertex.cc</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">TEvtGen/HepMC</a> - GenVertex.cc<span style="font-size: 80%;"> (source / <a href="GenVertex.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">483</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">72</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : //////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">       2 </span>            : // Matt.Dobbs@Cern.CH, September 1999
<span class="lineNum">       3 </span>            : // GenVertex within an event
<span class="lineNum">       4 </span>            : //////////////////////////////////////////////////////////////////////////
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : #include &quot;HepMC/GenParticle.h&quot;
<span class="lineNum">       7 </span>            : #include &quot;HepMC/GenVertex.h&quot;
<span class="lineNum">       8 </span>            : #include &quot;HepMC/GenEvent.h&quot;
<span class="lineNum">       9 </span>            : #include &quot;HepMC/SearchVector.h&quot;
<span class="lineNum">      10 </span>            : #include &lt;iomanip&gt;       // needed for formatted output
<span class="lineNum">      11 </span>            : 
<a name="12"><span class="lineNum">      12 </span>            : namespace HepMC {</a>
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span><span class="lineNoCov">          0 :     GenVertex::GenVertex( const FourVector&amp; position,</span>
<span class="lineNum">      15 </span>            :                           int id, const WeightContainer&amp; weights ) 
<span class="lineNum">      16 </span><span class="lineNoCov">          0 :         : m_position(position), m_id(id), m_weights(weights), m_event(0),</span>
<span class="lineNum">      17 </span><span class="lineNoCov">          0 :           m_barcode(0)</span>
<span class="lineNum">      18 </span><span class="lineNoCov">          0 :     {}</span>
<span class="lineNum">      19 </span>            :     //{
<span class="lineNum">      20 </span>            :         //s_counter++;
<a name="21"><span class="lineNum">      21 </span>            :     //}</a>
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            :     GenVertex::GenVertex( const GenVertex&amp; invertex ) 
<span class="lineNum">      24 </span><span class="lineNoCov">          0 :     : m_position( invertex.position() ),</span>
<span class="lineNum">      25 </span><span class="lineNoCov">          0 :       m_particles_in(),</span>
<span class="lineNum">      26 </span><span class="lineNoCov">          0 :       m_particles_out(),</span>
<span class="lineNum">      27 </span><span class="lineNoCov">          0 :       m_id( invertex.id() ),</span>
<span class="lineNum">      28 </span><span class="lineNoCov">          0 :       m_weights( invertex.weights() ),</span>
<span class="lineNum">      29 </span><span class="lineNoCov">          0 :       m_event(0),</span>
<span class="lineNum">      30 </span><span class="lineNoCov">          0 :       m_barcode(0) </span>
<span class="lineNum">      31 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">      32 </span>            :         /// Shallow copy: does not copy the FULL list of particle pointers.
<span class="lineNum">      33 </span>            :         /// Creates a copy of  - invertex
<span class="lineNum">      34 </span>            :         ///                    - outgoing particles of invertex, but sets the
<span class="lineNum">      35 </span>            :         ///                      decay vertex of these particles to NULL
<span class="lineNum">      36 </span>            :         ///                    - all incoming particles which do not have a
<span class="lineNum">      37 </span>            :         ///                      creation vertex.
<span class="lineNum">      38 </span>            :         /// (i.e. it creates copies of all particles which it owns)
<span class="lineNum">      39 </span>            :         /// (note - impossible to copy the FULL list of particle pointers 
<span class="lineNum">      40 </span>            :         ///         while having the vertex
<span class="lineNum">      41 </span>            :         ///         and particles in/out point-back to one another -- unless you
<span class="lineNum">      42 </span>            :         ///         copy the entire tree -- which we don't want to do)
<span class="lineNum">      43 </span>            :         //
<span class="lineNum">      44 </span><span class="lineNoCov">          0 :         for ( particles_in_const_iterator </span>
<span class="lineNum">      45 </span><span class="lineNoCov">          0 :                   part1 = invertex.particles_in_const_begin();</span>
<span class="lineNum">      46 </span><span class="lineNoCov">          0 :               part1 != invertex.particles_in_const_end(); ++part1 ) {</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :             if ( !(*part1)-&gt;production_vertex() ) { </span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 :                 GenParticle* pin = new GenParticle(**part1);</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :                 add_particle_in(pin);</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">      51 </span>            :         }
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :         for ( particles_out_const_iterator</span>
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :                   part2 = invertex.particles_out_const_begin();</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :               part2 != invertex.particles_out_const_end(); part2++ ) {</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :             GenParticle* pin = new GenParticle(**part2);</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :             add_particle_out(pin);</span>
<span class="lineNum">      57 </span>            :         }
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :         suggest_barcode( invertex.barcode() );</span>
<span class="lineNum">      59 </span>            :         //
<span class="lineNum">      60 </span>            :         //s_counter++;
<a name="61"><span class="lineNum">      61 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">      62 </span>            :     
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :     GenVertex::~GenVertex() {</span>
<span class="lineNum">      64 </span>            :         //
<span class="lineNum">      65 </span>            :         // need to delete any particles previously owned by this vertex
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :         if ( parent_event() ) parent_event()-&gt;remove_barcode(this);</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :         delete_adopted_particles();</span>
<span class="lineNum">      68 </span>            :         //s_counter--;
<a name="69"><span class="lineNum">      69 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span>            :     void GenVertex::swap( GenVertex &amp; other)
<span class="lineNum">      72 </span>            :     {
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :         m_position.swap( other.m_position );</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :         m_particles_in.swap( other.m_particles_in );</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :         m_particles_out.swap( other.m_particles_out );</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :         std::swap( m_id, other.m_id );</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :         m_weights.swap( other.m_weights );</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :         std::swap( m_event, other.m_event );</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :         std::swap( m_barcode, other.m_barcode );</span>
<a name="80"><span class="lineNum">      80 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            :     GenVertex&amp; GenVertex::operator=( const GenVertex&amp; invertex ) {
<span class="lineNum">      83 </span>            :         /// Shallow: does not copy the FULL list of particle pointers.
<span class="lineNum">      84 </span>            :         /// Creates a copy of  - invertex
<span class="lineNum">      85 </span>            :         ///                    - outgoing particles of invertex, but sets the
<span class="lineNum">      86 </span>            :         ///                      decay vertex of these particles to NULL
<span class="lineNum">      87 </span>            :         ///                    - all incoming particles which do not have a
<span class="lineNum">      88 </span>            :         ///                      creation vertex.
<span class="lineNum">      89 </span>            :         ///                    - it does not alter *this's m_event (!)
<span class="lineNum">      90 </span>            :         /// (i.e. it creates copies of all particles which it owns)
<span class="lineNum">      91 </span>            :         /// (note - impossible to copy the FULL list of particle pointers 
<span class="lineNum">      92 </span>            :         ///         while having the vertex
<span class="lineNum">      93 </span>            :         ///         and particles in/out point-back to one another -- unless you
<span class="lineNum">      94 </span>            :         ///         copy the entire tree -- which we don't want to do)
<span class="lineNum">      95 </span>            :         ///
<span class="lineNum">      96 </span>            : 
<span class="lineNum">      97 </span>            :         // best practices implementation
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :         GenVertex tmp( invertex );</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :         swap( tmp );</span>
<span class="lineNum">     100 </span>            :         return *this;
<a name="101"><span class="lineNum">     101 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     102 </span>            :     
<span class="lineNum">     103 </span>            :     bool GenVertex::operator==( const GenVertex&amp; a ) const {
<span class="lineNum">     104 </span>            :         /// Returns true if the positions and the particles in the lists of a 
<span class="lineNum">     105 </span>            :         ///  and this are identical. Does not compare barcodes.
<span class="lineNum">     106 </span>            :         /// Note that it is impossible for two vertices to point to the same 
<span class="lineNum">     107 </span>            :         ///  particle's address, so we need to do more than just compare the
<span class="lineNum">     108 </span>            :         ///  particle pointers
<span class="lineNum">     109 </span>            :         //
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :         if ( a.position() !=  this-&gt;position() ) return false;</span>
<span class="lineNum">     111 </span>            :         // if the size of the inlist differs, return false.
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :         if ( a.particles_in_size() !=  this-&gt;particles_in_size() ) return false;</span>
<span class="lineNum">     113 </span>            :         // if the size of the outlist differs, return false.
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :         if ( a.particles_out_size() !=  this-&gt;particles_out_size() ) return false;</span>
<span class="lineNum">     115 </span>            :         // loop over the inlist and ensure particles are identical
<span class="lineNum">     116 </span>            :         //   (only do this if the lists aren't empty - we already know
<span class="lineNum">     117 </span>            :         //   if one isn't, then other isn't either!)
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :         if ( a.particles_in_const_begin() != a.particles_in_const_end() ) {</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :             for ( GenVertex::particles_in_const_iterator </span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :                       ia = a.particles_in_const_begin(),</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :                       ib = this-&gt;particles_in_const_begin();</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :                   ia != a.particles_in_const_end(); ia++, ib++ ){</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :                 if ( **ia != **ib ) return false;</span>
<span class="lineNum">     124 </span>            :             }
<span class="lineNum">     125 </span>            :         }
<span class="lineNum">     126 </span>            :         // loop over the outlist and ensure particles are identical
<span class="lineNum">     127 </span>            :         //   (only do this if the lists aren't empty - we already know
<span class="lineNum">     128 </span>            :         //   if one isn't, then other isn't either!)
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :         if ( a.particles_out_const_begin() != a.particles_out_const_end() ) {</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :             for ( GenVertex::particles_out_const_iterator </span>
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :                       ia = a.particles_out_const_begin(),</span>
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :                       ib = this-&gt;particles_out_const_begin();</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :                   ia != a.particles_out_const_end(); ia++, ib++ ){</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :                 if ( **ia != **ib ) return false;</span>
<span class="lineNum">     135 </span>            :             }
<span class="lineNum">     136 </span>            :         }
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :         return true;</span>
<a name="138"><span class="lineNum">     138 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     139 </span>            : 
<span class="lineNum">     140 </span>            :     bool GenVertex::operator!=( const GenVertex&amp; a ) const {
<span class="lineNum">     141 </span>            :         // Returns true if the positions and lists of a and this are not equal.
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :         return !( a == *this );</span>
<a name="143"><span class="lineNum">     143 </span>            :     }  </a>
<span class="lineNum">     144 </span>            : 
<span class="lineNum">     145 </span>            :     void GenVertex::print( std::ostream&amp; ostr ) const {
<span class="lineNum">     146 </span>            :         // find the current stream state
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :         std::ios_base::fmtflags orig = ostr.flags();</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :         std::streamsize prec = ostr.precision();</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :         if ( barcode()!=0 ) {</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :             if ( position() != FourVector(0,0,0,0) ) {</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot;Vertex:&quot;;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; barcode();</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; ID:&quot;;</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :                 ostr.width(5);</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; id();</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; (X,cT)=&quot;;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :                 ostr.precision(2);</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios::scientific, std::ios::floatfield);</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios_base::showpos);</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().x() &lt;&lt; &quot;,&quot;;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().y() &lt;&lt; &quot;,&quot;;</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().z() &lt;&lt; &quot;,&quot;;</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().t();</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios::fmtflags(0), std::ios::floatfield);</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :                 ostr.unsetf(std::ios_base::showpos);</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; std::endl;</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :             } else {</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot;GenVertex:&quot;;</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; barcode();</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; ID:&quot;;</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :                 ostr.width(5);</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; id();</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; (X,cT):0&quot;;</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; std::endl;</span>
<span class="lineNum">     181 </span>            :             }
<span class="lineNum">     182 </span>            :         } else {
<span class="lineNum">     183 </span>            :             // If the vertex doesn't have a unique barcode assigned, then
<span class="lineNum">     184 </span>            :             //  we print its memory address instead... so that the
<span class="lineNum">     185 </span>            :             //  print out gives us a unique tag for the particle.
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :             if ( position() != FourVector(0,0,0,0) ) {</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot;Vertex:&quot;;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; (void*)this;</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; ID:&quot;;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :                 ostr.width(5);</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; id();</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; (X,cT)=&quot;;</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :                 ostr.precision(2);</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios::scientific, std::ios::floatfield);</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios_base::showpos);</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().x();</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().y();</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().z();</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; position().t();</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :                 ostr.setf(std::ios::fmtflags(0), std::ios::floatfield);</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :                 ostr.unsetf(std::ios_base::showpos);</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; std::endl;</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :             } else {</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot;GenVertex:&quot;;</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :                 ostr.width(9);</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; (void*)this;</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; ID:&quot;;</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :                 ostr.width(5);</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; id();</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; (X,cT):0&quot;;</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; std::endl;</span>
<span class="lineNum">     217 </span>            :             }
<span class="lineNum">     218 </span>            :         }
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span>            :         // print the weights if there are any
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :         if ( ! weights().empty() ) {</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :             ostr &lt;&lt; &quot; Wgts(&quot; &lt;&lt; weights().size() &lt;&lt; &quot;)=&quot;;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :             for ( WeightContainer::const_iterator wgt = weights().begin();</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :                   wgt != weights().end(); wgt++ ) { ostr &lt;&lt; *wgt &lt;&lt; &quot; &quot;; }</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :             ostr &lt;&lt; std::endl;</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     227 </span>            :         // print out all the incoming, then outgoing particles
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :         for ( particles_in_const_iterator part1 = particles_in_const_begin();</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :               part1 != particles_in_const_end(); part1++ ) {</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :             if ( part1 == particles_in_const_begin() ) {</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; I:&quot;;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :                 ostr.width(2);</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; m_particles_in.size();</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :             } else { ostr &lt;&lt; &quot;     &quot;; }</span>
<span class="lineNum">     235 </span>            :             //(*part1)-&gt;print( ostr );  //uncomment for long debugging printout
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :             ostr &lt;&lt; **part1 &lt;&lt; std::endl;</span>
<span class="lineNum">     237 </span>            :         }
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :         for ( particles_out_const_iterator part2 = particles_out_const_begin();</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :               part2 != particles_out_const_end(); part2++ ) {</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :             if ( part2 == particles_out_const_begin() ) { </span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; &quot; O:&quot;;</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :                 ostr.width(2);</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :                 ostr &lt;&lt; m_particles_out.size();</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :             } else { ostr &lt;&lt; &quot;     &quot;; }</span>
<span class="lineNum">     245 </span>            :             //(*part2)-&gt;print( ostr ); // uncomment for long debugging printout
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :             ostr &lt;&lt; **part2 &lt;&lt; std::endl;</span>
<span class="lineNum">     247 </span>            :         }
<span class="lineNum">     248 </span>            :         // restore the stream state
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         ostr.flags(orig);</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         ostr.precision(prec);</span>
<a name="251"><span class="lineNum">     251 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     252 </span>            : 
<span class="lineNum">     253 </span>            :     double GenVertex::check_momentum_conservation() const {
<span class="lineNum">     254 </span>            :         /// finds the difference between the total momentum out and the total
<span class="lineNum">     255 </span>            :         /// momentum in vectors, and returns the magnitude of this vector
<span class="lineNum">     256 </span>            :         /// i.e.         returns | vec{p_in} - vec{p_out} |
<span class="lineNum">     257 </span>            :         double sumpx = 0, sumpy = 0, sumpz = 0;
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         for ( particles_in_const_iterator part1 = particles_in_const_begin();</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :               part1 != particles_in_const_end(); part1++ ) {</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :             sumpx   += (*part1)-&gt;momentum().px();</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :             sumpy   += (*part1)-&gt;momentum().py();</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :             sumpz   += (*part1)-&gt;momentum().pz();</span>
<span class="lineNum">     263 </span>            :         }
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         for ( particles_out_const_iterator part2 = particles_out_const_begin();</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :               part2 != particles_out_const_end(); part2++ ) {</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :             sumpx   -= (*part2)-&gt;momentum().px();</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :             sumpy   -= (*part2)-&gt;momentum().py();</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :             sumpz   -= (*part2)-&gt;momentum().pz();</span>
<span class="lineNum">     269 </span>            :         }
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :         return sqrt( sumpx*sumpx + sumpy*sumpy + sumpz*sumpz );</span>
<a name="271"><span class="lineNum">     271 </span>            :     }</a>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span>            :     void GenVertex::add_particle_in( GenParticle* inparticle ) {
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :         if ( !inparticle ) return;</span>
<span class="lineNum">     275 </span>            :         // if inparticle previously had a decay vertex, remove it from that
<span class="lineNum">     276 </span>            :         // vertex's list
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :         if ( inparticle-&gt;end_vertex() ) {</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :             inparticle-&gt;end_vertex()-&gt;remove_particle_in( inparticle );</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :         m_particles_in.push_back( inparticle );</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :         inparticle-&gt;set_end_vertex_( this );</span>
<a name="282"><span class="lineNum">     282 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span>            :     void GenVertex::add_particle_out( GenParticle* outparticle ) {
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :         if ( !outparticle ) return;</span>
<span class="lineNum">     286 </span>            :         // if outparticle previously had a production vertex,
<span class="lineNum">     287 </span>            :         // remove it from that vertex's list
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :         if ( outparticle-&gt;production_vertex() ) {</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :             outparticle-&gt;production_vertex()-&gt;remove_particle_out( outparticle );</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :         m_particles_out.push_back( outparticle );</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         outparticle-&gt;set_production_vertex_( this );</span>
<a name="293"><span class="lineNum">     293 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span>            :     GenParticle* GenVertex::remove_particle( GenParticle* particle ) {
<span class="lineNum">     296 </span>            :         /// this finds *particle in the in and/or out list and removes it from
<span class="lineNum">     297 </span>            :         ///  these lists ... it DOES NOT DELETE THE PARTICLE or its relations.
<span class="lineNum">     298 </span>            :         /// you could delete the particle too as follows:
<span class="lineNum">     299 </span>            :         ///      delete vtx-&gt;remove_particle( particle );
<span class="lineNum">     300 </span>            :         /// or if the particle has an end vertex, you could:
<span class="lineNum">     301 </span>            :         ///      delete vtx-&gt;remove_particle( particle )-&gt;end_vertex();
<span class="lineNum">     302 </span>            :         /// which would delete the particle's end vertex, and thus would
<span class="lineNum">     303 </span>            :         /// also delete the particle, since the particle would be 
<span class="lineNum">     304 </span>            :         /// owned by the end vertex.
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :         if ( !particle ) return 0;</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :         if ( particle-&gt;end_vertex() == this ) {</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :             particle-&gt;set_end_vertex_( 0 );</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :             remove_particle_in(particle);</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :         if ( particle-&gt;production_vertex() == this ) {</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :             particle-&gt;set_production_vertex_(0);</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :             remove_particle_out(particle);</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :         return particle;</span>
<a name="315"><span class="lineNum">     315 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span>            :     void GenVertex::remove_particle_in( GenParticle* particle ) {
<span class="lineNum">     318 </span>            :         /// this finds *particle in m_particles_in and removes it from that list
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :         if ( !particle ) return;</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :         m_particles_in.erase( already_in_vector( &amp;m_particles_in, particle ) );</span>
<a name="321"><span class="lineNum">     321 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span>            :     void GenVertex::remove_particle_out( GenParticle* particle ) {
<span class="lineNum">     324 </span>            :         /// this finds *particle in m_particles_out and removes it from that list
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :         if ( !particle ) return;</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :         m_particles_out.erase( already_in_vector( &amp;m_particles_out, particle ) );</span>
<a name="327"><span class="lineNum">     327 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     328 </span>            : 
<span class="lineNum">     329 </span>            :     void GenVertex::delete_adopted_particles() {
<span class="lineNum">     330 </span>            :         /// deletes all particles which this vertex owns
<span class="lineNum">     331 </span>            :         /// to be used by the vertex destructor and operator=
<span class="lineNum">     332 </span>            :         //
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         if ( m_particles_out.empty() &amp;&amp; m_particles_in.empty() ) return;</span>
<span class="lineNum">     334 </span>            :         // 1. delete all outgoing particles which don't have decay vertices.
<span class="lineNum">     335 </span>            :         //    those that do become the responsibility of the decay vertex
<span class="lineNum">     336 </span>            :         //    and have their productionvertex pointer set to NULL
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :         for ( std::vector&lt;GenParticle*&gt;::iterator part1 = m_particles_out.begin();</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :               part1 != m_particles_out.end(); ) {</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :             if ( !(*part1)-&gt;end_vertex() ) {</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :                 delete *(part1++);</span>
<span class="lineNum">     341 </span>            :             } else { 
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :                 (*part1)-&gt;set_production_vertex_(0);</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :                 ++part1;</span>
<span class="lineNum">     344 </span>            :             }
<span class="lineNum">     345 </span>            :         }
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :         m_particles_out.clear();</span>
<span class="lineNum">     347 </span>            :         //
<span class="lineNum">     348 </span>            :         // 2. delete all incoming particles which don't have production
<span class="lineNum">     349 </span>            :         //    vertices. those that do become the responsibility of the 
<span class="lineNum">     350 </span>            :         //    production vertex and have their decayvertex pointer set to NULL
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :         for ( std::vector&lt;GenParticle*&gt;::iterator part2 = m_particles_in.begin();</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :               part2 != m_particles_in.end(); ) {</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :             if ( !(*part2)-&gt;production_vertex() ) { </span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :                 delete *(part2++);</span>
<span class="lineNum">     355 </span>            :             } else { 
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :                 (*part2)-&gt;set_end_vertex_(0); </span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :                 ++part2;</span>
<span class="lineNum">     358 </span>            :             }
<span class="lineNum">     359 </span>            :         }
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :         m_particles_in.clear();</span>
<a name="361"><span class="lineNum">     361 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span>            :     bool GenVertex::suggest_barcode( int the_bar_code )
<span class="lineNum">     364 </span>            :     {
<span class="lineNum">     365 </span>            :         /// allows a barcode to be suggested for this vertex.
<span class="lineNum">     366 </span>            :         /// In general it is better to let the event pick the barcode for
<span class="lineNum">     367 </span>            :         /// you, which is automatic.
<span class="lineNum">     368 </span>            :         /// Returns TRUE if the suggested barcode has been accepted (i.e. the
<span class="lineNum">     369 </span>            :         ///  suggested barcode has not already been used in the event, 
<span class="lineNum">     370 </span>            :         ///  and so it was used).
<span class="lineNum">     371 </span>            :         /// Returns FALSE if the suggested barcode was rejected, or if the
<span class="lineNum">     372 </span>            :         ///  vertex is not yet part of an event, such that it is not yet
<span class="lineNum">     373 </span>            :         ///  possible to know if the suggested barcode will be accepted).
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         if ( the_bar_code &gt;0 ) {</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :             std::cerr &lt;&lt; &quot;GenVertex::suggest_barcode WARNING, vertex bar codes&quot;</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :                       &lt;&lt; &quot;\n MUST be negative integers. Positive integers &quot;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :                       &lt;&lt; &quot;\n are reserved for particles only. Your suggestion &quot;</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :                       &lt;&lt; &quot;\n has been rejected.&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :             return false;</span>
<span class="lineNum">     380 </span>            :         }
<span class="lineNum">     381 </span>            :         bool success = false;
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :         if ( parent_event() ) {</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :             success = parent_event()-&gt;set_barcode( this, the_bar_code );</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :         } else { set_barcode_( the_bar_code ); }</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :         return success;</span>
<a name="386"><span class="lineNum">     386 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span>            :     void GenVertex::set_parent_event_( GenEvent* new_evt ) 
<span class="lineNum">     389 </span>            :     { 
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :         GenEvent* orig_evt = m_event;</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :         m_event = new_evt; </span>
<span class="lineNum">     392 </span>            :         //
<span class="lineNum">     393 </span>            :         // every time a vertex's parent event changes, the map of barcodes
<span class="lineNum">     394 </span>            :         //   in the new and old parent event needs to be modified to 
<span class="lineNum">     395 </span>            :         //   reflect this
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :         if ( orig_evt != new_evt ) {</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :             if (new_evt) new_evt-&gt;set_barcode( this, barcode() );</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :             if (orig_evt) orig_evt-&gt;remove_barcode( this );</span>
<span class="lineNum">     399 </span>            :             // we also need to loop over all the particles which are owned by 
<span class="lineNum">     400 </span>            :             //  this vertex, and remove their barcodes from the old event.
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :             for ( particles_in_const_iterator part1=particles_in_const_begin();</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :                   part1 != particles_in_const_end(); part1++ ) {</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :                 if ( !(*part1)-&gt;production_vertex() ) { </span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :                     if ( orig_evt ) orig_evt-&gt;remove_barcode( *part1 );</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :                     if ( new_evt ) new_evt-&gt;set_barcode( *part1, </span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :                                                          (*part1)-&gt;barcode() );</span>
<span class="lineNum">     407 </span>            :                 }
<span class="lineNum">     408 </span>            :             }
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :             for ( particles_out_const_iterator</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :                       part2 = particles_out_const_begin();</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                   part2 != particles_out_const_end(); part2++ ) {</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :                     if ( orig_evt ) orig_evt-&gt;remove_barcode( *part2 );</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                     if ( new_evt ) new_evt-&gt;set_barcode( *part2, </span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :                                                          (*part2)-&gt;barcode() );</span>
<span class="lineNum">     415 </span>            :             }
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :         }</span>
<a name="417"><span class="lineNum">     417 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span>            :     void GenVertex::change_parent_event_( GenEvent* new_evt ) 
<span class="lineNum">     420 </span>            :     { 
<span class="lineNum">     421 </span>            :         //
<span class="lineNum">     422 </span>            :         // this method is for use with swap
<span class="lineNum">     423 </span>            :         // particles and vertices have already been exchanged, 
<span class="lineNum">     424 </span>            :         // but the backpointer needs to be fixed
<span class="lineNum">     425 </span>            :         //GenEvent* orig_evt = m_event;
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :         m_event = new_evt; </span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span>            :     /////////////
<span class="lineNum">     430 </span>            :     // Static  //
<span class="lineNum">     431 </span>            :     /////////////
<span class="lineNum">     432 </span>            :     //unsigned int GenVertex::counter() { return s_counter; }
<span class="lineNum">     433 </span>            :     //unsigned int GenVertex::s_counter = 0; 
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            :     /////////////
<span class="lineNum">     436 </span>            :     // Friends //
<span class="lineNum">     437 </span>            :     /////////////
<a name="438"><span class="lineNum">     438 </span>            : </a>
<span class="lineNum">     439 </span>            :     /// send vertex information to ostr for printing
<span class="lineNum">     440 </span>            :     std::ostream&amp; operator&lt;&lt;( std::ostream&amp; ostr, const GenVertex&amp; vtx ) {
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         if ( vtx.barcode()!=0 ) ostr &lt;&lt; &quot;BarCode &quot; &lt;&lt; vtx.barcode();</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :         else ostr &lt;&lt; &quot;Address &quot; &lt;&lt; &amp;vtx;</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :         ostr &lt;&lt; &quot; (X,cT)=&quot;;</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :         if ( vtx.position() != FourVector(0,0,0,0)) {</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :             ostr &lt;&lt; vtx.position().x() &lt;&lt; &quot;,&quot;</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :                  &lt;&lt; vtx.position().y() &lt;&lt; &quot;,&quot;</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :                  &lt;&lt; vtx.position().z() &lt;&lt; &quot;,&quot;</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :                  &lt;&lt; vtx.position().t();</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :         } else { ostr &lt;&lt; 0; }</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :         ostr &lt;&lt; &quot; #in:&quot; &lt;&lt; vtx.particles_in_size()</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :              &lt;&lt; &quot; #out:&quot; &lt;&lt; vtx.particles_out_size();</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :         return ostr;</span>
<span class="lineNum">     453 </span>            :     }
<span class="lineNum">     454 </span>            : 
<span class="lineNum">     455 </span>            :     /////////////////////////////
<span class="lineNum">     456 </span>            :     // edge_iterator           // (protected - for internal use only)
<span class="lineNum">     457 </span>            :     /////////////////////////////
<span class="lineNum">     458 </span>            :     // If the user wants the functionality of the edge_iterator, he should
<span class="lineNum">     459 </span>            :     // use particle_iterator with IteratorRange = family, parents, or children
<a name="460"><span class="lineNum">     460 </span>            :     //</a>
<span class="lineNum">     461 </span>            : 
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :     GenVertex::edge_iterator::edge_iterator() : m_vertex(0), m_range(family), </span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :         m_is_inparticle_iter(false), m_is_past_end(true)</span>
<a name="464"><span class="lineNum">     464 </span><span class="lineNoCov">          0 :     {}</span></a>
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :     GenVertex::edge_iterator::edge_iterator( const GenVertex&amp; vtx, </span>
<span class="lineNum">     467 </span>            :                                           IteratorRange range ) :
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :         m_vertex(&amp;vtx), m_range(family) </span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">     470 </span>            :         // Note: (26.1.2000) the original version of edge_iterator inheritted
<span class="lineNum">     471 </span>            :         //       from set&lt;GenParticle*&gt;::const_iterator() rather than using
<span class="lineNum">     472 </span>            :         //       composition as it does now.
<span class="lineNum">     473 </span>            :         //       The inheritted version suffered from a strange bug, which
<span class="lineNum">     474 </span>            :         //       I have not fully understood --- it only occurred after many
<span class="lineNum">     475 </span>            :         //       events were processed and only when I called the delete 
<span class="lineNum">     476 </span>            :         //       function on past events. I believe it had something to do with
<span class="lineNum">     477 </span>            :         //       the past the end values, which are now robustly coded in this
<span class="lineNum">     478 </span>            :         //       version as boolean members.
<span class="lineNum">     479 </span>            :         //
<span class="lineNum">     480 </span>            :         // default range is family, only other choices are children/parents
<span class="lineNum">     481 </span>            :         //    descendants/ancestors not allowed &amp; recasted ot children/parents
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :         if ( range == descendants || range == children ) m_range = children;</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :         if ( range == ancestors   || range == parents  ) m_range = parents;</span>
<span class="lineNum">     484 </span>            :         //
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :         if ( m_vertex-&gt;m_particles_in.empty() &amp;&amp;</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :              m_vertex-&gt;m_particles_out.empty() ) {</span>
<span class="lineNum">     487 </span>            :             // Case: particles_in and particles_out is empty.
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = false;</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :             m_is_past_end = true;</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :         } else if ( m_range == parents &amp;&amp; m_vertex-&gt;m_particles_in.empty() ){</span>
<span class="lineNum">     491 </span>            :             // Case: particles in is empty and parents is requested.
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = true;</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :             m_is_past_end = true;</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :         } else if ( m_range == children &amp;&amp; m_vertex-&gt;m_particles_out.empty() ){</span>
<span class="lineNum">     495 </span>            :             // Case: particles out is empty and children is requested.
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = false;</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :             m_is_past_end = true;</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :         } else if ( m_range == children ) {</span>
<span class="lineNum">     499 </span>            :             // Case: particles out is NOT empty, and children is requested
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :             m_set_iter = m_vertex-&gt;m_particles_out.begin();</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = false;</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :             m_is_past_end = false;</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :         } else if ( m_range == family &amp;&amp; m_vertex-&gt;m_particles_in.empty() ) {</span>
<span class="lineNum">     504 </span>            :             // Case: particles in is empty, particles out is NOT empty,
<span class="lineNum">     505 </span>            :             //       and family is requested. Then skip ahead to partilces out.
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :             m_set_iter = m_vertex-&gt;m_particles_out.begin();</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = false;</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :             m_is_past_end = false;</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     510 </span>            :             // Normal scenario: start with the first incoming particle
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :             m_set_iter = m_vertex-&gt;m_particles_in.begin();</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = true;</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :             m_is_past_end = false;</span>
<span class="lineNum">     514 </span>            :         }
<a name="515"><span class="lineNum">     515 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     516 </span>            : 
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     GenVertex::edge_iterator::edge_iterator( const edge_iterator&amp; p ) {</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :         *this = p;</span>
<a name="519"><span class="lineNum">     519 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     520 </span>            : 
<a name="521"><span class="lineNum">     521 </span><span class="lineNoCov">          0 :     GenVertex::edge_iterator::~edge_iterator() {}</span></a>
<span class="lineNum">     522 </span>            : 
<span class="lineNum">     523 </span>            :     GenVertex::edge_iterator&amp; GenVertex::edge_iterator::operator=(
<span class="lineNum">     524 </span>            :         const edge_iterator&amp; p ) {
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         m_vertex = p.m_vertex;</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :         m_range = p.m_range;</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :         m_set_iter = p.m_set_iter;</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :         m_is_inparticle_iter = p.m_is_inparticle_iter;</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :         m_is_past_end = p.m_is_past_end;</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :         return *this;</span>
<a name="531"><span class="lineNum">     531 </span>            :     }</a>
<span class="lineNum">     532 </span>            : 
<span class="lineNum">     533 </span>            :     GenParticle* GenVertex::edge_iterator::operator*(void) const {
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :         if ( !m_vertex || m_is_past_end ) return 0;</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :         return *m_set_iter;</span>
<a name="536"><span class="lineNum">     536 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     537 </span>            : 
<span class="lineNum">     538 </span>            :     GenVertex::edge_iterator&amp; GenVertex::edge_iterator::operator++(void){
<span class="lineNum">     539 </span>            :         // Pre-fix increment
<span class="lineNum">     540 </span>            :         //
<span class="lineNum">     541 </span>            :         // increment the set iterator (unless we're past the end value)
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :         if ( m_is_past_end ) return *this;</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :         ++m_set_iter;</span>
<span class="lineNum">     544 </span>            :         // handle cases where m_set_iter points past the end
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :         if ( m_range == family &amp;&amp; m_is_inparticle_iter &amp;&amp;</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :              m_set_iter == m_vertex-&gt;m_particles_in.end() ) {</span>
<span class="lineNum">     547 </span>            :             // at the end on in particle set, and range is family, so move to
<span class="lineNum">     548 </span>            :             // out particle set
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :             m_set_iter = m_vertex-&gt;m_particles_out.begin();</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :             m_is_inparticle_iter = false;</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :         } else if ( m_range == parents &amp;&amp; </span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :                     m_set_iter == m_vertex-&gt;m_particles_in.end() ) {</span>
<span class="lineNum">     553 </span>            :             // at the end on in particle set, and range is parents only, so
<span class="lineNum">     554 </span>            :             // move into past the end state
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :             m_is_past_end = true;</span>
<span class="lineNum">     556 </span>            :             // might as well bail out now
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :             return *this;</span>
<span class="lineNum">     558 </span>            :         } 
<span class="lineNum">     559 </span>            :         // are we iterating over input or output particles?
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :         if( m_is_inparticle_iter ) {</span>
<span class="lineNum">     561 </span>            :             // the following is not else if because we might have range=family
<span class="lineNum">     562 </span>            :             // with an empty particles_in set.  
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :             if ( m_set_iter == m_vertex-&gt;m_particles_in.end() ) {</span>
<span class="lineNum">     564 </span>            :                 //whenever out particles end is reached, go into past the end state
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :                 m_is_past_end = true;</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     567 </span>            :         } else {
<span class="lineNum">     568 </span>            :             // the following is not else if because we might have range=family
<span class="lineNum">     569 </span>            :             // with an empty particles_out set. 
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :             if ( m_set_iter == m_vertex-&gt;m_particles_out.end() ) {</span>
<span class="lineNum">     571 </span>            :                 //whenever out particles end is reached, go into past the end state
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :                 m_is_past_end = true;</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     574 </span>            :         }
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :         return *this;</span>
<a name="576"><span class="lineNum">     576 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     577 </span>            : 
<span class="lineNum">     578 </span>            :     GenVertex::edge_iterator GenVertex::edge_iterator::operator++(int){
<span class="lineNum">     579 </span>            :         // Post-fix increment
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :         edge_iterator returnvalue = *this;</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :         ++*this;</span>
<span class="lineNum">     582 </span>            :         return returnvalue;
<a name="583"><span class="lineNum">     583 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     584 </span>            : 
<span class="lineNum">     585 </span>            :     bool GenVertex::edge_iterator::is_parent() const {
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :         if ( **this &amp;&amp; (**this)-&gt;end_vertex() == m_vertex ) return true;</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :         return false;</span>
<a name="588"><span class="lineNum">     588 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span>            :     bool GenVertex::edge_iterator::is_child() const {
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :         if ( **this &amp;&amp; (**this)-&gt;production_vertex() == m_vertex ) return true;</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :         return false;</span>
<a name="593"><span class="lineNum">     593 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     594 </span>            : 
<span class="lineNum">     595 </span>            :     int GenVertex::edges_size( IteratorRange range ) const {
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :         if ( range == children ) return m_particles_out.size();</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :         if ( range == parents ) return m_particles_in.size();</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :         if ( range == family ) return m_particles_out.size()</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :                                       + m_particles_in.size();</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     602 </span>            : 
<span class="lineNum">     603 </span>            :     /////////////////////
<span class="lineNum">     604 </span>            :     // vertex_iterator //
<a name="605"><span class="lineNum">     605 </span>            :     /////////////////////</a>
<span class="lineNum">     606 </span>            :     
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     GenVertex::vertex_iterator::vertex_iterator() </span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :         : m_vertex(0), m_range(), m_visited_vertices(0), m_it_owns_set(0), </span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :           m_recursive_iterator(0)</span>
<a name="610"><span class="lineNum">     610 </span><span class="lineNoCov">          0 :     {}</span></a>
<span class="lineNum">     611 </span>            : 
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     GenVertex::vertex_iterator::vertex_iterator( GenVertex&amp; vtx_root,</span>
<span class="lineNum">     613 </span>            :                                               IteratorRange range )
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :         : m_vertex(&amp;vtx_root), m_range(range) </span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">     616 </span>            :         // standard public constructor
<span class="lineNum">     617 </span>            :         //
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :         m_visited_vertices = new std::set&lt;const GenVertex*&gt;;</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :         m_it_owns_set = 1;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :         m_visited_vertices-&gt;insert( m_vertex );</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :         m_recursive_iterator = 0;</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :         m_edge = m_vertex-&gt;edges_begin( m_range );</span>
<span class="lineNum">     623 </span>            :         // advance to the first good return value
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :         if ( !follow_edge_() &amp;&amp;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :              m_edge != m_vertex-&gt;edges_end( m_range )) ++*this;</span>
<a name="626"><span class="lineNum">     626 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     627 </span>            : 
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :     GenVertex::vertex_iterator::vertex_iterator( GenVertex&amp; vtx_root,</span>
<span class="lineNum">     629 </span>            :         IteratorRange range, std::set&lt;const HepMC::GenVertex*&gt;&amp; visited_vertices ) :
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :         m_vertex(&amp;vtx_root), m_range(range), </span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :         m_visited_vertices(&amp;visited_vertices), m_it_owns_set(0),</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :         m_recursive_iterator(0) </span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">     634 </span>            :         // This constuctor is only to be called internally by this class
<span class="lineNum">     635 </span>            :         //   for use with its recursive member pointer (m_recursive_iterator).
<span class="lineNum">     636 </span>            :         // Note: we do not need to insert m_vertex_root in the vertex - that is
<span class="lineNum">     637 </span>            :         //  the responsibility of this iterator's mother, which is normally
<span class="lineNum">     638 </span>            :         //  done just before calling this protected constructor.
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :         m_edge = m_vertex-&gt;edges_begin( m_range );</span>
<span class="lineNum">     640 </span>            :         // advance to the first good return value
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :         if ( !follow_edge_() &amp;&amp;</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :              m_edge != m_vertex-&gt;edges_end( m_range )) ++*this;</span>
<a name="643"><span class="lineNum">     643 </span><span class="lineNoCov">          0 :      }</span></a>
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     GenVertex::vertex_iterator::vertex_iterator( const vertex_iterator&amp; v_iter)</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :         : m_vertex(0), m_visited_vertices(0), m_it_owns_set(0), </span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :           m_recursive_iterator(0) </span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :     {</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :         *this = v_iter;</span>
<a name="650"><span class="lineNum">     650 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     651 </span>            : 
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :     GenVertex::vertex_iterator::~vertex_iterator() {</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator ) delete m_recursive_iterator;</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :         if ( m_it_owns_set ) delete m_visited_vertices;</span>
<a name="655"><span class="lineNum">     655 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     656 </span>            : 
<span class="lineNum">     657 </span>            :     GenVertex::vertex_iterator&amp; GenVertex::vertex_iterator::operator=( 
<span class="lineNum">     658 </span>            :         const vertex_iterator&amp; v_iter ) 
<span class="lineNum">     659 </span>            :     {
<span class="lineNum">     660 </span>            :         // Note: when copying a vertex_iterator that is NOT the owner
<span class="lineNum">     661 </span>            :         // of its set container, the pointer to the set is copied. Beware!
<span class="lineNum">     662 </span>            :         // (see copy_with_own_set() if you want a different set pointed to)
<span class="lineNum">     663 </span>            :         // In practise the user never needs to worry
<span class="lineNum">     664 </span>            :         // since such iterators are only intended to be used internally.
<span class="lineNum">     665 </span>            :         //
<span class="lineNum">     666 </span>            :         // destruct data member pointers
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator ) delete m_recursive_iterator;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :         m_recursive_iterator = 0;</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :         if ( m_it_owns_set ) delete m_visited_vertices;</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :         m_visited_vertices = 0;</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :         m_it_owns_set = 0;</span>
<span class="lineNum">     672 </span>            :         // copy the target vertex_iterator to this iterator 
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :         m_vertex = v_iter.m_vertex;</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :         m_range = v_iter.m_range;</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :         if ( v_iter.m_it_owns_set ) {</span>
<span class="lineNum">     676 </span>            :             // i.e. this vertex will own its set if v_iter points to any
<span class="lineNum">     677 </span>            :             // vertex set regardless of whether v_iter owns the set or not!
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :             m_visited_vertices = </span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :                 new std::set&lt;const GenVertex*&gt;(*v_iter.m_visited_vertices);</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :             m_it_owns_set = 1;</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :             m_visited_vertices = v_iter.m_visited_vertices;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :             m_it_owns_set = 0;</span>
<span class="lineNum">     684 </span>            :         }
<span class="lineNum">     685 </span>            :         //
<span class="lineNum">     686 </span>            :         // Note: m_vertex_root is already included in the set of 
<span class="lineNum">     687 </span>            :         //  tv_iter.m_visited_vertices, we do not need to insert it.
<span class="lineNum">     688 </span>            :         //
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :         m_edge = v_iter.m_edge;</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :         copy_recursive_iterator_( v_iter.m_recursive_iterator );</span>
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :         return *this;</span>
<a name="692"><span class="lineNum">     692 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     693 </span>            : 
<span class="lineNum">     694 </span>            :     GenVertex* GenVertex::vertex_iterator::operator*(void) const {
<span class="lineNum">     695 </span>            :         // de-reference operator
<span class="lineNum">     696 </span>            :         //
<span class="lineNum">     697 </span>            :         // if this iterator has an iterator_node, then we return the iterator
<span class="lineNum">     698 </span>            :         // node.
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator ) return  **m_recursive_iterator;</span>
<span class="lineNum">     700 </span>            :         //
<span class="lineNum">     701 </span>            :         // an iterator can only return its m_vertex -- any other vertex
<span class="lineNum">     702 </span>            :         //  is returned by means of a recursive iterator_node 
<span class="lineNum">     703 </span>            :         //  (so this is the only place in the iterator code that a vertex 
<span class="lineNum">     704 </span>            :         //   is returned!) 
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :         if ( m_vertex ) return m_vertex;</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :         return 0;</span>
<a name="707"><span class="lineNum">     707 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     708 </span>            : 
<span class="lineNum">     709 </span>            :     GenVertex::vertex_iterator&amp; GenVertex::vertex_iterator::operator++(void) {
<span class="lineNum">     710 </span>            :         // Pre-fix incremental operator
<span class="lineNum">     711 </span>            :         //
<span class="lineNum">     712 </span>            :         // check for &quot;past the end condition&quot; denoted by m_vertex=0
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :         if ( !m_vertex ) return *this;</span>
<span class="lineNum">     714 </span>            :         // if at the last edge, move into the &quot;past the end condition&quot;
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :         if ( m_edge == m_vertex-&gt;edges_end( m_range ) ) {</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :             m_vertex = 0;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :             return *this;</span>
<span class="lineNum">     718 </span>            :         }
<span class="lineNum">     719 </span>            :         // check to see if we need to create a new recursive iterator by
<span class="lineNum">     720 </span>            :         // following the current edge only if a recursive iterator doesn't
<span class="lineNum">     721 </span>            :         // already exist. If a new recursive_iterator is created, return it.
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :         if ( follow_edge_() ) {</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :               return *this;</span>
<span class="lineNum">     724 </span>            :         }
<span class="lineNum">     725 </span>            :         //
<span class="lineNum">     726 </span>            :         // if a recursive iterator already exists, increment it, and return its
<span class="lineNum">     727 </span>            :         // value (unless the recursive iterator has null root_vertex [its
<span class="lineNum">     728 </span>            :         // root vertex is set to null if it has already returned its root] 
<span class="lineNum">     729 </span>            :         // - in which case we delete it) 
<span class="lineNum">     730 </span>            :         // and return the vertex pointed to by the edge.
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator ) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :             ++(*m_recursive_iterator);</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :             if ( **m_recursive_iterator ) {</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :                 return *this;</span>
<span class="lineNum">     735 </span>            :             } else {
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :                 delete m_recursive_iterator;</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :                 m_recursive_iterator = 0;</span>
<span class="lineNum">     738 </span>            :             }
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     740 </span>            :         //
<span class="lineNum">     741 </span>            :         // increment to the next particle edge
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :         ++m_edge;</span>
<span class="lineNum">     743 </span>            :         // if m_edge is at the end, then we have incremented through all
<span class="lineNum">     744 </span>            :         // edges, and it is time to return m_vertex, which we accomplish
<span class="lineNum">     745 </span>            :         // by returning *this
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :         if ( m_edge == m_vertex-&gt;edges_end( m_range ) ) return *this;</span>
<span class="lineNum">     747 </span>            :         // otherwise we follow the current edge by recursively ++ing.
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :         return ++(*this);</span>
<a name="749"><span class="lineNum">     749 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     750 </span>            : 
<span class="lineNum">     751 </span>            :     GenVertex::vertex_iterator GenVertex::vertex_iterator::operator++(int) {
<span class="lineNum">     752 </span>            :         // Post-fix increment
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :         vertex_iterator returnvalue(*this);</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :         ++(*this);</span>
<span class="lineNum">     755 </span>            :         return returnvalue;
<a name="756"><span class="lineNum">     756 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     757 </span>            : 
<span class="lineNum">     758 </span>            :     void GenVertex::vertex_iterator::copy_with_own_set( 
<span class="lineNum">     759 </span>            :         const vertex_iterator&amp; v_iter, 
<span class="lineNum">     760 </span>            :         std::set&lt;const HepMC::GenVertex*&gt;&amp; visited_vertices ) {
<span class="lineNum">     761 </span>            :         /// intended for internal use only. (use with care!)
<span class="lineNum">     762 </span>            :         /// this is the same as the operator= method, but it allows the
<span class="lineNum">     763 </span>            :         /// user to specify which set container m_visited_vertices points to.
<span class="lineNum">     764 </span>            :         /// in all cases, this vertex will NOT own its set.
<span class="lineNum">     765 </span>            :         //
<span class="lineNum">     766 </span>            :         // destruct data member pointers
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator ) delete m_recursive_iterator;</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :         m_recursive_iterator = 0;</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :         if ( m_it_owns_set ) delete m_visited_vertices;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :         m_visited_vertices = 0;</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :         m_it_owns_set = false;</span>
<span class="lineNum">     772 </span>            :         // copy the target vertex_iterator to this iterator 
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :         m_vertex = v_iter.m_vertex;</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :         m_range = v_iter.m_range;</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :         m_visited_vertices = &amp;visited_vertices;</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :         m_it_owns_set = false;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :         m_edge = v_iter.m_edge;</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :         copy_recursive_iterator_( v_iter.m_recursive_iterator );</span>
<a name="779"><span class="lineNum">     779 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     780 </span>            : 
<span class="lineNum">     781 </span>            :     GenVertex* GenVertex::vertex_iterator::follow_edge_() {
<span class="lineNum">     782 </span>            :         // follows the edge pointed to by m_edge by creating a 
<span class="lineNum">     783 </span>            :         // recursive iterator for it.
<span class="lineNum">     784 </span>            :         //
<span class="lineNum">     785 </span>            :         // if a m_recursive_iterator already exists, 
<span class="lineNum">     786 </span>            :         // this routine has nothing to do,
<span class="lineNum">     787 </span>            :         // if there's no m_vertex, there's no point following anything, 
<span class="lineNum">     788 </span>            :         // also there's no point trying to follow a null edge.
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :         if ( m_recursive_iterator || !m_vertex || !*m_edge ) return 0;</span>
<span class="lineNum">     790 </span>            :         //
<span class="lineNum">     791 </span>            :         // if the range is parents, children, or family (i.e. &lt;= family)
<span class="lineNum">     792 </span>            :         // then only the iterator which owns the set is allowed to create
<span class="lineNum">     793 </span>            :         // recursive iterators (i.e. recursivity is only allowed to go one
<span class="lineNum">     794 </span>            :         // layer deep)
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :         if ( m_range &lt;= family &amp;&amp; m_it_owns_set == 0 ) return 0;</span>
<span class="lineNum">     796 </span>            :         //
<span class="lineNum">     797 </span>            :         // M.Dobbs 2001-07-16
<span class="lineNum">     798 </span>            :         // Take care of the very special-rare case where a particle might
<span class="lineNum">     799 </span>            :         // point to the same vertex for both production and end
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :         if ( (*m_edge)-&gt;production_vertex() == </span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :              (*m_edge)-&gt;end_vertex() ) return 0;</span>
<span class="lineNum">     802 </span>            :         //
<span class="lineNum">     803 </span>            :         // figure out which vertex m_edge is pointing to
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :         GenVertex* vtx = ( m_edge.is_parent() ? </span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :                         (*m_edge)-&gt;production_vertex() :</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :                         (*m_edge)-&gt;end_vertex() );</span>
<span class="lineNum">     807 </span>            :         // if the pointed to vertex doesn't exist or has already been visited, 
<span class="lineNum">     808 </span>            :         // then return null
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :         if ( !vtx || !(m_visited_vertices-&gt;insert(vtx).second) ) return 0;</span>
<span class="lineNum">     810 </span>            :         // follow that edge by creating a recursive iterator
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :         m_recursive_iterator = new vertex_iterator( *vtx, m_range,</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :                                                     *m_visited_vertices);</span>
<span class="lineNum">     813 </span>            :         // and return the vertex pointed to by m_recursive_iterator 
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :         return **m_recursive_iterator;</span>
<a name="815"><span class="lineNum">     815 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     816 </span>            :         
<span class="lineNum">     817 </span>            :     void GenVertex::vertex_iterator::copy_recursive_iterator_( 
<span class="lineNum">     818 </span>            :         const vertex_iterator* recursive_v_iter ) {
<span class="lineNum">     819 </span>            :         // to properly copy the recursive iterator, we need to ensure
<span class="lineNum">     820 </span>            :         // the proper set container is transfered ... then do this 
<span class="lineNum">     821 </span>            :         // operation .... you guessed it .... recursively!
<span class="lineNum">     822 </span>            :         //
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :         if ( !recursive_v_iter ) return;</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :         m_recursive_iterator = new vertex_iterator();</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;m_vertex = recursive_v_iter-&gt;m_vertex;</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;m_range = recursive_v_iter-&gt;m_range;</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;m_visited_vertices = m_visited_vertices;</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;m_it_owns_set = 0;</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;m_edge = recursive_v_iter-&gt;m_edge;</span>
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :         m_recursive_iterator-&gt;copy_recursive_iterator_( </span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :             recursive_v_iter-&gt;m_recursive_iterator );</span>
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     833 </span>            : 
<span class="lineNum">     834 </span>            :     ///////////////////////////////
<span class="lineNum">     835 </span>            :     // particle_iterator         //
<a name="836"><span class="lineNum">     836 </span>            :     ///////////////////////////////</a>
<span class="lineNum">     837 </span>            : 
<a name="838"><span class="lineNum">     838 </span><span class="lineNoCov">          0 :     GenVertex::particle_iterator::particle_iterator() {}</span></a>
<span class="lineNum">     839 </span>            : 
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     GenVertex::particle_iterator::particle_iterator( GenVertex&amp; vertex_root,</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :                                                      IteratorRange range ) {</span>
<span class="lineNum">     842 </span>            :         // General Purpose Constructor
<span class="lineNum">     843 </span>            :         //
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :         if ( range &lt;= family ) {</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :             m_edge = GenVertex::edge_iterator( vertex_root, range ); </span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :             m_vertex_iterator = GenVertex::vertex_iterator(vertex_root, range);</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :             m_edge = GenVertex::edge_iterator( **m_vertex_iterator, </span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :                                                   m_vertex_iterator.range() ); </span>
<span class="lineNum">     850 </span>            :         }
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :         advance_to_first_();</span>
<a name="852"><span class="lineNum">     852 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     853 </span>            : 
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :     GenVertex::particle_iterator::particle_iterator( </span>
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :         const particle_iterator&amp; p_iter ){</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :         *this = p_iter;</span>
<a name="857"><span class="lineNum">     857 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     858 </span>            : 
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :     GenVertex::particle_iterator::~particle_iterator() {}</span>
<a name="860"><span class="lineNum">     860 </span>            : </a>
<span class="lineNum">     861 </span>            :     GenVertex::particle_iterator&amp; 
<span class="lineNum">     862 </span>            :     GenVertex::particle_iterator::operator=( const particle_iterator&amp; p_iter )
<span class="lineNum">     863 </span>            :     {
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :         m_vertex_iterator = p_iter.m_vertex_iterator;</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :         m_edge = p_iter.m_edge;</span>
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :         return *this;</span>
<a name="867"><span class="lineNum">     867 </span>            :     }</a>
<span class="lineNum">     868 </span>            : 
<span class="lineNum">     869 </span>            :     GenParticle* GenVertex::particle_iterator::operator*(void) const {
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :         return *m_edge;</span>
<span class="lineNum">     871 </span>            :     }
<a name="872"><span class="lineNum">     872 </span>            : </a>
<span class="lineNum">     873 </span>            :     GenVertex::particle_iterator&amp; 
<span class="lineNum">     874 </span>            :     GenVertex::particle_iterator::operator++(void) {
<span class="lineNum">     875 </span>            :         //Pre-fix increment 
<span class="lineNum">     876 </span>            :         //
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :         if ( *m_edge ) {</span>
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :             ++m_edge;</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :         } else if ( *m_vertex_iterator ) {      // !*m_edge is implicit</span>
<span class="lineNum">     880 </span>            :             // past end of edge, but still have more vertices to visit
<span class="lineNum">     881 </span>            :             // increment the vertex, checking that the result is valid
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :             if ( !*(++m_vertex_iterator) ) return *this;</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :             m_edge = GenVertex::edge_iterator( **m_vertex_iterator, </span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :                                                   m_vertex_iterator.range() ); </span>
<span class="lineNum">     885 </span>            :         } else {        // !*m_edge and !*m_vertex_iterator are implicit
<span class="lineNum">     886 </span>            :             // past the end condition: do nothing
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :             return *this;</span>
<span class="lineNum">     888 </span>            :         }
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :         advance_to_first_();</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :         return *this;</span>
<a name="891"><span class="lineNum">     891 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     892 </span>            : 
<span class="lineNum">     893 </span>            :     GenVertex::particle_iterator GenVertex::particle_iterator::operator++(int){
<span class="lineNum">     894 </span>            :         //Post-fix increment
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :         particle_iterator returnvalue(*this);</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :         ++(*this);</span>
<span class="lineNum">     897 </span>            :         return returnvalue;
<a name="898"><span class="lineNum">     898 </span><span class="lineNoCov">          0 :     }</span></a>
<span class="lineNum">     899 </span>            : 
<span class="lineNum">     900 </span>            :     GenParticle* GenVertex::particle_iterator::advance_to_first_() {
<span class="lineNum">     901 </span>            :         /// if the current edge is not a suitable return value ( because
<span class="lineNum">     902 </span>            :         /// it is a parent of the vertex root that itself belongs to a 
<span class="lineNum">     903 </span>            :         /// different vertex ) it advances to the first suitable return value 
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :         if ( !*m_edge ) return *(++*this);</span>
<span class="lineNum">     905 </span>            :         // if the range is relatives, we need to uniquely assign each particle
<span class="lineNum">     906 </span>            :         // to a single vertex so as to guarantee particles are returned
<span class="lineNum">     907 </span>            :         // exactly once.
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :         if ( m_vertex_iterator.range() == relatives &amp;&amp;</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :              m_edge.is_parent() &amp;&amp; </span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :              (*m_edge)-&gt;production_vertex() ) return *(++*this);</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :         return *m_edge;</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span>            :     /// scale the position vector
<span class="lineNum">     915 </span>            :     /// this method is only for use by GenEvent
<a name="916"><span class="lineNum">     916 </span>            :     /// convert_position assumes that 4th component of the position vector </a>
<span class="lineNum">     917 </span>            :     /// is ctau rather than time and has units of length-time
<span class="lineNum">     918 </span>            :     void GenVertex::convert_position( const double&amp; f ) {
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :         m_position = FourVector( f*m_position.x(),</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :                                  f*m_position.y(),</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :                                  f*m_position.z(),</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :                                  f*m_position.t() );</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     924 </span>            : 
<span class="lineNum">     925 </span>            : } // HepMC
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
