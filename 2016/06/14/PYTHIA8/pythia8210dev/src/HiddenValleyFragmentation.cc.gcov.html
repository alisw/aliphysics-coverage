<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - PYTHIA8/pythia8210dev/src/HiddenValleyFragmentation.cc</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">PYTHIA8/pythia8210dev/src</a> - HiddenValleyFragmentation.cc<span style="font-size: 80%;"> (source / <a href="HiddenValleyFragmentation.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">188</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">11</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // HiddenValleyFragmentation.cc is a part of the PYTHIA event generator.</a>
<span class="lineNum">       2 </span>            : // Copyright (C) 2015 Torbjorn Sjostrand.
<span class="lineNum">       3 </span>            : // PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.
<span class="lineNum">       4 </span>            : // Please respect the MCnet Guidelines, see GUIDELINES for details.
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : // Function definitions (not found in the header) for the
<span class="lineNum">       7 </span>            : // HiddenValleyFragmentation class and its helper classes.
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : #include &quot;Pythia8/HiddenValleyFragmentation.h&quot;
<span class="lineNum">      10 </span>            : 
<span class="lineNum">      11 </span>            : namespace Pythia8 {
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            : //==========================================================================
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : // The HVStringFlav class is used to select HV-quark and HV-hadron flavours.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      18 </span>            : 
<a name="19"><span class="lineNum">      19 </span>            : // Initialize data members of the flavour generation.</a>
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : void HVStringFlav::init(Settings&amp; settings, Rndm* rndmPtrIn) {
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            :   // Save pointer.
<span class="lineNum">      24 </span><span class="lineNoCov">          0 :   rndmPtr    = rndmPtrIn;</span>
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            :   // Read in data from Settings.
<span class="lineNum">      27 </span><span class="lineNoCov">          0 :   nFlav      = settings.mode(&quot;HiddenValley:nFlav&quot;);</span>
<span class="lineNum">      28 </span><span class="lineNoCov">          0 :   probVector = settings.parm(&quot;HiddenValley:probVector&quot;);</span>
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      33 </span>            : 
<a name="34"><span class="lineNum">      34 </span>            : // Pick a new HV-flavour given an incoming one.</a>
<span class="lineNum">      35 </span>            : 
<span class="lineNum">      36 </span>            : FlavContainer HVStringFlav::pick(FlavContainer&amp; flavOld) {
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            :   // Initial values for new flavour.
<span class="lineNum">      39 </span><span class="lineNoCov">          0 :   FlavContainer flavNew;</span>
<span class="lineNum">      40 </span><span class="lineNoCov">          0 :   flavNew.rank = flavOld.rank + 1;</span>
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            :   // Pick new HV-flavour at random; keep track of sign.
<span class="lineNum">      43 </span><span class="lineNoCov">          0 :   flavNew.id = 4900100 + min( 1 + int(nFlav * rndmPtr-&gt;flat()), nFlav);</span>
<span class="lineNum">      44 </span><span class="lineNoCov">          0 :   if (flavOld.id &gt; 0) flavNew.id = -flavNew.id;</span>
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            :   // Done.
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :   return flavNew;</span>
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : }
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span>            : // Combine two HV-flavours to produce an HV-hadron.
<a name="54"><span class="lineNum">      54 </span>            : // This is simplified procedure, assuming only two HV mesons defined.</a>
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span>            : int HVStringFlav::combine(FlavContainer&amp; flav1, FlavContainer&amp; flav2) {
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            :   // Positive and negative flavour. Note that with kinetic mixing
<span class="lineNum">      59 </span>            :   // the Fv are really intended to represent qv, so remap.
<span class="lineNum">      60 </span>            :   int idMeson = 0;
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :   int idPos =  max( flav1.id, flav2.id) - 4900000;</span>
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :   int idNeg = -min( flav1.id, flav2.id) - 4900000;</span>
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   if (idPos &lt; 20) idPos = 101;</span>
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   if (idNeg &lt; 20) idNeg = 101;</span>
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            :   // Pick HV-meson code, spin either 0 or 1.
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   if (idNeg == idPos)     idMeson =  4900111;</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   else if (idPos &gt; idNeg) idMeson =  4900211;</span>
<span class="lineNum">      69 </span>            :   else                    idMeson = -4900211;
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   if (rndmPtr-&gt;flat() &lt; probVector) idMeson += ((idMeson &gt; 0) ? 2 : -2);</span>
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span>            :   // Done.
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   return idMeson;</span>
<span class="lineNum">      74 </span>            : 
<span class="lineNum">      75 </span>            : }
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span>            : //==========================================================================
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : // The HVStringPT class is used to select pT in HV fragmentation.
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">      82 </span>            : 
<a name="83"><span class="lineNum">      83 </span>            : // Initialize data members of the string pT selection.</a>
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span>            : void HVStringPT::init(Settings&amp; settings, ParticleData&amp; particleData,
<span class="lineNum">      86 </span>            :   Rndm* rndmPtrIn) {
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            :   // Save pointer.
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :   rndmPtr        = rndmPtrIn;</span>
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            :   // Parameter of the pT width. No enhancement, since this is finetuning.
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :   double sigmamqv  = settings.parm(&quot;HiddenValley:sigmamqv&quot;);</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :   double sigma     = sigmamqv * particleData.m0( 4900101);</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :   sigmaQ           = sigma / sqrt(2.);</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   enhancedFraction = 0.;</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :   enhancedWidth    = 0.;</span>
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            :   // Parameter for pT suppression in MiniStringFragmentation.
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :   sigma2Had        = 2. * pow2( max( SIGMAMIN, sigma) );</span>
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : //==========================================================================
<span class="lineNum">     104 </span>            : 
<span class="lineNum">     105 </span>            : // The HVStringZ class is used to select z in HV fragmentation.
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     108 </span>            : 
<a name="109"><span class="lineNum">     109 </span>            : // Initialize data members of the string z selection.</a>
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span>            : void HVStringZ::init(Settings&amp; settings, ParticleData&amp; particleData,
<span class="lineNum">     112 </span>            :   Rndm* rndmPtrIn) {
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span>            :   // Save pointer.
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :   rndmPtr  = rndmPtrIn;</span>
<span class="lineNum">     116 </span>            : 
<span class="lineNum">     117 </span>            :   // Paramaters of Lund/Bowler symmetric fragmentation function.
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :   aLund    = settings.parm(&quot;HiddenValley:aLund&quot;);</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :   bmqv2    = settings.parm(&quot;HiddenValley:bmqv2&quot;);</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :   rFactqv  = settings.parm(&quot;HiddenValley:rFactqv&quot;);</span>
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span>            :   // Use qv mass to set scale of bEff = b * m^2;
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :   mqv2     = pow2( particleData.m0( 4900101) );</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :   bLund    = bmqv2 / mqv2;</span>
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span>            :   // Mass of qv meson used to set stop scale for fragmentation iteration.
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   mhvMeson = particleData.m0( 4900111);</span>
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     132 </span>            : 
<a name="133"><span class="lineNum">     133 </span>            : // Generate the fraction z that the next hadron will take using Lund/Bowler.</a>
<span class="lineNum">     134 </span>            : 
<span class="lineNum">     135 </span>            : double HVStringZ::zFrag( int , int , double mT2) {
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :   // Shape parameters of Lund symmetric fragmentation function.
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :   double bShape = bLund * mT2;</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :   double cShape = 1. + rFactqv * bmqv2;</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :   return zLund( aLund, bShape, cShape);</span>
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            : }
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span>            : //==========================================================================
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span>            : // The HiddenValleyFragmentation class.
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     149 </span>            : 
<a name="150"><span class="lineNum">     150 </span>            : // Initialize and save pointers.</a>
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span>            : bool HiddenValleyFragmentation::init(Info* infoPtrIn, Settings&amp; settings,
<span class="lineNum">     153 </span>            :   ParticleData* particleDataPtrIn, Rndm* rndmPtrIn) {
<span class="lineNum">     154 </span>            : 
<span class="lineNum">     155 </span>            :   // Save pointers.
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   infoPtr         = infoPtrIn;</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   particleDataPtr = particleDataPtrIn;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   rndmPtr         = rndmPtrIn;</span>
<span class="lineNum">     159 </span>            : 
<span class="lineNum">     160 </span>            :   // Check whether Hidden Valley fragmentation switched on, and SU(N).
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :   doHVfrag = settings.flag(&quot;HiddenValley:fragment&quot;);</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :   if (settings.mode(&quot;HiddenValley:Ngauge&quot;) &lt; 2) doHVfrag = false;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :   if (!doHVfrag) return false;</span>
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            :   // Several copies of qv may be needed. Taken to have same mass.
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   nFlav = settings.mode(&quot;HiddenValley:nFlav&quot;);</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   if (nFlav &gt; 1) {</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :     int spinType = particleDataPtr-&gt;spinType(4900101);</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :     double m0    = particleDataPtr-&gt;m0(4900101);</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     for (int iFlav = 2; iFlav &lt;= nFlav; ++iFlav)</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :       particleDataPtr-&gt;addParticle( 4900100 + iFlav, &quot;qv&quot;, &quot;qvbar&quot;,</span>
<span class="lineNum">     172 </span>            :       spinType, 0, 0, m0);
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span>            :   // Hidden Valley meson mass used to choose hadronization mode.
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   mhvMeson = particleDataPtr-&gt;m0(4900111);</span>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span>            :   // Initialize the hvEvent instance of an event record.
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :   hvEvent.init( &quot;(Hidden Valley fragmentation)&quot;, particleDataPtr);</span>
<span class="lineNum">     180 </span>            : 
<span class="lineNum">     181 </span>            :   // Create HVStringFlav instance for HV-flavour selection.
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :   hvFlavSelPtr = new HVStringFlav();</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :   hvFlavSelPtr-&gt;init( settings, rndmPtr);</span>
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span>            :   // Create HVStringPT instance for pT selection in HV fragmentation.
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :   hvPTSelPtr = new HVStringPT();</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   hvPTSelPtr-&gt;init( settings, *particleDataPtr, rndmPtr);</span>
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            :   // Create HVStringZ instance for z selection in HV fragmentation.
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   hvZSelPtr = new HVStringZ();</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   hvZSelPtr-&gt;init( settings, *particleDataPtr, rndmPtr);</span>
<span class="lineNum">     192 </span>            : 
<span class="lineNum">     193 </span>            :   // Initialize auxiliary administrative class.
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :   hvColConfig.init(infoPtr, settings, hvFlavSelPtr);</span>
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span>            :   // Initialize HV-string and HV-ministring fragmentation.
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :   hvStringFrag.init(infoPtr, settings, particleDataPtr, rndmPtr,</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :     hvFlavSelPtr, hvPTSelPtr, hvZSelPtr);</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   hvMinistringFrag.init(infoPtr, settings, particleDataPtr, rndmPtr,</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :     hvFlavSelPtr, hvPTSelPtr, hvZSelPtr);</span>
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span>            :   // Done.
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   return true;</span>
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     208 </span>            : 
<a name="209"><span class="lineNum">     209 </span>            : // Perform the fragmentation.</a>
<span class="lineNum">     210 </span>            : 
<span class="lineNum">     211 </span>            : bool HiddenValleyFragmentation::fragment(Event&amp; event) {
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            :   // Reset containers for next event.
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :   hvEvent.reset();</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :   hvColConfig.clear();</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   ihvParton.resize(0);</span>
<span class="lineNum">     217 </span>            : 
<span class="lineNum">     218 </span>            :   // Extract HV-particles from event to hvEvent. Assign HV-colours.
<span class="lineNum">     219 </span>            :   // Done if no HV-particles found.
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   if (!extractHVevent(event)) return true;</span>
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span>            :   // Store found string system. Analyze its properties.
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :   if (!hvColConfig.insert(ihvParton, hvEvent)) return false;</span>
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span>            :   // Collect sequentially all partons in the HV subsystem.
<span class="lineNum">     226 </span>            :   // Copy also if already in order, or else history tracing may fail.
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :   hvColConfig.collect(0, hvEvent, false);</span>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span>            :   // Mass used to decide how to fragment system.
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :   mSys = hvColConfig[0].mass;</span>
<span class="lineNum">     231 </span>            : 
<span class="lineNum">     232 </span>            :   // HV-string fragmentation when enough mass to produce &gt;= 3 HV-mesons.
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   if (mSys &gt; 3.5 * mhvMeson) {</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :     if (!hvStringFrag.fragment( 0, hvColConfig, hvEvent)) return false;</span>
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span>            :   // HV-ministring fragmentation when enough mass to produce 2 HV-mesons.
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :   } else if (mSys &gt; 2.1 * mhvMeson) {</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :     if (!hvMinistringFrag.fragment( 0, hvColConfig, hvEvent, true))</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            :   // If only enough mass for one HV-meson assume HV-glueballs emitted.
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :   } else if (!collapseToMeson()) return false;</span>
<span class="lineNum">     243 </span>            : 
<span class="lineNum">     244 </span>            :   // Insert HV particles from hvEvent to event.
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :   insertHVevent(event);</span>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span>            :   // Done.
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :   return true;</span>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     253 </span>            : 
<a name="254"><span class="lineNum">     254 </span>            : // Extract HV-particles from event to hvEvent. Assign HV-colours.</a>
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span>            : bool HiddenValleyFragmentation::extractHVevent(Event&amp; event) {
<span class="lineNum">     257 </span>            : 
<span class="lineNum">     258 </span>            :   // Copy Hidden-Valley particles to special event record.
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; event.size(); ++i) {</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :     int idAbs = event[i].idAbs();</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :     bool isHV = (idAbs &gt; 4900000 &amp;&amp; idAbs &lt; 4900007)</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :              || (idAbs &gt; 4900010 &amp;&amp; idAbs &lt; 4900017)</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :              || idAbs == 4900021 || idAbs == 4900101;</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     if (isHV) {</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :       int iHV = hvEvent.append( event[i]);</span>
<span class="lineNum">     266 </span>            :       // Convert HV-gluons into normal ones so as to use normal machinery.
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :       if (event[i].id() ==  4900021) hvEvent[iHV].id(21);</span>
<span class="lineNum">     268 </span>            :       // Second mother points back to position in complete event;
<span class="lineNum">     269 </span>            :       // otherwise construct the HV history inside hvEvent.
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :       hvEvent[iHV].mothers( 0, i);</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :       hvEvent[iHV].daughters( 0, 0);</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :       int iMother = event[i].mother1();</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :       for (int iHVM = 1; iHVM &lt; hvEvent.size(); ++iHVM)</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :       if (hvEvent[iHVM].mother2() == iMother) {</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :         hvEvent[iHV].mother1( iHVM);</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :         if (hvEvent[iHVM].daughter1() == 0) hvEvent[iHVM].daughter1(iHV);</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :         else                                hvEvent[iHVM].daughter2(iHV);</span>
<span class="lineNum">     278 </span>            :       }
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     280 </span>            :   }
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span>            :   // Done if no HV particles found.
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :   hvOldSize = hvEvent.size();</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   if (hvOldSize == 1) return false;</span>
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span>            :   // Initial colour - anticolour parton pair.
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   int colBeg = hvEvent.nextColTag();</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   for (int iHV = 1; iHV &lt; hvOldSize; ++iHV)</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :   if (hvEvent[iHV].mother1() == 0) {</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :     if (hvEvent[iHV].id() &gt; 0) hvEvent[iHV].col( colBeg);</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     else                       hvEvent[iHV].acol( colBeg);</span>
<span class="lineNum">     292 </span>            :   }
<span class="lineNum">     293 </span>            : 
<span class="lineNum">     294 </span>            :   // Then trace colours down to daughters; new colour if two daughters.
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :   for (int iHV = 1; iHV &lt; hvOldSize; ++iHV) {</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     int dau1 = hvEvent[iHV].daughter1();</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :     int dau2 = hvEvent[iHV].daughter2();</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :     if (dau1 &gt; 0 &amp;&amp; dau2 == 0)</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :       hvEvent[dau1].cols( hvEvent[iHV].col(), hvEvent[iHV].acol());</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :     else if (dau2 &gt; 0) {</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :       int colHV  = hvEvent[iHV].col();</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :       int acolHV = hvEvent[iHV].acol();</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :       int colNew = hvEvent.nextColTag();</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :       if (acolHV == 0) {</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :         hvEvent[dau1].cols( colNew, 0);</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :         hvEvent[dau2].cols( colHV, colNew);</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       } else if (colHV == 0) {</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :         hvEvent[dau1].cols( 0, colNew);</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         hvEvent[dau2].cols( colNew, acolHV);</span>
<span class="lineNum">     310 </span>            :       // Temporary: should seek recoiling dipole end!??
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       } else if (rndmPtr-&gt;flat() &gt; 0.5) {</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :         hvEvent[dau1].cols( colHV, colNew);</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :         hvEvent[dau2].cols( colNew, acolHV);</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :       } else {</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :         hvEvent[dau1].cols( colNew, acolHV);</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :         hvEvent[dau2].cols( colHV, colNew);</span>
<span class="lineNum">     317 </span>            :       }
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     319 </span>            :   }
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span>            :   // Pick up the colour end.
<span class="lineNum">     322 </span>            :   int colNow = 0;
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :   for (int iHV = 1; iHV &lt; hvOldSize; ++iHV)</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :   if (hvEvent[iHV].isFinal() &amp;&amp; hvEvent[iHV].acol() == 0) {</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :     ihvParton.push_back( iHV);</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     colNow = hvEvent[iHV].col();</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     328 </span>            : 
<span class="lineNum">     329 </span>            :   // Trace colour by colour until reached anticolour end.
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   while (colNow &gt; 0) {</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     for (int iHV = 1; iHV &lt; hvOldSize; ++iHV)</span>
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :     if (hvEvent[iHV].isFinal() &amp;&amp; hvEvent[iHV].acol() == colNow) {</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :       ihvParton.push_back( iHV);</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :       colNow = hvEvent[iHV].col();</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     336 </span>            :     }
<span class="lineNum">     337 </span>            :   }
<span class="lineNum">     338 </span>            : 
<span class="lineNum">     339 </span>            :   // Done.
<span class="lineNum">     340 </span>            :   return true;
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     345 </span>            : 
<a name="346"><span class="lineNum">     346 </span>            : // Collapse of light system to one HV-meson, by the emission of HV-glueballs.</a>
<span class="lineNum">     347 </span>            : 
<span class="lineNum">     348 </span>            : bool HiddenValleyFragmentation::collapseToMeson() {
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span>            :   // If too low mass then cannot do anything. Should not happen.
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :   if (mSys &lt; 1.001 * mhvMeson) {</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :     infoPtr-&gt;errorMsg(&quot;Error in HiddenValleyFragmentation::collapseToMeson:&quot;</span>
<span class="lineNum">     353 </span>            :       &quot; too low mass to do anything&quot;);
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">     355 </span>            :   }
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span>            :   // Choose mass of collective HV-glueball states flat between limits.
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :   double mhvGlue = (0.001 + 0.998 * rndmPtr-&gt;flat()) * (mSys - mhvMeson);</span>
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span>            :   // Find momentum in rest frame, with isotropic &quot;decay&quot; angles.
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :   double pAbs = 0.5 * sqrtpos( pow2(mSys*mSys - mhvMeson*mhvMeson</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :     - mhvGlue*mhvGlue) - pow2(2. * mhvMeson * mhvGlue) ) / mSys;</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :   double pz   = (2 * rndmPtr-&gt;flat() - 1.) * pAbs;</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :   double pT   = sqrtpos( pAbs*pAbs - pz*pz);</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :   double phi  = 2. * M_PI * rndmPtr-&gt;flat();</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :   double px   = pT * cos(phi);</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :   double py   = pT * sin(phi);</span>
<span class="lineNum">     368 </span>            : 
<span class="lineNum">     369 </span>            :   // Construct four-vectors and boost them to event frame.
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :   Vec4 phvMeson( px, py, pz, sqrt(mhvMeson*mhvMeson + pAbs*pAbs) );</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   Vec4 phvGlue( -px, -py, -pz, sqrt(mhvGlue*mhvGlue + pAbs*pAbs) );</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :   phvMeson.bst( hvColConfig[0].pSum );</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :   phvGlue.bst(  hvColConfig[0].pSum );</span>
<span class="lineNum">     374 </span>            : 
<span class="lineNum">     375 </span>            :   // Add produced particles to the event record.
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   vector&lt;int&gt; iParton = hvColConfig[0].iParton;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :   int iFirst = hvEvent.append( 4900111, 82,  iParton.front(),</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :     iParton.back(), 0, 0, 0, 0, phvMeson, mhvMeson);</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :   int iLast  = hvEvent.append( 4900991, 82,  iParton.front(),</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :     iParton.back(), 0, 0, 0, 0, phvGlue, mhvGlue);</span>
<span class="lineNum">     381 </span>            : 
<span class="lineNum">     382 </span>            :   // Mark original partons as hadronized and set their daughter range.
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   for (int i = 0; i &lt; int(iParton.size()); ++i) {</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     hvEvent[ iParton[i] ].statusNeg();</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     hvEvent[ iParton[i] ].daughters(iFirst, iLast);</span>
<span class="lineNum">     386 </span>            :   }
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span>            :   // Done.
<span class="lineNum">     389 </span>            :   return true;
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     394 </span>            : 
<a name="395"><span class="lineNum">     395 </span>            : // Insert HV-particles from hvEvent to event.</a>
<span class="lineNum">     396 </span>            : 
<span class="lineNum">     397 </span>            : bool HiddenValleyFragmentation::insertHVevent(Event&amp; event) {
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span>            :   // Offset for mother/daughter indices.
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :   hvNewSize = hvEvent.size();</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :   int nOffset = event.size() - hvOldSize;</span>
<span class="lineNum">     402 </span>            : 
<span class="lineNum">     403 </span>            :   // Copy back HV-particles.
<span class="lineNum">     404 </span>            :   int iNew, iMot1, iMot2, iDau1, iDau2;
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   for (int iHV = hvOldSize; iHV &lt; hvNewSize; ++iHV) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :     iNew = event.append( hvEvent[iHV]);</span>
<span class="lineNum">     407 </span>            : 
<span class="lineNum">     408 </span>            :     // Restore HV-gluon codes. Do not keep HV-colours, to avoid confusion.
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :     if (hvEvent[iHV].id() == 21) event[iNew].id(4900021);</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     event[iNew].cols( 0, 0);</span>
<span class="lineNum">     411 </span>            : 
<span class="lineNum">     412 </span>            :     // Begin history construction.
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :     iMot1 = hvEvent[iHV].mother1();</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :     iMot2 = hvEvent[iHV].mother2();</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :     iDau1 = hvEvent[iHV].daughter1();</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :     iDau2 = hvEvent[iHV].daughter2();</span>
<span class="lineNum">     417 </span>            :     // Special mother for partons copied from event, else simple offset.
<span class="lineNum">     418 </span>            :     // Also set daughters of mothers in original record.
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     if (iMot1 &gt; 0 &amp;&amp; iMot1 &lt; hvOldSize) {</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :       iMot1 = hvEvent[iMot1].mother2();</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :       event[iMot1].statusNeg();</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :       event[iMot1].daughter1(iNew);</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :     } else if (iMot1 &gt; 0) iMot1 += nOffset;</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :     if (iMot2 &gt; 0 &amp;&amp; iMot2 &lt; hvOldSize) {</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :       iMot2 = hvEvent[iMot2].mother2();</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :       event[iMot2].statusNeg();</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :       if (event[iMot2].daughter1() == 0) event[iMot2].daughter1(iNew);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :       else                               event[iMot2].daughter2(iNew);</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :     } else if (iMot2 &gt; 0) iMot2 += nOffset;</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :     if (iDau1 &gt; 0) iDau1 += nOffset;</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :     if (iDau2 &gt; 0) iDau2 += nOffset;</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     event[iNew].mothers( iMot1, iMot2);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :     event[iNew].daughters( iDau1, iDau2);</span>
<span class="lineNum">     434 </span>            :   }
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span>            :   // Done.
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   return true;</span>
<span class="lineNum">     438 </span>            : 
<span class="lineNum">     439 </span>            : }
<span class="lineNum">     440 </span>            : 
<span class="lineNum">     441 </span>            : //==========================================================================
<span class="lineNum">     442 </span>            : 
<span class="lineNum">     443 </span>            : } // end namespace Pythia8
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
