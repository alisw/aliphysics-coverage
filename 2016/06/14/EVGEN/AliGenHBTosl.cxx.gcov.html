<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - EVGEN/AliGenHBTosl.cxx</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">EVGEN</a> - AliGenHBTosl.cxx<span style="font-size: 80%;"> (source / <a href="AliGenHBTosl.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">990</td>
            <td class="headerCovTableEntryLo">0.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">37</td>
            <td class="headerCovTableEntryLo">2.7 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : #include &quot;AliGenHBTosl.h&quot; 
<span class="lineNum">      19 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      20 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      21 </span>            : #include &lt;fstream&gt;
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            : //__________________________________________________________
<span class="lineNum">      24 </span>            : /////////////////////////////////////////////////////////////
<span class="lineNum">      25 </span>            : //                                                         //
<span class="lineNum">      26 </span>            : //  class AliGenHBTosl                                     //
<span class="lineNum">      27 </span>            : //                                                         //
<span class="lineNum">      28 </span>            : //  Genarator simulating particle correlations             //
<span class="lineNum">      29 </span>            : //                                                         //
<span class="lineNum">      30 </span>            : //  The main idea of the generator is to produce particles //
<span class="lineNum">      31 </span>            : //  according to some distribution of two particle         //
<span class="lineNum">      32 </span>            : //  property. In HBT they are qout,qsie and qlong.         //
<span class="lineNum">      33 </span>            : //  In order to be able to generate signal that produces   //
<span class="lineNum">      34 </span>            : //  given two particle correlation background must be      //
<span class="lineNum">      35 </span>            : //  known before in order to produce the shape of signal   //
<span class="lineNum">      36 </span>            : //  to randomize given distribution from.                  //
<span class="lineNum">      37 </span>            : //                                                         //
<span class="lineNum">      38 </span>            : //  The generator works as follows:                        //
<span class="lineNum">      39 </span>            : //  1. Coarse Background (fQCoarseBackground) is generated //
<span class="lineNum">      40 </span>            : //     ade  from the particles                             //
<span class="lineNum">      41 </span>            : //     given by the external generator (variable           //
<span class="lineNum">      42 </span>            : //     fGenerator) by the mixing technique.                //
<span class="lineNum">      43 </span>            : //  2. Coarse signal is prduced by multiplying Coarse      //
<span class="lineNum">      44 </span>            : //     background by a required function                   //
<span class="lineNum">      45 </span>            : //     See method FillCoarseSignal                         //
<span class="lineNum">      46 </span>            : //  3. Signal is randomized out of the coarse signal       //
<span class="lineNum">      47 </span>            : //     histogram (two particle property). First particle   //
<span class="lineNum">      48 </span>            : //     is taken from the external generator, and the       //
<span class="lineNum">      49 </span>            : //     second one is CALCULATED on the basis of the first  //
<span class="lineNum">      50 </span>            : //     one and the two particle property (qout,qside,qlong)//
<span class="lineNum">      51 </span>            : //     Background is made by the mixing out of the         //
<span class="lineNum">      52 </span>            : //     genereted signal events.                            //
<span class="lineNum">      53 </span>            : //     This step is cotinued up to the moment signal       //
<span class="lineNum">      54 </span>            : //     histogram has enough statistics (data member        //
<span class="lineNum">      55 </span>            : //     fMinFill)                                           //
<span class="lineNum">      56 </span>            : //     See method StartSignalPass1()                       //
<span class="lineNum">      57 </span>            : //  4. chi is calculated for each bin (chiarray variqable) // 
<span class="lineNum">      58 </span>            : //     (not the chi2 because sign is important)            //
<span class="lineNum">      59 </span>            : //     Two particle prioperty                              //
<span class="lineNum">      60 </span>            : //     (qout,qside,qlong) is chosen at the points that     //
<span class="lineNum">      61 </span>            : //     chi is the smallest. First particle is taken from   //
<span class="lineNum">      62 </span>            : //     the the external generator (fGenerator) and second's /
<span class="lineNum">      63 </span>            : //     momenta are caclulated out of their momenta and     //
<span class="lineNum">      64 </span>            : //     (qout,qside,qlong). Background is updated           //
<span class="lineNum">      65 </span>            : //     continuesely for all the events. This step is       //
<span class="lineNum">      66 </span>            : //     continued until stability conditions are fullfiled  //
<span class="lineNum">      67 </span>            : //     or maximum number of iteration is reached.          //
<span class="lineNum">      68 </span>            : //  5. The same as step 4 but events are stored.           //
<span class="lineNum">      69 </span>            : //                                                         //
<span class="lineNum">      70 </span>            : ////////////////////////////////////////////////////////////
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span>            : #include &lt;TCanvas.h&gt;
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            : 
<span class="lineNum">      75 </span>            : #include &lt;TH3D.h&gt;
<span class="lineNum">      76 </span>            : #include &lt;TList.h&gt;
<span class="lineNum">      77 </span>            : #include &lt;TPDGCode.h&gt;
<span class="lineNum">      78 </span>            : #include &lt;TParticle.h&gt;
<span class="lineNum">      79 </span>            : #include &lt;AliStack.h&gt;
<span class="lineNum">      80 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      81 </span>            : #include &lt;TVector3.h&gt;
<span class="lineNum">      82 </span>            : #include &lt;TStopwatch.h&gt;
<span class="lineNum">      83 </span>            : #include &lt;TFile.h&gt;
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span>            : #include &quot;AliGenCocktailAfterBurner.h&quot;
<span class="lineNum">      86 </span>            : #include &quot;AliGeVSimParticle.h&quot;
<span class="lineNum">      87 </span>            : #include &quot;AliGenGeVSim.h&quot;
<span class="lineNum">      88 </span>            : #include &quot;AliGenHIJINGpara.h&quot;
<span class="lineNum">      89 </span>            : 
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            : /***********************************************************/
<span class="lineNum">      92 </span>            : using std::cout;
<span class="lineNum">      93 </span>            : using std::endl;
<a name="94"><span class="lineNum">      94 </span>            : using std::ofstream;</a>
<span class="lineNum">      95 </span>            : using std::ios;
<a name="96"><span class="lineNum">      96 </span><span class="lineCov">          6 : ClassImp(AliGenHBTosl)</span></a>
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : AliGenHBTosl::AliGenHBTosl():
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :  AliGenerator(),</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :  fQCoarseBackground(0x0),</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :  fQCoarseSignal(0x0),</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :  fQSignal(0x0),</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :  fQBackground(0x0),</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :  fQSecondSignal(0x0),</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :  fQSecondBackground(0x0),</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :  fQRange(0.06),</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :  fQNBins(60),</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :  fGenerator(0x0),</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :  fStackBuffer(0),</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :  fBufferSize(5),</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :  fNBinsToScale(Int_t(fQNBins*0.1)),</span>
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :  fDebug(0),</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :  fSignalShapeCreated(0),</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :  fMaxIterations(1000),</span>
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :  fMaxChiSquereChange(0.01),</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :  fMaxChiSquerePerNDF(1.5), </span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :  fQRadius(8.0),</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :  fPID(kPiPlus),</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :  fSamplePhiMin(-0.01),</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :  fSamplePhiMax(TMath::TwoPi()+0.01),</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :  fSignalRegion(0.0),</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :  fMinFill(1000),</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :  fSwapped(0),</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :  fLogFile(0x0)</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     126 </span>            : //default constructor
<span class="lineNum">     127 </span><span class="lineNoCov">          0 : }</span>
<a name="128"><span class="lineNum">     128 </span>            : /***********************************************************/</a>
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : AliGenHBTosl::AliGenHBTosl(Int_t n, Int_t pid):
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :  AliGenerator(n),</span>
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :  fQCoarseBackground(0x0),</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :  fQCoarseSignal(0x0),</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :  fQSignal(0x0),</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :  fQBackground(0x0),</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :  fQSecondSignal(0x0),</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :  fQSecondBackground(0x0),</span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :  fQRange(0.06),</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :  fQNBins(60),</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :  fGenerator(0x0),</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :  fStackBuffer(0),</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :  fBufferSize(5),</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :  fNBinsToScale(Int_t(fQNBins*0.1)),</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :  fDebug(0),</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :  fSignalShapeCreated(kFALSE),</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :  fMaxIterations(1000),</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :  fMaxChiSquereChange(0.01),</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :  fMaxChiSquerePerNDF(1.5),</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :  fQRadius(8.0),</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :  fPID(pid),</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :  fSamplePhiMin(-0.01),</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :  fSamplePhiMax(TMath::TwoPi()+0.01),</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :  fSignalRegion(0.0),</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :  fMinFill(1000),</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :  fSwapped(0),</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :  fLogFile(0x0)</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     158 </span>            : //default constructor
<a name="159"><span class="lineNum">     159 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            : AliGenHBTosl::AliGenHBTosl(const AliGenHBTosl &amp; hbt):
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :  AliGenerator(-1),</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :  fQCoarseBackground(0x0),</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :  fQCoarseSignal(0x0),</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :  fQSignal(0x0),</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :  fQBackground(0x0),</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :  fQSecondSignal(0x0),</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :  fQSecondBackground(0x0),</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :  fQRange(0.06),</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :  fQNBins(60),</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :  fGenerator(0x0),</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :  fStackBuffer(0),</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :  fBufferSize(5),</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :  fNBinsToScale(Int_t(fQNBins*0.1)),</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :  fDebug(0),</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :  fSignalShapeCreated(kFALSE),</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :  fMaxIterations(1000),</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :  fMaxChiSquereChange(0.01),</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :  fMaxChiSquerePerNDF(1.5),</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :  fQRadius(8.0),</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :  fPID(kPiPlus),</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :  fSamplePhiMin(-0.01),</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :  fSamplePhiMax(TMath::TwoPi()+0.01),</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :  fSignalRegion(0.0),</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :  fMinFill(1000),</span>
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :  fSwapped(0),</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :  fLogFile(0x0)</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     189 </span>            : // Copy constructor
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :     hbt.Copy(*this);</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 : }</span>
<a name="192"><span class="lineNum">     192 </span>            : /***********************************************************/</a>
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span><span class="lineNoCov">          0 : AliGenHBTosl::~AliGenHBTosl()</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     196 </span>            : //destructor
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :  delete fQCoarseSignal;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :  delete fQCoarseBackground;</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :  delete fQSignal;</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :  delete fQBackground;</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :  delete fGenerator; </span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :  delete fQSecondSignal;</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :  delete fQSecondBackground;</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :  delete fLogFile;</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 : }</span>
<a name="206"><span class="lineNum">     206 </span>            : /***********************************************************/</a>
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span>            : void AliGenHBTosl::Init()
<span class="lineNum">     209 </span>            : {
<span class="lineNum">     210 </span>            :   //Initializes generator
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :   if (fGenerator == 0x0)</span>
<span class="lineNum">     212 </span>            :    { 
<span class="lineNum">     213 </span>            :    
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :      AliGenHIJINGpara* bkggen = new AliGenHIJINGpara(fNpart*4);</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :      fGenerator = bkggen;</span>
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span>            : /*     
<span class="lineNum">     218 </span>            :      AliGenGeVSim * gevsim = new AliGenGeVSim(0.0);
<span class="lineNum">     219 </span>            :      AliGeVSimParticle* kplus = new AliGeVSimParticle(fPID,1,fNpart, 0.17, 0.9);
<span class="lineNum">     220 </span>            :      gevsim-&gt;AddParticleType(kplus);
<span class="lineNum">     221 </span>            :      
<span class="lineNum">     222 </span>            :      fGenerator = gevsim;
<span class="lineNum">     223 </span>            : */
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span>            : /*   
<span class="lineNum">     226 </span>            :    
<span class="lineNum">     227 </span>            :     AliMevSimConfig *c = new AliMevSimConfig(1);
<span class="lineNum">     228 </span>            :     c-&gt;SetRectPlane(1);                                 // reaction plane control, model 4
<span class="lineNum">     229 </span>            :     c-&gt;SetGrid(80,80);
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span>            :     AliGenMevSim *mevsim = new AliGenMevSim(c);
<span class="lineNum">     232 </span>            :     mevsim-&gt;SetPtRange(0.001, 3);
<span class="lineNum">     233 </span>            :     mevsim-&gt;SetMomentumRange(0.1, 3);
<span class="lineNum">     234 </span>            :     mevsim-&gt;SetTrackingFlag(0);
<span class="lineNum">     235 </span>            :     mevsim-&gt;SetOrigin(0.0, 0.0, 0.0);
<span class="lineNum">     236 </span>            :     mevsim-&gt;SetSigma(0.0, 0.0, 0.0);
<span class="lineNum">     237 </span>            :     AliMevSimParticle *kplus = new AliMevSimParticle(kKPlus, fNpart, 0, 0.25, 0.0, 2, 0.15, 0.0, 0.0 );
<span class="lineNum">     238 </span>            :     mevsim-&gt;AddParticleType(kplus);
<span class="lineNum">     239 </span>            :     fGenerator = mevsim;
<span class="lineNum">     240 </span>            : */
<span class="lineNum">     241 </span>            :     
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     fGenerator-&gt;SetOrigin(fOrigin[0],fOrigin[1],fOrigin[2]);</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     static const Double_t kDegToRadCF = 180./TMath::Pi();</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     fGenerator-&gt;SetMomentumRange(fPtMin,fPtMax);</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :     fGenerator-&gt;SetPhiRange(kDegToRadCF*fPhiMin,kDegToRadCF*fPhiMax);</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :     fGenerator-&gt;SetYRange(fYMin,fYMax);</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     fGenerator-&gt;SetThetaRange(kDegToRadCF*fThetaMin,kDegToRadCF*fThetaMax);</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     fGenerator-&gt;Init();</span>
<span class="lineNum">     249 </span>            :     
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span>            : //  fQCoarseBackground =  new TH3D(&quot;fQCoarseBackground&quot;,&quot;&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);
<span class="lineNum">     253 </span>            : //  fQCoarseSignal =  new TH3D(&quot;fQCoarseSignal&quot;,&quot;fQCoarseSignal&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);
<span class="lineNum">     254 </span>            : //  fQCoarseBackground-&gt;Sumw2();
<span class="lineNum">     255 </span>            : //  fQCoarseSignal-&gt;Sumw2();
<span class="lineNum">     256 </span>            :    
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :   fQSignal =  new TH3D(&quot;fQSignal1&quot;,&quot;fQSignal&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :   fQBackground =  new TH3D(&quot;fQBackground1&quot;,&quot;fQBackground&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :   fQSecondSignal =  new TH3D(&quot;fQSignal2&quot;,&quot;fQSignal&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :   fQSecondBackground =  new TH3D(&quot;fQBackground2&quot;,&quot;fQBackground&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   fQSignal-&gt;Sumw2();</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   fQBackground-&gt;Sumw2();</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :   fQSecondSignal-&gt;Sumw2();</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :   fQSecondBackground-&gt;Sumw2();</span>
<span class="lineNum">     267 </span>            :   
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :   fLogFile = new ofstream(&quot;BadEvent&quot;,ios::out);</span>
<span class="lineNum">     269 </span>            :   
<span class="lineNum">     270 </span><span class="lineNoCov">          0 : }</span>
<a name="271"><span class="lineNum">     271 </span>            : /***********************************************************/</a>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span>            : void AliGenHBTosl::Generate()
<span class="lineNum">     274 </span>            : {
<span class="lineNum">     275 </span>            :  //the main method
<span class="lineNum">     276 </span>            :   
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :  ofstream&amp; logfile = *fLogFile;</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;Generate&quot;&lt;&lt;&quot;Attempts to generate &quot;&lt;&lt;fNpart&lt;&lt;&quot; particles.&quot;;</span>
<span class="lineNum">     279 </span>            :  
<span class="lineNum">     280 </span>            :  
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :  if (fStackBuffer == 0x0) fStackBuffer = new TList();</span>
<span class="lineNum">     282 </span>            :  //Here is initialization level
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :  if (fSignalShapeCreated == kFALSE)</span>
<span class="lineNum">     284 </span>            :   {
<span class="lineNum">     285 </span>            :    TH3D *hs = 0x0, *hb = 0x0;
<span class="lineNum">     286 </span>            :    TFile* file;
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :    file = TFile::Open(&quot;QTSignal.root&quot;);</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :    if (file)</span>
<span class="lineNum">     290 </span>            :     {
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :      hs = (TH3D*)file-&gt;Get(&quot;fQSignal1&quot;);</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :      if (hs) hs-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     293 </span>            :     }
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :    delete file;</span>
<span class="lineNum">     295 </span>            :    
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :    file = TFile::Open(&quot;QTBackground.root&quot;);</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :    if (file)</span>
<span class="lineNum">     298 </span>            :     {
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :      hb = (TH3D*)file-&gt;Get(&quot;fQBackground1&quot;);</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :      if (hb) hb-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     301 </span>            :     }
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :    delete file;</span>
<span class="lineNum">     303 </span>            :    
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :    if (hs &amp;&amp; hb)</span>
<span class="lineNum">     305 </span>            :     {
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :       Info(&quot;Generate&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       Info(&quot;Generate&quot;,&quot;Found starting histograms in files&quot;);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :       Info(&quot;Generate&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :       delete fQSignal;</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :       delete fQBackground;</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       fQSignal = hs;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       fQBackground = hb;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     314 </span>            :    else
<span class="lineNum">     315 </span>            :     { 
<span class="lineNum">     316 </span>            :       TH3D *cs = 0x0, *cb = 0x0;
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :       file = TFile::Open(&quot;QTCoarseBackground.root&quot;);</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :       if (file)</span>
<span class="lineNum">     319 </span>            :        {
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :         cb = (TH3D*)file-&gt;Get(&quot;fQCoarseBackground&quot;);</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :         if (cb) cb-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     322 </span>            :        }
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :       delete file;</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :       file = TFile::Open(&quot;QTCoarseSignal.root&quot;);</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :       if (file)</span>
<span class="lineNum">     327 </span>            :        {
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :         cs = (TH3D*)file-&gt;Get(&quot;fQCoarseSignal&quot;);</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :         if (cs) cs-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     330 </span>            :        }
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :       delete file;</span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :       if (cs &amp;&amp; cb)</span>
<span class="lineNum">     334 </span>            :        {
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :          Info(&quot;Generate&quot;,&quot;Got Coarse signal and bkg from files&quot;);</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :          delete fQCoarseBackground;</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :          delete fQCoarseSignal;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :          fQCoarseSignal = cs;</span>
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :          fQCoarseBackground = cb;</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :        }</span>
<span class="lineNum">     342 </span>            :       else
<span class="lineNum">     343 </span>            :        { 
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :          if (cb)</span>
<span class="lineNum">     345 </span>            :            {
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :              Info(&quot;Generate&quot;,&quot;Got Coarse bkg from file&quot;);</span>
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :              delete fQCoarseBackground;</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :              fQCoarseBackground = cb;</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :            }</span>
<span class="lineNum">     350 </span>            :          else
<span class="lineNum">     351 </span>            :            {
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :              fQCoarseBackground =  new TH3D(&quot;fQCoarseBackground&quot;,&quot;&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :              fQCoarseBackground-&gt;Sumw2();</span>
<span class="lineNum">     354 </span>            : 
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :              FillCoarse();      //create coarse background - just to know the spectrum</span>
<span class="lineNum">     356 </span>            :            }
<span class="lineNum">     357 </span>            : 
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :          fQCoarseSignal =  new TH3D(&quot;fQCoarseSignal&quot;,&quot;fQCoarseSignal&quot;,fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange, fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :          fQCoarseSignal-&gt;Sumw2();</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :          FillCoarseSignal();//create first coarse signal by brutal multplication coarse background and required function shape</span>
<span class="lineNum">     361 </span>            :        }
<span class="lineNum">     362 </span>            :        
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :       StartSignal();     //Initilizes the stack that is used for generation</span>
<span class="lineNum">     364 </span>            :     }  
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :    fSignalShapeCreated = kTRUE;</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :  AliStack* stack = RotateStack();</span>
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :  AliStack* genstack = fGenerator-&gt;GetStack();</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :  if (genstack == 0x0)</span>
<span class="lineNum">     372 </span>            :   {
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :    genstack = new AliStack(fNpart);</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :    fGenerator-&gt;SetStack(genstack);  </span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     376 </span>            :  else
<span class="lineNum">     377 </span>            :   {
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :    genstack-&gt;Reset();</span>
<span class="lineNum">     379 </span>            :   }
<span class="lineNum">     380 </span>            :  
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :  fGenerator-&gt;Generate();</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :  Int_t ntr = 0;</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :  if ( genstack-&gt;GetNtrack() &lt; fNpart/2)</span>
<span class="lineNum">     384 </span>            :   {
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     Warning(&quot;Generate&quot;,&quot;************************************************************&quot;);</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :     Warning(&quot;Generate&quot;,&quot;Generator generated (%d) less particles then expected (%d).&quot;,</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :              stack-&gt;GetNtrack(),fNpart/2);</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :     Warning(&quot;Generate&quot;,&quot;************************************************************&quot;);</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :  TH3D* work = new TH3D(&quot;work&quot;,&quot;work&quot;,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :  work-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :  work-&gt;Sumw2();</span>
<span class="lineNum">     394 </span>            :  
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :  Double_t*** chiarray = new Double_t** [fQNBins+1];</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :  Double_t*** sigarray = new Double_t** [fQNBins+1];</span>
<span class="lineNum">     397 </span>            :  
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :  for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">     399 </span>            :    {
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :       chiarray[i] =  new Double_t* [fQNBins+1];</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :       sigarray[i] =  new Double_t* [fQNBins+1];</span>
<span class="lineNum">     402 </span>            :       
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :       for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">     404 </span>            :        {
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :          chiarray[i][k] =  new Double_t [fQNBins+1];</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :          sigarray[i][k] =  new Double_t [fQNBins+1];</span>
<span class="lineNum">     407 </span>            :        }
<span class="lineNum">     408 </span>            :    }
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span>            :       
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :  Double_t scale = Scale(fQSignal,fQBackground);</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :  work-&gt;Divide(fQSignal,fQBackground,scale);</span>
<span class="lineNum">     413 </span>            :  
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :  Double_t binwdh = work-&gt;GetBinWidth(1)/2.;</span>
<span class="lineNum">     415 </span>            : 
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :  for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">     417 </span>            :    {
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :     Double_t z = work-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     for (Int_t j = 1; j&lt;=fQNBins; j++)</span>
<span class="lineNum">     420 </span>            :       {  
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :        Double_t y = work-&gt;GetYaxis()-&gt;GetBinCenter(j);</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :        for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">     423 </span>            :          {
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :               sigarray[i][j][k] = fQSignal-&gt;GetBinContent(i,j,k);//store current value of signal histogram</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :               Double_t x = work-&gt;GetXaxis()-&gt;GetBinCenter(i);//get center value of a bin (qinv)</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :               Double_t v = GetQOutQSideQLongCorrTheorValue(x,y,z);//get expected value of CF in that qinv</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :               Double_t diff = v - work-&gt;GetBinContent(i,j,k);//store difference betweeon current value, and desired value</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :               chiarray[i][j][k] = diff; // no-x x is a weight to get good distribution</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :          }</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :        }</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     432 </span>            :  
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :  char msg[1000];</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;endl;</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :  snprintf(msg,1000, &quot;\n&quot;);</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :  Int_t middlebin = fQNBins/2;</span>
<span class="lineNum">     437 </span>            :  
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :  for (Int_t k = middlebin-5; k &lt; middlebin+5; k++)</span>
<span class="lineNum">     439 </span>            :    {
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :      Double_t tx = work-&gt;GetXaxis()-&gt;GetBinCenter(30);</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :      Double_t ty = work-&gt;GetYaxis()-&gt;GetBinCenter(30);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :      Double_t tz = work-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :      snprintf(msg,1000, &quot;% 6.5f &quot;,GetQOutQSideQLongCorrTheorValue(tx,ty,tz));</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :      logfile&lt;&lt;msg;</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;endl;</span>
<span class="lineNum">     447 </span>            :   
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :  for (Int_t k = middlebin-5; k &lt; middlebin+5; k++)</span>
<span class="lineNum">     449 </span>            :   {
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :     snprintf(msg,1000, &quot;% 6.5f &quot;,work-&gt;GetBinContent(30,30,k));</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :     logfile&lt;&lt;msg;</span>
<span class="lineNum">     452 </span>            :   }
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;endl;</span>
<span class="lineNum">     454 </span>            : 
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :  for (Int_t k = middlebin-5; k &lt; middlebin+5; k++)</span>
<span class="lineNum">     456 </span>            :   {
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     snprintf(msg, 1000, &quot;% 6.5f &quot;,chiarray[30][30][k]);</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :     logfile&lt;&lt;msg;</span>
<span class="lineNum">     459 </span>            :   }
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;endl;</span>
<span class="lineNum">     461 </span>            :  
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :  TParticle particle(fPID,0,-1,-1,-1,-1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0);</span>
<span class="lineNum">     463 </span>            :  TParticle* second = &amp;particle;
<span class="lineNum">     464 </span>            : 
<span class="lineNum">     465 </span>            :  Bool_t shortloop = kTRUE;
<span class="lineNum">     466 </span>            :  Int_t sc = 0;//security check against infinite loop
<span class="lineNum">     467 </span>            : 
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :  while ( (ntr+1) &lt; fNpart)</span>
<span class="lineNum">     469 </span>            :    {
<span class="lineNum">     470 </span>            :      Int_t xmax = 1; 
<span class="lineNum">     471 </span>            :      Int_t ymax = 1; 
<span class="lineNum">     472 </span>            :      Int_t zmax = 1; 
<span class="lineNum">     473 </span>            :      Double_t qout;
<span class="lineNum">     474 </span>            :      Double_t qside;
<span class="lineNum">     475 </span>            :      Double_t qlong;
<span class="lineNum">     476 </span>            :      
<span class="lineNum">     477 </span>            :      
<span class="lineNum">     478 </span>            :      Int_t loopmin;
<span class="lineNum">     479 </span>            :      Int_t loopmax;
<span class="lineNum">     480 </span>            :      
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :      if (shortloop)</span>
<span class="lineNum">     482 </span>            :       {
<span class="lineNum">     483 </span>            :         shortloop = kFALSE;
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :         loopmax = fQNBins;</span>
<span class="lineNum">     485 </span>            :         loopmin = 1;
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">     487 </span>            :      else 
<span class="lineNum">     488 </span>            :       {
<span class="lineNum">     489 </span>            :         shortloop = kTRUE;
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :         loopmax = fQNBins/2+fQNBins/4;</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :         loopmin = fQNBins/2-fQNBins/4;</span>
<span class="lineNum">     492 </span>            :       }
<span class="lineNum">     493 </span>            :      
<span class="lineNum">     494 </span>            :      
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :      for (Int_t k = loopmin; k &lt;=loopmax; k++ )</span>
<span class="lineNum">     496 </span>            :       {
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :        qlong = work-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :        for (Int_t j = loopmin; j&lt;=loopmax; j++)</span>
<span class="lineNum">     499 </span>            :          {
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :           qside = work-&gt;GetYaxis()-&gt;GetBinCenter(j);</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :           for (Int_t i = loopmin; i&lt;=loopmax; i++)</span>
<span class="lineNum">     502 </span>            :             {
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :               qout  = work-&gt;GetXaxis()-&gt;GetBinCenter(i);</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :               if (chiarray[xmax][ymax][zmax] &lt; chiarray[i][j][k]) </span>
<span class="lineNum">     505 </span>            :                {
<span class="lineNum">     506 </span>            :                  xmax = i;
<span class="lineNum">     507 </span>            :                  ymax = j;
<span class="lineNum">     508 </span>            :                  zmax = k;
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :                }  </span>
<span class="lineNum">     510 </span>            :               
<span class="lineNum">     511 </span>            : //              Double_t qdist = TMath::Sqrt(qout*qout + qside*qside + qlong*qlong);
<span class="lineNum">     512 </span>            :               
<span class="lineNum">     513 </span>            : //              Double_t fact = chiarray[i][j][k];//chiarray is chi2
<span class="lineNum">     514 </span>            : //              if (fact &gt; work-&gt;GetBinError(i,j,k))//if differece between what we want and 
<span class="lineNum">     515 </span>            : //               {                                  //what we have is bigger than stat. error
<span class="lineNum">     516 </span>            : //                 xmax = i;                        //we force to fill that bin
<span class="lineNum">     517 </span>            : //                 ymax = j;
<span class="lineNum">     518 </span>            : //                 zmax = k;
<span class="lineNum">     519 </span>            : //                 break;
<span class="lineNum">     520 </span>            : //               }
<span class="lineNum">     521 </span>            :             }
<span class="lineNum">     522 </span>            :          }
<span class="lineNum">     523 </span>            :       }
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :      Double_t qlongc = work-&gt;GetZaxis()-&gt;GetBinCenter(zmax);</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :      Double_t qsidec = work-&gt;GetYaxis()-&gt;GetBinCenter(ymax);</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :      Double_t qoutc  = work-&gt;GetXaxis()-&gt;GetBinCenter(xmax);</span>
<span class="lineNum">     527 </span>            :      
<span class="lineNum">     528 </span>            : 
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :      snprintf(msg,1000, &quot;Generate Fill bin chi2(%d,%d,%d)=%f&quot;,xmax,ymax,zmax,chiarray[xmax][ymax][zmax]);</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :      logfile&lt;&lt;msg;</span>
<span class="lineNum">     531 </span>            :      
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :      qout  = gRandom-&gt;Uniform(qoutc -binwdh, qoutc +binwdh);</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :      qside = gRandom-&gt;Uniform(qsidec-binwdh, qsidec+binwdh);</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :      qlong = gRandom-&gt;Uniform(qlongc-binwdh, qlongc+binwdh);</span>
<span class="lineNum">     535 </span>            : 
<span class="lineNum">     536 </span>            :      TParticle* first = 0;
<span class="lineNum">     537 </span>            :      Int_t jj = 0;
<span class="lineNum">     538 </span>            :      
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :      while (jj &lt; genstack-&gt;GetNtrack())</span>
<span class="lineNum">     540 </span>            :       {
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :         TParticle* tmpp = genstack-&gt;Particle(jj++);</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :         if (tmpp-&gt;GetPdgCode() == fPID)</span>
<span class="lineNum">     543 </span>            :          {
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :            if (CheckParticle(tmpp,0x0,stack) == kFALSE)</span>
<span class="lineNum">     545 </span>            :             {
<span class="lineNum">     546 </span>            :               first = tmpp;
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">     548 </span>            :             } 
<span class="lineNum">     549 </span>            :          }
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :       } </span>
<span class="lineNum">     551 </span>            :      
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :      if (first == 0x0)</span>
<span class="lineNum">     553 </span>            :       {
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :         if ( fDebug &gt; 2 ) Info(&quot;StartSignal&quot;,&quot;No more particles of that type&quot;);</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     556 </span>            :       }
<span class="lineNum">     557 </span>            :      
<span class="lineNum">     558 </span>            :      //Here put the check if this particle do not fall into signal region with other partticle
<span class="lineNum">     559 </span>            :      
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :       Int_t retval = GetThreeD(first,second,qout,qside,qlong);</span>
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :       if (retval)</span>
<span class="lineNum">     562 </span>            :        {
<span class="lineNum">     563 </span>            :          //Info(&quot;StartSignal&quot;,&quot;Can not find momenta for this OSL and particle&quot;);
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :          continue;</span>
<span class="lineNum">     565 </span>            :        }
<span class="lineNum">     566 </span>            :     //in case this particle is falling into signal area with another
<span class="lineNum">     567 </span>            :     //particle we take a another pair
<span class="lineNum">     568 </span>            :     //it can intruduce artificial correlations 
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :      Bool_t checkresult = CheckParticle(second,first,stack);</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :      if ( checkresult  &amp;&amp; (sc &lt; 10) ) </span>
<span class="lineNum">     571 </span>            :       { 
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :         sc++;</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         continue;</span>
<span class="lineNum">     574 </span>            :       }  
<span class="lineNum">     575 </span>            :      sc = 0;
<span class="lineNum">     576 </span>            :      
<span class="lineNum">     577 </span>            :      //Put on output stack
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :      SetTrack(first,ntr);</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :      SetTrack(second,ntr);</span>
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span>            :      //Put on internal stack   
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :      Int_t etmp;</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :      SetTrack(first,etmp,stack);</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :      SetTrack(second,etmp,stack);</span>
<span class="lineNum">     585 </span>            :      
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :      Double_t y = GetQOutQSideQLongCorrTheorValue(qoutc,qsidec,qlongc);</span>
<span class="lineNum">     587 </span>            :       
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :      sigarray[xmax][ymax][zmax] ++; </span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :      chiarray[xmax][ymax][zmax] = scale*sigarray[xmax][ymax][zmax]/fQBackground-&gt;GetBinContent(xmax,ymax,zmax);</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :      chiarray[xmax][ymax][zmax] = (y - chiarray[xmax][ymax][zmax]);</span>
<span class="lineNum">     591 </span>            :       
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     593 </span>            :   
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :  Mix(fStackBuffer,fQBackground,fQSecondSignal); //upgrate background</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :  Mix(stack,fQSignal,fQSecondBackground); //upgrate signal</span>
<span class="lineNum">     596 </span>            :  
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :  delete work;</span>
<span class="lineNum">     598 </span>            :  
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :  for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">     600 </span>            :    {
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :      for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">     602 </span>            :       {
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :         delete [] chiarray[i][k]; </span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :         delete [] sigarray[i][k];</span>
<span class="lineNum">     605 </span>            :       }
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :      delete [] chiarray[i];</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :      delete [] sigarray[i];</span>
<span class="lineNum">     608 </span>            :    }
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :  delete [] chiarray;</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :  delete [] sigarray;</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 : }</span>
<a name="612"><span class="lineNum">     612 </span>            : /***********************************************************/</a>
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span>            : void AliGenHBTosl::GetOneD(TParticle* first, TParticle* second,Double_t qinv)
<span class="lineNum">     615 </span>            : {
<span class="lineNum">     616 </span>            : //deprecated method that caclulates momenta of the second particle 
<span class="lineNum">     617 </span>            : // out of qinv and the first particle    
<span class="lineNum">     618 </span>            : //first particle is rotated that only X is non-zero
<span class="lineNum">     619 </span>            : 
<span class="lineNum">     620 </span>            :     
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :   Double_t m = first-&gt;GetMass();</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :   Double_t msqrd = m*m;</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :   Double_t fourmassSquered = 4.*msqrd;</span>
<span class="lineNum">     624 </span>            :   
<span class="lineNum">     625 </span>            :   //Condition that R must fullfill to be possible to have qinv less smaller then randomized
<span class="lineNum">     626 </span>            : //  Double_t rRange = qinv*TMath::Sqrt(qinv*qinv + fourmassSquered)/fourmassSquered;
<span class="lineNum">     627 </span>            : //  Double_t r = gRandom-&gt;Uniform(rRange);
<span class="lineNum">     628 </span>            : 
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :   Double_t r = gRandom-&gt;Uniform(qinv);</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :   Double_t phi = gRandom-&gt;Uniform(TMath::TwoPi());</span>
<span class="lineNum">     631 </span>            :   
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :   Double_t firstPx = first-&gt;P();//first particle is rotated that only X is non-zero  thus P==Px</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :   Double_t px = 2.*msqrd*firstPx + firstPx*qinv*qinv;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :   Double_t temp = qinv*qinv*qinv*qinv  + fourmassSquered * (qinv*qinv - r*r );</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :   if (temp &lt; 0.0)</span>
<span class="lineNum">     636 </span>            :    {
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :      Error(&quot;GetOneD&quot;,&quot;temp is less then 0: %f&quot;,temp);</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :      return;</span>
<span class="lineNum">     639 </span>            :    }
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :   temp = temp*(msqrd+firstPx*firstPx);</span>
<span class="lineNum">     641 </span>            :   
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :   px = (px - TMath::Sqrt(temp))/(2.*msqrd);</span>
<span class="lineNum">     643 </span>            :   
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :   Double_t py = r*TMath::Sin(phi);</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :   Double_t pz = r*TMath::Cos(phi);</span>
<span class="lineNum">     646 </span>            :   
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :   TVector3 firstpvector(first-&gt;Px(),first-&gt;Py(),first-&gt;Pz());</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :   TVector3 vector(px,py,pz);</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :   Rotate(firstpvector,vector);</span>
<span class="lineNum">     650 </span>            :  
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :   Double_t e = TMath::Sqrt(msqrd + vector.X()*vector.X() + vector.Y()*vector.Y() + vector.Z()*vector.Z());</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :   second-&gt;SetMomentum(vector.X(),vector.Y(),vector.Z(),e);</span>
<span class="lineNum">     653 </span>            : //  TParticle* f = new TParticle(first-&gt;GetPdgCode(),0,-1,-1,-1,-1, firstPx,0,0,e=TMath::Sqrt(msqrd+firstPx*firstPx),0.0,0.0,0.0,0.0);
<span class="lineNum">     654 </span>            : //        TParticle(pdg, is, parent, -1, kFirstDaughter, kLastDaughter,
<span class="lineNum">     655 </span>            : //                px, py, pz, e, vx, vy, vz, tof);
<span class="lineNum">     656 </span>            :  
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :   AliDebug(1,Form(&quot;Randomized qinv = %f, obtained = %f&quot;,qinv,GetQInv(first,second)));</span>
<span class="lineNum">     658 </span>            : 
<span class="lineNum">     659 </span><span class="lineNoCov">          0 : }</span>
<a name="660"><span class="lineNum">     660 </span>            : /***********************************************************/</a>
<span class="lineNum">     661 </span>            : 
<span class="lineNum">     662 </span>            : Int_t AliGenHBTosl::GetThreeD(TParticle* first,TParticle* second, Double_t qout, Double_t qside, Double_t qlong)
<span class="lineNum">     663 </span>            : {
<span class="lineNum">     664 </span>            : //deprecated method that caclulates momenta of the second particle 
<span class="lineNum">     665 </span>            : //out of  qout qside and qlong and the first particle    
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :   Double_t m = first-&gt;GetMass();</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :   Double_t m2 = m*m;</span>
<span class="lineNum">     668 </span>            :   
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :   Double_t px = first-&gt;P();//first particle is rotated that only X is non-zero  thus P==Px</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :   Double_t px2 = px*px;</span>
<span class="lineNum">     671 </span>            : 
<span class="lineNum">     672 </span>            :   
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :   Double_t qout2 = qout*qout;</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :   Double_t qside2 = qside*qside;</span>
<span class="lineNum">     675 </span><span class="lineNoCov">          0 :   Double_t qlong2 = qlong*qlong;</span>
<span class="lineNum">     676 </span>            :   
<span class="lineNum">     677 </span>            :   
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :   Double_t util1 = 4.*px2 - qside2;//4*P1x^2 - Y^2</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   if (util1 &lt; 0) </span>
<span class="lineNum">     680 </span>            :    {
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :      Info(&quot;GetThreeD&quot;,&quot;4.*px2* - qside2 is negative px: %f, qside: %f&quot;,px,qside);</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :      return 1;</span>
<span class="lineNum">     683 </span>            :    }  
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :   Double_t util2 = TMath::Sqrt(px2*qout2*util1);</span>
<span class="lineNum">     685 </span>            :   
<span class="lineNum">     686 </span>            : 
<span class="lineNum">     687 </span>            :   Double_t p2x,p2y,p2z;
<span class="lineNum">     688 </span>            :       
<span class="lineNum">     689 </span>            : //  if ( (qside &gt;= 0) &amp;&amp; (qout &gt;= 0) &amp;&amp; (qlong &gt;= 0))
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :   if (qout &gt;= 0)</span>
<span class="lineNum">     691 </span>            :    {
<span class="lineNum">     692 </span>            :      //p2x
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :      Double_t tmp = px*(2.*px2 - qside2);</span>
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :      tmp -=  util2;</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :      p2x = tmp/(2.*px2);</span>
<span class="lineNum">     696 </span>            : 
<span class="lineNum">     697 </span>            :      //p2y
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :      tmp =  qout - TMath::Sqrt(util1);</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :      p2y = - (tmp*qside)/(2.*px);</span>
<span class="lineNum">     700 </span>            :       
<span class="lineNum">     701 </span>            :      //p2z
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :      tmp = 4.*m2 + 2.*qout2+qlong2;</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :      tmp -= 2.*util2;//!!!</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :      tmp += 4.*px*px2;</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :      tmp *= qlong2;</span>
<span class="lineNum">     707 </span>            : 
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :      Double_t m2px2 = m2+px2;</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :      Double_t tmp2 = m2px2*tmp;</span>
<span class="lineNum">     710 </span>            : 
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :      tmp  = 4.*(m2px2+qout2) + qlong2;</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :      tmp -= 4.*util2;</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :      tmp *= 4.*(m2px2) + qlong2;</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :      tmp *= qlong2*qlong2;</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :      tmp *= m2px2*m2px2;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :      if (tmp &lt; 0)</span>
<span class="lineNum">     719 </span>            :       {
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :         Error(&quot;&quot;,&quot;Argument of sqrt is negative&quot;);</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :         return 1;</span>
<span class="lineNum">     722 </span>            :       }
<span class="lineNum">     723 </span>            : 
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :      tmp2 += TMath::Sqrt(tmp); </span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :      tmp = 8.0*px*m2px2*m2px2;</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :      p2z = -TMath::Sqrt(tmp2/tmp);</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :      if (qlong &lt; 0) p2z = -p2z;</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     730 </span>            :   else
<span class="lineNum">     731 </span>            :    {
<span class="lineNum">     732 </span>            :      //p2x
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :      Double_t tmp = px*(2.*px2 - qside2);</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :      tmp +=  util2;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :      p2x = tmp/(2.*px2);</span>
<span class="lineNum">     736 </span>            : 
<span class="lineNum">     737 </span>            :      //p2y
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :      tmp =  qout - TMath::Sqrt(util1);</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :      p2y = - (tmp*qside)/(2.*px);</span>
<span class="lineNum">     740 </span>            :       
<span class="lineNum">     741 </span>            :      //p2z
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :      tmp = 4.*m2 + 2.*qout2+qlong2;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :      tmp += 2.*util2;//!!!</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :      tmp += 4.*px*px2;</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :      tmp *= qlong2;</span>
<span class="lineNum">     747 </span>            : 
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :      Double_t m2px2 = m2+px2;</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :      Double_t tmp2 = m2px2*tmp;</span>
<span class="lineNum">     750 </span>            : 
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :      tmp  = 4.*(m2px2+qout2) + qlong2;</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :      tmp += 4.*util2;</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :      tmp *= 4.*(m2px2) + qlong2;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :      tmp *= qlong2*qlong2;</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :      tmp *= m2px2*m2px2;</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :      tmp *= px;</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :      if (tmp &lt; 0)</span>
<span class="lineNum">     759 </span>            :       {
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :         Error(&quot;&quot;,&quot;Argument of sqrt is negative&quot;);</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :         return 1;</span>
<span class="lineNum">     762 </span>            :       }
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :      tmp2 += TMath::Sqrt(tmp); </span>
<span class="lineNum">     765 </span>            : 
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :      tmp = 8.0*px*m2px2*m2px2;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :      p2z = -TMath::Sqrt(tmp2/tmp);</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :      if (qlong &lt; 0) p2z = -p2z;</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     770 </span>            :      
<span class="lineNum">     771 </span>            : //  if ( (qside &gt;= 0) &amp;&amp; (qout &gt;= 0) &amp;&amp; (qlong &gt;= 0))  p2z = -p2z;
<span class="lineNum">     772 </span>            :   
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :   TVector3 firstpvector(first-&gt;Px(),first-&gt;Py(),first-&gt;Pz());</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :   TVector3 vector(p2x,p2y,p2z);</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   Rotate(firstpvector,vector);</span>
<span class="lineNum">     776 </span>            :  
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :   Double_t e = TMath::Sqrt(m2 + vector.X()*vector.X() + vector.Y()*vector.Y() + vector.Z()*vector.Z());</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :   second-&gt;SetMomentum(vector.X(),vector.Y(),vector.Z(),e);</span>
<span class="lineNum">     779 </span>            :   
<span class="lineNum">     780 </span>            : ////////////  
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :   if ( AliDebugLevel() &gt; 3 )</span>
<span class="lineNum">     782 </span>            :    {
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :      e=TMath::Sqrt(m2+px*px);  </span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :      TParticle* f = new TParticle(first-&gt;GetPdgCode(),0,-1,-1,-1,-1, px , 0.0, 0.0, e,0.0,0.0,0.0,0.0);</span>
<span class="lineNum">     785 </span>            : 
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :      e = TMath::Sqrt(m2 + p2x*p2x + p2y*p2y + p2z*p2z);</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :      TParticle* s = new TParticle(first-&gt;GetPdgCode(),0,-1,-1,-1,-1, p2x, p2y, p2z, e, 0.0, 0.0, 0.0, 0.0);</span>
<span class="lineNum">     788 </span>            : 
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :      Double_t qo, qs, ql;</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :      GetQOutQSideQLong(f,s,qo, qs, ql);</span>
<span class="lineNum">     791 </span>            : 
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :      Info(&quot;GetThreeD&quot;,&quot;TEST&quot;);</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :      f-&gt;Print();</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :      s-&gt;Print();</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :      Info(&quot;GetThreeD&quot;,&quot;Required %f %f %f&quot;,qout,qside,qlong);</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :      Info(&quot;GetThreeD&quot;,&quot;Got      %f %f %f&quot;,qo,qs,ql);</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :      if ( qout == qo)</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :         if (qside == qs)</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :           if  (qlong == ql)</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :             Info(&quot;GetThreeD&quot;,&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;);</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :    }  </span>
<span class="lineNum">     802 </span>            : ///////////// 
<span class="lineNum">     803 </span>            :   return 0;
<span class="lineNum">     804 </span><span class="lineNoCov">          0 : }</span>
<a name="805"><span class="lineNum">     805 </span>            : /***********************************************************/</a>
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span>            : void AliGenHBTosl::StartSignal()
<span class="lineNum">     808 </span>            : { 
<span class="lineNum">     809 </span>            : //Starts the signal histograms  
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :  ofstream&amp; logfile = *fLogFile;</span>
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;\n\n\n\n&quot;;</span>
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;************************************************&quot;&lt;&lt;endl;</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;************************************************&quot;&lt;&lt;endl;</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;               StartSignal                      &quot;&lt;&lt;endl;</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;************************************************&quot;&lt;&lt;endl;</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :  logfile&lt;&lt;&quot;************************************************&quot;&lt;&lt;endl;</span>
<span class="lineNum">     817 </span>            :  
<span class="lineNum">     818 </span>            :  AliStack* stack;
<span class="lineNum">     819 </span>            :  
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :  fSwapped = kFALSE;</span>
<span class="lineNum">     821 </span>            :  
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :  TParticle particle(fPID,0,-1,-1,-1,-1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0);</span>
<span class="lineNum">     823 </span>            :  TParticle* second = &amp;particle;
<span class="lineNum">     824 </span>            :  
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :  TIter next(fStackBuffer);</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :  while(( stack=(AliStack*)next() ))</span>
<span class="lineNum">     827 </span>            :   {
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :     stack-&gt;Reset();</span>
<span class="lineNum">     829 </span>            :   }
<span class="lineNum">     830 </span>            : 
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :  AliStack* genstack = fGenerator-&gt;GetStack();</span>
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :  if (genstack == 0x0)</span>
<span class="lineNum">     833 </span>            :   {
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :    genstack = new AliStack(fNpart);</span>
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :    fGenerator-&gt;SetStack(genstack);  </span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     837 </span>            :  else
<span class="lineNum">     838 </span>            :   {
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :    genstack-&gt;Reset();</span>
<span class="lineNum">     840 </span>            :   }
<span class="lineNum">     841 </span>            :  
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :  StartSignalPass1();</span>
<span class="lineNum">     843 </span>            :  //We alread have detailed histograms and we do not need Coarse anymore
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :  delete fQCoarseSignal;</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :  delete fQCoarseBackground;</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :  fQCoarseSignal = 0x0;</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :  fQCoarseBackground = 0x0;</span>
<span class="lineNum">     848 </span>            : 
<span class="lineNum">     849 </span>            :   
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :  const Double_t kNDF = fQNBins*fQNBins*fQNBins;</span>
<span class="lineNum">     851 </span>            :  
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :  TH3D* work = new TH3D(&quot;work&quot;,&quot;work&quot;,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :  work-&gt;Sumw2();</span>
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :  work-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     855 </span>            :  
<span class="lineNum">     856 </span>            :  
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :  Double_t binwdh = work-&gt;GetBinWidth(1)/2.;</span>
<span class="lineNum">     858 </span>            :  
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :  Double_t*** chiarray = new Double_t** [fQNBins+1];</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :  Double_t*** sigarray = new Double_t** [fQNBins+1];</span>
<span class="lineNum">     861 </span>            :  
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :  for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">     863 </span>            :    {
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :       chiarray[i] =  new Double_t* [fQNBins+1];</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :       sigarray[i] =  new Double_t* [fQNBins+1];</span>
<span class="lineNum">     866 </span>            :       
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :       for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">     868 </span>            :        {
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :          chiarray[i][k] =  new Double_t [fQNBins+1];</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :          sigarray[i][k] =  new Double_t [fQNBins+1];</span>
<span class="lineNum">     871 </span>            :        }
<span class="lineNum">     872 </span>            :    }
<span class="lineNum">     873 </span>            : 
<span class="lineNum">     874 </span>            :   
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :  Float_t chisqrchange = fMaxChiSquereChange + 1.;</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :  Float_t chisqrPerDF = fMaxChiSquerePerNDF;</span>
<span class="lineNum">     877 </span>            :  Float_t chisqrold = 0.0;
<span class="lineNum">     878 </span>            :  
<span class="lineNum">     879 </span>            :  Int_t counter = 1;
<span class="lineNum">     880 </span>            :  Int_t niterations = 1;
<span class="lineNum">     881 </span>            :  Int_t rotaxisorder = 1;//defines order of looping over 3D histo (X,Y,Z or Y,Z,X or Z,X,Y)
<span class="lineNum">     882 </span>            :  
<span class="lineNum">     883 </span>            :  Bool_t flag = kTRUE;
<span class="lineNum">     884 </span>            :  Bool_t shortloop = kTRUE;
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :  TCanvas* c1 = new TCanvas();</span>
<span class="lineNum">     886 </span>            : 
<span class="lineNum">     887 </span>            : 
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :  printf(&quot;\n&quot;);</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :  Info(&quot;StartSignal&quot;,&quot;\n\n\n\nSecond Pass\n\n\n\n&quot;);</span>
<span class="lineNum">     890 </span>            : 
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :  while ( ( (chisqrPerDF &gt; fMaxChiSquereChange) || flag) &amp;&amp; (niterations++ &lt; fMaxIterations)  )</span>
<span class="lineNum">     892 </span>            :   {
<span class="lineNum">     893 </span>            :    
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :    logfile&lt;&lt;&quot;StartSignal\n&quot;;</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :    logfile&lt;&lt;&quot; Row 1 Theory, 2 current value, 3 Chi2 \n&quot;;</span>
<span class="lineNum">     896 </span>            : 
<span class="lineNum">     897 </span>            :    Double_t chisqrnew = 0.0;
<span class="lineNum">     898 </span>            :    flag = kFALSE;
<span class="lineNum">     899 </span>            :      
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :    Double_t scale = Scale(fQSignal,fQBackground);</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :    work-&gt;Divide(fQSignal,fQBackground,scale);</span>
<span class="lineNum">     902 </span>            :    
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :    if ( (counter%100) == 0) </span>
<span class="lineNum">     904 </span>            :     {
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :       c1-&gt;cd();</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :       char buff[50];</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :       snprintf(buff,50, &quot;QTWorkPass2.%3d.root&quot;,counter);</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :       TFile* file = TFile::Open(buff,&quot;update&quot;);</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :       work-&gt;Write();</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :       work-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :       file-&gt;Close();</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :       delete file;</span>
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :       snprintf(buff,50, &quot;QTBackgroundPass2.%3d.root&quot;,counter);</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :       file = TFile::Open(buff,&quot;update&quot;);</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :       fQBackground-&gt;Write();</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :       fQBackground-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :       file-&gt;Close();</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :       delete file;</span>
<span class="lineNum">     920 </span>            : 
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :       snprintf(buff,50, &quot;QTSignalPass2.%3d.root&quot;,counter);</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :       file = TFile::Open(buff,&quot;update&quot;);</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :       fQSignal-&gt;Write();</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :       fQSignal-&gt;SetDirectory(0x0);</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :       file-&gt;Close();</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :       delete file;</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     928 </span>            : 
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :    counter++;</span>
<span class="lineNum">     930 </span>            :    Int_t novertresh = 0;
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :    for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">     932 </span>            :     {
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :       Double_t z = work-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :       for (Int_t j = 1; j&lt;=fQNBins; j++)</span>
<span class="lineNum">     935 </span>            :         {  
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :           Double_t y = work-&gt;GetYaxis()-&gt;GetBinCenter(j);</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :           for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">     938 </span>            :             {
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :               Double_t x = work-&gt;GetXaxis()-&gt;GetBinCenter(i);//get center value of a bin (qout)</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :               sigarray[i][j][k] = fQSignal-&gt;GetBinContent(i,j,k);//store current value of signal histogram</span>
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :               Double_t v = GetQOutQSideQLongCorrTheorValue(x,y,z);//get expected value of CF in that qinv</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :               Double_t diff = v - work-&gt;GetBinContent(i,j,k);//store difference betweeon current value, and desired value </span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :               chiarray[i][j][k] = diff; // no-x x is a weight to get good distribution</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :               Double_t be = work-&gt;GetBinError(i,j,k);</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :               chisqrnew += diff*diff/(be*be);//add up chisq</span>
<span class="lineNum">     946 </span>            : 
<span class="lineNum">     947 </span>            :               //even if algorithm is stable (chi sqr change less then threshold)
<span class="lineNum">     948 </span>            :               //and any bin differs more then 5% from expected value we continue
<span class="lineNum">     949 </span>            :               Double_t fact = diff;
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :               if (TMath::Abs(fact) &gt; 0.1) </span>
<span class="lineNum">     951 </span>            :                {
<span class="lineNum">     952 </span>            :                  flag = kTRUE; 
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :                  novertresh++;</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :                } </span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :          }   </span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :      }</span>
<span class="lineNum">     958 </span>            :     
<span class="lineNum">     959 </span>            : 
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :    char msg[1000];</span>
<span class="lineNum">     961 </span>            : 
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :    printf(&quot;\n&quot;);</span>
<span class="lineNum">     963 </span>            :   
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :    for (Int_t k = 25; k &lt; 36; k++)</span>
<span class="lineNum">     965 </span>            :     {
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :       Double_t tx = work-&gt;GetXaxis()-&gt;GetBinCenter(30);</span>
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :       Double_t ty = work-&gt;GetYaxis()-&gt;GetBinCenter(30);</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :       Double_t tz = work-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :       snprintf(msg,1000, &quot;% 6.5f &quot;,GetQOutQSideQLongCorrTheorValue(tx,ty,tz));</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :       logfile&lt;&lt;msg;</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :    logfile&lt;&lt;endl;</span>
<span class="lineNum">     973 </span>            : 
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :    for (Int_t k = 25; k &lt; 36; k++)</span>
<span class="lineNum">     975 </span>            :     {
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :       snprintf(msg, 1000, &quot;%6.5f &quot;,work-&gt;GetBinContent(30,30,k));</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :       logfile&lt;&lt;msg;</span>
<span class="lineNum">     978 </span>            :     }
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :    logfile&lt;&lt;endl;</span>
<span class="lineNum">     980 </span>            : 
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :    for (Int_t k = 25; k &lt; 36; k++)</span>
<span class="lineNum">     982 </span>            :     {
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :       snprintf(msg,1000, &quot;% 6.5f &quot;,chiarray[30][30][k]);</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :       logfile&lt;&lt;msg;</span>
<span class="lineNum">     985 </span>            :     }
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :    logfile&lt;&lt;endl;</span>
<span class="lineNum">     987 </span>            :     
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :    chisqrchange = TMath::Abs(chisqrnew - chisqrold)/chisqrnew;</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :    chisqrold = chisqrnew;</span>
<span class="lineNum">     990 </span>            : 
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :    chisqrPerDF = chisqrnew/kNDF;</span>
<span class="lineNum">     992 </span>            :    
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :    Info(&quot;StartSignal&quot;,&quot;Iteration %d Chi-sq change %f%%&quot;,niterations,chisqrchange*100.0);</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :    Info(&quot;StartSignal&quot;,&quot;ChiSq = %f, NDF = %f, ChiSq/NDF = %f&quot;,chisqrnew, kNDF, chisqrPerDF );</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :    Info(&quot;StartSignal&quot;,&quot;novertresh = %d&quot;,novertresh);</span>
<span class="lineNum">     996 </span>            :    
<span class="lineNum">     997 </span>            :    
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :    stack = RotateStack();</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :    genstack-&gt;Reset();</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :    fGenerator-&gt;Generate();</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :    Int_t ninputparticle = 0, ntr = 0;</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :    if ( genstack-&gt;GetNtrack() &lt; fNpart/2)</span>
<span class="lineNum">    1003 </span>            :     {
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :       Warning(&quot;StartSignal&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :       Warning(&quot;StartSignal&quot;,&quot;Generator generated (%d) less particles then expected (%d).&quot;,</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                genstack-&gt;GetNtrack(),fNpart/2);</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :       Warning(&quot;StartSignal&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">    1008 </span>            :     }
<span class="lineNum">    1009 </span>            :    
<span class="lineNum">    1010 </span>            :    Int_t sc = 0; //security check against infinite loop
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :    while ( (ntr+1) &lt; fNpart)//ntr is number of track generated up to now</span>
<span class="lineNum">    1012 </span>            :     {
<span class="lineNum">    1013 </span>            :      Int_t xmax = 1; 
<span class="lineNum">    1014 </span>            :      Int_t ymax = 1; 
<span class="lineNum">    1015 </span>            :      Int_t zmax = 1; 
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :      Double_t qout;</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :      Double_t qside;</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :      Double_t qlong;</span>
<span class="lineNum">    1019 </span>            :      
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :      Int_t i,j,k;</span>
<span class="lineNum">    1021 </span>            :      
<span class="lineNum">    1022 </span>            :      Int_t* cx = 0x0;
<span class="lineNum">    1023 </span>            :      Int_t* cy = 0x0;
<span class="lineNum">    1024 </span>            :      Int_t* cz = 0x0;
<span class="lineNum">    1025 </span>            :      
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :      switch (rotaxisorder)</span>
<span class="lineNum">    1027 </span>            :       {
<span class="lineNum">    1028 </span>            :         case 1:
<span class="lineNum">    1029 </span>            :           cx = &amp;i;
<span class="lineNum">    1030 </span>            :           cy = &amp;j;
<span class="lineNum">    1031 </span>            :           cz = &amp;k;
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1033 </span>            :         case 2:
<span class="lineNum">    1034 </span>            :           cx = &amp;j;
<span class="lineNum">    1035 </span>            :           cy = &amp;k;
<span class="lineNum">    1036 </span>            :           cz = &amp;i;
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1038 </span>            :         case 3:
<span class="lineNum">    1039 </span>            :           cx = &amp;k;
<span class="lineNum">    1040 </span>            :           cy = &amp;i;
<span class="lineNum">    1041 </span>            :           cz = &amp;j;
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :           break;</span>
<span class="lineNum">    1043 </span>            :       }
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :      rotaxisorder++;</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :      if (rotaxisorder &gt; 3) rotaxisorder = 1;</span>
<span class="lineNum">    1046 </span>            :      Int_t nrange;
<span class="lineNum">    1047 </span>            :      
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :      if (shortloop)</span>
<span class="lineNum">    1049 </span>            :       {
<span class="lineNum">    1050 </span>            :         shortloop = kFALSE;
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :         nrange = fQNBins;</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :       }</span>
<span class="lineNum">    1053 </span>            :      else 
<span class="lineNum">    1054 </span>            :       {
<span class="lineNum">    1055 </span>            :         shortloop = kTRUE;
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :         nrange = fQNBins/4;</span>
<span class="lineNum">    1057 </span>            :       }
<span class="lineNum">    1058 </span>            :        
<span class="lineNum">    1059 </span>            : //     Bool_t force = kFALSE; 
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :      for ( k = 1; k &lt;=nrange;k++ )</span>
<span class="lineNum">    1061 </span>            :       {
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :        for ( j = 1; j&lt;=nrange; j++)</span>
<span class="lineNum">    1063 </span>            :          {
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :           for ( i = 1; i&lt;=nrange; i++)</span>
<span class="lineNum">    1065 </span>            :             {
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :               if ( (chiarray[*cx][*cy][*cz]) &gt; (chiarray[xmax][ymax][zmax]) ) </span>
<span class="lineNum">    1067 </span>            :                {
<span class="lineNum">    1068 </span>            :                  xmax = *cx;
<span class="lineNum">    1069 </span>            :                  ymax = *cy;
<span class="lineNum">    1070 </span>            :                  zmax = *cz;
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :                }  </span>
<span class="lineNum">    1072 </span>            :         
<span class="lineNum">    1073 </span>            : //              Double_t fact = chiarray[*cx][*cy][*cz];//chiarray is chi2*qinv
<span class="lineNum">    1074 </span>            : //              if (fact &gt; work-&gt;GetBinError(*cx,*cy,*cz))//if differece between what we want and 
<span class="lineNum">    1075 </span>            : //               {                                  //what we have is bigger than stat. error
<span class="lineNum">    1076 </span>            : //                                                  //we force to fill that bin
<span class="lineNum">    1077 </span>            : //                 qout  = work-&gt;GetXaxis()-&gt;GetBinCenter(*cx);
<span class="lineNum">    1078 </span>            : //                 qside = work-&gt;GetYaxis()-&gt;GetBinCenter(*cy);
<span class="lineNum">    1079 </span>            : //                 qlong = work-&gt;GetZaxis()-&gt;GetBinCenter(*cz);
<span class="lineNum">    1080 </span>            : 
<span class="lineNum">    1081 </span>            : //                 Info(&quot;StartSignal&quot;,&quot; bin: (%d,%d,%d) loop status (%d,%d,%d) \nUsing Force: chiarray: %f \nq(o,s,l): (%f,%f,%f)  signal: %d background: %d binerror: %f&quot;,
<span class="lineNum">    1082 </span>            : //        *cx,*cy,*cz,i,j,k,fact,qout,qside,qlong,
<span class="lineNum">    1083 </span>            : //        (Int_t)sigarray[*cx][*cy][*cz],(Int_t)fQBackground-&gt;GetBinContent(*cx,*cy,*cz),work-&gt;GetBinError(*cx,*cy,*cz));
<span class="lineNum">    1084 </span>            : //                 force = kTRUE;
<span class="lineNum">    1085 </span>            : //                 break;
<span class="lineNum">    1086 </span>            : //               }
<span class="lineNum">    1087 </span>            :                
<span class="lineNum">    1088 </span>            :             }
<span class="lineNum">    1089 </span>            : //           if (force) break; 
<span class="lineNum">    1090 </span>            :           }
<span class="lineNum">    1091 </span>            : //         if (force) break;
<span class="lineNum">    1092 </span>            :         }
<span class="lineNum">    1093 </span>            : 
<span class="lineNum">    1094 </span>            : 
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :       qout  = work-&gt;GetXaxis()-&gt;GetBinCenter(xmax);</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :       qside = work-&gt;GetYaxis()-&gt;GetBinCenter(ymax);</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :       qlong = work-&gt;GetZaxis()-&gt;GetBinCenter(zmax);</span>
<span class="lineNum">    1098 </span>            : 
<span class="lineNum">    1099 </span>            : //      Info(&quot;StartSignal&quot;,&quot; bin: (%d,%d,%d) chiarray: %f \nq(o,s,l): (%f,%f,%f)  signal: %d background: %d binerror: %f&quot;,
<span class="lineNum">    1100 </span>            : //            xmax,ymax,zmax,chiarray[xmax][ymax][zmax],qout,qside,qlong,
<span class="lineNum">    1101 </span>            : //            (Int_t)sigarray[xmax][ymax][zmax],
<span class="lineNum">    1102 </span>            : //            (Int_t)fQBackground-&gt;GetBinContent(xmax,ymax,zmax),
<span class="lineNum">    1103 </span>            : //            work-&gt;GetBinError(xmax,ymax,zmax));
<span class="lineNum">    1104 </span>            :           
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :       qout  = gRandom-&gt;Uniform(qout-binwdh,qout+binwdh);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :       qside = gRandom-&gt;Uniform(qside-binwdh,qside+binwdh);</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       qlong = gRandom-&gt;Uniform(qlong-binwdh,qlong+binwdh);</span>
<span class="lineNum">    1108 </span>            : 
<span class="lineNum">    1109 </span>            :       TParticle* first = 0;
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :       while (ninputparticle &lt; genstack-&gt;GetNtrack())</span>
<span class="lineNum">    1111 </span>            :        {
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :          TParticle* tmpp = genstack-&gt;Particle(ninputparticle++);</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :          if (tmpp-&gt;GetPdgCode() == fPID)</span>
<span class="lineNum">    1114 </span>            :           {
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :            if (CheckParticle(tmpp,0x0,stack) == kFALSE)</span>
<span class="lineNum">    1116 </span>            :             {
<span class="lineNum">    1117 </span>            :               first = tmpp;
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1119 </span>            :             } 
<span class="lineNum">    1120 </span>            :           }
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :        } </span>
<span class="lineNum">    1122 </span>            : 
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :       if (first == 0x0)</span>
<span class="lineNum">    1124 </span>            :        {
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :          if ( fDebug &gt; 2 ) Info(&quot;StartSignal&quot;,&quot;No more particles of that type&quot;);</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :          break;</span>
<span class="lineNum">    1127 </span>            :        }
<span class="lineNum">    1128 </span>            :       
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :       Int_t retval = GetThreeD(first,second,qout,qside,qlong);</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :       if (retval)</span>
<span class="lineNum">    1131 </span>            :        {
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :          Info(&quot;StartSignal&quot;,&quot;Can not find momenta for this OSL and particle OSL = %f %f %f&quot;,qout,qside,qlong);</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :          first-&gt;Print();</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :          second-&gt;Print();</span>
<span class="lineNum">    1135 </span>            :          
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :          continue;</span>
<span class="lineNum">    1137 </span>            :        }
<span class="lineNum">    1138 </span>            :      //in case this particle is falling into signal area with another
<span class="lineNum">    1139 </span>            :      //particle we take a another pair
<span class="lineNum">    1140 </span>            :      //it can intruduce artificial correlations 
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :       Bool_t checkresult = CheckParticle(second,first,stack);</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :       if ( checkresult  &amp;&amp; (sc &lt; 10) ) </span>
<span class="lineNum">    1143 </span>            :        { 
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :          sc++;</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :          continue;</span>
<span class="lineNum">    1146 </span>            :        }  
<span class="lineNum">    1147 </span>            :       sc = 0;
<span class="lineNum">    1148 </span>            : 
<span class="lineNum">    1149 </span>            :       //Put on output stack
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :       SetTrack(first,ntr,stack);</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :       SetTrack(second,ntr,stack);</span>
<span class="lineNum">    1152 </span>            : 
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :       Double_t y = GetQOutQSideQLongCorrTheorValue(qout,qside,qlong);</span>
<span class="lineNum">    1154 </span>            :       
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :       sigarray[xmax][ymax][zmax] ++; </span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :       chiarray[xmax][ymax][zmax] = scale*sigarray[xmax][ymax][zmax]/fQBackground-&gt;GetBinContent(xmax,ymax,zmax);</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :       chiarray[xmax][ymax][zmax] = (y - chiarray[xmax][ymax][zmax]);</span>
<span class="lineNum">    1158 </span>            :       
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :    Info(&quot;StartSignal&quot;,&quot;Mixing background...&quot;);</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :    Mix(fStackBuffer,fQBackground,fQSecondBackground); //upgrate background</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :    Info(&quot;StartSignal&quot;,&quot;Mixing signal...&quot;);</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :    Mix(stack,fQSignal,fQSecondSignal); //upgrate background</span>
<span class="lineNum">    1164 </span>            : 
<span class="lineNum">    1165 </span>            :       
<span class="lineNum">    1166 </span>            : //   if ( (chisqrPerDF &lt; 2.0) &amp;&amp; (fSwapped == kFALSE) )
<span class="lineNum">    1167 </span>            : //     {
<span class="lineNum">    1168 </span>            : //         SwapGeneratingHistograms();
<span class="lineNum">    1169 </span>            : //     }
<span class="lineNum">    1170 </span>            :    
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :  }</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :  TFile* filef = TFile::Open(&quot;QTBackground.root&quot;,&quot;recreate&quot;);</span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :  fQBackground-&gt;Write();</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :  fQBackground-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :  filef-&gt;Close();</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :  delete filef;</span>
<span class="lineNum">    1177 </span>            : 
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :  filef = TFile::Open(&quot;QTSignal.root&quot;,&quot;recreate&quot;);</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :  fQSignal-&gt;Write();</span>
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :  fQSignal-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :  filef-&gt;Close();</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :  delete filef;</span>
<span class="lineNum">    1183 </span>            : 
<span class="lineNum">    1184 </span>            :  
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :  delete c1;</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :  delete work; </span>
<span class="lineNum">    1187 </span>            : 
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :  for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">    1189 </span>            :    {
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :      for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">    1191 </span>            :       {
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :         delete [] chiarray[i][k]; </span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :         delete [] sigarray[i][k];</span>
<span class="lineNum">    1194 </span>            :       }
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :      delete [] chiarray[i];</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :      delete [] sigarray[i];</span>
<span class="lineNum">    1197 </span>            :    }
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :  delete [] chiarray;</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :  delete [] sigarray;</span>
<span class="lineNum">    1200 </span>            :  
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 : }</span>
<a name="1202"><span class="lineNum">    1202 </span>            : /***********************************************************/</a>
<span class="lineNum">    1203 </span>            : 
<span class="lineNum">    1204 </span>            : void AliGenHBTosl::StartSignalPass1()
<span class="lineNum">    1205 </span>            : {
<span class="lineNum">    1206 </span>            :  //This method makes first part of the initialization of working histograms
<span class="lineNum">    1207 </span>            :  //It randomizes qout, qside and qlong from the coarse signal histogram
<span class="lineNum">    1208 </span>            :  
<span class="lineNum">    1209 </span>            :  Bool_t flag = kTRUE;
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :  TParticle particle(fPID,0,-1,-1,-1,-1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0);</span>
<span class="lineNum">    1211 </span>            :  TParticle* second = &amp;particle;
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :  Double_t qout;</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :  Double_t qside;</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :  Double_t qlong;</span>
<span class="lineNum">    1215 </span>            :  
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :  Info(&quot;StartSignalPass1&quot;,&quot;\n\nFirst Pass\n\n&quot;);</span>
<span class="lineNum">    1217 </span>            :  
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :  while (flag)</span>
<span class="lineNum">    1219 </span>            :   {
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :     Info(&quot;StartSignalPass1&quot;,&quot;NextEvent&quot;);</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :     AliStack* stack = RotateStack();</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">          0 :     AliStack* genstack = fGenerator-&gt;GetStack();</span>
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :     genstack-&gt;Reset();</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     fGenerator-&gt;Generate();</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :     Int_t j = 0, ntr = 0;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :     if ( genstack-&gt;GetNtrack() &lt; fNpart/2)</span>
<span class="lineNum">    1227 </span>            :      {
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :        Warning(&quot;StartSignalPass1&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :        Warning(&quot;StartSignalPass1&quot;,&quot;Generator generated (%d) less particles then expected (%d).&quot;,</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :                 genstack-&gt;GetNtrack(),fNpart/2);</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :        Warning(&quot;StartSignalPass1&quot;,&quot;**********************************&quot;);</span>
<span class="lineNum">    1232 </span>            :      }
<span class="lineNum">    1233 </span>            :    
<span class="lineNum">    1234 </span>            :     Int_t sc = 0;//security check against infinite loop
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :     while ((ntr+1)&lt;fNpart)</span>
<span class="lineNum">    1236 </span>            :      {
<span class="lineNum">    1237 </span>            :   
<span class="lineNum">    1238 </span>            : //    Info(&quot;StartSignal&quot;,&quot;Number of track on output stack: = %d&quot;, ntr);
<span class="lineNum">    1239 </span>            : //    Info(&quot;StartSignal&quot;,&quot;Number of track on input stack: = %d\n&quot;, j);
<span class="lineNum">    1240 </span>            :       
<span class="lineNum">    1241 </span>            :       TParticle* first = 0;
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :       while (j &lt; genstack-&gt;GetNtrack())</span>
<span class="lineNum">    1243 </span>            :        {
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :          TParticle* tmpp = genstack-&gt;Particle(j++);</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :          if (tmpp-&gt;GetPdgCode() == fPID)</span>
<span class="lineNum">    1246 </span>            :           {
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :            if (CheckParticle(tmpp,0x0,stack) == kFALSE)</span>
<span class="lineNum">    1248 </span>            :             {
<span class="lineNum">    1249 </span>            :               first = tmpp;
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1251 </span>            :             }
<span class="lineNum">    1252 </span>            :            else
<span class="lineNum">    1253 </span>            :             {
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :               Info(&quot;StartSignalPass1&quot;,&quot;Particle did not pass the safety check 1&quot;);</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :               tmpp-&gt;Print();</span>
<span class="lineNum">    1256 </span>            :             } 
<span class="lineNum">    1257 </span>            :           }
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :        } </span>
<span class="lineNum">    1259 </span>            : 
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :       if (first == 0x0)</span>
<span class="lineNum">    1261 </span>            :        {
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :          if ( fDebug &gt; 2 ) Info(&quot;StartSignalPass1&quot;,&quot;No more particles of that type&quot;);</span>
<span class="lineNum">    1263 </span>            :          
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :          break;</span>
<span class="lineNum">    1265 </span>            :        }
<span class="lineNum">    1266 </span>            : 
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :       SetTrack(first,ntr,stack);</span>
<span class="lineNum">    1268 </span>            :       
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :       fQCoarseSignal-&gt;GetRandom3(qout,qside,qlong);</span>
<span class="lineNum">    1270 </span>            : 
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :       Int_t retval = GetThreeD(first,second,qout,qside,qlong);</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :       if (retval)</span>
<span class="lineNum">    1273 </span>            :        {
<span class="lineNum">    1274 </span>            :          //Info(&quot;StartSignal&quot;,&quot;Can not find momenta for this OSL and particle&quot;);
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :          continue;</span>
<span class="lineNum">    1276 </span>            :        }
<span class="lineNum">    1277 </span>            :       //in case this particle is falling into signal area with another
<span class="lineNum">    1278 </span>            :       //particle we take a another pair
<span class="lineNum">    1279 </span>            :       //it can intruduce artificial correlations 
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :        Bool_t checkresult = CheckParticle(second,first,stack);</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :        if ( checkresult  &amp;&amp; (sc &lt; 10) ) </span>
<span class="lineNum">    1282 </span>            :         { 
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :           sc++;</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :           Info(&quot;StartSignalPass1&quot;,&quot;Particle did not pass the safety check 2&quot;);</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :           second-&gt;Print();</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :           continue;</span>
<span class="lineNum">    1287 </span>            :         }
<span class="lineNum">    1288 </span>            :  
<span class="lineNum">    1289 </span>            :        sc = 0;
<span class="lineNum">    1290 </span>            :       
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :       SetTrack(second,ntr,stack);</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :      }</span>
<span class="lineNum">    1293 </span>            :     
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :     Mix(stack,fQSignal,fQSecondSignal);</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :     Mix(fStackBuffer,fQBackground,fQSecondBackground);</span>
<span class="lineNum">    1296 </span>            :     
<span class="lineNum">    1297 </span>            :     flag = kFALSE;
<span class="lineNum">    1298 </span>            :     
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :     for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">    1300 </span>            :       {
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :        for (j = 1; j&lt;=fQNBins; j++)</span>
<span class="lineNum">    1302 </span>            :          {  
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :            for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">    1304 </span>            :              {
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :                 if ( (fQBackground-&gt;GetBinContent(i,j,k) &lt; fMinFill) )</span>
<span class="lineNum">    1306 </span>            :                   {
<span class="lineNum">    1307 </span>            :                     //(fQSignal-&gt;GetBinContent(i,j,k) &lt; fMinFill) || 
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :         Info(&quot;StartSignalPass1&quot;,&quot;bin (%d,%d,%d): signal=%f background=%f&quot;,i,j,k,</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :                           fQSignal-&gt;GetBinContent(i,j,k),fQBackground-&gt;GetBinContent(i,j,k));</span>
<span class="lineNum">    1310 </span>            :         flag = kTRUE;//continue while
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :         break;//breakes for not while</span>
<span class="lineNum">    1312 </span>            :                   }
<span class="lineNum">    1313 </span>            :              }
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :             if (flag == kTRUE) break;</span>
<span class="lineNum">    1315 </span>            :           }
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :         if (flag == kTRUE) break;</span>
<span class="lineNum">    1317 </span>            :       }
<span class="lineNum">    1318 </span>            :     
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :   }//while (flag)</span>
<span class="lineNum">    1320 </span>            : 
<span class="lineNum">    1321 </span>            : 
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 : }</span>
<a name="1323"><span class="lineNum">    1323 </span>            : /***********************************************************/</a>
<span class="lineNum">    1324 </span>            : 
<span class="lineNum">    1325 </span>            : void AliGenHBTosl::FillCoarseSignal()
<span class="lineNum">    1326 </span>            : {
<span class="lineNum">    1327 </span>            :  //Makes coarse signal by multiplying the coarse background and required function
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :  Info(&quot;FillCoarseSignal&quot;,&quot;START&quot;);</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :  for (Int_t k = 1; k &lt;=fQNBins ;k++ )</span>
<span class="lineNum">    1330 </span>            :    {
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :     Double_t z = fQCoarseBackground-&gt;GetZaxis()-&gt;GetBinCenter(k);</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :     for (Int_t j = 1; j &lt;=fQNBins; j++)</span>
<span class="lineNum">    1333 </span>            :       {
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :        Double_t y = fQCoarseBackground-&gt;GetYaxis()-&gt;GetBinCenter(j);</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :        for (Int_t i = 1; i &lt;=fQNBins; i++)</span>
<span class="lineNum">    1336 </span>            :          {
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :            Double_t x  = fQCoarseBackground-&gt;GetXaxis()-&gt;GetBinCenter(i);</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :            Double_t v = GetQOutQSideQLongCorrTheorValue(x,y,z);</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :            Info(&quot;FillCoarseSignal&quot;,&quot;Bin (%d,%d,%d): osl(%f,%f,%f)=%f&quot;,i,j,k,x,y,z,v);</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :            fQCoarseSignal-&gt;SetBinContent(i,j,k,v*fQCoarseBackground-&gt;GetBinContent(i,j,k));</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :          }   </span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :        }  </span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :     }   </span>
<span class="lineNum">    1344 </span>            :  
<span class="lineNum">    1345 </span>            :   //if (AliDebugLevel()) 
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :   TestCoarseSignal();</span>
<span class="lineNum">    1347 </span>            :  
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :   Info(&quot;FillCoarseSignal&quot;,&quot;DONE&quot;); </span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 : }</span>
<a name="1350"><span class="lineNum">    1350 </span>            : /***********************************************************/</a>
<span class="lineNum">    1351 </span>            : 
<span class="lineNum">    1352 </span>            : void AliGenHBTosl::FillCoarse()
<span class="lineNum">    1353 </span>            : {
<span class="lineNum">    1354 </span>            :   //creates the statistical background histogram on the base of input from
<span class="lineNum">    1355 </span>            :   //fGenerator
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 :   Info(&quot;FillCoarse&quot;,&quot;START&quot;);</span>
<span class="lineNum">    1357 </span>            :    
<span class="lineNum">    1358 </span>            :   AliStack* stack;
<span class="lineNum">    1359 </span>            :   Int_t niter = 0;
<span class="lineNum">    1360 </span>            :   
<span class="lineNum">    1361 </span>            :   Bool_t cont;
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :   TH3D tmph(&quot;tmph&quot;,&quot;tmph&quot;,2,0,1,2,0,1,2,0,1);</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :   printf(&quot;\n&quot;);</span>
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span>            :   do 
<span class="lineNum">    1366 </span>            :    { 
<span class="lineNum">    1367 </span>            : //     if (niter &gt; 20) break;
<span class="lineNum">    1368 </span>            :      
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :      cout&lt;&lt;niter++&lt;&lt;&quot;  bincont &quot;&lt;&lt;fQCoarseBackground-&gt;GetBinContent(30,30,28)</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot; &quot;&lt;&lt;fQCoarseBackground-&gt;GetBinContent(30,30,29)</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot; &quot;&lt;&lt;fQCoarseBackground-&gt;GetBinContent(30,30,30)</span>
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot; &quot;&lt;&lt;fQCoarseBackground-&gt;GetBinContent(30,30,31)</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot; &quot;&lt;&lt;fQCoarseBackground-&gt;GetBinContent(30,30,32)</span>
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :                   &lt;&lt;&quot;\n&quot;;</span>
<span class="lineNum">    1375 </span><span class="lineNoCov">          0 :      fflush(0);</span>
<span class="lineNum">    1376 </span>            : 
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :      stack = RotateStack();</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :      fGenerator-&gt;SetStack(stack);</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :      fGenerator-&gt;Init();</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :      fGenerator-&gt;Generate();</span>
<span class="lineNum">    1381 </span>            : 
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :      Mix(fStackBuffer,fQCoarseBackground,&amp;tmph);</span>
<span class="lineNum">    1383 </span>            :      
<span class="lineNum">    1384 </span>            :      cont = kFALSE;
<span class="lineNum">    1385 </span>            :      
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :      Info(&quot;FillCoarse&quot;,&quot;fMinFill = %d&quot;,fMinFill);</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :      for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">    1388 </span>            :        {
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :         for (Int_t j = 1; j&lt;=fQNBins; j++)</span>
<span class="lineNum">    1390 </span>            :           {  
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :             for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">    1392 </span>            :               {
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :                 if ( fQCoarseBackground-&gt;GetBinContent(i,j,k) &lt; fMinFill )</span>
<span class="lineNum">    1394 </span>            :                 {
<span class="lineNum">    1395 </span>            :                   cont = kTRUE;
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :                   Info(&quot;FillCoarse&quot;,&quot;bin (%d,%d,%d)=%f&quot;,i,j,k,fQCoarseBackground-&gt;GetBinContent(i,j,k));</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :                   break;</span>
<span class="lineNum">    1398 </span>            :                 }
<span class="lineNum">    1399 </span>            : 
<span class="lineNum">    1400 </span>            :               }
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :             if (cont) break;</span>
<span class="lineNum">    1402 </span>            :           }
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :          if (cont) break;</span>
<span class="lineNum">    1404 </span>            :         }
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :    }while(cont);</span>
<span class="lineNum">    1406 </span>            :    
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :   printf(&quot;\n&quot;);</span>
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :   fGenerator-&gt;SetStack(0x0);</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :   Info(&quot;FillCoarse&quot;,&quot;DONE&quot;);</span>
<span class="lineNum">    1410 </span>            :   
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 : }</span>
<a name="1412"><span class="lineNum">    1412 </span>            : /***********************************************************/</a>
<span class="lineNum">    1413 </span>            :  
<span class="lineNum">    1414 </span>            : void AliGenHBTosl::Mix(TList* eventbuffer,TH3D* denominator,TH3D* denominator2)
<span class="lineNum">    1415 </span>            : {
<span class="lineNum">    1416 </span>            :   //Fills denominators
<span class="lineNum">    1417 </span>            :   //Mixes events stored in the eventbuffer and fills the background histograms
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :   static TStopwatch stoper;</span>
<span class="lineNum">    1419 </span>            :   
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :   if (eventbuffer == 0x0)</span>
<span class="lineNum">    1421 </span>            :    {
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :     Error(&quot;Mix&quot;,&quot;Buffer List is null.&quot;);</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1424 </span>            :    }
<span class="lineNum">    1425 </span>            : 
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :   if (denominator == 0x0)</span>
<span class="lineNum">    1427 </span>            :    {
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :     Error(&quot;Mix&quot;,&quot;Denominator histogram is null.&quot;);</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1430 </span>            :    }
<span class="lineNum">    1431 </span>            : 
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :   if (denominator2 == 0x0)</span>
<span class="lineNum">    1433 </span>            :    {
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     Error(&quot;Mix&quot;,&quot;Denominator2 histogram is null.&quot;);</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1436 </span>            :    }
<span class="lineNum">    1437 </span>            : 
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :   Info(&quot;Mix&quot;,&quot;%s&quot;,denominator-&gt;GetName());</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :   stoper.Start();</span>
<span class="lineNum">    1440 </span>            :   
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :   TIter next(eventbuffer);</span>
<span class="lineNum">    1442 </span>            :   AliStack* firstevent;
<span class="lineNum">    1443 </span>            :   AliStack* secondevent = 0x0;
<span class="lineNum">    1444 </span>            :   
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :   while(( firstevent=(AliStack*)next() ))</span>
<span class="lineNum">    1446 </span>            :    {
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :     if (secondevent == 0x0) </span>
<span class="lineNum">    1448 </span>            :      {
<span class="lineNum">    1449 </span>            :        secondevent = firstevent;
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :        continue;</span>
<span class="lineNum">    1451 </span>            :      }
<span class="lineNum">    1452 </span>            : //    Info(&quot;Mix&quot;,&quot;Mixing %#x with %#x&quot;,firstevent,secondevent);
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :     for(Int_t j = 0; j &lt; firstevent-&gt;GetNtrack(); j++ )</span>
<span class="lineNum">    1454 </span>            :      { 
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :        TParticle* firstpart = firstevent-&gt;Particle(j);</span>
<span class="lineNum">    1456 </span>            :        
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :        Float_t phi = firstpart-&gt;Phi();</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :        if ( (phi &lt; fSamplePhiMin) || ( phi &gt; fSamplePhiMax)) continue;</span>
<span class="lineNum">    1459 </span>            :        
<span class="lineNum">    1460 </span>            : //       Info(&quot;Mix&quot;,&quot;Mixing %d phi %f min %f max %f&quot;,j,phi,fSamplePhiMin,fSamplePhiMax);
<span class="lineNum">    1461 </span>            : 
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :        for(Int_t i = 0; i &lt; secondevent-&gt;GetNtrack(); i++ )</span>
<span class="lineNum">    1463 </span>            :          {
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :            TParticle* secondpart = secondevent-&gt;Particle(i);</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :            phi = secondpart-&gt;Phi();</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :            if ( (phi &lt; fSamplePhiMin) || ( phi &gt; fSamplePhiMax)) continue;</span>
<span class="lineNum">    1467 </span>            :            
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :            Double_t qout;</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :            Double_t qside;</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :            Double_t qlong;</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :            GetQOutQSideQLong(firstpart,secondpart,qout,qside,qlong);</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :            denominator-&gt;Fill(qout,qside,qlong);</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :            denominator2-&gt;Fill(qout,qside,qlong);</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :          }</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :      }</span>
<span class="lineNum">    1476 </span>            : 
<span class="lineNum">    1477 </span>            :     secondevent = firstevent;
<span class="lineNum">    1478 </span>            :    }
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :   stoper.Stop();</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :   stoper.Print();</span>
<span class="lineNum">    1481 </span>            :   
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 : }</span>
<a name="1483"><span class="lineNum">    1483 </span>            : /***********************************************************/</a>
<span class="lineNum">    1484 </span>            : 
<span class="lineNum">    1485 </span>            : void AliGenHBTosl::Mix(AliStack* stack, TH3D* numerator, TH3D* numerator2)
<span class="lineNum">    1486 </span>            : {
<span class="lineNum">    1487 </span>            : //fils numerator with particles from stack
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :   static TStopwatch stoper;</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :   if (stack == 0x0)</span>
<span class="lineNum">    1490 </span>            :    {
<span class="lineNum">    1491 </span><span class="lineNoCov">          0 :     Error(&quot;Mix&quot;,&quot;Stack is null.&quot;);</span>
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1493 </span>            :    }
<span class="lineNum">    1494 </span>            : 
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :   if ( (numerator == 0x0) || (numerator2 == 0x0) )</span>
<span class="lineNum">    1496 </span>            :    {
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :     Error(&quot;Mix&quot;,&quot;Numerator histogram is null.&quot;);</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1499 </span>            :    }
<span class="lineNum">    1500 </span>            : 
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :   Info(&quot;Mix&quot;,&quot;%s&quot;,numerator-&gt;GetName());</span>
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :   stoper.Start();</span>
<span class="lineNum">    1503 </span>            : 
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :   for(Int_t j = 0; j &lt; stack-&gt;GetNtrack(); j++ )</span>
<span class="lineNum">    1505 </span>            :     { 
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :       TParticle* firstpart = stack-&gt;Particle(j);</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :       Float_t phi = firstpart-&gt;Phi();</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :       if ( (phi &lt; fSamplePhiMin) || ( phi &gt; fSamplePhiMax)) continue;</span>
<span class="lineNum">    1509 </span>            :        
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :       for(Int_t i = j+1; i &lt; stack-&gt;GetNtrack(); i++ )</span>
<span class="lineNum">    1511 </span>            :        {
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :          TParticle* secondpart = stack-&gt;Particle(i);</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :          phi = secondpart-&gt;Phi();</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :          if ( (phi &lt; fSamplePhiMin) || ( phi &gt; fSamplePhiMax)) continue;</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :          Double_t qout;</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :          Double_t qside;</span>
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 :          Double_t qlong;</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :          GetQOutQSideQLong(firstpart,secondpart,qout,qside,qlong);</span>
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :          numerator-&gt;Fill(qout,qside,qlong);</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :          numerator2-&gt;Fill(qout,qside,qlong);</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :        }</span>
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :   stoper.Stop();</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :   stoper.Print();</span>
<span class="lineNum">    1525 </span>            :   
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 : }</span>
<a name="1527"><span class="lineNum">    1527 </span>            : /***********************************************************/</a>
<span class="lineNum">    1528 </span>            : 
<span class="lineNum">    1529 </span>            : Double_t AliGenHBTosl::GetQInv(TParticle* f, TParticle* s)
<span class="lineNum">    1530 </span>            : {
<span class="lineNum">    1531 </span>            : //calculates qinv 
<span class="lineNum">    1532 </span>            : // cout&lt;&lt;f-&gt;Px()&lt;&lt;&quot;   &quot;&lt;&lt;s-&gt;Px()&lt;&lt;endl;
<span class="lineNum">    1533 </span><span class="lineNoCov">          0 :  Double_t pxdiff = f-&gt;Px() - s-&gt;Px();</span>
<span class="lineNum">    1534 </span><span class="lineNoCov">          0 :  Double_t pydiff = f-&gt;Py() - s-&gt;Py();</span>
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 :  Double_t pzdiff = f-&gt;Pz() - s-&gt;Pz();</span>
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :  Double_t ediff  = f-&gt;Energy() - s-&gt;Energy();</span>
<span class="lineNum">    1537 </span>            :  
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :  Double_t qinvl = ediff*ediff - ( pxdiff*pxdiff + pydiff*pydiff + pzdiff*pzdiff );</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :  Double_t qinv = TMath::Sqrt(TMath::Abs(qinvl)); </span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :  return qinv;</span>
<span class="lineNum">    1541 </span>            : }
<a name="1542"><span class="lineNum">    1542 </span>            : /***********************************************************/</a>
<span class="lineNum">    1543 </span>            : 
<span class="lineNum">    1544 </span>            : void  AliGenHBTosl::GetQOutQSideQLong(TParticle* f, TParticle* s,Double_t&amp; out, Double_t&amp; side, Double_t&amp; lon)
<span class="lineNum">    1545 </span>            : {
<span class="lineNum">    1546 </span>            :  //returns qout,qside and qlong of the pair of particles
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :  out = side = lon = 10e5;</span>
<span class="lineNum">    1548 </span>            :  
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :  Double_t pxsum = f-&gt;Px() + s-&gt;Px();</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :  Double_t pysum = f-&gt;Py() + s-&gt;Py();</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :  Double_t pzsum = f-&gt;Pz() + s-&gt;Pz();</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :  Double_t esum  = f-&gt;Energy() + s-&gt;Energy();</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :  Double_t pxdiff = f-&gt;Px() - s-&gt;Px();</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :  Double_t pydiff = f-&gt;Py() - s-&gt;Py();</span>
<span class="lineNum">    1555 </span><span class="lineNoCov">          0 :  Double_t pzdiff = f-&gt;Pz() - s-&gt;Pz();</span>
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :  Double_t ediff  = f-&gt;Energy() - s-&gt;Energy();</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :  Double_t kt =  0.5*TMath::Hypot(pxsum,pysum);</span>
<span class="lineNum">    1558 </span>            : 
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :  Double_t k2 = pxsum*pxdiff+pysum*pydiff;</span>
<span class="lineNum">    1560 </span>            :  
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :  if (kt == 0.0)</span>
<span class="lineNum">    1562 </span>            :   {
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :      f-&gt;Print();</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :      s-&gt;Print();</span>
<span class="lineNum">    1565 </span>            :      kt = 10e5;
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1567 </span>            :  else
<span class="lineNum">    1568 </span>            :   { 
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :     out = 0.5*k2/kt;</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :     side = (f-&gt;Px()*s-&gt;Py()-s-&gt;Px()*f-&gt;Py())/kt;</span>
<span class="lineNum">    1571 </span>            :   }
<span class="lineNum">    1572 </span>            : 
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :  Double_t beta = pzsum/esum;</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :  Double_t gamma = 1.0/TMath::Sqrt((1.-beta)*(1.+beta));</span>
<span class="lineNum">    1575 </span>            : 
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :  lon = gamma * ( pzdiff - beta*ediff );</span>
<span class="lineNum">    1577 </span>            : 
<span class="lineNum">    1578 </span>            : // out = TMath::Abs(out);
<span class="lineNum">    1579 </span>            : // side = TMath::Abs(side);
<span class="lineNum">    1580 </span>            : // lon = TMath::Abs(lon);
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1582 </span>            : 
<a name="1583"><span class="lineNum">    1583 </span>            : /***********************************************************/</a>
<span class="lineNum">    1584 </span>            : 
<span class="lineNum">    1585 </span>            : Double_t AliGenHBTosl::Scale(TH3D* num, TH3D* den)
<span class="lineNum">    1586 </span>            : {
<span class="lineNum">    1587 </span>            :  //Calculates the factor that should be used to scale
<span class="lineNum">    1588 </span>            :  //quatience of num and den to 1 at tail
<span class="lineNum">    1589 </span>            : 
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :   AliDebug(1,&quot;Entered&quot;);</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :   if(!num)</span>
<span class="lineNum">    1592 </span>            :    {
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :      AliError(&quot;No numerator&quot;);</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :      return 0.0;</span>
<span class="lineNum">    1595 </span>            :    }
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :   if(!den)</span>
<span class="lineNum">    1597 </span>            :    {
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :      AliError(&quot;No denominator&quot;);</span>
<span class="lineNum">    1599 </span><span class="lineNoCov">          0 :      return 0.0;</span>
<span class="lineNum">    1600 </span>            :    }
<span class="lineNum">    1601 </span>            : 
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :   if(fNBinsToScale &lt; 1)</span>
<span class="lineNum">    1603 </span>            :    {
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :     AliError(&quot;Number of bins for scaling is smaller than 1&quot;);</span>
<span class="lineNum">    1605 </span><span class="lineNoCov">          0 :     return 0.0;</span>
<span class="lineNum">    1606 </span>            :    }
<span class="lineNum">    1607 </span>            :   Int_t fNBinsToScaleX = fNBinsToScale;
<span class="lineNum">    1608 </span>            :   Int_t fNBinsToScaleY = fNBinsToScale;
<span class="lineNum">    1609 </span>            :   Int_t fNBinsToScaleZ = fNBinsToScale;
<span class="lineNum">    1610 </span>            : 
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :   Int_t nbinsX = num-&gt;GetNbinsX();</span>
<span class="lineNum">    1612 </span><span class="lineNoCov">          0 :   if (fNBinsToScaleX &gt; nbinsX) </span>
<span class="lineNum">    1613 </span>            :    {
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :     AliError(&quot;Number of X bins for scaling is bigger thnan number of bins in histograms&quot;);</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :     return 0.0;</span>
<span class="lineNum">    1616 </span>            :    }
<span class="lineNum">    1617 </span>            :    
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :   Int_t nbinsY = num-&gt;GetNbinsX();</span>
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :   if (fNBinsToScaleY &gt; nbinsY) </span>
<span class="lineNum">    1620 </span>            :    {
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :     AliError(&quot;Number of Y bins for scaling is bigger thnan number of bins in histograms&quot;);</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :     return 0.0;</span>
<span class="lineNum">    1623 </span>            :    }
<span class="lineNum">    1624 </span>            : 
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :   Int_t nbinsZ = num-&gt;GetNbinsZ();</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :   if (fNBinsToScaleZ &gt; nbinsZ) </span>
<span class="lineNum">    1627 </span>            :    {
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :     AliError(&quot;Number of Z bins for scaling is bigger thnan number of bins in histograms&quot;);</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :     return 0.0;</span>
<span class="lineNum">    1630 </span>            :    }
<span class="lineNum">    1631 </span>            : 
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :   AliDebug(1,&quot;No errors detected&quot;);</span>
<span class="lineNum">    1633 </span>            : 
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :   Int_t offsetX = nbinsX - fNBinsToScaleX - 1; //bin that we start loop over bins in axis X</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">          0 :   Int_t offsetY = nbinsY - fNBinsToScaleY - 1; //bin that we start loop over bins in axis Y</span>
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 :   Int_t offsetZ = nbinsZ - fNBinsToScaleZ - 1; //bin that we start loop over bins in axis Z</span>
<span class="lineNum">    1637 </span>            : 
<span class="lineNum">    1638 </span>            :   Double_t densum = 0.0;
<span class="lineNum">    1639 </span>            :   Double_t numsum = 0.0;
<span class="lineNum">    1640 </span>            :   
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :   for (Int_t k = offsetZ; k&lt;nbinsZ; k++)</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :     for (Int_t j = offsetY; j&lt;nbinsY; j++)</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :       for (Int_t i = offsetX; i&lt;nbinsX; i++)</span>
<span class="lineNum">    1644 </span>            :        {
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :         if ( num-&gt;GetBinContent(i,j,k) &gt; 0.0 )</span>
<span class="lineNum">    1646 </span>            :          {
<span class="lineNum">    1647 </span>            :            
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :            densum += den-&gt;GetBinContent(i,j,k);</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :            numsum += num-&gt;GetBinContent(i,j,k);</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :          }</span>
<span class="lineNum">    1651 </span>            :        }
<span class="lineNum">    1652 </span>            :   
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :   AliDebug(1,Form(&quot;numsum=%f densum=%f fNBinsToScaleX=%d fNBinsToScaleY=%d fNBinsToScaleZ=%d&quot;,</span>
<span class="lineNum">    1654 </span>            :           numsum,densum,fNBinsToScaleX,fNBinsToScaleY,fNBinsToScaleZ));
<span class="lineNum">    1655 </span>            :   
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :   if (numsum == 0) return 0.0;</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :   Double_t ret = densum/numsum;</span>
<span class="lineNum">    1658 </span>            : 
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :   AliDebug(1,Form(&quot;returning %f&quot;,ret));</span>
<span class="lineNum">    1660 </span>            :   return ret;
<span class="lineNum">    1661 </span>            :    
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 : }</span>
<a name="1663"><span class="lineNum">    1663 </span>            : /***********************************************************/</a>
<span class="lineNum">    1664 </span>            : 
<span class="lineNum">    1665 </span>            : void AliGenHBTosl::TestCoarseSignal()
<span class="lineNum">    1666 </span>            : {
<span class="lineNum">    1667 </span>            : //Tests how works filling from generated histogram shape
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :   TH3D* work = new TH3D(&quot;work&quot;,&quot;work&quot;,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange,fQNBins,-fQRange,fQRange);</span>
<span class="lineNum">    1669 </span>            :      
<span class="lineNum">    1670 </span>            : //  for (Int_t i = 0; i &lt; fQCoarseBackground-&gt;GetEntries() ;i++)
<span class="lineNum">    1671 </span>            : //   {
<span class="lineNum">    1672 </span>            : //     Double_t x,y,z;
<span class="lineNum">    1673 </span>            : //     fQCoarseSignal-&gt;GetRandom3(x,y,z);
<span class="lineNum">    1674 </span>            : //     work-&gt;Fill(x,y,z);
<span class="lineNum">    1675 </span>            : //   }
<span class="lineNum">    1676 </span>            : 
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :   TCanvas* c1 = new TCanvas();</span>
<span class="lineNum">    1678 </span><span class="lineNoCov">          0 :   c1-&gt;cd();</span>
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :   work-&gt;Draw();</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :   c1-&gt;SaveAs(&quot;QTwork.root&quot;);</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :   TFile* file = TFile::Open(&quot;QTwork.root&quot;,&quot;update&quot;);</span>
<span class="lineNum">    1682 </span>            : //  work-&gt;Write();
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :   work-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :   file-&gt;Close();</span>
<span class="lineNum">    1685 </span>            :   
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :   fQCoarseSignal-&gt;Draw(); </span>
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :   c1-&gt;SaveAs(&quot;QTCoarseSignal.root&quot;);</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :   file = TFile::Open(&quot;QTCoarseSignal.root&quot;,&quot;update&quot;);</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :   fQCoarseSignal-&gt;Write();</span>
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :   fQCoarseSignal-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1691 </span><span class="lineNoCov">          0 :   file-&gt;Close();</span>
<span class="lineNum">    1692 </span>            :   
<span class="lineNum">    1693 </span><span class="lineNoCov">          0 :   fQCoarseBackground-&gt;Draw(); </span>
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :   c1-&gt;SaveAs(&quot;QTCoarseBackground.root&quot;);</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :   file = TFile::Open(&quot;QTCoarseBackground.root&quot;,&quot;update&quot;);</span>
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :   fQCoarseBackground-&gt;Write();</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :   fQCoarseBackground-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :   file-&gt;Close();</span>
<span class="lineNum">    1699 </span>            :   
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :   TH1 *result = (TH1*)fQCoarseBackground-&gt;Clone(&quot;ratio&quot;);</span>
<span class="lineNum">    1701 </span><span class="lineNoCov">          0 :   result-&gt;SetTitle(&quot;ratio&quot;);</span>
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :   Float_t normfactor = Scale(work,fQCoarseBackground);</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :   result-&gt;Divide(work,fQCoarseBackground,normfactor);//work</span>
<span class="lineNum">    1704 </span>            :   
<span class="lineNum">    1705 </span>            :   
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :   c1-&gt;cd();</span>
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :   result-&gt;Draw();</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :   c1-&gt;SaveAs(&quot;QTresult.root&quot;);</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :   file = TFile::Open(&quot;QTresult.root&quot;,&quot;update&quot;);</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :   result-&gt;Write();</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :   result-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 :   file-&gt;Close();</span>
<span class="lineNum">    1713 </span>            :   
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :   delete work;</span>
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :   delete c1;</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 : }</span>
<a name="1717"><span class="lineNum">    1717 </span>            : /***********************************************************/</a>
<span class="lineNum">    1718 </span>            : 
<span class="lineNum">    1719 </span>            : void AliGenHBTosl::SetTrack(TParticle* p, Int_t&amp; ntr) 
<span class="lineNum">    1720 </span>            : {
<span class="lineNum">    1721 </span>            : //Shortcut to PushTrack(bla,bla,bla,bla.............)
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :    if (p-&gt;P() == 0.0)</span>
<span class="lineNum">    1723 </span>            :     {
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :       Error(&quot;SetTrack(TParticle*,Int_t&amp;)&quot;,&quot;Particle has zero momentum&quot;);</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :       return;</span>
<span class="lineNum">    1726 </span>            :     }
<span class="lineNum">    1727 </span>            :    
<span class="lineNum">    1728 </span>            :    
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 :    Int_t pdg = p-&gt;GetPdgCode();</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :    Double_t px = p-&gt;Px();</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :    Double_t py = p-&gt;Py();</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :    Double_t pz = p-&gt;Pz();</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :    Double_t e  = p-&gt;Energy();</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :    Double_t vx = p-&gt;Vx();</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :    Double_t vy = p-&gt;Vy();</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :    Double_t vz = p-&gt;Vz();</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :    Double_t tof = p-&gt;T();</span>
<span class="lineNum">    1738 </span>            : 
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :    TVector3 pol;</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :    p-&gt;GetPolarisation(pol);</span>
<span class="lineNum">    1741 </span>            : 
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :    Double_t polx = pol.X();</span>
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :    Double_t poly = pol.Y();</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :    Double_t polz = pol.Z();</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :    TMCProcess mech = AliGenCocktailAfterBurner::IntToMCProcess(p-&gt;GetUniqueID());</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :    Float_t weight = p-&gt;GetWeight();</span>
<span class="lineNum">    1747 </span>            : 
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :    AliGenerator::PushTrack(fTrackIt, -1, pdg, px, py, pz, e, vx, vy, vz, tof,polx, poly, polz, mech, ntr, weight);</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 : }</span>
<a name="1750"><span class="lineNum">    1750 </span>            : /***********************************************************/</a>
<span class="lineNum">    1751 </span>            : 
<span class="lineNum">    1752 </span>            : void AliGenHBTosl::SetTrack(TParticle* p, Int_t&amp; ntr, AliStack* stack) const 
<span class="lineNum">    1753 </span>            : {
<span class="lineNum">    1754 </span>            : //Shortcut to SetTrack(bla,bla,bla,bla.............)
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 :    if (p-&gt;P() == 0.0)</span>
<span class="lineNum">    1756 </span>            :     {
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :       Error(&quot;SetTrack(TParticle*,Int_t&amp;,AliStack*)&quot;,&quot;Particle has zero momentum&quot;);</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :       return;</span>
<span class="lineNum">    1759 </span>            :     }
<span class="lineNum">    1760 </span>            :  
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :    Int_t pdg = p-&gt;GetPdgCode();</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :    Double_t px = p-&gt;Px();</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :    Double_t py = p-&gt;Py();</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :    Double_t pz = p-&gt;Pz();</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :    Double_t e  = p-&gt;Energy();</span>
<span class="lineNum">    1766 </span>            : 
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :    stack-&gt;PushTrack(fTrackIt, -1, pdg, px, py, pz, e, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, kPPrimary, ntr,1,0);</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 : }</span>
<a name="1769"><span class="lineNum">    1769 </span>            : /***********************************************************/</a>
<span class="lineNum">    1770 </span>            : 
<span class="lineNum">    1771 </span>            : void AliGenHBTosl::Rotate(TVector3&amp; relvector, TVector3&amp; vector)
<span class="lineNum">    1772 </span>            : {
<span class="lineNum">    1773 </span>            : //This method rotates vector about the angeles that are needed to rotate 
<span class="lineNum">    1774 </span>            : //relvector from postion (firstPx,0,0) to its actual positon
<span class="lineNum">    1775 </span>            : //In other words: To make equations easier
<span class="lineNum">    1776 </span>            : 
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :   static TVector3 first;</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :   if (AliDebugLevel()&gt;=1) </span>
<span class="lineNum">    1779 </span>            :    {
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :      first.SetXYZ(relvector.x(),relvector.y(),relvector.z());</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">    1782 </span>            :   
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :   Double_t firstPx = TMath::Sqrt( relvector.x()*relvector.x() + </span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :                                   relvector.y()*relvector.y() + </span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :                                   relvector.z()*relvector.z()   );</span>
<span class="lineNum">    1786 </span>            :                       
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :   Double_t rotAngleZ = -TMath::ATan2(relvector.y(),relvector.x());//calculating rot angles</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :   relvector.RotateZ(rotAngleZ);</span>
<span class="lineNum">    1789 </span>            :   rotAngleZ = -rotAngleZ;
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :   Double_t rotAngleY = -TMath::ATan2(relvector.z(),relvector.x());</span>
<span class="lineNum">    1791 </span>            :   
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :   vector.RotateY(rotAngleY);</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :   vector.RotateZ(rotAngleZ);</span>
<span class="lineNum">    1794 </span>            :   
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :   if (AliDebugLevel()&gt;5)</span>
<span class="lineNum">    1796 </span>            :    {
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :     TVector3 test(firstPx,0.0,0.0);</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :     test.RotateY(rotAngleY);</span>
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :     test.RotateZ(rotAngleZ);</span>
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :     AliInfo(Form(&quot;Rotation test: px %f %f&quot;,first.x(),test.x()));</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :     AliInfo(Form(&quot;Rotation test: py %f %f&quot;,first.y(),test.y()));</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :     AliInfo(Form(&quot;Rotation test: pz %f %f&quot;,first.z(),test.z()));</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 : }</span>
<a name="1805"><span class="lineNum">    1805 </span>            : /***********************************************************/</a>
<span class="lineNum">    1806 </span>            : 
<span class="lineNum">    1807 </span>            : Double_t AliGenHBTosl::Rotate(Double_t x,Double_t y,Double_t z)
<span class="lineNum">    1808 </span>            : {
<span class="lineNum">    1809 </span>            : //Rotates vector to base where only x - coordinate is no-zero, and returns that 
<span class="lineNum">    1810 </span>            : 
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :   Double_t xylength = TMath::Hypot(x,y);</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :   Double_t sinphi = -y/xylength;</span>
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :   Double_t cosphi = x/xylength;</span>
<span class="lineNum">    1814 </span>            :   
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :   Double_t xprime = cosphi*x - sinphi*y;</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :   Double_t yprime = sinphi*x + cosphi*y;</span>
<span class="lineNum">    1817 </span>            :   
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :   TVector3 v(x,y,z);</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :   Double_t a1 = -TMath::ATan2(v.Y(),v.X());</span>
<span class="lineNum">    1820 </span>            :   
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :   if (AliDebugLevel()&gt;5)</span>
<span class="lineNum">    1822 </span>            :    {
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :      AliInfo(Form(&quot;Xpr = %f  Ypr = %f&quot;,xprime,yprime));</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :      AliInfo(Form(&quot;Calc sin = %f, and %f&quot;,sinphi,TMath::Sin(a1)));</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :      AliInfo(Form(&quot;Calc cos = %f, and %f&quot;,cosphi,TMath::Cos(a1)));</span>
<span class="lineNum">    1826 </span>            :    }
<span class="lineNum">    1827 </span>            : 
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :   Double_t xprimezlength = TMath::Hypot(xprime,z);</span>
<span class="lineNum">    1829 </span>            :   
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :   Double_t sintheta = z/xprimezlength;</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :   Double_t costheta = xprime/xprimezlength;</span>
<span class="lineNum">    1832 </span>            :   
<span class="lineNum">    1833 </span>            :   
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :   Double_t xbis = sintheta*z + costheta*(cosphi*x - sinphi*y);</span>
<span class="lineNum">    1835 </span>            :   
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :   AliInfo(Form(&quot;Calculated rot %f, modulus %f&quot;,xbis,TMath::Sqrt(x*x+y*y+z*z)));</span>
<span class="lineNum">    1837 </span>            :   return xbis;
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 : }</span>
<a name="1839"><span class="lineNum">    1839 </span>            : /***********************************************************/</a>
<span class="lineNum">    1840 </span>            : 
<span class="lineNum">    1841 </span>            : AliStack* AliGenHBTosl::RotateStack()
<span class="lineNum">    1842 </span>            : { 
<span class="lineNum">    1843 </span>            : //swaps to next stack last goes to first and is reseted
<span class="lineNum">    1844 </span>            : 
<span class="lineNum">    1845 </span>            :  AliStack* stack;
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :  if ( fStackBuffer-&gt;GetSize() &gt;= fBufferSize )</span>
<span class="lineNum">    1847 </span>            :   {
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :     stack = (AliStack*)fStackBuffer-&gt;Remove(fStackBuffer-&gt;Last());</span>
<span class="lineNum">    1849 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1850 </span>            :  else
<span class="lineNum">    1851 </span>            :   {
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :     stack = new AliStack(fNpart);</span>
<span class="lineNum">    1853 </span>            :   }
<span class="lineNum">    1854 </span>            :      
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :  fStackBuffer-&gt;AddFirst(stack);</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :  stack-&gt;Reset();</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :  return stack;</span>
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 : }</span>
<a name="1859"><span class="lineNum">    1859 </span>            : /***********************************************************/</a>
<span class="lineNum">    1860 </span>            : 
<span class="lineNum">    1861 </span>            : Double_t AliGenHBTosl::GetQInvCorrTheorValue(Double_t qinv) const
<span class="lineNum">    1862 </span>            : {
<span class="lineNum">    1863 </span>            : //Function (deprecated)
<span class="lineNum">    1864 </span>            :  static const Double_t kFactorsqrd = 0.197*0.197;//squared conversion factor SI&lt;-&gt;eV
<span class="lineNum">    1865 </span>            :  
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :  return 1.0 + 0.5*TMath::Exp(-qinv*qinv*fQRadius*fQRadius/kFactorsqrd);</span>
<span class="lineNum">    1867 </span>            : }
<a name="1868"><span class="lineNum">    1868 </span>            : /***********************************************************/</a>
<span class="lineNum">    1869 </span>            : 
<span class="lineNum">    1870 </span>            : Double_t AliGenHBTosl::GetQOutQSideQLongCorrTheorValue(Double_t&amp; out, Double_t&amp; side, Double_t&amp; lon) const
<span class="lineNum">    1871 </span>            : {
<span class="lineNum">    1872 </span>            :  //Theoretical function. Wa want to get correlation of the shape of this function
<span class="lineNum">    1873 </span>            :  static const Double_t kFactorsqrd = 0.197*0.197;//squared conversion factor SI&lt;-&gt;eV
<span class="lineNum">    1874 </span><span class="lineNoCov">          0 :  return 1.0 + 0.7*TMath::Exp(-fQRadius*fQRadius*(out*out+side*side+lon*lon)/kFactorsqrd);</span>
<span class="lineNum">    1875 </span>            : }
<a name="1876"><span class="lineNum">    1876 </span>            : /***********************************************************/</a>
<span class="lineNum">    1877 </span>            : 
<span class="lineNum">    1878 </span>            : Bool_t AliGenHBTosl::CheckParticle(TParticle* p, TParticle* aupair ,AliStack* stack)
<span class="lineNum">    1879 </span>            : {
<span class="lineNum">    1880 </span>            :  //Checks if a given particle is falling into signal region with any other particle
<span class="lineNum">    1881 </span>            :  //already existing on stack
<span class="lineNum">    1882 </span>            :   //PH return kFALSE;
<span class="lineNum">    1883 </span>            :   
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :  if (fSignalRegion &lt;=0) return kFALSE;</span>
<span class="lineNum">    1885 </span>            :  
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :  for (Int_t i = 0; i &lt; stack-&gt;GetNtrack(); i++)</span>
<span class="lineNum">    1887 </span>            :   {
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :     TParticle* part = stack-&gt;Particle(i);</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :     if (part == aupair) continue;</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :     Double_t qout = 10e5;</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :     Double_t qside= 10e5;</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :     Double_t qlong= 10e5;</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :     GetQOutQSideQLong(p,part,qout,qside,qlong);</span>
<span class="lineNum">    1894 </span>            :     
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :     if (TMath::Abs(qout)  &lt; fSignalRegion)</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :       if (TMath::Abs(qside) &lt; fSignalRegion)</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :        if (TMath::Abs(qlong) &lt; fSignalRegion) </span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :          return kTRUE;</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :   return kFALSE; </span>
<span class="lineNum">    1901 </span><span class="lineNoCov">          0 : }</span>
<a name="1902"><span class="lineNum">    1902 </span>            : /***********************************************************/</a>
<span class="lineNum">    1903 </span>            : 
<span class="lineNum">    1904 </span>            : void AliGenHBTosl::SwapGeneratingHistograms()
<span class="lineNum">    1905 </span>            : {
<span class="lineNum">    1906 </span>            :   //Checks if it is time to swap signal and background histograms
<span class="lineNum">    1907 </span>            :   //if yes it swaps them
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :   Int_t threshold = fMinFill;</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :   for (Int_t k = 1; k&lt;=fQNBins; k++)</span>
<span class="lineNum">    1910 </span>            :    {
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :      for (Int_t j = 1; j&lt;=fQNBins; j++)</span>
<span class="lineNum">    1912 </span>            :        {  
<span class="lineNum">    1913 </span><span class="lineNoCov">          0 :          for (Int_t i = 1; i&lt;=fQNBins; i++)</span>
<span class="lineNum">    1914 </span>            :            {
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 :              if ( fQSecondBackground-&gt;GetBinContent(i,j,k) &lt; threshold) return;</span>
<span class="lineNum">    1916 </span>            :            }
<span class="lineNum">    1917 </span>            :        }
<span class="lineNum">    1918 </span>            :             
<span class="lineNum">    1919 </span>            :    }
<span class="lineNum">    1920 </span>            :   
<span class="lineNum">    1921 </span>            :   
<span class="lineNum">    1922 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1925 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;****   SWAPPING HISTOGRAMS             ****&quot;);</span>
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 :   Info(&quot;SwapGeneratingHistograms&quot;,&quot;*******************************************&quot;);</span>
<span class="lineNum">    1929 </span>            :   
<span class="lineNum">    1930 </span>            :   
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :   TH3D* h = fQSignal;</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :   fQSignal = fQSecondSignal;</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :   fQSecondSignal = h;</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :   fQSecondSignal-&gt;Reset();</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :   fQSecondSignal-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1936 </span>            :   
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :   h = fQBackground;</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :   fQBackground = fQSecondBackground;</span>
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 :   fQSecondBackground = h;</span>
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :   fQSecondBackground-&gt;Reset();</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :   fQSecondBackground-&gt;SetDirectory(0x0);</span>
<span class="lineNum">    1942 </span>            :   
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :   fSwapped = kTRUE;</span>
<span class="lineNum">    1944 </span>            :   
<a name="1945"><span class="lineNum">    1945 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1946 </span>            : 
<span class="lineNum">    1947 </span>            : AliGenHBTosl&amp; AliGenHBTosl::operator=(const  AliGenHBTosl&amp; rhs)
<span class="lineNum">    1948 </span>            : {
<span class="lineNum">    1949 </span>            : // Assignment operator
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :     rhs.Copy(*this);</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :     return *this;</span>
<a name="1952"><span class="lineNum">    1952 </span>            : }</a>
<span class="lineNum">    1953 </span>            : 
<span class="lineNum">    1954 </span>            : void AliGenHBTosl::Copy(TObject&amp;) const
<span class="lineNum">    1955 </span>            : {
<span class="lineNum">    1956 </span>            :     //
<span class="lineNum">    1957 </span>            :     // Copy 
<span class="lineNum">    1958 </span>            :     //
<span class="lineNum">    1959 </span><span class="lineNoCov">          0 :     Fatal(&quot;Copy&quot;,&quot;Not implemented!\n&quot;);</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1961 </span>            : 
<span class="lineNum">    1962 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
