<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - ITS/ITSbase/AliITSClusterParam.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">ITS/ITSbase</a> - AliITSClusterParam.cxx<span style="font-size: 80%;"> (source / <a href="AliITSClusterParam.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">70</td>
            <td class="headerCovTableEntry">232</td>
            <td class="headerCovTableEntryLo">30.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntryLo">44.4 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-2007, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      19 </span>            : //                                                                           //
<span class="lineNum">      20 </span>            : //  ITS cluster error and shape parameterization                             //
<span class="lineNum">      21 </span>            : //                                                                           //
<span class="lineNum">      22 </span>            : //  andrea.dainese@lnl.infn.it                                               //
<span class="lineNum">      23 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      24 </span>            : //#include &quot;TFile.h&quot;
<span class="lineNum">      25 </span>            : //#include &quot;TTree.h&quot;
<span class="lineNum">      26 </span>            : //#include &lt;TVectorF.h&gt;
<span class="lineNum">      27 </span>            : //#include &lt;TLinearFitter.h&gt;
<span class="lineNum">      28 </span>            : //#include &lt;TH1F.h&gt;
<span class="lineNum">      29 </span>            : //#include &lt;TProfile2D.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;TVector3.h&gt;
<span class="lineNum">      31 </span>            : #include &quot;TMath.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;AliTracker.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;AliGeomManager.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;AliITSRecPoint.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;AliITSClusterParam.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;AliITSReconstructor.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;AliExternalTrackParam.h&quot;
<a name="38"><span class="lineNum">      38 </span>            : #include &quot;AliCheb3DCalc.h&quot;</a>
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span><span class="lineCov">        118 : ClassImp(AliITSClusterParam)</span>
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span>            : AliITSClusterParam* AliITSClusterParam::fgInstance = 0;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : /*
<span class="lineNum">      47 </span>            :   Example usage fitting parameterization (NOT YET...):
<span class="lineNum">      48 </span>            :   TFile fres(&quot;resol.root&quot;);    //tree with resolution and shape 
<span class="lineNum">      49 </span>            :   TTree * treeRes =(TTree*)fres.Get(&quot;Resol&quot;);
<span class="lineNum">      50 </span>            :   
<span class="lineNum">      51 </span>            :   AliITSClusterParam param;
<span class="lineNum">      52 </span>            :   param.SetInstance(&amp;param);
<span class="lineNum">      53 </span>            :   param.FitResol(treeRes);
<span class="lineNum">      54 </span>            :   param.FitRMS(treeRes);
<span class="lineNum">      55 </span>            :   TFile fparam(&quot;ITSClusterParam.root&quot;,&quot;recreate&quot;);
<span class="lineNum">      56 </span>            :   param.Write(&quot;Param&quot;);
<span class="lineNum">      57 </span>            :   //
<span class="lineNum">      58 </span>            :   //
<span class="lineNum">      59 </span>            :   TFile fparam(&quot;ITSClusterParam.root&quot;);
<span class="lineNum">      60 </span>            :   AliITSClusterParam *param2  =  (AliITSClusterParam *) fparam.Get(&quot;Param&quot;); 
<span class="lineNum">      61 </span>            :   param2-&gt;SetInstance(param2);
<span class="lineNum">      62 </span>            :   param2-&gt;Test(treeRes);
<span class="lineNum">      63 </span>            :   
<span class="lineNum">      64 </span>            : 
<span class="lineNum">      65 </span>            :   treeRes-&gt;Draw(&quot;(Resol-AliITSClusterParam::SGetError0(Dim,Pad,Zm,AngleM))/Resol&quot;,&quot;Dim==0&amp;&amp;QMean&lt;0&quot;)
<span class="lineNum">      66 </span>            : */
<a name="67"><span class="lineNum">      67 </span>            : </a>
<span class="lineNum">      68 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      69 </span>            : AliITSClusterParam* AliITSClusterParam::Instance()
<span class="lineNum">      70 </span>            : {
<span class="lineNum">      71 </span>            :   //
<span class="lineNum">      72 </span>            :   // Singleton implementation
<span class="lineNum">      73 </span>            :   // Returns an instance of this class, it is created if neccessary
<span class="lineNum">      74 </span>            :   //
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   if (fgInstance == 0){</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :     fgInstance = new AliITSClusterParam();</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :   return fgInstance;</span>
<a name="79"><span class="lineNum">      79 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      80 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      81 </span>            : void AliITSClusterParam::GetNTeor(Int_t layer,const AliITSRecPoint* /*cl*/, 
<span class="lineNum">      82 </span>            :                                   Float_t tgl,Float_t tgphitr,
<span class="lineNum">      83 </span>            :                                   Float_t &amp;ny,Float_t &amp;nz)
<span class="lineNum">      84 </span>            : {
<span class="lineNum">      85 </span>            :   //
<span class="lineNum">      86 </span>            :   // Get &quot;mean shape&quot; (original parametrization from AliITStrackerMI)
<span class="lineNum">      87 </span>            :   //
<span class="lineNum">      88 </span><span class="lineCov">      23936 :   tgl = TMath::Abs(tgl);</span>
<span class="lineNum">      89 </span><span class="lineCov">      11968 :   tgphitr = TMath::Abs(tgphitr);</span>
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span>            :   // SPD
<span class="lineNum">      92 </span><span class="lineCov">      11968 :   if (layer==0) {</span>
<span class="lineNum">      93 </span><span class="lineCov">       1554 :     ny = 1.+tgphitr*3.2;</span>
<span class="lineNum">      94 </span><span class="lineCov">       1554 :     nz = 1.+tgl*0.34;</span>
<span class="lineNum">      95 </span><span class="lineCov">       1554 :     return;</span>
<span class="lineNum">      96 </span>            :   }
<span class="lineNum">      97 </span><span class="lineCov">      10414 :   if (layer==1) {</span>
<span class="lineNum">      98 </span><span class="lineCov">       1290 :     ny = 1.+tgphitr*3.2;</span>
<span class="lineNum">      99 </span><span class="lineCov">       1290 :     nz = 1.+tgl*0.28;</span>
<span class="lineNum">     100 </span><span class="lineCov">       1290 :     return;</span>
<span class="lineNum">     101 </span>            :   }
<span class="lineNum">     102 </span>            :   // SSD
<span class="lineNum">     103 </span><span class="lineCov">      18248 :   if (layer==4 || layer==5) {</span>
<span class="lineNum">     104 </span><span class="lineCov">      13490 :     ny = 2.02+tgphitr*1.95;</span>
<span class="lineNum">     105 </span><span class="lineCov">       4366 :     nz = 2.02+tgphitr*2.35;</span>
<span class="lineNum">     106 </span><span class="lineCov">       4366 :     return;</span>
<span class="lineNum">     107 </span>            :   }
<span class="lineNum">     108 </span>            :   // SDD
<span class="lineNum">     109 </span><span class="lineCov">       4758 :   ny  = 6.6-2.7*tgphitr;</span>
<span class="lineNum">     110 </span><span class="lineCov">       4758 :   nz  = 2.8-3.11*tgphitr+0.45*tgl;</span>
<span class="lineNum">     111 </span><span class="lineCov">       4758 :   return;</span>
<a name="112"><span class="lineNum">     112 </span><span class="lineCov">      11968 : }</span></a>
<span class="lineNum">     113 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     114 </span>            : Int_t AliITSClusterParam::GetError(Int_t layer,
<span class="lineNum">     115 </span>            :                                    const AliITSRecPoint *cl,
<span class="lineNum">     116 </span>            :                                    Float_t tgl,Float_t tgphitr,Float_t expQ,
<span class="lineNum">     117 </span>            :                                    Float_t &amp;erry,Float_t &amp;errz,Float_t &amp;covyz,
<span class="lineNum">     118 </span>            :                                    Bool_t addMisalErr)
<span class="lineNum">     119 </span>            : {
<span class="lineNum">     120 </span>            :   //
<span class="lineNum">     121 </span>            :   // Calculate cluster position error
<span class="lineNum">     122 </span>            :   //
<span class="lineNum">     123 </span><span class="lineCov">      11974 :   static Double_t bz = (Double_t)AliTracker::GetBz();</span>
<span class="lineNum">     124 </span>            :   Int_t retval=0;
<span class="lineNum">     125 </span><span class="lineCov">      11968 :   covyz=0.;</span>
<span class="lineNum">     126 </span><span class="lineCov">      11968 :   switch(AliITSReconstructor::GetRecoParam()-&gt;GetClusterErrorsParam()) {</span>
<span class="lineNum">     127 </span>            :   case 0: 
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :     retval = GetErrorOrigRecPoint(cl,erry,errz,covyz);</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     130 </span>            :   case 1: 
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :     retval = GetErrorParamMI(layer,cl,tgl,tgphitr,expQ,erry,errz);</span>
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     133 </span>            :   case 2: 
<span class="lineNum">     134 </span><span class="lineCov">      11968 :     retval = GetErrorParamAngle(layer,cl,tgl,tgphitr,erry,errz);</span>
<span class="lineNum">     135 </span><span class="lineCov">      11968 :     break;</span>
<span class="lineNum">     136 </span>            :   case 3: 
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     retval = GetErrorParamAngleOld(layer,cl,tgl,tgphitr,erry,errz);</span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     139 </span>            :   default: 
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :     retval = GetErrorParamMI(layer,cl,tgl,tgphitr,expQ,erry,errz);</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     142 </span>            :   }
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span>            :   // for SSD use the error provided by the cluster finder 
<span class="lineNum">     145 </span>            :   // if single-sided clusters are enabled
<span class="lineNum">     146 </span><span class="lineCov">      16334 :   if(layer&gt;=4 &amp;&amp; AliITSReconstructor::GetRecoParam()-&gt;GetUseBadChannelsInClusterFinderSSD()) { </span>
<span class="lineNum">     147 </span>            :     //printf(&quot;error 1 erry errz covyz %10.7f %10.7f %15.13f\n&quot;,erry,errz,covyz);
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     retval = GetErrorOrigRecPoint(cl,erry,errz,covyz);</span>
<span class="lineNum">     149 </span>            :     //printf(&quot;type %d erry errz covyz %10.7f %10.7f %15.13f\n&quot;,cl-&gt;GetType(),erry,errz,covyz);
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     151 </span>            :   
<span class="lineNum">     152 </span><span class="lineCov">      11968 :   if(addMisalErr) {</span>
<span class="lineNum">     153 </span>            :     // add error due to misalignment (to be improved)
<span class="lineNum">     154 </span><span class="lineCov">      11968 :     Float_t errmisalY2 = AliITSReconstructor::GetRecoParam()-&gt;GetClusterMisalErrorY(layer,bz)</span>
<span class="lineNum">     155 </span><span class="lineCov">      11968 :       *AliITSReconstructor::GetRecoParam()-&gt;GetClusterMisalErrorY(layer,bz);</span>
<span class="lineNum">     156 </span><span class="lineCov">      11968 :     Float_t errmisalZ2 = AliITSReconstructor::GetRecoParam()-&gt;GetClusterMisalErrorZ(layer,bz)</span>
<span class="lineNum">     157 </span><span class="lineCov">      11968 :       *AliITSReconstructor::GetRecoParam()-&gt;GetClusterMisalErrorZ(layer,bz);</span>
<span class="lineNum">     158 </span><span class="lineCov">      11968 :     erry = TMath::Sqrt(erry*erry+errmisalY2);</span>
<span class="lineNum">     159 </span><span class="lineCov">      11968 :     errz = TMath::Sqrt(errz*errz+errmisalZ2);</span>
<span class="lineNum">     160 </span><span class="lineCov">      11968 :   }</span>
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span><span class="lineCov">      11968 :   return retval;</span>
<span class="lineNum">     163 </span>            : 
<a name="164"><span class="lineNum">     164 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     165 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     166 </span>            : Int_t AliITSClusterParam::GetErrorOrigRecPoint(const AliITSRecPoint*cl,
<span class="lineNum">     167 </span>            :                                    Float_t &amp;erry,Float_t &amp;errz,Float_t &amp;covyz)
<span class="lineNum">     168 </span>            : {
<span class="lineNum">     169 </span>            :   //
<span class="lineNum">     170 </span>            :   // Calculate cluster position error (just take error from AliITSRecPoint)
<span class="lineNum">     171 </span>            :   //
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :   erry   = TMath::Sqrt(cl-&gt;GetSigmaY2()); </span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   errz   = TMath::Sqrt(cl-&gt;GetSigmaZ2()); </span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :   covyz  = cl-&gt;GetSigmaYZ();</span>
<span class="lineNum">     175 </span>            : 
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :   return 1;</span>
<a name="177"><span class="lineNum">     177 </span>            : }</a>
<span class="lineNum">     178 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     179 </span>            : Int_t AliITSClusterParam::GetErrorParamMI(Int_t layer,const AliITSRecPoint*cl,
<span class="lineNum">     180 </span>            :                                           Float_t tgl,Float_t tgphitr,
<span class="lineNum">     181 </span>            :                                           Float_t expQ,
<span class="lineNum">     182 </span>            :                                           Float_t &amp;erry,Float_t &amp;errz)
<span class="lineNum">     183 </span>            : {
<span class="lineNum">     184 </span>            :   //
<span class="lineNum">     185 </span>            :   // Calculate cluster position error (original parametrization from 
<span class="lineNum">     186 </span>            :   // AliITStrackerMI)
<span class="lineNum">     187 </span>            :   //
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :   Float_t nz,ny;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :   GetNTeor(layer, cl,tgl,tgphitr,ny,nz);  </span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   erry   = TMath::Sqrt(cl-&gt;GetSigmaY2()); </span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   errz   = TMath::Sqrt(cl-&gt;GetSigmaZ2()); </span>
<span class="lineNum">     192 </span>            :   //
<span class="lineNum">     193 </span>            :   // PIXELS
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :   if (layer&lt;2){</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :     if (TMath::Abs(ny-cl-&gt;GetNy())&gt;0.6)  {</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :       if (ny&lt;cl-&gt;GetNy()){</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :         erry*=0.4+TMath::Abs(ny-cl-&gt;GetNy());</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :         errz*=0.4+TMath::Abs(ny-cl-&gt;GetNy());</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :       }else{</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :         erry*=0.7+0.5*TMath::Abs(ny-cl-&gt;GetNy());</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :         errz*=0.7+0.5*TMath::Abs(ny-cl-&gt;GetNy());</span>
<span class="lineNum">     202 </span>            :       }
<span class="lineNum">     203 </span>            :     }
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :     if (TMath::Abs(nz-cl-&gt;GetNz())&gt;1.)  {</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :       erry*=TMath::Abs(nz-cl-&gt;GetNz());</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :       errz*=TMath::Abs(nz-cl-&gt;GetNz());            </span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :     erry*=0.85;</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :     errz*=0.85;</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :     erry= TMath::Min(erry,float(0.0050));</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :     errz= TMath::Min(errz,float(0.0300));</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :     return 10;</span>
<span class="lineNum">     213 </span>            :   }
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span>            :   //STRIPS
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :   if (layer&gt;3){ </span>
<span class="lineNum">     217 </span>            :     //factor 1.8 appears in new simulation
<span class="lineNum">     218 </span>            :     //
<span class="lineNum">     219 </span>            :     Float_t scale=1.8;
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetNy()==100||cl-&gt;GetNz()==100){</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :       erry = 0.004*scale;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :       errz = 0.2*scale;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :       return 100;</span>
<span class="lineNum">     224 </span>            :     }
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetNy()+cl-&gt;GetNz()&gt;12){</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :       erry = 0.06*scale;</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :       errz = 0.57*scale;</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :       return 100;</span>
<span class="lineNum">     229 </span>            :     }
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :     Float_t normq = cl-&gt;GetQ()/(TMath::Sqrt(1+tgl*tgl+tgphitr*tgphitr));</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :     Float_t chargematch = TMath::Max(double(normq/expQ),2.);</span>
<span class="lineNum">     232 </span>            :     //
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetType()==1 || cl-&gt;GetType()==10 ){                                                                 </span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :       if (chargematch&lt;1.0 || (cl-&gt;GetNy()+cl-&gt;GetNz()&lt;nz+ny+0.5)){</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :         errz = 0.043*scale;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         erry = 0.00094*scale;</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :         return 101;</span>
<span class="lineNum">     238 </span>            :       }
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :       if (cl-&gt;GetNy()+cl-&gt;GetNz()&lt;nz+ny+1.2){</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :         errz = 0.06*scale;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :         erry =0.0013*scale;</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :         return 102;</span>
<span class="lineNum">     243 </span>            :       }
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :       erry = 0.0027*scale;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :       errz = TMath::Min(0.028*(chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz+ny),0.15)*scale;</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :       return 103;</span>
<span class="lineNum">     247 </span>            :     }
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetType()==2 || cl-&gt;GetType()==11 ){ </span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :       erry = TMath::Min(0.0010*(1+chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz+ny),0.05)*scale;</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       errz = TMath::Min(0.025*(1+chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz+ny),0.5)*scale;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :       return 104;</span>
<span class="lineNum">     252 </span>            :     }
<span class="lineNum">     253 </span>            :     
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetType()&gt;100 ){                                                             </span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :       if ((chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz-ny&lt;1.5)){</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :         errz = 0.05*scale;</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :         erry = 0.00096*scale;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         return 105;</span>
<span class="lineNum">     259 </span>            :       }
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :       if (cl-&gt;GetNy()+cl-&gt;GetNz()-nz-ny&lt;1){</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         errz = 0.10*scale;</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :         erry = 0.0025*scale;</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :         return 106;</span>
<span class="lineNum">     264 </span>            :       }
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :       errz = TMath::Min(0.05*(chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz-ny),0.4)*scale;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :       erry = TMath::Min(0.003*(chargematch+cl-&gt;GetNy()+cl-&gt;GetNz()-nz-ny),0.05)*scale;</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :       return 107;</span>
<span class="lineNum">     269 </span>            :     }    
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :     Float_t diff = cl-&gt;GetNy()+cl-&gt;GetNz()-ny-nz;</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :     if (diff&lt;1) diff=1;</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :     if (diff&gt;4) diff=4;</span>
<span class="lineNum">     273 </span>            :         
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :     if (cl-&gt;GetType()==5||cl-&gt;GetType()==6||cl-&gt;GetType()==7||cl-&gt;GetType()==8){</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :       errz = 0.14*diff;</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :       erry = 0.003*diff;</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :       return 108;</span>
<span class="lineNum">     278 </span>            :     }  
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     erry = 0.04*diff;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :     errz = 0.06*diff;</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :     return 109;</span>
<span class="lineNum">     282 </span>            :   }
<span class="lineNum">     283 </span>            :   //DRIFTS
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   Float_t normq = cl-&gt;GetQ()/(TMath::Sqrt(1+tgl*tgl+tgphitr*tgphitr));</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   Float_t chargematch = normq/expQ;</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :   chargematch/=2.4; // F. Prino Sept. 2007: SDD charge conversion keV-&gt;ADC</span>
<span class="lineNum">     287 </span>            :   Float_t factorz=1;
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   Int_t   cnz = cl-&gt;GetNz()%10;</span>
<span class="lineNum">     289 </span>            :   //charge match
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :   if (cl-&gt;GetType()==1){</span>
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     if (chargematch&lt;1.25){</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :       erry =  0.0028*(1.+6./cl-&gt;GetQ());  // gold clusters</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     294 </span>            :     else{
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :       erry = 0.003*chargematch;</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :       if (cl-&gt;GetNz()==3) erry*=1.5;</span>
<span class="lineNum">     297 </span>            :     }
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :     if (chargematch&lt;1.0){</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :       errz =  0.0011*(1.+6./cl-&gt;GetQ());</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     301 </span>            :     else{
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :       errz = 0.002*(1+2*(chargematch-1.));</span>
<span class="lineNum">     303 </span>            :     }
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :     if (cnz&gt;nz+0.6) {</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :       erry*=(cnz-nz+0.5);</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :       errz*=1.4*(cnz-nz+0.5);</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     308 </span>            :   }
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :   if (cl-&gt;GetType()&gt;1){</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :     if (chargematch&lt;1){</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       erry =  0.00385*(1.+6./cl-&gt;GetQ());  // gold clusters</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       errz =  0.0016*(1.+6./cl-&gt;GetQ());</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     314 </span>            :     else{
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :       errz = 0.0014*(1+3*(chargematch-1.));</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :       erry = 0.003*(1+3*(chargematch-1.));</span>
<span class="lineNum">     317 </span>            :     } 
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :     if (cnz&gt;nz+0.6) {</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :       erry*=(cnz-nz+0.5);</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :       errz*=1.4*(cnz-nz+0.5);</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     322 </span>            :   }
<span class="lineNum">     323 </span>            : 
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :   if (TMath::Abs(cl-&gt;GetY())&gt;2.5){</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :     factorz*=1+2*(TMath::Abs(cl-&gt;GetY())-2.5);</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   if (TMath::Abs(cl-&gt;GetY())&lt;1){</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :     factorz*=1.+0.5*TMath::Abs(TMath::Abs(cl-&gt;GetY())-1.);</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   factorz= TMath::Min(factorz,float(4.));  </span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :   errz*=factorz;</span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   erry= TMath::Min(erry,float(0.05));</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   errz= TMath::Min(errz,float(0.05));  </span>
<span class="lineNum">     335 </span>            :   return 200;
<a name="336"><span class="lineNum">     336 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     337 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     338 </span>            : Int_t AliITSClusterParam::GetErrorParamAngle(Int_t layer,
<span class="lineNum">     339 </span>            :                                              const AliITSRecPoint *cl,
<span class="lineNum">     340 </span>            :                                              Float_t tgl,Float_t tgphitr,
<span class="lineNum">     341 </span>            :                                              Float_t &amp;erry,Float_t &amp;errz)
<span class="lineNum">     342 </span>            : {
<span class="lineNum">     343 </span>            :   //
<span class="lineNum">     344 </span>            :   // Calculate cluster position error (parametrization extracted from rp-hit
<span class="lineNum">     345 </span>            :   // residuals, as a function of angle between track and det module plane.
<span class="lineNum">     346 </span>            :   // Origin: M.Lunardon, S.Moretto)
<span class="lineNum">     347 </span>            :   //
<span class="lineNum">     348 </span>            :   const int   kNcfSPDResX = 21;
<span class="lineNum">     349 </span>            :   const float kCfSPDResX[kNcfSPDResX] = {+1.1201e+01,+2.0903e+00,-2.2909e-01,-2.6413e-01,+4.2135e-01,-3.7190e-01,
<span class="lineNum">     350 </span>            :                                          +4.2339e-01,+1.8679e-01,-5.1249e-01,+1.8421e-01,+4.8849e-02,-4.3127e-01,
<span class="lineNum">     351 </span>            :                                          -1.1148e-01,+3.1984e-03,-2.5743e-01,-6.6408e-02,+3.0756e-01,+2.6809e-01,
<span class="lineNum">     352 </span>            :                                          -5.0339e-03,-1.4964e-01,-1.1001e-01};
<span class="lineNum">     353 </span>            :   const float kSPDazMax=56.000000;
<span class="lineNum">     354 </span>            :   //
<span class="lineNum">     355 </span>            :   const int   kNcfSPDMeanX = 16;
<span class="lineNum">     356 </span>            :   const float kCfSPDMeanX[kNcfSPDMeanX] = {-1.2532e+00,-3.8185e-01,-8.9039e-01,+2.6648e+00,+7.0361e-01,+1.2298e+00,
<span class="lineNum">     357 </span>            :                                            +3.2871e-01,+7.8487e-02,-1.6792e-01,-1.3966e-01,-3.1670e-01,-2.1795e-01,
<span class="lineNum">     358 </span>            :                                            -1.9451e-01,-4.9347e-02,-1.9186e-01,-1.9195e-01};
<span class="lineNum">     359 </span>            :   //
<span class="lineNum">     360 </span>            :   const int   kNcfSPDResZ = 5;
<span class="lineNum">     361 </span>            :   const float kCfSPDResZ[kNcfSPDResZ] = {+9.2384e+01,+3.4352e-01,-2.7317e+01,-1.4642e-01,+2.0868e+00};
<span class="lineNum">     362 </span>            :   const float kSPDpolMin=34.358002, kSPDpolMax=145.000000;
<span class="lineNum">     363 </span>            :   //
<span class="lineNum">     364 </span>            :   const Double_t kMaxSigmaSDDx=100.;
<span class="lineNum">     365 </span>            :   const Double_t kMaxSigmaSDDz=400.;
<span class="lineNum">     366 </span>            :   const Double_t kMaxSigmaSSDx=100.;
<span class="lineNum">     367 </span>            :   const Double_t kMaxSigmaSSDz=1000.;
<span class="lineNum">     368 </span>            :   //  
<span class="lineNum">     369 </span>            :   const Double_t kParamSDDx[2]={30.93,0.059};
<span class="lineNum">     370 </span>            :   const Double_t kParamSDDz[2]={33.09,0.011};
<span class="lineNum">     371 </span>            :   const Double_t kParamSSDx[2]={18.64,-0.0046};
<span class="lineNum">     372 </span>            :   const Double_t kParamSSDz[2]={784.4,-0.828};
<span class="lineNum">     373 </span>            :   Double_t sigmax=1000.0,sigmaz=1000.0;
<span class="lineNum">     374 </span>            :   Double_t biasx = 0.0;
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span><span class="lineCov">      23936 :   Int_t volId = (Int_t)cl-&gt;GetVolumeId();</span>
<span class="lineNum">     377 </span><span class="lineCov">      11968 :   Double_t rotMA[9]; AliGeomManager::GetRotation(volId,rotMA);      // misaligned rotation</span>
<span class="lineNum">     378 </span><span class="lineCov">      11968 :   Double_t rotOR[9]; AliGeomManager::GetOrigRotation(volId,rotOR);  // original rotation</span>
<span class="lineNum">     379 </span>            :   // difference in phi of original and misaligned sensors
<span class="lineNum">     380 </span><span class="lineCov">      11968 :   double cross = rotOR[1]*rotMA[4]-rotOR[4]*rotMA[1];</span>
<span class="lineNum">     381 </span><span class="lineCov">      11968 :   cross /= TMath::Sqrt( (1.-rotOR[7]*rotOR[7]) * (1.-rotMA[7]*rotMA[7]) );</span>
<span class="lineNum">     382 </span><span class="lineCov">      11968 :   Double_t angleAzi = TMath::Abs(TMath::ATan(tgphitr) - TMath::ASin(cross) );</span>
<span class="lineNum">     383 </span><span class="lineCov">      11968 :   Double_t anglePol = TMath::Abs(TMath::ATan(tgl));</span>
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span><span class="lineCov">      11968 :   if(angleAzi&gt;0.5*TMath::Pi()) angleAzi = TMath::Pi()-angleAzi;</span>
<span class="lineNum">     386 </span><span class="lineCov">      11968 :   if(anglePol&gt;0.5*TMath::Pi()) anglePol = TMath::Pi()-anglePol;</span>
<span class="lineNum">     387 </span><span class="lineCov">      11968 :   Double_t angleAziDeg = angleAzi*180./TMath::Pi();</span>
<span class="lineNum">     388 </span><span class="lineCov">      11968 :   Double_t anglePolDeg = anglePol*180./TMath::Pi();</span>
<span class="lineNum">     389 </span>            :   
<span class="lineNum">     390 </span><span class="lineCov">      11968 :   if(layer==0 || layer==1) { // SPD</span>
<span class="lineNum">     391 </span>            :     //
<span class="lineNum">     392 </span><span class="lineCov">       2844 :     float phiInt    = angleAziDeg/kSPDazMax; // mapped to -1:1</span>
<span class="lineNum">     393 </span><span class="lineCov">       5688 :     if (phiInt&gt;1) phiInt = 1; else if (phiInt&lt;-1) phiInt = -1;</span>
<span class="lineNum">     394 </span><span class="lineCov">       2844 :     float phiAbsInt = (TMath::Abs(angleAziDeg+angleAziDeg) - kSPDazMax)/kSPDazMax; // mapped to -1:1</span>
<span class="lineNum">     395 </span><span class="lineCov">       5688 :     if (phiAbsInt&gt;1) phiAbsInt = 1; else if (phiAbsInt&lt;-1) phiAbsInt = -1;</span>
<span class="lineNum">     396 </span><span class="lineCov">       2844 :     anglePolDeg += 90; // the parameterization was provided in polar angle (90 deg - normal to sensor)</span>
<span class="lineNum">     397 </span><span class="lineCov">       2844 :     float polInt   = (anglePolDeg+anglePolDeg - (kSPDpolMax+kSPDpolMin))/(kSPDpolMax-kSPDpolMin); // mapped to -1:1</span>
<span class="lineNum">     398 </span><span class="lineCov">       5688 :     if (polInt&gt;1) polInt = 1; else if (polInt&lt;-1) polInt = -1;</span>
<span class="lineNum">     399 </span>            :     //
<span class="lineNum">     400 </span><span class="lineCov">       2844 :     sigmax = AliCheb3DCalc::ChebEval1D(phiAbsInt, kCfSPDResX , kNcfSPDResX);</span>
<span class="lineNum">     401 </span><span class="lineCov">       2844 :     biasx  = AliCheb3DCalc::ChebEval1D(phiInt   , kCfSPDMeanX, kNcfSPDMeanX);</span>
<span class="lineNum">     402 </span><span class="lineCov">       2844 :     sigmaz = AliCheb3DCalc::ChebEval1D(polInt   , kCfSPDResZ , kNcfSPDResZ);</span>
<span class="lineNum">     403 </span>            :     //
<span class="lineNum">     404 </span>            :     // for the moment for the SPD only, need to decide where to put it
<span class="lineNum">     405 </span>            :     biasx *= 1e-4;
<span class="lineNum">     406 </span>            :     
<span class="lineNum">     407 </span><span class="lineCov">      11968 :   } else if(layer==2 || layer==3) { // SDD</span>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span><span class="lineCov">       4758 :     sigmax = angleAziDeg*kParamSDDx[1]+kParamSDDx[0];</span>
<span class="lineNum">     410 </span><span class="lineCov">       4758 :     sigmaz = kParamSDDz[0]+kParamSDDz[1]*anglePolDeg;</span>
<span class="lineNum">     411 </span><span class="lineCov">       4758 :     if(sigmax &gt; kMaxSigmaSDDx) sigmax = kMaxSigmaSDDx;</span>
<span class="lineNum">     412 </span><span class="lineCov">       4758 :     if(sigmaz &gt; kMaxSigmaSDDz) sigmax = kMaxSigmaSDDz;</span>
<span class="lineNum">     413 </span>            :     
<span class="lineNum">     414 </span><span class="lineCov">       4366 :   } else if(layer==4 || layer==5) { // SSD</span>
<span class="lineNum">     415 </span>            : 
<span class="lineNum">     416 </span><span class="lineCov">       4366 :     sigmax = angleAziDeg*kParamSSDx[1]+kParamSSDx[0];</span>
<span class="lineNum">     417 </span><span class="lineCov">       4366 :     sigmaz = kParamSSDz[0]+kParamSSDz[1]*anglePolDeg;</span>
<span class="lineNum">     418 </span><span class="lineCov">       4366 :     if(sigmax &gt; kMaxSigmaSSDx) sigmax = kMaxSigmaSSDx;</span>
<span class="lineNum">     419 </span><span class="lineCov">       4366 :     if(sigmaz &gt; kMaxSigmaSSDz) sigmax = kMaxSigmaSSDz;</span>
<span class="lineNum">     420 </span>            :     
<span class="lineNum">     421 </span>            :   }
<span class="lineNum">     422 </span>            : 
<span class="lineNum">     423 </span>            :   // convert from micron to cm
<span class="lineNum">     424 </span><span class="lineCov">      11968 :   erry = 1.e-4*sigmax; </span>
<span class="lineNum">     425 </span><span class="lineCov">      11968 :   errz = 1.e-4*sigmaz;</span>
<span class="lineNum">     426 </span>            :   
<span class="lineNum">     427 </span>            : 
<span class="lineNum">     428 </span><span class="lineCov">      11968 :   return 1;</span>
<a name="429"><span class="lineNum">     429 </span><span class="lineCov">      11968 : }</span></a>
<span class="lineNum">     430 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     431 </span>            : Int_t AliITSClusterParam::GetErrorParamAngleOld(Int_t layer,
<span class="lineNum">     432 </span>            :                                                 const AliITSRecPoint *cl,
<span class="lineNum">     433 </span>            :                                                 Float_t tgl,Float_t tgphitr,
<span class="lineNum">     434 </span>            :                                                 Float_t &amp;erry,Float_t &amp;errz)
<span class="lineNum">     435 </span>            : {
<span class="lineNum">     436 </span>            :   //
<span class="lineNum">     437 </span>            :   // Calculate cluster position error (parametrization extracted from rp-hit
<span class="lineNum">     438 </span>            :   // residuals, as a function of angle between track and det module plane.
<span class="lineNum">     439 </span>            :   // Origin: M.Lunardon, S.Moretto)
<span class="lineNum">     440 </span>            :   //
<span class="lineNum">     441 </span>            : 
<span class="lineNum">     442 </span>            :   Double_t maxSigmaSPDx=100.;
<span class="lineNum">     443 </span>            :   Double_t maxSigmaSPDz=400.;
<span class="lineNum">     444 </span>            :   Double_t maxSigmaSDDx=100.;
<span class="lineNum">     445 </span>            :   Double_t maxSigmaSDDz=400.;
<span class="lineNum">     446 </span>            :   Double_t maxSigmaSSDx=100.;
<span class="lineNum">     447 </span>            :   Double_t maxSigmaSSDz=1000.;
<span class="lineNum">     448 </span>            :   
<span class="lineNum">     449 </span>            :   Double_t paramSPDx[3]={-6.417,0.18,11.14};
<span class="lineNum">     450 </span>            :   Double_t paramSPDz[2]={118.,-0.155};
<span class="lineNum">     451 </span>            :   Double_t paramSDDx[2]={30.93,0.059};
<span class="lineNum">     452 </span>            :   Double_t paramSDDz[2]={33.09,0.011};
<span class="lineNum">     453 </span>            :   Double_t paramSSDx[2]={18.64,-0.0046};
<span class="lineNum">     454 </span>            :   Double_t paramSSDz[2]={784.4,-0.828};
<span class="lineNum">     455 </span>            :   Double_t sigmax=1000.0,sigmaz=1000.0;
<span class="lineNum">     456 </span>            :   
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :   Int_t volId = (Int_t)cl-&gt;GetVolumeId();</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :   Double_t rotMA[9]; AliGeomManager::GetRotation(volId,rotMA);      // misaligned rotation</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   Double_t rotOR[9]; AliGeomManager::GetOrigRotation(volId,rotOR);  // original rotation</span>
<span class="lineNum">     460 </span>            :   // difference in phi of original and misaligned sensors
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :   double cross = rotOR[1]*rotMA[4]-rotOR[4]*rotMA[1];</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :   cross /= TMath::Sqrt( (1.-rotOR[7]*rotOR[7]) * (1.-rotMA[7]*rotMA[7]) );</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :   Double_t angleAzi = TMath::Abs(TMath::ATan(tgphitr) - TMath::ASin(cross) );</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :   Double_t anglePol = TMath::Abs(TMath::ATan(tgl));</span>
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :   if(angleAzi&gt;0.5*TMath::Pi()) angleAzi = TMath::Pi()-angleAzi;</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :   if(anglePol&gt;0.5*TMath::Pi()) anglePol = TMath::Pi()-anglePol;</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :   Double_t angleAziDeg = angleAzi*180./TMath::Pi();</span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :   Double_t anglePolDeg = anglePol*180./TMath::Pi();</span>
<span class="lineNum">     470 </span>            :   
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :   if(layer==0 || layer==1) { // SPD</span>
<span class="lineNum">     472 </span>            : 
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :     sigmax = TMath::Exp(angleAziDeg*paramSPDx[1]+paramSPDx[0])+paramSPDx[2];</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :     sigmaz = paramSPDz[0]+paramSPDz[1]*anglePolDeg;</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :     if(sigmax &gt; maxSigmaSPDx) sigmax = maxSigmaSPDx;</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :     if(sigmaz &gt; maxSigmaSPDz) sigmax = maxSigmaSPDz;</span>
<span class="lineNum">     477 </span>            : 
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :   } else if(layer==2 || layer==3) { // SDD</span>
<span class="lineNum">     479 </span>            : 
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :     sigmax = angleAziDeg*paramSDDx[1]+paramSDDx[0];</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :     sigmaz = paramSDDz[0]+paramSDDz[1]*anglePolDeg;</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :     if(sigmax &gt; maxSigmaSDDx) sigmax = maxSigmaSDDx;</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :     if(sigmaz &gt; maxSigmaSDDz) sigmax = maxSigmaSDDz;</span>
<span class="lineNum">     484 </span>            :     
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :   } else if(layer==4 || layer==5) { // SSD</span>
<span class="lineNum">     486 </span>            : 
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :     sigmax = angleAziDeg*paramSSDx[1]+paramSSDx[0];</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :     sigmaz = paramSSDz[0]+paramSSDz[1]*anglePolDeg;</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :     if(sigmax &gt; maxSigmaSSDx) sigmax = maxSigmaSSDx;</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :     if(sigmaz &gt; maxSigmaSSDz) sigmax = maxSigmaSSDz;</span>
<span class="lineNum">     491 </span>            :     
<span class="lineNum">     492 </span>            :   }
<span class="lineNum">     493 </span>            : 
<span class="lineNum">     494 </span>            :   // convert from micron to cm
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :   erry = 1.e-4*sigmax; </span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :   errz = 1.e-4*sigmaz;</span>
<span class="lineNum">     497 </span>            :   
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :   return 1;</span>
<a name="499"><span class="lineNum">     499 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     500 </span>            : //--------------------------------------------------------------------------
<span class="lineNum">     501 </span>            : void AliITSClusterParam::Print(Option_t* /*option*/) const {
<span class="lineNum">     502 </span>            :   //
<span class="lineNum">     503 </span>            :   // Print param Information
<span class="lineNum">     504 </span>            :   //
<span class="lineNum">     505 </span>            : 
<span class="lineNum">     506 </span>            :   //
<span class="lineNum">     507 </span>            :   // Error parameterization
<span class="lineNum">     508 </span>            :   //
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :   printf(&quot;NOT YET...\n&quot;);</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :   return;</span>
<span class="lineNum">     511 </span>            : }
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span>            : 
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span>            : 
<span class="lineNum">     516 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
