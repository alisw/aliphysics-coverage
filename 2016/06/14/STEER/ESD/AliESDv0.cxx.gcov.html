<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - STEER/ESD/AliESDv0.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">STEER/ESD</a> - AliESDv0.cxx<span style="font-size: 80%;"> (source / <a href="AliESDv0.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">190</td>
            <td class="headerCovTableEntry">421</td>
            <td class="headerCovTableEntryLo">45.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">19</td>
            <td class="headerCovTableEntry">46</td>
            <td class="headerCovTableEntryLo">41.3 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      19 </span>            : //               Implementation of the ESD V0 vertex class
<span class="lineNum">      20 </span>            : //            This class is part of the Event Data Summary
<span class="lineNum">      21 </span>            : //            set of classes and contains information about
<span class="lineNum">      22 </span>            : //            V0 kind vertexes generated by a neutral particle
<span class="lineNum">      23 </span>            : //     Origin: Iouri Belikov, IReS, Strasbourg, Jouri.Belikov@cern.ch
<span class="lineNum">      24 </span>            : //     Modified by: Marian Ivanov,  CERN, Marian.Ivanov@cern.ch
<span class="lineNum">      25 </span>            : //            and  Boris Hippolyte,IPHC, hippolyt@in2p3.fr 
<span class="lineNum">      26 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      29 </span>            : #include &lt;TDatabasePDG.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;TParticlePDG.h&gt;
<span class="lineNum">      31 </span>            : #include &lt;TVector3.h&gt;
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;AliESDv0.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;AliESDV0Params.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;AliKFParticle.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;AliKFVertex.h&quot;
<a name="38"><span class="lineNum">      38 </span>            : #include &quot;AliESDVertex.h&quot;</a>
<span class="lineNum">      39 </span>            : 
<a name="40"><span class="lineNum">      40 </span><span class="lineCov">        172 : ClassImp(AliESDv0)</span></a>
<span class="lineNum">      41 </span>            : 
<a name="42"><span class="lineNum">      42 </span><span class="lineCov">        172 : const AliESDV0Params  AliESDv0::fgkParams;</span></a>
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : AliESDv0::AliESDv0() :
<span class="lineNum">      45 </span><span class="lineCov">         84 :   AliVParticle(),</span>
<span class="lineNum">      46 </span><span class="lineCov">         84 :   fParamN(),</span>
<span class="lineNum">      47 </span><span class="lineCov">         84 :   fParamP(),</span>
<span class="lineNum">      48 </span><span class="lineCov">        252 :   fEffMass(TDatabasePDG::Instance()-&gt;GetParticle(kK0Short)-&gt;Mass()),</span>
<span class="lineNum">      49 </span><span class="lineCov">         84 :   fDcaV0Daughters(0),</span>
<span class="lineNum">      50 </span><span class="lineCov">         84 :   fChi2V0(0.),</span>
<span class="lineNum">      51 </span><span class="lineCov">         84 :   fRr(0),</span>
<span class="lineNum">      52 </span><span class="lineCov">         84 :   fDistSigma(0),</span>
<span class="lineNum">      53 </span><span class="lineCov">         84 :   fChi2Before(0),</span>
<span class="lineNum">      54 </span><span class="lineCov">         84 :   fChi2After(0),</span>
<span class="lineNum">      55 </span><span class="lineCov">         84 :   fPointAngleFi(0),</span>
<span class="lineNum">      56 </span><span class="lineCov">         84 :   fPointAngleTh(0),</span>
<span class="lineNum">      57 </span><span class="lineCov">         84 :   fPointAngle(0),</span>
<span class="lineNum">      58 </span><span class="lineCov">         84 :   fPdgCode(kK0Short),</span>
<span class="lineNum">      59 </span><span class="lineCov">         84 :   fNidx(0),</span>
<span class="lineNum">      60 </span><span class="lineCov">         84 :   fPidx(0),</span>
<span class="lineNum">      61 </span><span class="lineCov">         84 :   fStatus(0),</span>
<span class="lineNum">      62 </span><span class="lineCov">         84 :   fNBefore(0),</span>
<span class="lineNum">      63 </span><span class="lineCov">         84 :   fNAfter(0),</span>
<span class="lineNum">      64 </span><span class="lineCov">         84 :   fOnFlyStatus(kFALSE)</span>
<span class="lineNum">      65 </span><span class="lineCov">        336 : {</span>
<span class="lineNum">      66 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">      67 </span>            :   // Default constructor  (K0s)
<span class="lineNum">      68 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span><span class="lineCov">        672 :   for (Int_t i=0; i&lt;3; i++) {</span>
<span class="lineNum">      71 </span><span class="lineCov">        252 :     fPos[i] = 0.;</span>
<span class="lineNum">      72 </span><span class="lineCov">        252 :     fNmom[i] = 0.;</span>
<span class="lineNum">      73 </span><span class="lineCov">        252 :     fPmom[i] = 0.;</span>
<span class="lineNum">      74 </span>            :   }
<span class="lineNum">      75 </span>            : 
<span class="lineNum">      76 </span><span class="lineCov">       1176 :   for (Int_t i=0; i&lt;6; i++) {</span>
<span class="lineNum">      77 </span><span class="lineCov">        504 :     fPosCov[i]= 0.;</span>
<span class="lineNum">      78 </span>            :   }
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span><span class="lineCov">       1176 :   for (Int_t i=0;i&lt;6;i++){fClusters[0][i]=0; fClusters[1][i]=0;}</span>
<span class="lineNum">      81 </span><span class="lineCov">         84 :   fNormDCAPrim[0]=fNormDCAPrim[1]=0;</span>
<span class="lineNum">      82 </span><span class="lineCov">        672 :   for (Int_t i=0;i&lt;3;i++){fAngle[i]=0;}</span>
<span class="lineNum">      83 </span><span class="lineCov">        840 :   for (Int_t i=0;i&lt;4;i++){fCausality[i]=0;}</span>
<a name="84"><span class="lineNum">      84 </span><span class="lineCov">        126 : }</span></a>
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span>            : AliESDv0::AliESDv0(const AliESDv0&amp; v0) :
<span class="lineNum">      87 </span><span class="lineCov">         62 :   AliVParticle(v0),</span>
<span class="lineNum">      88 </span><span class="lineCov">         62 :   fParamN(v0.fParamN),</span>
<span class="lineNum">      89 </span><span class="lineCov">         62 :   fParamP(v0.fParamP),</span>
<span class="lineNum">      90 </span><span class="lineCov">         62 :   fEffMass(v0.fEffMass),</span>
<span class="lineNum">      91 </span><span class="lineCov">         62 :   fDcaV0Daughters(v0.fDcaV0Daughters),</span>
<span class="lineNum">      92 </span><span class="lineCov">         62 :   fChi2V0(v0.fChi2V0),</span>
<span class="lineNum">      93 </span><span class="lineCov">         62 :   fRr(v0.fRr),</span>
<span class="lineNum">      94 </span><span class="lineCov">         62 :   fDistSigma(v0.fDistSigma),</span>
<span class="lineNum">      95 </span><span class="lineCov">         62 :   fChi2Before(v0.fChi2Before),</span>
<span class="lineNum">      96 </span><span class="lineCov">         62 :   fChi2After(v0.fChi2After),</span>
<span class="lineNum">      97 </span><span class="lineCov">         62 :   fPointAngleFi(v0.fPointAngleFi),</span>
<span class="lineNum">      98 </span><span class="lineCov">         62 :   fPointAngleTh(v0.fPointAngleTh),</span>
<span class="lineNum">      99 </span><span class="lineCov">         62 :   fPointAngle(v0.fPointAngle),</span>
<span class="lineNum">     100 </span><span class="lineCov">         62 :   fPdgCode(v0.fPdgCode),</span>
<span class="lineNum">     101 </span><span class="lineCov">         62 :   fNidx(v0.fNidx),</span>
<span class="lineNum">     102 </span><span class="lineCov">         62 :   fPidx(v0.fPidx),</span>
<span class="lineNum">     103 </span><span class="lineCov">         62 :   fStatus(v0.fStatus),</span>
<span class="lineNum">     104 </span><span class="lineCov">         62 :   fNBefore(v0.fNBefore),</span>
<span class="lineNum">     105 </span><span class="lineCov">         62 :   fNAfter(v0.fNAfter),</span>
<span class="lineNum">     106 </span><span class="lineCov">         62 :   fOnFlyStatus(v0.fOnFlyStatus)</span>
<span class="lineNum">     107 </span><span class="lineCov">        302 : {</span>
<span class="lineNum">     108 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     109 </span>            :   // The copy constructor
<span class="lineNum">     110 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span><span class="lineCov">        496 :   for (int i=0; i&lt;3; i++) {</span>
<span class="lineNum">     113 </span><span class="lineCov">        186 :     fPos[i]  = v0.fPos[i];</span>
<span class="lineNum">     114 </span><span class="lineCov">        186 :     fNmom[i] = v0.fNmom[i];</span>
<span class="lineNum">     115 </span><span class="lineCov">        186 :     fPmom[i] = v0.fPmom[i];</span>
<span class="lineNum">     116 </span>            :   }
<span class="lineNum">     117 </span><span class="lineCov">        868 :   for (int i=0; i&lt;6; i++) {</span>
<span class="lineNum">     118 </span><span class="lineCov">        372 :     fPosCov[i]  = v0.fPosCov[i];</span>
<span class="lineNum">     119 </span>            :   }
<span class="lineNum">     120 </span>            : 
<span class="lineNum">     121 </span><span class="lineCov">        372 :   for (Int_t i=0; i&lt;2; i++) {</span>
<span class="lineNum">     122 </span><span class="lineCov">        124 :     fNormDCAPrim[i]=v0.fNormDCAPrim[i];</span>
<span class="lineNum">     123 </span>            :   }
<span class="lineNum">     124 </span><span class="lineCov">        868 :   for (Int_t i=0;i&lt;6;i++){</span>
<span class="lineNum">     125 </span><span class="lineCov">        372 :       fClusters[0][i]=v0.fClusters[0][i]; </span>
<span class="lineNum">     126 </span><span class="lineCov">        372 :       fClusters[1][i]=v0.fClusters[1][i];</span>
<span class="lineNum">     127 </span>            :   }
<span class="lineNum">     128 </span><span class="lineCov">        496 :   for (Int_t i=0;i&lt;3;i++){</span>
<span class="lineNum">     129 </span><span class="lineCov">        186 :       fAngle[i]=v0.fAngle[i];</span>
<span class="lineNum">     130 </span>            :   }
<span class="lineNum">     131 </span><span class="lineCov">        620 :   for (Int_t i=0;i&lt;4;i++){fCausality[i]=v0.fCausality[i];}</span>
<span class="lineNum">     132 </span><span class="lineCov">        120 : }</span>
<a name="133"><span class="lineNum">     133 </span>            : </a>
<span class="lineNum">     134 </span>            : 
<span class="lineNum">     135 </span>            : AliESDv0::AliESDv0(const AliExternalTrackParam &amp;t1, Int_t i1,
<span class="lineNum">     136 </span>            :                    const AliExternalTrackParam &amp;t2, Int_t i2) :
<span class="lineNum">     137 </span><span class="lineCov">         24 :   AliVParticle(),</span>
<span class="lineNum">     138 </span><span class="lineCov">         24 :   fParamN(t1),</span>
<span class="lineNum">     139 </span><span class="lineCov">         24 :   fParamP(t2),</span>
<span class="lineNum">     140 </span><span class="lineCov">         72 :   fEffMass(TDatabasePDG::Instance()-&gt;GetParticle(kK0Short)-&gt;Mass()),</span>
<span class="lineNum">     141 </span><span class="lineCov">         24 :   fDcaV0Daughters(0),</span>
<span class="lineNum">     142 </span><span class="lineCov">         24 :   fChi2V0(0.),</span>
<span class="lineNum">     143 </span><span class="lineCov">         24 :   fRr(0),</span>
<span class="lineNum">     144 </span><span class="lineCov">         24 :   fDistSigma(0),</span>
<span class="lineNum">     145 </span><span class="lineCov">         24 :   fChi2Before(0),</span>
<span class="lineNum">     146 </span><span class="lineCov">         24 :   fChi2After(0),</span>
<span class="lineNum">     147 </span><span class="lineCov">         24 :   fPointAngleFi(0),</span>
<span class="lineNum">     148 </span><span class="lineCov">         24 :   fPointAngleTh(0),</span>
<span class="lineNum">     149 </span><span class="lineCov">         24 :   fPointAngle(0),</span>
<span class="lineNum">     150 </span><span class="lineCov">         24 :   fPdgCode(kK0Short),</span>
<span class="lineNum">     151 </span><span class="lineCov">         24 :   fNidx(i1),</span>
<span class="lineNum">     152 </span><span class="lineCov">         24 :   fPidx(i2),</span>
<span class="lineNum">     153 </span><span class="lineCov">         24 :   fStatus(0),</span>
<span class="lineNum">     154 </span><span class="lineCov">         24 :   fNBefore(0),</span>
<span class="lineNum">     155 </span><span class="lineCov">         24 :   fNAfter(0),</span>
<span class="lineNum">     156 </span><span class="lineCov">         24 :   fOnFlyStatus(kFALSE)</span>
<span class="lineNum">     157 </span><span class="lineCov">        120 : {</span>
<span class="lineNum">     158 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     159 </span>            :   // Main constructor  (K0s)
<span class="lineNum">     160 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span>            :   //Make sure the daughters are ordered (needed for the on-the-fly V0s)
<span class="lineNum">     163 </span><span class="lineCov">         48 :   Short_t cN=t1.Charge(), cP=t2.Charge();</span>
<span class="lineNum">     164 </span><span class="lineCov">         24 :   if ((cN&gt;0) &amp;&amp; (cN != cP)) {</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :      fParamN.~AliExternalTrackParam();</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :      new (&amp;fParamN) AliExternalTrackParam(t2);</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :      fParamP.~AliExternalTrackParam();</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :      new (&amp;fParamP) AliExternalTrackParam(t1);</span>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :      Int_t index=fNidx;</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :      fNidx=fPidx;</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :      fPidx=index;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span><span class="lineCov">        336 :   for (Int_t i=0; i&lt;6; i++) {</span>
<span class="lineNum">     176 </span><span class="lineCov">        144 :     fPosCov[i]= 0.;</span>
<span class="lineNum">     177 </span>            :   }
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span>            :   //Trivial estimation of the vertex parameters
<span class="lineNum">     180 </span><span class="lineCov">         48 :   Double_t alpha=t1.GetAlpha(), cs=TMath::Cos(alpha), sn=TMath::Sin(alpha);</span>
<span class="lineNum">     181 </span><span class="lineCov">         24 :   Double_t tmp[3];</span>
<span class="lineNum">     182 </span><span class="lineCov">         24 :   t1.GetPxPyPz(tmp);</span>
<span class="lineNum">     183 </span><span class="lineCov">         24 :   Double_t px1=tmp[0], py1=tmp[1], pz1=tmp[2];</span>
<span class="lineNum">     184 </span><span class="lineCov">         24 :   t1.GetXYZ(tmp);</span>
<span class="lineNum">     185 </span><span class="lineCov">         24 :   Double_t  x1=tmp[0],  y1=tmp[1],  z1=tmp[2];</span>
<span class="lineNum">     186 </span>            :   const Double_t ss=0.0005*0.0005;//a kind of a residual misalignment precision
<span class="lineNum">     187 </span><span class="lineCov">         24 :   Double_t sx1=sn*sn*t1.GetSigmaY2()+ss, sy1=cs*cs*t1.GetSigmaY2()+ss; </span>
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span><span class="lineCov">         48 :   alpha=t2.GetAlpha(); cs=TMath::Cos(alpha); sn=TMath::Sin(alpha);</span>
<span class="lineNum">     191 </span><span class="lineCov">         24 :   t2.GetPxPyPz(tmp);</span>
<span class="lineNum">     192 </span><span class="lineCov">         24 :   Double_t px2=tmp[0], py2=tmp[1], pz2=tmp[2];</span>
<span class="lineNum">     193 </span><span class="lineCov">         24 :   t2.GetXYZ(tmp);</span>
<span class="lineNum">     194 </span><span class="lineCov">         24 :   Double_t  x2=tmp[0],  y2=tmp[1],  z2=tmp[2];</span>
<span class="lineNum">     195 </span><span class="lineCov">         24 :   Double_t sx2=sn*sn*t2.GetSigmaY2()+ss, sy2=cs*cs*t2.GetSigmaY2()+ss; </span>
<span class="lineNum">     196 </span>            :     
<span class="lineNum">     197 </span><span class="lineCov">         24 :   Double_t sz1=t1.GetSigmaZ2(), sz2=t2.GetSigmaZ2();</span>
<span class="lineNum">     198 </span><span class="lineCov">         24 :   Double_t wx1=sx2/(sx1+sx2), wx2=1.- wx1;</span>
<span class="lineNum">     199 </span><span class="lineCov">         24 :   Double_t wy1=sy2/(sy1+sy2), wy2=1.- wy1;</span>
<span class="lineNum">     200 </span><span class="lineCov">         24 :   Double_t wz1=sz2/(sz1+sz2), wz2=1.- wz1;</span>
<span class="lineNum">     201 </span><span class="lineCov">         24 :   fPos[0]=wx1*x1 + wx2*x2; fPos[1]=wy1*y1 + wy2*y2; fPos[2]=wz1*z1 + wz2*z2;</span>
<span class="lineNum">     202 </span>            : 
<span class="lineNum">     203 </span>            :   //fPos[0]=0.5*(x1+x2); fPos[1]=0.5*(y1+y2); fPos[2]=0.5*(z1+z2);
<span class="lineNum">     204 </span><span class="lineCov">         24 :   fNmom[0]=px1; fNmom[1]=py1; fNmom[2]=pz1; </span>
<span class="lineNum">     205 </span><span class="lineCov">         24 :   fPmom[0]=px2; fPmom[1]=py2; fPmom[2]=pz2;</span>
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span><span class="lineCov">        336 :   for (Int_t i=0;i&lt;6;i++){fClusters[0][i]=0; fClusters[1][i]=0;}</span>
<span class="lineNum">     208 </span><span class="lineCov">         24 :   fNormDCAPrim[0]=fNormDCAPrim[1]=0;</span>
<span class="lineNum">     209 </span><span class="lineCov">        192 :   for (Int_t i=0;i&lt;3;i++){fAngle[i]=0;}</span>
<span class="lineNum">     210 </span><span class="lineCov">        240 :   for (Int_t i=0;i&lt;4;i++){fCausality[i]=0;}</span>
<a name="211"><span class="lineNum">     211 </span><span class="lineCov">         48 : }</span></a>
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            : AliESDv0&amp; AliESDv0::operator=(const AliESDv0 &amp;v0)
<span class="lineNum">     214 </span>            : {
<span class="lineNum">     215 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     216 </span>            :   // The assignment operator
<span class="lineNum">     217 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     218 </span>            : 
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :   if(this==&amp;v0)return *this;</span>
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   AliVParticle::operator=(v0);</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :   fParamN  = v0.fParamN;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :   fParamP  = v0.fParamP;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :   fEffMass = v0.fEffMass;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :   fDcaV0Daughters = v0.fDcaV0Daughters;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :   fChi2V0 = v0.fChi2V0;</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :   fRr = v0.fRr;</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :   fDistSigma    = v0.fDistSigma;</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :   fChi2Before   = v0.fChi2Before;</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :   fChi2After    = v0.fChi2After;</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :   fPointAngleFi = v0.fPointAngleFi;</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   fPointAngleTh = v0.fPointAngleTh;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :   fPointAngle   = v0.fPointAngle;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   fPdgCode      = v0.fPdgCode;</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :   fNidx         = v0.fNidx;</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :   fPidx         = v0.fPidx;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :   fStatus       = v0.fStatus;</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :   fNBefore      = v0.fNBefore;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :   fNAfter       = v0.fNAfter;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :   fOnFlyStatus  = v0.fOnFlyStatus;</span>
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :   for (int i=0; i&lt;3; i++) {</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :     fPos[i]  = v0.fPos[i];</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     fNmom[i] = v0.fNmom[i];</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     fPmom[i] = v0.fPmom[i];</span>
<span class="lineNum">     245 </span>            :   }
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   for (int i=0; i&lt;6; i++) {</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     fPosCov[i]  = v0.fPosCov[i];</span>
<span class="lineNum">     248 </span>            :   }
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :   for (Int_t i=0; i&lt;2; i++) {</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :     fNormDCAPrim[i]=v0.fNormDCAPrim[i];</span>
<span class="lineNum">     251 </span>            :   }
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;6;i++){</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       fClusters[0][i]=v0.fClusters[0][i]; </span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :       fClusters[1][i]=v0.fClusters[1][i];</span>
<span class="lineNum">     255 </span>            :   }
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;3;i++){</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :       fAngle[i]=v0.fAngle[i];</span>
<span class="lineNum">     258 </span>            :   }
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :   for (Int_t i=0;i&lt;4;i++){fCausality[i]=v0.fCausality[i];}</span>
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :   return *this;</span>
<a name="262"><span class="lineNum">     262 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span>            : void AliESDv0::Copy(TObject&amp; obj) const {
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span>            :   // this overwrites the virtual TOBject::Copy()
<span class="lineNum">     267 </span>            :   // to allow run time copying without casting
<span class="lineNum">     268 </span>            :   // in AliESDEvent
<span class="lineNum">     269 </span>            : 
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   if(this==&amp;obj)return;</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   AliESDv0 *robj = dynamic_cast&lt;AliESDv0*&gt;(&amp;obj);</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   if(!robj)return; // not an aliesesv0</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   *robj = *this;</span>
<a name="274"><span class="lineNum">     274 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     275 </span>            : 
<span class="lineNum">     276 </span><span class="lineCov">        732 : AliESDv0::~AliESDv0(){</span>
<span class="lineNum">     277 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     278 </span>            :   // Empty destructor
<span class="lineNum">     279 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     280 </span><span class="lineCov">        366 : }</span>
<a name="281"><span class="lineNum">     281 </span>            : </a>
<span class="lineNum">     282 </span>            : // Start with AliVParticle functions
<span class="lineNum">     283 </span>            : Double_t AliESDv0::E() const {
<span class="lineNum">     284 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     285 </span>            :   // This gives the energy assuming the ChangeMassHypothesis was called
<span class="lineNum">     286 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :   return E(fPdgCode);</span>
<a name="288"><span class="lineNum">     288 </span>            : }</a>
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            : Double_t AliESDv0::Y() const {
<span class="lineNum">     291 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     292 </span>            :   // This gives the energy assuming the ChangeMassHypothesis was called
<span class="lineNum">     293 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :   return Y(fPdgCode);</span>
<span class="lineNum">     295 </span>            : }
<a name="296"><span class="lineNum">     296 </span>            : </a>
<span class="lineNum">     297 </span>            : // Then extend AliVParticle functions
<span class="lineNum">     298 </span>            : Double_t AliESDv0::E(Int_t pdg) const {
<span class="lineNum">     299 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     300 </span>            :   // This gives the energy with the particle hypothesis as argument 
<span class="lineNum">     301 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :   Double_t mass = TDatabasePDG::Instance()-&gt;GetParticle(pdg)-&gt;Mass();</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :   return TMath::Sqrt(mass*mass+P()*P());</span>
<a name="304"><span class="lineNum">     304 </span>            : }</a>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span>            : Double_t AliESDv0::Y(Int_t pdg) const {
<span class="lineNum">     307 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     308 </span>            :   // This gives the rapidity with the particle hypothesis as argument 
<span class="lineNum">     309 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :   return 0.5*TMath::Log((E(pdg)+Pz())/(E(pdg)-Pz()+1.e-13));</span>
<span class="lineNum">     311 </span>            : }
<a name="312"><span class="lineNum">     312 </span>            : </a>
<span class="lineNum">     313 </span>            : // Now the functions for analysis consistency
<span class="lineNum">     314 </span>            : Double_t AliESDv0::RapK0Short() const {
<span class="lineNum">     315 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     316 </span>            :   // This gives the pseudorapidity assuming a K0s particle
<span class="lineNum">     317 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :   return Y(kK0Short);</span>
<a name="319"><span class="lineNum">     319 </span>            : }</a>
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span>            : Double_t AliESDv0::RapLambda() const {
<span class="lineNum">     322 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     323 </span>            :   // This gives the pseudorapidity assuming a (Anti) Lambda particle
<span class="lineNum">     324 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :   return Y(kLambda0);</span>
<a name="326"><span class="lineNum">     326 </span>            : }</a>
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span>            : Double_t AliESDv0::AlphaV0() const {
<span class="lineNum">     329 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     330 </span>            :   // This gives the Armenteros-Podolanski alpha
<span class="lineNum">     331 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   TVector3 momNeg(fNmom[0],fNmom[1],fNmom[2]);</span>
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :   TVector3 momPos(fPmom[0],fPmom[1],fPmom[2]);</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :   TVector3 momTot(Px(),Py(),Pz());</span>
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   Double_t lQlNeg = momNeg.Dot(momTot)/momTot.Mag();</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :   Double_t lQlPos = momPos.Dot(momTot)/momTot.Mag();</span>
<span class="lineNum">     338 </span>            : 
<span class="lineNum">     339 </span>            :   //return 1.-2./(1.+lQlNeg/lQlPos);
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :   return (lQlPos - lQlNeg)/(lQlPos + lQlNeg);</span>
<a name="341"><span class="lineNum">     341 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     342 </span>            : 
<span class="lineNum">     343 </span>            : Double_t AliESDv0::PtArmV0() const {
<span class="lineNum">     344 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     345 </span>            :   // This gives the Armenteros-Podolanski ptarm
<span class="lineNum">     346 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :   TVector3 momNeg(fNmom[0],fNmom[1],fNmom[2]);</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   TVector3 momTot(Px(),Py(),Pz());</span>
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :   return momNeg.Perp(momTot);</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 : }</span>
<a name="352"><span class="lineNum">     352 </span>            : </a>
<span class="lineNum">     353 </span>            : // Eventually the older functions
<span class="lineNum">     354 </span>            : Double_t AliESDv0::ChangeMassHypothesis(Int_t code) {
<span class="lineNum">     355 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     356 </span>            :   // This function changes the mass hypothesis for this V0
<span class="lineNum">     357 </span>            :   // and returns the &quot;kinematical quality&quot; of this hypothesis 
<span class="lineNum">     358 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     359 </span><span class="lineCov">        116 :   static</span>
<span class="lineNum">     360 </span><span class="lineCov">          6 :   Double_t piMass=TDatabasePDG::Instance()-&gt;GetParticle(kPiPlus)-&gt;Mass();</span>
<span class="lineNum">     361 </span><span class="lineCov">         60 :   static</span>
<span class="lineNum">     362 </span><span class="lineCov">          6 :   Double_t prMass=TDatabasePDG::Instance()-&gt;GetParticle(kProton)-&gt;Mass();</span>
<span class="lineNum">     363 </span><span class="lineCov">         60 :   static</span>
<span class="lineNum">     364 </span><span class="lineCov">          6 :   Double_t k0Mass=TDatabasePDG::Instance()-&gt;GetParticle(kK0Short)-&gt;Mass();</span>
<span class="lineNum">     365 </span><span class="lineCov">         60 :   static</span>
<span class="lineNum">     366 </span><span class="lineCov">          6 :   Double_t l0Mass=TDatabasePDG::Instance()-&gt;GetParticle(kLambda0)-&gt;Mass();</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineCov">         84 :   Double_t nmass=piMass, pmass=piMass, mass=k0Mass, ps=0.206;</span>
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span><span class="lineCov">         84 :   fPdgCode=code;</span>
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span><span class="lineCov">         84 :   switch (code) {</span>
<span class="lineNum">     373 </span>            :   case kLambda0:
<span class="lineNum">     374 </span><span class="lineCov">         14 :     nmass=piMass; pmass=prMass; mass=l0Mass; ps=0.101; break;</span>
<span class="lineNum">     375 </span>            :   case kLambda0Bar:
<span class="lineNum">     376 </span><span class="lineCov">         14 :     pmass=piMass; nmass=prMass; mass=l0Mass; ps=0.101; break;</span>
<span class="lineNum">     377 </span>            :   case kK0Short: 
<span class="lineNum">     378 </span>            :     break;
<span class="lineNum">     379 </span>            :   default:
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :     AliError(&quot;invalide PDG code ! Assuming K0s...&quot;);</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :     fPdgCode=kK0Short;</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     383 </span>            :   }
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span><span class="lineCov">         56 :   Double_t pxn=fNmom[0], pyn=fNmom[1], pzn=fNmom[2]; </span>
<span class="lineNum">     386 </span><span class="lineCov">         56 :   Double_t pxp=fPmom[0], pyp=fPmom[1], pzp=fPmom[2];</span>
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span><span class="lineCov">         56 :   Double_t en=TMath::Sqrt(nmass*nmass + pxn*pxn + pyn*pyn + pzn*pzn);</span>
<span class="lineNum">     389 </span><span class="lineCov">         56 :   Double_t ep=TMath::Sqrt(pmass*pmass + pxp*pxp + pyp*pyp + pzp*pzp);</span>
<span class="lineNum">     390 </span><span class="lineCov">         56 :   Double_t pxl=pxn+pxp, pyl=pyn+pyp, pzl=pzn+pzp;</span>
<span class="lineNum">     391 </span><span class="lineCov">         56 :   Double_t pl=TMath::Sqrt(pxl*pxl + pyl*pyl + pzl*pzl);</span>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span><span class="lineCov">         56 :   fEffMass=TMath::Sqrt((en+ep)*(en+ep)-pl*pl);</span>
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span><span class="lineCov">         56 :   Double_t beta=pl/(en+ep);</span>
<span class="lineNum">     396 </span><span class="lineCov">         56 :   Double_t pln=(pxn*pxl + pyn*pyl + pzn*pzl)/pl;</span>
<span class="lineNum">     397 </span><span class="lineCov">         56 :   Double_t plp=(pxp*pxl + pyp*pyl + pzp*pzl)/pl;</span>
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span><span class="lineCov">         56 :   Double_t pt2=pxp*pxp + pyp*pyp + pzp*pzp - plp*plp;</span>
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span><span class="lineCov">         56 :   Double_t a=(plp-pln)/(plp+pln);</span>
<span class="lineNum">     402 </span><span class="lineCov">         56 :   a -= (pmass*pmass-nmass*nmass)/(mass*mass);</span>
<span class="lineNum">     403 </span><span class="lineCov">         56 :   a = 0.25*beta*beta*mass*mass*a*a + pt2;</span>
<span class="lineNum">     404 </span>            : 
<span class="lineNum">     405 </span><span class="lineCov">         56 :   return (a - ps*ps);</span>
<span class="lineNum">     406 </span>            :   
<a name="407"><span class="lineNum">     407 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span>            : void AliESDv0::GetPxPyPz(Double_t &amp;px, Double_t &amp;py, Double_t &amp;pz) const {
<span class="lineNum">     410 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     411 </span>            :   // This function returns V0's momentum (global)
<span class="lineNum">     412 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     413 </span><span class="lineCov">        120 :   px=fNmom[0]+fPmom[0]; </span>
<span class="lineNum">     414 </span><span class="lineCov">         60 :   py=fNmom[1]+fPmom[1]; </span>
<span class="lineNum">     415 </span><span class="lineCov">         60 :   pz=fNmom[2]+fPmom[2]; </span>
<a name="416"><span class="lineNum">     416 </span><span class="lineCov">         60 : }</span></a>
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span>            : void AliESDv0::GetXYZ(Double_t &amp;x, Double_t &amp;y, Double_t &amp;z) const {
<span class="lineNum">     419 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     420 </span>            :   // This function returns V0's position (global)
<span class="lineNum">     421 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     422 </span><span class="lineCov">        160 :   x=fPos[0]; </span>
<span class="lineNum">     423 </span><span class="lineCov">         80 :   y=fPos[1]; </span>
<span class="lineNum">     424 </span><span class="lineCov">         80 :   z=fPos[2]; </span>
<a name="425"><span class="lineNum">     425 </span><span class="lineCov">         80 : }</span></a>
<span class="lineNum">     426 </span>            : 
<span class="lineNum">     427 </span>            : Float_t AliESDv0::GetD(Double_t x0, Double_t y0) const {
<span class="lineNum">     428 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     429 </span>            :   // This function returns V0's impact parameter calculated in 2D in XY plane
<span class="lineNum">     430 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   Double_t x=fPos[0],y=fPos[1];</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :   Double_t px=fNmom[0]+fPmom[0];</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :   Double_t py=fNmom[1]+fPmom[1];</span>
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :   Double_t dz=(x0-x)*py - (y0-y)*px;</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :   Double_t d=TMath::Sqrt(dz*dz/(px*px+py*py));</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :   return d;</span>
<a name="438"><span class="lineNum">     438 </span>            : }</a>
<span class="lineNum">     439 </span>            : 
<span class="lineNum">     440 </span>            : Float_t AliESDv0::GetD(Double_t x0, Double_t y0, Double_t z0) const {
<span class="lineNum">     441 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     442 </span>            :   // This function returns V0's impact parameter calculated in 3D
<span class="lineNum">     443 </span>            :   //--------------------------------------------------------------------
<span class="lineNum">     444 </span><span class="lineCov">        188 :   Double_t x=fPos[0],y=fPos[1],z=fPos[2];</span>
<span class="lineNum">     445 </span><span class="lineCov">         94 :   Double_t px=fNmom[0]+fPmom[0];</span>
<span class="lineNum">     446 </span><span class="lineCov">         94 :   Double_t py=fNmom[1]+fPmom[1];</span>
<span class="lineNum">     447 </span><span class="lineCov">         94 :   Double_t pz=fNmom[2]+fPmom[2];</span>
<span class="lineNum">     448 </span>            : 
<span class="lineNum">     449 </span><span class="lineCov">         94 :   Double_t dx=(y0-y)*pz - (z0-z)*py; </span>
<span class="lineNum">     450 </span><span class="lineCov">         94 :   Double_t dy=(x0-x)*pz - (z0-z)*px;</span>
<span class="lineNum">     451 </span><span class="lineCov">         94 :   Double_t dz=(x0-x)*py - (y0-y)*px;</span>
<span class="lineNum">     452 </span><span class="lineCov">         94 :   Double_t d=TMath::Sqrt((dx*dx+dy*dy+dz*dz)/(px*px+py*py+pz*pz));</span>
<span class="lineNum">     453 </span><span class="lineCov">         94 :   return d;</span>
<a name="454"><span class="lineNum">     454 </span>            : }</a>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span>            : Float_t AliESDv0::GetV0CosineOfPointingAngle(Double_t refPointX, Double_t refPointY, Double_t refPointZ) const {
<span class="lineNum">     457 </span>            :   // calculates the pointing angle of the V0 wrt a reference point
<span class="lineNum">     458 </span>            : 
<span class="lineNum">     459 </span><span class="lineCov">         48 :   Double_t momV0[3]; //momentum of the V0</span>
<span class="lineNum">     460 </span><span class="lineCov">         24 :   GetPxPyPz(momV0[0],momV0[1],momV0[2]);</span>
<span class="lineNum">     461 </span>            : 
<span class="lineNum">     462 </span>            :   Double_t deltaPos[3]; //vector between the reference point and the V0 vertex
<span class="lineNum">     463 </span><span class="lineCov">         24 :   deltaPos[0] = fPos[0] - refPointX;</span>
<span class="lineNum">     464 </span><span class="lineCov">         24 :   deltaPos[1] = fPos[1] - refPointY;</span>
<span class="lineNum">     465 </span><span class="lineCov">         24 :   deltaPos[2] = fPos[2] - refPointZ;</span>
<span class="lineNum">     466 </span>            : 
<span class="lineNum">     467 </span><span class="lineCov">         24 :   Double_t momV02    = momV0[0]*momV0[0] + momV0[1]*momV0[1] + momV0[2]*momV0[2];</span>
<span class="lineNum">     468 </span><span class="lineCov">         24 :   Double_t deltaPos2 = deltaPos[0]*deltaPos[0] + deltaPos[1]*deltaPos[1] + deltaPos[2]*deltaPos[2];</span>
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span><span class="lineCov">         48 :   Double_t cosinePointingAngle = (deltaPos[0]*momV0[0] +</span>
<span class="lineNum">     471 </span><span class="lineCov">         48 :                                   deltaPos[1]*momV0[1] +</span>
<span class="lineNum">     472 </span><span class="lineCov">         48 :                                   deltaPos[2]*momV0[2] ) /</span>
<span class="lineNum">     473 </span><span class="lineCov">         24 :     TMath::Sqrt(momV02 * deltaPos2);</span>
<span class="lineNum">     474 </span>            :   
<span class="lineNum">     475 </span><span class="lineCov">         48 :   return cosinePointingAngle;</span>
<span class="lineNum">     476 </span><span class="lineCov">         24 : }</span>
<span class="lineNum">     477 </span>            : 
<span class="lineNum">     478 </span>            : 
<a name="479"><span class="lineNum">     479 </span>            : // **** The following functions need to be revised</a>
<span class="lineNum">     480 </span>            : 
<span class="lineNum">     481 </span>            : void AliESDv0::GetPosCov(Double_t cov[6]) const {
<span class="lineNum">     482 </span>            : 
<span class="lineNum">     483 </span><span class="lineCov">        240 :   for (Int_t i=0; i&lt;6; ++i) cov[i] = fPosCov[i];</span>
<span class="lineNum">     484 </span>            : 
<a name="485"><span class="lineNum">     485 </span><span class="lineCov">         16 : }</span></a>
<span class="lineNum">     486 </span>            : 
<span class="lineNum">     487 </span>            : Double_t AliESDv0::GetSigmaY(){
<span class="lineNum">     488 </span>            :   //
<span class="lineNum">     489 </span>            :   // return sigmay in y  at vertex position  using covariance matrix 
<span class="lineNum">     490 </span>            :   //
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :   const Double_t * cp  = fParamP.GetCovariance();</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :   const Double_t * cm  = fParamN.GetCovariance();</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :   Double_t sigmay = cp[0]+cm[0]+ cp[5]*(fParamP.GetX()-fRr)*(fParamP.GetX()-fRr)+ cm[5]*(fParamN.GetX()-fRr)*(fParamN.GetX()-fRr);</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :   return (sigmay&gt;0) ? TMath::Sqrt(sigmay):100;</span>
<a name="495"><span class="lineNum">     495 </span>            : }</a>
<span class="lineNum">     496 </span>            : 
<span class="lineNum">     497 </span>            : Double_t AliESDv0::GetSigmaZ(){
<span class="lineNum">     498 </span>            :   //
<span class="lineNum">     499 </span>            :   // return sigmay in y  at vertex position  using covariance matrix 
<span class="lineNum">     500 </span>            :   //
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :   const Double_t * cp  = fParamP.GetCovariance();</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :   const Double_t * cm  = fParamN.GetCovariance();</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :   Double_t sigmaz = cp[2]+cm[2]+ cp[9]*(fParamP.GetX()-fRr)*(fParamP.GetX()-fRr)+ cm[9]*(fParamN.GetX()-fRr)*(fParamN.GetX()-fRr);</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :   return (sigmaz&gt;0) ? TMath::Sqrt(sigmaz):100;</span>
<a name="505"><span class="lineNum">     505 </span>            : }</a>
<span class="lineNum">     506 </span>            : 
<span class="lineNum">     507 </span>            : Double_t AliESDv0::GetSigmaD0(){
<span class="lineNum">     508 </span>            :   //
<span class="lineNum">     509 </span>            :   // Sigma parameterization using covariance matrix
<span class="lineNum">     510 </span>            :   //
<span class="lineNum">     511 </span>            :   // sigma of distance between two tracks in vertex position 
<span class="lineNum">     512 </span>            :   // sigma of DCA is proportianal to sigmaD0
<span class="lineNum">     513 </span>            :   // factor 2 difference is explained by the fact that the DCA is calculated at the position 
<span class="lineNum">     514 </span>            :   // where the tracks as closest together ( not exact position of the vertex)
<span class="lineNum">     515 </span>            :   //
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :   const Double_t * cp      = fParamP.GetCovariance();</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :   const Double_t * cm      = fParamN.GetCovariance();</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :   Double_t sigmaD0   = cp[0]+cm[0]+cp[2]+cm[2]+fgkParams.fPSigmaOffsetD0*fgkParams.fPSigmaOffsetD0;</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :   sigmaD0           += ((fParamP.GetX()-fRr)*(fParamP.GetX()-fRr))*(cp[5]+cp[9]);</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :   sigmaD0           += ((fParamN.GetX()-fRr)*(fParamN.GetX()-fRr))*(cm[5]+cm[9]);</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :   return (sigmaD0&gt;0)? TMath::Sqrt(sigmaD0):100;</span>
<span class="lineNum">     522 </span>            : }
<a name="523"><span class="lineNum">     523 </span>            : </a>
<span class="lineNum">     524 </span>            : 
<span class="lineNum">     525 </span>            : Double_t AliESDv0::GetSigmaAP0(){
<span class="lineNum">     526 </span>            :   //
<span class="lineNum">     527 </span>            :   //Sigma parameterization using covariance matrices
<span class="lineNum">     528 </span>            :   //
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :   Double_t prec  = TMath::Sqrt((fNmom[0]+fPmom[0])*(fNmom[0]+fPmom[0])</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :                               +(fNmom[1]+fPmom[1])*(fNmom[1]+fPmom[1])</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :                               +(fNmom[2]+fPmom[2])*(fNmom[2]+fPmom[2]));</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :   Double_t normp = TMath::Sqrt(fPmom[0]*fPmom[0]+fPmom[1]*fPmom[1]+fPmom[2]*fPmom[2])/prec;  // fraction of the momenta</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :   Double_t normm = TMath::Sqrt(fNmom[0]*fNmom[0]+fNmom[1]*fNmom[1]+fNmom[2]*fNmom[2])/prec;  </span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :   const Double_t * cp      = fParamP.GetCovariance();</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :   const Double_t * cm      = fParamN.GetCovariance();</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :   Double_t sigmaAP0 = fgkParams.fPSigmaOffsetAP0*fgkParams.fPSigmaOffsetAP0;                           // minimal part</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :   sigmaAP0 +=  (cp[5]+cp[9])*(normp*normp)+(cm[5]+cm[9])*(normm*normm);          // angular resolution part</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :   Double_t sigmaAP1 = GetSigmaD0()/(TMath::Abs(fRr)+0.01);                       // vertex position part</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :   sigmaAP0 +=  0.5*sigmaAP1*sigmaAP1;                              </span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :   return (sigmaAP0&gt;0)? TMath::Sqrt(sigmaAP0):100;</span>
<a name="541"><span class="lineNum">     541 </span>            : }</a>
<span class="lineNum">     542 </span>            : 
<span class="lineNum">     543 </span>            : Double_t AliESDv0::GetEffectiveSigmaD0(){
<span class="lineNum">     544 </span>            :   //
<span class="lineNum">     545 </span>            :   // minimax - effective Sigma parameterization 
<span class="lineNum">     546 </span>            :   // p12 effective curvature and v0 radius postion used as parameters  
<span class="lineNum">     547 </span>            :   //  
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :   Double_t p12 = TMath::Sqrt(fParamP.GetParameter()[4]*fParamP.GetParameter()[4]+</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :                              fParamN.GetParameter()[4]*fParamN.GetParameter()[4]);</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :   Double_t sigmaED0= TMath::Max(TMath::Sqrt(fRr)-fgkParams.fPSigmaRminDE,0.0)*fgkParams.fPSigmaCoefDE*p12*p12;</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :   sigmaED0*= sigmaED0;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :   sigmaED0*= sigmaED0;</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :   sigmaED0 = TMath::Sqrt(sigmaED0+fgkParams.fPSigmaOffsetDE*fgkParams.fPSigmaOffsetDE);</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :   return (sigmaED0&lt;fgkParams.fPSigmaMaxDE) ? sigmaED0: fgkParams.fPSigmaMaxDE;</span>
<span class="lineNum">     555 </span>            : }
<a name="556"><span class="lineNum">     556 </span>            : </a>
<span class="lineNum">     557 </span>            : 
<span class="lineNum">     558 </span>            : Double_t AliESDv0::GetEffectiveSigmaAP0(){
<span class="lineNum">     559 </span>            :   //
<span class="lineNum">     560 </span>            :   // effective Sigma parameterization of point angle resolution 
<span class="lineNum">     561 </span>            :   //
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :   Double_t p12 = TMath::Sqrt(fParamP.GetParameter()[4]*fParamP.GetParameter()[4]+</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :                              fParamN.GetParameter()[4]*fParamN.GetParameter()[4]);</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :   Double_t sigmaAPE= fgkParams.fPSigmaBase0APE;</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :   sigmaAPE+= fgkParams.fPSigmaR0APE/(fgkParams.fPSigmaR1APE+fRr);</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :   sigmaAPE*= (fgkParams.fPSigmaP0APE+fgkParams.fPSigmaP1APE*p12);</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :   sigmaAPE = TMath::Min(sigmaAPE,fgkParams.fPSigmaMaxAPE);</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :   return sigmaAPE;</span>
<span class="lineNum">     569 </span>            : }
<a name="570"><span class="lineNum">     570 </span>            : </a>
<span class="lineNum">     571 </span>            : 
<span class="lineNum">     572 </span>            : Double_t  AliESDv0::GetMinimaxSigmaAP0(){
<span class="lineNum">     573 </span>            :   //
<span class="lineNum">     574 </span>            :   // calculate mini-max effective sigma of point angle resolution
<span class="lineNum">     575 </span>            :   //
<span class="lineNum">     576 </span>            :   //compv0-&gt;fTree-&gt;SetAlias(&quot;SigmaAP2&quot;,&quot;max(min((SigmaAP0+SigmaAPE0)*0.5,1.5*SigmaAPE0),0.5*SigmaAPE0+0.003)&quot;);
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :   Double_t    effectiveSigma = GetEffectiveSigmaAP0();</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :   Double_t    sigmaMMAP = 0.5*(GetSigmaAP0()+effectiveSigma);</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :   sigmaMMAP  = TMath::Min(sigmaMMAP, fgkParams.fPMaxFractionAP0*effectiveSigma);</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :   sigmaMMAP  = TMath::Max(sigmaMMAP, fgkParams.fPMinFractionAP0*effectiveSigma+fgkParams.fPMinAP0);</span>
<a name="581"><span class="lineNum">     581 </span><span class="lineNoCov">          0 :   return sigmaMMAP;</span></a>
<span class="lineNum">     582 </span>            : }
<span class="lineNum">     583 </span>            : Double_t  AliESDv0::GetMinimaxSigmaD0(){
<span class="lineNum">     584 </span>            :   //
<span class="lineNum">     585 </span>            :   // calculate mini-max sigma of dca resolution
<span class="lineNum">     586 </span>            :   // 
<span class="lineNum">     587 </span>            :   //compv0-&gt;fTree-&gt;SetAlias(&quot;SigmaD2&quot;,&quot;max(min((SigmaD0+SigmaDE0)*0.5,1.5*SigmaDE0),0.5*SigmaDE0)&quot;);
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :   Double_t    effectiveSigma = GetEffectiveSigmaD0();</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :   Double_t    sigmaMMD0 = 0.5*(GetSigmaD0()+effectiveSigma);</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :   sigmaMMD0  = TMath::Min(sigmaMMD0, fgkParams.fPMaxFractionD0*effectiveSigma);</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :   sigmaMMD0  = TMath::Max(sigmaMMD0, fgkParams.fPMinFractionD0*effectiveSigma+fgkParams.fPMinD0);</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :   return sigmaMMD0;</span>
<span class="lineNum">     593 </span>            : }
<a name="594"><span class="lineNum">     594 </span>            : </a>
<span class="lineNum">     595 </span>            : 
<span class="lineNum">     596 </span>            : Double_t AliESDv0::GetLikelihoodAP(Int_t mode0, Int_t mode1){
<span class="lineNum">     597 </span>            :   //
<span class="lineNum">     598 </span>            :   // get likelihood for point angle
<span class="lineNum">     599 </span>            :   //
<span class="lineNum">     600 </span>            :   Double_t sigmaAP = 0.007;            //default sigma
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :   switch (mode0){</span>
<span class="lineNum">     602 </span>            :   case 0:
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :     sigmaAP = GetSigmaAP0();           // mode 0  - covariance matrix estimates used </span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     605 </span>            :   case 1:
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :     sigmaAP = GetEffectiveSigmaAP0();  // mode 1 - effective sigma used</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     608 </span>            :   case 2:
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :     sigmaAP = GetMinimaxSigmaAP0();    // mode 2 - minimax sigma</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     611 </span>            :   }
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :   Double_t apNorm = TMath::Min(TMath::ACos(fPointAngle)/sigmaAP,50.);  </span>
<span class="lineNum">     613 </span>            :   //normalized point angle, restricted - because of overflow problems in Exp
<span class="lineNum">     614 </span>            :   Double_t likelihood = 0;
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :   switch(mode1){</span>
<span class="lineNum">     616 </span>            :   case 0:
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :     likelihood = TMath::Exp(-0.5*apNorm*apNorm);   </span>
<span class="lineNum">     618 </span>            :     // one component
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     620 </span>            :   case 1:
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :     likelihood = (TMath::Exp(-0.5*apNorm*apNorm)+0.5* TMath::Exp(-0.25*apNorm*apNorm))/1.5;</span>
<span class="lineNum">     622 </span>            :     // two components
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     624 </span>            :   case 2:
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :     likelihood = (TMath::Exp(-0.5*apNorm*apNorm)+0.5* TMath::Exp(-0.25*apNorm*apNorm)+0.25*TMath::Exp(-0.125*apNorm*apNorm))/1.75;</span>
<span class="lineNum">     626 </span>            :     // three components
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     628 </span>            :   }
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :   return likelihood;</span>
<a name="630"><span class="lineNum">     630 </span>            : }</a>
<span class="lineNum">     631 </span>            : 
<span class="lineNum">     632 </span>            : Double_t AliESDv0::GetLikelihoodD(Int_t mode0, Int_t mode1){
<span class="lineNum">     633 </span>            :   //
<span class="lineNum">     634 </span>            :   // get likelihood for DCA
<span class="lineNum">     635 </span>            :   //
<span class="lineNum">     636 </span>            :   Double_t sigmaD = 0.03;            //default sigma
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :   switch (mode0){</span>
<span class="lineNum">     638 </span>            :   case 0:
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     sigmaD = GetSigmaD0();           // mode 0  - covariance matrix estimates used </span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     641 </span>            :   case 1:
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :     sigmaD = GetEffectiveSigmaD0();  // mode 1 - effective sigma used</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     644 </span>            :   case 2:
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     sigmaD = GetMinimaxSigmaD0();    // mode 2 - minimax sigma</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     647 </span>            :   }
<span class="lineNum">     648 </span>            : 
<span class="lineNum">     649 </span>            :   //Bo:  Double_t dNorm = TMath::Min(fDist2/sigmaD,50.);
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :   Double_t dNorm = TMath::Min(fDcaV0Daughters/sigmaD,50.);//Bo:</span>
<span class="lineNum">     651 </span>            :   //normalized point angle, restricted - because of overflow problems in Exp
<span class="lineNum">     652 </span>            :   Double_t likelihood = 0;
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :   switch(mode1){</span>
<span class="lineNum">     654 </span>            :   case 0:
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :     likelihood = TMath::Exp(-2.*dNorm);   </span>
<span class="lineNum">     656 </span>            :     // one component
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     658 </span>            :   case 1:
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :     likelihood = (TMath::Exp(-2.*dNorm)+0.5* TMath::Exp(-dNorm))/1.5;</span>
<span class="lineNum">     660 </span>            :     // two components
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     662 </span>            :   case 2:
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     likelihood = (TMath::Exp(-2.*dNorm)+0.5* TMath::Exp(-dNorm)+0.25*TMath::Exp(-0.5*dNorm))/1.75;</span>
<span class="lineNum">     664 </span>            :     // three components
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     666 </span>            :   }
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :   return likelihood;</span>
<span class="lineNum">     668 </span>            : 
<a name="669"><span class="lineNum">     669 </span>            : }</a>
<span class="lineNum">     670 </span>            : 
<span class="lineNum">     671 </span>            : Double_t AliESDv0::GetLikelihoodC(Int_t mode0, Int_t /*mode1*/) const {
<span class="lineNum">     672 </span>            :   //
<span class="lineNum">     673 </span>            :   // get likelihood for Causality
<span class="lineNum">     674 </span>            :   // !!!  Causality variables defined in AliITStrackerMI !!! 
<span class="lineNum">     675 </span>            :   //      when more information was available
<span class="lineNum">     676 </span>            :   //  
<span class="lineNum">     677 </span>            :   Double_t likelihood = 0.5;
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :   Double_t minCausal  = TMath::Min(fCausality[0],fCausality[1]);</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   Double_t maxCausal  = TMath::Max(fCausality[0],fCausality[1]);</span>
<span class="lineNum">     680 </span>            :   //  minCausal           = TMath::Max(minCausal,0.5*maxCausal);
<span class="lineNum">     681 </span>            :   //compv0-&gt;fTree-&gt;SetAlias(&quot;LCausal&quot;,&quot;(1.05-(2*(0.8-exp(-max(RC.fV0rec.fCausality[0],RC.fV0rec.fCausality[1])))+2*(0.8-exp(-min(RC.fV0rec.fCausality[0],RC.fV0rec.fCausality[1]))))/2)**4&quot;);
<span class="lineNum">     682 </span>            :   
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :   switch(mode0){</span>
<span class="lineNum">     684 </span>            :   case 0:
<span class="lineNum">     685 </span>            :     //normalization 
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     likelihood = TMath::Power((1.05-2*(0.8-TMath::Exp(-maxCausal))),4.);</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     688 </span>            :   case 1:
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :     likelihood = TMath::Power(1.05-(2*(0.8-TMath::Exp(-maxCausal))+(2*(0.8-TMath::Exp(-minCausal))))*0.5,4.);</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :     break;</span>
<span class="lineNum">     691 </span>            :   }
<span class="lineNum">     692 </span><span class="lineNoCov">          0 :   return likelihood;</span>
<span class="lineNum">     693 </span>            :   
<a name="694"><span class="lineNum">     694 </span>            : }</a>
<span class="lineNum">     695 </span>            : 
<span class="lineNum">     696 </span>            : void AliESDv0::SetCausality(Float_t pb0, Float_t pb1, Float_t pa0, Float_t pa1)
<span class="lineNum">     697 </span>            : {
<span class="lineNum">     698 </span>            :   //
<span class="lineNum">     699 </span>            :   // set probabilities
<span class="lineNum">     700 </span>            :   //
<span class="lineNum">     701 </span><span class="lineCov">         28 :   fCausality[0] = pb0;     // probability - track 0 exist before vertex</span>
<span class="lineNum">     702 </span><span class="lineCov">         14 :   fCausality[1] = pb1;     // probability - track 1 exist before vertex</span>
<span class="lineNum">     703 </span><span class="lineCov">         14 :   fCausality[2] = pa0;     // probability - track 0 exist close after vertex</span>
<a name="704"><span class="lineNum">     704 </span><span class="lineCov">         14 :   fCausality[3] = pa1;     // probability - track 1 exist close after vertex</span></a>
<span class="lineNum">     705 </span><span class="lineCov">         14 : }</span>
<span class="lineNum">     706 </span>            : void  AliESDv0::SetClusters(const Int_t *clp, const Int_t *clm)
<span class="lineNum">     707 </span>            : {
<span class="lineNum">     708 </span>            :   //
<span class="lineNum">     709 </span>            :   // Set its clusters indexes
<span class="lineNum">     710 </span>            :   //
<span class="lineNum">     711 </span><span class="lineCov">        360 :   for (Int_t i=0;i&lt;6;i++) fClusters[0][i] = clp[i]; </span>
<span class="lineNum">     712 </span><span class="lineCov">        336 :   for (Int_t i=0;i&lt;6;i++) fClusters[1][i] = clm[i]; </span>
<a name="713"><span class="lineNum">     713 </span><span class="lineCov">         24 : }</span></a>
<span class="lineNum">     714 </span>            : 
<span class="lineNum">     715 </span>            : Double_t AliESDv0::GetEffMass(UInt_t p1, UInt_t p2) const{
<span class="lineNum">     716 </span>            :   //
<span class="lineNum">     717 </span>            :   // calculate effective mass
<span class="lineNum">     718 </span>            :   //
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :   const Double_t kpmass[5] = {TDatabasePDG::Instance()-&gt;GetParticle(kElectron)-&gt;Mass(),</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :                              TDatabasePDG::Instance()-&gt;GetParticle(kMuonMinus)-&gt;Mass(),</span>
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :                              TDatabasePDG::Instance()-&gt;GetParticle(kPiPlus)-&gt;Mass(),</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :                              TDatabasePDG::Instance()-&gt;GetParticle(kKPlus)-&gt;Mass(),</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :                              TDatabasePDG::Instance()-&gt;GetParticle(kProton)-&gt;Mass()};</span>
<span class="lineNum">     724 </span>            :   /*
<span class="lineNum">     725 </span>            :   if (p1&gt;4) return -1;
<span class="lineNum">     726 </span>            :   if (p2&gt;4) return -1;
<span class="lineNum">     727 </span>            :   Double_t mass1 = kpmass[p1]; 
<span class="lineNum">     728 </span>            :   Double_t mass2 = kpmass[p2];   
<span class="lineNum">     729 </span>            :   const Double_t *m1 = fPmom;
<span class="lineNum">     730 </span>            :   const Double_t *m2 = fNmom;
<span class="lineNum">     731 </span>            :   //
<span class="lineNum">     732 </span>            :   //if (fRP[p1]+fRM[p2]&lt;fRP[p2]+fRM[p1]){
<span class="lineNum">     733 </span>            :   //  m1 = fPM;
<span class="lineNum">     734 </span>            :   //  m2 = fPP;
<span class="lineNum">     735 </span>            :   //}
<span class="lineNum">     736 </span>            :   //
<span class="lineNum">     737 </span>            :   Double_t e1    = TMath::Sqrt(mass1*mass1+
<span class="lineNum">     738 </span>            :                               m1[0]*m1[0]+
<span class="lineNum">     739 </span>            :                               m1[1]*m1[1]+
<span class="lineNum">     740 </span>            :                               m1[2]*m1[2]);
<span class="lineNum">     741 </span>            :   Double_t e2    = TMath::Sqrt(mass2*mass2+
<span class="lineNum">     742 </span>            :                               m2[0]*m2[0]+
<span class="lineNum">     743 </span>            :                               m2[1]*m2[1]+
<span class="lineNum">     744 </span>            :                               m2[2]*m2[2]);  
<span class="lineNum">     745 </span>            :   Double_t mass =  
<span class="lineNum">     746 </span>            :     (m2[0]+m1[0])*(m2[0]+m1[0])+
<span class="lineNum">     747 </span>            :     (m2[1]+m1[1])*(m2[1]+m1[1])+
<span class="lineNum">     748 </span>            :     (m2[2]+m1[2])*(m2[2]+m1[2]);
<span class="lineNum">     749 </span>            :   
<span class="lineNum">     750 </span>            :   mass = (e1+e2)*(e1+e2)-mass;
<span class="lineNum">     751 </span>            :   if (mass &lt; 0.) mass = 0.;
<span class="lineNum">     752 </span>            :   return (TMath::Sqrt(mass));
<span class="lineNum">     753 </span>            :   */
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :   if(p1&gt;4 || p2&gt;4) return -1;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :   return GetEffMassExplicit(kpmass[p1],kpmass[p2]);                            </span>
<a name="756"><span class="lineNum">     756 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     757 </span>            : 
<span class="lineNum">     758 </span>            : Double_t AliESDv0::GetEffMassExplicit(Double_t m1, Double_t m2) const {
<span class="lineNum">     759 </span>            :   //
<span class="lineNum">     760 </span>            :   // calculate effective mass with given masses of decay products
<span class="lineNum">     761 </span>            :   //
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramP = GetParamP();</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramN = GetParamN();</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :   if (paramP-&gt;GetParameter()[4]&lt;0){</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :     paramP=GetParamN();</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     paramN=GetParamP();</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :   Double_t pmom[3]={0}, nmom[3]={0};</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :   paramP-&gt;GetPxPyPz(pmom);</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :   paramN-&gt;GetPxPyPz(nmom);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :   Double_t e12   = m1*m1+pmom[0]*pmom[0]+pmom[1]*pmom[1]+pmom[2]*pmom[2];</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :   Double_t e22   = m2*m2+nmom[0]*nmom[0]+nmom[1]*nmom[1]+nmom[2]*nmom[2];</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :   Double_t cmass = TMath::Sqrt(TMath::Max(m1*m1+m2*m2</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                                           +2.*(TMath::Sqrt(e12*e22)-pmom[0]*nmom[0]-pmom[1]*nmom[1]-pmom[2]*nmom[2]),0.));</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   return cmass;</span>
<span class="lineNum">     776 </span>            :                                
<span class="lineNum">     777 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     778 </span>            : 
<a name="779"><span class="lineNum">     779 </span>            : </a>
<span class="lineNum">     780 </span>            : 
<span class="lineNum">     781 </span>            : Double_t AliESDv0::GetKFInfo(UInt_t p1, UInt_t p2, Int_t type) const{
<span class="lineNum">     782 </span>            :   //
<span class="lineNum">     783 </span>            :   // type:
<span class="lineNum">     784 </span>            :   //   0 - return mass
<span class="lineNum">     785 </span>            :   //   1 - return err mass
<span class="lineNum">     786 </span>            :   //   2 - return chi2
<span class="lineNum">     787 </span>            :   // 
<span class="lineNum">     788 </span>            :   const Int_t spdg[5]={kPositron,kMuonPlus,kPiPlus, kKPlus, kProton};
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramP = GetParamP();</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramN = GetParamN();</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :   if (paramP-&gt;GetSign()&lt;0){</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :     paramP=GetParamN();</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :     paramN=GetParamP();</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :   AliKFParticle kfp1(  *(paramP), spdg[p1] *TMath::Sign(1,p1) );</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :   AliKFParticle kfp2( *(paramN), spdg[p2] *TMath::Sign(1,p2) );</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :   AliKFParticle *v0KF = new AliKFParticle;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :   *(v0KF)+=kfp1;</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :   *(v0KF)+=kfp2;</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :   if (type==0) return v0KF-&gt;GetMass();</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :   if (type==1) return v0KF-&gt;GetErrMass();</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :   if (type==2) return v0KF-&gt;GetChi2();</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :   return 0;</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 : }</span>
<a name="805"><span class="lineNum">     805 </span>            : </a>
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span>            : Double_t AliESDv0::GetKFInfoScale(UInt_t p1, UInt_t p2, Int_t type, Double_t d1pt, Double_t s1pt) const{
<span class="lineNum">     808 </span>            :   //
<span class="lineNum">     809 </span>            :   // type
<span class="lineNum">     810 </span>            :   //   0 - return mass
<span class="lineNum">     811 </span>            :   //   1 - return err mass
<span class="lineNum">     812 </span>            :   //   2 - return chi2
<span class="lineNum">     813 </span>            :   //   d1pt - 1/pt shift
<span class="lineNum">     814 </span>            :   //   s1pt - scaling of 1/pt
<span class="lineNum">     815 </span>            :   // Important function to benchmark the pt resolution, and to find out systematic distortion
<span class="lineNum">     816 </span>            :   //
<span class="lineNum">     817 </span>            :   const Int_t spdg[5]={kPositron,kMuonPlus,kPiPlus, kKPlus, kProton};
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramP = GetParamP();</span>
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :   const AliExternalTrackParam *paramN = GetParamN();</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :   if (paramP-&gt;GetSign()&lt;0){</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     paramP=GetParamP();</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :     paramN=GetParamN();</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :   Double_t *pparam1 = (Double_t*)paramP-&gt;GetParameter();</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :   Double_t *pparam2 = (Double_t*)paramN-&gt;GetParameter();</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :   pparam1[4]+=d1pt;</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :   pparam2[4]+=d1pt;</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :   pparam1[4]*=(1+s1pt);</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :   pparam2[4]*=(1+s1pt);</span>
<span class="lineNum">     830 </span>            :   //
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :   AliKFParticle kfp1( *paramP, spdg[p1] *TMath::Sign(1,p1) );</span>
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :   AliKFParticle kfp2( *paramN, spdg[p2] *TMath::Sign(1,p2) );</span>
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :   AliKFParticle *v0KF = new AliKFParticle;</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :   *(v0KF)+=kfp1;</span>
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :   *(v0KF)+=kfp2;</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :   if (type==0) return v0KF-&gt;GetMass();</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :   if (type==1) return v0KF-&gt;GetErrMass();</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :   if (type==2) return v0KF-&gt;GetChi2();</span>
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :   return 0;</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 : }</span>
<a name="841"><span class="lineNum">     841 </span>            : </a>
<span class="lineNum">     842 </span>            : 
<span class="lineNum">     843 </span>            : AliESDVertex AliESDv0::GetVertex() const{
<span class="lineNum">     844 </span>            :   // Build an AliESDVertex from this AliESDv0
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :   AliESDVertex vtx(fPos,fPosCov,fChi2V0,2);</span>
<span class="lineNum">     846 </span>            :   return vtx;
<span class="lineNum">     847 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     848 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
