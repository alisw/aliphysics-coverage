<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - STEER/STEERBase/AliCheb3D.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">STEER/STEERBase</a> - AliCheb3D.cxx<span style="font-size: 80%;"> (source / <a href="AliCheb3D.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">22</td>
            <td class="headerCovTableEntry">482</td>
            <td class="headerCovTableEntryLo">4.6 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntry">39</td>
            <td class="headerCovTableEntryLo">10.3 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : #include &lt;TString.h&gt;
<span class="lineNum">      17 </span>            : #include &lt;TSystem.h&gt;
<span class="lineNum">      18 </span>            : #include &lt;TROOT.h&gt;
<span class="lineNum">      19 </span>            : #include &lt;TRandom.h&gt;
<span class="lineNum">      20 </span>            : #include &lt;stdio.h&gt;
<span class="lineNum">      21 </span>            : #include &lt;TMethodCall.h&gt;
<span class="lineNum">      22 </span>            : #include &lt;TMath.h&gt;
<span class="lineNum">      23 </span>            : #include &lt;TH1.h&gt;
<span class="lineNum">      24 </span>            : #include &quot;AliCheb3D.h&quot;
<span class="lineNum">      25 </span>            : #include &quot;AliCheb3DCalc.h&quot;
<a name="26"><span class="lineNum">      26 </span>            : #include &quot;AliLog.h&quot;</a>
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span><span class="lineCov">        176 : ClassImp(AliCheb3D)</span>
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            : const Float_t AliCheb3D::fgkMinPrec = 1.e-12f;
<a name="31"><span class="lineNum">      31 </span>            : </a>
<span class="lineNum">      32 </span>            : //__________________________________________________________________________________________
<span class="lineNum">      33 </span><span class="lineCov">      22920 : AliCheb3D::AliCheb3D() : </span>
<span class="lineNum">      34 </span><span class="lineCov">      22920 :   fDimOut(0), </span>
<span class="lineNum">      35 </span><span class="lineCov">      22920 :   fPrec(0), </span>
<span class="lineNum">      36 </span><span class="lineCov">      22920 :   fChebCalc(1), </span>
<span class="lineNum">      37 </span><span class="lineCov">      22920 :   fMaxCoefs(0), </span>
<span class="lineNum">      38 </span><span class="lineCov">      22920 :   fResTmp(0), </span>
<span class="lineNum">      39 </span><span class="lineCov">      22920 :   fGrid(0), </span>
<span class="lineNum">      40 </span><span class="lineCov">      22920 :   fUsrFunName(&quot;&quot;), </span>
<span class="lineNum">      41 </span><span class="lineCov">      22920 :   fUsrMacro(0) </span>
<span class="lineNum">      42 </span><span class="lineCov">     114600 : {</span>
<span class="lineNum">      43 </span>            : // Default constructor
<span class="lineNum">      44 </span><span class="lineCov">     183360 :   for (int i=3;i--;) {</span>
<span class="lineNum">      45 </span><span class="lineCov">      68760 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = fArgsTmp[i] = 0;</span>
<span class="lineNum">      46 </span><span class="lineCov">      68760 :     fNPoints[i] = 0;</span>
<span class="lineNum">      47 </span><span class="lineCov">      68760 :     fGridOffs[i] = 0;</span>
<span class="lineNum">      48 </span>            :   }
<span class="lineNum">      49 </span><span class="lineCov">      45840 : }</span>
<a name="50"><span class="lineNum">      50 </span>            : </a>
<span class="lineNum">      51 </span>            : //__________________________________________________________________________________________
<span class="lineNum">      52 </span>            : AliCheb3D::AliCheb3D(const AliCheb3D&amp; src) : 
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :   TNamed(src),</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :   fDimOut(src.fDimOut), </span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :   fPrec(src.fPrec), </span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">      57 </span><span class="lineNoCov">          0 :   fMaxCoefs(src.fMaxCoefs), </span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :   fResTmp(0),</span>
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :   fUsrFunName(src.fUsrFunName), </span>
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">      62 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      63 </span>            :   // read coefs from text file
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :     fBMin[i]    = src.fBMin[i];</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :     fBMax[i]    = src.fBMax[i];</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :     fBScale[i]  = src.fBScale[i];</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :     fBOffset[i] = src.fBOffset[i];</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :     fNPoints[i] = src.fNPoints[i];</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :     fGridOffs[i] = src.fGridOffs[i];</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">      72 </span>            :   }
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;fDimOut;i++) {</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :     AliCheb3DCalc* cbc = src.GetChebCalc(i);</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :     if (cbc) fChebCalc.AddAtAndExpand(new AliCheb3DCalc(*cbc),i);</span>
<span class="lineNum">      76 </span>            :   }
<span class="lineNum">      77 </span><span class="lineNoCov">          0 : }</span>
<a name="78"><span class="lineNum">      78 </span>            : </a>
<span class="lineNum">      79 </span>            : //__________________________________________________________________________________________
<span class="lineNum">      80 </span><span class="lineNoCov">          0 : AliCheb3D::AliCheb3D(const char* inpFile) : </span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   fPrec(0),  </span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :   fChebCalc(1),</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :   fMaxCoefs(0),  </span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :   fResTmp(0),</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;), </span>
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">      89 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      90 </span>            :   // read coefs from text file
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0;</span>
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">      96 </span>            :   }
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   LoadData(inpFile);</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 : }</span>
<a name="99"><span class="lineNum">      99 </span>            : </a>
<span class="lineNum">     100 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     101 </span><span class="lineNoCov">          0 : AliCheb3D::AliCheb3D(FILE* stream) : </span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :   fPrec(0), </span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :   fMaxCoefs(0),</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :   fResTmp(0),</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :   fGrid(0),</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;),</span>
<span class="lineNum">     109 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     111 </span>            :   // read coefs from stream
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0;</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">     117 </span>            :   }
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :   LoadData(stream);</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     120 </span>            : 
<a name="121"><span class="lineNum">     121 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     122 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     123 </span>            : AliCheb3D::AliCheb3D(const char* funName, int DimOut, const Float_t  *bmin, const Float_t  *bmax, Int_t *npoints, Float_t prec, const Float_t* precD) : 
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :   TNamed(funName,funName), </span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :   fPrec(TMath::Max(fgkMinPrec,prec)), </span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   fMaxCoefs(0), </span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :   fResTmp(0), </span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;) ,</span>
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">     133 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     134 </span>            :   // Construct the parameterization for the function
<span class="lineNum">     135 </span>            :   // funName : name of the file containing the function: void funName(Float_t * inp,Float_t * out)
<span class="lineNum">     136 </span>            :   // DimOut  : dimension of the vector computed by the user function
<span class="lineNum">     137 </span>            :   // bmin    : array of 3 elements with the lower boundaries of the region where the function is defined
<span class="lineNum">     138 </span>            :   // bmax    : array of 3 elements with the upper boundaries of the region where the function is defined
<span class="lineNum">     139 </span>            :   // npoints : array of 3 elements with the number of points to compute in each of 3 dimension
<span class="lineNum">     140 </span>            :   // prec    : max allowed absolute difference between the user function and computed parameterization on the requested grid
<span class="lineNum">     141 </span>            :   // precD   : optional array with precisions per output dimension (if &gt;fgkMinPrec will override common prec)
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :   if (DimOut&lt;1) AliFatalF(&quot;Requested output dimension is %d&quot;,fDimOut);</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0.;</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">     148 </span>            :   }
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   SetDimOut(DimOut,precD);</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   PrepareBoundaries(bmin,bmax);</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   DefineGrid(npoints);</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   SetUsrFunction(funName);</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :   ChebFit();</span>
<span class="lineNum">     154 </span>            :   //
<span class="lineNum">     155 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     156 </span>            : #endif
<span class="lineNum">     157 </span>            : 
<a name="158"><span class="lineNum">     158 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     159 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     160 </span>            : AliCheb3D::AliCheb3D(void (*ptr)(float*,float*), int DimOut, Float_t  *bmin,Float_t  *bmax, Int_t *npoints, Float_t prec, const Float_t* precD) : 
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :   TNamed(&quot;Cheb3D&quot;,&quot;Cheb3D&quot;),</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :   fPrec(TMath::Max(fgkMinPrec,prec)), </span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   fMaxCoefs(0), </span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :   fResTmp(0), </span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;),</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     171 </span>            :   // Construct the parameterization for the function
<span class="lineNum">     172 </span>            :   // ptr     : pointer on the function: void fun(Float_t * inp,Float_t * out)
<span class="lineNum">     173 </span>            :   // DimOut  : dimension of the vector computed by the user function
<span class="lineNum">     174 </span>            :   // bmin    : array of 3 elements with the lower boundaries of the region where the function is defined
<span class="lineNum">     175 </span>            :   // bmax    : array of 3 elements with the upper boundaries of the region where the function is defined
<span class="lineNum">     176 </span>            :   // npoints : array of 3 elements with the number of points to compute in each of 3 dimension
<span class="lineNum">     177 </span>            :   // prec    : max allowed absolute difference between the user function and computed parameterization on the requested grid
<span class="lineNum">     178 </span>            :   // precD   : optional array with precisions per output dimension (if &gt;fgkMinPrec will override common prec)
<span class="lineNum">     179 </span>            :   //
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :   if (DimOut&lt;1) AliFatalF(&quot;Requested output dimension is %d&quot;,fDimOut);</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0.;</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">     186 </span>            :   }
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :   SetDimOut(DimOut,precD);</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :   PrepareBoundaries(bmin,bmax);</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :   DefineGrid(npoints);</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :   SetUsrFunction(ptr);</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :   ChebFit();</span>
<span class="lineNum">     192 </span>            :   //
<span class="lineNum">     193 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     194 </span>            : #endif
<span class="lineNum">     195 </span>            : 
<a name="196"><span class="lineNum">     196 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     197 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     198 </span>            : AliCheb3D::AliCheb3D(void (*ptr)(float*,float*), int DimOut, Float_t  *bmin,Float_t  *bmax, Int_t *npX,Int_t *npY,Int_t *npZ, Float_t prec, const Float_t* precD) : 
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :   TNamed(&quot;Cheb3D&quot;,&quot;Cheb3D&quot;),</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :   fPrec(TMath::Max(fgkMinPrec,prec)), </span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :   fMaxCoefs(0), </span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :   fResTmp(0), </span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;),</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     209 </span>            :   // Construct very economic  parameterization for the function
<span class="lineNum">     210 </span>            :   // ptr     : pointer on the function: void fun(Float_t * inp,Float_t * out)
<span class="lineNum">     211 </span>            :   // DimOut  : dimension of the vector computed by the user function
<span class="lineNum">     212 </span>            :   // bmin    : array of 3 elements with the lower boundaries of the region where the function is defined
<span class="lineNum">     213 </span>            :   // bmax    : array of 3 elements with the upper boundaries of the region where the function is defined
<span class="lineNum">     214 </span>            :   // npX     : array of 3 elements with the number of points to compute in each dimension for 1st component 
<span class="lineNum">     215 </span>            :   // npY     : array of 3 elements with the number of points to compute in each dimension for 2nd component 
<span class="lineNum">     216 </span>            :   // npZ     : array of 3 elements with the number of points to compute in each dimension for 3d  component 
<span class="lineNum">     217 </span>            :   // prec    : max allowed absolute difference between the user function and computed parameterization on the requested grid
<span class="lineNum">     218 </span>            :   // precD   : optional array with precisions per output dimension (if &gt;fgkMinPrec will override common prec)
<span class="lineNum">     219 </span>            :   //
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :   if (DimOut&lt;1) AliFatalF(&quot;Requested output dimension is %d&quot;,fDimOut);</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0.;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">     226 </span>            :   }
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :   SetDimOut(DimOut,precD);</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :   PrepareBoundaries(bmin,bmax);</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :   SetUsrFunction(ptr);</span>
<span class="lineNum">     230 </span>            :   //
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   DefineGrid(npX);</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :   ChebFit(0);</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   DefineGrid(npY);</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :   ChebFit(1);</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :   DefineGrid(npZ);</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :   ChebFit(2);</span>
<span class="lineNum">     237 </span>            :   //
<span class="lineNum">     238 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     239 </span>            : #endif
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            : 
<a name="242"><span class="lineNum">     242 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     243 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     244 </span>            : AliCheb3D::AliCheb3D(void (*ptr)(float*,float*), int DimOut, Float_t  *bmin,Float_t  *bmax, Float_t prec, Bool_t run, const Float_t* precD) : 
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :   TNamed(&quot;Cheb3D&quot;,&quot;Cheb3D&quot;),</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   fDimOut(0), </span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :   fPrec(TMath::Max(fgkMinPrec,prec)), </span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :   fChebCalc(1), </span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :   fMaxCoefs(0), </span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :   fResTmp(0), </span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :   fGrid(0), </span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :   fUsrFunName(&quot;&quot;),</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :   fUsrMacro(0)</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     255 </span>            :   // Construct very economic  parameterization for the function with automatic calculation of the root's grid
<span class="lineNum">     256 </span>            :   // ptr     : pointer on the function: void fun(Float_t * inp,Float_t * out)
<span class="lineNum">     257 </span>            :   // DimOut  : dimension of the vector computed by the user function
<span class="lineNum">     258 </span>            :   // bmin    : array of 3 elements with the lower boundaries of the region where the function is defined
<span class="lineNum">     259 </span>            :   // bmax    : array of 3 elements with the upper boundaries of the region where the function is defined
<span class="lineNum">     260 </span>            :   // prec    : max allowed absolute difference between the user function and computed parameterization on the requested grid
<span class="lineNum">     261 </span>            :   // precD   : optional array with precisions per output dimension (if &gt;fgkMinPrec will override common prec)
<span class="lineNum">     262 </span>            :   //
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :   if (DimOut!=3) AliFatalF(&quot;This constructor works only for 3D fits, %dD fit was requested&quot;,fDimOut);</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   if (DimOut&lt;1)  AliFatalF(&quot;Requested output dimension is %d&quot;,fDimOut);</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :     fBMin[i] = fBMax[i] = fBScale[i] = fBOffset[i] = 0;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     fNPoints[i] = 0;</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :     fGridOffs[i] = 0.;</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     fArgsTmp[i]  = 0;</span>
<span class="lineNum">     270 </span>            :   }
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :   SetDimOut(DimOut,precD);</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :   PrepareBoundaries(bmin,bmax);</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   SetUsrFunction(ptr);</span>
<span class="lineNum">     274 </span>            :   //
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :   if (run) {</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     int gridNC[3][3];</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     EstimateNPoints(prec,gridNC);</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :     DefineGrid(gridNC[0]);</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     ChebFit(0);</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :     DefineGrid(gridNC[1]);</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :     ChebFit(1);</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :     DefineGrid(gridNC[2]);</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :     ChebFit(2);</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     285 </span>            :   //
<span class="lineNum">     286 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     287 </span>            : #endif
<span class="lineNum">     288 </span>            : 
<a name="289"><span class="lineNum">     289 </span>            : </a>
<span class="lineNum">     290 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     291 </span>            : AliCheb3D&amp; AliCheb3D::operator=(const AliCheb3D&amp; rhs)
<span class="lineNum">     292 </span>            : {
<span class="lineNum">     293 </span>            :   // assignment operator
<span class="lineNum">     294 </span>            :   //
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :   if (this != &amp;rhs) {</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     Clear();</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :     fDimOut   = rhs.fDimOut;</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :     fPrec     = rhs.fPrec;</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :     fMaxCoefs = rhs.fMaxCoefs;</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :     fUsrFunName = rhs.fUsrFunName;</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :     fUsrMacro   = 0;</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :     for (int i=3;i--;) {</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :       fBMin[i]    = rhs.fBMin[i];</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :       fBMax[i]    = rhs.fBMax[i];</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :       fBScale[i]  = rhs.fBScale[i];</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :       fBOffset[i] = rhs.fBOffset[i];</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       fNPoints[i] = rhs.fNPoints[i];</span>
<span class="lineNum">     308 </span>            :     } 
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :     for (int i=0;i&lt;fDimOut;i++) {</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :       AliCheb3DCalc* cbc = rhs.GetChebCalc(i);</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       if (cbc) fChebCalc.AddAtAndExpand(new AliCheb3DCalc(*cbc),i);</span>
<span class="lineNum">     312 </span>            :     }    
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :   return *this;</span>
<span class="lineNum">     315 </span>            :   //
<span class="lineNum">     316 </span><span class="lineNoCov">          0 : }</span>
<a name="317"><span class="lineNum">     317 </span>            : </a>
<span class="lineNum">     318 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     319 </span>            : void AliCheb3D::Clear(const Option_t*)
<span class="lineNum">     320 </span>            : {
<span class="lineNum">     321 </span>            :   // clear all dynamic structures
<span class="lineNum">     322 </span>            :   //
<span class="lineNum">     323 </span><span class="lineCov">      45840 :   if (fResTmp)        { delete[] fResTmp; fResTmp = 0; }</span>
<span class="lineNum">     324 </span><span class="lineCov">      22920 :   if (fGrid)          { delete[] fGrid;   fGrid   = 0; }</span>
<span class="lineNum">     325 </span><span class="lineCov">      22920 :   if (fUsrMacro)      { delete fUsrMacro; fUsrMacro = 0;}</span>
<span class="lineNum">     326 </span><span class="lineCov">      22920 :   fChebCalc.SetOwner(kTRUE);</span>
<span class="lineNum">     327 </span><span class="lineCov">      22920 :   fChebCalc.Delete();</span>
<span class="lineNum">     328 </span>            :   //
<span class="lineNum">     329 </span><span class="lineCov">      22920 : }</span>
<a name="330"><span class="lineNum">     330 </span>            : </a>
<span class="lineNum">     331 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     332 </span>            : void AliCheb3D::Print(const Option_t* opt) const
<span class="lineNum">     333 </span>            : {
<span class="lineNum">     334 </span>            :   // print info
<span class="lineNum">     335 </span>            :   //
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   printf(&quot;%s: Chebyshev parameterization for 3D-&gt;%dD function. Precision: %e\n&quot;,GetName(),fDimOut,fPrec);</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :   printf(&quot;Region of validity: [%+.5e:%+.5e] [%+.5e:%+.5e] [%+.5e:%+.5e]\n&quot;,fBMin[0],fBMax[0],fBMin[1],fBMax[1],fBMin[2],fBMax[2]);</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :   TString opts = opt; opts.ToLower();</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :   if (opts.Contains(&quot;l&quot;)) for (int i=0;i&lt;fDimOut;i++) {printf(&quot;Output dimension %d:\n&quot;,i+1); GetChebCalc(i)-&gt;Print();}</span>
<span class="lineNum">     340 </span>            :   //
<span class="lineNum">     341 </span><span class="lineNoCov">          0 : }</span>
<a name="342"><span class="lineNum">     342 </span>            : </a>
<span class="lineNum">     343 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     344 </span>            : void AliCheb3D::PrepareBoundaries(const Float_t  *bmin, const Float_t  *bmax)
<span class="lineNum">     345 </span>            : {
<span class="lineNum">     346 </span>            :   // Set and check boundaries defined by user, prepare coefficients for their conversion to [-1:1] interval
<span class="lineNum">     347 </span>            :   //
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) {</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :     fBMin[i]   = bmin[i];</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :     fBMax[i]   = bmax[i];</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :     fBScale[i] = bmax[i]-bmin[i];</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :     if (fBScale[i]&lt;=0) { </span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :       AliFatalF(&quot;Boundaries for %d-th dimension are not increasing: %+.4e %+.4e\nStop\n&quot;,i,fBMin[i],fBMax[i]);</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :     fBOffset[i] = bmin[i] + fBScale[i]/2.0;</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :     fBScale[i] = 2./fBScale[i];</span>
<span class="lineNum">     357 </span>            :   }
<span class="lineNum">     358 </span>            :   //
<span class="lineNum">     359 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     360 </span>            : 
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            : //__________________________________________________________________________________________
<span class="lineNum">     363 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span>            : // Pointer on user function (faster altrnative to TMethodCall)
<a name="366"><span class="lineNum">     366 </span>            : void (*gUsrFunAliCheb3D) (float* ,float* );</a>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span>            : void AliCheb3D::EvalUsrFunction() 
<span class="lineNum">     369 </span>            : {
<span class="lineNum">     370 </span>            :   // call user supplied function
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :   if   (gUsrFunAliCheb3D) gUsrFunAliCheb3D(fArgsTmp,fResTmp);</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :   else fUsrMacro-&gt;Execute(); </span>
<a name="373"><span class="lineNum">     373 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     374 </span>            : 
<span class="lineNum">     375 </span>            : void AliCheb3D::SetUsrFunction(const char* name)
<span class="lineNum">     376 </span>            : {
<span class="lineNum">     377 </span>            :   // load user macro with function definition and compile it
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   gUsrFunAliCheb3D = 0; </span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :   fUsrFunName = name;</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :   gSystem-&gt;ExpandPathName(fUsrFunName);</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :   if (fUsrMacro) delete fUsrMacro;</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :   TString tmpst = fUsrFunName;</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   tmpst += &quot;+&quot;; // prepare filename to compile</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :   if (gROOT-&gt;LoadMacro(tmpst.Data())) AliFatalF(&quot;Failed to load user function from %s&quot;,name);</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :   fUsrMacro = new TMethodCall();        </span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :   tmpst = tmpst.Data() + tmpst.Last('/')+1; //Strip away any path preceding the macro file name</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :   int dot = tmpst.Last('.');</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :   if (dot&gt;0) tmpst.Resize(dot);</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   fUsrMacro-&gt;InitWithPrototype(tmpst.Data(),&quot;Float_t *,Float_t *&quot;);</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :   long args[2];</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   args[0] = (long)fArgsTmp;</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :   args[1] = (long)fResTmp;</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   fUsrMacro-&gt;SetParamPtrs(args); </span>
<span class="lineNum">     394 </span>            :   //
<span class="lineNum">     395 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     396 </span>            : #endif
<span class="lineNum">     397 </span>            : 
<a name="398"><span class="lineNum">     398 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     399 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     400 </span>            : void AliCheb3D::SetUsrFunction(void (*ptr)(float*,float*))
<span class="lineNum">     401 </span>            : {
<span class="lineNum">     402 </span>            :   // assign user training function
<span class="lineNum">     403 </span>            :   //
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :   if (fUsrMacro) delete fUsrMacro;</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :   fUsrMacro = 0;</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :   fUsrFunName = &quot;&quot;;</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :   gUsrFunAliCheb3D = ptr;</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     409 </span>            : #endif
<span class="lineNum">     410 </span>            : 
<a name="411"><span class="lineNum">     411 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     412 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     413 </span>            : void AliCheb3D::EvalUsrFunction(const Float_t  *x, Float_t  *res) 
<span class="lineNum">     414 </span>            : {
<span class="lineNum">     415 </span>            :   // evaluate user function value
<span class="lineNum">     416 </span>            :   //
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :   for (int i=3;i--;) fArgsTmp[i] = x[i];</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :   if   (gUsrFunAliCheb3D) gUsrFunAliCheb3D(fArgsTmp,fResTmp);</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :   else fUsrMacro-&gt;Execute(); </span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :   for (int i=fDimOut;i--;) res[i] = fResTmp[i];</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     422 </span>            : #endif
<span class="lineNum">     423 </span>            : 
<a name="424"><span class="lineNum">     424 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     425 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     426 </span>            : Int_t AliCheb3D::CalcChebCoefs(const Float_t  *funval,int np, Float_t  *outCoefs, Float_t  prec)
<span class="lineNum">     427 </span>            : {
<span class="lineNum">     428 </span>            :   // Calculate Chebyshev coeffs using precomputed function values at np roots.
<span class="lineNum">     429 </span>            :   // If prec&gt;0, estimate the highest coeff number providing the needed precision
<span class="lineNum">     430 </span>            :   //
<span class="lineNum">     431 </span>            :   double sm;                 // do summations in double to minimize the roundoff error
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :   for (int ic=0;ic&lt;np;ic++) { // compute coeffs</span>
<span class="lineNum">     433 </span>            :     sm = 0;          
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :     for (int ir=0;ir&lt;np;ir++) {</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :       float  rt = TMath::Cos( ic*(ir+0.5)*TMath::Pi()/np);</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :       sm += funval[ir]*rt;</span>
<span class="lineNum">     437 </span>            :     }
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :     outCoefs[ic] = Float_t( sm * ((ic==0) ? 1./np : 2./np) );</span>
<span class="lineNum">     439 </span>            :   }
<span class="lineNum">     440 </span>            :   //
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   if (prec&lt;=0) return np;</span>
<span class="lineNum">     442 </span>            :   //
<span class="lineNum">     443 </span>            :   sm = 0;
<span class="lineNum">     444 </span>            :   int cfMax = 0;
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :   for (cfMax=np;cfMax--;) {</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     sm += TMath::Abs(outCoefs[cfMax]);</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     if (sm&gt;=prec) break;</span>
<span class="lineNum">     448 </span>            :   }
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :   if (++cfMax==0) cfMax=1;</span>
<span class="lineNum">     450 </span>            :   return cfMax;
<span class="lineNum">     451 </span>            :   //
<span class="lineNum">     452 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     453 </span>            : #endif
<span class="lineNum">     454 </span>            : 
<a name="455"><span class="lineNum">     455 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     456 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     457 </span>            : void AliCheb3D::DefineGrid(Int_t* npoints)
<span class="lineNum">     458 </span>            : {
<span class="lineNum">     459 </span>            :   // prepare the grid of Chebyshev roots in each dimension
<span class="lineNum">     460 </span>            :   const int kMinPoints = 1;
<span class="lineNum">     461 </span>            :   int ntot = 0;
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :   fMaxCoefs = 1;</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :   for (int id=3;id--;) { </span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :     fNPoints[id] = npoints[id];</span>
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :     if (fNPoints[id]&lt;kMinPoints) AliFatalF(&quot;at %d-th dimension %d point is requested, at least %d is needed&quot;,id,fNPoints[id],kMinPoints);</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :     ntot += fNPoints[id];</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :     fMaxCoefs *= fNPoints[id];</span>
<span class="lineNum">     468 </span>            :   }
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :   printf(&quot;Computing Chebyshev nodes on [%2d/%2d/%2d] grid\n&quot;,npoints[0],npoints[1],npoints[2]);</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :   if (fGrid) delete[] fGrid;</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :   fGrid = new Float_t [ntot];</span>
<span class="lineNum">     472 </span>            :   //
<span class="lineNum">     473 </span>            :   int curp = 0;
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :   for (int id=3;id--;) { </span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :     int np = fNPoints[id];</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :     fGridOffs[id] = curp;</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :     for (int ip=0;ip&lt;np;ip++) {</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :       Float_t x = TMath::Cos( TMath::Pi()*(ip+0.5)/np );</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :       fGrid[curp++] = MapToExternal(x,id);</span>
<span class="lineNum">     480 </span>            :     }
<span class="lineNum">     481 </span>            :   }
<span class="lineNum">     482 </span>            :   //
<span class="lineNum">     483 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     484 </span>            : #endif
<span class="lineNum">     485 </span>            : 
<a name="486"><span class="lineNum">     486 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     487 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     488 </span>            : Int_t AliCheb3D::ChebFit()
<span class="lineNum">     489 </span>            : {
<span class="lineNum">     490 </span>            :   // prepare parameterization for all output dimensions
<span class="lineNum">     491 </span>            :   int ir=0; 
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :   for (int i=fDimOut;i--;) ir+=ChebFit(i); </span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :   return ir;</span>
<span class="lineNum">     494 </span>            : }
<span class="lineNum">     495 </span>            : #endif
<span class="lineNum">     496 </span>            : 
<a name="497"><span class="lineNum">     497 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     498 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     499 </span>            : Int_t AliCheb3D::ChebFit(int dmOut)
<span class="lineNum">     500 </span>            : {
<span class="lineNum">     501 </span>            :   // prepare paramaterization of 3D function for dmOut-th dimension 
<span class="lineNum">     502 </span>            :   int maxDim = 0;
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) if (maxDim&lt;fNPoints[i]) maxDim = fNPoints[i];</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :   Float_t  *fvals      = new Float_t [ fNPoints[0] ];</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :   Float_t  *tmpCoef3D  = new Float_t [ fNPoints[0]*fNPoints[1]*fNPoints[2] ]; </span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :   Float_t  *tmpCoef2D  = new Float_t [ fNPoints[0]*fNPoints[1] ]; </span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :   Float_t  *tmpCoef1D  = new Float_t [ maxDim ];</span>
<span class="lineNum">     508 </span>            :   //
<span class="lineNum">     509 </span>            :   // 1D Cheb.fit for 0-th dimension at current steps of remaining dimensions
<span class="lineNum">     510 </span>            :   int ncmax = 0;
<span class="lineNum">     511 </span>            :   //
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :   printf(&quot;Dim%d : 00.00%% Done&quot;,dmOut);fflush(stdout);</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :   AliCheb3DCalc* cheb =  GetChebCalc(dmOut);</span>
<span class="lineNum">     514 </span>            :   //
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :   Float_t prec = cheb-&gt;GetPrecision(); </span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :   if (prec&lt;fgkMinPrec) prec = fPrec;         // no specific precision for this dim.</span>
<span class="lineNum">     517 </span>            :   //
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :   Float_t rTiny = 0.1*prec/Float_t(maxDim); // neglect coefficient below this threshold</span>
<span class="lineNum">     519 </span>            :   //
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :   float ncals2count = fNPoints[2]*fNPoints[1]*fNPoints[0];</span>
<span class="lineNum">     521 </span>            :   float ncals = 0;
<span class="lineNum">     522 </span>            :   float frac = 0;
<span class="lineNum">     523 </span>            :   float fracStep = 0.001;
<span class="lineNum">     524 </span>            :   //
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :   for (int id2=fNPoints[2];id2--;) {</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :     fArgsTmp[2] = fGrid[ fGridOffs[2]+id2 ];</span>
<span class="lineNum">     527 </span>            :     //
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     for (int id1=fNPoints[1];id1--;) {</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :       fArgsTmp[1] = fGrid[ fGridOffs[1]+id1 ];</span>
<span class="lineNum">     530 </span>            :       //
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :       for (int id0=fNPoints[0];id0--;) {</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :         fArgsTmp[0] = fGrid[ fGridOffs[0]+id0 ];</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :         EvalUsrFunction();     // compute function values at Chebyshev roots of 0-th dimension</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :         fvals[id0] =  fResTmp[dmOut];</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :         float fr = (++ncals)/ncals2count;</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :         if (fr-frac&gt;=fracStep) {</span>
<span class="lineNum">     537 </span>            :           frac = fr;
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :           printf(&quot;\b\b\b\b\b\b\b\b\b\b\b&quot;);</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :           printf(&quot;%05.2f%% Done&quot;,fr*100);</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :           fflush(stdout);</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     542 </span>            :         //
<span class="lineNum">     543 </span>            :       }
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :       int nc = CalcChebCoefs(fvals,fNPoints[0], tmpCoef1D, prec);</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :       for (int id0=fNPoints[0];id0--;) tmpCoef2D[id1 + id0*fNPoints[1]] = tmpCoef1D[id0];</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :       if (ncmax&lt;nc) ncmax = nc;              // max coefs to be kept in dim0 to guarantee needed precision</span>
<span class="lineNum">     547 </span>            :     }
<span class="lineNum">     548 </span>            :     //
<span class="lineNum">     549 </span>            :     // once each 1d slice of given 2d slice is parametrized, parametrize the Cheb.coeffs
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :     for (int id0=fNPoints[0];id0--;) {</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :       CalcChebCoefs( tmpCoef2D+id0*fNPoints[1], fNPoints[1], tmpCoef1D, -1);</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :       for (int id1=fNPoints[1];id1--;) tmpCoef3D[id2 + fNPoints[2]*(id1+id0*fNPoints[1])] = tmpCoef1D[id1];</span>
<span class="lineNum">     553 </span>            :     }
<span class="lineNum">     554 </span>            :   }
<span class="lineNum">     555 </span>            :   //
<span class="lineNum">     556 </span>            :   // now fit the last dimensions Cheb.coefs
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :   for (int id0=fNPoints[0];id0--;) {</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :     for (int id1=fNPoints[1];id1--;) {</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :       CalcChebCoefs( tmpCoef3D+ fNPoints[2]*(id1+id0*fNPoints[1]), fNPoints[2], tmpCoef1D, -1);</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :       for (int id2=fNPoints[2];id2--;) tmpCoef3D[id2+ fNPoints[2]*(id1+id0*fNPoints[1])] = tmpCoef1D[id2]; // store on place</span>
<span class="lineNum">     561 </span>            :     }
<span class="lineNum">     562 </span>            :   }
<span class="lineNum">     563 </span>            :   //
<span class="lineNum">     564 </span>            :   // now find 2D surface which separates significant coefficients of 3D matrix from nonsignificant ones (up to prec)
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :   UShort_t *tmpCoefSurf = new UShort_t[ fNPoints[0]*fNPoints[1] ];</span>
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :   for (int id0=fNPoints[0];id0--;) for (int id1=fNPoints[1];id1--;) tmpCoefSurf[id1+id0*fNPoints[1]]=0;  </span>
<span class="lineNum">     567 </span>            :   Double_t resid = 0;
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :   for (int id0=fNPoints[0];id0--;) {</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     for (int id1=fNPoints[1];id1--;) {</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :       for (int id2=fNPoints[2];id2--;) {</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :         int id = id2 + fNPoints[2]*(id1+id0*fNPoints[1]);</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :         Float_t  cfa = TMath::Abs(tmpCoef3D[id]);</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         if (cfa &lt; rTiny) {tmpCoef3D[id] = 0; continue;} // neglect coefs below the threshold</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :         resid += cfa;</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :         if (resid&lt;prec) continue; // this coeff is negligible</span>
<span class="lineNum">     576 </span>            :         // otherwise go back 1 step
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :         resid -= cfa;</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :         tmpCoefSurf[id1+id0*fNPoints[1]] = id2+1; // how many coefs to keep</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     580 </span>            :       }
<span class="lineNum">     581 </span>            :     }
<span class="lineNum">     582 </span>            :   }
<span class="lineNum">     583 </span>            :   /*
<span class="lineNum">     584 </span>            :   printf(&quot;\n\nCoeffs\n&quot;);  
<span class="lineNum">     585 </span>            :   int cnt = 0;
<span class="lineNum">     586 </span>            :   for (int id0=0;id0&lt;fNPoints[0];id0++) {
<span class="lineNum">     587 </span>            :     for (int id1=0;id1&lt;fNPoints[1];id1++) {
<span class="lineNum">     588 </span>            :       for (int id2=0;id2&lt;fNPoints[2];id2++) {
<span class="lineNum">     589 </span>            :         printf(&quot;%2d%2d%2d %+.4e |&quot;,id0,id1,id2,tmpCoef3D[cnt++]);
<span class="lineNum">     590 </span>            :       }
<span class="lineNum">     591 </span>            :       printf(&quot;\n&quot;);
<span class="lineNum">     592 </span>            :     }
<span class="lineNum">     593 </span>            :     printf(&quot;\n&quot;);
<span class="lineNum">     594 </span>            :   }
<span class="lineNum">     595 </span>            :   */
<span class="lineNum">     596 </span>            :   // see if there are rows to reject, find max.significant column at each row
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :   int nRows = fNPoints[0];</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :   UShort_t *tmpCols = new UShort_t[nRows]; </span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :   for (int id0=fNPoints[0];id0--;) {</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :     int id1 = fNPoints[1];</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :     while (id1&gt;0 &amp;&amp; tmpCoefSurf[(id1-1)+id0*fNPoints[1]]==0) id1--;</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :     tmpCols[id0] = id1;</span>
<span class="lineNum">     603 </span>            :   }
<span class="lineNum">     604 </span>            :   // find max significant row
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :   for (int id0=nRows;id0--;) {if (tmpCols[id0]&gt;0) break; nRows--;}</span>
<span class="lineNum">     606 </span>            :   // find max significant column and fill the permanent storage for the max sigificant column of each row
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :   cheb-&gt;InitRows(nRows);                  // create needed arrays;</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :   UShort_t *nColsAtRow = cheb-&gt;GetNColsAtRow();</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :   UShort_t *colAtRowBg = cheb-&gt;GetColAtRowBg();</span>
<span class="lineNum">     610 </span>            :   int nCols = 0;
<span class="lineNum">     611 </span>            :   int nElemBound2D = 0;
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :   for (int id0=0;id0&lt;nRows;id0++) {</span>
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :     nColsAtRow[id0] = tmpCols[id0];     // number of columns to store for this row</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     colAtRowBg[id0] = nElemBound2D;     // begining of this row in 2D boundary surface</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     nElemBound2D += tmpCols[id0];</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     if (nCols&lt;nColsAtRow[id0]) nCols = nColsAtRow[id0];</span>
<span class="lineNum">     617 </span>            :   }
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :   cheb-&gt;InitCols(nCols);</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :   delete[] tmpCols;</span>
<span class="lineNum">     620 </span>            :   //  
<span class="lineNum">     621 </span>            :   // create the 2D matrix defining the boundary of significance for 3D coeffs.matrix 
<span class="lineNum">     622 </span>            :   // and count the number of siginifacnt coefficients
<span class="lineNum">     623 </span>            :   //
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :   cheb-&gt;InitElemBound2D(nElemBound2D);</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :   UShort_t *coefBound2D0 = cheb-&gt;GetCoefBound2D0();</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :   UShort_t *coefBound2D1 = cheb-&gt;GetCoefBound2D1();</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :   fMaxCoefs = 0; // redefine number of coeffs</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :   for (int id0=0;id0&lt;nRows;id0++) {</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     int nCLoc = nColsAtRow[id0];</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :     int col0  = colAtRowBg[id0];</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :     for (int id1=0;id1&lt;nCLoc;id1++) {</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :       coefBound2D0[col0 + id1] = tmpCoefSurf[id1+id0*fNPoints[1]];  // number of coefs to store for 3-d dimension</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :       coefBound2D1[col0 + id1] = fMaxCoefs;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :       fMaxCoefs += coefBound2D0[col0 + id1];</span>
<span class="lineNum">     635 </span>            :     }
<span class="lineNum">     636 </span>            :   }
<span class="lineNum">     637 </span>            :   //
<span class="lineNum">     638 </span>            :   // create final compressed 3D matrix for significant coeffs
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :   cheb-&gt;InitCoefs(fMaxCoefs);</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :   Float_t  *coefs = cheb-&gt;GetCoefs();</span>
<span class="lineNum">     641 </span>            :   int count = 0;
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :   for (int id0=0;id0&lt;nRows;id0++) {</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :     int ncLoc = nColsAtRow[id0];</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :     int col0  = colAtRowBg[id0];</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     for (int id1=0;id1&lt;ncLoc;id1++) {</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :       int ncf2 = coefBound2D0[col0 + id1];</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :       for (int id2=0;id2&lt;ncf2;id2++) {</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :         coefs[count++] = tmpCoef3D[id2 + fNPoints[2]*(id1+id0*fNPoints[1])];</span>
<span class="lineNum">     649 </span>            :       }
<span class="lineNum">     650 </span>            :     }
<span class="lineNum">     651 </span>            :   }
<span class="lineNum">     652 </span>            :   /*
<span class="lineNum">     653 </span>            :   printf(&quot;\n\nNewSurf\n&quot;);
<span class="lineNum">     654 </span>            :   for (int id0=0;id0&lt;fNPoints[0];id0++) {
<span class="lineNum">     655 </span>            :     for (int id1=0;id1&lt;fNPoints[1];id1++) {
<span class="lineNum">     656 </span>            :       printf(&quot;(%2d %2d) %2d |&quot;,id0,id1,tmpCoefSurf[id1+id0*fNPoints[1]]);  
<span class="lineNum">     657 </span>            :     }
<span class="lineNum">     658 </span>            :     printf(&quot;\n&quot;);
<span class="lineNum">     659 </span>            :   }
<span class="lineNum">     660 </span>            :   */
<span class="lineNum">     661 </span>            :   //
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :   delete[] tmpCoefSurf;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :   delete[] tmpCoef1D;</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :   delete[] tmpCoef2D;</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :   delete[] tmpCoef3D;</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :   delete[] fvals;</span>
<span class="lineNum">     667 </span>            :   //
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :   printf(&quot;\b\b\b\b\b\b\b\b\b\b\b\b&quot;);</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :   printf(&quot;100.00%% Done\n&quot;);</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :   return 1;</span>
<span class="lineNum">     671 </span>            : }
<span class="lineNum">     672 </span>            : #endif
<span class="lineNum">     673 </span>            : 
<a name="674"><span class="lineNum">     674 </span>            : //_______________________________________________</a>
<span class="lineNum">     675 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     676 </span>            : void AliCheb3D::SaveData(const char* outfile,Bool_t append) const
<span class="lineNum">     677 </span>            : {
<span class="lineNum">     678 </span>            :   // writes coefficients data to output text file, optionallt appending on the end of existing file
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   TString strf = outfile;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   gSystem-&gt;ExpandPathName(strf);</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :   FILE* stream = fopen(strf,append ? &quot;a&quot;:&quot;w&quot;);</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :   SaveData(stream);</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :   fclose(stream);</span>
<span class="lineNum">     684 </span>            :   //
<span class="lineNum">     685 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     686 </span>            : #endif
<span class="lineNum">     687 </span>            : 
<a name="688"><span class="lineNum">     688 </span>            : //_______________________________________________</a>
<span class="lineNum">     689 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     690 </span>            : void AliCheb3D::SaveData(FILE* stream) const
<span class="lineNum">     691 </span>            : {
<span class="lineNum">     692 </span>            :   // writes coefficients data to existing output stream
<span class="lineNum">     693 </span>            :   //
<span class="lineNum">     694 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;\n# These are automatically generated data for the Chebyshev interpolation of 3D-&gt;%dD function\n&quot;,fDimOut); </span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;#\nSTART %s\n&quot;,GetName());</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;# Dimensionality of the output\n%d\n&quot;,fDimOut);</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;# Interpolation abs. precision\n%+.8e\n&quot;,fPrec);</span>
<span class="lineNum">     698 </span>            :   //
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;# Lower boundaries of interpolation region\n&quot;);</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) fprintf(stream,&quot;%+.8e\n&quot;,fBMin[i]);</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;# Upper boundaries of interpolation region\n&quot;);</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) fprintf(stream,&quot;%+.8e\n&quot;,fBMax[i]);</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;# Parameterization for each output dimension follows:\n&quot;);</span>
<span class="lineNum">     704 </span>            :   //
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;fDimOut;i++) GetChebCalc(i)-&gt;SaveData(stream);</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :   fprintf(stream,&quot;#\nEND %s\n#\n&quot;,GetName());</span>
<span class="lineNum">     707 </span>            :   //
<span class="lineNum">     708 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     709 </span>            : #endif
<span class="lineNum">     710 </span>            : 
<a name="711"><span class="lineNum">     711 </span>            : //__________________________________________________________________________________________</a>
<span class="lineNum">     712 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     713 </span>            : void AliCheb3D::InvertSign()
<span class="lineNum">     714 </span>            : {
<span class="lineNum">     715 </span>            :   // invert the sign of all parameterizations
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :   for (int i=fDimOut;i--;) {</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     AliCheb3DCalc* par =  GetChebCalc(i);</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     int ncf = par-&gt;GetNCoefs();</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :     float *coefs = par-&gt;GetCoefs();</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :     for (int j=ncf;j--;) coefs[j] = -coefs[j];</span>
<span class="lineNum">     721 </span>            :   }
<span class="lineNum">     722 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     723 </span>            : #endif
<span class="lineNum">     724 </span>            : 
<a name="725"><span class="lineNum">     725 </span>            : </a>
<span class="lineNum">     726 </span>            : //_______________________________________________
<span class="lineNum">     727 </span>            : void AliCheb3D::LoadData(const char* inpFile)
<span class="lineNum">     728 </span>            : {
<span class="lineNum">     729 </span>            :   // load coefficients data from txt file
<span class="lineNum">     730 </span>            :   //
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :   TString strf = inpFile;</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :   gSystem-&gt;ExpandPathName(strf);</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :   FILE* stream = fopen(strf.Data(),&quot;r&quot;);</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :   LoadData(stream);</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :   fclose(stream);</span>
<span class="lineNum">     736 </span>            :   //
<span class="lineNum">     737 </span><span class="lineNoCov">          0 : }</span>
<a name="738"><span class="lineNum">     738 </span>            : </a>
<span class="lineNum">     739 </span>            : //_______________________________________________
<span class="lineNum">     740 </span>            : void AliCheb3D::LoadData(FILE* stream)
<span class="lineNum">     741 </span>            : {
<span class="lineNum">     742 </span>            :   // load coefficients data from stream
<span class="lineNum">     743 </span>            :   //
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :   if (!stream) AliFatal(&quot;No stream provided&quot;);</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :   TString buffs;</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :   Clear();</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :   AliCheb3DCalc::ReadLine(buffs,stream);</span>
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :   if (!buffs.BeginsWith(&quot;START&quot;)) AliFatalF(&quot;Expected: \&quot;START &lt;fit_name&gt;\&quot;, found \&quot;%s\&quot;&quot;,buffs.Data());</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :   SetName(buffs.Data()+buffs.First(' ')+1);</span>
<span class="lineNum">     750 </span>            :   //
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :   AliCheb3DCalc::ReadLine(buffs,stream); // N output dimensions</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :   fDimOut = buffs.Atoi(); </span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :   if (fDimOut&lt;1) AliFatalF(&quot;Expected: '&lt;number_of_output_dimensions&gt;', found \&quot;%s\&quot;&quot;,buffs.Data());</span>
<span class="lineNum">     754 </span>            :   //
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :   SetDimOut(fDimOut);</span>
<span class="lineNum">     756 </span>            :   //
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :   AliCheb3DCalc::ReadLine(buffs,stream); // Interpolation abs. precision</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :   fPrec = buffs.Atof();</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :   if (fPrec&lt;=0) AliFatalF(&quot;Expected: '&lt;abs.precision&gt;', found \&quot;%s\&quot;&quot;,buffs.Data());</span>
<span class="lineNum">     760 </span>            :   //
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) { // Lower boundaries of interpolation region</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     AliCheb3DCalc::ReadLine(buffs,stream);</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :     fBMin[i] = buffs.Atof(); </span>
<span class="lineNum">     764 </span>            :   }
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) { // Upper boundaries of interpolation region</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     AliCheb3DCalc::ReadLine(buffs,stream);</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :     fBMax[i] = buffs.Atof(); </span>
<span class="lineNum">     768 </span>            :   }
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :   PrepareBoundaries(fBMin,fBMax);</span>
<span class="lineNum">     770 </span>            :   //
<span class="lineNum">     771 </span>            :   // data for each output dimension
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;fDimOut;i++) GetChebCalc(i)-&gt;LoadData(stream);</span>
<span class="lineNum">     773 </span>            :   //
<span class="lineNum">     774 </span>            :   // check end_of_data record
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   AliCheb3DCalc::ReadLine(buffs,stream);</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :   if (!buffs.BeginsWith(&quot;END&quot;) || !buffs.Contains(GetName())) {</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :     AliFatalF(&quot;Expected \&quot;END %s\&quot;, found \&quot;%s\&quot;&quot;,GetName(),buffs.Data());</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     779 </span>            :   //
<span class="lineNum">     780 </span><span class="lineNoCov">          0 : }</span>
<a name="781"><span class="lineNum">     781 </span>            : </a>
<span class="lineNum">     782 </span>            : //_______________________________________________
<span class="lineNum">     783 </span>            : void AliCheb3D::SetDimOut(const int d, const float* prec)
<span class="lineNum">     784 </span>            : {
<span class="lineNum">     785 </span>            :   // init output dimensions
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :   fDimOut = d;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :   if (fResTmp) delete fResTmp;</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :   fResTmp = new Float_t[fDimOut];</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :   fChebCalc.Delete();</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;d;i++) {</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :     AliCheb3DCalc* clc = new AliCheb3DCalc();</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :     clc-&gt;SetPrecision(prec &amp;&amp; prec[i]&gt;fgkMinPrec ? prec[i] : fPrec);</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :     fChebCalc.AddAtAndExpand(clc,i);</span>
<span class="lineNum">     794 </span>            :   }
<span class="lineNum">     795 </span><span class="lineNoCov">          0 : }</span>
<a name="796"><span class="lineNum">     796 </span>            : </a>
<span class="lineNum">     797 </span>            : //_______________________________________________
<span class="lineNum">     798 </span>            : void AliCheb3D::ShiftBound(int id,float dif)
<span class="lineNum">     799 </span>            : {
<span class="lineNum">     800 </span>            :   // modify the bounds of the grid
<span class="lineNum">     801 </span>            :   //
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :   if (id&lt;0||id&gt;2) {printf(&quot;Maximum 3 dimensions are supported\n&quot;); return;}</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :   fBMin[id] += dif;</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :   fBMax[id] += dif;</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :   fBOffset[id] += dif;</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     807 </span>            : 
<a name="808"><span class="lineNum">     808 </span>            : //_______________________________________________</a>
<span class="lineNum">     809 </span>            : #ifdef _INC_CREATION_ALICHEB3D_
<span class="lineNum">     810 </span>            : TH1* AliCheb3D::TestRMS(int idim,int npoints,TH1* histo)
<span class="lineNum">     811 </span>            : {
<span class="lineNum">     812 </span>            :   // fills the difference between the original function and parameterization (for idim-th component of the output)
<span class="lineNum">     813 </span>            :   // to supplied histogram. Calculations are done in npoints random points. 
<span class="lineNum">     814 </span>            :   // If the hostgram was not supplied, it will be created. It is up to the user to delete it! 
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :   if (!fUsrMacro) {</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :     printf(&quot;No user function is set\n&quot;);</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :     return 0;</span>
<span class="lineNum">     818 </span>            :   }
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :   float prc = GetChebCalc(idim)-&gt;GetPrecision();</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :   if (prc&lt;fgkMinPrec) prc = fPrec;   // no dimension specific precision</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :   if (!histo) histo = new TH1D(GetName(),&quot;Control: Function - Parametrization&quot;,100,-2*prc,2*prc);</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :   for (int ip=npoints;ip--;) {</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :     gRandom-&gt;RndmArray(3,(Float_t *)fArgsTmp);</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :     for (int i=3;i--;) fArgsTmp[i] = fBMin[i] + fArgsTmp[i]*(fBMax[i]-fBMin[i]);</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :     EvalUsrFunction();</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :     Float_t valFun = fResTmp[idim];</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :     Eval(fArgsTmp,fResTmp);</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :     Float_t valPar = fResTmp[idim];</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :     histo-&gt;Fill(valFun - valPar);</span>
<span class="lineNum">     830 </span>            :   }
<span class="lineNum">     831 </span>            :   return histo;
<span class="lineNum">     832 </span>            :   //
<span class="lineNum">     833 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     834 </span>            : #endif
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span>            : //_______________________________________________
<a name="837"><span class="lineNum">     837 </span>            : #ifdef _INC_CREATION_ALICHEB3D_</a>
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span>            : void AliCheb3D::EstimateNPoints(float prec, int gridBC[3][3],Int_t npd1,Int_t npd2,Int_t npd3)
<span class="lineNum">     840 </span>            : {
<span class="lineNum">     841 </span>            :   // Estimate number of points to generate a training data
<span class="lineNum">     842 </span>            :   //
<span class="lineNum">     843 </span>            :   const int kScp = 9;
<span class="lineNum">     844 </span>            :   const float kScl[9] = {0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9};
<span class="lineNum">     845 </span>            :   //
<span class="lineNum">     846 </span>            :   const float sclDim[2] = {0.001,0.999};
<span class="lineNum">     847 </span>            :   const int   compDim[3][2] = { {1,2}, {2,0}, {0,1} };
<span class="lineNum">     848 </span>            :   static float xyz[3];
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :   Int_t npdTst[3] = {npd1,npd2,npd3};</span>
<span class="lineNum">     850 </span>            :   //
<span class="lineNum">     851 </span>            : 
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :   for (int i=3;i--;)for (int j=3;j--;) gridBC[i][j] = -1;</span>
<span class="lineNum">     853 </span>            :   //
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :   for (int idim=0;idim&lt;3;idim++) {</span>
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :     float dimMN = fBMin[idim] + sclDim[0]*(fBMax[idim]-fBMin[idim]);</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :     float dimMX = fBMin[idim] + sclDim[1]*(fBMax[idim]-fBMin[idim]);</span>
<span class="lineNum">     857 </span>            :     //
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :     int id1 = compDim[idim][0]; // 1st fixed dim</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :     int id2 = compDim[idim][1]; // 2nd fixed dim</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :     for (int i1=0;i1&lt;kScp;i1++) {</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :       xyz[ id1 ] = fBMin[id1] + kScl[i1]*( fBMax[id1]-fBMin[id1] );</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :       for (int i2=0;i2&lt;kScp;i2++) {</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :         xyz[ id2 ] = fBMin[id2] + kScl[i2]*( fBMax[id2]-fBMin[id2] );</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :         int* npt = GetNCNeeded(xyz,idim, dimMN,dimMX, prec, npdTst[idim]); // npoints for Bx,By,Bz</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :         for (int ib=0;ib&lt;3;ib++) if (npt[ib]&gt;gridBC[ib][idim]) gridBC[ib][idim] = npt[ib];</span>
<span class="lineNum">     866 </span>            :       }
<span class="lineNum">     867 </span>            :     }
<span class="lineNum">     868 </span>            :   }
<span class="lineNum">     869 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     870 </span>            : 
<span class="lineNum">     871 </span>            : /*
<span class="lineNum">     872 </span>            : void AliCheb3D::EstimateNPoints(float prec, int gridBC[3][3])
<span class="lineNum">     873 </span>            : {
<span class="lineNum">     874 </span>            :   // Estimate number of points to generate a training data
<span class="lineNum">     875 </span>            :   //
<span class="lineNum">     876 </span>            :   const float sclA[9] = {0.1, 0.5, 0.9, 0.1, 0.5, 0.9, 0.1, 0.5, 0.9} ;
<span class="lineNum">     877 </span>            :   const float sclB[9] = {0.1, 0.1, 0.1, 0.5, 0.5, 0.5, 0.9, 0.9, 0.9} ;
<span class="lineNum">     878 </span>            :   const float sclDim[2] = {0.01,0.99};
<span class="lineNum">     879 </span>            :   const int   compDim[3][2] = { {1,2}, {2,0}, {0,1} };
<span class="lineNum">     880 </span>            :   static float xyz[3];
<span class="lineNum">     881 </span>            :   //
<span class="lineNum">     882 </span>            :   for (int i=3;i--;)for (int j=3;j--;) gridBC[i][j] = -1;
<span class="lineNum">     883 </span>            :   //
<span class="lineNum">     884 </span>            :   for (int idim=0;idim&lt;3;idim++) {
<span class="lineNum">     885 </span>            :     float dimMN = fBMin[idim] + sclDim[0]*(fBMax[idim]-fBMin[idim]);
<span class="lineNum">     886 </span>            :     float dimMX = fBMin[idim] + sclDim[1]*(fBMax[idim]-fBMin[idim]);
<span class="lineNum">     887 </span>            :     //
<span class="lineNum">     888 </span>            :     for (int it=0;it&lt;9;it++) { // test in 9 points
<span class="lineNum">     889 </span>            :       int id1 = compDim[idim][0]; // 1st fixed dim
<span class="lineNum">     890 </span>            :       int id2 = compDim[idim][1]; // 2nd fixed dim
<span class="lineNum">     891 </span>            :       xyz[ id1 ] = fBMin[id1] + sclA[it]*( fBMax[id1]-fBMin[id1] );
<span class="lineNum">     892 </span>            :       xyz[ id2 ] = fBMin[id2] + sclB[it]*( fBMax[id2]-fBMin[id2] );
<span class="lineNum">     893 </span>            :       //
<span class="lineNum">     894 </span>            :       int* npt = GetNCNeeded(xyz,idim, dimMN,dimMX, prec); // npoints for Bx,By,Bz
<span class="lineNum">     895 </span>            :       for (int ib=0;ib&lt;3;ib++) if (npt[ib]&gt;gridBC[ib][idim]) gridBC[ib][idim] = npt[ib];//+2;
<span class="lineNum">     896 </span>            :       //
<span class="lineNum">     897 </span>            :     }
<span class="lineNum">     898 </span>            :   }
<span class="lineNum">     899 </span>            : }
<span class="lineNum">     900 </span>            : 
<span class="lineNum">     901 </span>            : 
<span class="lineNum">     902 </span>            : int* AliCheb3D::GetNCNeeded(float xyz[3],int DimVar, float mn,float mx, float prec)
<span class="lineNum">     903 </span>            : {
<span class="lineNum">     904 </span>            :   // estimate needed number of chebyshev coefs for given function description in DimVar dimension
<span class="lineNum">     905 </span>            :   // The values for two other dimensions must be set beforehand
<span class="lineNum">     906 </span>            :   //
<span class="lineNum">     907 </span>            :   static int curNC[3];
<span class="lineNum">     908 </span>            :   static int retNC[3];
<span class="lineNum">     909 </span>            :   const int kMaxPoint = 400;
<span class="lineNum">     910 </span>            :   float* gridVal = new float[3*kMaxPoint];
<span class="lineNum">     911 </span>            :   float* coefs   = new float[3*kMaxPoint];
<span class="lineNum">     912 </span>            :   //
<span class="lineNum">     913 </span>            :   float scale = mx-mn;
<span class="lineNum">     914 </span>            :   float offs  = mn + scale/2.0;
<span class="lineNum">     915 </span>            :   scale = 2./scale;
<span class="lineNum">     916 </span>            :   // 
<span class="lineNum">     917 </span>            :   int curNP;
<span class="lineNum">     918 </span>            :   int maxNC=-1;
<span class="lineNum">     919 </span>            :   int maxNCPrev=-1;
<span class="lineNum">     920 </span>            :   for (int i=0;i&lt;3;i++) retNC[i] = -1;
<span class="lineNum">     921 </span>            :   for (int i=0;i&lt;3;i++) fArgsTmp[i] = xyz[i];
<span class="lineNum">     922 </span>            :   //
<span class="lineNum">     923 </span>            :   for (curNP=3; curNP&lt;kMaxPoint; curNP+=3) { 
<span class="lineNum">     924 </span>            :     maxNCPrev = maxNC;
<span class="lineNum">     925 </span>            :     //
<span class="lineNum">     926 </span>            :     for (int i=0;i&lt;curNP;i++) { // get function values on Cheb. nodes
<span class="lineNum">     927 </span>            :       float x = TMath::Cos( TMath::Pi()*(i+0.5)/curNP );
<span class="lineNum">     928 </span>            :       fArgsTmp[DimVar] =  x/scale+offs; // map to requested interval
<span class="lineNum">     929 </span>            :       EvalUsrFunction();
<span class="lineNum">     930 </span>            :       for (int ib=3;ib--;) gridVal[ib*kMaxPoint + i] = fResTmp[ib];
<span class="lineNum">     931 </span>            :     }
<span class="lineNum">     932 </span>            :     //
<span class="lineNum">     933 </span>            :     for (int ib=0;ib&lt;3;ib++) {
<span class="lineNum">     934 </span>            :       curNC[ib] = AliCheb3D::CalcChebCoefs(&amp;gridVal[ib*kMaxPoint], curNP, &amp;coefs[ib*kMaxPoint],prec);
<span class="lineNum">     935 </span>            :       if (maxNC &lt; curNC[ib]) maxNC = curNC[ib];
<span class="lineNum">     936 </span>            :       if (retNC[ib] &lt; curNC[ib]) retNC[ib] = curNC[ib];
<span class="lineNum">     937 </span>            :     }
<span class="lineNum">     938 </span>            :     if ( (curNP-maxNC)&gt;3 &amp;&amp;  (maxNC-maxNCPrev)&lt;1 ) break;
<span class="lineNum">     939 </span>            :     maxNCPrev = maxNC;
<span class="lineNum">     940 </span>            :     //
<span class="lineNum">     941 </span>            :   }
<span class="lineNum">     942 </span>            :   delete[] gridVal;
<span class="lineNum">     943 </span>            :   delete[] coefs;
<span class="lineNum">     944 </span>            :   return retNC;
<span class="lineNum">     945 </span>            :   //
<span class="lineNum">     946 </span>            : }
<span class="lineNum">     947 </span>            : */
<a name="948"><span class="lineNum">     948 </span>            : </a>
<span class="lineNum">     949 </span>            : 
<span class="lineNum">     950 </span>            : int* AliCheb3D::GetNCNeeded(float xyz[3],int DimVar, float mn,float mx, float prec, Int_t npCheck)
<span class="lineNum">     951 </span>            : {
<span class="lineNum">     952 </span>            :   // estimate needed number of chebyshev coefs for given function description in DimVar dimension
<span class="lineNum">     953 </span>            :   // The values for two other dimensions must be set beforehand
<span class="lineNum">     954 </span>            :   //
<span class="lineNum">     955 </span>            :   static int retNC[3];
<span class="lineNum">     956 </span>            :   static int npChLast = 0;
<span class="lineNum">     957 </span>            :   static float *gridVal=0,*coefs=0;
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :   if (npCheck&lt;3) npCheck = 3;</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :   if (npChLast&lt;npCheck) {</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :     if (gridVal) delete[] gridVal;</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :     if (coefs)   delete[] coefs;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :     gridVal = new float[3*npCheck];</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :     coefs   = new float[3*npCheck];</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     npChLast = npCheck;</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     966 </span>            :   //
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :   float scale = mx-mn;</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :   float offs  = mn + scale/2.0;</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :   scale = 2./scale;</span>
<span class="lineNum">     970 </span>            :   //
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;3;i++) fArgsTmp[i] = xyz[i];</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :   for (int i=0;i&lt;npCheck;i++) {</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :     fArgsTmp[DimVar] =  TMath::Cos( TMath::Pi()*(i+0.5)/npCheck)/scale+offs; // map to requested interval</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :     EvalUsrFunction();</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :     for (int ib=3;ib--;) gridVal[ib*npCheck + i] = fResTmp[ib];</span>
<span class="lineNum">     976 </span>            :   } 
<span class="lineNum">     977 </span>            :   //
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :   for (int ib=0;ib&lt;3;ib++) retNC[ib] = AliCheb3D::CalcChebCoefs(&amp;gridVal[ib*npCheck], npCheck, &amp;coefs[ib*npCheck],prec);</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :   return retNC;</span>
<span class="lineNum">     980 </span>            :   //
<span class="lineNum">     981 </span>            : }
<span class="lineNum">     982 </span>            : 
<span class="lineNum">     983 </span>            : 
<span class="lineNum">     984 </span>            : #endif
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
