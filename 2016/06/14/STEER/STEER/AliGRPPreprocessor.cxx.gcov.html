<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - STEER/STEER/AliGRPPreprocessor.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">STEER/STEER</a> - AliGRPPreprocessor.cxx<span style="font-size: 80%;"> (source / <a href="AliGRPPreprocessor.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">2040</td>
            <td class="headerCovTableEntryLo">0.1 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">33</td>
            <td class="headerCovTableEntryLo">3.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : /* $Id$ */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      19 </span>            : //                          Class AliGRPPreprocessor
<span class="lineNum">      20 </span>            : //                  Global Run Parameters (GRP) preprocessor
<span class="lineNum">      21 </span>            : //    Origin: Panos Christakoglou, UOA-CERN, Panos.Christakoglou@cern.ch
<span class="lineNum">      22 </span>            : //    Modified: Ernesto.Lopez.Torres@cern.ch  CEADEN-CERN
<span class="lineNum">      23 </span>            : //    Modified: Chiara.Zampolli@cern.ch  CERN
<span class="lineNum">      24 </span>            : //-------------------------------------------------------------------------
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &lt;TChain.h&gt;
<span class="lineNum">      27 </span>            : #include &lt;TList.h&gt;
<span class="lineNum">      28 </span>            : #include &lt;TMap.h&gt;
<span class="lineNum">      29 </span>            : #include &lt;THashList.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;TObjString.h&gt;
<span class="lineNum">      31 </span>            : #include &lt;TObjArray.h&gt;
<span class="lineNum">      32 </span>            : #include &lt;TGraph.h&gt;
<span class="lineNum">      33 </span>            : #include &lt;TString.h&gt;
<span class="lineNum">      34 </span>            : #include &lt;TFile.h&gt;
<span class="lineNum">      35 </span>            : #include &lt;TPRegexp.h&gt;
<span class="lineNum">      36 </span>            : #include &lt;Bytes.h&gt;
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : #include &lt;float.h&gt;
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #include &quot;AliGRPPreprocessor.h&quot;
<span class="lineNum">      41 </span>            : #include &quot;AliGRPObject.h&quot;
<span class="lineNum">      42 </span>            : #include &quot;AliDCSSensor.h&quot;
<span class="lineNum">      43 </span>            : #include &quot;AliSplineFit.h&quot;
<span class="lineNum">      44 </span>            : #include &quot;AliDCSSensorArray.h&quot;
<span class="lineNum">      45 </span>            : #include &quot;AliRawEventHeaderVersions.h&quot;
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : #include &quot;AliTriggerConfiguration.h&quot;
<span class="lineNum">      48 </span>            : #include &quot;AliTriggerRunScalers.h&quot;
<span class="lineNum">      49 </span>            : #include &quot;AliTriggerInput.h&quot;
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            : #include &quot;AliCDBMetaData.h&quot;
<span class="lineNum">      52 </span>            : #include &quot;AliESDVertex.h&quot;
<span class="lineNum">      53 </span>            : #include &quot;AliLHCReader.h&quot;
<span class="lineNum">      54 </span>            : #include &quot;AliLHCData.h&quot;
<span class="lineNum">      55 </span>            : #include &quot;AliDCSArray.h&quot;
<span class="lineNum">      56 </span>            : #include &quot;AliDAQ.h&quot;
<span class="lineNum">      57 </span>            : #include &quot;AliLTUConfig.h&quot;
<span class="lineNum">      58 </span>            : #include &quot;AliQAThresholds.h&quot;
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : class AliLog;
<span class="lineNum">      61 </span>            : class AliDCSValue;
<span class="lineNum">      62 </span>            : class AliShuttleInterface;
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            : // needed for ReceivePromptRecoParameters
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : #include &lt;TSQLServer.h&gt;
<span class="lineNum">      67 </span>            : #include &lt;TSQLResult.h&gt;
<span class="lineNum">      68 </span>            : #include &lt;TSQLRow.h&gt;
<span class="lineNum">      69 </span>            : #include &lt;AliCDBManager.h&gt;
<span class="lineNum">      70 </span>            : #include &lt;AliCDBMetaData.h&gt;
<span class="lineNum">      71 </span>            : #include &lt;AliCDBId.h&gt;
<span class="lineNum">      72 </span>            : #include &lt;AliTriggerConfiguration.h&gt;
<span class="lineNum">      73 </span>            : #include &quot;AliCTPTimeParams.h&quot;
<span class="lineNum">      74 </span>            : #include &quot;AliLHCClockPhase.h&quot;
<a name="75"><span class="lineNum">      75 </span>            : </a>
<span class="lineNum">      76 </span>            : using std::ifstream;
<span class="lineNum">      77 </span><span class="lineCov">        126 : ClassImp(AliGRPPreprocessor)</span>
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : const Double_t kFitFraction = -1.;                 // Fraction of DCS sensor fits required
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : //_______________________________________________________________
<span class="lineNum">      83 </span>            : 
<span class="lineNum">      84 </span>            :   const Int_t AliGRPPreprocessor::fgknDAQLbPar = 7; // num parameters in the logbook used to fill the GRP object
<span class="lineNum">      85 </span>            :   const Int_t AliGRPPreprocessor::fgknDCSDP = 56;   // number of dcs dps
<span class="lineNum">      86 </span>            :   const Int_t AliGRPPreprocessor::fgknDCSDPHallProbes = 40;   // number of dcs dps
<span class="lineNum">      87 </span>            :   const Int_t AliGRPPreprocessor::fgknDCSDP_Redu = 8;   // number of redundant dcs dps
<span class="lineNum">      88 </span>            :   const Int_t AliGRPPreprocessor::fgknLHCDP = 9;   // number of dcs dps from LHC data
<span class="lineNum">      89 </span>            :   const Int_t AliGRPPreprocessor::fgkDCSDPHallTopShift = 4;   // shift from the top to get tp the Hall Probes names in the list of DCS DPs
<span class="lineNum">      90 </span>            :   const Int_t AliGRPPreprocessor::fgkDCSDPNonWorking = 2; // number of non working DCS DPs
<span class="lineNum">      91 </span>            :   const char* AliGRPPreprocessor::fgkDCSDataPoints[AliGRPPreprocessor::fgknDCSDP] = {
<span class="lineNum">      92 </span>            :           &quot;L3Polarity&quot;,                //0 
<span class="lineNum">      93 </span>            :           &quot;DipolePolarity&quot;,            //1
<span class="lineNum">      94 </span>            :           &quot;L3Current&quot;,                 //2
<span class="lineNum">      95 </span>            :           &quot;DipoleCurrent&quot;,             //3
<span class="lineNum">      96 </span>            :           &quot;L3_BSF17_H1&quot;,               //4
<span class="lineNum">      97 </span>            :           &quot;L3_BSF17_H2&quot;,               //5
<span class="lineNum">      98 </span>            :           &quot;L3_BSF17_H3&quot;,               //6
<span class="lineNum">      99 </span>            :           &quot;L3_BSF17_Temperature&quot;,      //7
<span class="lineNum">     100 </span>            :           &quot;L3_BSF4_H1&quot;,                //8
<span class="lineNum">     101 </span>            :           &quot;L3_BSF4_H2&quot;,                //9
<span class="lineNum">     102 </span>            :           &quot;L3_BSF4_H3&quot;,                //10
<span class="lineNum">     103 </span>            :           &quot;L3_BSF4_Temperature&quot;,       //11
<span class="lineNum">     104 </span>            :           &quot;L3_BKF17_H1&quot;,               //12
<span class="lineNum">     105 </span>            :           &quot;L3_BKF17_H2&quot;,               //13
<span class="lineNum">     106 </span>            :           &quot;L3_BKF17_H3&quot;,               //14
<span class="lineNum">     107 </span>            :           &quot;L3_BKF17_Temperature&quot;,      //15
<span class="lineNum">     108 </span>            :           &quot;L3_BKF4_H1&quot;,                //16
<span class="lineNum">     109 </span>            :           &quot;L3_BKF4_H2&quot;,                //17
<span class="lineNum">     110 </span>            :           &quot;L3_BKF4_H3&quot;,                //18
<span class="lineNum">     111 </span>            :           &quot;L3_BKF4_Temperature&quot;,       //19
<span class="lineNum">     112 </span>            :           &quot;L3_BSF13_H1&quot;,               //20
<span class="lineNum">     113 </span>            :           &quot;L3_BSF13_H2&quot;,               //21
<span class="lineNum">     114 </span>            :           &quot;L3_BSF13_H3&quot;,               //22
<span class="lineNum">     115 </span>            :           &quot;L3_BSF13_Temperature&quot;,      //23
<span class="lineNum">     116 </span>            :           &quot;L3_BSF8_H1&quot;,                //24
<span class="lineNum">     117 </span>            :           &quot;L3_BSF8_H2&quot;,                //25
<span class="lineNum">     118 </span>            :           &quot;L3_BSF8_H3&quot;,                //26
<span class="lineNum">     119 </span>            :           &quot;L3_BSF8_Temperature&quot;,       //27
<span class="lineNum">     120 </span>            :           &quot;L3_BKF13_H1&quot;,               //28
<span class="lineNum">     121 </span>            :           &quot;L3_BKF13_H2&quot;,               //29
<span class="lineNum">     122 </span>            :           &quot;L3_BKF13_H3&quot;,               //30
<span class="lineNum">     123 </span>            :           &quot;L3_BKF13_Temperature&quot;,      //31
<span class="lineNum">     124 </span>            :           &quot;L3_BKF8_H1&quot;,                //32
<span class="lineNum">     125 </span>            :           &quot;L3_BKF8_H2&quot;,                //33
<span class="lineNum">     126 </span>            :           &quot;L3_BKF8_H3&quot;,                //34
<span class="lineNum">     127 </span>            :           &quot;L3_BKF8_Temperature&quot;,       //35
<span class="lineNum">     128 </span>            :           &quot;Dipole_Inside_H1&quot;,          //36
<span class="lineNum">     129 </span>            :           &quot;Dipole_Inside_H2&quot;,          //37
<span class="lineNum">     130 </span>            :           &quot;Dipole_Inside_H3&quot;,          //38
<span class="lineNum">     131 </span>            :           &quot;Dipole_Inside_Temperature&quot;, //39
<span class="lineNum">     132 </span>            :           &quot;Dipole_Outside_H1&quot;,         //40
<span class="lineNum">     133 </span>            :           &quot;Dipole_Outside_H2&quot;,         //41
<span class="lineNum">     134 </span>            :           &quot;Dipole_Outside_H3&quot;,         //42
<span class="lineNum">     135 </span>            :           &quot;Dipole_Outside_Temperature&quot;,//43
<span class="lineNum">     136 </span>            :           &quot;CavernTemperature&quot;,         //44
<span class="lineNum">     137 </span>            :           &quot;L3Polarity_Redu&quot;,           //45
<span class="lineNum">     138 </span>            :           &quot;DipolePolarity_Redu&quot;,       //46
<span class="lineNum">     139 </span>            :           &quot;L3Current_Redu&quot;,            //47
<span class="lineNum">     140 </span>            :           &quot;DipoleCurrent_Redu&quot;,        //48
<span class="lineNum">     141 </span>            :           &quot;CavernTemperature_Redu&quot;,    //49
<span class="lineNum">     142 </span>            :           &quot;CavernAtmosPressure&quot;,       //50
<span class="lineNum">     143 </span>            :           &quot;SurfaceAtmosPressure&quot;,      //51
<span class="lineNum">     144 </span>            :           &quot;CavernAtmosPressure2&quot;,      //52
<span class="lineNum">     145 </span>            :           &quot;CavernAtmosPressure_Redu&quot;,  //53
<span class="lineNum">     146 </span>            :           &quot;SurfaceAtmosPressure_Redu&quot;, //54
<span class="lineNum">     147 </span>            :           &quot;CavernAtmosPressure2_Redu&quot;  //55
<span class="lineNum">     148 </span>            :   };
<span class="lineNum">     149 </span>            : 
<span class="lineNum">     150 </span>            :   const char* AliGRPPreprocessor::fgkDCSDataPointsHallProbes[AliGRPPreprocessor::fgknDCSDPHallProbes] = {
<span class="lineNum">     151 </span>            :                    &quot;L3_BSF17_H1&quot;,
<span class="lineNum">     152 </span>            :                    &quot;L3_BSF17_H2&quot;,
<span class="lineNum">     153 </span>            :                    &quot;L3_BSF17_H3&quot;,
<span class="lineNum">     154 </span>            :                    &quot;L3_BSF17_Temperature&quot;,
<span class="lineNum">     155 </span>            :                    &quot;L3_BSF4_H1&quot;,
<span class="lineNum">     156 </span>            :                    &quot;L3_BSF4_H2&quot;,
<span class="lineNum">     157 </span>            :                    &quot;L3_BSF4_H3&quot;,
<span class="lineNum">     158 </span>            :                    &quot;L3_BSF4_Temperature&quot;,
<span class="lineNum">     159 </span>            :                    &quot;L3_BKF17_H1&quot;,
<span class="lineNum">     160 </span>            :                    &quot;L3_BKF17_H2&quot;,
<span class="lineNum">     161 </span>            :                    &quot;L3_BKF17_H3&quot;,
<span class="lineNum">     162 </span>            :                    &quot;L3_BKF17_Temperature&quot;,
<span class="lineNum">     163 </span>            :                    &quot;L3_BKF4_H1&quot;,
<span class="lineNum">     164 </span>            :                    &quot;L3_BKF4_H2&quot;,
<span class="lineNum">     165 </span>            :                    &quot;L3_BKF4_H3&quot;,
<span class="lineNum">     166 </span>            :                    &quot;L3_BKF4_Temperature&quot;,
<span class="lineNum">     167 </span>            :                    &quot;L3_BSF13_H1&quot;,
<span class="lineNum">     168 </span>            :                    &quot;L3_BSF13_H2&quot;,
<span class="lineNum">     169 </span>            :                    &quot;L3_BSF13_H3&quot;,
<span class="lineNum">     170 </span>            :                    &quot;L3_BSF13_Temperature&quot;,
<span class="lineNum">     171 </span>            :                    &quot;L3_BSF8_H1&quot;,
<span class="lineNum">     172 </span>            :                    &quot;L3_BSF8_H2&quot;,
<span class="lineNum">     173 </span>            :                    &quot;L3_BSF8_H3&quot;,
<span class="lineNum">     174 </span>            :                    &quot;L3_BSF8_Temperature&quot;,
<span class="lineNum">     175 </span>            :                    &quot;L3_BKF13_H1&quot;,
<span class="lineNum">     176 </span>            :                    &quot;L3_BKF13_H2&quot;,
<span class="lineNum">     177 </span>            :                    &quot;L3_BKF13_H3&quot;,
<span class="lineNum">     178 </span>            :                    &quot;L3_BKF13_Temperature&quot;,
<span class="lineNum">     179 </span>            :                    &quot;L3_BKF8_H1&quot;,
<span class="lineNum">     180 </span>            :                    &quot;L3_BKF8_H2&quot;,
<span class="lineNum">     181 </span>            :                    &quot;L3_BKF8_H3&quot;,
<span class="lineNum">     182 </span>            :                    &quot;L3_BKF8_Temperature&quot;,
<span class="lineNum">     183 </span>            :                    &quot;Dipole_Inside_H1&quot;,
<span class="lineNum">     184 </span>            :                    &quot;Dipole_Inside_H2&quot;,
<span class="lineNum">     185 </span>            :                    &quot;Dipole_Inside_H3&quot;,
<span class="lineNum">     186 </span>            :                    &quot;Dipole_Inside_Temperature&quot;,
<span class="lineNum">     187 </span>            :                    &quot;Dipole_Outside_H1&quot;,
<span class="lineNum">     188 </span>            :                    &quot;Dipole_Outside_H2&quot;,
<span class="lineNum">     189 </span>            :                    &quot;Dipole_Outside_H3&quot;,
<span class="lineNum">     190 </span>            :                    &quot;Dipole_Outside_Temperature&quot;
<span class="lineNum">     191 </span>            :                  };
<span class="lineNum">     192 </span>            :                  
<span class="lineNum">     193 </span>            :   const Short_t kSensors = 50; // start index position of sensor in DCS DPs
<span class="lineNum">     194 </span>            :   const Short_t kNumSensors = 6; // Number of sensors in DCS DPs (CavernAtmosPressure, SurfaceAtmosPressure, CavernAtmosPressure2, CavernAtmosPressure_Redu, SurfaceAtmosPressure_Redu, CavernAtmosPressure2_Redu)
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :   const char* AliGRPPreprocessor::fgkLHCDataPoints[AliGRPPreprocessor::fgknLHCDP] = {
<span class="lineNum">     198 </span>            :           &quot;LHC_Beam_Energy&quot;,
<span class="lineNum">     199 </span>            :           &quot;LHC_MachineMode&quot;,
<span class="lineNum">     200 </span>            :           &quot;LHC_BeamMode&quot;,
<span class="lineNum">     201 </span>            :           &quot;LHC_Beams_Particle_Type&quot;,
<span class="lineNum">     202 </span>            :           &quot;BPTX_Phase_Shift_B1&quot;,
<span class="lineNum">     203 </span>            :           &quot;BPTX_Phase_Shift_B2&quot;,
<span class="lineNum">     204 </span>            :           &quot;LHC_Particle_Type_B1&quot;,
<span class="lineNum">     205 </span>            :           &quot;LHC_Particle_Type_B2&quot;,
<span class="lineNum">     206 </span>            :           &quot;LHC_Data_Quality_Flag&quot;
<span class="lineNum">     207 </span>            :   };
<span class="lineNum">     208 </span>            : 
<span class="lineNum">     209 </span>            :   const char* kppError[] = {
<span class="lineNum">     210 </span>            :                    &quot;&quot;,
<span class="lineNum">     211 </span>            :                    &quot;(DAQ logbook ERROR)&quot;,
<span class="lineNum">     212 </span>            :                    &quot;(DAQ FXS ERROR)&quot;,
<span class="lineNum">     213 </span>            :                    &quot;(Trigger Scalers not found in FXS - ERROR)&quot;,
<span class="lineNum">     214 </span>            :                    &quot;(DCS data points ERROR)&quot;,
<span class="lineNum">     215 </span>            :                    &quot;(Trigger Configuration ERROR)&quot;,
<span class="lineNum">     216 </span>            :                    &quot;(DAQ logbook ERROR determining partition of the run)&quot;,
<span class="lineNum">     217 </span>            :                    &quot;(CTP timing ERROR)&quot;,
<span class="lineNum">     218 </span>            :                    &quot;(SPD Mean Vertex ERROR)&quot;,
<span class="lineNum">     219 </span>            :                    &quot;(FXS Error for LHC Data)&quot;,
<span class="lineNum">     220 </span>            :                    &quot;(LHC Data Error)&quot;,
<span class="lineNum">     221 </span>            :                    &quot;(LHC Clock Phase Error (from LHC Data))&quot;,
<span class="lineNum">     222 </span>            :                    &quot;(LTU Configuration Error)&quot;,
<span class="lineNum">     223 </span>            :                    &quot;(DQM Failure)&quot;,
<span class="lineNum">     224 </span>            :                    &quot;(Trigger Aliases wrong or not found in DCS FXS - ERROR)&quot;
<span class="lineNum">     225 </span>            :   };
<span class="lineNum">     226 </span>            : 
<a name="227"><span class="lineNum">     227 </span>            : //_______________________________________________________________</a>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span>            : AliGRPPreprocessor::AliGRPPreprocessor(AliShuttleInterface* shuttle):
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :         AliPreprocessor(&quot;GRP&quot;,shuttle),  fPressure(0), fmaxFloat(0), fminFloat(0),fmaxDouble(0), fminDouble(0), fmaxInt(0), fminInt(0), fmaxUInt(0), fminUInt(0),fdaqStartEndTimeOk(kTRUE),ffailedDPs(new TObjArray(fgknDCSDP))</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     232 </span>            :         // constructor - shuttle must be instantiated!
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :         AddRunType(&quot;COSMIC&quot;);</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :         AddRunType(&quot;LASER&quot;);</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         AddRunType(&quot;PHYSICS&quot;);</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION_BC&quot;);</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION_CENTRAL&quot;);</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION_EMD&quot;);</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION_MB&quot;);</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION_SEMICENTRAL&quot;);</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :         AddRunType(&quot;CALIBRATION&quot;);</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :         AddRunType(&quot;PEDESTAL&quot;);</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :         AddRunType(&quot;STANDALONE&quot;);</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :         AddRunType(&quot;GAIN&quot;);</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         AddRunType(&quot;NOISE&quot;);</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :         AddRunType(&quot;PULSER&quot;);</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :         AddRunType(&quot;STANDALONE_PULSER&quot;);</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         AddRunType(&quot;STANDALONE_BC&quot;);</span>
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :         fmaxFloat = FLT_MAX;</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         fminFloat = -FLT_MAX;</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :         fmaxDouble = DBL_MAX;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         fminDouble = -DBL_MAX;</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :         fmaxInt = kMaxInt;</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :         fminInt = kMinInt;</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :         fmaxUInt = kMaxUInt;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         fminUInt = 0;</span>
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Max allowed float = %6.5e&quot;,fmaxFloat));</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Min allowed float = %6.5e&quot;,fminFloat));</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Max allowed double = %6.5e&quot;,fmaxDouble));</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Min allowed double = %6.5e&quot;,fminDouble));</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Max allowed integer = %d&quot;,fmaxInt));</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Min allowed integer = %d&quot;,fminInt));</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Max allowed unsigned integer = %u&quot;,(Int_t)fmaxUInt));</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Min allowed unsigned integer = %u&quot;,(Int_t)fminUInt));</span>
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :         ffailedDPs-&gt;SetOwner(kTRUE);</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     271 </span>            : 
<a name="272"><span class="lineNum">     272 </span>            : //_______________________________________________________________</a>
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span>            : AliGRPPreprocessor::~AliGRPPreprocessor()
<span class="lineNum">     275 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     276 </span>            :         //destructor
<span class="lineNum">     277 </span>            :         
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :         delete fPressure;</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :         delete ffailedDPs;</span>
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     282 </span>            : 
<a name="283"><span class="lineNum">     283 </span>            : //_______________________________________________________________</a>
<span class="lineNum">     284 </span>            : 
<span class="lineNum">     285 </span>            : void AliGRPPreprocessor::Initialize(Int_t run, UInt_t startTime, UInt_t endTime)
<span class="lineNum">     286 </span>            : {
<span class="lineNum">     287 </span>            :         // Initialize preprocessor
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :         AliPreprocessor::Initialize(run, startTime, endTime);</span>
<span class="lineNum">     290 </span>            :         
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :         AliInfo(&quot;Initialization of the GRP preprocessor.&quot;);</span>
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Start Time DCS = %d&quot;,GetStartTimeDCSQuery()));</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;End Time DCS = %d&quot;,GetEndTimeDCSQuery()));</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :         TClonesArray * array = new TClonesArray(&quot;AliDCSSensor&quot;,kNumSensors); </span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :         for(Int_t j = 0; j &lt; kNumSensors; j++) {</span>
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :                 AliDCSSensor * sens = new ((*array)[j])AliDCSSensor;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :                 sens-&gt;SetStringID(fgkDCSDataPoints[j+kSensors]);</span>
<span class="lineNum">     298 </span>            :         }
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Pressure Entries: %d&quot;,array-&gt;GetEntries()));</span>
<span class="lineNum">     300 </span>            :         
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :         fPressure = new AliDCSSensorArray(GetStartTimeDCSQuery(), GetEndTimeDCSQuery(), array);</span>
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :         ffailedDPs-&gt;Clear(); // cleaning ffailedDPs for current run</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :         for (Int_t iDP=0; iDP &lt; fgknDCSDP; iDP++){</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :                 TObjString* dp = new TObjString(fgkDCSDataPoints[iDP]);</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;AddAt(dp,iDP);</span>
<span class="lineNum">     307 </span>            :         }
<span class="lineNum">     308 </span>            : 
<span class="lineNum">     309 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     310 </span>            : 
<a name="311"><span class="lineNum">     311 </span>            : //_______________________________________________________________</a>
<span class="lineNum">     312 </span>            : 
<span class="lineNum">     313 </span>            : UInt_t AliGRPPreprocessor::Process(TMap* valueMap)
<span class="lineNum">     314 </span>            : {
<span class="lineNum">     315 </span>            :         // process data retrieved by the Shuttle
<span class="lineNum">     316 </span>            :         
<span class="lineNum">     317 </span>            :         // retrieving &quot;partition&quot; and &quot;detector&quot; fields from DAQ logbook to 
<span class="lineNum">     318 </span>            :         // determine the partition in which the run was taken
<span class="lineNum">     319 </span>            :         // the partition is used to decide how to react in case of errors for CTP
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :         TString partition = (TString)GetRunParameter(&quot;partition&quot;);  </span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :         TString detector = (TString)GetRunParameter(&quot;detector&quot;);   </span>
<span class="lineNum">     323 </span>            : 
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :         AliGRPObject *grpobj = new AliGRPObject();  // object to store data</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :         grpobj-&gt;SetBeamEnergyIsSqrtSHalfGeV(); // new format</span>
<span class="lineNum">     326 </span>            : 
<span class="lineNum">     327 </span>            :         //=================//
<span class="lineNum">     328 </span>            :         // DAQ logbook     //
<span class="lineNum">     329 </span>            :         //=================//
<span class="lineNum">     330 </span>            : 
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing DAQ logbook&quot;);</span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span>            :         UInt_t error = 0;
<span class="lineNum">     334 </span>            :         
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :         Int_t iDaqLB = ProcessDaqLB(grpobj);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         TString runType = (TString)GetRunType();</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :         TString beamType = (TString)GetRunParameter(&quot;beamType&quot;);</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :         if(iDaqLB == fgknDAQLbPar) {</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;DAQ Logbook, successful! Retrieved %d/%d entries&quot;,iDaqLB,fgknDAQLbPar));</span>
<span class="lineNum">     340 </span>            :         } else {
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;DAQ Logbook, could not get all expected entries!!! Retrieved only %d/%d entries&quot;,iDaqLB,fgknDAQLbPar));</span>
<span class="lineNum">     342 </span>            :                 error |= 1;
<span class="lineNum">     343 </span>            :         }
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span>            :         //=================//
<span class="lineNum">     346 </span>            :         // DAQ FXS         //
<span class="lineNum">     347 </span>            :         //=================//
<span class="lineNum">     348 </span>            : 
<span class="lineNum">     349 </span>            :         // Let's skip the raw data tags
<span class="lineNum">     350 </span>            :         /*
<span class="lineNum">     351 </span>            :         Log(&quot;*************** Processing DAQ FXS&quot;);
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span>            :         UInt_t iDaqFxs = ProcessDaqFxs();
<span class="lineNum">     354 </span>            :         if( iDaqFxs == 0 ) {
<span class="lineNum">     355 </span>            :                 Log(Form(&quot;DAQ FXS, successful!&quot;));
<span class="lineNum">     356 </span>            :         } else {
<span class="lineNum">     357 </span>            :                 Log(Form(&quot;DAQ FXS, could not store run raw tag file!!!&quot;));
<span class="lineNum">     358 </span>            :                 error |= 2;
<span class="lineNum">     359 </span>            :         }
<span class="lineNum">     360 </span>            :         */
<span class="lineNum">     361 </span>            :         
<span class="lineNum">     362 </span>            :         //=================//
<span class="lineNum">     363 </span>            :         // DCS FXS         //
<span class="lineNum">     364 </span>            :         //=================//
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing DCS FXS&quot;);</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :         UInt_t iDcsFxs = ProcessDcsFxs(partition, detector);</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :         if( iDcsFxs == 0 ) {</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;DCS FXS, successful!&quot;));</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :         } else  if (iDcsFxs ==1) {</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Could not store CTP scalers!!!&quot;));</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :                 error |= 4;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         } else  if (iDcsFxs == 2) {</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Could not store CTP aliases!!!&quot;));</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :                 error |= 8192;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :         } else{</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Incorrect field in DAQ logbook for partition = %s and detector = %s, going into error without CTP scalers...&quot;,partition.Data(),detector.Data()));</span>
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :                 error |= 32;</span>
<span class="lineNum">     380 </span>            :         }
<span class="lineNum">     381 </span>            :         
<span class="lineNum">     382 </span>            :         //=================//
<span class="lineNum">     383 </span>            :         // DCS data points //
<span class="lineNum">     384 </span>            :         //=================//
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing DCS DPs&quot;);</span>
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :         Log(Form(&quot;Starting DCS Query at %d and finishing at %d&quot;,GetStartTimeDCSQuery(),GetEndTimeDCSQuery()));</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :         Int_t entries = ProcessDcsDPs( valueMap, grpobj );</span>
<span class="lineNum">     390 </span>            :         //Log(Form(&quot;entries found = %d (should be %d)&quot;,entries, fgknDCSDP-fgkDCSDPNonWorking));
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n\n--------------- Summary of DCS DPs Processing ---------------&quot;));</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :         Log(Form(&quot;entries found = %d (should be %d)&quot;,entries, fgknDCSDP-fgknDCSDPHallProbes-fgknDCSDP_Redu)); // Hall Probes DPs not used, and we also don't count twice the DPs with the redundant copy</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :         if (fdaqStartEndTimeOk){</span>
<span class="lineNum">     394 </span>            :           //if( entries &lt; fgknDCSDP - fgkDCSDPNonWorking ) { // L3_BSF4_H3, L3_BSF17_H1, L3_BSF17_H2, L3_BSF17_H3, L3_BSF17_Temperature are not working yet...  
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :                 if( entries &lt; fgknDCSDP - fgknDCSDPHallProbes -fgknDCSDP_Redu) { // Hall Probes not considered</span>
<span class="lineNum">     396 </span>            :                   //Log(Form(&quot;Possible problem with the DCS data points!!! Only %d/%d entries found - Please read further for more details&quot;,entries,fgknDCSDP-fgkDCSDPNonWorking));
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Possible problem with the DCS data points!!! Only %d/%d entries found - Please read further for more details&quot;,entries,fgknDCSDP-fgknDCSDPHallProbes-fgknDCSDP_Redu));</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;The DPs giving problems were:&quot;));</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :                         for (Int_t iDP = 0; iDP &lt; fgknDCSDP; iDP++){</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :                                 TObjString *dpString = (TObjString*)ffailedDPs-&gt;At(iDP);</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :                                 if (dpString){</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :                                         TString name = dpString-&gt;String();</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :                                         if (iDP &gt;= fgkDCSDPHallTopShift &amp;&amp; iDP &lt; fgkDCSDPHallTopShift+fgknDCSDPHallProbes) continue; // skipping Hall Probes, since they are not processed anymore</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :                                         Log(Form(&quot;******** %s ******** not present, but foreseen --&gt; causing an ERROR&quot;,name.Data()));</span>
<span class="lineNum">     405 </span>            :                                         /* //now we skip the Hall Probes completely, so this is useless
<span class="lineNum">     406 </span>            :                                            if (name != &quot;L3_BSF4_H3&quot; &amp;&amp; name != &quot;L3_BSF17_H1&quot; &amp;&amp; name != &quot;L3_BSF17_H2&quot; &amp;&amp; name != &quot;L3_BSF17_H3&quot; &amp;&amp; name != &quot;L3_BSF17_Temperature&quot; ){
<span class="lineNum">     407 </span>            :                                                 Log(Form(&quot;******** %s ******** not present, but foreseen --&gt; causing an ERROR&quot;,name.Data()));
<span class="lineNum">     408 </span>            :                                         }
<span class="lineNum">     409 </span>            :                                         else {
<span class="lineNum">     410 </span>            :                                                 Log(Form(&quot; %s is not present, but was not generating any error since it is not ready in DCS - check the other DPs in this list!&quot;,name.Data()));
<span class="lineNum">     411 </span>            :                                         }
<span class="lineNum">     412 </span>            :                                         */
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :                         error |= 8;</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :                 else  Log(Form(&quot;DCS data points, successful!&quot;));</span>
<span class="lineNum">     418 </span>            :         }
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :         else Log(Form(&quot;Statistical values for DCS DPs could not be computed due to missing DAQ_time_start and DAQ_time_end fields in DAQ logbook&quot;)); </span>
<span class="lineNum">     420 </span>            :         
<span class="lineNum">     421 </span>            :         //=======================//
<span class="lineNum">     422 </span>            :         // Trigger Configuration //
<span class="lineNum">     423 </span>            :         //=======================//
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing Trigger Configuration&quot;);</span>
<span class="lineNum">     426 </span>            : 
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :         const char * triggerConf = GetTriggerConfiguration();</span>
<span class="lineNum">     428 </span>            : 
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :         if (partition.IsNull() &amp;&amp; !detector.IsNull()){ // standalone partition</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :                 Log(&quot;STANDALONE partition for current run, using Trigger Configuration dummy value&quot;);</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :                 AliCDBEntry *cdbEntry = GetFromOCDB(&quot;CTP&quot;,&quot;DummyConfig&quot;);</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :                 if (!cdbEntry) {</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;No dummy CTP configuration entry found, going into error...&quot;));</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :                         error |= 16;</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     436 </span>            :                 else{
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :                         AliTriggerConfiguration *runcfg = (AliTriggerConfiguration*)cdbEntry-&gt;GetObject();</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :                         if (!runcfg){</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;dummy CTP config not found in OCDB entry, going into error...&quot;));</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :                                 error |= 16;</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     442 </span>            :                         else {
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :                                 TString titleCTPcfg = Form(&quot;CTP cfg for run %i from Dummy entry in OCDB&quot;,fRun);</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :                                 runcfg-&gt;SetTitle(titleCTPcfg);</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP run configuration from dummy entry in OCDB&quot;);</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Config&quot;, runcfg, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the dummy CTP run configuration object to OCDB!&quot;);</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :                                         error |= 16;</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     453 </span>            :                 }
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :         else if (!partition.IsNull() &amp;&amp; detector.IsNull()){ // global partition</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :                 Log(&quot;GLOBAL partition for current run, using Trigger Configuration from DAQ Logbook&quot;);</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :                 if (triggerConf!= NULL) {</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :                         Log(&quot;Found trigger configuration in DAQ logbook&quot;);</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :                         AliTriggerConfiguration *runcfg = AliTriggerConfiguration::LoadConfigurationFromString(triggerConf);      </span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :                         if (!runcfg) {</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :                                 Log(&quot;Bad CTP run configuration file from DAQ logbook! The corresponding CDB entry will not be filled!&quot;);</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :                                 error |= 16;</span>
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     465 </span>            :                         else {
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :                                 TString titleCTPcfg = Form(&quot;CTP cfg for run %i from DAQ&quot;,fRun);</span>
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :                                 runcfg-&gt;SetTitle(titleCTPcfg);</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :                                 metaData.SetBeamPeriod(0);</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP run configuration from DAQ logbook&quot;);</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Config&quot;, runcfg, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the CTP run configuration object to OCDB!&quot;);</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :                                         error |= 16;</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     478 </span>            : 
<span class="lineNum">     479 </span>            :                 else {
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :                         Log(&quot;Trigger configuration NULL in DAQ logbook&quot;);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                         error |= 16;</span>
<span class="lineNum">     482 </span>            :                 }
<span class="lineNum">     483 </span>            :         }
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span>            :         else {
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Incorrect field in DAQ logbook for partition = %s and detector = %s, going into error without trigger configuration...&quot;,partition.Data(),detector.Data()));</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :                 error |= 32;</span>
<span class="lineNum">     488 </span>            :         }
<span class="lineNum">     489 </span>            : 
<span class="lineNum">     490 </span>            :         //===========================//
<span class="lineNum">     491 </span>            :         // Trigger Timing Parameters //
<span class="lineNum">     492 </span>            :         //===========================//
<span class="lineNum">     493 </span>            : 
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing Trigger Time Params&quot;);</span>
<span class="lineNum">     495 </span>            :         
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :         const char * triggerCTPtiming = GetCTPTimeParams();</span>
<span class="lineNum">     497 </span>            : 
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :         if (partition.IsNull() &amp;&amp; !detector.IsNull()){ // standalone partition</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :                 Log(&quot;STANDALONE partition for current run, using CTP timing params dummy value&quot;);</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :                 AliCDBEntry *cdbEntry = GetFromOCDB(&quot;CTP&quot;,&quot;DummyCTPtime&quot;);</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :                 if (!cdbEntry) {</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;No dummy CTP timing parameters entry found, going into error...&quot;));</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :                         error |= 64;</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     505 </span>            :                 else{
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :                         AliCTPTimeParams *runCTPtiming = (AliCTPTimeParams*)cdbEntry-&gt;GetObject();</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :                         if (!runCTPtiming){</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;dummy CTP timing parameters not found in OCDB entry, going into error...&quot;));</span>
<span class="lineNum">     509 </span><span class="lineNoCov">          0 :                                 error |= 64;</span>
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     511 </span>            :                         else {
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :                                 TString titleCTPtiming = Form(&quot;CTP timing params for run %i from Dummy entry in OCDB&quot;,fRun);</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :                                 runCTPtiming-&gt;SetTitle(titleCTPtiming);</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metadata;</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :                                 metadata.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :                                 metadata.SetComment(&quot;CTP run timing parameters from dummy entry in OCDB&quot;);</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;CTPtiming&quot;, runCTPtiming, &amp;metadata, 0, 0)) {</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the dummy CTP timing params object to OCDB!&quot;);</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :                                         error |= 64;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     522 </span>            :                 }
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     524 </span>            : 
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         else if (!partition.IsNull() &amp;&amp; detector.IsNull()){ // global partition</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :                 Log(&quot;GLOBAL partition for current run, using Trigger Timing Parameters from DAQ Logbook&quot;);</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :                 if (triggerCTPtiming!= NULL) {</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :                         Log(&quot;Found trigger timing params in DAQ logbook&quot;);</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%s&quot;,triggerCTPtiming));</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :                         AliCTPTimeParams *runCTPtiming = AliCTPTimeParams::LoadCTPTimeParamsFromString(triggerCTPtiming);         </span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :                         if (!runCTPtiming) {</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :                                 Log(&quot;Bad CTP trigger timing params file from DAQ logbook! The corresponding CDB entry will not be filled!&quot;);</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :                                 error |= 64;</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     535 </span>            :                         else {
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :                                 TString titleCTPtiming = Form(&quot;CTP timing params for run %i from DAQ&quot;,fRun);</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :                                 runCTPtiming-&gt;SetTitle(titleCTPtiming);</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metadata;</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :                                 metadata.SetBeamPeriod(0);</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :                                 metadata.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :                                 metadata.SetComment(&quot;CTP timing params from DAQ logbook&quot;);</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;CTPtiming&quot;, runCTPtiming, &amp;metadata, 0, 0)) {</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the CTP timing params object to OCDB!&quot;);</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :                                         error |= 64;</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span>            :                 else {
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :                         Log(&quot;Trigger timing params NULL in DAQ logbook&quot;);</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :                         error |= 64;</span>
<span class="lineNum">     552 </span>            :                 }
<span class="lineNum">     553 </span>            :         }
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span>            :         else {
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Incorrect field in DAQ logbook for partition = %s and detector = %s, going into error without trigger timing parameters...&quot;,partition.Data(),detector.Data()));</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :                 error |= 32;</span>
<span class="lineNum">     558 </span>            :         }
<span class="lineNum">     559 </span>            : 
<span class="lineNum">     560 </span>            :         //===========================//
<span class="lineNum">     561 </span>            :         // LTU Configuration         //
<span class="lineNum">     562 </span>            :         //===========================//
<span class="lineNum">     563 </span>            : 
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing LTU Configuration&quot;);</span>
<span class="lineNum">     565 </span>            :         
<span class="lineNum">     566 </span><span class="lineNoCov">          0 :         if (partition.IsNull() &amp;&amp; !detector.IsNull()){ // standalone partition</span>
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :                 Log(&quot;STANDALONE partition for current run, using LTU configuration dummy value&quot;);</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :                 AliCDBEntry *cdbEntry = GetFromOCDB(&quot;CTP&quot;,&quot;DummyLTUConfig&quot;);</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :                 if (!cdbEntry) {</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;No dummy LTU Config entry found, going into error...&quot;));</span>
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :                         error |= 2048;</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     573 </span>            :                 else{
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :                         TObjArray *ltuConfig = (TObjArray*)cdbEntry-&gt;GetObject();</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :                         if (!ltuConfig){</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;dummy LTU Config not found in OCDB entry, going into error...&quot;));</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :                                 error |= 2048;</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     579 </span>            :                         else {
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metadata;</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :                                 metadata.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :                                 metadata.SetComment(&quot;LTU Config from dummy entry in OCDB&quot;);</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;LTUConfig&quot;, ltuConfig, &amp;metadata, 0, 0)) {</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the dummy LTU Config object to OCDB!&quot;);</span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :                                         error |= 2048;</span>
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     588 </span>            :                 }
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     590 </span>            : 
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :         else if (!partition.IsNull() &amp;&amp; detector.IsNull()){ // global partition</span>
<span class="lineNum">     592 </span>            :         
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :                 Log(&quot;GLOBAL partition for current run, getting LTU Config from DAQ Logbook (logbook_detectors table)&quot;);</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :                 UInt_t  detectorMask = (UInt_t)(((TString)GetRunParameter(&quot;detectorMask&quot;)).Atoi());</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :                 Printf (&quot;detectormask = %d&quot;,detectorMask);</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :                 TObjArray * ltuarray = new TObjArray();</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :                 ltuarray-&gt;SetOwner(1);</span>
<span class="lineNum">     598 </span>            :                 Bool_t isLTUok = kTRUE;
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :                 for(Int_t i = 0; i&lt;AliDAQ::kNDetectors-2; i++){</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :                         if ((detectorMask &gt;&gt; i) &amp; 0x1) {</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :                                 TString det = AliDAQ::OfflineModuleName(i);</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :                                 TString detCTPName = AliTriggerInput::fgkCTPDetectorName[i];</span>
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :                                 if (detCTPName == &quot;CTP&quot;) {</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :                                         detCTPName=&quot;TRG&quot;; // converting according to what is found in DAQ logbook_detectors                                   </span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :                                         Printf(&quot;Processing CTP (CTP Detector name %s) --&gt; SKIPPING, CTP does not have any LTU!!!!!!&quot;,detCTPName.Data());</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :                                         continue;</span>
<span class="lineNum">     607 </span>            :                                 }                               
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :                                 Printf(&quot;Processing detector %s (CTP Detector name %s)&quot;,det.Data(),detCTPName.Data());</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :                                 TString* ltu = GetLTUConfig(detCTPName.Data());</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :                                 if (!ltu){</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :                                         Log(Form(&quot;No LTU Configuration from DAQ logbook for detector %s (BUT it was expected)! The corresponding CDB entry will not be filled!&quot;,detCTPName.Data()));</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :                                         error |= 2048;</span>
<span class="lineNum">     613 </span>            :                                         isLTUok = kFALSE;
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :                                         break;</span>
<span class="lineNum">     615 </span>            :                                 }
<span class="lineNum">     616 </span>            :                                 else{
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :                                         Float_t ltuFineDelay1 = ltu[0].Atof();</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :                                         Float_t ltuFineDelay2 = ltu[1].Atof();</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :                                         Float_t ltuBCDelayAdd = ltu[2].Atof();</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :                                         const char* name = AliDAQ::DetectorName(i);</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :                                         AliLTUConfig* ltuConfig = new AliLTUConfig((UChar_t)AliDAQ::DetectorID(name),ltuFineDelay1,ltuFineDelay2,ltuBCDelayAdd);</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :                                         ltuarray-&gt;AddAtAndExpand(ltuConfig,i);</span>
<span class="lineNum">     623 </span>            :                                 }                               
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">     625 </span>            :                 }
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :                 if (isLTUok){</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :                         AliCDBMetaData metadata;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :                         metadata.SetBeamPeriod(0);</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :                         metadata.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :                         metadata.SetComment(&quot;LTU Configuration for current run&quot;);</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :                         if (!Store(&quot;CTP&quot;,&quot;LTUConfig&quot;, ltuarray, &amp;metadata, 0, 0)) {</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :                                 Log(&quot;Unable to store the LTU Config object to OCDB!&quot;);</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :                                 error |= 2048;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :                         }               </span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :                 delete ltuarray;</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     638 </span>            : 
<span class="lineNum">     639 </span>            :         else {
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Incorrect field in DAQ logbook for partition = %s and detector = %s, going into error without trigger timing parameters...&quot;,partition.Data(),detector.Data()));</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :                 error |= 32;</span>
<span class="lineNum">     642 </span>            :         }
<span class="lineNum">     643 </span>            : 
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span>            :         //=================//
<span class="lineNum">     646 </span>            :         // LHC Data        //
<span class="lineNum">     647 </span>            :         //=================//
<span class="lineNum">     648 </span>            : 
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :         if (runType == &quot;PHYSICS&quot;){  // processing the LHC file only in PHYSICS runs</span>
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :                 Log(&quot;\n\n*************** Processing LHC Data&quot;);</span>
<span class="lineNum">     651 </span>            : 
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :                 UInt_t iLHCData = ProcessLHCData(grpobj);</span>
<span class="lineNum">     653 </span>            :                 
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :                 if( iLHCData == 0 ) {</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;LHC Data from FXS, successful!&quot;));</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :                 } else  if (iLHCData == 1) {</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;LHC Data, problems with FXS!&quot;));</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :                         error |= 256;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :                 } else  if (iLHCData == 2) {</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;LHC Data, problems with DAQ_time_start/DAQ_time_end!&quot;));</span>
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :                         error |= 512;</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :                 } else if (iLHCData ==3){</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Problems in storing LHC Phase - going into Error&quot;));</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :                         error |= 1024;</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :                 } else if (iLHCData ==4){</span>
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Problems with LHC Phase - going into Error&quot;));</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :                         error |= 1024;</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :                 } else{</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;LHC Data problems&quot;));</span>
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :                         error |= 512;</span>
<span class="lineNum">     671 </span>            :                 }
<span class="lineNum">     672 </span>            :         
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     674 </span>            : 
<span class="lineNum">     675 </span>            :         //==================//
<span class="lineNum">     676 </span>            :         // SPD Mean Vertex  //
<span class="lineNum">     677 </span>            :         //==================//
<span class="lineNum">     678 </span>            : 
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing SPD Mean Vertex&quot;);</span>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :         if (runType == &quot;PHYSICS&quot;){</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :                 UInt_t iSPDMeanVertex = ProcessSPDMeanVertex();</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :                 if( iSPDMeanVertex == 1 ) {</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;SPD Mean Vertex, successful!&quot;));</span>
<span class="lineNum">     685 </span>            :                 } else {
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;SPD Mean Vertex failed!!!&quot;));</span>
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :                         error |= 128; </span>
<span class="lineNum">     688 </span>            :                 }
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     690 </span>            :         else {
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :                 Log(&quot;SPD Mean Vertex not processed since runType != PHYSICS&quot;);</span>
<span class="lineNum">     692 </span>            :         }
<span class="lineNum">     693 </span>            : 
<span class="lineNum">     694 </span>            :         //=================//
<span class="lineNum">     695 </span>            :         // DQM FXS         //
<span class="lineNum">     696 </span>            :         //=================//
<span class="lineNum">     697 </span>            : 
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :         Log(&quot;\n\n*************** Processing DQM FXS&quot;);</span>
<span class="lineNum">     699 </span>            : 
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :         UInt_t iDqmFxs = ProcessDqmFxs();</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :         if( iDqmFxs == 1 ) {</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;DQM FXS, successful!&quot;));</span>
<span class="lineNum">     703 </span>            :         } else {
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;DQM FXS failed!!!&quot;));</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :                 error |= 4096;</span>
<span class="lineNum">     706 </span>            :         }
<span class="lineNum">     707 </span>            : 
<span class="lineNum">     708 </span>            :         // storing AliGRPObject in OCDB
<span class="lineNum">     709 </span>            : 
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :         AliCDBMetaData md;</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :         md.SetResponsible(&quot;Chiara Zampolli&quot;);</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :         md.SetComment(&quot;Output parameters from the GRP preprocessor.&quot;);</span>
<span class="lineNum">     713 </span>            :         
<span class="lineNum">     714 </span>            :         Bool_t result = kTRUE;
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :         result = Store(&quot;GRP&quot;, &quot;Data&quot;, grpobj, &amp;md); </span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :         delete grpobj;</span>
<span class="lineNum">     717 </span>            : 
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :         if (result &amp;&amp; !error ) {</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :                 Log(&quot;GRP Preprocessor Success&quot;);</span>
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">     721 </span>            :         } else {
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :                 Log( Form(&quot;GRP Preprocessor FAILS!!! %s%s%s%s%s%s%s%s%s%s%s%s%s%s&quot;,</span>
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;1)?1:0],</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;2)?2:0],</span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;4)?3:0],</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;8)?4:0],</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;16)?5:0],</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;32)?6:0],</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;64)?7:0],</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;128)?8:0],</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;256)?9:0],</span>
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;512)?10:0],</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;1024)?11:0],</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;2048)?12:0],</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;4096)?13:0],</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :                           kppError[(error&amp;8192)?14:0]</span>
<span class="lineNum">     737 </span>            :                           ));
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :                 return error;</span>
<span class="lineNum">     739 </span>            :         }
<span class="lineNum">     740 </span>            : 
<span class="lineNum">     741 </span>            : 
<span class="lineNum">     742 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     743 </span>            : 
<a name="744"><span class="lineNum">     744 </span>            : //_______________________________________________________________</a>
<span class="lineNum">     745 </span>            : 
<span class="lineNum">     746 </span>            : UInt_t AliGRPPreprocessor::ProcessLHCData(AliGRPObject *grpobj)
<span class="lineNum">     747 </span>            : {
<span class="lineNum">     748 </span>            :         //
<span class="lineNum">     749 </span>            :         //Getting the LHC Data from DCS FXS
<span class="lineNum">     750 </span>            :         //
<span class="lineNum">     751 </span>            : 
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :         TString timeStartString = (TString)GetRunParameter(&quot;DAQ_time_start&quot;);</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :         TString timeEndString = (TString)GetRunParameter(&quot;DAQ_time_end&quot;);</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :         if (timeStartString.IsNull() || timeEndString.IsNull()){</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :                 if (timeStartString.IsNull()){ </span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_start not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">     757 </span>            :                 }
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :                 else if (timeEndString.IsNull()){</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_end not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">     760 </span>            :                 }
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :                 return 2;</span>
<span class="lineNum">     762 </span>            :         }  
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :         Double_t timeStart = timeStartString.Atof();</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :         Double_t timeEnd = timeEndString.Atof();</span>
<span class="lineNum">     766 </span>            : 
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :         TString fileName = GetFile(kDCS, &quot;LHCData&quot;,&quot;&quot;);</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :         if (fileName.Length()&gt;0){</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;Got The LHC Data file&quot;);</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :                 AliLHCReader lhcReader;</span>
<span class="lineNum">     771 </span>            : 
<span class="lineNum">     772 </span>            :                 // Processing data to be put in AliGRPObject
<span class="lineNum">     773 </span>            : 
<span class="lineNum">     774 </span>            :                 // Energy
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* Energy &quot;);</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :                 TObjArray* energyArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[0]);</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :                 if (energyArray){                       </span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :                         Float_t energy = ProcessEnergy(energyArray,timeStart);</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                         if (energy != -1.) {</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :                                 grpobj-&gt;SetBeamEnergy(energy);</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :                                 grpobj-&gt;SetBeamEnergyIsSqrtSHalfGeV(kTRUE);</span>
<span class="lineNum">     782 </span>            :                         }
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :                         delete energyArray;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     785 </span>            :                 else {
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :                         AliError(&quot;Energy not found in LHC Data file!!!&quot;);</span>
<span class="lineNum">     787 </span>            :                 }       
<span class="lineNum">     788 </span>            : 
<span class="lineNum">     789 </span>            :                 Double_t timeBeamModeEnd = timeEnd;        // max validity for Beam Mode 
<span class="lineNum">     790 </span>            :                 Double_t timeMachineModeEnd = timeEnd;     // max validity for Machine Mode
<span class="lineNum">     791 </span>            :                 Double_t timeBeamEnd = timeEnd;            // max validity for Beam Type
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :                 Double_t timeBeamTypeEnd[2] = {timeEnd, timeEnd}; // max validity for Beam Type1,2</span>
<span class="lineNum">     793 </span>            :                 Double_t timeBeamModeStart = -1;    // min validity for Beam Mode
<span class="lineNum">     794 </span>            :                 Double_t timeMachineModeStart = -1; // min validity for Machine Mode
<span class="lineNum">     795 </span>            :                 Double_t timeBeamStart = -1;        // min validity for Beam Type
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :                 Double_t timeBeamTypeStart[2] = {-1,-1};        // min validity for Beam Type1,2</span>
<span class="lineNum">     797 </span>            :                 Int_t indexBeamMode = -1;                  // index of measurement used to set Beam Mode
<span class="lineNum">     798 </span>            :                 Int_t indexMachineMode = -1;               // index of measurement used to set Machine Mode
<span class="lineNum">     799 </span>            :                 Int_t indexBeam = -1;                      // index of measurement used to set Beam Type
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :                 Int_t indexBeamType[2] = {-1, -1};                      // index of measurement used to set Beam Type1,2</span>
<span class="lineNum">     801 </span>            :                 Bool_t foundBeamModeStart = kFALSE;        // flag to be set in case an entry for the Beam Mode is found before (or at) SOR
<span class="lineNum">     802 </span>            :                 Bool_t foundMachineModeStart = kFALSE;     // flag to be set in case an entry for the Machine Mode is found before (or at) SOR
<span class="lineNum">     803 </span>            :                 Bool_t foundBeamStart = kFALSE;            // flag to be set in case an entry for the Beam Type is found before (or at) SOR
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :                 Bool_t foundBeamTypeStart[2] = {kFALSE, kFALSE};            // flag to be set in case an entry for the Beam Type1,2 is found before (or at) SOR</span>
<span class="lineNum">     805 </span>            :                 Bool_t flagBeamMode = kFALSE;  //flag set true if a changed occurred in BeamMode
<span class="lineNum">     806 </span>            :                 Bool_t flagMachineMode = kFALSE;  //flag set true if a changed occurred in MachineMode
<span class="lineNum">     807 </span>            :                 Bool_t flagBeam = kFALSE;  //flag set true if a changed occurred in BeamType
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :                 Bool_t flagBeamType[2] = {kFALSE, kFALSE};  //flag set true if a changed occurred in BeamType1,2</span>
<span class="lineNum">     809 </span>            :                 
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :                 Double_t arrayTimes[5]={2.E9, 2.E9, 2.E9, 2.E9, 2.E9}; // array to keep track of the times of the possible changes of the LHC DPs; each entry set to Wed May 18 2033, 03:33:20 GMT (ALICE should not be running anymore...)</span>
<span class="lineNum">     811 </span>            :                                                                        // arrayTimes elements order correspond to the one used in the array of the strings fgkLHCDataPoints, i.e.:
<span class="lineNum">     812 </span>            :                                                                        // arrayTimes[0] --&gt; MachineMode
<span class="lineNum">     813 </span>            :                                                                        // arrayTimes[1] --&gt; BeamMode
<span class="lineNum">     814 </span>            :                                                                        // arrayTimes[2] --&gt; BeamType (when written together)
<span class="lineNum">     815 </span>            :                                                                        // arrayTimes[3] --&gt; BeamType1 (when written separate)
<span class="lineNum">     816 </span>            :                                                                        // arrayTimes[4] --&gt; BeamType2 (when written separate)
<span class="lineNum">     817 </span>            : 
<span class="lineNum">     818 </span>            :                 // BeamMode
<span class="lineNum">     819 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* BeamMode (LHCState) &quot;);</span>
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :                 Bool_t forceStableBeam = (Bool_t)(((TString)GetRunParameter(&quot;forceLHCReco&quot;)).Atoi());</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :                 AliInfoF(&quot;Query forceLHCReco logbook flag: %s&quot;,forceStableBeam ? &quot;ON&quot;:&quot;OFF&quot;);</span>
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :                 TObjArray* beamModeArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[2]);              </span>
<span class="lineNum">     823 </span>            :                 Int_t nBeamMode = -1;
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :                 if (beamModeArray){     </span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :                         nBeamMode = beamModeArray-&gt;GetEntries();     </span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :                         if (nBeamMode==0){</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :                                 AliInfo(&quot;Found zero entries for the Beam Mode, leaving it empty&quot;);</span>
<span class="lineNum">     828 </span>            :                         }
<span class="lineNum">     829 </span>            :                         else{
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :                                 for (Int_t iBeamMode = 0; iBeamMode&lt;nBeamMode; iBeamMode++){</span>
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :                                         AliDCSArray* beamMode = (AliDCSArray*)beamModeArray-&gt;At(iBeamMode);</span>
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :                                         if (beamMode){</span>
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :                                                 if (beamMode-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; beamMode-&gt;GetTimeStamp()&gt;=timeBeamModeStart){// taking always the very last entry: of two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :                                                         timeBeamModeStart = beamMode-&gt;GetTimeStamp();</span>
<span class="lineNum">     835 </span>            :                                                         indexBeamMode = iBeamMode;
<span class="lineNum">     836 </span>            :                                                         foundBeamModeStart = kTRUE;
<span class="lineNum">     837 </span>            :                                                 }
<span class="lineNum">     838 </span>            :                                                 else {
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :                                                         break;</span>
<span class="lineNum">     840 </span>            : 
<span class="lineNum">     841 </span>            :                                                 }
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :                                 if (!foundBeamModeStart){</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :                                         AliInfo(&quot;No value for the Beam Mode found before start of run, the Beam Mode will remain empty&quot;);</span>
<span class="lineNum">     846 </span>            :                                 }
<span class="lineNum">     847 </span>            :                                 else {
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :                                         AliDCSArray* beamMode = (AliDCSArray*)beamModeArray-&gt;At(indexBeamMode);</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :                                         TObjString* beamModeString = beamMode-&gt;GetStringArray(0);</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :                                         TString lhcStateS = beamModeString-&gt;String();                                        </span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;LHC State (corresponding to BeamMode) = %s (set at %f)&quot;,lhcStateS.Data(),beamMode-&gt;GetTimeStamp()));</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :                                         if (forceStableBeam) {</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :                                           TPRegexp reStable(&quot;^STABLE[_ ]BEAMS$&quot;);</span>
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :                                           if (lhcStateS.Index(reStable)) {</span>
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :                                             AliInfoF(&quot;Overriding LHC beam state from \&quot;%s\&quot; to \&quot;%s\&quot;&quot;,lhcStateS.Data(),&quot;STABLE BEAMS&quot;);</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :                                             lhcStateS = &quot;STABLE BEAMS&quot;;</span>
<span class="lineNum">     857 </span>            :                                           }
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :                                         grpobj-&gt;SetLHCState(lhcStateS);</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :                                         if (indexBeamMode &lt; nBeamMode-1){</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* beamMode1 = (AliDCSArray*)beamModeArray-&gt;At(indexBeamMode+1);</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                                                 if (beamMode1){</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                                                         if (beamMode1-&gt;GetTimeStamp()&lt;=timeStart){</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :                                                                 AliError(&quot;you did not choose the correct value! there is still something before (or at) SOR, but later than this!&quot;);</span>
<span class="lineNum">     865 </span>            :                                                         }
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :                                                         else if (beamMode1-&gt;GetTimeStamp()&gt;timeStart &amp;&amp; beamMode1-&gt;GetTimeStamp()&lt;=timeEnd){</span>
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :                                                                 timeBeamModeEnd = beamMode1-&gt;GetTimeStamp();</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :                                                                 TObjString* beamModeString1 = beamMode1-&gt;GetStringArray(0);</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :                                                                 TString bmString0 = beamModeString-&gt;String();</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :                                                                 TString bmString1 = beamModeString1-&gt;String();</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :                                                                 if (bmString0.CompareTo(bmString1.Data(),TString::kIgnoreCase) == -1){</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :                                                                         AliWarning(Form(&quot;The beam mode changed from %s to %s during the run at timestamp %f! Setting it to %s and keeping track of the time of the change to set MaxTimeLHCValidity afterward&quot;,bmString0.Data(), bmString1.Data(), timeBeamModeEnd, bmString0.Data()));</span>
<span class="lineNum">     873 </span>            :                                                                         flagBeamMode = kTRUE;
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :                                                                         arrayTimes[1]=timeBeamModeEnd;</span>
<span class="lineNum">     875 </span>            : 
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :                                                                 }</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :                                                         }</span>
<span class="lineNum">     878 </span>            :                                                 }
<span class="lineNum">     879 </span>            :                                                 else {
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :                                                         AliInfo(&quot;Invalid pointer for the first entry for Beam Mode after the first valid one, not considering anything after what has already been found&quot;);</span>
<span class="lineNum">     881 </span>            :                                                 }
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     884 </span>            :                         }
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :                         delete beamModeArray;</span>
<span class="lineNum">     886 </span>            :                 }
<span class="lineNum">     887 </span>            :                 else{
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :                         AliError(&quot;Beam mode array not found in LHC Data file!!!&quot;);</span>
<span class="lineNum">     889 </span>            :                 }
<span class="lineNum">     890 </span>            :                 
<span class="lineNum">     891 </span>            :                 // MachineMode
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* MachineMode &quot;);</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :                 TObjArray* machineModeArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[1]);</span>
<span class="lineNum">     894 </span>            :                 Int_t nMachineMode = -1;
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :                 if (machineModeArray){</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :                         nMachineMode = machineModeArray-&gt;GetEntries();</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :                         if (nMachineMode==0){</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :                                 AliInfo(&quot;No Machine Mode found, leaving it empty&quot;);</span>
<span class="lineNum">     899 </span>            :                         }
<span class="lineNum">     900 </span>            :                         else{
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :                                 for (Int_t iMachineMode = 0; iMachineMode&lt;nMachineMode; iMachineMode++){</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :                                         AliDCSArray* machineMode = (AliDCSArray*)machineModeArray-&gt;At(iMachineMode);</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :                                         if (machineMode){</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :                                                 if (machineMode-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; machineMode-&gt;GetTimeStamp()&gt;=timeMachineModeStart){// taking always the very last entry: of two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :                                                         timeMachineModeStart = machineMode-&gt;GetTimeStamp();</span>
<span class="lineNum">     906 </span>            :                                                         indexMachineMode = iMachineMode;
<span class="lineNum">     907 </span>            :                                                         foundMachineModeStart = kTRUE;
<span class="lineNum">     908 </span>            :                                                 }
<span class="lineNum">     909 </span>            :                                                 else{
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :                                                         break;</span>
<span class="lineNum">     911 </span>            :                                                 }
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :                                 if (!foundMachineModeStart){</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :                                         AliInfo(&quot;No value for the Machine Mode found before start of run, the Machine Mode will remain empty&quot;);</span>
<span class="lineNum">     916 </span>            :                                 }
<span class="lineNum">     917 </span>            :                                 else {
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :                                         AliDCSArray* machineMode = (AliDCSArray*)machineModeArray-&gt;At(indexMachineMode);</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :                                         TObjString* machineModeString = machineMode-&gt;GetStringArray(0);</span>
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;MachineMode = %s (set at %f)&quot;,(machineModeString-&gt;String()).Data(),machineMode-&gt;GetTimeStamp()));</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :                                         grpobj-&gt;SetMachineMode(machineModeString-&gt;String());</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :                                         if (indexMachineMode &lt; nMachineMode-1){</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* machineMode1 = (AliDCSArray*)machineModeArray-&gt;At(indexMachineMode+1);</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :                                                 if (machineMode1){</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :                                                         if (machineMode1-&gt;GetTimeStamp()&gt;timeStart &amp;&amp; machineMode1-&gt;GetTimeStamp()&lt;=timeEnd){</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :                                                                 timeMachineModeEnd = machineMode1-&gt;GetTimeStamp();</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :                                                                 TObjString* machineModeString1 = machineMode1-&gt;GetStringArray(0);</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :                                                                 TString mmString0 = machineModeString-&gt;String();</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :                                                                 TString mmString1 = machineModeString1-&gt;String();</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :                                                                 if (mmString0.CompareTo(mmString1.Data(),TString::kIgnoreCase) == -1){</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :                                                                         AliWarning(Form(&quot;The machine mode changed from %s to %s during the run at timestamp %f! Setting it to %s and keeping track of the time of the change to set MaxTimeLHCValidity afterward&quot;,mmString0.Data(),mmString1.Data(),timeMachineModeEnd,mmString0.Data()));</span>
<span class="lineNum">     932 </span>            :                                                                         flagMachineMode = kTRUE;
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :                                                                         arrayTimes[0]=timeMachineModeEnd;</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :                                                                 }</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :                                                         }</span>
<span class="lineNum">     936 </span>            :                                                 }
<span class="lineNum">     937 </span>            :                                                 else {
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :                                                         AliInfo(&quot;Invalid pointer for the first entry for Machine Mode after the first valid one, not considering anything after what has already been found&quot;);</span>
<span class="lineNum">     939 </span>            :                                                 }
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     941 </span>            :                                 }
<span class="lineNum">     942 </span>            :                         }
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :                         delete machineModeArray;</span>
<span class="lineNum">     944 </span>            :                 }
<span class="lineNum">     945 </span>            :                 else{
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :                         AliError(&quot;Machine mode array not found in LHC Data file!!!&quot;);</span>
<span class="lineNum">     947 </span>            :                 }
<span class="lineNum">     948 </span>            :                 
<span class="lineNum">     949 </span>            :                 // BeamType1 and BeamType2 - both put in the same string
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* BeamType &quot;);</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :                 TObjArray* beamArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[3]);</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :                 if (beamArray){                 </span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :                         Int_t nBeam = beamArray-&gt;GetEntries();</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :                         if (nBeam==0){</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :                                 AliInfo(&quot;No Beam Type found, leaving it empty&quot;);</span>
<span class="lineNum">     956 </span>            :                         }
<span class="lineNum">     957 </span>            :                         else{
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :                                 for (Int_t iBeam = 0; iBeam&lt;nBeam; iBeam++){</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :                                         AliDCSArray* beam = (AliDCSArray*)beamArray-&gt;At(iBeam);</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :                                         if (beam){</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :                                                 if (beam-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; beam-&gt;GetTimeStamp()&gt;=timeBeamStart){// taking always the very last entry: of two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :                                                         timeBeamStart = beam-&gt;GetTimeStamp();</span>
<span class="lineNum">     963 </span>            :                                                         indexBeam = iBeam;
<span class="lineNum">     964 </span>            :                                                         foundBeamStart = kTRUE;
<span class="lineNum">     965 </span>            :                                                 }
<span class="lineNum">     966 </span>            :                                                 else{
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :                                                         break;</span>
<span class="lineNum">     968 </span>            :                                                 }
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :                                 if (!foundBeamStart){</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :                                         AliInfo(&quot;No value for the Beam Type found before start of run, the (common) Beam Type will remain empty&quot;);</span>
<span class="lineNum">     973 </span>            :                                 }
<span class="lineNum">     974 </span>            :                                 else {
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :                                         AliDCSArray* beam = (AliDCSArray*)beamArray-&gt;At(indexBeam);</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :                                         TObjString* beamString = beam-&gt;GetStringArray(0);</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :                                         TString beamType = beamString-&gt;String();</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;Beam Type = %s&quot;,beamType.Data()));      </span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :                                         if (beamType.CompareTo(&quot;PROTON&quot;,TString::kIgnoreCase) == 0){</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :                                                 AliInfo(&quot;Setting beam type to p-p&quot;);</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :                                                 grpobj-&gt;SetBeamType(&quot;p-p&quot;);</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">     983 </span>            :                                         else { // if there is no PROTON beam, we suppose it is Pb, and we put A-A
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :                                                 AliInfo(&quot;Setting beam type to A-A&quot;);</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :                                                 grpobj-&gt;SetBeamType(&quot;A-A&quot;);</span>
<span class="lineNum">     986 </span>            :                                         }
<span class="lineNum">     987 </span>            :                                         /*
<span class="lineNum">     988 </span>            :                                           else if (beamType.CompareTo(&quot;LEAD82&quot;,TString::kIgnoreCase) == 0){
<span class="lineNum">     989 </span>            :                                                 AliInfo(&quot;Setting beam type to Pb-Pb&quot;);
<span class="lineNum">     990 </span>            :                                                 grpobj-&gt;SetBeamType(&quot;Pb-Pb&quot;);
<span class="lineNum">     991 </span>            :                                         }
<span class="lineNum">     992 </span>            :                                         else{
<span class="lineNum">     993 </span>            :                                                 AliError(&quot;Beam Type not known, leaving it empty&quot;);
<span class="lineNum">     994 </span>            :                                         }
<span class="lineNum">     995 </span>            :                                         */
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :                                         if (indexBeam &lt; nBeam-1){</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* beam1 = (AliDCSArray*)beamArray-&gt;At(indexBeam+1);</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :                                                 if (beam1){</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :                                                         if (beam1-&gt;GetTimeStamp()&gt;timeStart &amp;&amp; beam1-&gt;GetTimeStamp()&lt;=timeEnd){</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :                                                                 timeBeamEnd = beam1-&gt;GetTimeStamp();</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :                                                                 TObjString* beamString1 = beam1-&gt;GetStringArray(0);</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :                                                                 TString beamType1 = beamString1-&gt;String();</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :                                                                 if (beamType.CompareTo(beamType1.Data(),TString::kIgnoreCase) == -1){</span>
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :                                                                         AliWarning(Form(&quot;The Beam Type changed from %s to %s during the run at timestamp %f! Setting it to %s and keeping track of the time of the change to set MaxTimeLHCValidity afterward&quot;,beamType.Data(),(beamString1-&gt;String()).Data(),timeBeamEnd,beamType.Data()));</span>
<span class="lineNum">    1005 </span>            :                                                                         flagBeam = kTRUE;
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                                                                         arrayTimes[2] = timeBeamEnd;</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :                                                                 }</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                                                         }</span>
<span class="lineNum">    1009 </span>            :                                                 }
<span class="lineNum">    1010 </span>            :                                                 else {
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                                                         AliInfo(&quot;Invalid pointer for the first entry for Beam Type after the first valid one, not considering anything after what has already been found&quot;);</span>
<span class="lineNum">    1012 </span>            :                                                 }
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    1015 </span>            :                         }
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :                         delete beamArray;</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1018 </span>            :                 else{
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :                         AliError(&quot;Beam Type array not found in LHC Data file!!!&quot;);</span>
<span class="lineNum">    1020 </span>            :                 }               
<span class="lineNum">    1021 </span>            : 
<span class="lineNum">    1022 </span>            :                 // BeamType1 and BeamType2 - in separete string
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* BeamType, 1 and 2 &quot;);</span>
<span class="lineNum">    1024 </span>            :                 Int_t indexBeamTypeString = 6;  // index of the string with the alias of BeanType1 in the array fgkLHCDataPoints
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :                 TString combinedBeamType = &quot;-&quot;;  // combined beam type, built from beam type 1 and beam type 2</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :                 TString combinedBeamTypeFromLHC = &quot;-&quot;;  // combined beam type, built from beam type 1 and beam type 2 AS SENT FROM LHC</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :                 for (Int_t ibeamType = 0; ibeamType&lt;2; ibeamType++){</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :                         beamArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[indexBeamTypeString+ibeamType]);</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :                         if (beamArray){                 </span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :                                 Int_t nBeam = beamArray-&gt;GetEntries();</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :                                 if (nBeam==0){</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;No Beam Type %s found, leaving it empty&quot;,fgkLHCDataPoints[indexBeamTypeString+ibeamType]));</span>
<span class="lineNum">    1033 </span>            :                                 }
<span class="lineNum">    1034 </span>            :                                 else{
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :                                         for (Int_t iBeam = 0; iBeam&lt;nBeam; iBeam++){</span>
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* beam = (AliDCSArray*)beamArray-&gt;At(iBeam);</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :                                                 if (beam){</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :                                                         if (beam-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; beam-&gt;GetTimeStamp()&gt;=timeBeamTypeStart[ibeamType]){// taking always the very last entry: of two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :                                                                 timeBeamTypeStart[ibeamType] = beam-&gt;GetTimeStamp();</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :                                                                 indexBeamType[ibeamType] = iBeam;</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :                                                                 foundBeamTypeStart[ibeamType] = kTRUE;</span>
<span class="lineNum">    1042 </span>            :                                                         }
<span class="lineNum">    1043 </span>            :                                                         else{
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :                                                                 break;</span>
<span class="lineNum">    1045 </span>            :                                                         }
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :                                         if (!foundBeamTypeStart[ibeamType]){</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :                                                 AliInfo(Form(&quot;No value for the Beam Type %s found before start of run, the Beam Type %d will remain empty&quot;, fgkLHCDataPoints[indexBeamTypeString+ibeamType], ibeamType));</span>
<span class="lineNum">    1050 </span>            :                                         }
<span class="lineNum">    1051 </span>            :                                         else {
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* beam = (AliDCSArray*)beamArray-&gt;At(indexBeam);</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :                                                 TObjString* beamString = beam-&gt;GetStringArray(0);</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :                                                 TString beamType = beamString-&gt;String();</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :                                                 AliInfo(Form(&quot;Beam Type (for %s) = %s&quot;, fgkLHCDataPoints[indexBeamTypeString+ibeamType], beamType.Data()));</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :                                                 TString singleBeam = ParseBeamTypeString(beamType,ibeamType);</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :                                                 AliInfo(Form(&quot;Single Beam Type for beam %d set to %s&quot;, ibeamType, singleBeam.Data()));</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :                                                 grpobj-&gt;SetSingleBeamType(ibeamType, singleBeam);</span>
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :                                                 if (beamType.CompareTo(&quot;PROTON&quot;,TString::kIgnoreCase) == 0){</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :                                                         AliInfo(Form(&quot;Setting beam %d for combined beam type to p&quot;, ibeamType));</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :                                                         if (ibeamType == 0) combinedBeamType.Prepend(&quot;p&quot;); </span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :                                                         else combinedBeamType.Append(&quot;p&quot;);</span>
<span class="lineNum">    1063 </span>            :                                                 }
<span class="lineNum">    1064 </span>            :                                                 else { // if there is no PROTON beam, we suppose it is Pb, and we put A-A
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :                                                         AliInfo(Form(&quot;Setting beam %d for combined beam type to A&quot;,ibeamType));</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :                                                         if (ibeamType == 0) combinedBeamType.Prepend(&quot;A&quot;);</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :                                                         else combinedBeamType.Append(&quot;A&quot;);</span>
<span class="lineNum">    1068 </span>            :                                                 }
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :                                                 if (ibeamType == 0) combinedBeamTypeFromLHC.Prepend(beamType); </span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :                                                 else combinedBeamTypeFromLHC.Append(beamType);</span>
<span class="lineNum">    1071 </span>            :                                                 /*
<span class="lineNum">    1072 </span>            :                                                   else if (beamType.CompareTo(&quot;LEAD82&quot;,TString::kIgnoreCase) == 0){
<span class="lineNum">    1073 </span>            :                                                   AliInfo(&quot;Setting beam type to Pb-Pb&quot;);
<span class="lineNum">    1074 </span>            :                                                   grpobj-&gt;SetSingleBeamType(ibeamType, &quot;Pb-Pb&quot;);
<span class="lineNum">    1075 </span>            :                                                   }
<span class="lineNum">    1076 </span>            :                                                   else{
<span class="lineNum">    1077 </span>            :                                                   AliError(&quot;Beam Type not known, leaving it empty&quot;);
<span class="lineNum">    1078 </span>            :                                                   }
<span class="lineNum">    1079 </span>            :                                                 */
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :                                                 if (indexBeamType[ibeamType] &lt; nBeam-1){</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :                                                         AliDCSArray* beam1 = (AliDCSArray*)beamArray-&gt;At(indexBeam+1);</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :                                                         if (beam1){</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :                                                                 if (beam1-&gt;GetTimeStamp()&gt;timeStart &amp;&amp; beam1-&gt;GetTimeStamp()&lt;=timeEnd){</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :                                                                         timeBeamTypeEnd[ibeamType] = beam1-&gt;GetTimeStamp();</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :                                                                         TObjString* beamString1 = beam1-&gt;GetStringArray(0);</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :                                                                         TString beamType1 = beamString1-&gt;String();</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :                                                                         if (beamType.CompareTo(beamType1.Data(),TString::kIgnoreCase) == -1){</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :                                                                                 AliWarning(Form(&quot;The Beam Type for %s changed from %s to %s during the run at timestamp %f! Setting it to %s and keeping track of the time of the change to set MaxTimeLHCValidity afterward&quot;,fgkLHCDataPoints[indexBeamTypeString+ibeamType],beamType.Data(),(beamString1-&gt;String()).Data(),timeBeamEnd,beamType.Data()));</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :                                                                                 flagBeamType[ibeamType] = kTRUE;</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :                                                                                 arrayTimes[3+ibeamType] = timeBeamTypeEnd[ibeamType];</span>
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :                                                                         }</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :                                                                 }</span>
<span class="lineNum">    1093 </span>            :                                                         }
<span class="lineNum">    1094 </span>            :                                                         else {
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :                                                                 AliInfo(Form(&quot;Invalid pointer for the first entry for Beam Type %s after the first valid one, not considering anything after what has already been found&quot;,fgkLHCDataPoints[indexBeamTypeString+ibeamType]));</span>
<span class="lineNum">    1096 </span>            :                                                         }
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1099 </span>            :                                 }
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :                                 delete beamArray;</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1102 </span>            :                         else{
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;Beam Type %s array not found in LHC Data file!!!&quot;,fgkLHCDataPoints[indexBeamTypeString+ibeamType]));</span>
<span class="lineNum">    1104 </span>            :                         }               
<span class="lineNum">    1105 </span>            :                 }
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :                 AliInfo(Form(&quot;Setting combined beam type to %s&quot;,combinedBeamType.Data()));</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :                 grpobj-&gt;SetBeamType(combinedBeamType);</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                 AliInfo(Form(&quot;Setting combined beam type form LHC to %s&quot;,combinedBeamTypeFromLHC.Data()));</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                 grpobj-&gt;SetBeamTypeFromLHC(combinedBeamTypeFromLHC);</span>
<span class="lineNum">    1110 </span>            :                 
<span class="lineNum">    1111 </span>            :                 // Setting minTimeLHCValidity
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :                 if (flagBeamMode == kTRUE || flagMachineMode == kTRUE || flagBeam == kTRUE || flagBeamType[0] == kTRUE || flagBeamType[1] == kTRUE){ </span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :                         Double_t minTimeLHCValidity= TMath::MinElement(5,arrayTimes);</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :                         AliWarning(Form(&quot;Setting MaxTimeLHCValidity to %f&quot;,minTimeLHCValidity));</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :                         grpobj-&gt;SetMaxTimeLHCValidity(minTimeLHCValidity);</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1117 </span>            :                 /* 
<span class="lineNum">    1118 </span>            :                    // Old way to determine the Maximum Time during which the LHC info is valid
<span class="lineNum">    1119 </span>            :                 if (timeBeamModeEnd!=0 || timeMachineModeEnd!=0 || timeBeamEnd !=0){
<span class="lineNum">    1120 </span>            :                         Double_t minTimeLHCValidity;
<span class="lineNum">    1121 </span>            :                         if (flagBeamMode == kFALSE &amp;&amp; flagMachineMode == kFALSE &amp;&amp; flagBeam == kTRUE){ // flagBeam only true --&gt; it is the only one that changed
<span class="lineNum">    1122 </span>            :                                 minTimeLHCValidity = timeBeamEnd;
<span class="lineNum">    1123 </span>            :                         }
<span class="lineNum">    1124 </span>            :                         else if (flagBeamMode == kFALSE &amp;&amp; flagMachineMode == kTRUE &amp;&amp; flagBeam == kFALSE){ // flagMachineMode only true
<span class="lineNum">    1125 </span>            :                                 minTimeLHCValidity = timeMachineModeEnd;
<span class="lineNum">    1126 </span>            :                         }
<span class="lineNum">    1127 </span>            :                         else if (flagBeamMode == kTRUE &amp;&amp; flagMachineMode == kFALSE &amp;&amp; flagBeam == kFALSE){ // flagBeamMode only true
<span class="lineNum">    1128 </span>            :                                 minTimeLHCValidity = timeBeamModeEnd;
<span class="lineNum">    1129 </span>            :                         }
<span class="lineNum">    1130 </span>            :                         else if (flagBeamMode == kFALSE &amp;&amp; flagMachineMode == kTRUE &amp;&amp; flagBeam == kTRUE){ // flagBeam and flagMachineMode only true
<span class="lineNum">    1131 </span>            :                                 minTimeLHCValidity= TMath::Min(timeBeamEnd,timeMachineModeEnd);
<span class="lineNum">    1132 </span>            :                         }
<span class="lineNum">    1133 </span>            :                         else if (flagBeamMode == kTRUE &amp;&amp; flagMachineMode == kFALSE &amp;&amp; flagBeam == kTRUE){ // flagBeam and flagBeamMode only true
<span class="lineNum">    1134 </span>            :                                 minTimeLHCValidity= TMath::Min(timeBeamEnd,timeBeamModeEnd);
<span class="lineNum">    1135 </span>            :                         }
<span class="lineNum">    1136 </span>            :                         else if (flagBeamMode == kTRUE &amp;&amp; flagMachineMode == kTRUE &amp;&amp; flagBeam == kFALSE){ // flagMachineMode and flagBeamMode only true
<span class="lineNum">    1137 </span>            :                                 minTimeLHCValidity= TMath::Min(timeMachineModeEnd,timeBeamModeEnd);
<span class="lineNum">    1138 </span>            :                         }
<span class="lineNum">    1139 </span>            :                         else {
<span class="lineNum">    1140 </span>            :                                 Double_t arrayTimes[3] = {timeBeamModeEnd,timeMachineModeEnd,timeBeamEnd};// flagMachineMode and flagBeamMode and flagBeam 
<span class="lineNum">    1141 </span>            :                                 minTimeLHCValidity= TMath::MinElement(3,arrayTimes);
<span class="lineNum">    1142 </span>            :                         }
<span class="lineNum">    1143 </span>            :                         AliWarning(Form(&quot;Setting MaxTimeLHCValidity to %f&quot;,minTimeLHCValidity));
<span class="lineNum">    1144 </span>            :                         grpobj-&gt;SetMaxTimeLHCValidity(minTimeLHCValidity);
<span class="lineNum">    1145 </span>            :                 }
<span class="lineNum">    1146 </span>            :                 */
<span class="lineNum">    1147 </span>            :                 
<span class="lineNum">    1148 </span>            :                 // Data Quality Flag --&gt; storing start and end values of periods within the run during which the value was found to be FALSE
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :                 Log(&quot;\n   ************* Data Quality Flag &quot;);</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :                 TObjArray* dataQualityArray = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[8]);</span>
<span class="lineNum">    1151 </span>            :                 Int_t nDataQuality = -1;
<span class="lineNum">    1152 </span>            :                 Double_t timeDataQualityStart = -1; // min validity for Data Quality Flag
<span class="lineNum">    1153 </span>            :                 Int_t indexDataQuality = -1;               // index of first measurement used to set Data Quality Flag
<span class="lineNum">    1154 </span>            :                 Bool_t foundDataQualityStart = kFALSE;     // flag to be set in case an entry for the Data Quality Flag is found before (or at) SOR
<span class="lineNum">    1155 </span>            : 
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :                 if (dataQualityArray){</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :                         nDataQuality = dataQualityArray-&gt;GetEntries();</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :                         if (nDataQuality==0){</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :                                 AliInfo(&quot;No Data Quality Flag found, leaving it empty&quot;);</span>
<span class="lineNum">    1160 </span>            :                         }
<span class="lineNum">    1161 </span>            :                         else{
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :                                 for (Int_t iDataQuality = 0; iDataQuality&lt;nDataQuality; iDataQuality++){</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :                                         AliDCSArray* dataQuality = (AliDCSArray*)dataQualityArray-&gt;At(iDataQuality);</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :                                         if (dataQuality){</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :                                                 if (dataQuality-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; dataQuality-&gt;GetTimeStamp()&gt;=timeDataQualityStart){// taking always the very last entry: if two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :                                                         timeDataQualityStart = dataQuality-&gt;GetTimeStamp();</span>
<span class="lineNum">    1167 </span>            :                                                         indexDataQuality = iDataQuality;
<span class="lineNum">    1168 </span>            :                                                         foundDataQualityStart = kTRUE;
<span class="lineNum">    1169 </span>            :                                                 }
<span class="lineNum">    1170 </span>            :                                                 else{
<span class="lineNum">    1171 </span>            :                                                         // we suppose here that if the first measurement is not before SOR, then none will be (they MUST be in chronological order!!!) 
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :                                                         break;</span>
<span class="lineNum">    1173 </span>            :                                                 }
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :                                 if (!foundDataQualityStart){</span>
<span class="lineNum">    1177 </span>            :                                         // The Data Quality Flag should be found and TRUE at the start of the run. For the time being, if it is not found, don't do anything, but it means there is a problem..
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :                                         AliInfo(&quot;No value for the Data Quality Flag found before start of run, the Data Quality Flag will remain empty&quot;);</span>
<span class="lineNum">    1179 </span>            :                                 }
<span class="lineNum">    1180 </span>            :                                 else {
<span class="lineNum">    1181 </span>            :                                         // counting how many FALSE values there are
<span class="lineNum">    1182 </span>            :                                         Bool_t foundEndOfFalse = kFALSE;
<span class="lineNum">    1183 </span>            :                                         Int_t nFalse = 0;
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :                                         for (Int_t iDataQuality = indexDataQuality; iDataQuality &lt; nDataQuality; iDataQuality ++){</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                                                 AliDCSArray* dataQuality = (AliDCSArray*)dataQualityArray-&gt;At(iDataQuality);</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :                                                 AliDebug(4,Form(&quot;dataQuality-&gt;GetTimeStamp() = %f, timeDataQualityStart = %f, timeEnd = %f&quot;, dataQuality-&gt;GetTimeStamp(), timeDataQualityStart, timeEnd ));</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :                                                 if (dataQuality-&gt;GetTimeStamp()&gt;=timeDataQualityStart &amp;&amp; dataQuality-&gt;GetTimeStamp()&lt;=timeEnd){ // considering only values between the first valid and the end of the run</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                                                         Bool_t dataQualityFlag = dataQuality-&gt;GetBool(0);</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                                                         AliDebug(3,Form(&quot;DataQuality = %d (set at %f)&quot;,(Int_t)dataQualityFlag,dataQuality-&gt;GetTimeStamp()));</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :                                                         if (dataQualityFlag != kTRUE){</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :                                                                 if (iDataQuality == indexDataQuality) {  // the first Data Quality value should be TRUE, but ignoring the problem now...</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :                                                                         AliError(&quot;The first value for the Data Quality MUST be TRUE! Ignoring for now...&quot;);</span>
<span class="lineNum">    1193 </span>            :                                                                 }
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :                                                                 nFalse++;</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :                                                         }</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1197 </span>            :                                         }
<span class="lineNum">    1198 </span>            : 
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;Found %d FALSE values for the Data Quality Flag&quot;,nFalse));</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :                                         Double_t falses[nFalse*2];  // dimensioning this to the maximum possible, as if each false value was followed by a true one --&gt; the false periods correspond to the number of falses</span>
<span class="lineNum">    1201 </span>            : 
<span class="lineNum">    1202 </span>            :                                         Int_t iDataQuality = indexDataQuality;
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :                                         if (nFalse &gt; 0){</span>
<span class="lineNum">    1204 </span>            :                                                 Int_t iFalse = 0;
<span class="lineNum">    1205 </span>            :                                                 // filling the info about the periods when the flag was set to FALSE
<span class="lineNum">    1206 </span>            :                                                 // starting, like for the other DPS, from the measurement closest to SOR (the index of which is iDataQuality)
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :                                                 while (iDataQuality &lt; nDataQuality){</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :                                                         AliDebug(3,Form(&quot;iDataQuality = %d&quot;,iDataQuality));</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :                                                         AliDCSArray* dataQuality = (AliDCSArray*)dataQualityArray-&gt;At(iDataQuality);</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :                                                         if (dataQuality-&gt;GetTimeStamp()&gt;=timeDataQualityStart &amp;&amp; dataQuality-&gt;GetTimeStamp()&lt;=timeEnd){ // considering only values between the first valid and the end of the run</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :                                                                 Bool_t dataQualityFlag = dataQuality-&gt;GetBool(0);</span>
<span class="lineNum">    1212 </span><span class="lineNoCov">          0 :                                                                 AliDebug(3,Form(&quot;DataQuality = %d (set at %f)&quot;,(Int_t)dataQualityFlag,dataQuality-&gt;GetTimeStamp()));</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :                                                                 if (dataQualityFlag == kTRUE){</span>
<span class="lineNum">    1214 </span>            :                                                                         // found TRUE value, continuing
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :                                                                         iDataQuality++;</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :                                                                         continue;</span>
<span class="lineNum">    1217 </span>            :                                                                 }
<span class="lineNum">    1218 </span>            :                                                                 else{
<span class="lineNum">    1219 </span>            :                                                                         /*
<span class="lineNum">    1220 </span>            :                                                                         // the check was already done before
<span class="lineNum">    1221 </span>            :                                                                         if (iDataQuality == indexDataQuality) {  // the first Data Quality value should be TRUE, but ignoring the problem now...
<span class="lineNum">    1222 </span>            :                                                                         AliError(&quot;The first value for the Data Quality MUST be TRUE! Ignoring for now...&quot;);
<span class="lineNum">    1223 </span>            :                                                                         }
<span class="lineNum">    1224 </span>            :                                                                         */
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :                                                                         falses[iFalse*2] = dataQuality-&gt;GetTimeStamp();</span>
<span class="lineNum">    1226 </span>            :                                                                         foundEndOfFalse = kFALSE;
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :                                                                         Int_t iDataQualityNext = iDataQuality+1;</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :                                                                         while (iDataQualityNext &lt; nDataQuality){</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :                                                                                 AliDCSArray* dataQualityNext = (AliDCSArray*)dataQualityArray-&gt;At(iDataQualityNext);</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :                                                                                 if (dataQualityNext-&gt;GetTimeStamp()&gt;timeDataQualityStart &amp;&amp; dataQualityNext-&gt;GetTimeStamp()&lt;=timeEnd &amp;&amp; dataQualityNext-&gt;GetTimeStamp() &gt; dataQuality-&gt;GetTimeStamp()){ // considering only values between the first valid and the end of the run, and subsequent to the current value</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                                                                                         Bool_t dataQualityFlagNext = dataQualityNext-&gt;GetBool(0);</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :                                                                                         AliDebug(3,Form(&quot;DataQualityNext = %d (set at %f)&quot;,(Int_t)dataQualityFlagNext,dataQualityNext-&gt;GetTimeStamp()));</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :                                                                                         if (dataQualityFlagNext == kTRUE){</span>
<span class="lineNum">    1234 </span>            :                                                                                                 // found TRUE value, first FALSE period completed
<span class="lineNum">    1235 </span>            :                                                                                                 foundEndOfFalse = kTRUE;
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :                                                                                                 falses[iFalse*2+1] = dataQualityNext-&gt;GetTimeStamp();</span>
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :                                                                                                 iFalse++;</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :                                                                                                 break;</span>
<span class="lineNum">    1239 </span>            :                                                                                         }
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :                                                                                         iDataQualityNext++;</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :                                                                                 }</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :                                                                         }</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :                                                                         if (!foundEndOfFalse) {</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :                                                                                 AliInfo(&quot;Please, note that the last FALSE value lasted until the end of the run&quot;);</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :                                                                                 falses[iFalse*2+1] = timeEnd;</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :                                                                                 iFalse++;</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :                                                                                 break;</span>
<span class="lineNum">    1248 </span>            :                                                                         }
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :                                                                         iDataQuality = iDataQualityNext+1;</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :                                                                 }</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :                                                         }</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :                                                 grpobj-&gt;SetNFalseDataQualityFlag(iFalse);</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :                                                 grpobj-&gt;SetFalseDataQualityFlagPeriods(falses);</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    1257 </span>            :                         }
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :                         delete dataQualityArray;</span>
<span class="lineNum">    1259 </span>            :                 }
<span class="lineNum">    1260 </span>            :                 else{
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :                         AliError(&quot;Data Quality Flag array not found in LHC Data file!!!&quot;);</span>
<span class="lineNum">    1262 </span>            :                 }
<span class="lineNum">    1263 </span>            : 
<span class="lineNum">    1264 </span>            :                 // Processing data to go to AliLHCData object
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :                 AliLHCData* dt = new AliLHCData(fileName.Data(),timeStart,timeEnd);</span>
<span class="lineNum">    1266 </span>            :                 // storing AliLHCData in OCDB
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :                 if (dt){</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :                   AliInfo(Form(&quot;Filled %d records to AliLHCData object&quot;,dt-&gt;GetData().GetEntriesFast()));</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :                   AliCDBMetaData md;</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :                   md.SetResponsible(&quot;Ruben Shahoyan&quot;);</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :                   md.SetComment(&quot;LHC data from the GRP preprocessor.&quot;);</span>
<span class="lineNum">    1272 </span>            :                   Bool_t result = kTRUE;
<span class="lineNum">    1273 </span><span class="lineNoCov">          0 :                   result = Store(&quot;GRP&quot;, &quot;LHCData&quot;, dt, &amp;md); </span>
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :                   delete dt;</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :                   if (!result){</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Problems in storing LHC Data - but not going into Error&quot;));</span>
<span class="lineNum">    1277 </span>            :                   }
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1279 </span>            : 
<span class="lineNum">    1280 </span>            :                 // processing LHC Phase
<span class="lineNum">    1281 </span>            : 
<span class="lineNum">    1282 </span><span class="lineNoCov">          0 :                 TObjArray *beam1phase = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[4]);</span>
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :                 TObjArray *beam2phase = lhcReader.ReadSingleLHCDP(fileName.Data(),fgkLHCDataPoints[5]);</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :                 if (beam1phase == 0x0 || beam2phase == 0x0){</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Problems in retrieving LHC Clock data from LHC file&quot;));</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :                         return 4;</span>
<span class="lineNum">    1287 </span>            :                 }                       
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :                 AliLHCClockPhase *phaseObj = ProcessLHCClockPhase(beam1phase,beam2phase,timeEnd);</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">          0 :                 delete beam1phase;</span>
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :                 delete beam2phase;</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :                 if (phaseObj){</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :                         AliInfo(Form(&quot;LHC Phase found&quot;));</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :                         AliCDBMetaData mdPhase;</span>
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :                         mdPhase.SetResponsible(&quot;Cvetan Cheshkov&quot;);</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :                         mdPhase.SetComment(&quot;LHC Clock Phase&quot;);</span>
<span class="lineNum">    1296 </span>            :                         Bool_t result = kTRUE;
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :                         result = Store(&quot;Calib&quot;, &quot;LHCClockPhase&quot;, phaseObj, &amp;mdPhase); </span>
<span class="lineNum">    1298 </span><span class="lineNoCov">          0 :                         delete phaseObj;</span>
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :                         if (!result) return 3;</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :                 else return 4;</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1303 </span>            :         
<span class="lineNum">    1304 </span>            :         else {
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :                 AliError(&quot;No LHCData file found in FXS&quot;);</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    1307 </span>            :         }
<span class="lineNum">    1308 </span>            : 
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1311 </span>            : 
<a name="1312"><span class="lineNum">    1312 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    1313 </span>            : 
<span class="lineNum">    1314 </span>            : UInt_t AliGRPPreprocessor::ProcessSPDMeanVertex()
<span class="lineNum">    1315 </span>            : {
<span class="lineNum">    1316 </span>            :         //
<span class="lineNum">    1317 </span>            :         //Getting the SPD Mean Vertex
<span class="lineNum">    1318 </span>            :         //
<span class="lineNum">    1319 </span>            : 
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :         TList* list = GetForeignFileSources(&quot;SPD&quot;, kDAQ, &quot;VertexDiamond&quot;);</span>
<span class="lineNum">    1321 </span>            :         Bool_t storeResult = kTRUE;
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :         if (list !=0x0 &amp;&amp; list-&gt;GetEntries()!=0)</span>
<span class="lineNum">    1323 </span>            :                 {
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :                         AliInfo(&quot;The following sources produced files with the id VertexDiamond from SPD&quot;);</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :                         list-&gt;Print();</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :                         for (Int_t jj=0;jj&lt;list-&gt;GetEntries();jj++){</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :                                 TObjString * str = dynamic_cast&lt;TObjString*&gt; (list-&gt;At(jj)); </span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :                                 if (!str){</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :                                         AliError(Form(&quot;Expecting a TObjString in the list for the %d-th source, but something else was found.&quot;,jj));</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :                                         continue;</span>
<span class="lineNum">    1331 </span>            :                                 }
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :                                 AliInfo(Form(&quot;found source %s&quot;, str-&gt;String().Data()));</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :                                 TString fileNameRun = GetForeignFile(&quot;SPD&quot;, kDAQ, &quot;VertexDiamond&quot;, str-&gt;GetName());</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :                                 if (fileNameRun.Length()&gt;0){</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;Got the file %s&quot;, fileNameRun.Data()));</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :                                         TFile daqFile(fileNameRun.Data(),&quot;READ&quot;);</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :                                         if (daqFile.IsOpen()) {</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :                                                 AliESDVertex* meanVtx = dynamic_cast&lt;AliESDVertex*&gt;(daqFile.Get(&quot;MeanVertexPos&quot;));</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :                                                 if (meanVtx){</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :                                                         meanVtx-&gt;Print();    </span>
<span class="lineNum">    1341 </span>            :                                                         // storing in the OCDB 
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :                                                         AliCDBMetaData md;</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :                                                         md.SetResponsible(&quot;Cvetan Cheshkov&quot;);</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :                                                         md.SetComment(&quot;SPD Mean Vertex&quot;);                                     </span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :                                                         storeResult = Store(&quot;Calib&quot;, &quot;MeanVertexSPD&quot;, meanVtx, &amp;md, 0, 0); </span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1347 </span>            :                                                 else{
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :                                                         AliWarning(&quot;No SPD Mean Vertex object found in file&quot;);</span>
<span class="lineNum">    1349 </span>            :                                                 } 
<span class="lineNum">    1350 </span><span class="lineNoCov">          0 :                                         }</span>
<span class="lineNum">    1351 </span>            :                                         else {
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :                                                 AliError(&quot;Can't open file&quot;);</span>
<span class="lineNum">    1353 </span>            :                                                 storeResult = kFALSE;
<span class="lineNum">    1354 </span>            :                                         }
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    1356 </span>            :                                 else{
<span class="lineNum">    1357 </span><span class="lineNoCov">          0 :                                         AliWarning(&quot;No file found for current source for SPD Mean Vertex&quot;);</span>
<span class="lineNum">    1358 </span>            :                                 }
<span class="lineNum">    1359 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1361 </span>            :         else {
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No list found for SPD Mean Vertex&quot;);</span>
<span class="lineNum">    1363 </span>            :         }
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :         if (list) delete list;</span>
<span class="lineNum">    1366 </span>            : 
<span class="lineNum">    1367 </span><span class="lineNoCov">          0 :         return storeResult;</span>
<span class="lineNum">    1368 </span><span class="lineNoCov">          0 : }</span>
<a name="1369"><span class="lineNum">    1369 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    1370 </span>            : 
<span class="lineNum">    1371 </span>            : UInt_t AliGRPPreprocessor::ProcessDqmFxs()
<span class="lineNum">    1372 </span>            : {
<span class="lineNum">    1373 </span>            :         //
<span class="lineNum">    1374 </span>            :         // Processing DQM fxs information
<span class="lineNum">    1375 </span>            :         //
<span class="lineNum">    1376 </span>            : 
<span class="lineNum">    1377 </span>            :         // TriggerClassesAndHistosToClone
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :         TList* list = GetFileSources(kDQM, &quot;TriggerClassesAndHistosToClone&quot;);</span>
<span class="lineNum">    1379 </span>            :         Bool_t openFileResult = kTRUE;
<span class="lineNum">    1380 </span>            :         Bool_t storeResultQAThr = kTRUE;
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :         if (list !=0x0 &amp;&amp; list-&gt;GetEntries()!=0){</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;The following sources produced files with the id TriggerClassesAndHistosToClone for GRP&quot;);</span>
<span class="lineNum">    1383 </span><span class="lineNoCov">          0 :                 list-&gt;Print();</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :                 for (Int_t jj=0;jj&lt;list-&gt;GetEntries();jj++){</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :                         TObjString * str = dynamic_cast&lt;TObjString*&gt; (list-&gt;At(jj)); </span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :                         if (!str){</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;Expecting a TObjString in the list for the %d-th source, but something else was found.&quot;,jj));</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :                                 continue;</span>
<span class="lineNum">    1389 </span>            :                         }
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                         AliInfo(Form(&quot;found source %s&quot;, str-&gt;String().Data()));</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :                         TString fileNameRun = GetFile(kDQM, &quot;TriggerClassesAndHistosToClone&quot;, str-&gt;GetName());</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :                         if (fileNameRun.Length()&gt;0){</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :                                 AliInfo(Form(&quot;Got the file %s&quot;, fileNameRun.Data()));</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :                                 TFile dqmFile(fileNameRun.Data(),&quot;READ&quot;);</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :                                 if (dqmFile.IsOpen()) {</span>
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :                                         dqmFile.ls();</span>
<span class="lineNum">    1397 </span>            :                                 }
<span class="lineNum">    1398 </span>            :                                 else {
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :                                         AliError(&quot;Can't open file&quot;);</span>
<span class="lineNum">    1400 </span>            :                                         openFileResult = kFALSE;
<span class="lineNum">    1401 </span>            :                                 }
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1403 </span>            :                         else{
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :                                 AliWarning(&quot;No file found for current source for DQM TriggerClassesAndHistosToClone&quot;);</span>
<span class="lineNum">    1405 </span>            :                         }
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1408 </span>            :         else {
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No list found for DQM TriggerClassesAndHistosToClone&quot;);</span>
<span class="lineNum">    1410 </span>            :         }
<span class="lineNum">    1411 </span>            :         
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :         if (list) delete list;</span>
<span class="lineNum">    1413 </span>            : 
<span class="lineNum">    1414 </span>            :         // QAThresholds
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :         TObjArray* qaThrArray = new TObjArray();</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :         for (Int_t idet = 0; idet &lt; AliDAQ::kNDetectors; idet++){</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :                 TString detName = AliDAQ::OnlineName(idet);</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :                 if (detName == &quot;TRI&quot; || detName == &quot;HLT&quot; || detName == &quot;TST&quot;) continue;   // skipping TRI, HLT, TST since they do not produce QAThresholds</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :                 AliDebug(2, Form(&quot;Processing QAThreshold for detector %s&quot;,detName.Data())); </span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :                 TList* listQAThr = GetForeignFileSources(detName.Data(), kDQM, &quot;QAThresholds&quot;);</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :                 if (listQAThr !=0x0){</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :                         if (listQAThr-&gt;GetEntries() &gt; 1){</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;More than one sources found for QAThresholds from detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :                                 continue;</span>
<span class="lineNum">    1425 </span>            :                         }
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 :                         else if (listQAThr-&gt;GetEntries()==1){</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :                                 AliInfo(Form(&quot;The following source produced files with the id QAThresholds for GRP, coming from detector %s:&quot;,detName.Data()));</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :                                 listQAThr-&gt;Print();</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :                                 TObjString * str = dynamic_cast&lt;TObjString*&gt; (listQAThr-&gt;At(0)); </span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :                                 if (!str){</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :                                         AliError(Form(&quot;Expecting a TObjString in the list for detector %s, but something else was found.&quot;,detName.Data()));</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :                                         delete listQAThr;</span>
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :                                         continue;</span>
<span class="lineNum">    1434 </span>            :                                 }
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :                                 AliInfo(Form(&quot;found source %s&quot;, str-&gt;String().Data()));</span>
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :                                 TString fileNameRun = GetForeignFile(detName.Data(), kDQM, &quot;QAThresholds&quot;, str-&gt;GetName());</span>
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :                                 if (fileNameRun.Length()&gt;0){</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :                                         AliInfo(Form(&quot;Got the file %s&quot;, fileNameRun.Data()));</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :                                         TFile dqmFile(fileNameRun.Data(),&quot;READ&quot;);</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :                                         if (dqmFile.IsOpen()) {</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :                                                 AliQAThresholds* qaThr = dynamic_cast&lt;AliQAThresholds*&gt;(dqmFile.Get(detName.Data()));</span>
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :                                                 if (qaThr){</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :                                                         Int_t qaThrId = qaThr-&gt;GetDetectorId();</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :                                                         if (qaThrId != idet){</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :                                                                 AliError(Form(&quot;Expecting QA threshold for detector %s, but found that for detector %s, skipping&quot;,detName.Data(), AliDAQ::OnlineName(qaThrId)));</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">          0 :                                                                 delete listQAThr;</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :                                                                 continue;</span>
<span class="lineNum">    1448 </span>            :                                                         }
<span class="lineNum">    1449 </span>            :                                                         else{
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :                                                                 qaThrArray-&gt;AddAtAndExpand(qaThr, qaThrId);</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :                                                                 delete listQAThr;</span>
<span class="lineNum">    1452 </span>            :                                                         }
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :                                                 }</span>
<span class="lineNum">    1454 </span>            :                                                 else {
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :                                                         AliError(Form(&quot;No QAThresholds object found in the file for detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :                                                         delete listQAThr;</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :                                                         continue;</span>
<span class="lineNum">    1458 </span>            :                                                 }
<span class="lineNum">    1459 </span><span class="lineNoCov">          0 :                                         }                             </span>
<span class="lineNum">    1460 </span>            :                                         else {
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :                                                 AliError(Form(&quot;Can't open QAThreshold file for detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :                                                 delete listQAThr;</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :                                                 continue;                                       </span>
<span class="lineNum">    1464 </span>            :                                         }
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    1466 </span>            :                                 else{
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 :                                         AliWarning(Form(&quot;No file found for DQM QAThreshold for detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :                                         delete listQAThr;</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :                                         continue;</span>
<span class="lineNum">    1470 </span>            :                                 }
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1472 </span>            :                         else {
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;No sources found for QAThresholds from detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :                                 delete listQAThr;</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :                                 continue;</span>
<span class="lineNum">    1476 </span>            :                         }
<span class="lineNum">    1477 </span>            :                 }
<span class="lineNum">    1478 </span>            :                 else {
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :                         AliWarning(Form(&quot;No list found for DQM QAThreshold for detector %s, skipping&quot;,detName.Data()));</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">    1481 </span>            :                 }
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :         if (qaThrArray-&gt;GetEntries() &gt; 0){</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :                 AliCDBMetaData md;</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :                 md.SetResponsible(&quot;Barthélémy von Haller&quot;);</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">          0 :                 md.SetComment(&quot;QA Threshold TObjArray&quot;);                                      </span>
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :                 storeResultQAThr = Store(&quot;Calib&quot;, &quot;QAThresholds&quot;, qaThrArray, &amp;md, 0, 0); </span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1489 </span>            :         else{
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :                 Printf(&quot;No valid QAThresholds entries found, storing nothing in the OCDB&quot;);</span>
<span class="lineNum">    1491 </span>            :         }
<span class="lineNum">    1492 </span>            : 
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :         Printf(&quot;openFileResult for QAThr processing would be %d, but we return kTRUE anyway&quot;, (Int_t)openFileResult);</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :         Printf(&quot;storeResultQAThr for QAThr processing would be %d, but we return kTRUE anyway&quot;, (Int_t)storeResultQAThr);</span>
<span class="lineNum">    1495 </span>            :         //      return storeResultQAThr;
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :         return kTRUE;  // temporary!!</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1498 </span>            : 
<span class="lineNum">    1499 </span>            : 
<a name="1500"><span class="lineNum">    1500 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    1501 </span>            : 
<span class="lineNum">    1502 </span>            : Int_t AliGRPPreprocessor::ProcessDaqLB(AliGRPObject* grpObj)
<span class="lineNum">    1503 </span>            : {
<span class="lineNum">    1504 </span>            :         //Getting the DAQ lb information
<span class="lineNum">    1505 </span>            :         
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :         time_t timeStart = (time_t)(((TString)GetRunParameter(&quot;DAQ_time_start&quot;)).Atoi());</span>
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :         time_t timeEnd = (time_t)(((TString)GetRunParameter(&quot;DAQ_time_end&quot;)).Atoi());</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :         Float_t beamEnergy = (Float_t)(((TString)GetRunParameter(&quot;beamEnergy&quot;)).Atof());</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :         TString beamType = (TString)GetRunParameter(&quot;beamType&quot;);</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :         Char_t numberOfDetectors = (Char_t)(((TString)GetRunParameter(&quot;numberOfDetectors&quot;)).Atoi());</span>
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :         UInt_t  detectorMask = (UInt_t)(((TString)GetRunParameter(&quot;detectorMask&quot;)).Atoi());</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :         TString lhcPeriod = (TString)GetRunParameter(&quot;LHCperiod&quot;);</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :         TString runType = (TString)GetRunType();</span>
<span class="lineNum">    1514 </span>            :         Int_t hltMode = AliGRPObject::kUnknown;
<span class="lineNum">    1515 </span>            :         
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :         if (timeEnd &gt;= 2.E9) AliFatal(&quot;ALICE run finshed later than Wed May 18 2033, 03:33:20 GMT, maximum time allowed for LHC data --&gt; fix the GRP preprocessor!!!&quot;);</span>
<span class="lineNum">    1517 </span>            : 
<span class="lineNum">    1518 </span>            :         UInt_t nparameter = 0;
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :         if (timeStart != 0){</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetTimeStart(timeStart);</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Start time for run %d: %d&quot;,fRun, (Int_t)timeStart));</span>
<span class="lineNum">    1522 </span>            :                 nparameter++;
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1524 </span>            :         else {
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Start time not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1526 </span>            :         }
<span class="lineNum">    1527 </span>            : 
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 :         if (timeEnd != 0){</span>
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetTimeEnd(timeEnd);</span>
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;End time for run %d: %i&quot;,fRun, (Int_t)timeEnd));</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :                 nparameter++;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1533 </span>            :         else {
<span class="lineNum">    1534 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;End time not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1535 </span>            :         }
<span class="lineNum">    1536 </span>            : 
<span class="lineNum">    1537 </span><span class="lineNoCov">          0 :         if (beamEnergy != 0){</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Beam Energy for run %d: %f (NOT USING IT TO FILL THE GRP OBJECT, taking it from the LHC file)&quot;,fRun, beamEnergy));</span>
<span class="lineNum">    1539 </span>            :         } 
<span class="lineNum">    1540 </span>            :         else {
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Beam Energy not put in logbook, but not using it anyway for the GRP object (taking it from the LHC file)&quot;));</span>
<span class="lineNum">    1542 </span>            :         }
<span class="lineNum">    1543 </span>            : 
<span class="lineNum">    1544 </span>            :                 
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :         if (beamType.Length() != 0){</span>
<span class="lineNum">    1546 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Beam Type for run %d: %s (NOT USING IT TO FILL THE GRP OBJECT, taking it from the LHC file)&quot;,fRun, beamType.Data()));</span>
<span class="lineNum">    1547 </span>            :         } 
<span class="lineNum">    1548 </span>            :         else {
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Beam Type not put in logbook, but not using it anyway for the GRP entry (taking it from the LHC file)&quot;));</span>
<span class="lineNum">    1550 </span>            :         }
<span class="lineNum">    1551 </span>            :                 
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :         if (numberOfDetectors != 0){</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetNumberOfDetectors(numberOfDetectors);</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Number Of Detectors for run %d: %d&quot;,fRun, (Int_t)numberOfDetectors));</span>
<span class="lineNum">    1555 </span><span class="lineNoCov">          0 :                 nparameter++;</span>
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1557 </span>            :         else {
<span class="lineNum">    1558 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Number Of Detectors not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1559 </span>            :         }
<span class="lineNum">    1560 </span>            : 
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :         if (detectorMask != 0){</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetDetectorMask(detectorMask);</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Detector Mask for run %d: %d&quot;,fRun, detectorMask));</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :                 nparameter++;</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1566 </span>            :         else {
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Detector Mask not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1568 </span>            :         }
<span class="lineNum">    1569 </span>            : 
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :         if (lhcPeriod.Length() != 0) {</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetLHCPeriod(lhcPeriod);</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;LHC period (DAQ) for run %d: %s&quot;,fRun, lhcPeriod.Data()));</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :                 nparameter++;</span>
<span class="lineNum">    1574 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1575 </span>            :         else {
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;LHCperiod not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1577 </span>            :         }
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :         if (runType.Length() != 0) {</span>
<span class="lineNum">    1579 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetRunType(runType);</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Run Type (DAQ) for run %d: %s&quot;,fRun, runType.Data()));</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :                 nparameter++;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    1583 </span>            :         else {
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Run Type not put in logbook, setting to invalid in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1585 </span>            :         }
<span class="lineNum">    1586 </span>            : 
<span class="lineNum">    1587 </span><span class="lineNoCov">          0 :         TString hltModeStr = GetRunParameter(&quot;HLTmode&quot;);</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :         if (hltModeStr.Length() != 0) {</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :           Log(Form(&quot;HLTmode found in logbook is %s&quot;, hltModeStr.Data()));</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :           nparameter++;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :           TSubString firstChar = hltModeStr(0,1);</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :           if (firstChar == &quot;A&quot;) {</span>
<span class="lineNum">    1593 </span>            :             hltMode = AliGRPObject::kModeA;
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :           else if (firstChar == &quot;B&quot;) {</span>
<span class="lineNum">    1596 </span>            :             hltMode = AliGRPObject::kModeB;
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">          0 :           else if (firstChar == &quot;C&quot;){</span>
<span class="lineNum">    1599 </span>            :             hltMode = AliGRPObject::kModeC;
<span class="lineNum">    1600 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :           grpObj-&gt;SetHLTMode(hltMode);</span>
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1603 </span>            :         else {
<span class="lineNum">    1604 </span><span class="lineNoCov">          0 :           Log(Form(&quot;HLT mode not found in logbook, setting to unknown in GRP entry, and causing an error!&quot;));</span>
<span class="lineNum">    1605 </span>            :         }
<span class="lineNum">    1606 </span>            :         
<span class="lineNum">    1607 </span>            :         return nparameter;
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 : }</span>
<a name="1609"><span class="lineNum">    1609 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    1610 </span>            : 
<span class="lineNum">    1611 </span>            : UInt_t AliGRPPreprocessor::ProcessDaqFxs()
<span class="lineNum">    1612 </span>            : {
<span class="lineNum">    1613 </span>            :         //======DAQ FXS======//
<span class="lineNum">    1614 </span>            :         
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :         AliRawEventHeaderV3_9::Class()-&gt;IgnoreTObjectStreamer(); // to avoid trying reading TObject store in AliRawEventHeaderV3_9 - temporary fix </span>
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :         AliRawEventHeaderV3_11::Class()-&gt;IgnoreTObjectStreamer(); // to avoid trying reading TObject store in AliRawEventHeaderV3_11 - temporary fix </span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :         AliRawEventHeaderV3_12::Class()-&gt;IgnoreTObjectStreamer(); // to avoid trying reading TObject store in AliRawEventHeaderV3_12 - temporary fix </span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :         AliRawEventHeaderV3_13::Class()-&gt;IgnoreTObjectStreamer(); // to avoid trying reading TObject store in AliRawEventHeaderV3_13 - temporary fix </span>
<span class="lineNum">    1619 </span><span class="lineNoCov">          0 :         AliRawEventHeaderV3_14::Class()-&gt;IgnoreTObjectStreamer(); // to avoid trying reading TObject store in AliRawEventHeaderV3_14 - temporary fix </span>
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :         Log(&quot;Processing DAQ FXS&quot;);</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :         TList* list = GetFileSources(kDAQ);     </span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :         if (!list) {</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :                 Log(&quot;No raw data tag list: connection problems with DAQ FXS logbook!&quot;);</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    1625 </span>            :         }
<span class="lineNum">    1626 </span>            :         
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :         if (list-&gt;GetEntries() == 0) {</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :                 Log(&quot;no raw data tags in this run: nothing to merge!&quot;);</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :                 delete  list; list=0;</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    1631 </span>            :         }
<span class="lineNum">    1632 </span>            :         
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :         TChain *fRawTagChain = new TChain(&quot;T&quot;);</span>
<span class="lineNum">    1634 </span>            :         Int_t nFiles=0;
<span class="lineNum">    1635 </span>            :         Int_t nCorruptedFiles=0;
<span class="lineNum">    1636 </span><span class="lineNoCov">          0 :         TIterator* iter = list-&gt;MakeIterator();</span>
<span class="lineNum">    1637 </span>            :         TObject* obj = 0;
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :         while ((obj = iter-&gt;Next())) {</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :                 TObjString* objStr = dynamic_cast&lt;TObjString*&gt; (obj);</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :                 if (objStr) {</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Found source %s&quot;, objStr-&gt;String().Data()));</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :                         TList* list2 = GetFileIDs(kDAQ, objStr-&gt;String());</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :                         if (!list2) {</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :                                 Log(&quot;No list with ids from DAQ was found: connection problems with DAQ FXS logbook!&quot;);</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :                                 delete fRawTagChain; fRawTagChain=0;</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :                                 return 1;</span>
<span class="lineNum">    1647 </span>            :                         }
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Number of ids: %d&quot;,list2-&gt;GetEntries()));</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :                         for(Int_t i = 0; i &lt; list2-&gt;GetEntries(); i++) {</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :                                 TObjString *idStr = (TObjString *)list2-&gt;At(i);</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :                                 if (idStr-&gt;String().CompareTo(&quot;QAThreshold&quot;) == 0 || idStr-&gt;String().CompareTo(&quot;TriggerClassesAndHistosToClone&quot;) == 0) {</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :                                         Log(Form(&quot;Skipping file with Id %s&quot;,idStr-&gt;String().Data()));</span>
<span class="lineNum">    1653 </span><span class="lineNoCov">          0 :                                         continue; </span>
<span class="lineNum">    1654 </span>            :                                 }
<span class="lineNum">    1655 </span><span class="lineNoCov">          0 :                                 TString fileName = GetFile(kDAQ,idStr-&gt;String().Data(),objStr-&gt;String().Data());</span>
<span class="lineNum">    1656 </span><span class="lineNoCov">          0 :                                 if (fileName.Length() &gt; 0) {</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">          0 :                                         if(!CheckFileRecords(fileName.Data())){</span>
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :                                                 Log(Form(&quot;The file records for \&quot;%s\&quot; are corrupted! The chain is skipping it.&quot;,fileName.Data()));</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :                                                 nCorruptedFiles++;</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :                                         }else{</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :                                                 Log(Form(&quot;Adding file in the chain: %s&quot;,fileName.Data()));</span>
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 :                                                 fRawTagChain-&gt;Add(fileName.Data());</span>
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :                                                 nFiles++;</span>
<span class="lineNum">    1664 </span>            :                                         }
<span class="lineNum">    1665 </span>            :                                 } else {
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :                                         Log(Form(&quot;Could not retrieve file with id %s from source %s: &quot;</span>
<span class="lineNum">    1667 </span>            :                                                  &quot;connection problems with DAQ FXS!&quot;,
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :                                                  idStr-&gt;String().Data(), objStr-&gt;String().Data()));</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :                                         delete list; list=0;</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :                                         delete list2; list2=0;</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :                                         delete fRawTagChain; fRawTagChain=0;</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :                                         return 2;</span>
<span class="lineNum">    1673 </span>            :                                 }
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :                         delete list2;</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1678 </span>            : 
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :         if (nFiles == 0){</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :                 Log(&quot;no raw data tags in this run: it could be that one or more files were found in the DAQ FXS, but they were ignored, since not interesting for the raw data tag: nothing to merge!&quot;);</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :                 delete iter;</span>
<span class="lineNum">    1682 </span>            :                 iter = 0;
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :                 delete list;</span>
<span class="lineNum">    1684 </span>            :                 list = 0;
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :                 delete fRawTagChain; </span>
<span class="lineNum">    1686 </span>            :                 fRawTagChain=0;
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    1688 </span>            :         }
<span class="lineNum">    1689 </span>            :         
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :         TString fRawDataFileName = &quot;GRP_Merged.tag.root&quot;;</span>
<span class="lineNum">    1691 </span><span class="lineNoCov">          0 :         if(nCorruptedFiles!=0)</span>
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Merging %d raw data tags into file: %s. %d corrupted files skipped&quot;, nFiles, fRawDataFileName.Data(), nCorruptedFiles));</span>
<span class="lineNum">    1693 </span>            :         else
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Merging %d raw data tags into file: %s&quot;, nFiles, fRawDataFileName.Data()));</span>
<span class="lineNum">    1695 </span>            :         
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :         if (fRawTagChain-&gt;Merge(fRawDataFileName) &lt; 1 ) {</span>
<span class="lineNum">    1697 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Error merging %d raw data files!!!&quot;,nFiles));</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :                 delete iter;</span>
<span class="lineNum">    1699 </span>            :                 iter = 0;
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :                 delete list;</span>
<span class="lineNum">    1701 </span>            :                 list = 0;
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :                 delete fRawTagChain; </span>
<span class="lineNum">    1703 </span>            :                 fRawTagChain=0;
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :                 return 3;</span>
<span class="lineNum">    1705 </span>            :         }
<span class="lineNum">    1706 </span>            :                 
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :         TString outputfile = Form(&quot;Run%d.Merged.RAW.tag.root&quot;, fRun);</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :         Bool_t result = StoreRunMetadataFile(fRawDataFileName.Data(),outputfile.Data());</span>
<span class="lineNum">    1709 </span>            :         
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :         if (!result) {</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :                 Log(&quot;Problem storing raw data tags in local file!!!&quot;);</span>
<span class="lineNum">    1712 </span>            :         } else {
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :                 Log(&quot;Raw data tags merged successfully!!&quot;);</span>
<span class="lineNum">    1714 </span>            :         }
<span class="lineNum">    1715 </span>            :         
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :         delete iter;</span>
<span class="lineNum">    1717 </span>            :         iter = 0;
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :         delete list;</span>
<span class="lineNum">    1719 </span>            :         list = 0;
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 :         delete fRawTagChain; fRawTagChain=0;</span>
<span class="lineNum">    1721 </span>            :         
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :         if (result == kFALSE) {</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :                 return 4;</span>
<span class="lineNum">    1724 </span>            :         }
<span class="lineNum">    1725 </span>            :         
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    1727 </span>            :         
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 : }</span>
<a name="1729"><span class="lineNum">    1729 </span>            : </a>
<span class="lineNum">    1730 </span>            : //_______________________________________________________________
<span class="lineNum">    1731 </span>            : UInt_t AliGRPPreprocessor::ProcessDcsFxs(TString partition, TString detector)
<span class="lineNum">    1732 </span>            : {
<span class="lineNum">    1733 </span>            : 
<span class="lineNum">    1734 </span>            :         // processing the info
<span class="lineNum">    1735 </span>            :         // stored in the DCS FXS
<span class="lineNum">    1736 </span>            :         // coming from the trigger
<span class="lineNum">    1737 </span>            : 
<span class="lineNum">    1738 </span>            :         // Get the CTP counters information
<span class="lineNum">    1739 </span>            :         //              +
<span class="lineNum">    1740 </span>            :         // Get the CTP aliases information
<span class="lineNum">    1741 </span>            : 
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :         if (partition.IsNull() &amp;&amp; !detector.IsNull()){ // standalone partition</span>
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :                 Log(&quot;STANDALONE partition for current run, using Trigger Scalers and Trigger Aliases dummy values&quot;);</span>
<span class="lineNum">    1744 </span>            : 
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :                 AliCDBEntry *cdbEntryScalers = GetFromOCDB(&quot;CTP&quot;,&quot;DummyScalers&quot;);</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :                 if (!cdbEntryScalers) {</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;No dummy CTP scalers entry found, going into error...&quot;));</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">    1749 </span>            :                 }
<span class="lineNum">    1750 </span>            :                 else{
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :                         AliTriggerRunScalers *scalers = (AliTriggerRunScalers*)cdbEntryScalers-&gt;GetObject();</span>
<span class="lineNum">    1752 </span><span class="lineNoCov">          0 :                         if (!scalers){</span>
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;CTP dummy scalers not found in OCDB entry, going into error...&quot;));</span>
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 :                                 return 1;</span>
<span class="lineNum">    1755 </span>            :                         }
<span class="lineNum">    1756 </span>            :                         else {
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">    1759 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP scalers from dummy entry in OCDB&quot;);</span>
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Scalers&quot;, scalers, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the dummy CTP scalers object to OCDB!&quot;);</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :                                         delete scalers;</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :                                         return 1;</span>
<span class="lineNum">    1764 </span>            :                                 }
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1767 </span>            : 
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :                 AliCDBEntry *cdbEntryAliases = GetFromOCDB(&quot;CTP&quot;,&quot;DummyAliases&quot;);</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :                 if (!cdbEntryAliases) {</span>
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;No dummy CTP aliases entry found, going into error...&quot;));</span>
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :                         return 2;</span>
<span class="lineNum">    1772 </span>            :                 }
<span class="lineNum">    1773 </span>            :                 else{
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :                         THashList *aliases = dynamic_cast&lt;THashList*&gt;(cdbEntryAliases-&gt;GetObject());</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :                         if (!aliases){</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;CTP dummy aliases not found in OCDB entry, going into error...&quot;));</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :                                 return 2;</span>
<span class="lineNum">    1778 </span>            :                         }
<span class="lineNum">    1779 </span>            :                         else {
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Evgeny Kryshen&quot;);</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP mapping of trigger classes to trigger aliases&quot;);</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Aliases&quot;, aliases, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the dummy CTP aliases object to OCDB!&quot;);</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :                                         delete aliases;                                 </span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :                                         return 2;</span>
<span class="lineNum">    1787 </span>            :                                 }
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1791 </span>            : 
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :         else if (!partition.IsNull() &amp;&amp; detector.IsNull()){ // global partition</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :                 Log(&quot;GLOBAL partition for current run, using CTP scalers from DCS FXS&quot;);</span>
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :                 TString countersfile = GetFile(kDCS, &quot;CTP_xcounters&quot;,&quot;&quot;);</span>
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :                 if (countersfile.IsNull()) {</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :                         Log(&quot;No CTP counters files has been found: empty source!&quot;);</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">    1798 </span>            :                 }
<span class="lineNum">    1799 </span>            :                 else {
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;File with Id CTP_xcounters found in DCS FXS! Copied to %s&quot;,countersfile.Data()));</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :                         AliTriggerRunScalers *scalers = AliTriggerRunScalers::ReadScalers(countersfile);</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :                         if (!scalers) {</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :                                 Log(&quot;Bad CTP counters file! The corresponding CDB entry will not be filled!&quot;);</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :                                 return 1;</span>
<span class="lineNum">    1805 </span>            :                         }
<span class="lineNum">    1806 </span>            :                         else {
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :                                 metaData.SetBeamPeriod(0);</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Roman Lietava&quot;);</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP scalers&quot;);</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Scalers&quot;, scalers, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">    1812 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the CTP scalers object to OCDB!&quot;);</span>
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :                                         delete scalers;                                 </span>
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :                                         return 1;</span>
<span class="lineNum">    1815 </span>            :                                 }
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">          0 :                         delete scalers;</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1819 </span>            : 
<span class="lineNum">    1820 </span>            : 
<span class="lineNum">    1821 </span>            : 
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :                 TString aliasesFile = GetFile(kDCS, &quot;CTP_aliases&quot;,&quot;&quot;);</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :                 if (aliasesFile.IsNull()) {</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">          0 :                         Log(&quot;No CTP aliases files has been found: empty source!&quot;);</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :                         return 2;</span>
<span class="lineNum">    1826 </span>            :                 }
<span class="lineNum">    1827 </span>            :                 else {
<span class="lineNum">    1828 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;File with Id CTP_aliases found in DCS FXS! Copied to %s&quot;,aliasesFile.Data()));</span>
<span class="lineNum">    1829 </span>            :                         // We build the THashList of TNamed(&quot;triggerclass&quot;,&quot;comma_separated_list_of_corresponding_aliases&quot;)
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :                         THashList* trClasses2Aliases = ProcessAliases(aliasesFile);</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :                         if (!trClasses2Aliases) {</span>
<span class="lineNum">    1832 </span><span class="lineNoCov">          0 :                                 Log(&quot;Bad CTP aliases file! The corresponding CDB entry will not be filled!&quot;);</span>
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :                                 return 2;</span>
<span class="lineNum">    1834 </span>            :                         }
<span class="lineNum">    1835 </span>            :                         else {
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :                                 AliCDBMetaData metaData;</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :                                 metaData.SetBeamPeriod(0);</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :                                 metaData.SetResponsible(&quot;Evgeny Kryshen&quot;);</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :                                 metaData.SetComment(&quot;CTP mapping of trigger classes to trigger aliases&quot;);</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :                                 if (!Store(&quot;CTP&quot;,&quot;Aliases&quot;, trClasses2Aliases, &amp;metaData, 0, 0)) {</span>
<span class="lineNum">    1841 </span><span class="lineNoCov">          0 :                                         Log(&quot;Unable to store the CTP aliases object to OCDB!&quot;);</span>
<span class="lineNum">    1842 </span><span class="lineNoCov">          0 :                                         delete trClasses2Aliases;                                       </span>
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :                                         return 2;</span>
<span class="lineNum">    1844 </span>            :                                 }
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :                         delete trClasses2Aliases;</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1849 </span>            :         
<span class="lineNum">    1850 </span>            : 
<span class="lineNum">    1851 </span>            :         else{   
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Incorrect field in DAQ logbook for partition = %s and detector = %s, going into error...&quot;,partition.Data(),detector.Data()));</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :                 return 3;</span>
<span class="lineNum">    1854 </span>            :         }
<span class="lineNum">    1855 </span>            : 
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">    1857 </span>            : 
<span class="lineNum">    1858 </span><span class="lineNoCov">          0 : }</span>
<a name="1859"><span class="lineNum">    1859 </span>            : </a>
<span class="lineNum">    1860 </span>            : //_______________________________________________________________
<span class="lineNum">    1861 </span>            : THashList* AliGRPPreprocessor::ProcessAliases(const char* aliasesFile)
<span class="lineNum">    1862 </span>            : {
<span class="lineNum">    1863 </span>            : 
<span class="lineNum">    1864 </span>            :         //
<span class="lineNum">    1865 </span>            :         // build the THashList of triggerclasses-to-triggeraliases from text file  
<span class="lineNum">    1866 </span>            :         // each line of the file is supposed to be a string composed by
<span class="lineNum">    1867 </span>            :         // triggerclass+spaces+commaseparatedlistofcorrespondingaliases\n
<span class="lineNum">    1868 </span>            :         // it will add a TNamed(&quot;triggerclass&quot;,&quot;commaseparatedlistofcorrespondingaliases&quot;)
<span class="lineNum">    1869 </span>            :         // to the hashlist
<span class="lineNum">    1870 </span>            :         //
<span class="lineNum">    1871 </span>            : 
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :         if (gSystem-&gt;AccessPathName(aliasesFile)) {</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :                 Printf(&quot;file (%s) not found&quot;, aliasesFile);</span>
<span class="lineNum">    1874 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    1875 </span>            :         }
<span class="lineNum">    1876 </span>            : 
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :         ifstream *file = new ifstream(aliasesFile);</span>
<span class="lineNum">    1878 </span><span class="lineNoCov">          0 :         if (!*file) {</span>
<span class="lineNum">    1879 </span><span class="lineNoCov">          0 :                 Printf(&quot;Error opening file (%s) !&quot;,aliasesFile);</span>
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :                 file-&gt;close();</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :                 delete file;</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    1883 </span>            :         }
<span class="lineNum">    1884 </span>            : 
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :         THashList *hList = new THashList(10);</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :         hList-&gt;SetName(&quot;List of trigger classes to trigger aliases strings&quot;);</span>
<span class="lineNum">    1887 </span>            : 
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :         TString strLine;</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :         while (strLine.ReadLine(*file)) {</span>
<span class="lineNum">    1890 </span>            : 
<span class="lineNum">    1891 </span>            :             // safety for null lines, tabs instead of whitespaces, trailing carriage return, leading or trailing spaces/tabs
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :                 if (strLine.IsNull()) continue;</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :                 strLine.ReplaceAll('\t',' ');</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :                 strLine.Remove(TString::kLeading,' ');</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :                 strLine.Remove(TString::kTrailing,'\r');</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :                 strLine.Remove(TString::kTrailing,' ');</span>
<span class="lineNum">    1897 </span>            : 
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :                 TObjArray* arr = strLine.Tokenize(' ');</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                 if(arr-&gt;GetEntries() != 2){</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :                         Printf(&quot;The line:\n%s\nunexpectedly contains %d tokens, instead of two.&quot;,strLine.Data(),arr-&gt;GetEntries());</span>
<span class="lineNum">    1901 </span><span class="lineNoCov">          0 :                         delete arr;</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1903 </span>            :                 }
<span class="lineNum">    1904 </span><span class="lineNoCov">          0 :                 TObjString *osTC = (TObjString*) arr-&gt;At(0);</span>
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :                 TObjString *osTAlist = (TObjString*) arr-&gt;At(1);</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :                 TNamed *ctoa = new TNamed(osTC-&gt;GetName(),osTAlist-&gt;GetName());</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 :                 hList-&gt;Add(ctoa);</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :                 delete arr;</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1910 </span>            : 
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :         file-&gt;close();</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :         delete file;</span>
<span class="lineNum">    1913 </span>            : 
<span class="lineNum">    1914 </span><span class="lineNoCov">          0 :         return hList;</span>
<span class="lineNum">    1915 </span><span class="lineNoCov">          0 : }</span>
<a name="1916"><span class="lineNum">    1916 </span>            : </a>
<span class="lineNum">    1917 </span>            : //_______________________________________________________________
<span class="lineNum">    1918 </span>            : Int_t AliGRPPreprocessor::ProcessDcsDPs(TMap* valueMap, AliGRPObject* grpObj)
<span class="lineNum">    1919 </span>            : {
<span class="lineNum">    1920 </span>            : 
<span class="lineNum">    1921 </span>            :         //
<span class="lineNum">    1922 </span>            :         // processing DCS DPs
<span class="lineNum">    1923 </span>            :         //
<span class="lineNum">    1924 </span>            : 
<span class="lineNum">    1925 </span>            :         Int_t entries = 0;  // counting the entries that are in the DCS DB, not taking care whether they have values or not
<span class="lineNum">    1926 </span>            :         Int_t nL3Entries = 0;
<span class="lineNum">    1927 </span>            :         Int_t nDipoleEntries = 0;
<span class="lineNum">    1928 </span>            :         Int_t nEnvEntries = 0;
<span class="lineNum">    1929 </span>            :         Int_t nHallProbesEntries = 0;
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :         nL3Entries = ProcessL3DPs(valueMap, grpObj);</span>
<span class="lineNum">    1931 </span><span class="lineNoCov">          0 :         nDipoleEntries = ProcessDipoleDPs(valueMap, grpObj);</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :         nEnvEntries = ProcessEnvDPs(valueMap, grpObj);</span>
<span class="lineNum">    1933 </span>            :         //nHallProbesEntries = ProcessHPDPs(valueMap, grpObj);
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetPolarityConventionLHC();  // after the dipole cables swap we comply with LHC convention</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :         Log(Form(&quot;L3Entries = %d, nDipoleEntries =%d, nEnvEntries = %d, nHallProbesEntries = %d&quot;, nL3Entries, nDipoleEntries, nEnvEntries, nHallProbesEntries));</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :         entries = nL3Entries + nDipoleEntries + nEnvEntries + nHallProbesEntries;</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :         return entries;</span>
<span class="lineNum">    1938 </span>            : 
<span class="lineNum">    1939 </span>            : }
<span class="lineNum">    1940 </span>            : 
<a name="1941"><span class="lineNum">    1941 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    1942 </span>            : 
<span class="lineNum">    1943 </span>            : Int_t AliGRPPreprocessor::ProcessL3DPs(const TMap* valueMap, AliGRPObject* grpObj)
<span class="lineNum">    1944 </span>            : {
<span class="lineNum">    1945 </span>            : 
<span class="lineNum">    1946 </span>            :         // processing DPs
<span class="lineNum">    1947 </span>            :         // related to 
<span class="lineNum">    1948 </span>            :         // L3 info
<span class="lineNum">    1949 </span>            : 
<span class="lineNum">    1950 </span>            :         Int_t nL3Entries = 0;
<span class="lineNum">    1951 </span>            : 
<span class="lineNum">    1952 </span>            :         TObjArray *array = 0x0;
<span class="lineNum">    1953 </span>            :         Int_t indexDP = -1;
<span class="lineNum">    1954 </span>            :         Int_t indexDP_Redu = -1;
<span class="lineNum">    1955 </span>            :         Int_t indexDP_Processed = -1;
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :         Bool_t isZero = kTRUE; // flag to monitor L3Current. If set to true, the magnet is OFF, and the polarity can change</span>
<span class="lineNum">    1957 </span>            : 
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== L3Current ===========&quot;));</span>
<span class="lineNum">    1959 </span>            :         Bool_t outOfRange = kFALSE;  // flag to monitor if any value collected by DCS is out of range
<span class="lineNum">    1960 </span>            :         indexDP = kL3Current;
<span class="lineNum">    1961 </span>            :         indexDP_Redu = kL3Current_Redu;
<span class="lineNum">    1962 </span>            :         indexDP_Processed = indexDP;
<span class="lineNum">    1963 </span><span class="lineNoCov">          0 :         array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    1965 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;%s not found in the map!!! We will now check the corresponding redundant entry (%s)&quot;,fgkDCSDataPoints[indexDP], fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    1966 </span>            :                 indexDP_Processed = indexDP_Redu;
<span class="lineNum">    1967 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :         }       </span>
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Also the redundant point %s is not found in the map!!!&quot;, fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    1972 </span>            :         else {
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :           if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :             AliError(Form(&quot;No entries found in array! setting %s to invalid...&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1976 </span>            :           else {
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :             Float_t *floatDCS = ProcessFloatAllMagnet(array, indexDP_Processed, isZero);</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :             if (floatDCS != NULL){</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :               grpObj-&gt;SetL3Current(floatDCS);</span>
<span class="lineNum">    1980 </span><span class="lineNoCov">          0 :               delete[] floatDCS;</span>
<span class="lineNum">    1981 </span>            :               floatDCS = 0x0;
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    1983 </span>            :             else{
<span class="lineNum">    1984 </span>            :               outOfRange = kTRUE;
<span class="lineNum">    1985 </span>            :             }   
<span class="lineNum">    1986 </span>            :           }
<span class="lineNum">    1987 </span><span class="lineNoCov">          0 :           if (!outOfRange) {</span>
<span class="lineNum">    1988 </span>            :             nL3Entries++;
<span class="lineNum">    1989 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    1990 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    1992 </span>            :         
<span class="lineNum">    1993 </span>            :         }
<span class="lineNum">    1994 </span>            : 
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :         if (array) array = 0x0;</span>
<span class="lineNum">    1996 </span>            : 
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== L3Polarity ===========&quot;));</span>
<span class="lineNum">    1998 </span>            :         indexDP = kL3Polarity;
<span class="lineNum">    1999 </span>            :         indexDP_Redu = kL3Polarity_Redu;
<span class="lineNum">    2000 </span>            :         indexDP_Processed = indexDP;
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :         array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2003 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;%s not found in the map!!! We will now check the corresponding redundant entry (%s)&quot;,fgkDCSDataPoints[indexDP], fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2004 </span>            :                 indexDP_Processed = indexDP_Redu;
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :         }        </span>
<span class="lineNum">    2007 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2008 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Also the redundant point %s is not found in the map!!!&quot;, fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2010 </span>            :         else {
<span class="lineNum">    2011 </span><span class="lineNoCov">          0 :           if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    2012 </span><span class="lineNoCov">          0 :             AliError(Form(&quot;No entries found in array! setting %s Polarity to invalid...&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2013 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2014 </span>            :           else {
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :             Bool_t change = kFALSE;</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :             Char_t charDCS = ProcessBool(array, change);</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :             if (change == kFALSE){</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :               grpObj-&gt;SetL3Polarity(charDCS);</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :               AliInfo(Form(&quot;%s set to %d&quot;,fgkDCSDataPoints[indexDP],(Int_t)(grpObj-&gt;GetL3Polarity())));</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :               nL3Entries++;</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :             else if (isZero){</span>
<span class="lineNum">    2025 </span><span class="lineNoCov">          0 :               AliInfo(Form(&quot;%s set to invalid, but magnet was OFF (according to the current), DP not considered wrong&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :               nL3Entries++;</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2030 </span>            :             else {
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :               AliError(Form(&quot;%s value changed within the run, while the magnet was ON (according to the current), setting it to invalid and considering the DP as wrong&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2032 </span>            :             }
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2034 </span>            :         }
<span class="lineNum">    2035 </span>            : 
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :         return nL3Entries;</span>
<span class="lineNum">    2037 </span>            : 
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 : }</span>
<a name="2039"><span class="lineNum">    2039 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2040 </span>            : 
<span class="lineNum">    2041 </span>            : Int_t AliGRPPreprocessor::ProcessDipoleDPs(const TMap* valueMap, AliGRPObject* grpObj)
<span class="lineNum">    2042 </span>            : {
<span class="lineNum">    2043 </span>            :         // processing DPs
<span class="lineNum">    2044 </span>            :         // related to 
<span class="lineNum">    2045 </span>            :         // the Dipole info
<span class="lineNum">    2046 </span>            : 
<span class="lineNum">    2047 </span>            :         Int_t nDipoleEntries = 0;
<span class="lineNum">    2048 </span>            :         TObjArray *array = 0x0;
<span class="lineNum">    2049 </span>            :         Int_t indexDP = -1;
<span class="lineNum">    2050 </span>            :         Int_t indexDP_Redu = -1;
<span class="lineNum">    2051 </span>            :         Int_t indexDP_Processed = -1;
<span class="lineNum">    2052 </span><span class="lineNoCov">          0 :         Bool_t isZero = kTRUE; // flag to monitor L3Current. If set to true, the magnet is OFF, and the polarity can change</span>
<span class="lineNum">    2053 </span>            : 
<span class="lineNum">    2054 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== DipoleCurrent ===========&quot;));</span>
<span class="lineNum">    2055 </span>            :         Bool_t outOfRange = kFALSE;  // flag to monitor if any value collected by DCS is out of range
<span class="lineNum">    2056 </span>            :         indexDP = kDipoleCurrent;
<span class="lineNum">    2057 </span>            :         indexDP_Redu = kDipoleCurrent_Redu;
<span class="lineNum">    2058 </span>            :         indexDP_Processed = indexDP;
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :         array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;%s not found in the map!!! We will now check the corresponding redundant entry (%s)&quot;,fgkDCSDataPoints[indexDP], fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2062 </span>            :                 indexDP_Processed = indexDP_Redu;
<span class="lineNum">    2063 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2064 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Also the redundant point %s is not found in the map!!!&quot;, fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2068 </span>            :         else {
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :           if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :             AliError(Form(&quot;No entries found in array! setting %s to invalid...&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2072 </span>            :           else {
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :             Float_t *floatDCS = ProcessFloatAllMagnet(array, indexDP_Processed, isZero);</span>
<span class="lineNum">    2074 </span><span class="lineNoCov">          0 :             if (floatDCS != NULL){</span>
<span class="lineNum">    2075 </span><span class="lineNoCov">          0 :               grpObj-&gt;SetDipoleCurrent(floatDCS);</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :               delete[] floatDCS;</span>
<span class="lineNum">    2077 </span>            :               floatDCS = 0x0;
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :             } </span>
<span class="lineNum">    2079 </span>            :             else{
<span class="lineNum">    2080 </span>            :               outOfRange=kTRUE;
<span class="lineNum">    2081 </span>            :             }
<span class="lineNum">    2082 </span>            :           }
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :           if (!outOfRange) {</span>
<span class="lineNum">    2084 </span>            :             nDipoleEntries++;
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2088 </span>            :         }
<span class="lineNum">    2089 </span>            : 
<span class="lineNum">    2090 </span>            : 
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :         if (array) array = 0x0;</span>
<span class="lineNum">    2092 </span>            : 
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== DipolePolarity ===========&quot;));</span>
<span class="lineNum">    2094 </span>            :         indexDP = kDipolePolarity;
<span class="lineNum">    2095 </span>            :         indexDP_Redu = kDipolePolarity_Redu;
<span class="lineNum">    2096 </span>            :         indexDP_Processed = indexDP;
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :         array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;%s not found in the map!!! We will now check the corresponding redundant entry (%s)&quot;,fgkDCSDataPoints[indexDP], fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2100 </span>            :                 indexDP_Processed = indexDP_Redu;
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2102 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2103 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Also the redundant point %s is not found in the map!!!&quot;, fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2106 </span>            :         else {
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :           if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :             AliError(Form(&quot;No entries found in array! setting %s to invalid...&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2110 </span>            :           else {
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :             Bool_t change = kFALSE;</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :             Char_t charDCS = ProcessBool(array, change);</span>
<span class="lineNum">    2113 </span><span class="lineNoCov">          0 :             if (!change){</span>
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 :               grpObj-&gt;SetDipolePolarity(charDCS);</span>
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 :               AliInfo(Form(&quot;%s set to %d&quot;,fgkDCSDataPoints[indexDP],(Int_t)(grpObj-&gt;GetDipolePolarity())));</span>
<span class="lineNum">    2116 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :               nDipoleEntries++;</span>
<span class="lineNum">    2119 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :             else if (isZero){</span>
<span class="lineNum">    2121 </span><span class="lineNoCov">          0 :               AliInfo(Form(&quot;%s set to invalid, but magnet was OFF (according to the current), DP not considered wrong&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :               ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">          0 :               nDipoleEntries++;</span>
<span class="lineNum">    2125 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2126 </span>            :             else{
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :               AliError(Form(&quot;%s value changed within the run while the magnet was ON (according to the current), setting it to invalid and considering the DP as wrong&quot;, fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2128 </span>            :             }
<span class="lineNum">    2129 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2130 </span>            :         }
<span class="lineNum">    2131 </span>            : 
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :         return nDipoleEntries;</span>
<span class="lineNum">    2133 </span>            : 
<span class="lineNum">    2134 </span><span class="lineNoCov">          0 : }</span>
<a name="2135"><span class="lineNum">    2135 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2136 </span>            : 
<span class="lineNum">    2137 </span>            : Int_t AliGRPPreprocessor::ProcessEnvDPs(TMap* valueMap, AliGRPObject* grpObj)
<span class="lineNum">    2138 </span>            : {
<span class="lineNum">    2139 </span>            :         // processing DPs
<span class="lineNum">    2140 </span>            :         // related to 
<span class="lineNum">    2141 </span>            :         // evironment conditions (temperature, pressure) info
<span class="lineNum">    2142 </span>            : 
<span class="lineNum">    2143 </span>            :         Int_t nEnvEntries = 0;
<span class="lineNum">    2144 </span>            :         TObjArray *array = 0x0;
<span class="lineNum">    2145 </span>            :         Int_t indexDP = -1;
<span class="lineNum">    2146 </span>            :         Int_t indexDP_Redu = -1;
<span class="lineNum">    2147 </span>            :         Int_t indexDP_Processed = -1;
<span class="lineNum">    2148 </span>            : 
<span class="lineNum">    2149 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== CavernTemperature ===========&quot;));</span>
<span class="lineNum">    2150 </span>            :         Bool_t outOfRange = kFALSE;  // flag to monitor if any value collected by DCS is out of range
<span class="lineNum">    2151 </span>            :         indexDP = kCavernTemperature;
<span class="lineNum">    2152 </span>            :         indexDP_Redu = kCavernTemperature_Redu;
<span class="lineNum">    2153 </span>            :         indexDP_Processed = indexDP;
<span class="lineNum">    2154 </span><span class="lineNoCov">          0 :         array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;%s not found in the map!!! We will now check the corresponding redundant entry (%s)&quot;,fgkDCSDataPoints[indexDP], fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2157 </span>            :                 indexDP_Processed = indexDP_Redu;
<span class="lineNum">    2158 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(fgkDCSDataPoints[indexDP_Processed]);</span>
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :         if(!array) {</span>
<span class="lineNum">    2161 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Also the redundant point %s is not found in the map!!!&quot;, fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2163 </span>            :         else {
<span class="lineNum">    2164 </span><span class="lineNoCov">          0 :           if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :             AliError(Form(&quot;No entries found in array! setting %s to invalid...&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2167 </span>            :           else {
<span class="lineNum">    2168 </span><span class="lineNoCov">          0 :             Float_t *floatDCS = ProcessFloatAll(array);</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :             if (floatDCS != NULL){</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">          0 :               grpObj-&gt;SetCavernTemperature(floatDCS);</span>
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 :               delete[] floatDCS;</span>
<span class="lineNum">    2172 </span>            :               floatDCS = 0x0;
<span class="lineNum">    2173 </span><span class="lineNoCov">          0 :             }</span>
<span class="lineNum">    2174 </span>            :             else{
<span class="lineNum">    2175 </span>            :               outOfRange = kTRUE;
<span class="lineNum">    2176 </span>            :             }
<span class="lineNum">    2177 </span>            :           }
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :           if (!outOfRange) {</span>
<span class="lineNum">    2179 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :             ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2181 </span>            :             nEnvEntries++;
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :           }</span>
<span class="lineNum">    2183 </span>            :         }
<span class="lineNum">    2184 </span>            : 
<span class="lineNum">    2185 </span><span class="lineNoCov">          0 :         if (array) array = 0x0;</span>
<span class="lineNum">    2186 </span>            : 
<span class="lineNum">    2187 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== AtmosPressures (Cavern + Surface + Cavern2) ===========&quot;));</span>
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :         AliDCSSensorArray *dcsSensorArray = GetPressureMap(valueMap);</span>
<span class="lineNum">    2189 </span>            :         //dcsSensorArray-&gt;Print();
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :         if( fPressure-&gt;NumFits()&lt;kNumSensors ) {</span>
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Check the pressure sensor values! Not all the %d pressure sensors have been fit&quot;,kNumSensors));</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2193 </span><span class="lineNoCov">          0 :         Log(Form(&quot;Number of fits performed = %d&quot;,fPressure-&gt;NumFits()));</span>
<span class="lineNum">    2194 </span>            : 
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== CavernAtmosPressure ===========&quot;));</span>
<span class="lineNum">    2196 </span>            :         indexDP = kCavernAtmosPressure;
<span class="lineNum">    2197 </span>            :         indexDP_Redu = kCavernAtmosPressure_Redu;
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorCavernP2 = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP]);</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorCavernP2_Redu = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP_Redu]);</span>
<span class="lineNum">    2200 </span>            :         TGraph* graph = 0x0;
<span class="lineNum">    2201 </span>            :         TGraph* graph_Redu = 0x0;
<span class="lineNum">    2202 </span>            : 
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :         if (sensorCavernP2) graph = sensorCavernP2-&gt;GetGraph();</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index = %d&quot;,indexDP));</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name = %s&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph = %p&quot;,graph));</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorCavernP2 = %p&quot;, sensorCavernP2));</span>
<span class="lineNum">    2208 </span>            : 
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :         if (sensorCavernP2_Redu) graph_Redu = sensorCavernP2_Redu-&gt;GetGraph();</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index_Redu = %d&quot;,indexDP_Redu));</span>
<span class="lineNum">    2211 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name_Redu = %s&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph_Redu = %p&quot;,graph_Redu));</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorCavernP2_Redu = %p&quot;, sensorCavernP2_Redu));</span>
<span class="lineNum">    2214 </span>            : 
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :         if(sensorCavernP2 &amp;&amp; (sensorCavernP2-&gt;GetFit() || graph)) {</span>
<span class="lineNum">    2216 </span><span class="lineNoCov">          0 :                 if (sensorCavernP2-&gt;GetFit()){</span>
<span class="lineNum">    2217 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2218 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2219 </span>            :                 else {
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2221 </span>            :                 }
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetCavernAtmosPressure(sensorCavernP2);</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2227 </span><span class="lineNoCov">          0 :         else if(sensorCavernP2_Redu &amp;&amp; (sensorCavernP2_Redu-&gt;GetFit() || graph_Redu)) {</span>
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :           Log(Form(&quot;Neither graph nor fit found for sensor %s, we are using the redundant entry now&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :                 if (sensorCavernP2_Redu-&gt;GetFit()){</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2232 </span>            :                 else {
<span class="lineNum">    2233 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2234 </span>            :                 }
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetCavernAtmosPressure(sensorCavernP2_Redu);</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2240 </span>            :         //if (sensorP2) delete sensorP2;
<span class="lineNum">    2241 </span>            :         else {
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;ERROR!!! Neither graph nor fit found for sensor %s (we tried also the redundant copy) - this will not increase the number of found DCS DPs and will cause an error&quot;, fgkDCSDataPoints[indexDP] ));</span>
<span class="lineNum">    2243 </span>            :         }
<span class="lineNum">    2244 </span>            :         
<span class="lineNum">    2245 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== SurfaceAtmosPressure ===========&quot;));</span>
<span class="lineNum">    2246 </span>            :         indexDP = kSurfaceAtmosPressure;
<span class="lineNum">    2247 </span>            :         indexDP_Redu = kSurfaceAtmosPressure_Redu;
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorP2 = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP]);</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorP2_Redu = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP_Redu]);</span>
<span class="lineNum">    2250 </span>            : 
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :         if (sensorP2) graph = sensorP2-&gt;GetGraph();</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index = %d&quot;,indexDP));</span>
<span class="lineNum">    2253 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name = %s&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2254 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph = %p&quot;,graph)); </span>
<span class="lineNum">    2255 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorP2 = %p&quot;, sensorP2));</span>
<span class="lineNum">    2256 </span>            : 
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 :         if (sensorP2_Redu) graph_Redu = sensorP2_Redu-&gt;GetGraph();</span>
<span class="lineNum">    2258 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index_Redu = %d&quot;,indexDP_Redu));</span>
<span class="lineNum">    2259 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name_Redu = %s&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2260 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph_Redu = %p&quot;,graph_Redu));       </span>
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorP2_Redu = %p&quot;, sensorP2_Redu));</span>
<span class="lineNum">    2262 </span>            : 
<span class="lineNum">    2263 </span><span class="lineNoCov">          0 :         if(sensorP2 &amp;&amp; (sensorP2-&gt;GetFit() || graph)) {</span>
<span class="lineNum">    2264 </span><span class="lineNoCov">          0 :                 if (sensorP2-&gt;GetFit()){</span>
<span class="lineNum">    2265 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2266 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2267 </span>            :                 else {
<span class="lineNum">    2268 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2269 </span>            :                 }
<span class="lineNum">    2270 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetSurfaceAtmosPressure(sensorP2);</span>
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :         else if(sensorP2_Redu &amp;&amp; (sensorP2_Redu-&gt;GetFit() || graph_Redu)) {</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Neither graph nor fit found for sensor %s, we are using the redundant entry now&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :                 if (sensorP2_Redu-&gt;GetFit()){</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2280 </span>            :                 else {
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2282 </span>            :                 }
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetSurfaceAtmosPressure(sensorP2_Redu);</span>
<span class="lineNum">    2284 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2285 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2288 </span>            :         //if (sensorP2) delete sensorP2;
<span class="lineNum">    2289 </span>            :         else {
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;ERROR!!! Neither graph nor fit found for sensor %s (we tried also the redundant copy) - this will not increase the number of found DCS DPs and will cause an error&quot;, fgkDCSDataPoints[indexDP] ));</span>
<span class="lineNum">    2291 </span>            :         }
<span class="lineNum">    2292 </span>            : 
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :         Log(Form(&quot;\n   ========== CavernAtmosPressure2 ===========&quot;));</span>
<span class="lineNum">    2294 </span>            :         indexDP = kCavernAtmosPressure2;
<span class="lineNum">    2295 </span>            :         indexDP_Redu = kCavernAtmosPressure2_Redu;
<span class="lineNum">    2296 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorCavernP22 = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP]);</span>
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :         AliDCSSensor* sensorCavernP22_Redu = dcsSensorArray-&gt;GetSensor(fgkDCSDataPoints[indexDP_Redu]);</span>
<span class="lineNum">    2298 </span>            : 
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :         if (sensorCavernP22) graph = sensorCavernP22-&gt;GetGraph();</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index = %d&quot;,indexDP));</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name = %s&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph = %p&quot;,graph)); </span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorCavernP2_2 = %p&quot;, sensorCavernP22));</span>
<span class="lineNum">    2304 </span>            : 
<span class="lineNum">    2305 </span><span class="lineNoCov">          0 :         if (sensorCavernP22_Redu) graph_Redu = sensorCavernP22_Redu-&gt;GetGraph();</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;index_Redu = %d&quot;,indexDP_Redu));</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;name_Redu = %s&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2308 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;graph_Redu = %p&quot;,graph_Redu));       </span>
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :         AliDebug(3,Form(&quot;sensorCavernP2_2_Redu = %p&quot;, sensorCavernP22_Redu));</span>
<span class="lineNum">    2310 </span>            : 
<span class="lineNum">    2311 </span><span class="lineNoCov">          0 :         if(sensorCavernP22 &amp;&amp; (sensorCavernP22-&gt;GetFit() || graph)) {</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :                 if (sensorCavernP22-&gt;GetFit()){</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2314 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2315 </span>            :                 else {
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2317 </span>            :                 }
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetCavernAtmosPressure2(sensorCavernP22);</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :         else if(sensorCavernP22_Redu &amp;&amp; (sensorCavernP22_Redu-&gt;GetFit() || graph_Redu)) {</span>
<span class="lineNum">    2324 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Neither graph nor fit found for sensor %s, we are using the redundant entry now&quot;,fgkDCSDataPoints[indexDP]));</span>
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :                 if (sensorCavernP22_Redu-&gt;GetFit()){</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s found&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2328 </span>            :                 else {
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Fit for sensor %s not found, but the graph is there - NOT going into error&quot;,fgkDCSDataPoints[indexDP_Redu]));</span>
<span class="lineNum">    2330 </span>            :                 }
<span class="lineNum">    2331 </span><span class="lineNoCov">          0 :                 grpObj-&gt;SetCavernAtmosPressure2(sensorCavernP22_Redu);</span>
<span class="lineNum">    2332 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP);</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">          0 :                 ffailedDPs-&gt;RemoveAt(indexDP_Redu);</span>
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 :                 nEnvEntries++;</span>
<span class="lineNum">    2335 </span><span class="lineNoCov">          0 :         } </span>
<span class="lineNum">    2336 </span>            :         //if (sensorP2) delete sensorP2;
<span class="lineNum">    2337 </span>            :         else {
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;ERROR!!! Neither graph nor fit found for sensor %s (we tried also the redundant copy) - this will not increase the number of found DCS DPs and will cause an error&quot;, fgkDCSDataPoints[indexDP] ));</span>
<span class="lineNum">    2339 </span>            :         }
<span class="lineNum">    2340 </span>            :         
<span class="lineNum">    2341 </span>            :         
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :         return nEnvEntries;</span>
<span class="lineNum">    2343 </span><span class="lineNoCov">          0 : }</span>
<a name="2344"><span class="lineNum">    2344 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2345 </span>            : 
<span class="lineNum">    2346 </span>            : Int_t AliGRPPreprocessor::ProcessHPDPs(const TMap* valueMap, AliGRPObject* grpObj)
<span class="lineNum">    2347 </span>            : {
<span class="lineNum">    2348 </span>            :         // processing DPs
<span class="lineNum">    2349 </span>            :         // related to 
<span class="lineNum">    2350 </span>            :         // Hall Probes info
<span class="lineNum">    2351 </span>            : 
<span class="lineNum">    2352 </span>            :         Int_t nHPEntries = 0;
<span class="lineNum">    2353 </span>            :         TObjArray *array = 0x0;
<span class="lineNum">    2354 </span>            :         Int_t indexDP = -1;
<span class="lineNum">    2355 </span>            :         Bool_t outOfRange; // flag to monitor if any value collected by DCS is out of range
<span class="lineNum">    2356 </span>            : 
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :         if (fgknDCSDPHallProbes != AliGRPObject::GetNumberOfHP()){</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">          0 :                 AliError(Form(&quot;Number of Hall probes expected in GRP Preprocessor (i.e. %d) different from number of Hall Probes foreseen in GRP object (i.e. %d). Looping on entries from GRP object anyway.&quot;, fgknDCSDPHallProbes, AliGRPObject::GetNumberOfHP()));</span>
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :         for (indexDP = 0; indexDP &lt; AliGRPObject::GetNumberOfHP(); indexDP++){</span>
<span class="lineNum">    2361 </span>            :                 outOfRange = kFALSE; // resetting outOfRange flag at each HP
<span class="lineNum">    2362 </span><span class="lineNoCov">          0 :                 AliInfo(Form(&quot;==========%s===========&quot;,AliGRPObject::GetHPDP(indexDP)));</span>
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :                 array = (TObjArray *)valueMap-&gt;GetValue(AliGRPObject::GetHPDP(indexDP));</span>
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :                 if(!array) {</span>
<span class="lineNum">    2365 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;%s not found in the map!!!&quot;,AliGRPObject::GetHPDP(indexDP)));</span>
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :                 } </span>
<span class="lineNum">    2367 </span>            :                 else {
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :                         if (array-&gt;GetEntries() == 0){</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;No entries found in array! setting %s to invalid...&quot;,AliGRPObject::GetHPDP(indexDP)));</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2371 </span>            :                         else {
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                                 Float_t *floatDCS = ProcessFloatAll(array);</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :                                 if (floatDCS != NULL){</span>
<span class="lineNum">    2374 </span><span class="lineNoCov">          0 :                                         AliDebug(2,Form(&quot;value[0] = %f, value[1] = %f, value[2] = %f, value[3] = %f, value[4] = %f&quot;,floatDCS[0],floatDCS[1],floatDCS[2],floatDCS[3],floatDCS[4])); </span>
<span class="lineNum">    2375 </span><span class="lineNoCov">          0 :                                         grpObj-&gt;SetHallProbes((AliGRPObject::DP_HallProbes)indexDP,floatDCS);</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :                                         for (Int_t kk = 0 ; kk&lt; 5; kk++){</span>
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :                                                 AliDebug(2,Form(&quot;HallProbe[%d][%d]=%f&quot;,indexDP,kk,grpObj-&gt;GetHallProbes((AliGRPObject::DP_HallProbes)indexDP,(AliGRPObject::Stats)kk)));</span>
<span class="lineNum">    2378 </span>            :                                         }
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    2380 </span>            :                                 else{
<span class="lineNum">    2381 </span>            :                                         outOfRange = kTRUE;
<span class="lineNum">    2382 </span>            :                                 }
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :                                 if (floatDCS){</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :                                         delete[] floatDCS;</span>
<span class="lineNum">    2385 </span>            :                                         floatDCS = 0x0;
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :                                 }</span>
<span class="lineNum">    2387 </span>            :                         }
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :                         if (!outOfRange) {</span>
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :                                 ffailedDPs-&gt;RemoveAt(indexDP + fgkDCSDPHallTopShift);  // 7 = shift in the complete list of DPs to get to the Hall Probes</span>
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :                                 nHPEntries++;</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2392 </span>            :                 }
<span class="lineNum">    2393 </span>            :         }
<span class="lineNum">    2394 </span>            :                 
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :         Log(Form(&quot;Hall Probes = %d &quot;, nHPEntries));</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">          0 :         return nHPEntries;</span>
<span class="lineNum">    2397 </span>            : }
<span class="lineNum">    2398 </span>            : 
<a name="2399"><span class="lineNum">    2399 </span>            : //_________________________________________________________________________</a>
<span class="lineNum">    2400 </span>            : 
<span class="lineNum">    2401 </span>            : AliSplineFit* AliGRPPreprocessor::GetSplineFit(const TObjArray *array, const TString&amp; stringID){
<span class="lineNum">    2402 </span>            : 
<span class="lineNum">    2403 </span>            : 
<span class="lineNum">    2404 </span>            :         // 
<span class="lineNum">    2405 </span>            :         // returning Spline Fit 
<span class="lineNum">    2406 </span>            :         // 
<span class="lineNum">    2407 </span>            : 
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :         Int_t entriesarray = array-&gt;GetEntries();</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :         Float_t* value = new Float_t[entriesarray];</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :         Float_t* time = new Float_t[entriesarray];</span>
<span class="lineNum">    2411 </span>            :         AliDCSValue* v = 0x0;
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :         for (Int_t iarray = 0; iarray &lt; entriesarray; iarray++){</span>
<span class="lineNum">    2413 </span><span class="lineNoCov">          0 :                 v = (AliDCSValue*)array-&gt;At(iarray);</span>
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :                 value[iarray] = v-&gt;GetFloat();</span>
<span class="lineNum">    2415 </span><span class="lineNoCov">          0 :                 time[iarray] = v-&gt;GetTimeStamp();</span>
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :                 AliDebug(2,Form(&quot;iarray = %d, value = %f, time = %f&quot;,iarray,value[iarray],time[iarray]));</span>
<span class="lineNum">    2417 </span>            :         }
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :         TGraph* gr = new TGraph(entriesarray,value,time);</span>
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :         if (!gr ) {</span>
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 :                 AliWarning(Form(&quot;%s: no input graph to compute SplineFit&quot;,stringID.Data()));</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :                 return NULL;</span>
<span class="lineNum">    2422 </span>            :         }
<span class="lineNum">    2423 </span><span class="lineNoCov">          0 :         AliSplineFit *fit = new AliSplineFit();</span>
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :         fit-&gt;SetMinPoints(10);</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :         fit-&gt;InitKnots(gr,10,10,0.0);</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :         fit-&gt;SplineFit(2);</span>
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :         fit-&gt;Cleanup();</span>
<span class="lineNum">    2428 </span>            :         return fit;
<span class="lineNum">    2429 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2430 </span>            : 
<a name="2431"><span class="lineNum">    2431 </span>            : //_________________________________________________________________________</a>
<span class="lineNum">    2432 </span>            : 
<span class="lineNum">    2433 </span>            : TString AliGRPPreprocessor::ProcessChar(const TObjArray *array)
<span class="lineNum">    2434 </span>            : {
<span class="lineNum">    2435 </span>            : 
<span class="lineNum">    2436 </span>            :         // 
<span class="lineNum">    2437 </span>            :         // processing char
<span class="lineNum">    2438 </span>            :         //
<span class="lineNum">    2439 </span>            : 
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :         TString aDCSString=&quot;&quot;;</span>
<span class="lineNum">    2441 </span>            :         
<span class="lineNum">    2442 </span>            :         AliDCSValue *v = 0x0;
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :         for(Int_t iCount = 0; iCount &lt; array-&gt;GetEntries(); iCount++) {</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :                 v = (AliDCSValue *)array-&gt;At(iCount);</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :                 if (((Int_t)(v-&gt;GetTimeStamp()) &lt; (Int_t)GetStartTimeDCSQuery()) || ((Int_t)(v-&gt;GetTimeStamp()) &gt; (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval&quot;));</span>
<span class="lineNum">    2447 </span>            :                         continue;
<span class="lineNum">    2448 </span>            :                 }
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :                 if (iCount &gt; 0) {</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :                         if (aDCSString != v-&gt;GetChar())</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter changed from %s to %c within the queried interval&quot;, aDCSString.Data(), (Char_t)v-&gt;GetChar()));</span>
<span class="lineNum">    2452 </span>            :                 }
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :                 aDCSString = (TString)v-&gt;GetChar();  // keeping always last value in the array</span>
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2455 </span>            :         return aDCSString;
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2457 </span>            : 
<a name="2458"><span class="lineNum">    2458 </span>            : //__________________________________________________________________________________________________________________</a>
<span class="lineNum">    2459 </span>            : 
<span class="lineNum">    2460 </span>            : Float_t* AliGRPPreprocessor::ProcessFloatAll(const TObjArray* array)
<span class="lineNum">    2461 </span>            : {
<span class="lineNum">    2462 </span>            :         // 
<span class="lineNum">    2463 </span>            :         // processing Float values using Mean, Median, Standard Deviation wrt Mean, Standar Deviation wrt Median 
<span class="lineNum">    2464 </span>            :         //
<span class="lineNum">    2465 </span>            :         // parameters[0] = mean
<span class="lineNum">    2466 </span>            :         // parameters[1] = truncated mean (calculated excluding points outside +/- 3RMS from mean
<span class="lineNum">    2467 </span>            :         // parameters[2] = median
<span class="lineNum">    2468 </span>            :         // parameters[3] = standard deviation wrt mean
<span class="lineNum">    2469 </span>            :         // parameters[4] = standard deviation wrt median
<span class="lineNum">    2470 </span>            :         //
<span class="lineNum">    2471 </span>            : 
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :         TString timeStartString = (TString)GetRunParameter(&quot;DAQ_time_start&quot;);</span>
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :         TString timeEndString = (TString)GetRunParameter(&quot;DAQ_time_end&quot;);</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">          0 :         if (timeStartString.IsNull() || timeStartString.IsNull()){</span>
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :                 if (timeStartString.IsNull()){ </span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_start not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2477 </span>            :                 }
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :                 else if (timeStartString.IsNull()){</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_end not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2480 </span>            :                 }
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :                 fdaqStartEndTimeOk = kFALSE;</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    2483 </span>            :         }  
<span class="lineNum">    2484 </span>            : 
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :         Int_t timeStart = (Int_t)(timeStartString.Atoi());</span>
<span class="lineNum">    2486 </span><span class="lineNoCov">          0 :         Int_t timeEnd = (Int_t)(timeEndString.Atoi());</span>
<span class="lineNum">    2487 </span><span class="lineNoCov">          0 :         Float_t* parameters = new Float_t[5];</span>
<span class="lineNum">    2488 </span>            :         Int_t iCounts = 0;
<span class="lineNum">    2489 </span>            :         Int_t iCountsRun = 0;
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :         Int_t nCounts = array-&gt;GetEntries();</span>
<span class="lineNum">    2491 </span>            :         Float_t valueBeforeSOR = 0;
<span class="lineNum">    2492 </span>            :         Float_t valueAfterEOR = 0;
<span class="lineNum">    2493 </span>            :         Int_t timestampBeforeSOR = -1;
<span class="lineNum">    2494 </span>            :         Int_t timestampAfterEOR = -1;
<span class="lineNum">    2495 </span>            :         Int_t ientrySOR = -1;
<span class="lineNum">    2496 </span>            :         Int_t ientryEOR = -1;
<span class="lineNum">    2497 </span>            :         Float_t* arrayValues = 0x0; 
<span class="lineNum">    2498 </span>            :         Double_t* arrayWeights = 0x0; 
<span class="lineNum">    2499 </span>            :         Bool_t truncMeanFlag = kTRUE;  // flag to indicate whether Truncated Mean should be calculated or not
<span class="lineNum">    2500 </span>            :         Bool_t sdFlag = kTRUE;  // flag to indicate whether SD (wrt Mean/Median) should be calculated or not
<span class="lineNum">    2501 </span>            : 
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :         for(Int_t i = 0; i &lt; nCounts; i++) {</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :                 AliDCSValue *v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :                 if ((v-&gt;GetFloat() &lt;= fminFloat) || (v-&gt;GetFloat() &gt;= fmaxFloat)) {</span>
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;Error! Float value found in DCS map at %d-th entry is OUT OF RANGE: value = %6.5e&quot;,i,v-&gt;GetFloat()));</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :                         if (v-&gt;GetFloat() &lt; fminFloat) AliInfo(Form(&quot;The value is smaller than %6.5e&quot;,fminFloat));</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :                         if (v-&gt;GetFloat() &gt; fmaxFloat) AliInfo(Form(&quot;The value is greater than %6.5e&quot;,fmaxFloat));</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :                         delete [] parameters;</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :                         return NULL;</span>
<span class="lineNum">    2510 </span>            :                 }
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :                 if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%d-th entry = %f at timestamp %i&quot;,i,v-&gt;GetFloat(),v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :                         iCounts += 1;</span>
<span class="lineNum">    2514 </span>            :                         // look for the last value before SOR and the first value before EOR
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :                         if (((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &lt; timeStart) {</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :                                 timestampBeforeSOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of last value before SOR = %d, with DAQ_time_start = %d&quot;,timestampBeforeSOR,timeStart));</span>
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :                                 valueBeforeSOR = v-&gt;GetFloat();</span>
<span class="lineNum">    2519 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2520 </span><span class="lineNoCov">          0 :                         else if ((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery() &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &gt; timeEnd &amp;&amp; timestampAfterEOR == -1){</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :                                 timestampAfterEOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2522 </span><span class="lineNoCov">          0 :                                 valueAfterEOR = v-&gt;GetFloat();</span>
<span class="lineNum">    2523 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of first value after EOR = %d, with DAQ_time_end = %d&quot;,timestampAfterEOR,timeEnd));</span>
<span class="lineNum">    2524 </span>            :                         }
<span class="lineNum">    2525 </span>            :                         // check if there are DPs between DAQ_time_start and DAQ_time_end
<span class="lineNum">    2526 </span><span class="lineNoCov">          0 :                         if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= timeStart) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= timeEnd)) {</span>
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :                                 if (ientrySOR == -1) ientrySOR = i;  // first entry after SOR</span>
<span class="lineNum">    2528 </span><span class="lineNoCov">          0 :                                 if (ientryEOR &lt; i) ientryEOR = i;  // last entry before EOR</span>
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;entry between SOR and EOR&quot;));</span>
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 :                                 iCountsRun += 1;</span>
<span class="lineNum">    2531 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2532 </span>            :                 }
<span class="lineNum">    2533 </span>            :                 else {
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval: timestamp = %d&quot;,v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    2535 </span>            :                 }
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2537 </span>            : 
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :         if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found before SOR&quot;);</span>
<span class="lineNum">    2540 </span>            :         }
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 :         if (timestampAfterEOR == -1){</span>
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found after EOR&quot;);</span>
<span class="lineNum">    2543 </span>            :         }
<span class="lineNum">    2544 </span>            : 
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Number of valid entries (within DCS query interval) = %i, from a total amount of %i entries&quot;,iCounts,nCounts));</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Last value before DAQ_time_start (SOR) = %f at timestamp = %d&quot;,valueBeforeSOR,timestampBeforeSOR));</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;First value after DAQ_time_end (EOR)   = %f at timestamp = %d&quot;,valueAfterEOR,timestampAfterEOR));</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Found %d entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;,iCountsRun));</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry after DAQ_time_start (SOR) = %d &quot;,ientrySOR));</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry before DAQ_time_end (EOR) = %d &quot;,ientryEOR));</span>
<span class="lineNum">    2551 </span>            : 
<span class="lineNum">    2552 </span>            :         Int_t nentriesUsed = 0;
<span class="lineNum">    2553 </span><span class="lineNoCov">          0 :         if (iCountsRun &gt; 1){</span>
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;Using entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;);</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :                 AliDebug(2,&quot;Calculating (weighted) Mean and Median&quot;);</span>
<span class="lineNum">    2556 </span><span class="lineNoCov">          0 :                 arrayValues = new Float_t[iCountsRun]; </span>
<span class="lineNum">    2557 </span><span class="lineNoCov">          0 :                 arrayWeights = new Double_t[iCountsRun]; </span>
<span class="lineNum">    2558 </span>            :                 nentriesUsed = iCountsRun;
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :                 for (Int_t i = ientrySOR; i &lt;= ientryEOR; i++){</span>
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :                         AliDCSValue *v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2561 </span>            :                         Int_t timestamp2 = 0;
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 :                         if (i &lt; ientryEOR){</span>
<span class="lineNum">    2563 </span><span class="lineNoCov">          0 :                                 AliDCSValue *v1 = (AliDCSValue *)array-&gt;At(i+1);</span>
<span class="lineNum">    2564 </span><span class="lineNoCov">          0 :                                 timestamp2 = (Int_t)v1-&gt;GetTimeStamp();</span>
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2566 </span>            :                         else {
<span class="lineNum">    2567 </span><span class="lineNoCov">          0 :                                 timestamp2 = timeEnd+1;</span>
<span class="lineNum">    2568 </span>            :                         }
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :                         arrayWeights[i-ientrySOR] = (Double_t)(timestamp2 - (Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :                         arrayValues[i-ientrySOR] = v-&gt;GetFloat();</span>
<span class="lineNum">    2571 </span>            :                 }
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :                 parameters[0] = TMath::Mean(iCountsRun,arrayValues,arrayWeights);</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :                 parameters[2] = TMath::Median(iCountsRun,arrayValues,arrayWeights);</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :         else if (iCountsRun == 1){</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :                 AliDCSValue* v = (AliDCSValue *)array-&gt;At(ientrySOR);</span>
<span class="lineNum">    2577 </span>            :                 nentriesUsed = 2;
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR != -1 &amp;&amp; timestampBeforeSOR != (Int_t)v-&gt;GetTimeStamp()){</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using single entry between DAQ_time_start (SOR) and DAQ_time_end (EOR) and last entry before SOR. Truncated mean won't be calculated.&quot;);</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :                         arrayValues = new Float_t[2];</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :                         arrayWeights = new Double_t[2];</span>
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :                         arrayValues[0] = valueBeforeSOR;</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :                         arrayWeights[0] = (Double_t)((Int_t)v-&gt;GetTimeStamp()-timestampBeforeSOR);</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :                         arrayValues[1] = v-&gt;GetFloat();</span>
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :                         arrayWeights[1] = (Double_t)(timeEnd+1-(Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :                         AliDebug(2, Form(&quot;value0 = %f, with weight = %f&quot;,arrayValues[0],arrayWeights[0])); </span>
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :                         AliDebug(2, Form(&quot;value1 = %f, with weight = %f&quot;,arrayValues[1],arrayWeights[1])); </span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :                         parameters[0] = TMath::Mean(2,arrayValues,arrayWeights);</span>
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :                         parameters[2] = TMath::Median(2,arrayValues,arrayWeights);</span>
<span class="lineNum">    2590 </span>            :                         truncMeanFlag = kFALSE;
<span class="lineNum">    2591 </span>            :                 }
<span class="lineNum">    2592 </span>            :                 else{
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :                         AliError(&quot;Cannot calculate mean, truncated mean, median, SD wrt mean, SD wrt median for current DP - only one value collected during the run, but no value before with which to calculate the statistical quantities&quot;);</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">          0 :                         parameters[0] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :                         parameters[1] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :                         parameters[2] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :                         parameters[3] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :                         parameters[4] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :                         return parameters;</span>
<span class="lineNum">    2600 </span>            :                 }
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2602 </span>            :         else { // iCountsRun == 0, using only the point immediately before SOR
<span class="lineNum">    2603 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    2604 </span><span class="lineNoCov">          0 :                         AliError(&quot;Cannot set mean, truncated mean, median, SD wrt mean, SD wrt median for current DP - no points during the run collected, and point before SOR missing&quot;);</span>
<span class="lineNum">    2605 </span><span class="lineNoCov">          0 :                         parameters[0] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :                         parameters[1] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :                         parameters[2] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2608 </span><span class="lineNoCov">          0 :                         parameters[3] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :                         parameters[4] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :                         return parameters;</span>
<span class="lineNum">    2611 </span>            :                 }
<span class="lineNum">    2612 </span>            :                 else {
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using only last entry before SOR. Truncated mean and Standard deviations (wrt mean/median) won't be calculated.&quot;);</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value = %f&quot;,valueBeforeSOR)); </span>
<span class="lineNum">    2615 </span><span class="lineNoCov">          0 :                         parameters[0] = valueBeforeSOR;</span>
<span class="lineNum">    2616 </span><span class="lineNoCov">          0 :                         parameters[2] = valueBeforeSOR;</span>
<span class="lineNum">    2617 </span>            :                         truncMeanFlag = kFALSE;
<span class="lineNum">    2618 </span>            :                         sdFlag = kFALSE;
<span class="lineNum">    2619 </span>            :                 }
<span class="lineNum">    2620 </span>            :         }
<span class="lineNum">    2621 </span>            : 
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :         AliDebug(2, Form(&quot;nentriesUsed = %d&quot;, nentriesUsed));</span>
<span class="lineNum">    2623 </span>            :         Float_t temp = 0;
<span class="lineNum">    2624 </span>            :         Float_t temp1 = 0;
<span class="lineNum">    2625 </span>            :         Float_t sumweights = 0; 
<span class="lineNum">    2626 </span>            :         Int_t entriesTruncMean = 0;
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :         Float_t* arrayValuesTruncMean = new Float_t[nentriesUsed]; </span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :         Double_t* arrayWeightsTruncMean = new Double_t[nentriesUsed]; </span>
<span class="lineNum">    2629 </span>            : 
<span class="lineNum">    2630 </span>            :         // calculating SD wrt Mean and Median
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :         AliDebug(2,&quot;Calculating SD wrt Mean and SD wrt Median&quot;);</span>
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :         if (sdFlag){</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :                 for (Int_t i =0; i&lt; nentriesUsed; i++){</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;Entry %d: value = %f, weight = %f&quot;,i,arrayValues[i],arrayWeights[i]));</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :                         temp += (arrayValues[i]-parameters[2])*(arrayValues[i]-parameters[2]);</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :                         temp1 += arrayWeights[i]*(arrayValues[i]-parameters[0])*(arrayValues[i]-parameters[0]);</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :                         sumweights += arrayWeights[i];</span>
<span class="lineNum">    2638 </span>            :                 }
<span class="lineNum">    2639 </span>            :                 // setting SD wrt Mean 
<span class="lineNum">    2640 </span><span class="lineNoCov">          0 :                 if (sumweights != 0 ){</span>
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 :                         parameters[3] = TMath::Sqrt(temp1/sumweights);</span>
<span class="lineNum">    2642 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2643 </span>            :                 else {
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :                         AliError(&quot;Sum of weights to calculate Standard Deviation (wrt mean) &lt;= 0, setting the SD to invalid&quot;);</span>
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :                         parameters[3] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2646 </span>            :                 }
<span class="lineNum">    2647 </span>            :                 // setting SD wrt Median
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :                 if (nentriesUsed != 0){</span>
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :                         parameters[4] = TMath::Sqrt(temp/nentriesUsed);</span>
<span class="lineNum">    2650 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2651 </span>            :                 else{
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :                         AliError(&quot;Number of entries used to calculate Standard Deviation (wrt median) &lt;= 0, setting the SD to invalid&quot;);</span>
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 :                         parameters[4] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2654 </span>            :                 }
<span class="lineNum">    2655 </span>            :         }
<span class="lineNum">    2656 </span>            :         else {
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 :                 parameters[3] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2658 </span><span class="lineNoCov">          0 :                 parameters[4] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2659 </span>            :         }               
<span class="lineNum">    2660 </span>            : 
<span class="lineNum">    2661 </span>            :         // calculating truncated mean (this comes afterwards since you need the SD wrt Mean)
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :         if (truncMeanFlag){</span>
<span class="lineNum">    2663 </span><span class="lineNoCov">          0 :                 AliDebug(2,&quot;Calculating Truncated Mean&quot;);</span>
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :                 for (Int_t i =0; i&lt; nentriesUsed; i++){</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;Entry %d: value = %f, weight = %f&quot;,i,arrayValues[i],arrayWeights[i]));</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :                         if ((arrayValues[i]&lt;=parameters[0]+3*parameters[3]) &amp;&amp; (arrayValues[i]&gt;=parameters[0]-3*parameters[3])){</span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :                                 arrayValuesTruncMean[entriesTruncMean]=arrayValues[i];</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                                 arrayWeightsTruncMean[entriesTruncMean]=arrayWeights[i];</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;For Truncated Mean: Entry %d: value = %f, weight = %f&quot;,entriesTruncMean,arrayValuesTruncMean[entriesTruncMean],arrayWeightsTruncMean[entriesTruncMean]));</span>
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :                                 entriesTruncMean++;                     </span>
<span class="lineNum">    2671 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2672 </span>            :                         else{
<span class="lineNum">    2673 </span><span class="lineNoCov">          0 :                                 AliDebug(2,&quot;Discarding entry&quot;);</span>
<span class="lineNum">    2674 </span>            :                         }
<span class="lineNum">    2675 </span>            :                 }
<span class="lineNum">    2676 </span>            :                 // setting truncated mean 
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :                 if (entriesTruncMean &gt;1){</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%d entries used for truncated mean&quot;,entriesTruncMean));</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                         parameters[1] = TMath::Mean(entriesTruncMean,arrayValuesTruncMean,arrayWeightsTruncMean);</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2681 </span>            :                 else{   
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;Too few entries (%d) to calculate truncated mean&quot;,entriesTruncMean));</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :                         parameters[1] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2684 </span>            :                 }
<span class="lineNum">    2685 </span>            :         }
<span class="lineNum">    2686 </span>            :         else{
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :                         parameters[1] = AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2688 </span>            :         }
<span class="lineNum">    2689 </span>            : 
<span class="lineNum">    2690 </span><span class="lineNoCov">          0 :         if (arrayValues){</span>
<span class="lineNum">    2691 </span><span class="lineNoCov">          0 :                 delete [] arrayValues;</span>
<span class="lineNum">    2692 </span>            :         } 
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :         if (arrayWeights){</span>
<span class="lineNum">    2694 </span><span class="lineNoCov">          0 :                 delete [] arrayWeights;</span>
<span class="lineNum">    2695 </span>            :         } 
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :         delete [] arrayValuesTruncMean;</span>
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 :         delete [] arrayWeightsTruncMean;</span>
<span class="lineNum">    2698 </span>            : 
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;(weighted) mean = %f &quot;,parameters[0]));</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;(weighted) truncated mean = %f &quot;,parameters[1]));</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;median = %f &quot;,parameters[2]));</span>
<span class="lineNum">    2702 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;(weighted) standard deviation with (weighted) mean = %f &quot;,parameters[3]));</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;standard deviation with median = %f &quot;,parameters[4]));</span>
<span class="lineNum">    2704 </span>            :         
<span class="lineNum">    2705 </span>            :         return parameters;
<span class="lineNum">    2706 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2707 </span>            : 
<a name="2708"><span class="lineNum">    2708 </span>            : //__________________________________________________________________________________________________________________</a>
<span class="lineNum">    2709 </span>            : 
<span class="lineNum">    2710 </span>            : Float_t* AliGRPPreprocessor::ProcessFloatAllMagnet(const TObjArray* array, Int_t indexDP, Bool_t &amp;isZero)
<span class="lineNum">    2711 </span>            : {
<span class="lineNum">    2712 </span>            :         // 
<span class="lineNum">    2713 </span>            :         // processing Float values using Mean, Median, Standard Deviation wrt Mean, Standar Deviation wrt Median 
<span class="lineNum">    2714 </span>            :         // used for L3 and Dipole magnets, using isZero flag to decide whther the magnet was OFF/ON
<span class="lineNum">    2715 </span>            :         // the flag is set according to the L3/Dipole current value
<span class="lineNum">    2716 </span>            :         // current threshold for L3 = 350 A (value provided by DCS)
<span class="lineNum">    2717 </span>            :         // current threshold for Dipole = 450 A (value provided by DCS)
<span class="lineNum">    2718 </span>            :         //
<span class="lineNum">    2719 </span>            :         // parameters[0] = mean
<span class="lineNum">    2720 </span>            :         // parameters[1] = truncated mean (calculated excluding points outside +/- 3RMS from mean
<span class="lineNum">    2721 </span>            :         // parameters[2] = median
<span class="lineNum">    2722 </span>            :         // parameters[3] = standard deviation wrt mean
<span class="lineNum">    2723 </span>            :         // parameters[4] = standard deviation wrt median
<span class="lineNum">    2724 </span>            :         //
<span class="lineNum">    2725 </span>            : 
<span class="lineNum">    2726 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;indexDP = %d&quot;,indexDP)); </span>
<span class="lineNum">    2727 </span>            : 
<span class="lineNum">    2728 </span><span class="lineNoCov">          0 :         Int_t nCounts = array-&gt;GetEntries();</span>
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 :         for(Int_t i = 0; i &lt; nCounts; i++) {</span>
<span class="lineNum">    2730 </span><span class="lineNoCov">          0 :                 AliDCSValue *v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :                 if ((v-&gt;GetFloat() &lt;= fminFloat) || (v-&gt;GetFloat() &gt;= fmaxFloat)) {</span>
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;Error! Float value found in DCS map at %d-th entry is OUT OF RANGE: value = %6.5e&quot;,i,v-&gt;GetFloat()));</span>
<span class="lineNum">    2733 </span><span class="lineNoCov">          0 :                         if (v-&gt;GetFloat() &lt; fminFloat) AliInfo(Form(&quot;The value is smaller than %6.5e&quot;,fminFloat));</span>
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :                         if (v-&gt;GetFloat() &gt; fmaxFloat) AliInfo(Form(&quot;The value is greater than %6.5e&quot;,fmaxFloat));</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :                         return NULL;</span>
<span class="lineNum">    2736 </span>            :                 }
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :                 if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2738 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%d-th entry = %f&quot;,i,v-&gt;GetFloat()));</span>
<span class="lineNum">    2739 </span><span class="lineNoCov">          0 :                         if (indexDP == kL3Current &amp;&amp; v-&gt;GetFloat() &gt; 350 &amp;&amp; isZero == kTRUE) isZero=kFALSE; </span>
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :                         if (indexDP == kDipoleCurrent &amp;&amp; v-&gt;GetFloat() &gt; 450 &amp;&amp; isZero == kTRUE) isZero=kFALSE; </span>
<span class="lineNum">    2741 </span>            :                 }
<span class="lineNum">    2742 </span>            :                 else {
<span class="lineNum">    2743 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval&quot;));</span>
<span class="lineNum">    2744 </span>            :                 }
<span class="lineNum">    2745 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2746 </span>            : 
<span class="lineNum">    2747 </span><span class="lineNoCov">          0 :         return ProcessFloatAll(array);</span>
<span class="lineNum">    2748 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2749 </span>            : 
<span class="lineNum">    2750 </span>            : 
<a name="2751"><span class="lineNum">    2751 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2752 </span>            : 
<span class="lineNum">    2753 </span>            : Char_t AliGRPPreprocessor::ProcessBool(const TObjArray* array, Bool_t &amp;change)
<span class="lineNum">    2754 </span>            : {
<span class="lineNum">    2755 </span>            :         // 
<span class="lineNum">    2756 </span>            :         // processing Boolean values
<span class="lineNum">    2757 </span>            :         //
<span class="lineNum">    2758 </span>            : 
<span class="lineNum">    2759 </span>            :         Bool_t aDCSBool = kTRUE;
<span class="lineNum">    2760 </span>            : 
<span class="lineNum">    2761 </span>            :         AliDCSValue *v = 0x0;
<span class="lineNum">    2762 </span>            :         Int_t usefulCounts = 0;
<span class="lineNum">    2763 </span>            : 
<span class="lineNum">    2764 </span><span class="lineNoCov">          0 :         for(Int_t iCount = 0; iCount &lt; array-&gt;GetEntries(); iCount++) {</span>
<span class="lineNum">    2765 </span><span class="lineNoCov">          0 :                 v = (AliDCSValue *)array-&gt;At(iCount);</span>
<span class="lineNum">    2766 </span><span class="lineNoCov">          0 :                 if (((Int_t)(v-&gt;GetTimeStamp()) &lt; (Int_t)GetStartTimeDCSQuery()) || ((Int_t)(v-&gt;GetTimeStamp()) &gt; (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2767 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval, timestamp = %d (startTime = %d, endTime = %d)&quot;, (Int_t)(v-&gt;GetTimeStamp()), (Int_t)GetStartTimeDCSQuery(), (Int_t)GetEndTimeDCSQuery()));</span>
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">    2769 </span>            :                 }
<span class="lineNum">    2770 </span><span class="lineNoCov">          0 :                 usefulCounts++;</span>
<span class="lineNum">    2771 </span><span class="lineNoCov">          0 :                 if (usefulCounts == 1) {</span>
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :                         aDCSBool = v-&gt;GetBool();  // initializing to first useful value</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :                 }               </span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :                 else if (usefulCounts &gt; 1) {</span>
<span class="lineNum">    2775 </span><span class="lineNoCov">          0 :                         if (aDCSBool != v-&gt;GetBool()) {</span>
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :                                 AliError(Form(&quot;DCS values for the parameter changed from %d to %d within the queried interval&quot;, (UInt_t)aDCSBool, (UInt_t)v-&gt;GetBool()));</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :                                 change = kTRUE;</span>
<span class="lineNum">    2778 </span><span class="lineNoCov">          0 :                                 aDCSBool = v-&gt;GetBool(); // always keeping last value</span>
<span class="lineNum">    2779 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2780 </span>            :                 }
<span class="lineNum">    2781 </span><span class="lineNoCov">          0 :                 AliDebug(2,Form(&quot;Bool = %d, timeStamp = %d&quot;,(Int_t)aDCSBool, (Int_t)(v-&gt;GetTimeStamp())));</span>
<span class="lineNum">    2782 </span>            :         }
<span class="lineNum">    2783 </span>            :         
<span class="lineNum">    2784 </span><span class="lineNoCov">          0 :         Char_t caDCSBool = (Char_t) aDCSBool;</span>
<span class="lineNum">    2785 </span><span class="lineNoCov">          0 :         return caDCSBool;</span>
<span class="lineNum">    2786 </span>            :         
<span class="lineNum">    2787 </span>            : }
<span class="lineNum">    2788 </span>            : 
<a name="2789"><span class="lineNum">    2789 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2790 </span>            : 
<span class="lineNum">    2791 </span>            : Float_t AliGRPPreprocessor::ProcessInt(const TObjArray* array)
<span class="lineNum">    2792 </span>            : {
<span class="lineNum">    2793 </span>            :         // 
<span class="lineNum">    2794 </span>            :         // processing Int values, returning mean
<span class="lineNum">    2795 </span>            :         // AliGRPObject::GetInvalidFloat() is returned if any of the DCS values
<span class="lineNum">    2796 </span>            :         // are outside the queried time interval or their value is out of range
<span class="lineNum">    2797 </span>            :         //
<span class="lineNum">    2798 </span>            : 
<span class="lineNum">    2799 </span><span class="lineNoCov">          0 :         TString timeStartString = (TString)GetRunParameter(&quot;DAQ_time_start&quot;);</span>
<span class="lineNum">    2800 </span><span class="lineNoCov">          0 :         TString timeEndString = (TString)GetRunParameter(&quot;DAQ_time_end&quot;);</span>
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :         if (timeStartString.IsNull() || timeStartString.IsNull()){</span>
<span class="lineNum">    2802 </span><span class="lineNoCov">          0 :                 if (timeStartString.IsNull()){ </span>
<span class="lineNum">    2803 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_start not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2804 </span>            :                 }
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :                 else if (timeStartString.IsNull()){</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_end not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2807 </span>            :                 }
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    2809 </span>            :         }  
<span class="lineNum">    2810 </span>            : 
<span class="lineNum">    2811 </span><span class="lineNoCov">          0 :         Int_t timeStart = (Int_t)(timeStartString.Atoi());</span>
<span class="lineNum">    2812 </span><span class="lineNoCov">          0 :         Int_t timeEnd = (Int_t)(timeEndString.Atoi());</span>
<span class="lineNum">    2813 </span>            :         Float_t aDCSArrayMean = 0.0;
<span class="lineNum">    2814 </span>            :         Int_t iCounts = 0;
<span class="lineNum">    2815 </span>            :         Float_t valueBeforeSOR = 0;
<span class="lineNum">    2816 </span>            :         Float_t valueAfterEOR = 0;
<span class="lineNum">    2817 </span>            :         Int_t timestampBeforeSOR = -1;
<span class="lineNum">    2818 </span>            :         Int_t timestampAfterEOR = -1;
<span class="lineNum">    2819 </span>            :         Int_t ientrySOR = -1;
<span class="lineNum">    2820 </span>            :         Int_t ientryEOR = -1;
<span class="lineNum">    2821 </span>            :         Float_t* arrayValues = 0x0; 
<span class="lineNum">    2822 </span>            :         Double_t* arrayWeights = 0x0; 
<span class="lineNum">    2823 </span>            :         Int_t iCountsRun = 0;
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :         Int_t nCounts = array-&gt;GetEntries();</span>
<span class="lineNum">    2825 </span>            : 
<span class="lineNum">    2826 </span><span class="lineNoCov">          0 :         for(Int_t i = 0; i &lt; nCounts; i++) {</span>
<span class="lineNum">    2827 </span><span class="lineNoCov">          0 :                 AliDCSValue* v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :                 if ((v-&gt;GetInt() &lt; fminInt) || (v-&gt;GetInt() &gt; fmaxInt)) {</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;Error! Int value found in DCS map at %d-th entry is OUT OF RANGE: value = %d&quot;,i, v-&gt;GetInt()));</span>
<span class="lineNum">    2830 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2831 </span>            :                 }
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 :                 if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%d-th entry = %d at timestamp %i&quot;,i,v-&gt;GetInt(),v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :                         iCounts += 1;</span>
<span class="lineNum">    2835 </span>            :                         // look for the last value before SOR and the first value before EOR
<span class="lineNum">    2836 </span><span class="lineNoCov">          0 :                         if (((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &lt; timeStart) {</span>
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :                                 timestampBeforeSOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of last entry before SOR = %d, with DAQ_time_start = %d&quot;,timestampBeforeSOR,timeStart));</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :                                 valueBeforeSOR = (Float_t) v-&gt;GetInt();</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 :                         else if ((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery() &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &gt; timeEnd &amp;&amp; timestampAfterEOR == -1){</span>
<span class="lineNum">    2842 </span><span class="lineNoCov">          0 :                                 timestampAfterEOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2843 </span><span class="lineNoCov">          0 :                                 valueAfterEOR = (Float_t) v-&gt;GetInt();</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of first entry after EOR = %d, with DAQ_time_end = %d&quot;,timestampAfterEOR,timeEnd));</span>
<span class="lineNum">    2845 </span>            :                         }
<span class="lineNum">    2846 </span>            :                         // check if there are DPs between DAQ_time_start and DAQ_time_end
<span class="lineNum">    2847 </span><span class="lineNoCov">          0 :                         if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= timeStart) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= timeEnd)) {</span>
<span class="lineNum">    2848 </span><span class="lineNoCov">          0 :                                 if (ientrySOR == -1) ientrySOR = i;  // first entry after SOR</span>
<span class="lineNum">    2849 </span><span class="lineNoCov">          0 :                                 if (ientryEOR &lt; i) ientryEOR = i;  // last entry before EOR</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;entry between SOR and EOR&quot;));</span>
<span class="lineNum">    2851 </span><span class="lineNoCov">          0 :                                 iCountsRun += 1;</span>
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2853 </span>            :                 }
<span class="lineNum">    2854 </span>            :                 else {
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval: timestamp = %d&quot;,v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    2856 </span>            :                 }
<span class="lineNum">    2857 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2858 </span>            : 
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :         if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    2860 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found before SOR!&quot;);</span>
<span class="lineNum">    2861 </span>            :         }
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 :         if (timestampAfterEOR == -1){</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found after EOR!&quot;);</span>
<span class="lineNum">    2864 </span>            :         }
<span class="lineNum">    2865 </span>            : 
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Number of valid entries (within query interval) = %i, starting from %i entries&quot;,iCounts,nCounts));</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Last value before DAQ_time_start (SOR) = %f at timestamp = %d&quot;,valueBeforeSOR,timestampBeforeSOR));</span>
<span class="lineNum">    2868 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;First value after DAQ_time_end (EOR)   = %f at timestamp = %d&quot;,valueAfterEOR,timestampAfterEOR));</span>
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Found %d entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;,iCountsRun));</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry after DAQ_time_start (SOR) = %d &quot;,ientrySOR));</span>
<span class="lineNum">    2871 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry before DAQ_time_end (EOR) = %d &quot;,ientryEOR));</span>
<span class="lineNum">    2872 </span>            : 
<span class="lineNum">    2873 </span>            :         Int_t nentriesUsed = 0;
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :         if (iCountsRun &gt; 1){</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;Using entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;);</span>
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :                 AliDebug(2,&quot;Calculating (weighted) Mean&quot;);</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :                 arrayValues = new Float_t[iCountsRun]; </span>
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :                 arrayWeights = new Double_t[iCountsRun]; </span>
<span class="lineNum">    2879 </span>            :                 nentriesUsed = iCountsRun;
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :                 for (Int_t i = ientrySOR; i &lt;= ientryEOR; i++){</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :                         AliDCSValue *v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2882 </span>            :                         Int_t timestamp2 = 0;
<span class="lineNum">    2883 </span><span class="lineNoCov">          0 :                         if (i &lt; ientryEOR){</span>
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :                                 AliDCSValue *v1 = (AliDCSValue *)array-&gt;At(i+1);</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :                                 timestamp2 = (Int_t)v1-&gt;GetTimeStamp();</span>
<span class="lineNum">    2886 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    2887 </span>            :                         else {
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :                                 timestamp2 = timeEnd+1;</span>
<span class="lineNum">    2889 </span>            :                         }
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :                         arrayWeights[i-ientrySOR] = (Double_t)(timestamp2 - (Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :                         arrayValues[i-ientrySOR] = (Float_t)v-&gt;GetInt();</span>
<span class="lineNum">    2892 </span>            :                 }
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :                 aDCSArrayMean = TMath::Mean(iCountsRun,arrayValues,arrayWeights);</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">          0 :                 delete [] arrayValues;</span>
<span class="lineNum">    2895 </span><span class="lineNoCov">          0 :                 delete [] arrayWeights;</span>
<span class="lineNum">    2896 </span>            :         }
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :         else if (iCountsRun == 1){</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :                 AliDCSValue* v = (AliDCSValue *)array-&gt;At(ientrySOR);</span>
<span class="lineNum">    2899 </span>            :                 nentriesUsed = 2;
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR != -1 &amp;&amp; timestampBeforeSOR != (Int_t)v-&gt;GetTimeStamp()){</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using single entry between DAQ_time_start (SOR) and DAQ_time_end (EOR) and last entry before SOR.&quot;);</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :                         arrayValues = new Float_t[2];</span>
<span class="lineNum">    2903 </span><span class="lineNoCov">          0 :                         arrayWeights = new Double_t[2];</span>
<span class="lineNum">    2904 </span><span class="lineNoCov">          0 :                         arrayValues[0] = valueBeforeSOR;</span>
<span class="lineNum">    2905 </span><span class="lineNoCov">          0 :                         arrayWeights[0] = (Double_t)((Int_t)v-&gt;GetTimeStamp()-timestampBeforeSOR);</span>
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :                         arrayValues[1] = (Float_t)v-&gt;GetInt();</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :                         arrayWeights[1] = (Double_t)(timeEnd+1-(Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value0 = %f, with weight = %f&quot;,arrayValues[0],arrayWeights[0])); </span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value1 = %f, with weight = %f&quot;,arrayValues[1],arrayWeights[1])); </span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :                         aDCSArrayMean = TMath::Mean(2,arrayValues,arrayWeights);</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :                         delete [] arrayValues;</span>
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :                         delete [] arrayWeights;</span>
<span class="lineNum">    2913 </span>            :                 }
<span class="lineNum">    2914 </span>            :                 else{
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :                         AliError(&quot;Cannot calculate mean - only one value collected during the run, but no value before with which to calculate the statistical quantities&quot;);</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2917 </span>            :                 }
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    2919 </span>            :         else { // iCountsRun == 0, using the point immediately before SOR and the one immediately after EOR
<span class="lineNum">    2920 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR == -1 || timestampAfterEOR == -1){</span>
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :                         if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :                                 AliError(&quot;Cannot calculate mean - no points during the run collected, and point before SOR missing&quot;);</span>
<span class="lineNum">    2923 </span>            :                         }
<span class="lineNum">    2924 </span><span class="lineNoCov">          0 :                         if (timestampAfterEOR == -1){</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :                                 AliError(&quot;Cannot calculate maen - no points during the run collected, and point after EOR missing&quot;);</span>
<span class="lineNum">    2926 </span>            :                         }
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2928 </span>            :                 }
<span class="lineNum">    2929 </span>            :                 else {
<span class="lineNum">    2930 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using last entry before SOR and first entry after EOR.&quot;);</span>
<span class="lineNum">    2931 </span>            :                         nentriesUsed = 2;
<span class="lineNum">    2932 </span><span class="lineNoCov">          0 :                         arrayValues = new Float_t[2];</span>
<span class="lineNum">    2933 </span><span class="lineNoCov">          0 :                         arrayWeights = new Double_t[2];</span>
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :                         arrayValues[0] = valueBeforeSOR;</span>
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :                         arrayWeights[0] = (Double_t)(timestampAfterEOR - timestampBeforeSOR);</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :                         arrayValues[1] = valueAfterEOR;</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :                         arrayWeights[1] = 1.;</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value0 = %f, with weight = %f&quot;,arrayValues[0],arrayWeights[0])); </span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value1 = %f, with weight = %f&quot;,arrayValues[1],arrayWeights[1])); </span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :                         aDCSArrayMean = TMath::Mean(1,arrayValues,arrayWeights);</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :                         delete [] arrayValues;</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :                         delete [] arrayWeights;</span>
<span class="lineNum">    2943 </span>            :                 }
<span class="lineNum">    2944 </span>            :         }
<span class="lineNum">    2945 </span>            : 
<span class="lineNum">    2946 </span><span class="lineNoCov">          0 :         AliDebug(2, Form(&quot;nentriesUsed = %d&quot;, nentriesUsed));</span>
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;mean = %f &quot;, aDCSArrayMean));</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :         return aDCSArrayMean;</span>
<span class="lineNum">    2949 </span>            : 
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 : }</span>
<a name="2951"><span class="lineNum">    2951 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    2952 </span>            : 
<span class="lineNum">    2953 </span>            : Float_t AliGRPPreprocessor::ProcessUInt(const TObjArray* array)
<span class="lineNum">    2954 </span>            : {
<span class="lineNum">    2955 </span>            :         // 
<span class="lineNum">    2956 </span>            :         // processing Int values, returning mean 
<span class="lineNum">    2957 </span>            :         // AliGRPObject::GetInvalidFloat() is returned if any of the DCS values
<span class="lineNum">    2958 </span>            :         // are outside the queried time interval or their value is out of range
<span class="lineNum">    2959 </span>            :         //
<span class="lineNum">    2960 </span>            : 
<span class="lineNum">    2961 </span><span class="lineNoCov">          0 :         TString timeStartString = (TString)GetRunParameter(&quot;DAQ_time_start&quot;);</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">          0 :         TString timeEndString = (TString)GetRunParameter(&quot;DAQ_time_end&quot;);</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :         if (timeStartString.IsNull() || timeStartString.IsNull()){</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :                 if (timeStartString.IsNull()){ </span>
<span class="lineNum">    2965 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_start not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2966 </span>            :                 }
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                 else if (timeStartString.IsNull()){</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                         AliError(&quot;DAQ_time_end not set in logbook! Setting statistical values for current DP to invalid&quot;);</span>
<span class="lineNum">    2969 </span>            :                 }
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">    2971 </span>            :         }  
<span class="lineNum">    2972 </span>            : 
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :         Int_t timeStart = (Int_t)(timeStartString.Atoi());</span>
<span class="lineNum">    2974 </span><span class="lineNoCov">          0 :         Int_t timeEnd = (Int_t)(timeEndString.Atoi());</span>
<span class="lineNum">    2975 </span>            :         Float_t aDCSArrayMean = 0.0;
<span class="lineNum">    2976 </span>            :         Int_t iCounts = 0;
<span class="lineNum">    2977 </span>            :         Float_t valueBeforeSOR = 0;
<span class="lineNum">    2978 </span>            :         Float_t valueAfterEOR = 0;
<span class="lineNum">    2979 </span>            :         Int_t timestampBeforeSOR = -1;
<span class="lineNum">    2980 </span>            :         Int_t timestampAfterEOR = -1;
<span class="lineNum">    2981 </span>            :         Int_t ientrySOR = -1;
<span class="lineNum">    2982 </span>            :         Int_t ientryEOR = -1;
<span class="lineNum">    2983 </span>            :         Float_t* arrayValues = 0x0; 
<span class="lineNum">    2984 </span>            :         Double_t* arrayWeights = 0x0; 
<span class="lineNum">    2985 </span>            :         Int_t iCountsRun = 0;
<span class="lineNum">    2986 </span><span class="lineNoCov">          0 :         Int_t nCounts = array-&gt;GetEntries();</span>
<span class="lineNum">    2987 </span>            : 
<span class="lineNum">    2988 </span><span class="lineNoCov">          0 :         for(Int_t i = 0; i &lt; nCounts; i++) {</span>
<span class="lineNum">    2989 </span><span class="lineNoCov">          0 :                 AliDCSValue* v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    2990 </span><span class="lineNoCov">          0 :                 if ((v-&gt;GetUInt() &lt; fminUInt) || (v-&gt;GetUInt() &gt; fmaxUInt)) {</span>
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;Error! UInt value found in DCS map at %d-th entry is OUT OF RANGE: value = %u&quot;,i,v-&gt;GetUInt()));</span>
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    2993 </span>            :                 }
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :                 if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery())) {</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;%d-th entry = %d at timestamp %i&quot;,i,v-&gt;GetUInt(),v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :                         iCounts += 1;</span>
<span class="lineNum">    2997 </span>            :                         // look for the last value before SOR and the first value before EOR
<span class="lineNum">    2998 </span><span class="lineNoCov">          0 :                         if (((Int_t)(v-&gt;GetTimeStamp()) &gt;= (Int_t)GetStartTimeDCSQuery()) &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &lt; timeStart) {</span>
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :                                 timestampBeforeSOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of last entry before SOR = %d, with DAQ_time_start = %d&quot;,timestampBeforeSOR,timeStart));</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :                                 valueBeforeSOR = (Float_t)v-&gt;GetUInt();</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :                         else if ((Int_t)(v-&gt;GetTimeStamp()) &lt;= (Int_t)GetEndTimeDCSQuery() &amp;&amp; (Int_t)(v-&gt;GetTimeStamp()) &gt; timeEnd &amp;&amp; timestampAfterEOR == -1){</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :                                 timestampAfterEOR = (Int_t)(v-&gt;GetTimeStamp());</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :                                 valueAfterEOR = (Float_t)v-&gt;GetUInt();</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;timestamp of first entry after EOR = %d, with DAQ_time_end = %d&quot;,timestampAfterEOR,timeEnd));</span>
<span class="lineNum">    3007 </span>            :                         }
<span class="lineNum">    3008 </span>            :                         // check if there are DPs between DAQ_time_start and DAQ_time_end
<span class="lineNum">    3009 </span><span class="lineNoCov">          0 :                         if(((Int_t)(v-&gt;GetTimeStamp()) &gt;= timeStart) &amp;&amp;((Int_t)(v-&gt;GetTimeStamp()) &lt;= timeEnd)) {</span>
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :                                 if (ientrySOR == -1) ientrySOR = i;  // first entry after SOR</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :                                 if (ientryEOR &lt; i) ientryEOR = i;  // last entry before EOR</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">          0 :                                 AliDebug(2,Form(&quot;entry between SOR and EOR&quot;));</span>
<span class="lineNum">    3013 </span><span class="lineNoCov">          0 :                                 iCountsRun += 1;</span>
<span class="lineNum">    3014 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    3015 </span>            :                 }
<span class="lineNum">    3016 </span>            :                 else {
<span class="lineNum">    3017 </span><span class="lineNoCov">          0 :                         AliError(Form(&quot;DCS values for the parameter outside the queried interval: timestamp = %d&quot;,v-&gt;GetTimeStamp()));</span>
<span class="lineNum">    3018 </span>            :                 }
<span class="lineNum">    3019 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    3020 </span>            : 
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :         if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found before SOR!&quot;);</span>
<span class="lineNum">    3023 </span>            :         }
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :         if (timestampAfterEOR == -1){</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No value found after EOR!&quot;);</span>
<span class="lineNum">    3026 </span>            :         }
<span class="lineNum">    3027 </span>            : 
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Number of valid entries (within query interval) = %i, starting from %i entries&quot;,iCounts,nCounts));</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Last value before DAQ_time_start (SOR) = %f at timestamp = %d&quot;,valueBeforeSOR,timestampBeforeSOR));</span>
<span class="lineNum">    3030 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;First value after DAQ_time_end (EOR)   = %f at timestamp = %d&quot;,valueAfterEOR,timestampAfterEOR));</span>
<span class="lineNum">    3031 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;Found %d entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;,iCountsRun));</span>
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry after DAQ_time_start (SOR) = %d &quot;,ientrySOR));</span>
<span class="lineNum">    3033 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Index of first entry before DAQ_time_end (EOR) = %d &quot;,ientryEOR));</span>
<span class="lineNum">    3034 </span>            : 
<span class="lineNum">    3035 </span>            :         Int_t nentriesUsed = 0;
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :         if (iCountsRun &gt; 1){</span>
<span class="lineNum">    3037 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;Using entries between DAQ_time_start (SOR) and DAQ_time_end (EOR)&quot;);</span>
<span class="lineNum">    3038 </span><span class="lineNoCov">          0 :                 AliDebug(2,&quot;Calculating (weighted) Mean&quot;);</span>
<span class="lineNum">    3039 </span><span class="lineNoCov">          0 :                 arrayValues = new Float_t[iCountsRun]; </span>
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :                 arrayWeights = new Double_t[iCountsRun]; </span>
<span class="lineNum">    3041 </span>            :                 nentriesUsed = iCountsRun;
<span class="lineNum">    3042 </span><span class="lineNoCov">          0 :                 for (Int_t i = ientrySOR; i &lt;= ientryEOR; i++){</span>
<span class="lineNum">    3043 </span><span class="lineNoCov">          0 :                         AliDCSValue *v = (AliDCSValue *)array-&gt;At(i);</span>
<span class="lineNum">    3044 </span>            :                         Int_t timestamp2 = 0;
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :                         if (i &lt; ientryEOR){</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :                                 AliDCSValue *v1 = (AliDCSValue *)array-&gt;At(i+1);</span>
<span class="lineNum">    3047 </span><span class="lineNoCov">          0 :                                 timestamp2 = (Int_t)v1-&gt;GetTimeStamp();</span>
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    3049 </span>            :                         else {
<span class="lineNum">    3050 </span><span class="lineNoCov">          0 :                                 timestamp2 = timeEnd+1;</span>
<span class="lineNum">    3051 </span>            :                         }
<span class="lineNum">    3052 </span><span class="lineNoCov">          0 :                         arrayWeights[i-ientrySOR] = (Double_t)(timestamp2 - (Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    3053 </span><span class="lineNoCov">          0 :                         arrayValues[i-ientrySOR] = (Float_t)v-&gt;GetUInt();</span>
<span class="lineNum">    3054 </span>            :                 }
<span class="lineNum">    3055 </span><span class="lineNoCov">          0 :                 aDCSArrayMean = TMath::Mean(iCountsRun,arrayValues,arrayWeights);</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :                 delete [] arrayValues;</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">          0 :                 delete [] arrayWeights;</span>
<span class="lineNum">    3058 </span>            :         }
<span class="lineNum">    3059 </span><span class="lineNoCov">          0 :         else if (iCountsRun == 1){</span>
<span class="lineNum">    3060 </span><span class="lineNoCov">          0 :                 AliDCSValue* v = (AliDCSValue *)array-&gt;At(ientrySOR);</span>
<span class="lineNum">    3061 </span>            :                 nentriesUsed = 2;
<span class="lineNum">    3062 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR != -1 &amp;&amp; timestampBeforeSOR != (Int_t)v-&gt;GetTimeStamp()){</span>
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using single entry between DAQ_time_start (SOR) and DAQ_time_end (EOR) and last entry before SOR.&quot;);</span>
<span class="lineNum">    3064 </span><span class="lineNoCov">          0 :                         arrayValues = new Float_t[2];</span>
<span class="lineNum">    3065 </span><span class="lineNoCov">          0 :                         arrayWeights = new Double_t[2];</span>
<span class="lineNum">    3066 </span><span class="lineNoCov">          0 :                         arrayValues[0] = valueBeforeSOR;</span>
<span class="lineNum">    3067 </span><span class="lineNoCov">          0 :                         arrayWeights[0] = (Double_t)((Int_t)v-&gt;GetTimeStamp()-timestampBeforeSOR);</span>
<span class="lineNum">    3068 </span><span class="lineNoCov">          0 :                         arrayValues[1] = (Float_t)v-&gt;GetUInt();</span>
<span class="lineNum">    3069 </span><span class="lineNoCov">          0 :                         arrayWeights[1] = (Double_t)(timeEnd+1-(Int_t)v-&gt;GetTimeStamp());</span>
<span class="lineNum">    3070 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value0 = %f, with weight = %f&quot;,arrayValues[0],arrayWeights[0])); </span>
<span class="lineNum">    3071 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value1 = %f, with weight = %f&quot;,arrayValues[1],arrayWeights[1])); </span>
<span class="lineNum">    3072 </span><span class="lineNoCov">          0 :                         aDCSArrayMean = TMath::Mean(2,arrayValues,arrayWeights);</span>
<span class="lineNum">    3073 </span><span class="lineNoCov">          0 :                         delete [] arrayValues;</span>
<span class="lineNum">    3074 </span><span class="lineNoCov">          0 :                         delete [] arrayWeights;</span>
<span class="lineNum">    3075 </span>            :                 }
<span class="lineNum">    3076 </span>            :                 else{
<span class="lineNum">    3077 </span><span class="lineNoCov">          0 :                         AliError(&quot;Cannot calculate mean - only one value collected during the run, but no value before with which to calculate the statistical quantities&quot;);</span>
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    3079 </span>            :                 }
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    3081 </span>            :         else { // iCountsRun == 0, using the point immediately before SOR and the one immediately after EOR
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :                 if (timestampBeforeSOR == -1 || timestampAfterEOR == -1){</span>
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :                         if (timestampBeforeSOR == -1){</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :                                 AliError(&quot;Cannot calculate mean - no points during the run collected, and point before SOR missing&quot;);</span>
<span class="lineNum">    3085 </span>            :                         }
<span class="lineNum">    3086 </span><span class="lineNoCov">          0 :                         if (timestampAfterEOR == -1){</span>
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 :                                 AliError(&quot;Cannot calculate maen - no points during the run collected, and point after EOR missing&quot;);</span>
<span class="lineNum">    3088 </span>            :                         }
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :                         return AliGRPObject::GetInvalidFloat();</span>
<span class="lineNum">    3090 </span>            :                 }
<span class="lineNum">    3091 </span>            :                 else {
<span class="lineNum">    3092 </span><span class="lineNoCov">          0 :                         AliWarning(&quot;Using last entry before SOR and first entry after EOR.&quot;);</span>
<span class="lineNum">    3093 </span>            :                         nentriesUsed = 2;
<span class="lineNum">    3094 </span><span class="lineNoCov">          0 :                         arrayValues = new Float_t[2];</span>
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :                         arrayWeights = new Double_t[2];</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">          0 :                         arrayValues[0] = valueBeforeSOR;</span>
<span class="lineNum">    3097 </span><span class="lineNoCov">          0 :                         arrayWeights[0] = (Double_t)(timestampAfterEOR - timestampBeforeSOR);</span>
<span class="lineNum">    3098 </span><span class="lineNoCov">          0 :                         arrayValues[1] = valueAfterEOR;</span>
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :                         arrayWeights[1] = 1.;</span>
<span class="lineNum">    3100 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value0 = %f, with weight = %f&quot;,arrayValues[0],arrayWeights[0])); </span>
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :                         AliDebug(2,Form(&quot;value1 = %f, with weight = %f&quot;,arrayValues[1],arrayWeights[1])); </span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :                         aDCSArrayMean = TMath::Mean(1,arrayValues,arrayWeights);</span>
<span class="lineNum">    3103 </span><span class="lineNoCov">          0 :                         delete [] arrayValues;</span>
<span class="lineNum">    3104 </span><span class="lineNoCov">          0 :                         delete [] arrayWeights;</span>
<span class="lineNum">    3105 </span>            :                 }
<span class="lineNum">    3106 </span>            :         }
<span class="lineNum">    3107 </span>            : 
<span class="lineNum">    3108 </span><span class="lineNoCov">          0 :         AliDebug(2, Form(&quot;nentriesUsed = %d&quot;, nentriesUsed));</span>
<span class="lineNum">    3109 </span><span class="lineNoCov">          0 :         AliInfo(Form(&quot;mean = %f &quot;,aDCSArrayMean));</span>
<span class="lineNum">    3110 </span><span class="lineNoCov">          0 :         return aDCSArrayMean;</span>
<span class="lineNum">    3111 </span>            : 
<span class="lineNum">    3112 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3113 </span>            : 
<span class="lineNum">    3114 </span>            : 
<a name="3115"><span class="lineNum">    3115 </span>            : //_______________________________________________________________</a>
<span class="lineNum">    3116 </span>            : 
<span class="lineNum">    3117 </span>            : AliDCSSensorArray *AliGRPPreprocessor::GetPressureMap(TMap* dcsAliasMap)
<span class="lineNum">    3118 </span>            : {
<span class="lineNum">    3119 </span>            :         // extract DCS pressure maps. Perform fits to save space
<span class="lineNum">    3120 </span>            :         
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :         TMap *map = fPressure-&gt;ExtractDCS(dcsAliasMap);</span>
<span class="lineNum">    3122 </span><span class="lineNoCov">          0 :         if (map) {</span>
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :                 AliDebug(2,Form(&quot;Map has %d entries&quot;,map-&gt;GetEntries()));</span>
<span class="lineNum">    3124 </span><span class="lineNoCov">          0 :                 fPressure-&gt;MakeSplineFit(map);</span>
<span class="lineNum">    3125 </span><span class="lineNoCov">          0 :                 Double_t fitFraction = fPressure-&gt;NumFits()/fPressure-&gt;NumSensors(); </span>
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :                 if (fitFraction &gt; kFitFraction ) {</span>
<span class="lineNum">    3127 </span><span class="lineNoCov">          0 :                         AliInfo(Form(&quot;Pressure values extracted, %d fits performed for %d sensors.&quot;, fPressure-&gt;NumFits(),fPressure-&gt;NumSensors()));</span>
<span class="lineNum">    3128 </span><span class="lineNoCov">          0 :                 } else { </span>
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :                         AliInfo(&quot;Too few pressure maps fitted!!!&quot;);</span>
<span class="lineNum">    3130 </span>            :                 }
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :                 AliInfo(&quot;no atmospheric pressure map extracted!!!&quot;);</span>
<span class="lineNum">    3133 </span>            :         }
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :         delete map;</span>
<span class="lineNum">    3135 </span>            :         
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :         return fPressure;</span>
<span class="lineNum">    3137 </span>            : }
<span class="lineNum">    3138 </span>            : 
<span class="lineNum">    3139 </span>            : 
<a name="3140"><span class="lineNum">    3140 </span>            :   </a>
<span class="lineNum">    3141 </span>            : //_______________________________________________________________
<span class="lineNum">    3142 </span>            : Int_t AliGRPPreprocessor::ReceivePromptRecoParameters(UInt_t run, const char* dbHost, Int_t dbPort, const char* dbName, const char* user, const char* password, const char *cdbRoot, TString &amp;gdc)
<span class="lineNum">    3143 </span>            : {
<span class="lineNum">    3144 </span>            :         //
<span class="lineNum">    3145 </span>            :         // Retrieves logbook and trigger information from the online logbook
<span class="lineNum">    3146 </span>            :         // This information is needed for prompt reconstruction
<span class="lineNum">    3147 </span>            :         //
<span class="lineNum">    3148 </span>            :         // Parameters are:
<span class="lineNum">    3149 </span>            :         // Run number
<span class="lineNum">    3150 </span>            :         // DAQ params: dbHost, dbPort, dbName, user, password, logbookTable, triggerTable
<span class="lineNum">    3151 </span>            :         // cdbRoot
<span class="lineNum">    3152 </span>            :         //
<span class="lineNum">    3153 </span>            :         // returns:
<span class="lineNum">    3154 </span>            :         //         positive on success: the return code is the run number of last run processed of the same run type already processed by the SHUTTLE
<span class="lineNum">    3155 </span>            :         //         0 on success and no run was found
<span class="lineNum">    3156 </span>            :         //         negative on error
<span class="lineNum">    3157 </span>            :         //
<span class="lineNum">    3158 </span>            :         // This function is NOT called during the preprocessor run in the Shuttle!
<span class="lineNum">    3159 </span>            :         //
<span class="lineNum">    3160 </span>            :         
<span class="lineNum">    3161 </span>            :         // defaults
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :         if (dbPort == 0)</span>
<span class="lineNum">    3163 </span><span class="lineNoCov">          0 :                 dbPort = 3306;</span>
<span class="lineNum">    3164 </span>            :         
<span class="lineNum">    3165 </span>            :         // CDB connection
<span class="lineNum">    3166 </span><span class="lineNoCov">          0 :         AliCDBManager* cdb = AliCDBManager::Instance();</span>
<span class="lineNum">    3167 </span><span class="lineNoCov">          0 :         cdb-&gt;SetDefaultStorage(cdbRoot);</span>
<span class="lineNum">    3168 </span>            :         
<span class="lineNum">    3169 </span>            :         // SQL connection
<span class="lineNum">    3170 </span><span class="lineNoCov">          0 :         TSQLServer* server = TSQLServer::Connect(Form(&quot;mysql://%s:%d/%s&quot;, dbHost, dbPort, dbName), user, password);</span>
<span class="lineNum">    3171 </span>            :         
<span class="lineNum">    3172 </span><span class="lineNoCov">          0 :         if (!server)</span>
<span class="lineNum">    3173 </span>            :                 {
<span class="lineNum">    3174 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not connect to DAQ LB&quot;);</span>
<span class="lineNum">    3175 </span><span class="lineNoCov">          0 :                         return -1;</span>
<span class="lineNum">    3176 </span>            :                 }
<span class="lineNum">    3177 </span>            :         
<span class="lineNum">    3178 </span>            :         // main logbook
<span class="lineNum">    3179 </span><span class="lineNoCov">          0 :         TString sqlQuery;</span>
<span class="lineNum">    3180 </span><span class="lineNoCov">          0 :         sqlQuery.Form(&quot;SELECT DAQ_time_start, run_type, detectorMask, L3_magnetCurrent, Dipole_magnetCurrent,beamType, DAQ_time_end FROM logbook WHERE run = %d&quot;, run);</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :         TSQLResult* result = server-&gt;Query(sqlQuery);</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">          0 :         if (!result)</span>
<span class="lineNum">    3183 </span>            :                 {
<span class="lineNum">    3184 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Can't execute query &lt;%s&gt;!&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3185 </span><span class="lineNoCov">          0 :                         return -2;</span>
<span class="lineNum">    3186 </span>            :                 }
<span class="lineNum">    3187 </span>            :         
<span class="lineNum">    3188 </span><span class="lineNoCov">          0 :         if (result-&gt;GetRowCount() == 0)</span>
<span class="lineNum">    3189 </span>            :                 {
<span class="lineNum">    3190 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Run %d not found&quot;, run);</span>
<span class="lineNum">    3191 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3192 </span><span class="lineNoCov">          0 :                         return -3;</span>
<span class="lineNum">    3193 </span>            :                 }
<span class="lineNum">    3194 </span>            :         
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 :         TSQLRow* row = result-&gt;Next();</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :         if (!row)</span>
<span class="lineNum">    3197 </span>            :                 {
<span class="lineNum">    3198 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not receive data from run %d&quot;, run);</span>
<span class="lineNum">    3199 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3200 </span><span class="lineNoCov">          0 :                         return -4;</span>
<span class="lineNum">    3201 </span>            :                 }
<span class="lineNum">    3202 </span>            :         
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :         TString timeStartString(row-&gt;GetField(0));</span>
<span class="lineNum">    3204 </span><span class="lineNoCov">          0 :         TString runType(row-&gt;GetField(1));</span>
<span class="lineNum">    3205 </span><span class="lineNoCov">          0 :         TString detectorMaskString(row-&gt;GetField(2));</span>
<span class="lineNum">    3206 </span><span class="lineNoCov">          0 :         TString l3CurrentString(row-&gt;GetField(3));</span>
<span class="lineNum">    3207 </span><span class="lineNoCov">          0 :         TString dipoleCurrentString(row-&gt;GetField(4));</span>
<span class="lineNum">    3208 </span><span class="lineNoCov">          0 :         TString beamTypeString(row-&gt;GetField(5));</span>
<span class="lineNum">    3209 </span><span class="lineNoCov">          0 :         TString timeEndString(row-&gt;GetField(6));</span>
<span class="lineNum">    3210 </span>            : 
<span class="lineNum">    3211 </span><span class="lineNoCov">          0 :         time_t timeStart = (time_t)(timeStartString.Atoi());</span>
<span class="lineNum">    3212 </span><span class="lineNoCov">          0 :         time_t timeEnd   = (time_t)(timeEndString.Atoi());</span>
<span class="lineNum">    3213 </span><span class="lineNoCov">          0 :         UInt_t detectorMask = (UInt_t)(detectorMaskString.Atoi());</span>
<span class="lineNum">    3214 </span><span class="lineNoCov">          0 :         Float_t l3Current = (Float_t)(TMath::Abs(l3CurrentString.Atof()));</span>
<span class="lineNum">    3215 </span><span class="lineNoCov">          0 :         Float_t dipoleCurrent = (Float_t)(TMath::Abs(dipoleCurrentString.Atof()));</span>
<span class="lineNum">    3216 </span><span class="lineNoCov">          0 :         Char_t l3Polarity = (l3CurrentString.Atof() &lt; 0) ? 1 : 0;</span>
<span class="lineNum">    3217 </span><span class="lineNoCov">          0 :         Char_t dipolePolarity = (dipoleCurrentString.Atof() &lt; 0) ? 1 : 0;</span>
<span class="lineNum">    3218 </span><span class="lineNoCov">          0 :         if (beamTypeString.CompareTo(&quot;Pb-Pb&quot;,TString::kIgnoreCase) == 0){</span>
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :                 beamTypeString=&quot;A-A&quot;;</span>
<span class="lineNum">    3220 </span>            :         }
<span class="lineNum">    3221 </span>            :         
<span class="lineNum">    3222 </span><span class="lineNoCov">          0 :         AliGRPObject * grpObj = new AliGRPObject();</span>
<span class="lineNum">    3223 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetTimeStart(timeStart); </span>
<span class="lineNum">    3224 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetTimeEnd((timeEnd!=0 &amp;&amp; timeEnd&gt;timeStart) ? timeEnd : timeStart+24*3600 ); </span>
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetRunType((TString)(row-&gt;GetField(1)));</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetDetectorMask(detectorMask);</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetL3Current(l3Current,(AliGRPObject::Stats)0);</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetDipoleCurrent(dipoleCurrent,(AliGRPObject::Stats)0);</span>
<span class="lineNum">    3229 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetL3Polarity(l3Polarity);</span>
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetDipolePolarity(dipolePolarity);</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetPolarityConventionLHC();  // after the dipole cables swap we comply with LHC convention</span>
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :         grpObj-&gt;SetBeamType(beamTypeString);</span>
<span class="lineNum">    3233 </span>            : 
<span class="lineNum">    3234 </span><span class="lineNoCov">          0 :         delete row;</span>
<span class="lineNum">    3235 </span>            :         row = 0;
<span class="lineNum">    3236 </span>            :         
<span class="lineNum">    3237 </span><span class="lineNoCov">          0 :         delete result;</span>
<span class="lineNum">    3238 </span>            :         result = 0;
<span class="lineNum">    3239 </span>            :         
<span class="lineNum">    3240 </span><span class="lineNoCov">          0 :         Printf(&quot;Storing GRP/GRP/Data object with the following content&quot;);</span>
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :         grpObj-&gt;Dump();</span>
<span class="lineNum">    3242 </span>            :         
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :         AliCDBMetaData metadata;</span>
<span class="lineNum">    3244 </span><span class="lineNoCov">          0 :         metadata.SetResponsible(&quot;Jan Fiete Grosse-Oetringhaus &amp; Chiara Zampolli&quot;);</span>
<span class="lineNum">    3245 </span><span class="lineNoCov">          0 :         metadata.SetComment(&quot;GRP Output parameters received during online running&quot;);</span>
<span class="lineNum">    3246 </span>            :         
<span class="lineNum">    3247 </span><span class="lineNoCov">          0 :         AliCDBId id(&quot;GRP/GRP/Data&quot;, run, run);</span>
<span class="lineNum">    3248 </span><span class="lineNoCov">          0 :         Bool_t success = cdb-&gt;Put(grpObj, id, &amp;metadata);</span>
<span class="lineNum">    3249 </span>            :         
<span class="lineNum">    3250 </span><span class="lineNoCov">          0 :         delete grpObj;</span>
<span class="lineNum">    3251 </span>            :         
<span class="lineNum">    3252 </span><span class="lineNoCov">          0 :         if (!success)</span>
<span class="lineNum">    3253 </span>            :                 {
<span class="lineNum">    3254 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not store GRP/GRP/Data into OCDB&quot;);</span>
<span class="lineNum">    3255 </span><span class="lineNoCov">          0 :                         return -5;</span>
<span class="lineNum">    3256 </span>            :                 }
<span class="lineNum">    3257 </span>            :         
<span class="lineNum">    3258 </span>            :         // Receive trigger information
<span class="lineNum">    3259 </span><span class="lineNoCov">          0 :         sqlQuery.Form(&quot;SELECT configFile FROM logbook_trigger_config WHERE run = %d&quot;, run);</span>
<span class="lineNum">    3260 </span><span class="lineNoCov">          0 :         result = server-&gt;Query(sqlQuery);</span>
<span class="lineNum">    3261 </span><span class="lineNoCov">          0 :         if (!result)</span>
<span class="lineNum">    3262 </span>            :                 {
<span class="lineNum">    3263 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Can't execute query &lt;%s&gt;!&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3264 </span><span class="lineNoCov">          0 :                         return -11;</span>
<span class="lineNum">    3265 </span>            :                 }
<span class="lineNum">    3266 </span>            :         
<span class="lineNum">    3267 </span><span class="lineNoCov">          0 :         if (result-&gt;GetRowCount() == 0)</span>
<span class="lineNum">    3268 </span>            :                 {
<span class="lineNum">    3269 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Run %d not found in logbook_trigger_config&quot;, run);</span>
<span class="lineNum">    3270 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3271 </span><span class="lineNoCov">          0 :                         return -12;</span>
<span class="lineNum">    3272 </span>            :                 }
<span class="lineNum">    3273 </span>            :         
<span class="lineNum">    3274 </span><span class="lineNoCov">          0 :         row = result-&gt;Next();</span>
<span class="lineNum">    3275 </span><span class="lineNoCov">          0 :         if (!row)</span>
<span class="lineNum">    3276 </span>            :                 {
<span class="lineNum">    3277 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not receive logbook_trigger_config data from run %d&quot;, run);</span>
<span class="lineNum">    3278 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3279 </span><span class="lineNoCov">          0 :                         return -13;</span>
<span class="lineNum">    3280 </span>            :                 }
<span class="lineNum">    3281 </span>            :         
<span class="lineNum">    3282 </span><span class="lineNoCov">          0 :         TString triggerConfig(row-&gt;GetField(0));</span>
<span class="lineNum">    3283 </span>            :         
<span class="lineNum">    3284 </span><span class="lineNoCov">          0 :         delete row;</span>
<span class="lineNum">    3285 </span>            :         row = 0;
<span class="lineNum">    3286 </span>            :         
<span class="lineNum">    3287 </span><span class="lineNoCov">          0 :         delete result;</span>
<span class="lineNum">    3288 </span>            :         result = 0;
<span class="lineNum">    3289 </span>            :         
<span class="lineNum">    3290 </span><span class="lineNoCov">          0 :         Printf(&quot;Found trigger configuration: %s&quot;, triggerConfig.Data());</span>
<span class="lineNum">    3291 </span>            :         
<span class="lineNum">    3292 </span><span class="lineNoCov">          0 :         AliTriggerConfiguration *runcfg = AliTriggerConfiguration::LoadConfigurationFromString(triggerConfig);</span>
<span class="lineNum">    3293 </span><span class="lineNoCov">          0 :         if (!runcfg)</span>
<span class="lineNum">    3294 </span>            :                 {
<span class="lineNum">    3295 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not create CTP configuration object&quot;);</span>
<span class="lineNum">    3296 </span><span class="lineNoCov">          0 :                         return -14;</span>
<span class="lineNum">    3297 </span>            :                 }
<span class="lineNum">    3298 </span>            :         
<span class="lineNum">    3299 </span><span class="lineNoCov">          0 :         metadata.SetComment(&quot;CTP run configuration received during online running&quot;);</span>
<span class="lineNum">    3300 </span>            :         
<span class="lineNum">    3301 </span><span class="lineNoCov">          0 :         AliCDBId id2(&quot;GRP/CTP/Config&quot;, run, run);</span>
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :         success = cdb-&gt;Put(runcfg, id2, &amp;metadata);</span>
<span class="lineNum">    3303 </span>            :         
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :         delete runcfg;</span>
<span class="lineNum">    3305 </span>            :         runcfg = 0;
<span class="lineNum">    3306 </span>            :         
<span class="lineNum">    3307 </span><span class="lineNoCov">          0 :         if (!success)</span>
<span class="lineNum">    3308 </span>            :                 {
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not store GRP/CTP/Config into OCDB&quot;);</span>
<span class="lineNum">    3310 </span><span class="lineNoCov">          0 :                         return -15;</span>
<span class="lineNum">    3311 </span>            :                 }
<span class="lineNum">    3312 </span>            :         
<span class="lineNum">    3313 </span>            : 
<span class="lineNum">    3314 </span>            :         // Receive list of GDCs for this run
<span class="lineNum">    3315 </span><span class="lineNoCov">          0 :         sqlQuery.Form(&quot;SELECT GDC FROM logbook_stats_GDC WHERE run = %d&quot;, run);</span>
<span class="lineNum">    3316 </span><span class="lineNoCov">          0 :         result = server-&gt;Query(sqlQuery);</span>
<span class="lineNum">    3317 </span><span class="lineNoCov">          0 :         if (!result)</span>
<span class="lineNum">    3318 </span>            :                 {
<span class="lineNum">    3319 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Can't execute query &lt;%s&gt;!&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3320 </span><span class="lineNoCov">          0 :                         return -24;</span>
<span class="lineNum">    3321 </span>            :                 }
<span class="lineNum">    3322 </span>            :         
<span class="lineNum">    3323 </span><span class="lineNoCov">          0 :         if (result-&gt;GetRowCount() == 0)</span>
<span class="lineNum">    3324 </span>            :                 {
<span class="lineNum">    3325 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Run %d not found in logbook_stats_GDC&quot;, run);</span>
<span class="lineNum">    3326 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 :                         return -25;</span>
<span class="lineNum">    3328 </span>            :                 }
<span class="lineNum">    3329 </span>            : 
<span class="lineNum">    3330 </span><span class="lineNoCov">          0 :         gdc = &quot;&quot;;</span>
<span class="lineNum">    3331 </span><span class="lineNoCov">          0 :         for (Int_t iGDC = 0; iGDC &lt; result-&gt;GetRowCount(); iGDC++) {</span>
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :           row = result-&gt;Next();</span>
<span class="lineNum">    3333 </span><span class="lineNoCov">          0 :           if (!row)</span>
<span class="lineNum">    3334 </span>            :             {
<span class="lineNum">    3335 </span><span class="lineNoCov">          0 :               Printf(&quot;ERROR: Could not receive logbook_stats_GDC data from run %d&quot;, run);</span>
<span class="lineNum">    3336 </span><span class="lineNoCov">          0 :               delete result;</span>
<span class="lineNum">    3337 </span><span class="lineNoCov">          0 :               return -26;</span>
<span class="lineNum">    3338 </span>            :             }
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 :           gdc += row-&gt;GetField(0);</span>
<span class="lineNum">    3340 </span><span class="lineNoCov">          0 :           gdc += &quot; &quot;;</span>
<span class="lineNum">    3341 </span>            :         }
<span class="lineNum">    3342 </span>            : 
<span class="lineNum">    3343 </span><span class="lineNoCov">          0 :         delete row;</span>
<span class="lineNum">    3344 </span>            :         row = 0;
<span class="lineNum">    3345 </span>            :         
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :         delete result;</span>
<span class="lineNum">    3347 </span>            :         result = 0;
<span class="lineNum">    3348 </span>            :         
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 :         Printf(&quot;Found GDC: %s&quot;, gdc.Data());</span>
<span class="lineNum">    3350 </span>            : 
<span class="lineNum">    3351 </span>            :         // get last run with same run type that was already processed by the SHUTTLE
<span class="lineNum">    3352 </span>            :         
<span class="lineNum">    3353 </span><span class="lineNoCov">          0 :         sqlQuery.Form(&quot;SELECT max(logbook.run) FROM logbook LEFT JOIN logbook_shuttle ON logbook_shuttle.run = logbook.run WHERE run_type = '%s' AND shuttle_done = 1&quot;, runType.Data());</span>
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :         result = server-&gt;Query(sqlQuery);</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">          0 :         if (!result)</span>
<span class="lineNum">    3356 </span>            :                 {
<span class="lineNum">    3357 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Can't execute query &lt;%s&gt;!&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3358 </span><span class="lineNoCov">          0 :                         return -21;</span>
<span class="lineNum">    3359 </span>            :                 }
<span class="lineNum">    3360 </span>            :         
<span class="lineNum">    3361 </span><span class="lineNoCov">          0 :         if (result-&gt;GetRowCount() == 0)</span>
<span class="lineNum">    3362 </span>            :                 {
<span class="lineNum">    3363 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: No result with query &lt;%s&gt;&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3364 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3365 </span><span class="lineNoCov">          0 :                         return -22;</span>
<span class="lineNum">    3366 </span>            :                 }
<span class="lineNum">    3367 </span>            :         
<span class="lineNum">    3368 </span><span class="lineNoCov">          0 :         row = result-&gt;Next();</span>
<span class="lineNum">    3369 </span><span class="lineNoCov">          0 :         if (!row)</span>
<span class="lineNum">    3370 </span>            :                 {
<span class="lineNum">    3371 </span><span class="lineNoCov">          0 :                         Printf(&quot;ERROR: Could not receive data for query &lt;%s&gt;&quot;, sqlQuery.Data());</span>
<span class="lineNum">    3372 </span><span class="lineNoCov">          0 :                         delete result;</span>
<span class="lineNum">    3373 </span><span class="lineNoCov">          0 :                         return -23;</span>
<span class="lineNum">    3374 </span>            :                 }
<span class="lineNum">    3375 </span>            :         
<span class="lineNum">    3376 </span><span class="lineNoCov">          0 :         TString lastRunStr(row-&gt;GetField(0));</span>
<span class="lineNum">    3377 </span><span class="lineNoCov">          0 :         Int_t lastRun = lastRunStr.Atoi();</span>
<span class="lineNum">    3378 </span>            :         
<span class="lineNum">    3379 </span><span class="lineNoCov">          0 :         Printf(&quot;Last run with same run type %s is %d&quot;, runType.Data(), lastRun);</span>
<span class="lineNum">    3380 </span>            :         
<span class="lineNum">    3381 </span><span class="lineNoCov">          0 :         delete row;</span>
<span class="lineNum">    3382 </span>            :         row = 0;
<span class="lineNum">    3383 </span>            :         
<span class="lineNum">    3384 </span><span class="lineNoCov">          0 :         delete result;</span>
<span class="lineNum">    3385 </span>            :         result = 0;
<span class="lineNum">    3386 </span>            :         
<span class="lineNum">    3387 </span><span class="lineNoCov">          0 :         server-&gt;Close();</span>
<span class="lineNum">    3388 </span><span class="lineNoCov">          0 :         delete server;</span>
<span class="lineNum">    3389 </span>            :         server = 0;
<span class="lineNum">    3390 </span>            :         
<span class="lineNum">    3391 </span>            :         return lastRun;
<a name="3392"><span class="lineNum">    3392 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3393 </span>            : //------------------------------------------------------------------------------------------------------
<span class="lineNum">    3394 </span>            : Float_t AliGRPPreprocessor::ProcessEnergy(TObjArray* const array, Double_t timeStart){
<span class="lineNum">    3395 </span>            : 
<span class="lineNum">    3396 </span>            :         //
<span class="lineNum">    3397 </span>            :         // Method to processo LHC Energy information
<span class="lineNum">    3398 </span>            :         // Only the first value is returned, provided that it is withing DAQ_time_start and DAQ_time_end
<span class="lineNum">    3399 </span>            :         //
<span class="lineNum">    3400 </span>            : 
<span class="lineNum">    3401 </span><span class="lineNoCov">          0 :         Int_t nCounts = array-&gt;GetEntries();</span>
<span class="lineNum">    3402 </span>            :         Float_t energy = -1;
<span class="lineNum">    3403 </span>            :         Double_t timeEnergy = -1;
<span class="lineNum">    3404 </span>            :         Int_t indexEnergy = -1;
<span class="lineNum">    3405 </span>            :         Bool_t foundEnergy = kFALSE;
<span class="lineNum">    3406 </span>            : 
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 :         AliDebug(2,Form(&quot;Energy measurements = %d\n&quot;,nCounts));</span>
<span class="lineNum">    3408 </span><span class="lineNoCov">          0 :         if (nCounts ==0){</span>
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :                 AliWarning(&quot;No Energy values found! Beam Energy remaining invalid!&quot;);</span>
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    3411 </span>            :         else{
<span class="lineNum">    3412 </span><span class="lineNoCov">          0 :                 for (Int_t i = 0; i &lt; nCounts; i++){</span>
<span class="lineNum">    3413 </span><span class="lineNoCov">          0 :                         AliDCSArray *dcs = (AliDCSArray*)array-&gt;At(i);</span>
<span class="lineNum">    3414 </span><span class="lineNoCov">          0 :                         if (dcs){</span>
<span class="lineNum">    3415 </span><span class="lineNoCov">          0 :                                 if (dcs-&gt;GetTimeStamp()&lt;=timeStart &amp;&amp; dcs-&gt;GetTimeStamp()&gt;=timeEnergy){// taking always the very last entry: of two measurements have the same timestamp, the last one is taken</span>
<span class="lineNum">    3416 </span><span class="lineNoCov">          0 :                                         timeEnergy = dcs-&gt;GetTimeStamp();</span>
<span class="lineNum">    3417 </span>            :                                         indexEnergy = i;
<span class="lineNum">    3418 </span>            :                                         foundEnergy = kTRUE;
<span class="lineNum">    3419 </span>            :                                 }
<span class="lineNum">    3420 </span>            :                                 else{
<span class="lineNum">    3421 </span><span class="lineNoCov">          0 :                                         break;</span>
<span class="lineNum">    3422 </span>            :                                 }
<span class="lineNum">    3423 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    3424 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    3425 </span><span class="lineNoCov">          0 :                 if (!foundEnergy){</span>
<span class="lineNum">    3426 </span><span class="lineNoCov">          0 :                         AliInfo(&quot;No value for the Energy found before start of run, the Energy will remain invalid&quot;);</span>
<span class="lineNum">    3427 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    3428 </span>            :                 else {
<span class="lineNum">    3429 </span><span class="lineNoCov">          0 :                         AliDCSArray* dcs = (AliDCSArray*)array-&gt;At(indexEnergy);</span>
<span class="lineNum">    3430 </span><span class="lineNoCov">          0 :                         energy = (Float_t)(TMath::Nint(((Double_t)(dcs-&gt;GetInt(0)))*120/1000)); // sqrt(s)/2 energy in GeV</span>
<span class="lineNum">    3431 </span><span class="lineNoCov">          0 :                         AliInfo(Form(&quot;Energy value found = %d (at %f), converting --&gt; sqrt(s)/2 = %f (GeV)&quot;, dcs-&gt;GetInt(0),dcs-&gt;GetTimeStamp(),energy));</span>
<span class="lineNum">    3432 </span>            :                 }
<span class="lineNum">    3433 </span>            :         }
<span class="lineNum">    3434 </span>            : 
<span class="lineNum">    3435 </span><span class="lineNoCov">          0 :         return energy;</span>
<a name="3436"><span class="lineNum">    3436 </span>            : }</a>
<span class="lineNum">    3437 </span>            : //------------------------------------------------------------------------------------------------------
<span class="lineNum">    3438 </span>            : AliLHCClockPhase* AliGRPPreprocessor::ProcessLHCClockPhase(TObjArray *beam1phase,TObjArray *beam2phase, Double_t timeEnd)
<span class="lineNum">    3439 </span>            : {
<span class="lineNum">    3440 </span>            :   //
<span class="lineNum">    3441 </span>            :   // Method to process LHC-Clock Phase data
<span class="lineNum">    3442 </span>            :   // Only the values between DAQ_time_start and DAQ_time_end are kept
<span class="lineNum">    3443 </span>            :   //
<span class="lineNum">    3444 </span><span class="lineNoCov">          0 :   AliLHCClockPhase *phaseObj = new AliLHCClockPhase;</span>
<span class="lineNum">    3445 </span>            : 
<span class="lineNum">    3446 </span>            :   Bool_t foundBeam1Phase = kFALSE, foundBeam2Phase = kFALSE;
<span class="lineNum">    3447 </span>            :   const Float_t threshold = 0.050; // we store the measurement only in case they differ with more 50ps from the previous one 
<span class="lineNum">    3448 </span>            : 
<span class="lineNum">    3449 </span><span class="lineNoCov">          0 :   TString timeCreatedStr = GetRunParameter(&quot;time_created&quot;);</span>
<span class="lineNum">    3450 </span><span class="lineNoCov">          0 :   Double_t timeCreated = timeCreatedStr.Atof();</span>
<span class="lineNum">    3451 </span>            : 
<span class="lineNum">    3452 </span><span class="lineNoCov">          0 :   Int_t nCounts = beam1phase-&gt;GetEntries();</span>
<span class="lineNum">    3453 </span><span class="lineNoCov">          0 :   AliDebug(2,Form(&quot;Beam1 phase measurements = %d\n&quot;,nCounts));</span>
<span class="lineNum">    3454 </span><span class="lineNoCov">          0 :   if (nCounts ==0){</span>
<span class="lineNum">    3455 </span><span class="lineNoCov">          0 :     AliWarning(&quot;No beam1 LHC clock phase values found!&quot;);</span>
<span class="lineNum">    3456 </span><span class="lineNoCov">          0 :     delete phaseObj;</span>
<span class="lineNum">    3457 </span><span class="lineNoCov">          0 :     return NULL;</span>
<span class="lineNum">    3458 </span>            :   }
<span class="lineNum">    3459 </span>            :   else{
<span class="lineNum">    3460 </span>            :     Double_t prevPhase = 0;
<span class="lineNum">    3461 </span><span class="lineNoCov">          0 :     for (Int_t i = 0; i &lt; nCounts; i++){</span>
<span class="lineNum">    3462 </span><span class="lineNoCov">          0 :       AliDCSArray *dcs = (AliDCSArray*)beam1phase-&gt;At(i);</span>
<span class="lineNum">    3463 </span><span class="lineNoCov">          0 :       if (dcs){</span>
<span class="lineNum">    3464 </span>            :               //if (dcs-&gt;GetTimeStamp()&gt;=timeStart &amp;&amp; dcs-&gt;GetTimeStamp()&lt;=timeEnd) {
<span class="lineNum">    3465 </span><span class="lineNoCov">          0 :               if (dcs-&gt;GetTimeStamp()&gt;=timeCreated &amp;&amp; dcs-&gt;GetTimeStamp()&lt;=timeEnd) {</span>
<span class="lineNum">    3466 </span><span class="lineNoCov">          0 :           if ((i == 0) || (i == (nCounts-1)) ||</span>
<span class="lineNum">    3467 </span><span class="lineNoCov">          0 :               !foundBeam1Phase ||</span>
<span class="lineNum">    3468 </span><span class="lineNoCov">          0 :               (TMath::Abs(dcs-&gt;GetDouble(0)-prevPhase) &gt; threshold)) {</span>
<span class="lineNum">    3469 </span><span class="lineNoCov">          0 :             prevPhase = dcs-&gt;GetDouble(0);</span>
<span class="lineNum">    3470 </span>            :             foundBeam1Phase = kTRUE;
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :             AliInfo(Form(&quot;B1 Clk Phase = %f at TS = %f&quot;,</span>
<span class="lineNum">    3472 </span>            :                          (Float_t)dcs-&gt;GetDouble(0),dcs-&gt;GetTimeStamp()));  
<span class="lineNum">    3473 </span><span class="lineNoCov">          0 :             phaseObj-&gt;AddPhaseB1DP((UInt_t)dcs-&gt;GetTimeStamp(),(Float_t)dcs-&gt;GetDouble(0));</span>
<span class="lineNum">    3474 </span>            :           }
<span class="lineNum">    3475 </span>            :         }
<span class="lineNum">    3476 </span>            :       }
<span class="lineNum">    3477 </span>            :     }
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :     if (!foundBeam1Phase){</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :       AliError(&quot;No beam1 LHC clock phase values found within the run!&quot;);</span>
<span class="lineNum">    3480 </span><span class="lineNoCov">          0 :       delete phaseObj;</span>
<span class="lineNum">    3481 </span><span class="lineNoCov">          0 :       return NULL;</span>
<span class="lineNum">    3482 </span>            :     }
<span class="lineNum">    3483 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    3484 </span>            : 
<span class="lineNum">    3485 </span><span class="lineNoCov">          0 :   nCounts = beam2phase-&gt;GetEntries();</span>
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 :   AliDebug(2,Form(&quot;Beam2 phase measurements = %d\n&quot;,nCounts));</span>
<span class="lineNum">    3487 </span><span class="lineNoCov">          0 :   if (nCounts ==0){</span>
<span class="lineNum">    3488 </span><span class="lineNoCov">          0 :     AliWarning(&quot;No beam2 LHC clock phase values found!&quot;);</span>
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :     delete phaseObj;</span>
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :     return NULL;</span>
<span class="lineNum">    3491 </span>            :   }
<span class="lineNum">    3492 </span>            :   else{
<span class="lineNum">    3493 </span>            :     Double_t prevPhase = 0;
<span class="lineNum">    3494 </span><span class="lineNoCov">          0 :     for (Int_t i = 0; i &lt; nCounts; i++){</span>
<span class="lineNum">    3495 </span><span class="lineNoCov">          0 :       AliDCSArray *dcs = (AliDCSArray*)beam2phase-&gt;At(i);</span>
<span class="lineNum">    3496 </span><span class="lineNoCov">          0 :       if (dcs){</span>
<span class="lineNum">    3497 </span><span class="lineNoCov">          0 :         if (dcs-&gt;GetTimeStamp()&gt;=timeCreated &amp;&amp; dcs-&gt;GetTimeStamp()&lt;=timeEnd) {</span>
<span class="lineNum">    3498 </span><span class="lineNoCov">          0 :           if ((i == 0) || (i == (nCounts-1)) ||</span>
<span class="lineNum">    3499 </span><span class="lineNoCov">          0 :               !foundBeam2Phase ||</span>
<span class="lineNum">    3500 </span><span class="lineNoCov">          0 :               (TMath::Abs(dcs-&gt;GetDouble(0)-prevPhase) &gt; threshold)) {</span>
<span class="lineNum">    3501 </span><span class="lineNoCov">          0 :             prevPhase = dcs-&gt;GetDouble(0);</span>
<span class="lineNum">    3502 </span>            :             foundBeam2Phase = kTRUE;
<span class="lineNum">    3503 </span><span class="lineNoCov">          0 :             AliInfo(Form(&quot;B2 Clk Phase = %f at TS = %f&quot;,</span>
<span class="lineNum">    3504 </span>            :                          (Float_t)dcs-&gt;GetDouble(0),dcs-&gt;GetTimeStamp()));  
<span class="lineNum">    3505 </span><span class="lineNoCov">          0 :             phaseObj-&gt;AddPhaseB2DP((UInt_t)dcs-&gt;GetTimeStamp(),(Float_t)dcs-&gt;GetDouble(0));</span>
<span class="lineNum">    3506 </span>            :           }
<span class="lineNum">    3507 </span>            :         }
<span class="lineNum">    3508 </span>            :       }
<span class="lineNum">    3509 </span>            :     }
<span class="lineNum">    3510 </span><span class="lineNoCov">          0 :     if (!foundBeam2Phase){</span>
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :       AliError(&quot;No beam2 LHC clock phase values found within the run!&quot;);</span>
<span class="lineNum">    3512 </span><span class="lineNoCov">          0 :       delete phaseObj;</span>
<span class="lineNum">    3513 </span><span class="lineNoCov">          0 :       return NULL;</span>
<span class="lineNum">    3514 </span>            :     }
<span class="lineNum">    3515 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    3516 </span>            : 
<span class="lineNum">    3517 </span><span class="lineNoCov">          0 :   return phaseObj;</span>
<a name="3518"><span class="lineNum">    3518 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3519 </span>            : //------------------------------------------------------------------------------------------------------
<span class="lineNum">    3520 </span>            : TString AliGRPPreprocessor::ParseBeamTypeString(TString beamType, Int_t iBeamType)
<span class="lineNum">    3521 </span>            : {
<span class="lineNum">    3522 </span>            :         // Method to return the convention for the separate beam type
<span class="lineNum">    3523 </span>            :         // in the form A*1000+Z
<span class="lineNum">    3524 </span>            :         // e.g.: Pb82 --&gt; 208000 + 82 = 208082
<span class="lineNum">    3525 </span>            :         //       p --&gt; 1000 + 1 = 1001
<span class="lineNum">    3526 </span>            : 
<span class="lineNum">    3527 </span>            :         Int_t a = 0;
<span class="lineNum">    3528 </span>            :         Int_t z = 0;
<span class="lineNum">    3529 </span><span class="lineNoCov">          0 :         TString separateString(&quot;&quot;);</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :         Log(Form(&quot;Setting Beam Type for beam %d to A*1000+Z&quot;,iBeamType));</span>
<span class="lineNum">    3531 </span><span class="lineNoCov">          0 :         if (beamType.CompareTo(&quot;PROTON&quot;,TString::kIgnoreCase) == 0){</span>
<span class="lineNum">    3532 </span><span class="lineNoCov">          0 :                 Log(Form(&quot;Beam type %d is PROTON --&gt; The single beam type will be set to 1001 (A = 1, Z = 1)&quot;,iBeamType));</span>
<span class="lineNum">    3533 </span><span class="lineNoCov">          0 :                 separateString = &quot;1001&quot;;</span>
<span class="lineNum">    3534 </span><span class="lineNoCov">          0 :                 return separateString;</span>
<span class="lineNum">    3535 </span>            :         }
<span class="lineNum">    3536 </span>            :         else { 
<span class="lineNum">    3537 </span><span class="lineNoCov">          0 :                 TPRegexp regexpA(&quot;\\D+&quot;);</span>
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :                 TPRegexp regexpZ(&quot;\\d+&quot;);</span>
<span class="lineNum">    3539 </span><span class="lineNoCov">          0 :                 TObjArray* arrayA = regexpA.MatchS(beamType);</span>
<span class="lineNum">    3540 </span><span class="lineNoCov">          0 :                 TObjArray* arrayZ = regexpZ.MatchS(beamType);</span>
<span class="lineNum">    3541 </span><span class="lineNoCov">          0 :                 if (arrayA-&gt;GetEntries() != 1 || arrayZ-&gt;GetEntries() != 1){</span>
<span class="lineNum">    3542 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;The beamType string for beam %d does not contain the necessary information! Returning the info as published by LHC (i.e. %s)&quot;,iBeamType, beamType.Data()));</span>
<span class="lineNum">    3543 </span><span class="lineNoCov">          0 :                         return beamType;</span>
<span class="lineNum">    3544 </span>            :                 }
<span class="lineNum">    3545 </span>            :                 else{
<span class="lineNum">    3546 </span><span class="lineNoCov">          0 :                         TString strA = ((TObjString*)(arrayA-&gt;At(0)))-&gt;String();</span>
<span class="lineNum">    3547 </span><span class="lineNoCov">          0 :                         TString strZ = ((TObjString*)(arrayZ-&gt;At(0)))-&gt;String();</span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :                         if (strA.CompareTo(&quot;LEAD&quot;,TString::kIgnoreCase) == 0 || strA.CompareTo(&quot;PB&quot;,TString::kIgnoreCase) == 0){</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;Beam %d is %s --&gt; A = 208&quot;,iBeamType, strA.Data()));</span>
<span class="lineNum">    3550 </span>            :                                 a = 208;
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :                         }</span>
<span class="lineNum">    3552 </span>            :                         else{
<span class="lineNum">    3553 </span><span class="lineNoCov">          0 :                                 Log(Form(&quot;This beam was not foreseen so far, leaving A=0&quot;));</span>
<span class="lineNum">    3554 </span>            :                         }
<span class="lineNum">    3555 </span><span class="lineNoCov">          0 :                         z = strZ.Atoi();</span>
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 :                         Log(Form(&quot;Beam %d has Z = %d&quot;,iBeamType, z));</span>
<span class="lineNum">    3557 </span><span class="lineNoCov">          0 :                         separateString = Form(&quot;%d&quot;,a*1000+z);</span>
<span class="lineNum">    3558 </span><span class="lineNoCov">          0 :                         return separateString;</span>
<span class="lineNum">    3559 </span><span class="lineNoCov">          0 :                 }                                            </span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    3561 </span>            :                
<span class="lineNum">    3562 </span>            :         return separateString;
<span class="lineNum">    3563 </span>            : 
<span class="lineNum">    3564 </span><span class="lineNoCov">          0 : }</span>
<a name="3565"><span class="lineNum">    3565 </span>            :             </a>
<span class="lineNum">    3566 </span>            : //------------------------------------------------------------------------------------------------------
<span class="lineNum">    3567 </span>            : Bool_t AliGRPPreprocessor::CheckFileRecords(const char* fileName) const
<span class="lineNum">    3568 </span>            : {
<span class="lineNum">    3569 </span>            :     // Check file logical records as in TFile::Map()
<span class="lineNum">    3570 </span>            :     // returning false in case the position of the final record is bigger than the file size
<span class="lineNum">    3571 </span>            :     // It should allow to mark as bad all and only raw tag files which would crash the chaining
<span class="lineNum">    3572 </span>            :     // done in ProcessDaqFxs
<span class="lineNum">    3573 </span>            :     //
<span class="lineNum">    3574 </span><span class="lineNoCov">          0 :     TFile *f = TFile::Open(fileName);</span>
<span class="lineNum">    3575 </span><span class="lineNoCov">          0 :     if(!f){</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 :         Printf(&quot;could not open file \&quot;%s\&quot;&quot;,fileName);</span>
<span class="lineNum">    3577 </span><span class="lineNoCov">          0 :         return kFALSE;</span>
<span class="lineNum">    3578 </span>            :     }
<span class="lineNum">    3579 </span>            : 
<span class="lineNum">    3580 </span><span class="lineNoCov">          0 :     Short_t  keylen,cycle;</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">          0 :     UInt_t   datime;</span>
<span class="lineNum">    3582 </span><span class="lineNoCov">          0 :     Int_t    nbytes,date,time,objlen,nwheader;</span>
<span class="lineNum">    3583 </span><span class="lineNoCov">          0 :     date = 0;</span>
<span class="lineNum">    3584 </span><span class="lineNoCov">          0 :     time = 0;</span>
<span class="lineNum">    3585 </span><span class="lineNoCov">          0 :     Long64_t seekkey,seekpdir;</span>
<span class="lineNum">    3586 </span><span class="lineNoCov">          0 :     char    *buffer;</span>
<span class="lineNum">    3587 </span><span class="lineNoCov">          0 :     char     nwhc;</span>
<span class="lineNum">    3588 </span>            :     const Int_t kBEGIN = 100;
<span class="lineNum">    3589 </span>            :     Long64_t fBEGIN = (Long64_t)kBEGIN;    //First used word in file following the file header
<span class="lineNum">    3590 </span>            :     Long64_t idcur = fBEGIN;
<span class="lineNum">    3591 </span><span class="lineNoCov">          0 :     Long64_t fEND = f-&gt;GetEND();            //Last used byte in file</span>
<span class="lineNum">    3592 </span>            : 
<span class="lineNum">    3593 </span>            :     nwheader = 64;
<span class="lineNum">    3594 </span>            :     Int_t nread = nwheader;
<span class="lineNum">    3595 </span>            : 
<span class="lineNum">    3596 </span><span class="lineNoCov">          0 :     char header[kBEGIN];</span>
<span class="lineNum">    3597 </span><span class="lineNoCov">          0 :     char classname[512];</span>
<span class="lineNum">    3598 </span>            : 
<span class="lineNum">    3599 </span><span class="lineNoCov">          0 :     while (idcur &lt; fEND) {</span>
<span class="lineNum">    3600 </span><span class="lineNoCov">          0 :         f-&gt;Seek(idcur);</span>
<span class="lineNum">    3601 </span><span class="lineNoCov">          0 :         if (idcur+nread &gt;= fEND) nread = fEND-idcur-1;</span>
<span class="lineNum">    3602 </span><span class="lineNoCov">          0 :         if (f-&gt;ReadBuffer(header, nread)) {</span>
<span class="lineNum">    3603 </span>            :             // ReadBuffer returns kTRUE in case of failure.
<span class="lineNum">    3604 </span><span class="lineNoCov">          0 :             Printf(&quot;%s: failed to read the key data from disk at %lld.&quot;,f-&gt;GetName(),idcur);</span>
<span class="lineNum">    3605 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    3606 </span>            :         }
<span class="lineNum">    3607 </span>            : 
<span class="lineNum">    3608 </span><span class="lineNoCov">          0 :         buffer=header;</span>
<span class="lineNum">    3609 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;nbytes);</span>
<span class="lineNum">    3610 </span><span class="lineNoCov">          0 :         if (!nbytes) {</span>
<span class="lineNum">    3611 </span><span class="lineNoCov">          0 :             Printf(&quot;Address = %lld\tNbytes = %d\t=====E R R O R=======&quot;, idcur, nbytes);</span>
<span class="lineNum">    3612 </span><span class="lineNoCov">          0 :             date = 0; time = 0;</span>
<span class="lineNum">    3613 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    3614 </span>            :         }
<span class="lineNum">    3615 </span><span class="lineNoCov">          0 :         if (nbytes &lt; 0) {</span>
<span class="lineNum">    3616 </span><span class="lineNoCov">          0 :             Printf(&quot;Address = %lld\tNbytes = %d\t=====G A P===========&quot;, idcur, nbytes);</span>
<span class="lineNum">    3617 </span><span class="lineNoCov">          0 :             idcur -= nbytes;</span>
<span class="lineNum">    3618 </span><span class="lineNoCov">          0 :             f-&gt;Seek(idcur);</span>
<span class="lineNum">    3619 </span><span class="lineNoCov">          0 :             continue;</span>
<span class="lineNum">    3620 </span>            :             //return kFALSE; // these gaps are not always critical
<span class="lineNum">    3621 </span>            :         }
<span class="lineNum">    3622 </span><span class="lineNoCov">          0 :         Version_t versionkey;</span>
<span class="lineNum">    3623 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;versionkey);</span>
<span class="lineNum">    3624 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;objlen);</span>
<span class="lineNum">    3625 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;datime);</span>
<span class="lineNum">    3626 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;keylen);</span>
<span class="lineNum">    3627 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;cycle);</span>
<span class="lineNum">    3628 </span><span class="lineNoCov">          0 :         if (versionkey &gt; 1000) {</span>
<span class="lineNum">    3629 </span><span class="lineNoCov">          0 :             frombuf(buffer, &amp;seekkey);</span>
<span class="lineNum">    3630 </span><span class="lineNoCov">          0 :             frombuf(buffer, &amp;seekpdir);</span>
<span class="lineNum">    3631 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">    3632 </span><span class="lineNoCov">          0 :             Int_t skey,sdir;</span>
<span class="lineNum">    3633 </span><span class="lineNoCov">          0 :             frombuf(buffer, &amp;skey);  seekkey  = (Long64_t)skey;</span>
<span class="lineNum">    3634 </span><span class="lineNoCov">          0 :             frombuf(buffer, &amp;sdir);  seekpdir = (Long64_t)sdir;</span>
<span class="lineNum">    3635 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">    3636 </span><span class="lineNoCov">          0 :         frombuf(buffer, &amp;nwhc);</span>
<span class="lineNum">    3637 </span><span class="lineNoCov">          0 :         for (int i = 0;i &lt; nwhc; i++) frombuf(buffer, &amp;classname[i]);</span>
<span class="lineNum">    3638 </span><span class="lineNoCov">          0 :         classname[(int)nwhc] = '\0'; //cast to avoid warning with gcc3.4</span>
<span class="lineNum">    3639 </span><span class="lineNoCov">          0 :         Long64_t fSeekFree = f-&gt;GetSeekFree();</span>
<span class="lineNum">    3640 </span><span class="lineNoCov">          0 :         Long64_t fSeekInfo = f-&gt;GetSeekInfo();</span>
<span class="lineNum">    3641 </span><span class="lineNoCov">          0 :         Long64_t fSeekKeys = f-&gt;GetSeekKeys();</span>
<span class="lineNum">    3642 </span><span class="lineNoCov">          0 :         if (idcur == fSeekFree) strlcpy(classname,&quot;FreeSegments&quot;,512);</span>
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :         if (idcur == fSeekInfo) strlcpy(classname,&quot;StreamerInfo&quot;,512);</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">          0 :         if (idcur == fSeekKeys) strlcpy(classname,&quot;KeysList&quot;,512);</span>
<span class="lineNum">    3645 </span><span class="lineNoCov">          0 :         TDatime::GetDateTime(datime, date, time);</span>
<span class="lineNum">    3646 </span>            :         /*
<span class="lineNum">    3647 </span>            :         if (objlen != nbytes-keylen) {
<span class="lineNum">    3648 </span>            :             Float_t cx = Float_t(objlen+keylen)/Float_t(nbytes);
<span class="lineNum">    3649 </span>            :             Printf(&quot;%d/%06d  At:%lld  N=%-8d  %-14s CX = %5.2f&quot;,date,time,idcur,nbytes,classname,cx);
<span class="lineNum">    3650 </span>            :         } else {
<span class="lineNum">    3651 </span>            :             Printf(&quot;%d/%06d  At:%lld  N=%-8d  %-14s&quot;,date,time,idcur,nbytes,classname);
<span class="lineNum">    3652 </span>            :         }
<span class="lineNum">    3653 </span>            :         */
<span class="lineNum">    3654 </span><span class="lineNoCov">          0 :         idcur += nbytes;</span>
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">    3656 </span>            :     //Printf(&quot;%d/%06d  At:%lld  N=%-8d  %-14s&quot;,date,time,idcur,1,&quot;END&quot;);
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :     if(idcur &gt; f-&gt;GetSize()){</span>
<span class="lineNum">    3658 </span><span class="lineNoCov">          0 :         AliWarning(&quot;Bad file: final record position bigger than file size&quot;);</span>
<span class="lineNum">    3659 </span><span class="lineNoCov">          0 :         return kFALSE;</span>
<span class="lineNum">    3660 </span>            :     }
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :     return kTRUE;</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    3663 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
