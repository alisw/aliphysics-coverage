<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - TOF/TOFrec/AliTOFT0maker.cxx</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">TOF/TOFrec</a> - AliTOFT0maker.cxx<span style="font-size: 80%;"> (source / <a href="AliTOFT0maker.cxx.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">148</td>
            <td class="headerCovTableEntry">291</td>
            <td class="headerCovTableEntryLo">50.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-14 17:26:59</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">7</td>
            <td class="headerCovTableEntry">17</td>
            <td class="headerCovTableEntryLo">41.2 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /**************************************************************************</a>
<span class="lineNum">       2 </span>            :  * Copyright(c) 1998-1999, ALICE Experiment at CERN, All rights reserved. *
<span class="lineNum">       3 </span>            :  *                                                                        *
<span class="lineNum">       4 </span>            :  * Author: The ALICE Off-line Project.                                    *
<span class="lineNum">       5 </span>            :  * Contributors are mentioned in the code where appropriate.              *
<span class="lineNum">       6 </span>            :  *                                                                        *
<span class="lineNum">       7 </span>            :  * Permission to use, copy, modify and distribute this software and its   *
<span class="lineNum">       8 </span>            :  * documentation strictly for non-commercial purposes is hereby granted   *
<span class="lineNum">       9 </span>            :  * without fee, provided that the above copyright notice appears in all   *
<span class="lineNum">      10 </span>            :  * copies and that both the copyright notice and this permission notice   *
<span class="lineNum">      11 </span>            :  * appear in the supporting documentation. The authors make no claims     *
<span class="lineNum">      12 </span>            :  * about the suitability of this software for any purpose. It is          *
<span class="lineNum">      13 </span>            :  * provided &quot;as is&quot; without express or implied warranty.                  *
<span class="lineNum">      14 </span>            :  **************************************************************************/
<span class="lineNum">      15 </span>            : /* $Id: AliTOFT0maker.cxx,v 1.8 2010/01/19 16:32:20 noferini Exp $ */
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : /////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      18 </span>            : //                                                                         //
<span class="lineNum">      19 </span>            : //  This class contains the basic functions for the time zero              //
<span class="lineNum">      20 </span>            : //  evaluation with TOF detector informations.                             //
<span class="lineNum">      21 </span>            : // Use case in an analysis task:                                           //
<span class="lineNum">      22 </span>            : //                                                                         //
<span class="lineNum">      23 </span>            : // Create the object in the task constructor (fTOFmaker is a private var)  //
<span class="lineNum">      24 </span>            : // AliESDpid *extPID=new AliESDpid();                                      //
<span class="lineNum">      25 </span>            : // fTOFmaker = new AliTOFT0maker(extPID);                                  //
<span class="lineNum">      26 </span>            : // fTOFmaker-&gt;SetTimeResolution(100.0); // if you want set the TOF res     //
<span class="lineNum">      27 </span>            : // 115 ps is the TOF default resolution value                              //
<span class="lineNum">      28 </span>            : //                                                                         //
<span class="lineNum">      29 </span>            : // Use the RemakePID method in the task::Exec                              //
<span class="lineNum">      30 </span>            : // Double_t* calcolot0;                                                    //
<span class="lineNum">      31 </span>            : // calcolot0=fTOFmaker-&gt;RemakePID(fESD);                                   //
<span class="lineNum">      32 </span>            : // //calcolot0[0] = calculated event time                                  // 
<span class="lineNum">      33 </span>            : // //calcolot0[1] = event time time resolution                             //
<span class="lineNum">      34 </span>            : // //calcolot0[2] = average event time for the current fill                //
<span class="lineNum">      35 </span>            : // //calcolot0[3] = tracks at TOF                                          // 
<span class="lineNum">      36 </span>            : // //calcolot0[4] = calculated event time (only TOF)                       //
<span class="lineNum">      37 </span>            : // //calcolot0[5] = event time time resolution (only TOF)                  //
<span class="lineNum">      38 </span>            : // //calcolot0[6] = sigma t0 fill                                          //
<span class="lineNum">      39 </span>            : // //calcolot0[7] = tracks at TOF really used in tht algorithm             // 
<span class="lineNum">      40 </span>            : //                                                                         //
<span class="lineNum">      41 </span>            : // Let consider that:                                                      //
<span class="lineNum">      42 </span>            : // - the PIF is automatically recalculated with the event time subtrction  //
<span class="lineNum">      43 </span>            : //                                                                         //
<span class="lineNum">      44 </span>            : /////////////////////////////////////////////////////////////////////////////
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : #include &quot;AliTOFT0v1.h&quot;
<span class="lineNum">      47 </span>            : #include &quot;AliTOFT0maker.h&quot;
<span class="lineNum">      48 </span>            : #include &quot;AliPID.h&quot;
<span class="lineNum">      49 </span>            : #include &quot;AliLog.h&quot;
<span class="lineNum">      50 </span>            : #include &quot;AliESDpid.h&quot;
<span class="lineNum">      51 </span>            : #include &quot;AliESDEvent.h&quot;
<span class="lineNum">      52 </span>            : #include &quot;TFile.h&quot;
<span class="lineNum">      53 </span>            : #include &quot;TH1F.h&quot;
<span class="lineNum">      54 </span>            : #include &quot;AliTOFcalib.h&quot;
<span class="lineNum">      55 </span>            : #include &quot;AliTOFRunParams.h&quot;
<span class="lineNum">      56 </span>            : #include &quot;TRandom.h&quot;
<a name="57"><span class="lineNum">      57 </span>            : #include &quot;AliTOFHeader.h&quot;</a>
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span><span class="lineCov">         26 : ClassImp(AliTOFT0maker)</span>
<a name="60"><span class="lineNum">      60 </span>            :            </a>
<span class="lineNum">      61 </span>            : //____________________________________________________________________________ 
<span class="lineNum">      62 </span>            : AliTOFT0maker::AliTOFT0maker():
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :   TObject(),</span>
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :   fT0TOF(NULL),</span>
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :   fPIDesd(NULL),</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :   fExternalPIDFlag(kFALSE),</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   fTOFcalib(NULL),</span>
<span class="lineNum">      68 </span><span class="lineNoCov">          0 :   fNoTOFT0(0),</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   fNmomBins(0),</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   fTimeResolution(100),</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :   fT0sigma(1000),</span>
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   fHmapChannel(0),</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :   fKmask(0),</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :   fT0width(150.),</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   fT0spreadExt(-1.),</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   fT0fillExt(0),</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   fTOFT0algorithm(1)</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      79 </span>            :   // ctr
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :   fCalculated[0] = 0;</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   fCalculated[1] = 0;</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :   fCalculated[2] = 0;</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :   fCalculated[3] = 0;</span>
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :   fT0cur[0]=0.;</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :   fT0cur[1]=0.;</span>
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span><span class="lineNoCov">          0 :   if(AliPID::ParticleMass(0) == 0) new AliPID();</span>
<span class="lineNum">      89 </span>            : 
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :   fPIDesd = new AliESDpid();</span>
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :   fNmomBins = fPIDesd-&gt;GetTOFResponse().GetNmomBins();</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :   SetTOFResponse();</span>
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :   fT0TOF = new AliTOFT0v1(fPIDesd);</span>
<span class="lineNum">      96 </span>            : 
<a name="97"><span class="lineNum">      97 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      98 </span>            : //____________________________________________________________________________ 
<span class="lineNum">      99 </span>            : AliTOFT0maker::AliTOFT0maker(AliESDpid *externalPID, AliTOFcalib *tofCalib):
<span class="lineNum">     100 </span><span class="lineCov">          8 :     TObject(),</span>
<span class="lineNum">     101 </span><span class="lineCov">          8 :     fT0TOF(NULL),</span>
<span class="lineNum">     102 </span><span class="lineCov">          8 :     fPIDesd(externalPID),</span>
<span class="lineNum">     103 </span><span class="lineCov">          8 :     fExternalPIDFlag(kTRUE),</span>
<span class="lineNum">     104 </span><span class="lineCov">          8 :     fTOFcalib(tofCalib),</span>
<span class="lineNum">     105 </span><span class="lineCov">          8 :     fNoTOFT0(0),</span>
<span class="lineNum">     106 </span><span class="lineCov">          8 :     fNmomBins(0),</span>
<span class="lineNum">     107 </span><span class="lineCov">          8 :     fTimeResolution(100),</span>
<span class="lineNum">     108 </span><span class="lineCov">          8 :     fT0sigma(1000),</span>
<span class="lineNum">     109 </span><span class="lineCov">          8 :     fHmapChannel(0),</span>
<span class="lineNum">     110 </span><span class="lineCov">          8 :     fKmask(0),</span>
<span class="lineNum">     111 </span><span class="lineCov">          8 :     fT0width(150.),</span>
<span class="lineNum">     112 </span><span class="lineCov">          8 :     fT0spreadExt(-1.),</span>
<span class="lineNum">     113 </span><span class="lineCov">          8 :     fT0fillExt(0),</span>
<span class="lineNum">     114 </span><span class="lineCov">          8 :     fTOFT0algorithm(1)</span>
<span class="lineNum">     115 </span><span class="lineCov">         40 : {</span>
<span class="lineNum">     116 </span>            :   // ctr
<span class="lineNum">     117 </span><span class="lineCov">          8 :   fCalculated[0] = 0;</span>
<span class="lineNum">     118 </span><span class="lineCov">          8 :   fCalculated[1] = 0;</span>
<span class="lineNum">     119 </span><span class="lineCov">          8 :   fCalculated[2] = 0;</span>
<span class="lineNum">     120 </span><span class="lineCov">          8 :   fCalculated[3] = 0;</span>
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span><span class="lineCov">          8 :   fT0cur[0]=0.;</span>
<span class="lineNum">     123 </span><span class="lineCov">          8 :   fT0cur[1]=0.;</span>
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span><span class="lineCov">         16 :   if(AliPID::ParticleMass(0) == 0) new AliPID();</span>
<span class="lineNum">     126 </span>            : 
<span class="lineNum">     127 </span><span class="lineCov">          8 :   if(!fPIDesd){</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :     fPIDesd = new AliESDpid();</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :     SetTOFResponse();</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :     fExternalPIDFlag = kFALSE;</span>
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     132 </span>            : 
<span class="lineNum">     133 </span><span class="lineCov">          8 :   fNmomBins = fPIDesd-&gt;GetTOFResponse().GetNmomBins();</span>
<span class="lineNum">     134 </span><span class="lineCov">          8 :   fTimeResolution = externalPID-&gt;GetTOFResponse().GetTimeResolution();</span>
<span class="lineNum">     135 </span>            : 
<span class="lineNum">     136 </span><span class="lineCov">         24 :   fT0TOF = new AliTOFT0v1(fPIDesd);</span>
<span class="lineNum">     137 </span>            : 
<span class="lineNum">     138 </span><span class="lineCov">         16 : }</span>
<a name="139"><span class="lineNum">     139 </span>            : </a>
<span class="lineNum">     140 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     141 </span>            : AliTOFT0maker::~AliTOFT0maker()
<span class="lineNum">     142 </span><span class="lineCov">         32 : {</span>
<span class="lineNum">     143 </span>            :   // dtor
<span class="lineNum">     144 </span><span class="lineCov">         16 :   delete fT0TOF;</span>
<span class="lineNum">     145 </span><span class="lineCov">          8 :   if (!fExternalPIDFlag) delete fPIDesd;</span>
<a name="146"><span class="lineNum">     146 </span><span class="lineCov">         16 : }</span></a>
<span class="lineNum">     147 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     148 </span>            : Double_t* AliTOFT0maker::ComputeT0TOF(AliESDEvent *esd,Double_t t0time,Double_t t0sigma){
<span class="lineNum">     149 </span>            :   //
<span class="lineNum">     150 </span>            :   // Remake TOF PID probabilities
<span class="lineNum">     151 </span>            :   //
<span class="lineNum">     152 </span>            :   Double_t t0tof[6];
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span><span class="lineCov">         16 :   if(fKmask) ApplyMask(esd);</span>
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span>            :   Double_t t0fill = 0.;
<span class="lineNum">     157 </span>            : 
<span class="lineNum">     158 </span><span class="lineCov">          8 :   fPIDesd-&gt;GetTOFResponse().ResetT0info();</span>
<span class="lineNum">     159 </span>            : 
<span class="lineNum">     160 </span>            :   /* get T0 spread from TOFcalib if available otherwise use default value */
<span class="lineNum">     161 </span><span class="lineCov">          8 :   if (fTOFcalib &amp;&amp; esd) {</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :     AliTOFRunParams *runParams = fTOFcalib-&gt;GetRunParams();</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :     if (runParams &amp;&amp; runParams-&gt;GetTimestamp(0) != 0) {</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :       Float_t t0spread = runParams-&gt;EvalT0Spread(esd-&gt;GetTimeStamp());</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :       if(fT0spreadExt &gt; 0) SetT0FillWidth(fT0spreadExt);</span>
<span class="lineNum">     166 </span>            :       else{
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :         SetT0FillWidth(t0spread);</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :         t0fill = fT0fillExt;</span>
<span class="lineNum">     169 </span>            :       }
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     171 </span>            :     else{
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :       if(fT0spreadExt &gt; 0) SetT0FillWidth(fT0spreadExt);</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :       t0fill = fT0fillExt;</span>
<span class="lineNum">     174 </span>            :     }
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     176 </span><span class="lineCov">          8 :   else if(esd){</span>
<span class="lineNum">     177 </span><span class="lineCov">          8 :       Float_t t0spread = esd-&gt;GetSigma2DiamondZ(); // vertex pread ^2</span>
<span class="lineNum">     178 </span><span class="lineCov">         16 :       if(t0spread &gt; 0) t0spread = TMath::Sqrt(t0spread)/0.0299792458;</span>
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineCov">          8 :       if(fT0spreadExt &gt; 0) SetT0FillWidth(fT0spreadExt);</span>
<span class="lineNum">     181 </span>            :       else{
<span class="lineNum">     182 </span><span class="lineCov">          8 :           SetT0FillWidth(t0spread);</span>
<span class="lineNum">     183 </span><span class="lineCov">          8 :           t0fill = fT0fillExt;</span>
<span class="lineNum">     184 </span>            :       }
<span class="lineNum">     185 </span><span class="lineCov">          8 :   }</span>
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span><span class="lineCov">          8 :   Float_t thrGood = TMath::Max(Float_t(500.),fT0width*3);</span>
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span><span class="lineCov">          8 :   fT0TOF-&gt;Init(esd);</span>
<span class="lineNum">     191 </span><span class="lineCov">          8 :   AliTOFT0v1* t0maker = fT0TOF;</span>
<span class="lineNum">     192 </span><span class="lineCov">          8 :   if (fTOFT0algorithm==2) t0maker-&gt;SetOptimization(kTRUE);</span>
<span class="lineNum">     193 </span><span class="lineCov">          8 :   t0maker-&gt;DefineT0(&quot;all&quot;,1.5,3.0);</span>
<span class="lineNum">     194 </span><span class="lineCov">          8 :   t0tof[0] = t0maker-&gt;GetResult(0);</span>
<span class="lineNum">     195 </span><span class="lineCov">          8 :   t0tof[1] = t0maker-&gt;GetResult(1);</span>
<span class="lineNum">     196 </span><span class="lineCov">          8 :   t0tof[2] = t0maker-&gt;GetResult(2);</span>
<span class="lineNum">     197 </span><span class="lineCov">          8 :   t0tof[3] = t0maker-&gt;GetResult(3);</span>
<span class="lineNum">     198 </span><span class="lineCov">          8 :   t0tof[4] = t0maker-&gt;GetResult(4);</span>
<span class="lineNum">     199 </span><span class="lineCov">          8 :   t0tof[5] = t0maker-&gt;GetResult(5);</span>
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            :   Float_t lT0Current=0.;
<span class="lineNum">     202 </span><span class="lineCov">          8 :   fT0sigma=1000;</span>
<span class="lineNum">     203 </span>            : 
<span class="lineNum">     204 </span>            : //   Int_t nrun = esd-&gt;GetRunNumber();
<span class="lineNum">     205 </span>            : 
<span class="lineNum">     206 </span><span class="lineCov">          8 :   t0time += t0fill;</span>
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span><span class="lineCov">          8 :   Float_t sigmaFill = fT0width;</span>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineCov">          8 :   if(sigmaFill &lt; 20) sigmaFill = 140;</span>
<span class="lineNum">     211 </span>            : 
<span class="lineNum">     212 </span><span class="lineCov">          8 :   fCalculated[0]=-1000*t0tof[0]; // best t0</span>
<span class="lineNum">     213 </span><span class="lineCov">          8 :   fCalculated[1]=1000*t0tof[1]; // sigma best t0</span>
<span class="lineNum">     214 </span><span class="lineCov">          8 :   fCalculated[2] = t0fill;    //t0 fill</span>
<span class="lineNum">     215 </span><span class="lineCov">          8 :   fCalculated[3] = t0tof[2];  // n TOF tracks</span>
<span class="lineNum">     216 </span><span class="lineCov">          8 :   fCalculated[4]=-1000*t0tof[0]; // TOF t0</span>
<span class="lineNum">     217 </span><span class="lineCov">          8 :   fCalculated[5]=1000*t0tof[1]; // TOF t0 sigma</span>
<span class="lineNum">     218 </span><span class="lineCov">          8 :   fCalculated[6]=sigmaFill; // sigma t0 fill</span>
<span class="lineNum">     219 </span><span class="lineCov">          8 :   fCalculated[7] = t0tof[3];  // n TOF tracks used for T0</span>
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span><span class="lineCov">          8 :   if(fCalculated[7] &gt; 30) thrGood = 10000000;</span>
<span class="lineNum">     222 </span>            : 
<span class="lineNum">     223 </span>            :   //statistics
<span class="lineNum">     224 </span><span class="lineCov">          8 :   fCalculated[8] = t0tof[4]; // real time in s</span>
<span class="lineNum">     225 </span><span class="lineCov">          8 :   fCalculated[9] = t0tof[5]; // cpu time in s</span>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineCov">         24 :   if(fCalculated[1] &lt; sigmaFill &amp;&amp; TMath::Abs(fCalculated[0] - t0fill) &lt; thrGood &amp;&amp; fCalculated[1] &lt; fTimeResolution*1.41){</span>
<span class="lineNum">     228 </span><span class="lineCov">          8 :     fT0sigma=fCalculated[1];</span>
<span class="lineNum">     229 </span><span class="lineCov">          8 :     lT0Current=fCalculated[0];</span>
<span class="lineNum">     230 </span><span class="lineCov">          8 :   }</span>
<span class="lineNum">     231 </span>            :   else{
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :     fCalculated[4] = t0fill;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :     fCalculated[5] = sigmaFill;</span>
<span class="lineNum">     234 </span>            :   }
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span><span class="lineCov">         24 :   if(fCalculated[1] &lt; 1 || fT0sigma &gt; sigmaFill || fCalculated[1] &gt; fTimeResolution* 1.41){</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :     fT0sigma =1000;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :     fCalculated[4] = t0fill;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :     fCalculated[5] = sigmaFill;</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span><span class="lineCov">          8 :   if(t0sigma &lt; 1000){</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :     if(fT0sigma &lt; 1000){</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :       Double_t w1 = 1./t0sigma/t0sigma;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :       Double_t w2 = 1./fCalculated[1]/fCalculated[1];</span>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :       Double_t wtot = w1+w2;</span>
<span class="lineNum">     248 </span>            : 
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :       lT0Current = (w1*t0time + w2*fCalculated[0]) / wtot;</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :       fT0sigma = TMath::Sqrt(1./wtot);</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     252 </span>            :     else{
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       lT0Current=t0time;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :       fT0sigma=t0sigma;</span>
<span class="lineNum">     255 </span>            :     }
<span class="lineNum">     256 </span>            :   }
<span class="lineNum">     257 </span>            : 
<span class="lineNum">     258 </span><span class="lineCov">         16 :   if(fT0sigma &lt; sigmaFill &amp;&amp; TMath::Abs(lT0Current - t0fill) &lt; thrGood){</span>
<span class="lineNum">     259 </span><span class="lineCov">          8 :     fCalculated[1]=fT0sigma;</span>
<span class="lineNum">     260 </span><span class="lineCov">          8 :     fCalculated[0]=lT0Current;</span>
<span class="lineNum">     261 </span><span class="lineCov">          8 :   }</span>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span><span class="lineCov">         16 :   if(fT0sigma &gt;= 1000 || fNoTOFT0){</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     lT0Current = t0fill;</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :     fT0sigma = sigmaFill;</span>
<span class="lineNum">     266 </span>            : 
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     fCalculated[0] = t0fill;</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :     fCalculated[1] = sigmaFill;</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     270 </span>            : 
<span class="lineNum">     271 </span>            :   // T0 pt bin
<span class="lineNum">     272 </span><span class="lineCov">          8 :   Float_t *t0values = new Float_t[fNmomBins];</span>
<span class="lineNum">     273 </span><span class="lineCov">          8 :   Float_t *t0resolution = new Float_t[fNmomBins];</span>
<span class="lineNum">     274 </span><span class="lineCov">          8 :   if(fCalculated[7] &lt; 100){</span>
<span class="lineNum">     275 </span><span class="lineCov">        176 :     for(Int_t i=0;i&lt;fNmomBins;i++){</span>
<span class="lineNum">     276 </span><span class="lineCov">         80 :       t0maker-&gt;DefineT0(&quot;all&quot;,fPIDesd-&gt;GetTOFResponse().GetMinMom(i),fPIDesd-&gt;GetTOFResponse().GetMaxMom(i));</span>
<span class="lineNum">     277 </span><span class="lineCov">         80 :       t0tof[0] = t0maker-&gt;GetResult(0);</span>
<span class="lineNum">     278 </span><span class="lineCov">         80 :       t0tof[1] = t0maker-&gt;GetResult(1);</span>
<span class="lineNum">     279 </span><span class="lineCov">         80 :       t0tof[2] = t0maker-&gt;GetResult(2);</span>
<span class="lineNum">     280 </span><span class="lineCov">         80 :       t0tof[3] = t0maker-&gt;GetResult(3);</span>
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span><span class="lineCov">         80 :       Float_t t0bin =-1000*t0tof[0]; // best t0</span>
<span class="lineNum">     283 </span><span class="lineCov">         80 :       Float_t t0binRes =1000*t0tof[1]; // sigma best t0</span>
<span class="lineNum">     284 </span>            :       
<span class="lineNum">     285 </span><span class="lineCov">        240 :       if(t0binRes &lt; sigmaFill  &amp;&amp; t0binRes &lt; fTimeResolution * 1.41 &amp;&amp; TMath::Abs(t0bin - t0fill) &lt; thrGood){</span>
<span class="lineNum">     286 </span>            :         // Ok T0
<span class="lineNum">     287 </span><span class="lineCov">         80 :         if(t0sigma &lt; 1000){</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :           Double_t w1 = 1./t0sigma/t0sigma;</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :           Double_t w2 = 1./t0binRes/t0binRes;</span>
<span class="lineNum">     290 </span>            :           
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :           Double_t wtot = w1+w2;</span>
<span class="lineNum">     292 </span>            :           
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :           t0bin = (w1*t0time + w2*t0bin) / wtot;</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :           t0binRes = TMath::Sqrt(1./wtot);</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     296 </span>            :       }
<span class="lineNum">     297 </span>            :       else{
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :         t0bin = t0fill;</span>
<span class="lineNum">     299 </span>            :         t0binRes = sigmaFill;
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :         if(t0sigma &lt; 1000){</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :           t0bin = t0time;</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :            t0binRes= t0sigma;     </span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     304 </span>            :       }
<span class="lineNum">     305 </span><span class="lineCov">         80 :       t0values[i] = t0bin;</span>
<span class="lineNum">     306 </span><span class="lineCov">         80 :       t0resolution[i] = t0binRes;</span>
<span class="lineNum">     307 </span>            :     }
<span class="lineNum">     308 </span><span class="lineCov">          8 :   }</span>
<span class="lineNum">     309 </span>            :   else{
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :     for(Int_t i=0;i&lt;fNmomBins;i++){</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       t0values[i] = lT0Current;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       t0resolution[i] = fT0sigma;</span>
<span class="lineNum">     313 </span>            :     }
<span class="lineNum">     314 </span>            :   }
<span class="lineNum">     315 </span><span class="lineCov">        176 :   for(Int_t i=0;i&lt;fNmomBins;i++){</span>
<span class="lineNum">     316 </span><span class="lineCov">         80 :     fPIDesd-&gt;GetTOFResponse().SetT0bin(i,t0values[i]);</span>
<span class="lineNum">     317 </span><span class="lineCov">         80 :     fPIDesd-&gt;GetTOFResponse().SetT0binRes(i,t0resolution[i]);</span>
<span class="lineNum">     318 </span>            :   }
<span class="lineNum">     319 </span>            :   
<span class="lineNum">     320 </span><span class="lineCov">         16 :   delete[] t0values;</span>
<span class="lineNum">     321 </span><span class="lineCov">         16 :   delete[] t0resolution;</span>
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span><span class="lineCov">          8 :   return fCalculated;</span>
<a name="324"><span class="lineNum">     324 </span>            : }</a>
<span class="lineNum">     325 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     326 </span>            : Double_t  *AliTOFT0maker::GetT0p(Float_t p){// [0]=to -- [1] = sigma T0
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   Int_t i=fPIDesd-&gt;GetTOFResponse().GetMomBin(p);</span>
<span class="lineNum">     328 </span>            :   
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :   fT0cur[0] = fPIDesd-&gt;GetTOFResponse().GetT0bin(i);</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   fT0cur[1] = fPIDesd-&gt;GetTOFResponse().GetT0binRes(i);</span>
<span class="lineNum">     331 </span>            : 
<span class="lineNum">     332 </span><span class="lineNoCov">          0 :   return fT0cur;</span>
<a name="333"><span class="lineNum">     333 </span>            : }</a>
<span class="lineNum">     334 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     335 </span>            : void AliTOFT0maker::SetTOFResponse(){
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :   fPIDesd-&gt;GetTOFResponse().SetTimeResolution(fTimeResolution);</span>
<a name="337"><span class="lineNum">     337 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     338 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     339 </span>            : Float_t AliTOFT0maker::GetExpectedSigma(Float_t mom, Float_t tof, Float_t mass){
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :   Float_t sigma = fPIDesd-&gt;GetTOFResponse().GetExpectedSigma(mom,tof,mass);</span>
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :   return sigma;</span>
<a name="343"><span class="lineNum">     343 </span>            : }</a>
<span class="lineNum">     344 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     345 </span>            : void AliTOFT0maker::ApplyT0TOF(AliESDEvent *esd){
<span class="lineNum">     346 </span>            :   //
<span class="lineNum">     347 </span>            :   // Recalculate TOF PID probabilities
<span class="lineNum">     348 </span>            :   //
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span>            : // subtruct t0 for each track
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :    Int_t ntracks = esd-&gt;GetNumberOfTracks();</span>
<span class="lineNum">     352 </span>            :   
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :    while (ntracks--) {</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :        AliESDtrack *t=esd-&gt;GetTrack(ntracks);</span>
<span class="lineNum">     355 </span>            :     
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :        if ((t-&gt;GetStatus()&amp;AliESDtrack::kTOFout)==0) continue;</span>
<span class="lineNum">     357 </span>            :     
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :        Double_t time=t-&gt;GetTOFsignal();</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :        Float_t p = t-&gt;GetP();</span>
<span class="lineNum">     360 </span>            : 
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :        Double_t *t0=GetT0p(p);</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :        time -= t0[0];</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :        t-&gt;SetTOFsignal(time);</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :    }</span>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :    for(Int_t i=0;i&lt;fNmomBins;i++){</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :        fPIDesd-&gt;GetTOFResponse().SetT0bin(i,0.0);</span>
<span class="lineNum">     368 </span>            :    }
<span class="lineNum">     369 </span>            :    
<span class="lineNum">     370 </span>            :   //
<a name="371"><span class="lineNum">     371 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     372 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     373 </span>            : void  AliTOFT0maker::LoadChannelMap(const char *filename){
<span class="lineNum">     374 </span>            :   // Load the histo with the channel off map
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :   TFile *f= new TFile(filename);</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   if(!f){</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :     printf(&quot;Cannot open the channel map file (%s)\n&quot;,filename);</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     379 </span>            :   }
<span class="lineNum">     380 </span>            :   
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :   fHmapChannel = (TH1F *) f-&gt;Get(&quot;hChEnabled&quot;);</span>
<span class="lineNum">     382 </span>            :   
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   if(!fHmapChannel){</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     printf(&quot;Cannot laod the channel map histo (from %s)\n&quot;,filename);</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     386 </span>            :   }
<span class="lineNum">     387 </span>            :     
<a name="388"><span class="lineNum">     388 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     389 </span>            : //____________________________________________________________________________ 
<span class="lineNum">     390 </span>            : void AliTOFT0maker::ApplyMask(AliESDEvent * const esd){
<span class="lineNum">     391 </span>            :   // Switch off the disable channel
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :   if(!fHmapChannel){</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :     printf(&quot;Channel Map is not available\n&quot;);</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">     395 </span>            :   }
<span class="lineNum">     396 </span>            :   
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :   Int_t ntracks = esd-&gt;GetNumberOfTracks();</span>
<span class="lineNum">     398 </span>            :   
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :   while (ntracks--) {</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :     AliESDtrack *t=esd-&gt;GetTrack(ntracks);    </span>
<span class="lineNum">     401 </span>            : 
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :     if ((t-&gt;GetStatus()&amp;AliESDtrack::kTOFout)==0) continue;</span>
<span class="lineNum">     403 </span>            : 
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :     Int_t chan = t-&gt;GetTOFCalChannel();</span>
<span class="lineNum">     405 </span>            :  
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :     if(fHmapChannel-&gt;GetBinContent(chan) &lt; 0.01){</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :       t-&gt;ResetStatus(AliESDtrack::kTOFout);</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 : }</span>
<a name="411"><span class="lineNum">     411 </span>            : </a>
<span class="lineNum">     412 </span>            : Float_t  
<span class="lineNum">     413 </span>            : AliTOFT0maker::TuneForMC(AliESDEvent *esd){ // return true T0 event
<span class="lineNum">     414 </span>            :   //
<span class="lineNum">     415 </span>            :   // tune for MC data
<span class="lineNum">     416 </span>            :   //
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span>            :   Float_t TOFtimeResolutionDefault=80;
<span class="lineNum">     419 </span>            : 
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :   Float_t t0 = gRandom-&gt;Gaus(0.,fT0width); </span>
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span>            :   Float_t extraSmearing = 0;
<span class="lineNum">     423 </span>            : 
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :   if(fTimeResolution &gt; TOFtimeResolutionDefault){</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :     extraSmearing = TMath::Sqrt(fTimeResolution*fTimeResolution - TOFtimeResolutionDefault*TOFtimeResolutionDefault);</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     427 </span>            : 
<span class="lineNum">     428 </span>            :   // subtruct t0 for each track
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :   Int_t ntracks = esd-&gt;GetNumberOfTracks();</span>
<span class="lineNum">     430 </span>            :   
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :   while (ntracks--) {</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     AliESDtrack *t=esd-&gt;GetTrack(ntracks);</span>
<span class="lineNum">     433 </span>            :     
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :     if ((t-&gt;GetStatus()&amp;AliESDtrack::kTOFout)==0) continue;</span>
<span class="lineNum">     435 </span>            :     
<span class="lineNum">     436 </span>            :     /* check if channel is enabled */
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :     if (fTOFcalib){</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         if(!fTOFcalib-&gt;IsChannelEnabled(t-&gt;GetTOFCalChannel())) {</span>
<span class="lineNum">     439 </span>            :             /* reset TOF status */
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :             t-&gt;ResetStatus(AliESDtrack::kTOFin);</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :             t-&gt;ResetStatus(AliESDtrack::kTOFout);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :             t-&gt;ResetStatus(AliESDtrack::kTOFmismatch);</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :             t-&gt;ResetStatus(AliESDtrack::kTOFpid);</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     445 </span>            :     }
<span class="lineNum">     446 </span>            : 
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     Double_t time=t-&gt;GetTOFsignal();</span>
<span class="lineNum">     448 </span>            : 
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     time += t0;</span>
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :     if(extraSmearing&gt;0){</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :       Float_t smearing = gRandom-&gt;Gaus(0.,extraSmearing);</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :       time += smearing;</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     }</span>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :     t-&gt;SetTOFsignal(time);</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">     458 </span>            :   //
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :   return t0;</span>
<a name="460"><span class="lineNum">     460 </span>            : }</a>
<span class="lineNum">     461 </span>            : //_________________________________________________________________________
<span class="lineNum">     462 </span>            : void     AliTOFT0maker::WriteInESD(AliESDEvent *esd){
<span class="lineNum">     463 </span>            :   //
<span class="lineNum">     464 </span>            :   // Write t0Gen, t0ResGen, nt0;
<span class="lineNum">     465 </span>            :   //       t0resESD[0:nt0], it0ESD[0:nt0]
<span class="lineNum">     466 </span>            :   // in the AliESDEvent
<span class="lineNum">     467 </span>            :   //
<span class="lineNum">     468 </span><span class="lineCov">         16 :     Int_t nMomBins = fPIDesd-&gt;GetTOFResponse().GetNmomBins();</span>
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span>            :     Int_t nt0=0;
<span class="lineNum">     471 </span><span class="lineCov">          8 :     Float_t *t0 = new Float_t[nMomBins];</span>
<span class="lineNum">     472 </span><span class="lineCov">          8 :     Float_t *t0res = new Float_t[nMomBins];</span>
<span class="lineNum">     473 </span><span class="lineCov">          8 :     Int_t *multT0 = new Int_t[nMomBins];</span>
<span class="lineNum">     474 </span>            : 
<span class="lineNum">     475 </span><span class="lineCov">        176 :     for(Int_t i=0;i&lt;nMomBins;i++){</span>
<span class="lineNum">     476 </span>            : //      printf(&quot;START %i) %f %f\n&quot;,i,fT0event[i],fT0resolution[i]);
<span class="lineNum">     477 </span><span class="lineCov">         80 :         multT0[i]=0;</span>
<span class="lineNum">     478 </span>            :         Bool_t kNewT0=kTRUE;
<span class="lineNum">     479 </span><span class="lineCov">        478 :         for(Int_t j=0;j &lt; nt0;j++){</span>
<span class="lineNum">     480 </span><span class="lineCov">        159 :             if(TMath::Abs(fPIDesd-&gt;GetTOFResponse().GetT0bin(i) - t0[j])&lt;0.1){</span>
<span class="lineNum">     481 </span>            :                 kNewT0=kFALSE;
<span class="lineNum">     482 </span><span class="lineCov">         33 :                 multT0[j]++;</span>
<span class="lineNum">     483 </span><span class="lineCov">         33 :                 j=nMomBins*10;</span>
<span class="lineNum">     484 </span><span class="lineCov">         33 :             }</span>
<span class="lineNum">     485 </span>            :         }
<span class="lineNum">     486 </span><span class="lineCov">         80 :         if(kNewT0){</span>
<span class="lineNum">     487 </span><span class="lineCov">         47 :             t0[nt0]=fPIDesd-&gt;GetTOFResponse().GetT0bin(i);</span>
<span class="lineNum">     488 </span><span class="lineCov">         47 :             t0res[nt0]=fPIDesd-&gt;GetTOFResponse().GetT0binRes(i);</span>
<span class="lineNum">     489 </span><span class="lineCov">         47 :             nt0++;</span>
<span class="lineNum">     490 </span><span class="lineCov">         47 :         }</span>
<span class="lineNum">     491 </span>            :     }
<span class="lineNum">     492 </span>            : 
<span class="lineNum">     493 </span>            :     Int_t iMultT0=0,nmult=0;
<span class="lineNum">     494 </span><span class="lineCov">        110 :     for(Int_t j=0;j &lt; nt0;j++){ // find the most frequent</span>
<span class="lineNum">     495 </span><span class="lineCov">         47 :         if(multT0[j] &gt; nmult){</span>
<span class="lineNum">     496 </span>            :             iMultT0 = j;
<span class="lineNum">     497 </span>            :             nmult = multT0[j];
<span class="lineNum">     498 </span><span class="lineCov">          8 :         }</span>
<span class="lineNum">     499 </span>            :     }
<span class="lineNum">     500 </span>            : 
<span class="lineNum">     501 </span><span class="lineCov">          8 :     Float_t *t0ESD = new Float_t[nMomBins];</span>
<span class="lineNum">     502 </span><span class="lineCov">          8 :     Float_t *t0resESD = new Float_t[nMomBins];</span>
<span class="lineNum">     503 </span><span class="lineCov">          8 :     Int_t *it0ESD = new Int_t[nMomBins];</span>
<span class="lineNum">     504 </span>            :     
<span class="lineNum">     505 </span>            :     Float_t t0Gen,t0ResGen;
<span class="lineNum">     506 </span><span class="lineCov">          8 :     t0Gen = t0[iMultT0];</span>
<span class="lineNum">     507 </span><span class="lineCov">          8 :     t0ResGen = t0res[iMultT0];</span>
<span class="lineNum">     508 </span>            :     nt0=0;
<span class="lineNum">     509 </span>            :     //  printf(&quot;T0 to ESD\n%f %f\n&quot;,t0Gen,t0ResGen);
<span class="lineNum">     510 </span><span class="lineCov">        176 :     for(Int_t i=0;i&lt;nMomBins;i++){</span>
<span class="lineNum">     511 </span><span class="lineCov">         80 :         if(TMath::Abs(fPIDesd-&gt;GetTOFResponse().GetT0bin(i) - t0Gen)&gt;0.1){</span>
<span class="lineNum">     512 </span><span class="lineCov">         43 :             t0ESD[nt0]=fPIDesd-&gt;GetTOFResponse().GetT0bin(i);</span>
<span class="lineNum">     513 </span><span class="lineCov">         43 :             t0resESD[nt0]=fPIDesd-&gt;GetTOFResponse().GetT0binRes(i);</span>
<span class="lineNum">     514 </span><span class="lineCov">         43 :             it0ESD[nt0]=i;</span>
<span class="lineNum">     515 </span>            : //          printf(&quot;%i) %f %f %i\n&quot;,nt0,t0ESD[nt0],t0resESD[nt0],it0ESD[nt0]);
<span class="lineNum">     516 </span><span class="lineCov">         43 :             nt0++;</span>
<span class="lineNum">     517 </span><span class="lineCov">         43 :         }</span>
<span class="lineNum">     518 </span>            :     }
<span class="lineNum">     519 </span>            : 
<span class="lineNum">     520 </span>            :     // Write  t0Gen,t0ResGen; nt0; t0resESD[0:nt0],it0ESD[0:nt0] in the AliESDEvent
<span class="lineNum">     521 </span>            : 
<span class="lineNum">     522 </span>            :    AliTOFHeader *tofHeader =
<span class="lineNum">     523 </span><span class="lineCov">         16 :         new AliTOFHeader(t0Gen,t0ResGen,nt0,</span>
<span class="lineNum">     524 </span><span class="lineCov">          8 :                          t0ESD,t0resESD,it0ESD,fTimeResolution,fT0width);</span>
<span class="lineNum">     525 </span>            :   
<span class="lineNum">     526 </span><span class="lineCov">          8 :     esd-&gt;SetTOFHeader(tofHeader);</span>
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span><span class="lineCov">         16 :     delete tofHeader;</span>
<span class="lineNum">     529 </span>            : 
<span class="lineNum">     530 </span><span class="lineCov">         24 :     AliDebug(1,Form(&quot;resTOF=%f T0spread=%f t0Gen=%f t0resGen=%f&quot;,fTimeResolution,fT0width,t0Gen,t0ResGen));</span>
<span class="lineNum">     531 </span><span class="lineCov">         24 :     AliDebug(1,Form(&quot;%d &quot;,nt0));</span>
<span class="lineNum">     532 </span><span class="lineCov">        102 :     for (Int_t ii=0; ii&lt;nt0; ii++)</span>
<span class="lineNum">     533 </span><span class="lineCov">        129 :       AliDebug(1,Form(&quot;pBin=%d t0val=%f t0res=%f&quot;,it0ESD[ii],t0ESD[ii],t0resESD[ii]));</span>
<span class="lineNum">     534 </span>            :     
<span class="lineNum">     535 </span><span class="lineCov">         16 :     delete[] t0;</span>
<span class="lineNum">     536 </span>            :     t0 = NULL;
<span class="lineNum">     537 </span><span class="lineCov">         16 :     delete[] t0res;</span>
<span class="lineNum">     538 </span>            :     t0res = NULL;
<span class="lineNum">     539 </span><span class="lineCov">         16 :     delete[] multT0;</span>
<span class="lineNum">     540 </span>            :     multT0 = NULL;
<span class="lineNum">     541 </span><span class="lineCov">         16 :     delete[] t0ESD;</span>
<span class="lineNum">     542 </span>            :     t0ESD = NULL;
<span class="lineNum">     543 </span><span class="lineCov">         16 :     delete[] t0resESD;</span>
<span class="lineNum">     544 </span>            :     t0resESD = NULL;
<span class="lineNum">     545 </span><span class="lineCov">         16 :     delete[] it0ESD;</span>
<span class="lineNum">     546 </span>            :     it0ESD = NULL;
<span class="lineNum">     547 </span>            : 
<span class="lineNum">     548 </span><span class="lineCov">          8 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
